{"version":3,"file":"ImageProcessor.worker-ddd96702.js","sources":["../src/workers/ImageProcessor.worker.ts"],"sourcesContent":["interface LABColor {\n  L: number;\n  a: number;\n  b: number;\n}\n\ninterface YCbCrColor {\n  y: number;\n  cb: number;\n  cr: number;\n}\n\nconst SaliencyDetector = {\n  detectSaliency(imageData: ImageData, threshold: number = 0.4): Uint8Array {\n    const { width, height, data } = imageData;\n    const saliencyMap = new Float32Array(width * height);\n    const meanLab = this.computeMeanLAB(data, width, height);\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        const idx = (y * width + x) * 4;\n        const pixelLab = this.rgbToLAB(data[idx], data[idx + 1], data[idx + 2]);\n\n        const diff =\n          Math.sqrt(\n            Math.pow(pixelLab.L - meanLab.L, 2) +\n              Math.pow(pixelLab.a - meanLab.a, 2) +\n              Math.pow(pixelLab.b - meanLab.b, 2)\n          ) / 100;\n\n        saliencyMap[y * width + x] = Math.min(1.0, diff * 2);\n      }\n    }\n\n    const blurred = this.gaussianBlur(saliencyMap, width, height, 3);\n    const binaryMask = new Uint8Array(width * height);\n    \n    for (let i = 0; i < blurred.length; i++) {\n      binaryMask[i] = blurred[i] > threshold ? 255 : 0;\n    }\n\n    return binaryMask;\n  },\n\n  rgbToLAB(r: number, g: number, b: number): LABColor {\n    let rr = r / 255;\n    let gg = g / 255;\n    let bb = b / 255;\n\n    rr = rr > 0.04045 ? Math.pow((rr + 0.055) / 1.055, 2.4) : rr / 12.92;\n    gg = gg > 0.04045 ? Math.pow((gg + 0.055) / 1.055, 2.4) : gg / 12.92;\n    bb = bb > 0.04045 ? Math.pow((bb + 0.055) / 1.055, 2.4) : bb / 12.92;\n\n    const x = rr * 0.4124 + gg * 0.3576 + bb * 0.1805;\n    const y = rr * 0.2126 + gg * 0.7152 + bb * 0.0722;\n    const z = rr * 0.0193 + gg * 0.1192 + bb * 0.9505;\n\n    const xn = 0.95047;\n    const yn = 1.0;\n    const zn = 1.08883;\n\n    const fx = x / xn > 0.008856 ? Math.pow(x / xn, 1 / 3) : 7.787 * (x / xn) + 16 / 116;\n    const fy = y / yn > 0.008856 ? Math.pow(y / yn, 1 / 3) : 7.787 * (y / yn) + 16 / 116;\n    const fz = z / zn > 0.008856 ? Math.pow(z / zn, 1 / 3) : 7.787 * (z / zn) + 16 / 116;\n\n    return {\n      L: 116 * fy - 16,\n      a: 500 * (fx - fy),\n      b: 200 * (fy - fz),\n    };\n  },\n\n  computeMeanLAB(data: Uint8ClampedArray, width: number, height: number): LABColor {\n    let sumL = 0, sumA = 0, sumB = 0;\n    const totalPixels = width * height;\n\n    for (let i = 0; i < data.length; i += 4) {\n      const lab = this.rgbToLAB(data[i], data[i + 1], data[i + 2]);\n      sumL += lab.L;\n      sumA += lab.a;\n      sumB += lab.b;\n    }\n\n    return {\n      L: sumL / totalPixels,\n      a: sumA / totalPixels,\n      b: sumB / totalPixels,\n    };\n  },\n\n  gaussianBlur(data: Float32Array, width: number, height: number, radius: number): Float32Array {\n    const result = new Float32Array(data.length);\n    const kernel = this.createGaussianKernel(radius);\n    const halfKernel = Math.floor(kernel.length / 2);\n\n    const temp = new Float32Array(data.length);\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        let sum = 0;\n        let weightSum = 0;\n\n        for (let k = -halfKernel; k <= halfKernel; k++) {\n          const px = Math.max(0, Math.min(width - 1, x + k));\n          const weight = kernel[k + halfKernel];\n          sum += data[y * width + px] * weight;\n          weightSum += weight;\n        }\n\n        temp[y * width + x] = sum / weightSum;\n      }\n    }\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        let sum = 0;\n        let weightSum = 0;\n\n        for (let k = -halfKernel; k <= halfKernel; k++) {\n          const py = Math.max(0, Math.min(height - 1, y + k));\n          const weight = kernel[k + halfKernel];\n          sum += temp[py * width + x] * weight;\n          weightSum += weight;\n        }\n\n        result[y * width + x] = sum / weightSum;\n      }\n    }\n\n    return result;\n  },\n\n  createGaussianKernel(radius: number): number[] {\n    const sigma = radius / 2;\n    const kernelSize = radius * 2 + 1;\n    const kernel = new Array(kernelSize);\n    let sum = 0;\n\n    for (let i = 0; i < kernelSize; i++) {\n      const x = i - radius;\n      kernel[i] = Math.exp(-(x * x) / (2 * sigma * sigma)) / (Math.sqrt(2 * Math.PI) * sigma);\n      sum += kernel[i];\n    }\n\n    for (let i = 0; i < kernelSize; i++) {\n      kernel[i] /= sum;\n    }\n\n    return kernel;\n  },\n};\n\nconst ColorRangeSegmenter = {\n  removeByColor(\n    imageData: ImageData,\n    targetColor: [number, number, number],\n    tolerance: number = 0.3,\n    softness: number = 0.1\n  ): Uint8ClampedArray {\n    const { width, height, data } = imageData;\n    const alpha = new Uint8ClampedArray(width * height);\n    const [tr, tg, tb] = targetColor;\n    const targetYCbCr = this.rgbToYCbCr(tr, tg, tb);\n\n    for (let i = 0; i < data.length; i += 4) {\n      const r = data[i];\n      const g = data[i + 1];\n      const b = data[i + 2];\n\n      const ycbcr = this.rgbToYCbCr(r, g, b);\n\n      const yDiff = Math.abs(ycbcr.y - targetYCbCr.y) / 255;\n      const cbDiff = Math.abs(ycbcr.cb - targetYCbCr.cb) / 255;\n      const crDiff = Math.abs(ycbcr.cr - targetYCbCr.cr) / 255;\n\n      const colorDistance = Math.sqrt(\n        Math.pow(yDiff * 0.3, 2) + Math.pow(cbDiff * 1.0, 2) + Math.pow(crDiff * 1.0, 2)\n      );\n\n      let alphaValue = 255;\n\n      if (colorDistance < tolerance) {\n        alphaValue = 0;\n      } else if (colorDistance < tolerance + softness) {\n        const t = (colorDistance - tolerance) / softness;\n        alphaValue = Math.floor(255 * t);\n      }\n\n      alpha[i / 4] = alphaValue;\n    }\n\n    return alpha;\n  },\n\n  rgbToYCbCr(r: number, g: number, b: number): YCbCrColor {\n    const y = 0.299 * r + 0.587 * g + 0.114 * b;\n    const cb = 128 - 0.168736 * r - 0.331264 * g + 0.5 * b;\n    const cr = 128 + 0.5 * r - 0.418688 * g - 0.081312 * b;\n    return { y, cb, cr };\n  },\n\n  detectBackgroundColor(imageData: ImageData): [number, number, number] {\n    const { width, height, data } = imageData;\n    const edgeSamples: [number, number, number][] = [];\n    const sampleStep = Math.max(1, Math.floor(width / 50));\n\n    for (let x = 0; x < width; x += sampleStep) {\n      const idx = x * 4;\n      edgeSamples.push([data[idx], data[idx + 1], data[idx + 2]]);\n    }\n\n    for (let x = 0; x < width; x += sampleStep) {\n      const idx = ((height - 1) * width + x) * 4;\n      edgeSamples.push([data[idx], data[idx + 1], data[idx + 2]]);\n    }\n\n    if (edgeSamples.length === 0) return [255, 255, 255];\n\n    let sumR = 0, sumG = 0, sumB = 0;\n    for (const [r, g, b] of edgeSamples) {\n      sumR += r;\n      sumG += g;\n      sumB += b;\n    }\n\n    return [\n      Math.round(sumR / edgeSamples.length),\n      Math.round(sumG / edgeSamples.length),\n      Math.round(sumB / edgeSamples.length),\n    ];\n  },\n};\n\nconst MorphologyProcessor = {\n  featherEdges(mask: Uint8Array, width: number, height: number, radius: number): Uint8Array {\n    const result = new Uint8Array(mask.length);\n    const floatMask = new Float32Array(mask.length);\n    \n    for (let i = 0; i < mask.length; i++) {\n      floatMask[i] = mask[i] / 255;\n    }\n\n    const kernel = SaliencyDetector.createGaussianKernel(radius);\n    const halfSize = Math.floor(kernel.length / 2);\n\n    const temp = new Float32Array(mask.length);\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        let sum = 0;\n        let weightSum = 0;\n\n        for (let k = -halfSize; k <= halfSize; k++) {\n          const nx = Math.max(0, Math.min(width - 1, x + k));\n          const weight = kernel[k + halfSize];\n          sum += floatMask[y * width + nx] * weight;\n          weightSum += weight;\n        }\n\n        temp[y * width + x] = sum / weightSum;\n      }\n    }\n\n    for (let y = 0; y < height; y++) {\n      for (let x = 0; x < width; x++) {\n        let sum = 0;\n        let weightSum = 0;\n\n        for (let k = -halfSize; k <= halfSize; k++) {\n          const ny = Math.max(0, Math.min(height - 1, y + k));\n          const weight = kernel[k + halfSize];\n          sum += temp[ny * width + x] * weight;\n          weightSum += weight;\n        }\n\n        result[y * width + x] = Math.floor((sum / weightSum) * 255);\n      }\n    }\n\n    return result;\n  },\n\n  fillHoles(mask: Uint8Array, width: number, height: number): Uint8Array {\n    const result = new Uint8Array(mask);\n    const visited = new Uint8Array(width * height);\n\n    const floodFill = (startX: number, startY: number): number[] => {\n      const region: number[] = [];\n      const stack: [number, number][] = [[startX, startY]];\n\n      while (stack.length > 0) {\n        const [x, y] = stack.pop()!;\n        const idx = y * width + x;\n\n        if (x < 0 || x >= width || y < 0 || y >= height || visited[idx] === 1 || mask[idx] > 0) {\n          continue;\n        }\n\n        visited[idx] = 1;\n        region.push(idx);\n\n        stack.push([x + 1, y]);\n        stack.push([x - 1, y]);\n        stack.push([x, y + 1]);\n        stack.push([x, y - 1]);\n      }\n\n      return region;\n    };\n\n    for (let y = 1; y < height - 1; y++) {\n      for (let x = 1; x < width - 1; x++) {\n        const idx = y * width + x;\n\n        if (mask[idx] === 0 && visited[idx] === 0) {\n          const region = floodFill(x, y);\n\n          let touchesEdge = false;\n          for (const pixelIdx of region) {\n            const px = pixelIdx % width;\n            const py = Math.floor(pixelIdx / width);\n            if (px === 0 || px === width - 1 || py === 0 || py === height - 1) {\n              touchesEdge = true;\n              break;\n            }\n          }\n\n          if (!touchesEdge && region.length < (width * height) / 4) {\n            for (const pixelIdx of region) {\n              result[pixelIdx] = 255;\n            }\n          }\n        }\n      }\n    }\n\n    return result;\n  },\n};\n\nself.onmessage = async (event: MessageEvent) => {\n  const { type, imageData, params } = event.data;\n\n  try {\n    const startTime = performance.now();\n    let result: Uint8Array | Uint8ClampedArray;\n\n    switch (type) {\n      case 'saliency': {\n        const threshold = params?.threshold ?? 0.4;\n        result = SaliencyDetector.detectSaliency(imageData, threshold);\n        break;\n      }\n\n      case 'color': {\n        const { targetColor, tolerance = 0.3, softness = 0.1 } = params;\n        result = ColorRangeSegmenter.removeByColor(imageData, targetColor, tolerance, softness);\n        break;\n      }\n\n      case 'detectBackground': {\n        const bgColor = ColorRangeSegmenter.detectBackgroundColor(imageData);\n        self.postMessage({\n          success: true,\n          result: bgColor,\n          processingTime: performance.now() - startTime,\n        });\n        return;\n      }\n\n      case 'feather': {\n        const { mask, width, height, radius = 2 } = params;\n        result = MorphologyProcessor.featherEdges(mask, width, height, radius);\n        break;\n      }\n\n      case 'fillHoles': {\n        const { mask, width, height } = params;\n        result = MorphologyProcessor.fillHoles(mask, width, height);\n        break;\n      }\n\n      default:\n        throw new Error(`Unknown processing type: ${type}`);\n    }\n\n    const processingTime = performance.now() - startTime;\n\n    self.postMessage({\n      success: true,\n      result,\n      processingTime,\n    });\n  } catch (error) {\n    self.postMessage({\n      success: false,\n      error: (error as Error).message,\n    });\n  }\n};\n\nexport {};\n"],"names":["SaliencyDetector","imageData","threshold","width","height","data","saliencyMap","meanLab","y","x","idx","pixelLab","diff","blurred","binaryMask","i","r","g","b","rr","gg","bb","z","xn","yn","zn","fx","fy","fz","sumL","sumA","sumB","totalPixels","lab","radius","result","kernel","halfKernel","temp","sum","weightSum","k","px","weight","py","sigma","kernelSize","ColorRangeSegmenter","targetColor","tolerance","softness","alpha","tr","tg","tb","targetYCbCr","ycbcr","yDiff","cbDiff","crDiff","colorDistance","alphaValue","t","cb","cr","edgeSamples","sampleStep","sumR","sumG","MorphologyProcessor","mask","floatMask","halfSize","nx","ny","visited","floodFill","startX","startY","region","stack","touchesEdge","pixelIdx","event","type","params","startTime","bgColor","processingTime","error"],"mappings":"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"}