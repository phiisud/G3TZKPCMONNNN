var Nre=Object.defineProperty;var Pre=(n,e,t)=>e in n?Nre(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var E=(n,e,t)=>(Pre(n,typeof e!="symbol"?e+"":e,t),t),DT=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var ze=(n,e,t)=>(DT(n,e,"read from private field"),t?t.call(n):e.get(n)),$t=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},On=(n,e,t,i)=>(DT(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t);var wu=(n,e,t,i)=>({set _(r){On(n,e,r,t)},get _(){return ze(n,e,i)}}),rn=(n,e,t)=>(DT(n,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=t(r);fetch(r.href,s)}})();var $E=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function wc(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function kre(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var r=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:function(){return n[i]}})}),t}var tG={exports:{}},GE={},nG={exports:{}},ui={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o_=Symbol.for("react.element"),Lre=Symbol.for("react.portal"),Dre=Symbol.for("react.fragment"),Ore=Symbol.for("react.strict_mode"),Bre=Symbol.for("react.profiler"),Ure=Symbol.for("react.provider"),Fre=Symbol.for("react.context"),zre=Symbol.for("react.forward_ref"),jre=Symbol.for("react.suspense"),Vre=Symbol.for("react.memo"),Hre=Symbol.for("react.lazy"),uB=Symbol.iterator;function $re(n){return n===null||typeof n!="object"?null:(n=uB&&n[uB]||n["@@iterator"],typeof n=="function"?n:null)}var iG={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rG=Object.assign,sG={};function ex(n,e,t){this.props=n,this.context=e,this.refs=sG,this.updater=t||iG}ex.prototype.isReactComponent={};ex.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};ex.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function oG(){}oG.prototype=ex.prototype;function tP(n,e,t){this.props=n,this.context=e,this.refs=sG,this.updater=t||iG}var nP=tP.prototype=new oG;nP.constructor=tP;rG(nP,ex.prototype);nP.isPureReactComponent=!0;var hB=Array.isArray,aG=Object.prototype.hasOwnProperty,iP={current:null},lG={key:!0,ref:!0,__self:!0,__source:!0};function cG(n,e,t){var i,r={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)aG.call(e,i)&&!lG.hasOwnProperty(i)&&(r[i]=e[i]);var a=arguments.length-2;if(a===1)r.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(n&&n.defaultProps)for(i in a=n.defaultProps,a)r[i]===void 0&&(r[i]=a[i]);return{$$typeof:o_,type:n,key:s,ref:o,props:r,_owner:iP.current}}function Gre(n,e){return{$$typeof:o_,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function rP(n){return typeof n=="object"&&n!==null&&n.$$typeof===o_}function Wre(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var dB=/\/+/g;function OT(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Wre(""+n.key):e.toString(36)}function Z5(n,e,t,i,r){var s=typeof n;(s==="undefined"||s==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case o_:case Lre:o=!0}}if(o)return o=n,r=r(o),n=i===""?"."+OT(o,0):i,hB(r)?(t="",n!=null&&(t=n.replace(dB,"$&/")+"/"),Z5(r,e,t,"",function(c){return c})):r!=null&&(rP(r)&&(r=Gre(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(dB,"$&/")+"/")+n)),e.push(r)),1;if(o=0,i=i===""?".":i+":",hB(n))for(var a=0;a<n.length;a++){s=n[a];var l=i+OT(s,a);o+=Z5(s,e,t,l,r)}else if(l=$re(n),typeof l=="function")for(n=l.call(n),a=0;!(s=n.next()).done;)s=s.value,l=i+OT(s,a++),o+=Z5(s,e,t,l,r);else if(s==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function zw(n,e,t){if(n==null)return n;var i=[],r=0;return Z5(n,i,"","",function(s){return e.call(t,s,r++)}),i}function Kre(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var ma={current:null},Y5={transition:null},qre={ReactCurrentDispatcher:ma,ReactCurrentBatchConfig:Y5,ReactCurrentOwner:iP};function uG(){throw Error("act(...) is not supported in production builds of React.")}ui.Children={map:zw,forEach:function(n,e,t){zw(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return zw(n,function(){e++}),e},toArray:function(n){return zw(n,function(e){return e})||[]},only:function(n){if(!rP(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};ui.Component=ex;ui.Fragment=Dre;ui.Profiler=Bre;ui.PureComponent=tP;ui.StrictMode=Ore;ui.Suspense=jre;ui.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qre;ui.act=uG;ui.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=rG({},n.props),r=n.key,s=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=iP.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)aG.call(e,l)&&!lG.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:o_,type:n.type,key:r,ref:s,props:i,_owner:o}};ui.createContext=function(n){return n={$$typeof:Fre,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Ure,_context:n},n.Consumer=n};ui.createElement=cG;ui.createFactory=function(n){var e=cG.bind(null,n);return e.type=n,e};ui.createRef=function(){return{current:null}};ui.forwardRef=function(n){return{$$typeof:zre,render:n}};ui.isValidElement=rP;ui.lazy=function(n){return{$$typeof:Hre,_payload:{_status:-1,_result:n},_init:Kre}};ui.memo=function(n,e){return{$$typeof:Vre,type:n,compare:e===void 0?null:e}};ui.startTransition=function(n){var e=Y5.transition;Y5.transition={};try{n()}finally{Y5.transition=e}};ui.unstable_act=uG;ui.useCallback=function(n,e){return ma.current.useCallback(n,e)};ui.useContext=function(n){return ma.current.useContext(n)};ui.useDebugValue=function(){};ui.useDeferredValue=function(n){return ma.current.useDeferredValue(n)};ui.useEffect=function(n,e){return ma.current.useEffect(n,e)};ui.useId=function(){return ma.current.useId()};ui.useImperativeHandle=function(n,e,t){return ma.current.useImperativeHandle(n,e,t)};ui.useInsertionEffect=function(n,e){return ma.current.useInsertionEffect(n,e)};ui.useLayoutEffect=function(n,e){return ma.current.useLayoutEffect(n,e)};ui.useMemo=function(n,e){return ma.current.useMemo(n,e)};ui.useReducer=function(n,e,t){return ma.current.useReducer(n,e,t)};ui.useRef=function(n){return ma.current.useRef(n)};ui.useState=function(n){return ma.current.useState(n)};ui.useSyncExternalStore=function(n,e,t){return ma.current.useSyncExternalStore(n,e,t)};ui.useTransition=function(){return ma.current.useTransition()};ui.version="18.3.1";nG.exports=ui;var $=nG.exports;const Fa=wc($);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zre=$,Yre=Symbol.for("react.element"),Xre=Symbol.for("react.fragment"),Qre=Object.prototype.hasOwnProperty,Jre=Zre.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ese={key:!0,ref:!0,__self:!0,__source:!0};function hG(n,e,t){var i,r={},s=null,o=null;t!==void 0&&(s=""+t),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)Qre.call(e,i)&&!ese.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:Yre,type:n,key:s,ref:o,props:r,_owner:Jre.current}}GE.Fragment=Xre;GE.jsx=hG;GE.jsxs=hG;tG.exports=GE;var f=tG.exports,VM={},dG={exports:{}},Cl={},fG={exports:{}},pG={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(G,ee){var Q=G.length;G.push(ee);e:for(;0<Q;){var ne=Q-1>>>1,fe=G[ne];if(0<r(fe,ee))G[ne]=ee,G[Q]=fe,Q=ne;else break e}}function t(G){return G.length===0?null:G[0]}function i(G){if(G.length===0)return null;var ee=G[0],Q=G.pop();if(Q!==ee){G[0]=Q;e:for(var ne=0,fe=G.length,Ae=fe>>>1;ne<Ae;){var Pe=2*(ne+1)-1,Ce=G[Pe],de=Pe+1,Ne=G[de];if(0>r(Ce,Q))de<fe&&0>r(Ne,Ce)?(G[ne]=Ne,G[de]=Q,ne=de):(G[ne]=Ce,G[Pe]=Q,ne=Pe);else if(de<fe&&0>r(Ne,Q))G[ne]=Ne,G[de]=Q,ne=de;else break e}}return ee}function r(G,ee){var Q=G.sortIndex-ee.sortIndex;return Q!==0?Q:G.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,p=3,m=!1,y=!1,b=!1,w=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(G){for(var ee=t(c);ee!==null;){if(ee.callback===null)i(c);else if(ee.startTime<=G)i(c),ee.sortIndex=ee.expirationTime,e(l,ee);else break;ee=t(c)}}function M(G){if(b=!1,S(G),!y)if(t(l)!==null)y=!0,q(P);else{var ee=t(c);ee!==null&&J(M,ee.startTime-G)}}function P(G,ee){y=!1,b&&(b=!1,v(B),B=-1),m=!0;var Q=p;try{for(S(ee),h=t(l);h!==null&&(!(h.expirationTime>ee)||G&&!F());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,p=h.priorityLevel;var fe=ne(h.expirationTime<=ee);ee=n.unstable_now(),typeof fe=="function"?h.callback=fe:h===t(l)&&i(l),S(ee)}else i(l);h=t(l)}if(h!==null)var Ae=!0;else{var Pe=t(c);Pe!==null&&J(M,Pe.startTime-ee),Ae=!1}return Ae}finally{h=null,p=Q,m=!1}}var R=!1,O=null,B=-1,N=5,I=-1;function F(){return!(n.unstable_now()-I<N)}function j(){if(O!==null){var G=n.unstable_now();I=G;var ee=!0;try{ee=O(!0,G)}finally{ee?W():(R=!1,O=null)}}else R=!1}var W;if(typeof T=="function")W=function(){T(j)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,H=U.port2;U.port1.onmessage=j,W=function(){H.postMessage(null)}}else W=function(){w(j,0)};function q(G){O=G,R||(R=!0,W())}function J(G,ee){B=w(function(){G(n.unstable_now())},ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,q(P))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(p){case 1:case 2:case 3:var ee=3;break;default:ee=p}var Q=p;p=ee;try{return G()}finally{p=Q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,ee){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Q=p;p=G;try{return ee()}finally{p=Q}},n.unstable_scheduleCallback=function(G,ee,Q){var ne=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ne+Q:ne):Q=ne,G){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=Q+fe,G={id:u++,callback:ee,priorityLevel:G,startTime:Q,expirationTime:fe,sortIndex:-1},Q>ne?(G.sortIndex=Q,e(c,G),t(l)===null&&G===t(c)&&(b?(v(B),B=-1):b=!0,J(M,Q-ne))):(G.sortIndex=fe,e(l,G),y||m||(y=!0,q(P))),G},n.unstable_shouldYield=F,n.unstable_wrapCallback=function(G){var ee=p;return function(){var Q=p;p=ee;try{return G.apply(this,arguments)}finally{p=Q}}}})(pG);fG.exports=pG;var tse=fG.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nse=$,Al=tse;function Ft(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var mG=new Set,O3={};function a1(n,e){o2(n,e),o2(n+"Capture",e)}function o2(n,e){for(O3[n]=e,n=0;n<e.length;n++)mG.add(e[n])}var Md=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),HM=Object.prototype.hasOwnProperty,ise=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,fB={},pB={};function rse(n){return HM.call(pB,n)?!0:HM.call(fB,n)?!1:ise.test(n)?pB[n]=!0:(fB[n]=!0,!1)}function sse(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function ose(n,e,t,i){if(e===null||typeof e>"u"||sse(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ga(n,e,t,i,r,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var oo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){oo[n]=new ga(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];oo[e]=new ga(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){oo[n]=new ga(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){oo[n]=new ga(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){oo[n]=new ga(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){oo[n]=new ga(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){oo[n]=new ga(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){oo[n]=new ga(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){oo[n]=new ga(n,5,!1,n.toLowerCase(),null,!1,!1)});var sP=/[\-:]([a-z])/g;function oP(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(sP,oP);oo[e]=new ga(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(sP,oP);oo[e]=new ga(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(sP,oP);oo[e]=new ga(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){oo[n]=new ga(n,1,!1,n.toLowerCase(),null,!1,!1)});oo.xlinkHref=new ga("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){oo[n]=new ga(n,1,!1,n.toLowerCase(),null,!0,!0)});function aP(n,e,t,i){var r=oo.hasOwnProperty(e)?oo[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ose(e,t,r,i)&&(t=null),i||r===null?rse(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var Bd=nse.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,jw=Symbol.for("react.element"),Hg=Symbol.for("react.portal"),$g=Symbol.for("react.fragment"),lP=Symbol.for("react.strict_mode"),$M=Symbol.for("react.profiler"),gG=Symbol.for("react.provider"),yG=Symbol.for("react.context"),cP=Symbol.for("react.forward_ref"),GM=Symbol.for("react.suspense"),WM=Symbol.for("react.suspense_list"),uP=Symbol.for("react.memo"),Df=Symbol.for("react.lazy"),xG=Symbol.for("react.offscreen"),mB=Symbol.iterator;function Yx(n){return n===null||typeof n!="object"?null:(n=mB&&n[mB]||n["@@iterator"],typeof n=="function"?n:null)}var jr=Object.assign,BT;function zv(n){if(BT===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);BT=e&&e[1]||""}return`
`+BT+n}var UT=!1;function FT(n,e){if(!n||UT)return"";UT=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){i=c}n.call(e.prototype)}else{try{throw Error()}catch(c){i=c}n()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),s=i.stack.split(`
`),o=r.length-1,a=s.length-1;1<=o&&0<=a&&r[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(r[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||r[o]!==s[a]){var l=`
`+r[o].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=o&&0<=a);break}}}finally{UT=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?zv(n):""}function ase(n){switch(n.tag){case 5:return zv(n.type);case 16:return zv("Lazy");case 13:return zv("Suspense");case 19:return zv("SuspenseList");case 0:case 2:case 15:return n=FT(n.type,!1),n;case 11:return n=FT(n.type.render,!1),n;case 1:return n=FT(n.type,!0),n;default:return""}}function KM(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case $g:return"Fragment";case Hg:return"Portal";case $M:return"Profiler";case lP:return"StrictMode";case GM:return"Suspense";case WM:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case yG:return(n.displayName||"Context")+".Consumer";case gG:return(n._context.displayName||"Context")+".Provider";case cP:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case uP:return e=n.displayName||null,e!==null?e:KM(n.type)||"Memo";case Df:e=n._payload,n=n._init;try{return KM(n(e))}catch{}}return null}function lse(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return KM(e);case 8:return e===lP?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function S0(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function vG(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function cse(n){var e=vG(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,s=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Vw(n){n._valueTracker||(n._valueTracker=cse(n))}function bG(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=vG(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function KS(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function qM(n,e){var t=e.checked;return jr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function gB(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=S0(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function _G(n,e){e=e.checked,e!=null&&aP(n,"checked",e,!1)}function ZM(n,e){_G(n,e);var t=S0(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?YM(n,e.type,t):e.hasOwnProperty("defaultValue")&&YM(n,e.type,S0(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function yB(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function YM(n,e,t){(e!=="number"||KS(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var jv=Array.isArray;function gy(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+S0(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function XM(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Ft(91));return jr({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function xB(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Ft(92));if(jv(t)){if(1<t.length)throw Error(Ft(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:S0(t)}}function wG(n,e){var t=S0(e.value),i=S0(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function vB(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function SG(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function QM(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?SG(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Hw,EG=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Hw=Hw||document.createElement("div"),Hw.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Hw.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function B3(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var u3={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},use=["Webkit","ms","Moz","O"];Object.keys(u3).forEach(function(n){use.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),u3[e]=u3[n]})});function TG(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||u3.hasOwnProperty(n)&&u3[n]?(""+e).trim():e+"px"}function AG(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=TG(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var hse=jr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function JM(n,e){if(e){if(hse[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Ft(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Ft(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Ft(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Ft(62))}}function eR(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var tR=null;function hP(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var nR=null,yy=null,xy=null;function bB(n){if(n=c_(n)){if(typeof nR!="function")throw Error(Ft(280));var e=n.stateNode;e&&(e=YE(e),nR(n.stateNode,n.type,e))}}function CG(n){yy?xy?xy.push(n):xy=[n]:yy=n}function MG(){if(yy){var n=yy,e=xy;if(xy=yy=null,bB(n),e)for(n=0;n<e.length;n++)bB(e[n])}}function RG(n,e){return n(e)}function IG(){}var zT=!1;function NG(n,e,t){if(zT)return n(e,t);zT=!0;try{return RG(n,e,t)}finally{zT=!1,(yy!==null||xy!==null)&&(IG(),MG())}}function U3(n,e){var t=n.stateNode;if(t===null)return null;var i=YE(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Ft(231,e,typeof t));return t}var iR=!1;if(Md)try{var Xx={};Object.defineProperty(Xx,"passive",{get:function(){iR=!0}}),window.addEventListener("test",Xx,Xx),window.removeEventListener("test",Xx,Xx)}catch{iR=!1}function dse(n,e,t,i,r,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var h3=!1,qS=null,ZS=!1,rR=null,fse={onError:function(n){h3=!0,qS=n}};function pse(n,e,t,i,r,s,o,a,l){h3=!1,qS=null,dse.apply(fse,arguments)}function mse(n,e,t,i,r,s,o,a,l){if(pse.apply(this,arguments),h3){if(h3){var c=qS;h3=!1,qS=null}else throw Error(Ft(198));ZS||(ZS=!0,rR=c)}}function l1(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function PG(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function _B(n){if(l1(n)!==n)throw Error(Ft(188))}function gse(n){var e=n.alternate;if(!e){if(e=l1(n),e===null)throw Error(Ft(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var s=r.alternate;if(s===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===s.child){for(s=r.child;s;){if(s===t)return _B(r),n;if(s===i)return _B(r),e;s=s.sibling}throw Error(Ft(188))}if(t.return!==i.return)t=r,i=s;else{for(var o=!1,a=r.child;a;){if(a===t){o=!0,t=r,i=s;break}if(a===i){o=!0,i=r,t=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===t){o=!0,t=s,i=r;break}if(a===i){o=!0,i=s,t=r;break}a=a.sibling}if(!o)throw Error(Ft(189))}}if(t.alternate!==i)throw Error(Ft(190))}if(t.tag!==3)throw Error(Ft(188));return t.stateNode.current===t?n:e}function kG(n){return n=gse(n),n!==null?LG(n):null}function LG(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=LG(n);if(e!==null)return e;n=n.sibling}return null}var DG=Al.unstable_scheduleCallback,wB=Al.unstable_cancelCallback,yse=Al.unstable_shouldYield,xse=Al.unstable_requestPaint,ts=Al.unstable_now,vse=Al.unstable_getCurrentPriorityLevel,dP=Al.unstable_ImmediatePriority,OG=Al.unstable_UserBlockingPriority,YS=Al.unstable_NormalPriority,bse=Al.unstable_LowPriority,BG=Al.unstable_IdlePriority,WE=null,ih=null;function _se(n){if(ih&&typeof ih.onCommitFiberRoot=="function")try{ih.onCommitFiberRoot(WE,n,void 0,(n.current.flags&128)===128)}catch{}}var ru=Math.clz32?Math.clz32:Ese,wse=Math.log,Sse=Math.LN2;function Ese(n){return n>>>=0,n===0?32:31-(wse(n)/Sse|0)|0}var $w=64,Gw=4194304;function Vv(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function XS(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,s=n.pingedLanes,o=t&268435455;if(o!==0){var a=o&~r;a!==0?i=Vv(a):(s&=o,s!==0&&(i=Vv(s)))}else o=t&~r,o!==0?i=Vv(o):s!==0&&(i=Vv(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,s=e&-e,r>=s||r===16&&(s&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-ru(e),r=1<<t,i|=n[t],e&=~r;return i}function Tse(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ase(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,s=n.pendingLanes;0<s;){var o=31-ru(s),a=1<<o,l=r[o];l===-1?(!(a&t)||a&i)&&(r[o]=Tse(a,e)):l<=e&&(n.expiredLanes|=a),s&=~a}}function sR(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function UG(){var n=$w;return $w<<=1,!($w&4194240)&&($w=64),n}function jT(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function a_(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ru(e),n[e]=t}function Cse(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-ru(t),s=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~s}}function fP(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-ru(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var Xi=0;function FG(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var zG,pP,jG,VG,HG,oR=!1,Ww=[],l0=null,c0=null,u0=null,F3=new Map,z3=new Map,jf=[],Mse="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function SB(n,e){switch(n){case"focusin":case"focusout":l0=null;break;case"dragenter":case"dragleave":c0=null;break;case"mouseover":case"mouseout":u0=null;break;case"pointerover":case"pointerout":F3.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":z3.delete(e.pointerId)}}function Qx(n,e,t,i,r,s){return n===null||n.nativeEvent!==s?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:s,targetContainers:[r]},e!==null&&(e=c_(e),e!==null&&pP(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function Rse(n,e,t,i,r){switch(e){case"focusin":return l0=Qx(l0,n,e,t,i,r),!0;case"dragenter":return c0=Qx(c0,n,e,t,i,r),!0;case"mouseover":return u0=Qx(u0,n,e,t,i,r),!0;case"pointerover":var s=r.pointerId;return F3.set(s,Qx(F3.get(s)||null,n,e,t,i,r)),!0;case"gotpointercapture":return s=r.pointerId,z3.set(s,Qx(z3.get(s)||null,n,e,t,i,r)),!0}return!1}function $G(n){var e=Qp(n.target);if(e!==null){var t=l1(e);if(t!==null){if(e=t.tag,e===13){if(e=PG(t),e!==null){n.blockedOn=e,HG(n.priority,function(){jG(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function X5(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=aR(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);tR=i,t.target.dispatchEvent(i),tR=null}else return e=c_(t),e!==null&&pP(e),n.blockedOn=t,!1;e.shift()}return!0}function EB(n,e,t){X5(n)&&t.delete(e)}function Ise(){oR=!1,l0!==null&&X5(l0)&&(l0=null),c0!==null&&X5(c0)&&(c0=null),u0!==null&&X5(u0)&&(u0=null),F3.forEach(EB),z3.forEach(EB)}function Jx(n,e){n.blockedOn===e&&(n.blockedOn=null,oR||(oR=!0,Al.unstable_scheduleCallback(Al.unstable_NormalPriority,Ise)))}function j3(n){function e(r){return Jx(r,n)}if(0<Ww.length){Jx(Ww[0],n);for(var t=1;t<Ww.length;t++){var i=Ww[t];i.blockedOn===n&&(i.blockedOn=null)}}for(l0!==null&&Jx(l0,n),c0!==null&&Jx(c0,n),u0!==null&&Jx(u0,n),F3.forEach(e),z3.forEach(e),t=0;t<jf.length;t++)i=jf[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<jf.length&&(t=jf[0],t.blockedOn===null);)$G(t),t.blockedOn===null&&jf.shift()}var vy=Bd.ReactCurrentBatchConfig,QS=!0;function Nse(n,e,t,i){var r=Xi,s=vy.transition;vy.transition=null;try{Xi=1,mP(n,e,t,i)}finally{Xi=r,vy.transition=s}}function Pse(n,e,t,i){var r=Xi,s=vy.transition;vy.transition=null;try{Xi=4,mP(n,e,t,i)}finally{Xi=r,vy.transition=s}}function mP(n,e,t,i){if(QS){var r=aR(n,e,t,i);if(r===null)XT(n,e,i,JS,t),SB(n,i);else if(Rse(r,n,e,t,i))i.stopPropagation();else if(SB(n,i),e&4&&-1<Mse.indexOf(n)){for(;r!==null;){var s=c_(r);if(s!==null&&zG(s),s=aR(n,e,t,i),s===null&&XT(n,e,i,JS,t),s===r)break;r=s}r!==null&&i.stopPropagation()}else XT(n,e,i,null,t)}}var JS=null;function aR(n,e,t,i){if(JS=null,n=hP(i),n=Qp(n),n!==null)if(e=l1(n),e===null)n=null;else if(t=e.tag,t===13){if(n=PG(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return JS=n,null}function GG(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(vse()){case dP:return 1;case OG:return 4;case YS:case bse:return 16;case BG:return 536870912;default:return 16}default:return 16}}var Kf=null,gP=null,Q5=null;function WG(){if(Q5)return Q5;var n,e=gP,t=e.length,i,r="value"in Kf?Kf.value:Kf.textContent,s=r.length;for(n=0;n<t&&e[n]===r[n];n++);var o=t-n;for(i=1;i<=o&&e[t-i]===r[s-i];i++);return Q5=r.slice(n,1<i?1-i:void 0)}function J5(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Kw(){return!0}function TB(){return!1}function Ml(n){function e(t,i,r,s,o){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Kw:TB,this.isPropagationStopped=TB,this}return jr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Kw)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Kw)},persist:function(){},isPersistent:Kw}),e}var tx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yP=Ml(tx),l_=jr({},tx,{view:0,detail:0}),kse=Ml(l_),VT,HT,ev,KE=jr({},l_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xP,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ev&&(ev&&n.type==="mousemove"?(VT=n.screenX-ev.screenX,HT=n.screenY-ev.screenY):HT=VT=0,ev=n),VT)},movementY:function(n){return"movementY"in n?n.movementY:HT}}),AB=Ml(KE),Lse=jr({},KE,{dataTransfer:0}),Dse=Ml(Lse),Ose=jr({},l_,{relatedTarget:0}),$T=Ml(Ose),Bse=jr({},tx,{animationName:0,elapsedTime:0,pseudoElement:0}),Use=Ml(Bse),Fse=jr({},tx,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),zse=Ml(Fse),jse=jr({},tx,{data:0}),CB=Ml(jse),Vse={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hse={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$se={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Gse(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=$se[n])?!!e[n]:!1}function xP(){return Gse}var Wse=jr({},l_,{key:function(n){if(n.key){var e=Vse[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=J5(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Hse[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xP,charCode:function(n){return n.type==="keypress"?J5(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?J5(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Kse=Ml(Wse),qse=jr({},KE,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),MB=Ml(qse),Zse=jr({},l_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xP}),Yse=Ml(Zse),Xse=jr({},tx,{propertyName:0,elapsedTime:0,pseudoElement:0}),Qse=Ml(Xse),Jse=jr({},KE,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),eoe=Ml(Jse),toe=[9,13,27,32],vP=Md&&"CompositionEvent"in window,d3=null;Md&&"documentMode"in document&&(d3=document.documentMode);var noe=Md&&"TextEvent"in window&&!d3,KG=Md&&(!vP||d3&&8<d3&&11>=d3),RB=String.fromCharCode(32),IB=!1;function qG(n,e){switch(n){case"keyup":return toe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ZG(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Gg=!1;function ioe(n,e){switch(n){case"compositionend":return ZG(e);case"keypress":return e.which!==32?null:(IB=!0,RB);case"textInput":return n=e.data,n===RB&&IB?null:n;default:return null}}function roe(n,e){if(Gg)return n==="compositionend"||!vP&&qG(n,e)?(n=WG(),Q5=gP=Kf=null,Gg=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return KG&&e.locale!=="ko"?null:e.data;default:return null}}var soe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function NB(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!soe[n.type]:e==="textarea"}function YG(n,e,t,i){CG(i),e=e6(e,"onChange"),0<e.length&&(t=new yP("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var f3=null,V3=null;function ooe(n){aW(n,0)}function qE(n){var e=qg(n);if(bG(e))return n}function aoe(n,e){if(n==="change")return e}var XG=!1;if(Md){var GT;if(Md){var WT="oninput"in document;if(!WT){var PB=document.createElement("div");PB.setAttribute("oninput","return;"),WT=typeof PB.oninput=="function"}GT=WT}else GT=!1;XG=GT&&(!document.documentMode||9<document.documentMode)}function kB(){f3&&(f3.detachEvent("onpropertychange",QG),V3=f3=null)}function QG(n){if(n.propertyName==="value"&&qE(V3)){var e=[];YG(e,V3,n,hP(n)),NG(ooe,e)}}function loe(n,e,t){n==="focusin"?(kB(),f3=e,V3=t,f3.attachEvent("onpropertychange",QG)):n==="focusout"&&kB()}function coe(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return qE(V3)}function uoe(n,e){if(n==="click")return qE(e)}function hoe(n,e){if(n==="input"||n==="change")return qE(e)}function doe(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var uu=typeof Object.is=="function"?Object.is:doe;function H3(n,e){if(uu(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!HM.call(e,r)||!uu(n[r],e[r]))return!1}return!0}function LB(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function DB(n,e){var t=LB(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=LB(t)}}function JG(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?JG(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function eW(){for(var n=window,e=KS();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=KS(n.document)}return e}function bP(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function foe(n){var e=eW(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&JG(t.ownerDocument.documentElement,t)){if(i!==null&&bP(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,s=Math.min(i.start,r);i=i.end===void 0?s:Math.min(i.end,r),!n.extend&&s>i&&(r=i,i=s,s=r),r=DB(t,s);var o=DB(t,i);r&&o&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),s>i?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var poe=Md&&"documentMode"in document&&11>=document.documentMode,Wg=null,lR=null,p3=null,cR=!1;function OB(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;cR||Wg==null||Wg!==KS(i)||(i=Wg,"selectionStart"in i&&bP(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),p3&&H3(p3,i)||(p3=i,i=e6(lR,"onSelect"),0<i.length&&(e=new yP("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Wg)))}function qw(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Kg={animationend:qw("Animation","AnimationEnd"),animationiteration:qw("Animation","AnimationIteration"),animationstart:qw("Animation","AnimationStart"),transitionend:qw("Transition","TransitionEnd")},KT={},tW={};Md&&(tW=document.createElement("div").style,"AnimationEvent"in window||(delete Kg.animationend.animation,delete Kg.animationiteration.animation,delete Kg.animationstart.animation),"TransitionEvent"in window||delete Kg.transitionend.transition);function ZE(n){if(KT[n])return KT[n];if(!Kg[n])return n;var e=Kg[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in tW)return KT[n]=e[t];return n}var nW=ZE("animationend"),iW=ZE("animationiteration"),rW=ZE("animationstart"),sW=ZE("transitionend"),oW=new Map,BB="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function B0(n,e){oW.set(n,e),a1(e,[n])}for(var qT=0;qT<BB.length;qT++){var ZT=BB[qT],moe=ZT.toLowerCase(),goe=ZT[0].toUpperCase()+ZT.slice(1);B0(moe,"on"+goe)}B0(nW,"onAnimationEnd");B0(iW,"onAnimationIteration");B0(rW,"onAnimationStart");B0("dblclick","onDoubleClick");B0("focusin","onFocus");B0("focusout","onBlur");B0(sW,"onTransitionEnd");o2("onMouseEnter",["mouseout","mouseover"]);o2("onMouseLeave",["mouseout","mouseover"]);o2("onPointerEnter",["pointerout","pointerover"]);o2("onPointerLeave",["pointerout","pointerover"]);a1("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));a1("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));a1("onBeforeInput",["compositionend","keypress","textInput","paste"]);a1("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));a1("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));a1("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),yoe=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hv));function UB(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,mse(i,e,void 0,n),n.currentTarget=null}function aW(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&r.isPropagationStopped())break e;UB(r,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&r.isPropagationStopped())break e;UB(r,a,c),s=l}}}if(ZS)throw n=rR,ZS=!1,rR=null,n}function Er(n,e){var t=e[pR];t===void 0&&(t=e[pR]=new Set);var i=n+"__bubble";t.has(i)||(lW(e,n,2,!1),t.add(i))}function YT(n,e,t){var i=0;e&&(i|=4),lW(t,n,i,e)}var Zw="_reactListening"+Math.random().toString(36).slice(2);function $3(n){if(!n[Zw]){n[Zw]=!0,mG.forEach(function(t){t!=="selectionchange"&&(yoe.has(t)||YT(t,!1,n),YT(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Zw]||(e[Zw]=!0,YT("selectionchange",!1,e))}}function lW(n,e,t,i){switch(GG(e)){case 1:var r=Nse;break;case 4:r=Pse;break;default:r=mP}t=r.bind(null,e,t,n),r=void 0,!iR||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function XT(n,e,t,i,r){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;o=o.return}for(;a!==null;){if(o=Qp(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}NG(function(){var c=s,u=hP(t),h=[];e:{var p=oW.get(n);if(p!==void 0){var m=yP,y=n;switch(n){case"keypress":if(J5(t)===0)break e;case"keydown":case"keyup":m=Kse;break;case"focusin":y="focus",m=$T;break;case"focusout":y="blur",m=$T;break;case"beforeblur":case"afterblur":m=$T;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=AB;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=Dse;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=Yse;break;case nW:case iW:case rW:m=Use;break;case sW:m=Qse;break;case"scroll":m=kse;break;case"wheel":m=eoe;break;case"copy":case"cut":case"paste":m=zse;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=MB}var b=(e&4)!==0,w=!b&&n==="scroll",v=b?p!==null?p+"Capture":null:p;b=[];for(var T=c,S;T!==null;){S=T;var M=S.stateNode;if(S.tag===5&&M!==null&&(S=M,v!==null&&(M=U3(T,v),M!=null&&b.push(G3(T,M,S)))),w)break;T=T.return}0<b.length&&(p=new m(p,y,null,t,u),h.push({event:p,listeners:b}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",p&&t!==tR&&(y=t.relatedTarget||t.fromElement)&&(Qp(y)||y[Rd]))break e;if((m||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,m?(y=t.relatedTarget||t.toElement,m=c,y=y?Qp(y):null,y!==null&&(w=l1(y),y!==w||y.tag!==5&&y.tag!==6)&&(y=null)):(m=null,y=c),m!==y)){if(b=AB,M="onMouseLeave",v="onMouseEnter",T="mouse",(n==="pointerout"||n==="pointerover")&&(b=MB,M="onPointerLeave",v="onPointerEnter",T="pointer"),w=m==null?p:qg(m),S=y==null?p:qg(y),p=new b(M,T+"leave",m,t,u),p.target=w,p.relatedTarget=S,M=null,Qp(u)===c&&(b=new b(v,T+"enter",y,t,u),b.target=S,b.relatedTarget=w,M=b),w=M,m&&y)t:{for(b=m,v=y,T=0,S=b;S;S=Z1(S))T++;for(S=0,M=v;M;M=Z1(M))S++;for(;0<T-S;)b=Z1(b),T--;for(;0<S-T;)v=Z1(v),S--;for(;T--;){if(b===v||v!==null&&b===v.alternate)break t;b=Z1(b),v=Z1(v)}b=null}else b=null;m!==null&&FB(h,p,m,b,!1),y!==null&&w!==null&&FB(h,w,y,b,!0)}}e:{if(p=c?qg(c):window,m=p.nodeName&&p.nodeName.toLowerCase(),m==="select"||m==="input"&&p.type==="file")var P=aoe;else if(NB(p))if(XG)P=hoe;else{P=coe;var R=loe}else(m=p.nodeName)&&m.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(P=uoe);if(P&&(P=P(n,c))){YG(h,P,t,u);break e}R&&R(n,p,c),n==="focusout"&&(R=p._wrapperState)&&R.controlled&&p.type==="number"&&YM(p,"number",p.value)}switch(R=c?qg(c):window,n){case"focusin":(NB(R)||R.contentEditable==="true")&&(Wg=R,lR=c,p3=null);break;case"focusout":p3=lR=Wg=null;break;case"mousedown":cR=!0;break;case"contextmenu":case"mouseup":case"dragend":cR=!1,OB(h,t,u);break;case"selectionchange":if(poe)break;case"keydown":case"keyup":OB(h,t,u)}var O;if(vP)e:{switch(n){case"compositionstart":var B="onCompositionStart";break e;case"compositionend":B="onCompositionEnd";break e;case"compositionupdate":B="onCompositionUpdate";break e}B=void 0}else Gg?qG(n,t)&&(B="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(B="onCompositionStart");B&&(KG&&t.locale!=="ko"&&(Gg||B!=="onCompositionStart"?B==="onCompositionEnd"&&Gg&&(O=WG()):(Kf=u,gP="value"in Kf?Kf.value:Kf.textContent,Gg=!0)),R=e6(c,B),0<R.length&&(B=new CB(B,n,null,t,u),h.push({event:B,listeners:R}),O?B.data=O:(O=ZG(t),O!==null&&(B.data=O)))),(O=noe?ioe(n,t):roe(n,t))&&(c=e6(c,"onBeforeInput"),0<c.length&&(u=new CB("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:c}),u.data=O))}aW(h,e)})}function G3(n,e,t){return{instance:n,listener:e,currentTarget:t}}function e6(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,s=r.stateNode;r.tag===5&&s!==null&&(r=s,s=U3(n,t),s!=null&&i.unshift(G3(n,s,r)),s=U3(n,e),s!=null&&i.push(G3(n,s,r))),n=n.return}return i}function Z1(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function FB(n,e,t,i,r){for(var s=e._reactName,o=[];t!==null&&t!==i;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,r?(l=U3(t,s),l!=null&&o.unshift(G3(t,l,a))):r||(l=U3(t,s),l!=null&&o.push(G3(t,l,a)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var xoe=/\r\n?/g,voe=/\u0000|\uFFFD/g;function zB(n){return(typeof n=="string"?n:""+n).replace(xoe,`
`).replace(voe,"")}function Yw(n,e,t){if(e=zB(e),zB(n)!==e&&t)throw Error(Ft(425))}function t6(){}var uR=null,hR=null;function dR(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var fR=typeof setTimeout=="function"?setTimeout:void 0,boe=typeof clearTimeout=="function"?clearTimeout:void 0,jB=typeof Promise=="function"?Promise:void 0,_oe=typeof queueMicrotask=="function"?queueMicrotask:typeof jB<"u"?function(n){return jB.resolve(null).then(n).catch(woe)}:fR;function woe(n){setTimeout(function(){throw n})}function QT(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),j3(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);j3(e)}function h0(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function VB(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var nx=Math.random().toString(36).slice(2),Wu="__reactFiber$"+nx,W3="__reactProps$"+nx,Rd="__reactContainer$"+nx,pR="__reactEvents$"+nx,Soe="__reactListeners$"+nx,Eoe="__reactHandles$"+nx;function Qp(n){var e=n[Wu];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Rd]||t[Wu]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=VB(n);n!==null;){if(t=n[Wu])return t;n=VB(n)}return e}n=t,t=n.parentNode}return null}function c_(n){return n=n[Wu]||n[Rd],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function qg(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Ft(33))}function YE(n){return n[W3]||null}var mR=[],Zg=-1;function U0(n){return{current:n}}function Rr(n){0>Zg||(n.current=mR[Zg],mR[Zg]=null,Zg--)}function _r(n,e){Zg++,mR[Zg]=n.current,n.current=e}var E0={},zo=U0(E0),Wa=U0(!1),Bm=E0;function a2(n,e){var t=n.type.contextTypes;if(!t)return E0;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},s;for(s in t)r[s]=e[s];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function Ka(n){return n=n.childContextTypes,n!=null}function n6(){Rr(Wa),Rr(zo)}function HB(n,e,t){if(zo.current!==E0)throw Error(Ft(168));_r(zo,e),_r(Wa,t)}function cW(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(Ft(108,lse(n)||"Unknown",r));return jr({},t,i)}function i6(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||E0,Bm=zo.current,_r(zo,n),_r(Wa,Wa.current),!0}function $B(n,e,t){var i=n.stateNode;if(!i)throw Error(Ft(169));t?(n=cW(n,e,Bm),i.__reactInternalMemoizedMergedChildContext=n,Rr(Wa),Rr(zo),_r(zo,n)):Rr(Wa),_r(Wa,t)}var ed=null,XE=!1,JT=!1;function uW(n){ed===null?ed=[n]:ed.push(n)}function Toe(n){XE=!0,uW(n)}function F0(){if(!JT&&ed!==null){JT=!0;var n=0,e=Xi;try{var t=ed;for(Xi=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}ed=null,XE=!1}catch(r){throw ed!==null&&(ed=ed.slice(n+1)),DG(dP,F0),r}finally{Xi=e,JT=!1}}return null}var Yg=[],Xg=0,r6=null,s6=0,Jl=[],ec=0,Um=null,pd=1,md="";function zp(n,e){Yg[Xg++]=s6,Yg[Xg++]=r6,r6=n,s6=e}function hW(n,e,t){Jl[ec++]=pd,Jl[ec++]=md,Jl[ec++]=Um,Um=n;var i=pd;n=md;var r=32-ru(i)-1;i&=~(1<<r),t+=1;var s=32-ru(e)+r;if(30<s){var o=r-r%5;s=(i&(1<<o)-1).toString(32),i>>=o,r-=o,pd=1<<32-ru(e)+r|t<<r|i,md=s+n}else pd=1<<s|t<<r|i,md=n}function _P(n){n.return!==null&&(zp(n,1),hW(n,1,0))}function wP(n){for(;n===r6;)r6=Yg[--Xg],Yg[Xg]=null,s6=Yg[--Xg],Yg[Xg]=null;for(;n===Um;)Um=Jl[--ec],Jl[ec]=null,md=Jl[--ec],Jl[ec]=null,pd=Jl[--ec],Jl[ec]=null}var El=null,_l=null,kr=!1,Yc=null;function dW(n,e){var t=sc(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function GB(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,El=n,_l=h0(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,El=n,_l=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Um!==null?{id:pd,overflow:md}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=sc(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,El=n,_l=null,!0):!1;default:return!1}}function gR(n){return(n.mode&1)!==0&&(n.flags&128)===0}function yR(n){if(kr){var e=_l;if(e){var t=e;if(!GB(n,e)){if(gR(n))throw Error(Ft(418));e=h0(t.nextSibling);var i=El;e&&GB(n,e)?dW(i,t):(n.flags=n.flags&-4097|2,kr=!1,El=n)}}else{if(gR(n))throw Error(Ft(418));n.flags=n.flags&-4097|2,kr=!1,El=n}}}function WB(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;El=n}function Xw(n){if(n!==El)return!1;if(!kr)return WB(n),kr=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!dR(n.type,n.memoizedProps)),e&&(e=_l)){if(gR(n))throw fW(),Error(Ft(418));for(;e;)dW(n,e),e=h0(e.nextSibling)}if(WB(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Ft(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){_l=h0(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}_l=null}}else _l=El?h0(n.stateNode.nextSibling):null;return!0}function fW(){for(var n=_l;n;)n=h0(n.nextSibling)}function l2(){_l=El=null,kr=!1}function SP(n){Yc===null?Yc=[n]:Yc.push(n)}var Aoe=Bd.ReactCurrentBatchConfig;function tv(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Ft(309));var i=t.stateNode}if(!i)throw Error(Ft(147,n));var r=i,s=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=r.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof n!="string")throw Error(Ft(284));if(!t._owner)throw Error(Ft(290,n))}return n}function Qw(n,e){throw n=Object.prototype.toString.call(e),Error(Ft(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function KB(n){var e=n._init;return e(n._payload)}function pW(n){function e(v,T){if(n){var S=v.deletions;S===null?(v.deletions=[T],v.flags|=16):S.push(T)}}function t(v,T){if(!n)return null;for(;T!==null;)e(v,T),T=T.sibling;return null}function i(v,T){for(v=new Map;T!==null;)T.key!==null?v.set(T.key,T):v.set(T.index,T),T=T.sibling;return v}function r(v,T){return v=m0(v,T),v.index=0,v.sibling=null,v}function s(v,T,S){return v.index=S,n?(S=v.alternate,S!==null?(S=S.index,S<T?(v.flags|=2,T):S):(v.flags|=2,T)):(v.flags|=1048576,T)}function o(v){return n&&v.alternate===null&&(v.flags|=2),v}function a(v,T,S,M){return T===null||T.tag!==6?(T=oA(S,v.mode,M),T.return=v,T):(T=r(T,S),T.return=v,T)}function l(v,T,S,M){var P=S.type;return P===$g?u(v,T,S.props.children,M,S.key):T!==null&&(T.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Df&&KB(P)===T.type)?(M=r(T,S.props),M.ref=tv(v,T,S),M.return=v,M):(M=oS(S.type,S.key,S.props,null,v.mode,M),M.ref=tv(v,T,S),M.return=v,M)}function c(v,T,S,M){return T===null||T.tag!==4||T.stateNode.containerInfo!==S.containerInfo||T.stateNode.implementation!==S.implementation?(T=aA(S,v.mode,M),T.return=v,T):(T=r(T,S.children||[]),T.return=v,T)}function u(v,T,S,M,P){return T===null||T.tag!==7?(T=Sm(S,v.mode,M,P),T.return=v,T):(T=r(T,S),T.return=v,T)}function h(v,T,S){if(typeof T=="string"&&T!==""||typeof T=="number")return T=oA(""+T,v.mode,S),T.return=v,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case jw:return S=oS(T.type,T.key,T.props,null,v.mode,S),S.ref=tv(v,null,T),S.return=v,S;case Hg:return T=aA(T,v.mode,S),T.return=v,T;case Df:var M=T._init;return h(v,M(T._payload),S)}if(jv(T)||Yx(T))return T=Sm(T,v.mode,S,null),T.return=v,T;Qw(v,T)}return null}function p(v,T,S,M){var P=T!==null?T.key:null;if(typeof S=="string"&&S!==""||typeof S=="number")return P!==null?null:a(v,T,""+S,M);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case jw:return S.key===P?l(v,T,S,M):null;case Hg:return S.key===P?c(v,T,S,M):null;case Df:return P=S._init,p(v,T,P(S._payload),M)}if(jv(S)||Yx(S))return P!==null?null:u(v,T,S,M,null);Qw(v,S)}return null}function m(v,T,S,M,P){if(typeof M=="string"&&M!==""||typeof M=="number")return v=v.get(S)||null,a(T,v,""+M,P);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case jw:return v=v.get(M.key===null?S:M.key)||null,l(T,v,M,P);case Hg:return v=v.get(M.key===null?S:M.key)||null,c(T,v,M,P);case Df:var R=M._init;return m(v,T,S,R(M._payload),P)}if(jv(M)||Yx(M))return v=v.get(S)||null,u(T,v,M,P,null);Qw(T,M)}return null}function y(v,T,S,M){for(var P=null,R=null,O=T,B=T=0,N=null;O!==null&&B<S.length;B++){O.index>B?(N=O,O=null):N=O.sibling;var I=p(v,O,S[B],M);if(I===null){O===null&&(O=N);break}n&&O&&I.alternate===null&&e(v,O),T=s(I,T,B),R===null?P=I:R.sibling=I,R=I,O=N}if(B===S.length)return t(v,O),kr&&zp(v,B),P;if(O===null){for(;B<S.length;B++)O=h(v,S[B],M),O!==null&&(T=s(O,T,B),R===null?P=O:R.sibling=O,R=O);return kr&&zp(v,B),P}for(O=i(v,O);B<S.length;B++)N=m(O,v,B,S[B],M),N!==null&&(n&&N.alternate!==null&&O.delete(N.key===null?B:N.key),T=s(N,T,B),R===null?P=N:R.sibling=N,R=N);return n&&O.forEach(function(F){return e(v,F)}),kr&&zp(v,B),P}function b(v,T,S,M){var P=Yx(S);if(typeof P!="function")throw Error(Ft(150));if(S=P.call(S),S==null)throw Error(Ft(151));for(var R=P=null,O=T,B=T=0,N=null,I=S.next();O!==null&&!I.done;B++,I=S.next()){O.index>B?(N=O,O=null):N=O.sibling;var F=p(v,O,I.value,M);if(F===null){O===null&&(O=N);break}n&&O&&F.alternate===null&&e(v,O),T=s(F,T,B),R===null?P=F:R.sibling=F,R=F,O=N}if(I.done)return t(v,O),kr&&zp(v,B),P;if(O===null){for(;!I.done;B++,I=S.next())I=h(v,I.value,M),I!==null&&(T=s(I,T,B),R===null?P=I:R.sibling=I,R=I);return kr&&zp(v,B),P}for(O=i(v,O);!I.done;B++,I=S.next())I=m(O,v,B,I.value,M),I!==null&&(n&&I.alternate!==null&&O.delete(I.key===null?B:I.key),T=s(I,T,B),R===null?P=I:R.sibling=I,R=I);return n&&O.forEach(function(j){return e(v,j)}),kr&&zp(v,B),P}function w(v,T,S,M){if(typeof S=="object"&&S!==null&&S.type===$g&&S.key===null&&(S=S.props.children),typeof S=="object"&&S!==null){switch(S.$$typeof){case jw:e:{for(var P=S.key,R=T;R!==null;){if(R.key===P){if(P=S.type,P===$g){if(R.tag===7){t(v,R.sibling),T=r(R,S.props.children),T.return=v,v=T;break e}}else if(R.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Df&&KB(P)===R.type){t(v,R.sibling),T=r(R,S.props),T.ref=tv(v,R,S),T.return=v,v=T;break e}t(v,R);break}else e(v,R);R=R.sibling}S.type===$g?(T=Sm(S.props.children,v.mode,M,S.key),T.return=v,v=T):(M=oS(S.type,S.key,S.props,null,v.mode,M),M.ref=tv(v,T,S),M.return=v,v=M)}return o(v);case Hg:e:{for(R=S.key;T!==null;){if(T.key===R)if(T.tag===4&&T.stateNode.containerInfo===S.containerInfo&&T.stateNode.implementation===S.implementation){t(v,T.sibling),T=r(T,S.children||[]),T.return=v,v=T;break e}else{t(v,T);break}else e(v,T);T=T.sibling}T=aA(S,v.mode,M),T.return=v,v=T}return o(v);case Df:return R=S._init,w(v,T,R(S._payload),M)}if(jv(S))return y(v,T,S,M);if(Yx(S))return b(v,T,S,M);Qw(v,S)}return typeof S=="string"&&S!==""||typeof S=="number"?(S=""+S,T!==null&&T.tag===6?(t(v,T.sibling),T=r(T,S),T.return=v,v=T):(t(v,T),T=oA(S,v.mode,M),T.return=v,v=T),o(v)):t(v,T)}return w}var c2=pW(!0),mW=pW(!1),o6=U0(null),a6=null,Qg=null,EP=null;function TP(){EP=Qg=a6=null}function AP(n){var e=o6.current;Rr(o6),n._currentValue=e}function xR(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function by(n,e){a6=n,EP=Qg=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(za=!0),n.firstContext=null)}function mc(n){var e=n._currentValue;if(EP!==n)if(n={context:n,memoizedValue:e,next:null},Qg===null){if(a6===null)throw Error(Ft(308));Qg=n,a6.dependencies={lanes:0,firstContext:n}}else Qg=Qg.next=n;return e}var Jp=null;function CP(n){Jp===null?Jp=[n]:Jp.push(n)}function gW(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,CP(e)):(t.next=r.next,r.next=t),e.interleaved=t,Id(n,i)}function Id(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Of=!1;function MP(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yW(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function bd(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function d0(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,Ri&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,Id(n,t)}return r=i.interleaved,r===null?(e.next=e,CP(i)):(e.next=r.next,r.next=e),i.interleaved=e,Id(n,t)}function eS(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,fP(n,t)}}function qB(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,s=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};s===null?r=s=o:s=s.next=o,t=t.next}while(t!==null);s===null?r=s=e:s=s.next=e}else r=s=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:s,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function l6(n,e,t,i){var r=n.updateQueue;Of=!1;var s=r.firstBaseUpdate,o=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=r.baseState;o=0,u=c=l=null,a=s;do{var p=a.lane,m=a.eventTime;if((i&p)===p){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var y=n,b=a;switch(p=e,m=t,b.tag){case 1:if(y=b.payload,typeof y=="function"){h=y.call(m,h,p);break e}h=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=b.payload,p=typeof y=="function"?y.call(m,h,p):y,p==null)break e;h=jr({},h,p);break e;case 2:Of=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,p=r.effects,p===null?r.effects=[a]:p.push(a))}else m={eventTime:m,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,o|=p;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;p=a,a=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(u===null&&(l=h),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else s===null&&(r.shared.lanes=0);zm|=o,n.lanes=o,n.memoizedState=h}}function ZB(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(Ft(191,r));r.call(i)}}}var u_={},rh=U0(u_),K3=U0(u_),q3=U0(u_);function em(n){if(n===u_)throw Error(Ft(174));return n}function RP(n,e){switch(_r(q3,e),_r(K3,n),_r(rh,u_),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:QM(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=QM(e,n)}Rr(rh),_r(rh,e)}function u2(){Rr(rh),Rr(K3),Rr(q3)}function xW(n){em(q3.current);var e=em(rh.current),t=QM(e,n.type);e!==t&&(_r(K3,n),_r(rh,t))}function IP(n){K3.current===n&&(Rr(rh),Rr(K3))}var Ur=U0(0);function c6(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var eA=[];function NP(){for(var n=0;n<eA.length;n++)eA[n]._workInProgressVersionPrimary=null;eA.length=0}var tS=Bd.ReactCurrentDispatcher,tA=Bd.ReactCurrentBatchConfig,Fm=0,zr=null,Es=null,Fs=null,u6=!1,m3=!1,Z3=0,Coe=0;function mo(){throw Error(Ft(321))}function PP(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!uu(n[t],e[t]))return!1;return!0}function kP(n,e,t,i,r,s){if(Fm=s,zr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,tS.current=n===null||n.memoizedState===null?Noe:Poe,n=t(i,r),m3){s=0;do{if(m3=!1,Z3=0,25<=s)throw Error(Ft(301));s+=1,Fs=Es=null,e.updateQueue=null,tS.current=koe,n=t(i,r)}while(m3)}if(tS.current=h6,e=Es!==null&&Es.next!==null,Fm=0,Fs=Es=zr=null,u6=!1,e)throw Error(Ft(300));return n}function LP(){var n=Z3!==0;return Z3=0,n}function ku(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Fs===null?zr.memoizedState=Fs=n:Fs=Fs.next=n,Fs}function gc(){if(Es===null){var n=zr.alternate;n=n!==null?n.memoizedState:null}else n=Es.next;var e=Fs===null?zr.memoizedState:Fs.next;if(e!==null)Fs=e,Es=n;else{if(n===null)throw Error(Ft(310));Es=n,n={memoizedState:Es.memoizedState,baseState:Es.baseState,baseQueue:Es.baseQueue,queue:Es.queue,next:null},Fs===null?zr.memoizedState=Fs=n:Fs=Fs.next=n}return Fs}function Y3(n,e){return typeof e=="function"?e(n):e}function nA(n){var e=gc(),t=e.queue;if(t===null)throw Error(Ft(311));t.lastRenderedReducer=n;var i=Es,r=i.baseQueue,s=t.pending;if(s!==null){if(r!==null){var o=r.next;r.next=s.next,s.next=o}i.baseQueue=r=s,t.pending=null}if(r!==null){s=r.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Fm&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:n(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,zr.lanes|=u,zm|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,uu(i,e.memoizedState)||(za=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do s=r.lane,zr.lanes|=s,zm|=s,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function iA(n){var e=gc(),t=e.queue;if(t===null)throw Error(Ft(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,s=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do s=n(s,o.action),o=o.next;while(o!==r);uu(s,e.memoizedState)||(za=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),t.lastRenderedState=s}return[s,i]}function vW(){}function bW(n,e){var t=zr,i=gc(),r=e(),s=!uu(i.memoizedState,r);if(s&&(i.memoizedState=r,za=!0),i=i.queue,DP(SW.bind(null,t,i,n),[n]),i.getSnapshot!==e||s||Fs!==null&&Fs.memoizedState.tag&1){if(t.flags|=2048,X3(9,wW.bind(null,t,i,r,e),void 0,null),js===null)throw Error(Ft(349));Fm&30||_W(t,e,r)}return r}function _W(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=zr.updateQueue,e===null?(e={lastEffect:null,stores:null},zr.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function wW(n,e,t,i){e.value=t,e.getSnapshot=i,EW(e)&&TW(n)}function SW(n,e,t){return t(function(){EW(e)&&TW(n)})}function EW(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!uu(n,t)}catch{return!0}}function TW(n){var e=Id(n,1);e!==null&&su(e,n,1,-1)}function YB(n){var e=ku();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Y3,lastRenderedState:n},e.queue=n,n=n.dispatch=Ioe.bind(null,zr,n),[e.memoizedState,n]}function X3(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=zr.updateQueue,e===null?(e={lastEffect:null,stores:null},zr.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function AW(){return gc().memoizedState}function nS(n,e,t,i){var r=ku();zr.flags|=n,r.memoizedState=X3(1|e,t,void 0,i===void 0?null:i)}function QE(n,e,t,i){var r=gc();i=i===void 0?null:i;var s=void 0;if(Es!==null){var o=Es.memoizedState;if(s=o.destroy,i!==null&&PP(i,o.deps)){r.memoizedState=X3(e,t,s,i);return}}zr.flags|=n,r.memoizedState=X3(1|e,t,s,i)}function XB(n,e){return nS(8390656,8,n,e)}function DP(n,e){return QE(2048,8,n,e)}function CW(n,e){return QE(4,2,n,e)}function MW(n,e){return QE(4,4,n,e)}function RW(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function IW(n,e,t){return t=t!=null?t.concat([n]):null,QE(4,4,RW.bind(null,e,n),t)}function OP(){}function NW(n,e){var t=gc();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&PP(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function PW(n,e){var t=gc();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&PP(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function kW(n,e,t){return Fm&21?(uu(t,e)||(t=UG(),zr.lanes|=t,zm|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,za=!0),n.memoizedState=t)}function Moe(n,e){var t=Xi;Xi=t!==0&&4>t?t:4,n(!0);var i=tA.transition;tA.transition={};try{n(!1),e()}finally{Xi=t,tA.transition=i}}function LW(){return gc().memoizedState}function Roe(n,e,t){var i=p0(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},DW(n))OW(e,t);else if(t=gW(n,e,t,i),t!==null){var r=da();su(t,n,i,r),BW(t,e,i)}}function Ioe(n,e,t){var i=p0(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(DW(n))OW(e,r);else{var s=n.alternate;if(n.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,t);if(r.hasEagerState=!0,r.eagerState=a,uu(a,o)){var l=e.interleaved;l===null?(r.next=r,CP(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}t=gW(n,e,r,i),t!==null&&(r=da(),su(t,n,i,r),BW(t,e,i))}}function DW(n){var e=n.alternate;return n===zr||e!==null&&e===zr}function OW(n,e){m3=u6=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function BW(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,fP(n,t)}}var h6={readContext:mc,useCallback:mo,useContext:mo,useEffect:mo,useImperativeHandle:mo,useInsertionEffect:mo,useLayoutEffect:mo,useMemo:mo,useReducer:mo,useRef:mo,useState:mo,useDebugValue:mo,useDeferredValue:mo,useTransition:mo,useMutableSource:mo,useSyncExternalStore:mo,useId:mo,unstable_isNewReconciler:!1},Noe={readContext:mc,useCallback:function(n,e){return ku().memoizedState=[n,e===void 0?null:e],n},useContext:mc,useEffect:XB,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,nS(4194308,4,RW.bind(null,e,n),t)},useLayoutEffect:function(n,e){return nS(4194308,4,n,e)},useInsertionEffect:function(n,e){return nS(4,2,n,e)},useMemo:function(n,e){var t=ku();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=ku();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=Roe.bind(null,zr,n),[i.memoizedState,n]},useRef:function(n){var e=ku();return n={current:n},e.memoizedState=n},useState:YB,useDebugValue:OP,useDeferredValue:function(n){return ku().memoizedState=n},useTransition:function(){var n=YB(!1),e=n[0];return n=Moe.bind(null,n[1]),ku().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=zr,r=ku();if(kr){if(t===void 0)throw Error(Ft(407));t=t()}else{if(t=e(),js===null)throw Error(Ft(349));Fm&30||_W(i,e,t)}r.memoizedState=t;var s={value:t,getSnapshot:e};return r.queue=s,XB(SW.bind(null,i,s,n),[n]),i.flags|=2048,X3(9,wW.bind(null,i,s,t,e),void 0,null),t},useId:function(){var n=ku(),e=js.identifierPrefix;if(kr){var t=md,i=pd;t=(i&~(1<<32-ru(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=Z3++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=Coe++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},Poe={readContext:mc,useCallback:NW,useContext:mc,useEffect:DP,useImperativeHandle:IW,useInsertionEffect:CW,useLayoutEffect:MW,useMemo:PW,useReducer:nA,useRef:AW,useState:function(){return nA(Y3)},useDebugValue:OP,useDeferredValue:function(n){var e=gc();return kW(e,Es.memoizedState,n)},useTransition:function(){var n=nA(Y3)[0],e=gc().memoizedState;return[n,e]},useMutableSource:vW,useSyncExternalStore:bW,useId:LW,unstable_isNewReconciler:!1},koe={readContext:mc,useCallback:NW,useContext:mc,useEffect:DP,useImperativeHandle:IW,useInsertionEffect:CW,useLayoutEffect:MW,useMemo:PW,useReducer:iA,useRef:AW,useState:function(){return iA(Y3)},useDebugValue:OP,useDeferredValue:function(n){var e=gc();return Es===null?e.memoizedState=n:kW(e,Es.memoizedState,n)},useTransition:function(){var n=iA(Y3)[0],e=gc().memoizedState;return[n,e]},useMutableSource:vW,useSyncExternalStore:bW,useId:LW,unstable_isNewReconciler:!1};function Vc(n,e){if(n&&n.defaultProps){e=jr({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function vR(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:jr({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var JE={isMounted:function(n){return(n=n._reactInternals)?l1(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=da(),r=p0(n),s=bd(i,r);s.payload=e,t!=null&&(s.callback=t),e=d0(n,s,r),e!==null&&(su(e,n,r,i),eS(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=da(),r=p0(n),s=bd(i,r);s.tag=1,s.payload=e,t!=null&&(s.callback=t),e=d0(n,s,r),e!==null&&(su(e,n,r,i),eS(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=da(),i=p0(n),r=bd(t,i);r.tag=2,e!=null&&(r.callback=e),e=d0(n,r,i),e!==null&&(su(e,n,i,t),eS(e,n,i))}};function QB(n,e,t,i,r,s,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!H3(t,i)||!H3(r,s):!0}function UW(n,e,t){var i=!1,r=E0,s=e.contextType;return typeof s=="object"&&s!==null?s=mc(s):(r=Ka(e)?Bm:zo.current,i=e.contextTypes,s=(i=i!=null)?a2(n,r):E0),e=new e(t,s),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=JE,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=s),e}function JB(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&JE.enqueueReplaceState(e,e.state,null)}function bR(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs={},MP(n);var s=e.contextType;typeof s=="object"&&s!==null?r.context=mc(s):(s=Ka(e)?Bm:zo.current,r.context=a2(n,s)),r.state=n.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(vR(n,e,s,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&JE.enqueueReplaceState(r,r.state,null),l6(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function h2(n,e){try{var t="",i=e;do t+=ase(i),i=i.return;while(i);var r=t}catch(s){r=`
Error generating stack: `+s.message+`
`+s.stack}return{value:n,source:e,stack:r,digest:null}}function rA(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function _R(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var Loe=typeof WeakMap=="function"?WeakMap:Map;function FW(n,e,t){t=bd(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){f6||(f6=!0,NR=i),_R(n,e)},t}function zW(n,e,t){t=bd(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){_R(n,e)}}var s=n.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(t.callback=function(){_R(n,e),typeof i!="function"&&(f0===null?f0=new Set([this]):f0.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function eU(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new Loe;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=qoe.bind(null,n,e,t),e.then(n,n))}function tU(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function nU(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=bd(-1,1),e.tag=2,d0(t,e,1))),t.lanes|=1),n)}var Doe=Bd.ReactCurrentOwner,za=!1;function sa(n,e,t,i){e.child=n===null?mW(e,null,t,i):c2(e,n.child,t,i)}function iU(n,e,t,i,r){t=t.render;var s=e.ref;return by(e,r),i=kP(n,e,t,i,s,r),t=LP(),n!==null&&!za?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Nd(n,e,r)):(kr&&t&&_P(e),e.flags|=1,sa(n,e,i,r),e.child)}function rU(n,e,t,i,r){if(n===null){var s=t.type;return typeof s=="function"&&!$P(s)&&s.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=s,jW(n,e,s,i,r)):(n=oS(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(s=n.child,!(n.lanes&r)){var o=s.memoizedProps;if(t=t.compare,t=t!==null?t:H3,t(o,i)&&n.ref===e.ref)return Nd(n,e,r)}return e.flags|=1,n=m0(s,i),n.ref=e.ref,n.return=e,e.child=n}function jW(n,e,t,i,r){if(n!==null){var s=n.memoizedProps;if(H3(s,i)&&n.ref===e.ref)if(za=!1,e.pendingProps=i=s,(n.lanes&r)!==0)n.flags&131072&&(za=!0);else return e.lanes=n.lanes,Nd(n,e,r)}return wR(n,e,t,i,r)}function VW(n,e,t){var i=e.pendingProps,r=i.children,s=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},_r(ey,yl),yl|=t;else{if(!(t&1073741824))return n=s!==null?s.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,_r(ey,yl),yl|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:t,_r(ey,yl),yl|=i}else s!==null?(i=s.baseLanes|t,e.memoizedState=null):i=t,_r(ey,yl),yl|=i;return sa(n,e,r,t),e.child}function HW(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function wR(n,e,t,i,r){var s=Ka(t)?Bm:zo.current;return s=a2(e,s),by(e,r),t=kP(n,e,t,i,s,r),i=LP(),n!==null&&!za?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,Nd(n,e,r)):(kr&&i&&_P(e),e.flags|=1,sa(n,e,t,r),e.child)}function sU(n,e,t,i,r){if(Ka(t)){var s=!0;i6(e)}else s=!1;if(by(e,r),e.stateNode===null)iS(n,e),UW(e,t,i),bR(e,t,i,r),i=!0;else if(n===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=t.contextType;typeof c=="object"&&c!==null?c=mc(c):(c=Ka(t)?Bm:zo.current,c=a2(e,c));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&JB(e,o,i,c),Of=!1;var p=e.memoizedState;o.state=p,l6(e,i,o,r),l=e.memoizedState,a!==i||p!==l||Wa.current||Of?(typeof u=="function"&&(vR(e,t,u,i),l=e.memoizedState),(a=Of||QB(e,t,a,i,p,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,yW(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Vc(e.type,a),o.props=c,h=e.pendingProps,p=o.context,l=t.contextType,typeof l=="object"&&l!==null?l=mc(l):(l=Ka(t)?Bm:zo.current,l=a2(e,l));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||p!==l)&&JB(e,o,i,l),Of=!1,p=e.memoizedState,o.state=p,l6(e,i,o,r);var y=e.memoizedState;a!==h||p!==y||Wa.current||Of?(typeof m=="function"&&(vR(e,t,m,i),y=e.memoizedState),(c=Of||QB(e,t,c,i,p,y,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,y,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,y,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=y),o.props=i,o.state=y,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),i=!1)}return SR(n,e,t,i,s,r)}function SR(n,e,t,i,r,s){HW(n,e);var o=(e.flags&128)!==0;if(!i&&!o)return r&&$B(e,t,!1),Nd(n,e,s);i=e.stateNode,Doe.current=e;var a=o&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&o?(e.child=c2(e,n.child,null,s),e.child=c2(e,null,a,s)):sa(n,e,a,s),e.memoizedState=i.state,r&&$B(e,t,!0),e.child}function $W(n){var e=n.stateNode;e.pendingContext?HB(n,e.pendingContext,e.pendingContext!==e.context):e.context&&HB(n,e.context,!1),RP(n,e.containerInfo)}function oU(n,e,t,i,r){return l2(),SP(r),e.flags|=256,sa(n,e,t,i),e.child}var ER={dehydrated:null,treeContext:null,retryLane:0};function TR(n){return{baseLanes:n,cachePool:null,transitions:null}}function GW(n,e,t){var i=e.pendingProps,r=Ur.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=n!==null&&n.memoizedState===null?!1:(r&2)!==0),a?(s=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),_r(Ur,r&1),n===null)return yR(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,n=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=n7(o,i,0,null),n=Sm(n,i,t,null),s.return=e,n.return=e,s.sibling=n,e.child=s,e.child.memoizedState=TR(t),e.memoizedState=ER,n):BP(e,o));if(r=n.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return Ooe(n,e,o,i,a,r,t);if(s){s=i.fallback,o=e.mode,r=n.child,a=r.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=m0(r,l),i.subtreeFlags=r.subtreeFlags&14680064),a!==null?s=m0(a,s):(s=Sm(s,o,t,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=n.child.memoizedState,o=o===null?TR(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=n.childLanes&~t,e.memoizedState=ER,i}return s=n.child,n=s.sibling,i=m0(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function BP(n,e){return e=n7({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Jw(n,e,t,i){return i!==null&&SP(i),c2(e,n.child,null,t),n=BP(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function Ooe(n,e,t,i,r,s,o){if(t)return e.flags&256?(e.flags&=-257,i=rA(Error(Ft(422))),Jw(n,e,o,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(s=i.fallback,r=e.mode,i=n7({mode:"visible",children:i.children},r,0,null),s=Sm(s,r,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&c2(e,n.child,null,o),e.child.memoizedState=TR(o),e.memoizedState=ER,s);if(!(e.mode&1))return Jw(n,e,o,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(Ft(419)),i=rA(s,i,void 0),Jw(n,e,o,i)}if(a=(o&n.childLanes)!==0,za||a){if(i=js,i!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|o)?0:r,r!==0&&r!==s.retryLane&&(s.retryLane=r,Id(n,r),su(i,n,r,-1))}return HP(),i=rA(Error(Ft(421))),Jw(n,e,o,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=Zoe.bind(null,n),r._reactRetry=e,null):(n=s.treeContext,_l=h0(r.nextSibling),El=e,kr=!0,Yc=null,n!==null&&(Jl[ec++]=pd,Jl[ec++]=md,Jl[ec++]=Um,pd=n.id,md=n.overflow,Um=e),e=BP(e,i.children),e.flags|=4096,e)}function aU(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),xR(n.return,e,t)}function sA(n,e,t,i,r){var s=n.memoizedState;s===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=t,s.tailMode=r)}function WW(n,e,t){var i=e.pendingProps,r=i.revealOrder,s=i.tail;if(sa(n,e,i.children,t),i=Ur.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&aU(n,t,e);else if(n.tag===19)aU(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(_r(Ur,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&c6(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),sA(e,!1,r,t,s);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&c6(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}sA(e,!0,t,null,s);break;case"together":sA(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function iS(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Nd(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),zm|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Ft(153));if(e.child!==null){for(n=e.child,t=m0(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=m0(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function Boe(n,e,t){switch(e.tag){case 3:$W(e),l2();break;case 5:xW(e);break;case 1:Ka(e.type)&&i6(e);break;case 4:RP(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;_r(o6,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(_r(Ur,Ur.current&1),e.flags|=128,null):t&e.child.childLanes?GW(n,e,t):(_r(Ur,Ur.current&1),n=Nd(n,e,t),n!==null?n.sibling:null);_r(Ur,Ur.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return WW(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),_r(Ur,Ur.current),i)break;return null;case 22:case 23:return e.lanes=0,VW(n,e,t)}return Nd(n,e,t)}var KW,AR,qW,ZW;KW=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};AR=function(){};qW=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,em(rh.current);var s=null;switch(t){case"input":r=qM(n,r),i=qM(n,i),s=[];break;case"select":r=jr({},r,{value:void 0}),i=jr({},i,{value:void 0}),s=[];break;case"textarea":r=XM(n,r),i=XM(n,i),s=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=t6)}JM(t,i);var o;t=null;for(c in r)if(!i.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(o in a)a.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(O3.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=r?.[c],i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(t||(t={}),t[o]=l[o])}else t||(s||(s=[]),s.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(O3.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Er("scroll",n),s||a===l||(s=[])):(s=s||[]).push(c,l))}t&&(s=s||[]).push("style",t);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};ZW=function(n,e,t,i){t!==i&&(e.flags|=4)};function nv(n,e){if(!kr)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function go(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function Uoe(n,e,t){var i=e.pendingProps;switch(wP(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return go(e),null;case 1:return Ka(e.type)&&n6(),go(e),null;case 3:return i=e.stateNode,u2(),Rr(Wa),Rr(zo),NP(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(Xw(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Yc!==null&&(LR(Yc),Yc=null))),AR(n,e),go(e),null;case 5:IP(e);var r=em(q3.current);if(t=e.type,n!==null&&e.stateNode!=null)qW(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Ft(166));return go(e),null}if(n=em(rh.current),Xw(e)){i=e.stateNode,t=e.type;var s=e.memoizedProps;switch(i[Wu]=e,i[W3]=s,n=(e.mode&1)!==0,t){case"dialog":Er("cancel",i),Er("close",i);break;case"iframe":case"object":case"embed":Er("load",i);break;case"video":case"audio":for(r=0;r<Hv.length;r++)Er(Hv[r],i);break;case"source":Er("error",i);break;case"img":case"image":case"link":Er("error",i),Er("load",i);break;case"details":Er("toggle",i);break;case"input":gB(i,s),Er("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},Er("invalid",i);break;case"textarea":xB(i,s),Er("invalid",i)}JM(t,s),r=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&Yw(i.textContent,a,n),r=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Yw(i.textContent,a,n),r=["children",""+a]):O3.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Er("scroll",i)}switch(t){case"input":Vw(i),yB(i,s,!0);break;case"textarea":Vw(i),vB(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=t6)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=SG(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=o.createElement(t,{is:i.is}):(n=o.createElement(t),t==="select"&&(o=n,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):n=o.createElementNS(n,t),n[Wu]=e,n[W3]=i,KW(n,e,!1,!1),e.stateNode=n;e:{switch(o=eR(t,i),t){case"dialog":Er("cancel",n),Er("close",n),r=i;break;case"iframe":case"object":case"embed":Er("load",n),r=i;break;case"video":case"audio":for(r=0;r<Hv.length;r++)Er(Hv[r],n);r=i;break;case"source":Er("error",n),r=i;break;case"img":case"image":case"link":Er("error",n),Er("load",n),r=i;break;case"details":Er("toggle",n),r=i;break;case"input":gB(n,i),r=qM(n,i),Er("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=jr({},i,{value:void 0}),Er("invalid",n);break;case"textarea":xB(n,i),r=XM(n,i),Er("invalid",n);break;default:r=i}JM(t,r),a=r;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?AG(n,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&EG(n,l)):s==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&B3(n,l):typeof l=="number"&&B3(n,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(O3.hasOwnProperty(s)?l!=null&&s==="onScroll"&&Er("scroll",n):l!=null&&aP(n,s,l,o))}switch(t){case"input":Vw(n),yB(n,i,!1);break;case"textarea":Vw(n),vB(n);break;case"option":i.value!=null&&n.setAttribute("value",""+S0(i.value));break;case"select":n.multiple=!!i.multiple,s=i.value,s!=null?gy(n,!!i.multiple,s,!1):i.defaultValue!=null&&gy(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=t6)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return go(e),null;case 6:if(n&&e.stateNode!=null)ZW(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Ft(166));if(t=em(q3.current),em(rh.current),Xw(e)){if(i=e.stateNode,t=e.memoizedProps,i[Wu]=e,(s=i.nodeValue!==t)&&(n=El,n!==null))switch(n.tag){case 3:Yw(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Yw(i.nodeValue,t,(n.mode&1)!==0)}s&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[Wu]=e,e.stateNode=i}return go(e),null;case 13:if(Rr(Ur),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(kr&&_l!==null&&e.mode&1&&!(e.flags&128))fW(),l2(),e.flags|=98560,s=!1;else if(s=Xw(e),i!==null&&i.dehydrated!==null){if(n===null){if(!s)throw Error(Ft(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Ft(317));s[Wu]=e}else l2(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;go(e),s=!1}else Yc!==null&&(LR(Yc),Yc=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Ur.current&1?Ts===0&&(Ts=3):HP())),e.updateQueue!==null&&(e.flags|=4),go(e),null);case 4:return u2(),AR(n,e),n===null&&$3(e.stateNode.containerInfo),go(e),null;case 10:return AP(e.type._context),go(e),null;case 17:return Ka(e.type)&&n6(),go(e),null;case 19:if(Rr(Ur),s=e.memoizedState,s===null)return go(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)nv(s,!1);else{if(Ts!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=c6(n),o!==null){for(e.flags|=128,nv(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)s=t,n=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=n,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,n=o.dependencies,s.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return _r(Ur,Ur.current&1|2),e.child}n=n.sibling}s.tail!==null&&ts()>d2&&(e.flags|=128,i=!0,nv(s,!1),e.lanes=4194304)}else{if(!i)if(n=c6(o),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),nv(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!kr)return go(e),null}else 2*ts()-s.renderingStartTime>d2&&t!==1073741824&&(e.flags|=128,i=!0,nv(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(t=s.last,t!==null?t.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=ts(),e.sibling=null,t=Ur.current,_r(Ur,i?t&1|2:t&1),e):(go(e),null);case 22:case 23:return VP(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?yl&1073741824&&(go(e),e.subtreeFlags&6&&(e.flags|=8192)):go(e),null;case 24:return null;case 25:return null}throw Error(Ft(156,e.tag))}function Foe(n,e){switch(wP(e),e.tag){case 1:return Ka(e.type)&&n6(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return u2(),Rr(Wa),Rr(zo),NP(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return IP(e),null;case 13:if(Rr(Ur),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Ft(340));l2()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Rr(Ur),null;case 4:return u2(),null;case 10:return AP(e.type._context),null;case 22:case 23:return VP(),null;case 24:return null;default:return null}}var e4=!1,No=!1,zoe=typeof WeakSet=="function"?WeakSet:Set,cn=null;function Jg(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){Zr(n,e,i)}else t.current=null}function CR(n,e,t){try{t()}catch(i){Zr(n,e,i)}}var lU=!1;function joe(n,e){if(uR=QS,n=eW(),bP(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{t.nodeType,s.nodeType}catch{t=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=n,p=null;t:for(;;){for(var m;h!==t||r!==0&&h.nodeType!==3||(a=o+r),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)p=h,h=m;for(;;){if(h===n)break t;if(p===t&&++c===r&&(a=o),p===s&&++u===i&&(l=o),(m=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(hR={focusedElem:n,selectionRange:t},QS=!1,cn=e;cn!==null;)if(e=cn,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,cn=n;else for(;cn!==null;){e=cn;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var b=y.memoizedProps,w=y.memoizedState,v=e.stateNode,T=v.getSnapshotBeforeUpdate(e.elementType===e.type?b:Vc(e.type,b),w);v.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var S=e.stateNode.containerInfo;S.nodeType===1?S.textContent="":S.nodeType===9&&S.documentElement&&S.removeChild(S.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Ft(163))}}catch(M){Zr(e,e.return,M)}if(n=e.sibling,n!==null){n.return=e.return,cn=n;break}cn=e.return}return y=lU,lU=!1,y}function g3(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var s=r.destroy;r.destroy=void 0,s!==void 0&&CR(e,t,s)}r=r.next}while(r!==i)}}function e7(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function MR(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function YW(n){var e=n.alternate;e!==null&&(n.alternate=null,YW(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Wu],delete e[W3],delete e[pR],delete e[Soe],delete e[Eoe])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function XW(n){return n.tag===5||n.tag===3||n.tag===4}function cU(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||XW(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function RR(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=t6));else if(i!==4&&(n=n.child,n!==null))for(RR(n,e,t),n=n.sibling;n!==null;)RR(n,e,t),n=n.sibling}function IR(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(IR(n,e,t),n=n.sibling;n!==null;)IR(n,e,t),n=n.sibling}var Qs=null,Wc=!1;function df(n,e,t){for(t=t.child;t!==null;)QW(n,e,t),t=t.sibling}function QW(n,e,t){if(ih&&typeof ih.onCommitFiberUnmount=="function")try{ih.onCommitFiberUnmount(WE,t)}catch{}switch(t.tag){case 5:No||Jg(t,e);case 6:var i=Qs,r=Wc;Qs=null,df(n,e,t),Qs=i,Wc=r,Qs!==null&&(Wc?(n=Qs,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Qs.removeChild(t.stateNode));break;case 18:Qs!==null&&(Wc?(n=Qs,t=t.stateNode,n.nodeType===8?QT(n.parentNode,t):n.nodeType===1&&QT(n,t),j3(n)):QT(Qs,t.stateNode));break;case 4:i=Qs,r=Wc,Qs=t.stateNode.containerInfo,Wc=!0,df(n,e,t),Qs=i,Wc=r;break;case 0:case 11:case 14:case 15:if(!No&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var s=r,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&CR(t,e,o),r=r.next}while(r!==i)}df(n,e,t);break;case 1:if(!No&&(Jg(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(a){Zr(t,e,a)}df(n,e,t);break;case 21:df(n,e,t);break;case 22:t.mode&1?(No=(i=No)||t.memoizedState!==null,df(n,e,t),No=i):df(n,e,t);break;default:df(n,e,t)}}function uU(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new zoe),e.forEach(function(i){var r=Yoe.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function Ic(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var s=n,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Qs=a.stateNode,Wc=!1;break e;case 3:Qs=a.stateNode.containerInfo,Wc=!0;break e;case 4:Qs=a.stateNode.containerInfo,Wc=!0;break e}a=a.return}if(Qs===null)throw Error(Ft(160));QW(s,o,r),Qs=null,Wc=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Zr(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)JW(e,n),e=e.sibling}function JW(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ic(e,n),Su(n),i&4){try{g3(3,n,n.return),e7(3,n)}catch(b){Zr(n,n.return,b)}try{g3(5,n,n.return)}catch(b){Zr(n,n.return,b)}}break;case 1:Ic(e,n),Su(n),i&512&&t!==null&&Jg(t,t.return);break;case 5:if(Ic(e,n),Su(n),i&512&&t!==null&&Jg(t,t.return),n.flags&32){var r=n.stateNode;try{B3(r,"")}catch(b){Zr(n,n.return,b)}}if(i&4&&(r=n.stateNode,r!=null)){var s=n.memoizedProps,o=t!==null?t.memoizedProps:s,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&_G(r,s),eR(a,o);var c=eR(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?AG(r,h):u==="dangerouslySetInnerHTML"?EG(r,h):u==="children"?B3(r,h):aP(r,u,h,c)}switch(a){case"input":ZM(r,s);break;case"textarea":wG(r,s);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?gy(r,!!s.multiple,m,!1):p!==!!s.multiple&&(s.defaultValue!=null?gy(r,!!s.multiple,s.defaultValue,!0):gy(r,!!s.multiple,s.multiple?[]:"",!1))}r[W3]=s}catch(b){Zr(n,n.return,b)}}break;case 6:if(Ic(e,n),Su(n),i&4){if(n.stateNode===null)throw Error(Ft(162));r=n.stateNode,s=n.memoizedProps;try{r.nodeValue=s}catch(b){Zr(n,n.return,b)}}break;case 3:if(Ic(e,n),Su(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{j3(e.containerInfo)}catch(b){Zr(n,n.return,b)}break;case 4:Ic(e,n),Su(n);break;case 13:Ic(e,n),Su(n),r=n.child,r.flags&8192&&(s=r.memoizedState!==null,r.stateNode.isHidden=s,!s||r.alternate!==null&&r.alternate.memoizedState!==null||(zP=ts())),i&4&&uU(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(No=(c=No)||u,Ic(e,n),No=c):Ic(e,n),Su(n),i&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(cn=n,u=n.child;u!==null;){for(h=cn=u;cn!==null;){switch(p=cn,m=p.child,p.tag){case 0:case 11:case 14:case 15:g3(4,p,p.return);break;case 1:Jg(p,p.return);var y=p.stateNode;if(typeof y.componentWillUnmount=="function"){i=p,t=p.return;try{e=i,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(b){Zr(i,t,b)}}break;case 5:Jg(p,p.return);break;case 22:if(p.memoizedState!==null){dU(h);continue}}m!==null?(m.return=p,cn=m):dU(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{r=h.stateNode,c?(s=r.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=TG("display",o))}catch(b){Zr(n,n.return,b)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(b){Zr(n,n.return,b)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ic(e,n),Su(n),i&4&&uU(n);break;case 21:break;default:Ic(e,n),Su(n)}}function Su(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(XW(t)){var i=t;break e}t=t.return}throw Error(Ft(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(B3(r,""),i.flags&=-33);var s=cU(n);IR(n,s,r);break;case 3:case 4:var o=i.stateNode.containerInfo,a=cU(n);RR(n,a,o);break;default:throw Error(Ft(161))}}catch(l){Zr(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function Voe(n,e,t){cn=n,eK(n)}function eK(n,e,t){for(var i=(n.mode&1)!==0;cn!==null;){var r=cn,s=r.child;if(r.tag===22&&i){var o=r.memoizedState!==null||e4;if(!o){var a=r.alternate,l=a!==null&&a.memoizedState!==null||No;a=e4;var c=No;if(e4=o,(No=l)&&!c)for(cn=r;cn!==null;)o=cn,l=o.child,o.tag===22&&o.memoizedState!==null?fU(r):l!==null?(l.return=o,cn=l):fU(r);for(;s!==null;)cn=s,eK(s),s=s.sibling;cn=r,e4=a,No=c}hU(n)}else r.subtreeFlags&8772&&s!==null?(s.return=r,cn=s):hU(n)}}function hU(n){for(;cn!==null;){var e=cn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:No||e7(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!No)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Vc(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&ZB(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}ZB(e,o,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&j3(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Ft(163))}No||e.flags&512&&MR(e)}catch(p){Zr(e,e.return,p)}}if(e===n){cn=null;break}if(t=e.sibling,t!==null){t.return=e.return,cn=t;break}cn=e.return}}function dU(n){for(;cn!==null;){var e=cn;if(e===n){cn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,cn=t;break}cn=e.return}}function fU(n){for(;cn!==null;){var e=cn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{e7(4,e)}catch(l){Zr(e,t,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(l){Zr(e,r,l)}}var s=e.return;try{MR(e)}catch(l){Zr(e,s,l)}break;case 5:var o=e.return;try{MR(e)}catch(l){Zr(e,o,l)}}}catch(l){Zr(e,e.return,l)}if(e===n){cn=null;break}var a=e.sibling;if(a!==null){a.return=e.return,cn=a;break}cn=e.return}}var Hoe=Math.ceil,d6=Bd.ReactCurrentDispatcher,UP=Bd.ReactCurrentOwner,uc=Bd.ReactCurrentBatchConfig,Ri=0,js=null,ds=null,to=0,yl=0,ey=U0(0),Ts=0,Q3=null,zm=0,t7=0,FP=0,y3=null,La=null,zP=0,d2=1/0,Zh=null,f6=!1,NR=null,f0=null,t4=!1,qf=null,p6=0,x3=0,PR=null,rS=-1,sS=0;function da(){return Ri&6?ts():rS!==-1?rS:rS=ts()}function p0(n){return n.mode&1?Ri&2&&to!==0?to&-to:Aoe.transition!==null?(sS===0&&(sS=UG()),sS):(n=Xi,n!==0||(n=window.event,n=n===void 0?16:GG(n.type)),n):1}function su(n,e,t,i){if(50<x3)throw x3=0,PR=null,Error(Ft(185));a_(n,t,i),(!(Ri&2)||n!==js)&&(n===js&&(!(Ri&2)&&(t7|=t),Ts===4&&Vf(n,to)),qa(n,i),t===1&&Ri===0&&!(e.mode&1)&&(d2=ts()+500,XE&&F0()))}function qa(n,e){var t=n.callbackNode;Ase(n,e);var i=XS(n,n===js?to:0);if(i===0)t!==null&&wB(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&wB(t),e===1)n.tag===0?Toe(pU.bind(null,n)):uW(pU.bind(null,n)),_oe(function(){!(Ri&6)&&F0()}),t=null;else{switch(FG(i)){case 1:t=dP;break;case 4:t=OG;break;case 16:t=YS;break;case 536870912:t=BG;break;default:t=YS}t=lK(t,tK.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function tK(n,e){if(rS=-1,sS=0,Ri&6)throw Error(Ft(327));var t=n.callbackNode;if(_y()&&n.callbackNode!==t)return null;var i=XS(n,n===js?to:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=m6(n,i);else{e=i;var r=Ri;Ri|=2;var s=iK();(js!==n||to!==e)&&(Zh=null,d2=ts()+500,wm(n,e));do try{Woe();break}catch(a){nK(n,a)}while(1);TP(),d6.current=s,Ri=r,ds!==null?e=0:(js=null,to=0,e=Ts)}if(e!==0){if(e===2&&(r=sR(n),r!==0&&(i=r,e=kR(n,r))),e===1)throw t=Q3,wm(n,0),Vf(n,i),qa(n,ts()),t;if(e===6)Vf(n,i);else{if(r=n.current.alternate,!(i&30)&&!$oe(r)&&(e=m6(n,i),e===2&&(s=sR(n),s!==0&&(i=s,e=kR(n,s))),e===1))throw t=Q3,wm(n,0),Vf(n,i),qa(n,ts()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(Ft(345));case 2:jp(n,La,Zh);break;case 3:if(Vf(n,i),(i&130023424)===i&&(e=zP+500-ts(),10<e)){if(XS(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){da(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=fR(jp.bind(null,n,La,Zh),e);break}jp(n,La,Zh);break;case 4:if(Vf(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var o=31-ru(i);s=1<<o,o=e[o],o>r&&(r=o),i&=~s}if(i=r,i=ts()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Hoe(i/1960))-i,10<i){n.timeoutHandle=fR(jp.bind(null,n,La,Zh),i);break}jp(n,La,Zh);break;case 5:jp(n,La,Zh);break;default:throw Error(Ft(329))}}}return qa(n,ts()),n.callbackNode===t?tK.bind(null,n):null}function kR(n,e){var t=y3;return n.current.memoizedState.isDehydrated&&(wm(n,e).flags|=256),n=m6(n,e),n!==2&&(e=La,La=t,e!==null&&LR(e)),n}function LR(n){La===null?La=n:La.push.apply(La,n)}function $oe(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],s=r.getSnapshot;r=r.value;try{if(!uu(s(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Vf(n,e){for(e&=~FP,e&=~t7,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ru(e),i=1<<t;n[t]=-1,e&=~i}}function pU(n){if(Ri&6)throw Error(Ft(327));_y();var e=XS(n,0);if(!(e&1))return qa(n,ts()),null;var t=m6(n,e);if(n.tag!==0&&t===2){var i=sR(n);i!==0&&(e=i,t=kR(n,i))}if(t===1)throw t=Q3,wm(n,0),Vf(n,e),qa(n,ts()),t;if(t===6)throw Error(Ft(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,jp(n,La,Zh),qa(n,ts()),null}function jP(n,e){var t=Ri;Ri|=1;try{return n(e)}finally{Ri=t,Ri===0&&(d2=ts()+500,XE&&F0())}}function jm(n){qf!==null&&qf.tag===0&&!(Ri&6)&&_y();var e=Ri;Ri|=1;var t=uc.transition,i=Xi;try{if(uc.transition=null,Xi=1,n)return n()}finally{Xi=i,uc.transition=t,Ri=e,!(Ri&6)&&F0()}}function VP(){yl=ey.current,Rr(ey)}function wm(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,boe(t)),ds!==null)for(t=ds.return;t!==null;){var i=t;switch(wP(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&n6();break;case 3:u2(),Rr(Wa),Rr(zo),NP();break;case 5:IP(i);break;case 4:u2();break;case 13:Rr(Ur);break;case 19:Rr(Ur);break;case 10:AP(i.type._context);break;case 22:case 23:VP()}t=t.return}if(js=n,ds=n=m0(n.current,null),to=yl=e,Ts=0,Q3=null,FP=t7=zm=0,La=y3=null,Jp!==null){for(e=0;e<Jp.length;e++)if(t=Jp[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,s=t.pending;if(s!==null){var o=s.next;s.next=r,i.next=o}t.pending=i}Jp=null}return n}function nK(n,e){do{var t=ds;try{if(TP(),tS.current=h6,u6){for(var i=zr.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}u6=!1}if(Fm=0,Fs=Es=zr=null,m3=!1,Z3=0,UP.current=null,t===null||t.return===null){Ts=1,Q3=e,ds=null;break}e:{var s=n,o=t.return,a=t,l=e;if(e=to,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=tU(o);if(m!==null){m.flags&=-257,nU(m,o,a,s,e),m.mode&1&&eU(s,c,e),e=m,l=c;var y=e.updateQueue;if(y===null){var b=new Set;b.add(l),e.updateQueue=b}else y.add(l);break e}else{if(!(e&1)){eU(s,c,e),HP();break e}l=Error(Ft(426))}}else if(kr&&a.mode&1){var w=tU(o);if(w!==null){!(w.flags&65536)&&(w.flags|=256),nU(w,o,a,s,e),SP(h2(l,a));break e}}s=l=h2(l,a),Ts!==4&&(Ts=2),y3===null?y3=[s]:y3.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var v=FW(s,l,e);qB(s,v);break e;case 1:a=l;var T=s.type,S=s.stateNode;if(!(s.flags&128)&&(typeof T.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(f0===null||!f0.has(S)))){s.flags|=65536,e&=-e,s.lanes|=e;var M=zW(s,a,e);qB(s,M);break e}}s=s.return}while(s!==null)}sK(t)}catch(P){e=P,ds===t&&t!==null&&(ds=t=t.return);continue}break}while(1)}function iK(){var n=d6.current;return d6.current=h6,n===null?h6:n}function HP(){(Ts===0||Ts===3||Ts===2)&&(Ts=4),js===null||!(zm&268435455)&&!(t7&268435455)||Vf(js,to)}function m6(n,e){var t=Ri;Ri|=2;var i=iK();(js!==n||to!==e)&&(Zh=null,wm(n,e));do try{Goe();break}catch(r){nK(n,r)}while(1);if(TP(),Ri=t,d6.current=i,ds!==null)throw Error(Ft(261));return js=null,to=0,Ts}function Goe(){for(;ds!==null;)rK(ds)}function Woe(){for(;ds!==null&&!yse();)rK(ds)}function rK(n){var e=aK(n.alternate,n,yl);n.memoizedProps=n.pendingProps,e===null?sK(n):ds=e,UP.current=null}function sK(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Foe(t,e),t!==null){t.flags&=32767,ds=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Ts=6,ds=null;return}}else if(t=Uoe(t,e,yl),t!==null){ds=t;return}if(e=e.sibling,e!==null){ds=e;return}ds=e=n}while(e!==null);Ts===0&&(Ts=5)}function jp(n,e,t){var i=Xi,r=uc.transition;try{uc.transition=null,Xi=1,Koe(n,e,t,i)}finally{uc.transition=r,Xi=i}return null}function Koe(n,e,t,i){do _y();while(qf!==null);if(Ri&6)throw Error(Ft(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Ft(177));n.callbackNode=null,n.callbackPriority=0;var s=t.lanes|t.childLanes;if(Cse(n,s),n===js&&(ds=js=null,to=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||t4||(t4=!0,lK(YS,function(){return _y(),null})),s=(t.flags&15990)!==0,t.subtreeFlags&15990||s){s=uc.transition,uc.transition=null;var o=Xi;Xi=1;var a=Ri;Ri|=4,UP.current=null,joe(n,t),JW(t,n),foe(hR),QS=!!uR,hR=uR=null,n.current=t,Voe(t),xse(),Ri=a,Xi=o,uc.transition=s}else n.current=t;if(t4&&(t4=!1,qf=n,p6=r),s=n.pendingLanes,s===0&&(f0=null),_se(t.stateNode),qa(n,ts()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(f6)throw f6=!1,n=NR,NR=null,n;return p6&1&&n.tag!==0&&_y(),s=n.pendingLanes,s&1?n===PR?x3++:(x3=0,PR=n):x3=0,F0(),null}function _y(){if(qf!==null){var n=FG(p6),e=uc.transition,t=Xi;try{if(uc.transition=null,Xi=16>n?16:n,qf===null)var i=!1;else{if(n=qf,qf=null,p6=0,Ri&6)throw Error(Ft(331));var r=Ri;for(Ri|=4,cn=n.current;cn!==null;){var s=cn,o=s.child;if(cn.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(cn=c;cn!==null;){var u=cn;switch(u.tag){case 0:case 11:case 15:g3(8,u,s)}var h=u.child;if(h!==null)h.return=u,cn=h;else for(;cn!==null;){u=cn;var p=u.sibling,m=u.return;if(YW(u),u===c){cn=null;break}if(p!==null){p.return=m,cn=p;break}cn=m}}}var y=s.alternate;if(y!==null){var b=y.child;if(b!==null){y.child=null;do{var w=b.sibling;b.sibling=null,b=w}while(b!==null)}}cn=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,cn=o;else e:for(;cn!==null;){if(s=cn,s.flags&2048)switch(s.tag){case 0:case 11:case 15:g3(9,s,s.return)}var v=s.sibling;if(v!==null){v.return=s.return,cn=v;break e}cn=s.return}}var T=n.current;for(cn=T;cn!==null;){o=cn;var S=o.child;if(o.subtreeFlags&2064&&S!==null)S.return=o,cn=S;else e:for(o=T;cn!==null;){if(a=cn,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:e7(9,a)}}catch(P){Zr(a,a.return,P)}if(a===o){cn=null;break e}var M=a.sibling;if(M!==null){M.return=a.return,cn=M;break e}cn=a.return}}if(Ri=r,F0(),ih&&typeof ih.onPostCommitFiberRoot=="function")try{ih.onPostCommitFiberRoot(WE,n)}catch{}i=!0}return i}finally{Xi=t,uc.transition=e}}return!1}function mU(n,e,t){e=h2(t,e),e=FW(n,e,1),n=d0(n,e,1),e=da(),n!==null&&(a_(n,1,e),qa(n,e))}function Zr(n,e,t){if(n.tag===3)mU(n,n,t);else for(;e!==null;){if(e.tag===3){mU(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(f0===null||!f0.has(i))){n=h2(t,n),n=zW(e,n,1),e=d0(e,n,1),n=da(),e!==null&&(a_(e,1,n),qa(e,n));break}}e=e.return}}function qoe(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=da(),n.pingedLanes|=n.suspendedLanes&t,js===n&&(to&t)===t&&(Ts===4||Ts===3&&(to&130023424)===to&&500>ts()-zP?wm(n,0):FP|=t),qa(n,e)}function oK(n,e){e===0&&(n.mode&1?(e=Gw,Gw<<=1,!(Gw&130023424)&&(Gw=4194304)):e=1);var t=da();n=Id(n,e),n!==null&&(a_(n,e,t),qa(n,t))}function Zoe(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),oK(n,t)}function Yoe(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(Ft(314))}i!==null&&i.delete(e),oK(n,t)}var aK;aK=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Wa.current)za=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return za=!1,Boe(n,e,t);za=!!(n.flags&131072)}else za=!1,kr&&e.flags&1048576&&hW(e,s6,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;iS(n,e),n=e.pendingProps;var r=a2(e,zo.current);by(e,t),r=kP(null,e,i,n,r,t);var s=LP();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ka(i)?(s=!0,i6(e)):s=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,MP(e),r.updater=JE,e.stateNode=r,r._reactInternals=e,bR(e,i,n,t),e=SR(null,e,i,!0,s,t)):(e.tag=0,kr&&s&&_P(e),sa(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(iS(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=Qoe(i),n=Vc(i,n),r){case 0:e=wR(null,e,i,n,t);break e;case 1:e=sU(null,e,i,n,t);break e;case 11:e=iU(null,e,i,n,t);break e;case 14:e=rU(null,e,i,Vc(i.type,n),t);break e}throw Error(Ft(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vc(i,r),wR(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vc(i,r),sU(n,e,i,r,t);case 3:e:{if($W(e),n===null)throw Error(Ft(387));i=e.pendingProps,s=e.memoizedState,r=s.element,yW(n,e),l6(e,i,null,t);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){r=h2(Error(Ft(423)),e),e=oU(n,e,i,t,r);break e}else if(i!==r){r=h2(Error(Ft(424)),e),e=oU(n,e,i,t,r);break e}else for(_l=h0(e.stateNode.containerInfo.firstChild),El=e,kr=!0,Yc=null,t=mW(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(l2(),i===r){e=Nd(n,e,t);break e}sa(n,e,i,t)}e=e.child}return e;case 5:return xW(e),n===null&&yR(e),i=e.type,r=e.pendingProps,s=n!==null?n.memoizedProps:null,o=r.children,dR(i,r)?o=null:s!==null&&dR(i,s)&&(e.flags|=32),HW(n,e),sa(n,e,o,t),e.child;case 6:return n===null&&yR(e),null;case 13:return GW(n,e,t);case 4:return RP(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=c2(e,null,i,t):sa(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vc(i,r),iU(n,e,i,r,t);case 7:return sa(n,e,e.pendingProps,t),e.child;case 8:return sa(n,e,e.pendingProps.children,t),e.child;case 12:return sa(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,s=e.memoizedProps,o=r.value,_r(o6,i._currentValue),i._currentValue=o,s!==null)if(uu(s.value,o)){if(s.children===r.children&&!Wa.current){e=Nd(n,e,t);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=bd(-1,t&-t),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=t,l=s.alternate,l!==null&&(l.lanes|=t),xR(s.return,t,e),a.lanes|=t;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Ft(341));o.lanes|=t,a=o.alternate,a!==null&&(a.lanes|=t),xR(o,t,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}sa(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,by(e,t),r=mc(r),i=i(r),e.flags|=1,sa(n,e,i,t),e.child;case 14:return i=e.type,r=Vc(i,e.pendingProps),r=Vc(i.type,r),rU(n,e,i,r,t);case 15:return jW(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vc(i,r),iS(n,e),e.tag=1,Ka(i)?(n=!0,i6(e)):n=!1,by(e,t),UW(e,i,r),bR(e,i,r,t),SR(null,e,i,!0,n,t);case 19:return WW(n,e,t);case 22:return VW(n,e,t)}throw Error(Ft(156,e.tag))};function lK(n,e){return DG(n,e)}function Xoe(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function sc(n,e,t,i){return new Xoe(n,e,t,i)}function $P(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Qoe(n){if(typeof n=="function")return $P(n)?1:0;if(n!=null){if(n=n.$$typeof,n===cP)return 11;if(n===uP)return 14}return 2}function m0(n,e){var t=n.alternate;return t===null?(t=sc(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function oS(n,e,t,i,r,s){var o=2;if(i=n,typeof n=="function")$P(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case $g:return Sm(t.children,r,s,e);case lP:o=8,r|=8;break;case $M:return n=sc(12,t,e,r|2),n.elementType=$M,n.lanes=s,n;case GM:return n=sc(13,t,e,r),n.elementType=GM,n.lanes=s,n;case WM:return n=sc(19,t,e,r),n.elementType=WM,n.lanes=s,n;case xG:return n7(t,r,s,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case gG:o=10;break e;case yG:o=9;break e;case cP:o=11;break e;case uP:o=14;break e;case Df:o=16,i=null;break e}throw Error(Ft(130,n==null?n:typeof n,""))}return e=sc(o,t,e,r),e.elementType=n,e.type=i,e.lanes=s,e}function Sm(n,e,t,i){return n=sc(7,n,i,e),n.lanes=t,n}function n7(n,e,t,i){return n=sc(22,n,i,e),n.elementType=xG,n.lanes=t,n.stateNode={isHidden:!1},n}function oA(n,e,t){return n=sc(6,n,null,e),n.lanes=t,n}function aA(n,e,t){return e=sc(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function Joe(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=jT(0),this.expirationTimes=jT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jT(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function GP(n,e,t,i,r,s,o,a,l){return n=new Joe(n,e,t,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=sc(3,null,null,e),n.current=s,s.stateNode=n,s.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},MP(s),n}function eae(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Hg,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function cK(n){if(!n)return E0;n=n._reactInternals;e:{if(l1(n)!==n||n.tag!==1)throw Error(Ft(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ka(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Ft(171))}if(n.tag===1){var t=n.type;if(Ka(t))return cW(n,t,e)}return e}function uK(n,e,t,i,r,s,o,a,l){return n=GP(t,i,!0,n,r,s,o,a,l),n.context=cK(null),t=n.current,i=da(),r=p0(t),s=bd(i,r),s.callback=e??null,d0(t,s,r),n.current.lanes=r,a_(n,r,i),qa(n,i),n}function i7(n,e,t,i){var r=e.current,s=da(),o=p0(r);return t=cK(t),e.context===null?e.context=t:e.pendingContext=t,e=bd(s,o),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=d0(r,e,o),n!==null&&(su(n,r,o,s),eS(n,r,o)),o}function g6(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function gU(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function WP(n,e){gU(n,e),(n=n.alternate)&&gU(n,e)}function tae(){return null}var hK=typeof reportError=="function"?reportError:function(n){console.error(n)};function KP(n){this._internalRoot=n}r7.prototype.render=KP.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Ft(409));i7(n,e,null,null)};r7.prototype.unmount=KP.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;jm(function(){i7(null,n,null,null)}),e[Rd]=null}};function r7(n){this._internalRoot=n}r7.prototype.unstable_scheduleHydration=function(n){if(n){var e=VG();n={blockedOn:null,target:n,priority:e};for(var t=0;t<jf.length&&e!==0&&e<jf[t].priority;t++);jf.splice(t,0,n),t===0&&$G(n)}};function qP(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function s7(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function yU(){}function nae(n,e,t,i,r){if(r){if(typeof i=="function"){var s=i;i=function(){var c=g6(o);s.call(c)}}var o=uK(e,i,n,0,null,!1,!1,"",yU);return n._reactRootContainer=o,n[Rd]=o.current,$3(n.nodeType===8?n.parentNode:n),jm(),o}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var a=i;i=function(){var c=g6(l);a.call(c)}}var l=GP(n,0,!1,null,null,!1,!1,"",yU);return n._reactRootContainer=l,n[Rd]=l.current,$3(n.nodeType===8?n.parentNode:n),jm(function(){i7(e,l,t,i)}),l}function o7(n,e,t,i,r){var s=t._reactRootContainer;if(s){var o=s;if(typeof r=="function"){var a=r;r=function(){var l=g6(o);a.call(l)}}i7(e,o,n,r)}else o=nae(t,e,n,r,i);return g6(o)}zG=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=Vv(e.pendingLanes);t!==0&&(fP(e,t|1),qa(e,ts()),!(Ri&6)&&(d2=ts()+500,F0()))}break;case 13:jm(function(){var i=Id(n,1);if(i!==null){var r=da();su(i,n,1,r)}}),WP(n,1)}};pP=function(n){if(n.tag===13){var e=Id(n,134217728);if(e!==null){var t=da();su(e,n,134217728,t)}WP(n,134217728)}};jG=function(n){if(n.tag===13){var e=p0(n),t=Id(n,e);if(t!==null){var i=da();su(t,n,e,i)}WP(n,e)}};VG=function(){return Xi};HG=function(n,e){var t=Xi;try{return Xi=n,e()}finally{Xi=t}};nR=function(n,e,t){switch(e){case"input":if(ZM(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=YE(i);if(!r)throw Error(Ft(90));bG(i),ZM(i,r)}}}break;case"textarea":wG(n,t);break;case"select":e=t.value,e!=null&&gy(n,!!t.multiple,e,!1)}};RG=jP;IG=jm;var iae={usingClientEntryPoint:!1,Events:[c_,qg,YE,CG,MG,jP]},iv={findFiberByHostInstance:Qp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},rae={bundleType:iv.bundleType,version:iv.version,rendererPackageName:iv.rendererPackageName,rendererConfig:iv.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bd.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=kG(n),n===null?null:n.stateNode},findFiberByHostInstance:iv.findFiberByHostInstance||tae,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var n4=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!n4.isDisabled&&n4.supportsFiber)try{WE=n4.inject(rae),ih=n4}catch{}}Cl.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iae;Cl.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qP(e))throw Error(Ft(200));return eae(n,e,null,t)};Cl.createRoot=function(n,e){if(!qP(n))throw Error(Ft(299));var t=!1,i="",r=hK;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=GP(n,1,!1,null,null,t,!1,i,r),n[Rd]=e.current,$3(n.nodeType===8?n.parentNode:n),new KP(e)};Cl.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Ft(188)):(n=Object.keys(n).join(","),Error(Ft(268,n)));return n=kG(e),n=n===null?null:n.stateNode,n};Cl.flushSync=function(n){return jm(n)};Cl.hydrate=function(n,e,t){if(!s7(e))throw Error(Ft(200));return o7(null,n,e,!0,t)};Cl.hydrateRoot=function(n,e,t){if(!qP(n))throw Error(Ft(405));var i=t!=null&&t.hydratedSources||null,r=!1,s="",o=hK;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(s=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=uK(e,null,n,1,t??null,r,!1,s,o),n[Rd]=e.current,$3(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new r7(e)};Cl.render=function(n,e,t){if(!s7(e))throw Error(Ft(200));return o7(null,n,e,!1,t)};Cl.unmountComponentAtNode=function(n){if(!s7(n))throw Error(Ft(40));return n._reactRootContainer?(jm(function(){o7(null,null,n,!1,function(){n._reactRootContainer=null,n[Rd]=null})}),!0):!1};Cl.unstable_batchedUpdates=jP;Cl.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!s7(t))throw Error(Ft(200));if(n==null||n._reactInternals===void 0)throw Error(Ft(38));return o7(n,e,t,!1,i)};Cl.version="18.3.1-next-f1338f8080-20240426";function dK(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(dK)}catch(n){console.error(n)}}dK(),dG.exports=Cl;var fK=dG.exports,xU=fK;VM.createRoot=xU.createRoot,VM.hydrateRoot=xU.hydrateRoot;var sae={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const oae=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),aae=(n,e)=>{const t=$.forwardRef(({color:i="currentColor",size:r=24,strokeWidth:s=2,absoluteStrokeWidth:o,children:a,...l},c)=>$.createElement("svg",{ref:c,...sae,width:r,height:r,stroke:i,strokeWidth:o?Number(s)*24/Number(r):s,className:`lucide lucide-${oae(n)}`,...l},[...e.map(([u,h])=>$.createElement(u,h)),...(Array.isArray(a)?a:[a])||[]]));return t.displayName=`${n}`,t};var At=aae;const Vm=At("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]),ZP=At("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),T0=At("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),lae=At("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),YP=At("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),cae=At("ArrowUpLeft",[["path",{d:"M7 17V7h10",key:"11bw93"}],["path",{d:"M17 17 7 7",key:"2786uv"}]]),uae=At("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),vU=At("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]),pK=At("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]]),hae=At("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]),dae=At("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),A0=At("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),mK=At("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]]),DR=At("Binary",[["rect",{x:"14",y:"14",width:"4",height:"6",rx:"2",key:"p02svl"}],["rect",{x:"6",y:"4",width:"4",height:"6",rx:"2",key:"xm4xkj"}],["path",{d:"M6 20h4",key:"1i6q5t"}],["path",{d:"M14 10h4",key:"ru81e7"}],["path",{d:"M6 14h2v6",key:"16z9wg"}],["path",{d:"M14 4h2v6",key:"1idq9u"}]]),gK=At("Box",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),aS=At("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),lA=At("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]),a7=At("Bus",[["path",{d:"M19 17h2l.64-2.54c.24-.959.24-1.962 0-2.92l-1.07-4.27A3 3 0 0 0 17.66 5H4a2 2 0 0 0-2 2v10h2",key:"wfsdqh"}],["path",{d:"M14 17H9",key:"o2noo5"}],["circle",{cx:"6.5",cy:"17.5",r:"2.5",key:"gc8oob"}],["circle",{cx:"16.5",cy:"17.5",r:"2.5",key:"4btu0q"}]]),fae=At("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),yK=At("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]),h_=At("Car",[["path",{d:"M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2",key:"l5np60"}],["circle",{cx:"6.5",cy:"16.5",r:"2.5",key:"ae40ju"}],["circle",{cx:"16.5",cy:"16.5",r:"2.5",key:"1smtlt"}]]),us=At("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),f2=At("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),Hm=At("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),pae=At("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),wy=At("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),xK=At("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),z0=At("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),mae=At("Construction",[["rect",{x:"2",y:"6",width:"20",height:"8",rx:"1",key:"1estib"}],["path",{d:"M17 14v7",key:"7m2elx"}],["path",{d:"M7 14v7",key:"1cm7wv"}],["path",{d:"M17 3v3",key:"1v4jwn"}],["path",{d:"M7 3v3",key:"7o6guu"}],["path",{d:"M10 14 2.3 6.3",key:"1023jk"}],["path",{d:"m14 6 7.7 7.7",key:"1s8pl2"}],["path",{d:"m8 6 8 8",key:"hl96qh"}]]),XP=At("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),gae=At("CornerUpLeft",[["polyline",{points:"9 14 4 9 9 4",key:"881910"}],["path",{d:"M20 20v-7a4 4 0 0 0-4-4H4",key:"1nkjon"}]]),vK=At("Cpu",[["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"9",y:"9",width:"6",height:"6",key:"o3kz5p"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]),OR=At("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),bK=At("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),Zf=At("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),yae=At("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),xae=At("Eraser",[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21",key:"182aya"}],["path",{d:"M22 21H7",key:"t4ddhn"}],["path",{d:"m5 11 9 9",key:"1mo9qw"}]]),vae=At("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),QP=At("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),bae=At("FileCode",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m10 13-2 2 2 2",key:"17smn8"}],["path",{d:"m14 17 2-2-2-2",key:"14mezr"}]]),_K=At("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),JP=At("Film",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"2.18",ry:"2.18",key:"vury4c"}],["line",{x1:"7",x2:"7",y1:"2",y2:"22",key:"t1e4qh"}],["line",{x1:"17",x2:"17",y1:"2",y2:"22",key:"1tliql"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"2",x2:"7",y1:"7",y2:"7",key:"1wdzzh"}],["line",{x1:"2",x2:"7",y1:"17",y2:"17",key:"2fufxq"}],["line",{x1:"17",x2:"22",y1:"17",y2:"17",key:"1xg577"}],["line",{x1:"17",x2:"22",y1:"7",y2:"7",key:"acrv2l"}]]),_ae=At("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),wae=At("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]),Sae=At("Folder",[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}]]),d_=At("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]),Eae=At("Gauge",[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]]),wK=At("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),Tae=At("Grid",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"3",x2:"21",y1:"15",y2:"15",key:"o2sbyz"}],["line",{x1:"9",x2:"9",y1:"3",y2:"21",key:"13tij5"}],["line",{x1:"15",x2:"15",y1:"3",y2:"21",key:"1hpv9i"}]]),Aae=At("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]),SK=At("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]),J3=At("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),Cae=At("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Mae=At("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),Rae=At("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]),xr=At("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),j0=At("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),Ba=At("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),y6=At("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),EK=At("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Iae=At("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),Pd=At("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),bU=At("MicOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M18.89 13.23A7.12 7.12 0 0 0 19 12v-2",key:"80xlxr"}],["path",{d:"M5 10v2a7 7 0 0 0 12 5",key:"p2k8kg"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),p2=At("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),Nae=At("Milestone",[["path",{d:"M18 6H5a2 2 0 0 0-2 2v3a2 2 0 0 0 2 2h13l4-3.5L18 6Z",key:"1mp5s7"}],["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M12 3v3",key:"1n5kay"}]]),_U=At("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),Pae=At("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),m2=At("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),wU=At("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),kae=At("Paintbrush",[["path",{d:"M18.37 2.63 14 7l-1.59-1.59a2 2 0 0 0-2.82 0L8 7l9 9 1.59-1.59a2 2 0 0 0 0-2.82L17 10l4.37-4.37a2.12 2.12 0 1 0-3-3Z",key:"m6k5sh"}],["path",{d:"M9 8c-2 3-4 3.5-7 4l8 10c2-1 6-5 6-7",key:"arzq70"}],["path",{d:"M14.5 17.5 4.5 15",key:"s7fvrz"}]]),TK=At("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),AK=At("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),i4=At("Pen",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}]]),Lae=At("Pencil",[["path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z",key:"5qss01"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),SU=At("PhoneOff",[["path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91",key:"z86iuo"}],["line",{x1:"22",x2:"2",y1:"2",y2:"22",key:"11kh81"}]]),CK=At("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Dae=At("Pipette",[["path",{d:"m2 22 1-1h3l9-9",key:"1sre89"}],["path",{d:"M3 21v-3l9-9",key:"hpe2y6"}],["path",{d:"m15 6 3.4-3.4a2.1 2.1 0 1 1 3 3L18 9l.4.4a2.1 2.1 0 1 1-3 3l-3.8-3.8a2.1 2.1 0 1 1 3-3l.4.4Z",key:"196du1"}]]),MK=At("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Oae=At("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),eb=At("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Bae=At("Redo2",[["path",{d:"m15 14 5-5-5-5",key:"12vg1m"}],["path",{d:"M20 9H9.5A5.5 5.5 0 0 0 4 14.5v0A5.5 5.5 0 0 0 9.5 20H13",key:"19mnr4"}]]),RK=At("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),IK=At("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),l7=At("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),ja=At("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ek=At("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Uae=At("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),c7=At("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),f_=At("ShieldCheck",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),ao=At("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Fae=At("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),u7=At("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),zae=At("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),jae=At("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ql=At("Train",[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h0",key:"q9eq1f"}],["path",{d:"M16 15h0",key:"pzrbjg"}]]),p_=At("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),Vae=At("Undo2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5v0a5.5 5.5 0 0 1-5.5 5.5H11",key:"llx8ln"}]]),EU=At("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),NK=At("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),sh=At("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Hae=At("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),As=At("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),$ae=At("VideoOff",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.34l1 1L22 8v8",key:"ubwiq0"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z",key:"1l10zd"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),tk=At("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]),m_=At("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),PK=At("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]),x6=At("Wand2",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z",key:"1bcowg"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),Gae=At("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Wae=At("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]]),Kae=At("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Ui=At("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),nk=At("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),qae=At("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),Zae=At("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),uh=Object.create(null);uh.open="0";uh.close="1";uh.ping="2";uh.pong="3";uh.message="4";uh.upgrade="5";uh.noop="6";const lS=Object.create(null);Object.keys(uh).forEach(n=>{lS[uh[n]]=n});const BR={type:"error",data:"parser error"},kK=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",LK=typeof ArrayBuffer=="function",DK=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,ik=({type:n,data:e},t,i)=>kK&&e instanceof Blob?t?i(e):TU(e,i):LK&&(e instanceof ArrayBuffer||DK(e))?t?i(e):TU(new Blob([e]),i):i(uh[n]+(e||"")),TU=(n,e)=>{const t=new FileReader;return t.onload=function(){const i=t.result.split(",")[1];e("b"+(i||""))},t.readAsDataURL(n)};function AU(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}let cA;function Yae(n,e){if(kK&&n.data instanceof Blob)return n.data.arrayBuffer().then(AU).then(e);if(LK&&(n.data instanceof ArrayBuffer||DK(n.data)))return e(AU(n.data));ik(n,!1,t=>{cA||(cA=new TextEncoder),e(cA.encode(t))})}const CU="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$v=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let n=0;n<CU.length;n++)$v[CU.charCodeAt(n)]=n;const Xae=n=>{let e=n.length*.75,t=n.length,i,r=0,s,o,a,l;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(i=0;i<t;i+=4)s=$v[n.charCodeAt(i)],o=$v[n.charCodeAt(i+1)],a=$v[n.charCodeAt(i+2)],l=$v[n.charCodeAt(i+3)],u[r++]=s<<2|o>>4,u[r++]=(o&15)<<4|a>>2,u[r++]=(a&3)<<6|l&63;return c},Qae=typeof ArrayBuffer=="function",rk=(n,e)=>{if(typeof n!="string")return{type:"message",data:OK(n,e)};const t=n.charAt(0);return t==="b"?{type:"message",data:Jae(n.substring(1),e)}:lS[t]?n.length>1?{type:lS[t],data:n.substring(1)}:{type:lS[t]}:BR},Jae=(n,e)=>{if(Qae){const t=Xae(n);return OK(t,e)}else return{base64:!0,data:n}},OK=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}},BK=String.fromCharCode(30),ele=(n,e)=>{const t=n.length,i=new Array(t);let r=0;n.forEach((s,o)=>{ik(s,!1,a=>{i[o]=a,++r===t&&e(i.join(BK))})})},tle=(n,e)=>{const t=n.split(BK),i=[];for(let r=0;r<t.length;r++){const s=rk(t[r],e);if(i.push(s),s.type==="error")break}return i};function nle(){return new TransformStream({transform(n,e){Yae(n,t=>{const i=t.length;let r;if(i<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,i);else if(i<65536){r=new Uint8Array(3);const s=new DataView(r.buffer);s.setUint8(0,126),s.setUint16(1,i)}else{r=new Uint8Array(9);const s=new DataView(r.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(i))}n.data&&typeof n.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(t)})}})}let uA;function r4(n){return n.reduce((e,t)=>e+t.length,0)}function s4(n,e){if(n[0].length===e)return n.shift();const t=new Uint8Array(e);let i=0;for(let r=0;r<e;r++)t[r]=n[0][i++],i===n[0].length&&(n.shift(),i=0);return n.length&&i<n[0].length&&(n[0]=n[0].slice(i)),t}function ile(n,e){uA||(uA=new TextDecoder);const t=[];let i=0,r=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(i===0){if(r4(t)<1)break;const l=s4(t,1);s=(l[0]&128)===128,r=l[0]&127,r<126?i=3:r===126?i=1:i=2}else if(i===1){if(r4(t)<2)break;const l=s4(t,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),i=3}else if(i===2){if(r4(t)<8)break;const l=s4(t,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,53-32)-1){a.enqueue(BR);break}r=u*Math.pow(2,32)+c.getUint32(4),i=3}else{if(r4(t)<r)break;const l=s4(t,r);a.enqueue(rk(s?l:uA.decode(l),e)),i=0}if(r===0||r>n){a.enqueue(BR);break}}}})}const UK=4;function fs(n){if(n)return rle(n)}function rle(n){for(var e in fs.prototype)n[e]=fs.prototype[e];return n}fs.prototype.on=fs.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};fs.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};fs.prototype.off=fs.prototype.removeListener=fs.prototype.removeAllListeners=fs.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var i,r=0;r<t.length;r++)if(i=t[r],i===e||i.fn===e){t.splice(r,1);break}return t.length===0&&delete this._callbacks["$"+n],this};fs.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],i=1;i<arguments.length;i++)e[i-1]=arguments[i];if(t){t=t.slice(0);for(var i=0,r=t.length;i<r;++i)t[i].apply(this,e)}return this};fs.prototype.emitReserved=fs.prototype.emit;fs.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};fs.prototype.hasListeners=function(n){return!!this.listeners(n).length};const h7=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),tc=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),sle="arraybuffer";function FK(n,...e){return e.reduce((t,i)=>(n.hasOwnProperty(i)&&(t[i]=n[i]),t),{})}const ole=tc.setTimeout,ale=tc.clearTimeout;function d7(n,e){e.useNativeTimers?(n.setTimeoutFn=ole.bind(tc),n.clearTimeoutFn=ale.bind(tc)):(n.setTimeoutFn=tc.setTimeout.bind(tc),n.clearTimeoutFn=tc.clearTimeout.bind(tc))}const lle=1.33;function cle(n){return typeof n=="string"?ule(n):Math.ceil((n.byteLength||n.size)*lle)}function ule(n){let e=0,t=0;for(let i=0,r=n.length;i<r;i++)e=n.charCodeAt(i),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(i++,t+=4);return t}function zK(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function hle(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function dle(n){let e={},t=n.split("&");for(let i=0,r=t.length;i<r;i++){let s=t[i].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class fle extends Error{constructor(e,t,i){super(e),this.description=t,this.context=i,this.type="TransportError"}}class sk extends fs{constructor(e){super(),this.writable=!1,d7(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,i){return super.emitReserved("error",new fle(e,t,i)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=rk(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&Number(this.opts.port)!==443||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=hle(e);return t.length?"?"+t:""}}class ple extends sk{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let i=0;this._polling&&(i++,this.once("pollComplete",function(){--i||t()})),this.writable||(i++,this.once("drain",function(){--i||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=i=>{if(this.readyState==="opening"&&i.type==="open"&&this.onOpen(),i.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(i)};tle(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ele(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=zK()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let jK=!1;try{jK=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const mle=jK;function gle(){}class yle extends ple{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let i=location.port;i||(i=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||i!==e.port}}doWrite(e,t){const i=this.request({method:"POST",data:e});i.on("success",t),i.on("error",(r,s)=>{this.onError("xhr post error",r,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,i)=>{this.onError("xhr poll error",t,i)}),this.pollXhr=e}}let Sy=class cS extends fs{constructor(e,t,i){super(),this.createRequest=e,d7(this,i),this._opts=i,this._method=i.method||"GET",this._uri=t,this._data=i.data!==void 0?i.data:null,this._create()}_create(){var e;const t=FK(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const i=this._xhr=this.createRequest(t);try{i.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){i.setDisableHeaderCheck&&i.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&i.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{i.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{i.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(i),"withCredentials"in i&&(i.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(i.timeout=this._opts.requestTimeout),i.onreadystatechange=()=>{var r;i.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(i.getResponseHeader("set-cookie"))),i.readyState===4&&(i.status===200||i.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof i.status=="number"?i.status:0)},0))},i.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=cS.requestsCount++,cS.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=gle,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete cS.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Sy.requestsCount=0;Sy.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",MU);else if(typeof addEventListener=="function"){const n="onpagehide"in tc?"pagehide":"unload";addEventListener(n,MU,!1)}}function MU(){for(let n in Sy.requests)Sy.requests.hasOwnProperty(n)&&Sy.requests[n].abort()}const xle=function(){const n=VK({xdomain:!1});return n&&n.responseType!==null}();class vle extends yle{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=xle&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Sy(VK,this.uri(),e)}}function VK(n){const e=n.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||mle))return new XMLHttpRequest}catch{}if(!e)try{return new tc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const HK=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class ble extends sk{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,i=HK?{}:FK(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(i.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,i)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],r=t===e.length-1;ik(i,this.supportsBinary,s=>{try{this.doWrite(i,s)}catch{}r&&h7(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=zK()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const hA=tc.WebSocket||tc.MozWebSocket;class _le extends ble{createSocket(e,t,i){return HK?new hA(e,t,i):t?new hA(e,t):new hA(e)}doWrite(e,t){this.ws.send(t)}}class wle extends sk{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=ile(Number.MAX_SAFE_INTEGER,this.socket.binaryType),i=e.readable.pipeThrough(t).getReader(),r=nle();r.readable.pipeTo(e.writable),this._writer=r.writable.getWriter();const s=()=>{i.read().then(({done:a,value:l})=>{a||(this.onPacket(l),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const i=e[t],r=t===e.length-1;this._writer.write(i).then(()=>{r&&h7(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const Sle={websocket:_le,webtransport:wle,polling:vle},Ele=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Tle=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function UR(n){if(n.length>8e3)throw"URI too long";const e=n,t=n.indexOf("["),i=n.indexOf("]");t!=-1&&i!=-1&&(n=n.substring(0,t)+n.substring(t,i).replace(/:/g,";")+n.substring(i,n.length));let r=Ele.exec(n||""),s={},o=14;for(;o--;)s[Tle[o]]=r[o]||"";return t!=-1&&i!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Ale(s,s.path),s.queryKey=Cle(s,s.query),s}function Ale(n,e){const t=/\/{2,9}/g,i=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&i.splice(0,1),e.slice(-1)=="/"&&i.splice(i.length-1,1),i}function Cle(n,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(i,r,s){r&&(t[r]=s)}),t}const FR=typeof addEventListener=="function"&&typeof removeEventListener=="function",uS=[];FR&&addEventListener("offline",()=>{uS.forEach(n=>n())},!1);class g0 extends fs{constructor(e,t){if(super(),this.binaryType=sle,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const i=UR(e);t.hostname=i.host,t.secure=i.protocol==="https"||i.protocol==="wss",t.port=i.port,i.query&&(t.query=i.query)}else t.host&&(t.hostname=UR(t.host).host);d7(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(i=>{const r=i.prototype.name;this.transports.push(r),this._transportsByName[r]=i}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=dle(this.opts.query)),FR&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},uS.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=UK,t.transport=e,this.id&&(t.sid=this.id);const i=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](i)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&g0.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",g0.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let i=0;i<this.writeBuffer.length;i++){const r=this.writeBuffer[i].data;if(r&&(t+=cle(r)),i>0&&t>this._maxPayload)return this.writeBuffer.slice(0,i);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,h7(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,i){return this._sendPacket("message",e,t,i),this}send(e,t,i){return this._sendPacket("message",e,t,i),this}_sendPacket(e,t,i,r){if(typeof t=="function"&&(r=t,t=void 0),typeof i=="function"&&(r=i,i=null),this.readyState==="closing"||this.readyState==="closed")return;i=i||{},i.compress=i.compress!==!1;const s={type:e,data:t,options:i};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},i=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?i():e()}):this.upgrading?i():e()),this}_onError(e){if(g0.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),FR&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const i=uS.indexOf(this._offlineEventListener);i!==-1&&uS.splice(i,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}g0.protocol=UK;class Mle extends g0{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),i=!1;g0.priorWebsocketSuccess=!1;const r=()=>{i||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!i)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;g0.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{i||this.readyState!=="closed"&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=t.name,this.emitReserved("upgradeError",p)}}))};function s(){i||(i=!0,u(),t.close(),t=null)}const o=h=>{const p=new Error("probe error: "+h);p.transport=t.name,s(),this.emitReserved("upgradeError",p)};function a(){o("transport closed")}function l(){o("socket closed")}function c(h){t&&h.name!==t.name&&s()}const u=()=>{t.removeListener("open",r),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",c)};t.once("open",r),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",c),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{i||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let i=0;i<e.length;i++)~this.transports.indexOf(e[i])&&t.push(e[i]);return t}}let Rle=class extends Mle{constructor(e,t={}){const i=typeof e=="object"?e:t;(!i.transports||i.transports&&typeof i.transports[0]=="string")&&(i.transports=(i.transports||["polling","websocket","webtransport"]).map(r=>Sle[r]).filter(r=>!!r)),super(e,i)}};function Ile(n,e="",t){let i=n;t=t||typeof location<"u"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t<"u"?n=t.protocol+"//"+n:n="https://"+n),i=UR(n)),i.port||(/^(http|ws)$/.test(i.protocol)?i.port="80":/^(http|ws)s$/.test(i.protocol)&&(i.port="443")),i.path=i.path||"/";const s=i.host.indexOf(":")!==-1?"["+i.host+"]":i.host;return i.id=i.protocol+"://"+s+":"+i.port+e,i.href=i.protocol+"://"+s+(t&&t.port===i.port?"":":"+i.port),i}const Nle=typeof ArrayBuffer=="function",Ple=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,$K=Object.prototype.toString,kle=typeof Blob=="function"||typeof Blob<"u"&&$K.call(Blob)==="[object BlobConstructor]",Lle=typeof File=="function"||typeof File<"u"&&$K.call(File)==="[object FileConstructor]";function ok(n){return Nle&&(n instanceof ArrayBuffer||Ple(n))||kle&&n instanceof Blob||Lle&&n instanceof File}function hS(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,i=n.length;t<i;t++)if(hS(n[t]))return!0;return!1}if(ok(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return hS(n.toJSON(),!0);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&hS(n[t]))return!0;return!1}function Dle(n){const e=[],t=n.data,i=n;return i.data=zR(t,e),i.attachments=e.length,{packet:i,buffers:e}}function zR(n,e){if(!n)return n;if(ok(n)){const t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){const t=new Array(n.length);for(let i=0;i<n.length;i++)t[i]=zR(n[i],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){const t={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=zR(n[i],e));return t}return n}function Ole(n,e){return n.data=jR(n.data,e),delete n.attachments,n}function jR(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=jR(n[t],e);else if(typeof n=="object")for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=jR(n[t],e));return n}const GK=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ble=5;var si;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(si||(si={}));let Ule=class{constructor(e){this.replacer=e}encode(e){return(e.type===si.EVENT||e.type===si.ACK)&&hS(e)?this.encodeAsBinary({type:e.type===si.EVENT?si.BINARY_EVENT:si.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===si.BINARY_EVENT||e.type===si.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Dle(e),i=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(i),r}},Fle=class WK extends fs{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const i=t.type===si.BINARY_EVENT;i||t.type===si.BINARY_ACK?(t.type=i?si.EVENT:si.ACK,this.reconstructor=new zle(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(ok(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const i={type:Number(e.charAt(0))};if(si[i.type]===void 0)throw new Error("unknown packet type "+i.type);if(i.type===si.BINARY_EVENT||i.type===si.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");i.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););i.nsp=e.substring(s,t)}else i.nsp="/";const r=e.charAt(t+1);if(r!==""&&Number(r)==r){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}i.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(WK.isPayloadValid(i.type,s))i.data=s;else throw new Error("invalid payload")}return i}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case si.CONNECT:return v6(t);case si.DISCONNECT:return t===void 0;case si.CONNECT_ERROR:return typeof t=="string"||v6(t);case si.EVENT:case si.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&GK.indexOf(t[0])===-1);case si.ACK:case si.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}};class zle{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Ole(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function jle(n){return typeof n=="string"}const Vle=Number.isInteger||function(n){return typeof n=="number"&&isFinite(n)&&Math.floor(n)===n};function Hle(n){return n===void 0||Vle(n)}function v6(n){return Object.prototype.toString.call(n)==="[object Object]"}function $le(n,e){switch(n){case si.CONNECT:return e===void 0||v6(e);case si.DISCONNECT:return e===void 0;case si.EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&GK.indexOf(e[0])===-1);case si.ACK:return Array.isArray(e);case si.CONNECT_ERROR:return typeof e=="string"||v6(e);default:return!1}}function Gle(n){return jle(n.nsp)&&Hle(n.id)&&$le(n.type,n.data)}const Wle=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Fle,Encoder:Ule,get PacketType(){return si},isPacketValid:Gle,protocol:Ble},Symbol.toStringTag,{value:"Module"}));function Kc(n,e,t){return n.on(e,t),function(){n.off(e,t)}}const Kle=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class KK extends fs{constructor(e,t,i){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,i&&i.auth&&(this.auth=i.auth),this._opts=Object.assign({},i),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Kc(e,"open",this.onopen.bind(this)),Kc(e,"packet",this.onpacket.bind(this)),Kc(e,"error",this.onerror.bind(this)),Kc(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var i,r,s;if(Kle.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:si.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const u=this.ids++,h=t.pop();this._registerAckCallback(u,h),o.id=u}const a=(r=(i=this.io.engine)===null||i===void 0?void 0:i.transport)===null||r===void 0?void 0:r.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var i;const r=(i=this.flags.timeout)!==null&&i!==void 0?i:this._opts.ackTimeout;if(r===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},r),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((i,r)=>{const s=(o,a)=>o?r(o):i(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const i={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...s)=>(this._queue[0],r!==null?i.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(r)):(this._queue.shift(),t&&t(null,...s)),i.pending=!1,this._drainQueue())),this._queue.push(i),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:si.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(i=>String(i.id)===e)){const i=this.acks[e];delete this.acks[e],i.withError&&i.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case si.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case si.EVENT:case si.BINARY_EVENT:this.onevent(e);break;case si.ACK:case si.BINARY_ACK:this.onack(e);break;case si.DISCONNECT:this.ondisconnect();break;case si.CONNECT_ERROR:this.destroy();const i=new Error(e.data.message);i.data=e.data.data,this.emitReserved("connect_error",i);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const i of t)i.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let i=!1;return function(...r){i||(i=!0,t.packet({type:si.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this._drainQueue(!0),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:si.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let i=0;i<t.length;i++)if(e===t[i])return t.splice(i,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const i of t)i.apply(this,e.data)}}}function ix(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}ix.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};ix.prototype.reset=function(){this.attempts=0};ix.prototype.setMin=function(n){this.ms=n};ix.prototype.setMax=function(n){this.max=n};ix.prototype.setJitter=function(n){this.jitter=n};class VR extends fs{constructor(e,t){var i;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,d7(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((i=t.randomizationFactor)!==null&&i!==void 0?i:.5),this.backoff=new ix({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||Wle;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Rle(this.uri,this.opts);const t=this.engine,i=this;this._readyState="opening",this.skipReconnect=!1;const r=Kc(t,"open",function(){i.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Kc(t,"error",s);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{r(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Kc(e,"ping",this.onping.bind(this)),Kc(e,"data",this.ondata.bind(this)),Kc(e,"error",this.onerror.bind(this)),Kc(e,"close",this.onclose.bind(this)),Kc(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){h7(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let i=this.nsps[e];return i?this._autoConnect&&!i.active&&i.connect():(i=new KK(this,e,t),this.nsps[e]=i),i}_destroy(e){const t=Object.keys(this.nsps);for(const i of t)if(this.nsps[i].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let i=0;i<t.length;i++)this.engine.write(t[i],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var i;this.cleanup(),(i=this.engine)===null||i===void 0||i.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const i=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},t);this.opts.autoUnref&&i.unref(),this.subs.push(()=>{this.clearTimeoutFn(i)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const rv={};function Ey(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};const t=Ile(n,e.path||"/socket.io"),i=t.source,r=t.id,s=t.path,o=rv[r]&&s in rv[r].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new VR(i,e):(rv[r]||(rv[r]=new VR(i,e)),l=rv[r]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(Ey,{Manager:VR,Socket:KK,io:Ey,connect:Ey});function qle(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qK={exports:{}};const Zle={},Yle=Object.freeze(Object.defineProperty({__proto__:null,default:Zle},Symbol.toStringTag,{value:"Module"})),f7=kre(Yle);(function(n){(function(e){var t=function(X){var se,te=new Float64Array(16);if(X)for(se=0;se<X.length;se++)te[se]=X[se];return te},i=function(){throw new Error("no PRNG")},r=new Uint8Array(16),s=new Uint8Array(32);s[0]=9;var o=t(),a=t([1]),l=t([56129,1]),c=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),u=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),h=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),p=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),m=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function y(X,se,te,z){X[se]=te>>24&255,X[se+1]=te>>16&255,X[se+2]=te>>8&255,X[se+3]=te&255,X[se+4]=z>>24&255,X[se+5]=z>>16&255,X[se+6]=z>>8&255,X[se+7]=z&255}function b(X,se,te,z,le){var je,Ke=0;for(je=0;je<le;je++)Ke|=X[se+je]^te[z+je];return(1&Ke-1>>>8)-1}function w(X,se,te,z){return b(X,se,te,z,16)}function v(X,se,te,z){return b(X,se,te,z,32)}function T(X,se,te,z){for(var le=z[0]&255|(z[1]&255)<<8|(z[2]&255)<<16|(z[3]&255)<<24,je=te[0]&255|(te[1]&255)<<8|(te[2]&255)<<16|(te[3]&255)<<24,Ke=te[4]&255|(te[5]&255)<<8|(te[6]&255)<<16|(te[7]&255)<<24,St=te[8]&255|(te[9]&255)<<8|(te[10]&255)<<16|(te[11]&255)<<24,It=te[12]&255|(te[13]&255)<<8|(te[14]&255)<<16|(te[15]&255)<<24,Yt=z[4]&255|(z[5]&255)<<8|(z[6]&255)<<16|(z[7]&255)<<24,Ht=se[0]&255|(se[1]&255)<<8|(se[2]&255)<<16|(se[3]&255)<<24,$n=se[4]&255|(se[5]&255)<<8|(se[6]&255)<<16|(se[7]&255)<<24,Kt=se[8]&255|(se[9]&255)<<8|(se[10]&255)<<16|(se[11]&255)<<24,Sn=se[12]&255|(se[13]&255)<<8|(se[14]&255)<<16|(se[15]&255)<<24,Mn=z[8]&255|(z[9]&255)<<8|(z[10]&255)<<16|(z[11]&255)<<24,kn=te[16]&255|(te[17]&255)<<8|(te[18]&255)<<16|(te[19]&255)<<24,Ln=te[20]&255|(te[21]&255)<<8|(te[22]&255)<<16|(te[23]&255)<<24,vn=te[24]&255|(te[25]&255)<<8|(te[26]&255)<<16|(te[27]&255)<<24,bn=te[28]&255|(te[29]&255)<<8|(te[30]&255)<<16|(te[31]&255)<<24,ie=z[12]&255|(z[13]&255)<<8|(z[14]&255)<<16|(z[15]&255)<<24,_e=le,ke=je,Re=Ke,Te=St,it=It,rt=Yt,we=Ht,Ee=$n,De=Kt,Le=Sn,ae=Mn,be=kn,Ue=Ln,We=vn,st=bn,_t=ie,ce,Bt=0;Bt<20;Bt+=2)ce=_e+Ue|0,it^=ce<<7|ce>>>32-7,ce=it+_e|0,De^=ce<<9|ce>>>32-9,ce=De+it|0,Ue^=ce<<13|ce>>>32-13,ce=Ue+De|0,_e^=ce<<18|ce>>>32-18,ce=rt+ke|0,Le^=ce<<7|ce>>>32-7,ce=Le+rt|0,We^=ce<<9|ce>>>32-9,ce=We+Le|0,ke^=ce<<13|ce>>>32-13,ce=ke+We|0,rt^=ce<<18|ce>>>32-18,ce=ae+we|0,st^=ce<<7|ce>>>32-7,ce=st+ae|0,Re^=ce<<9|ce>>>32-9,ce=Re+st|0,we^=ce<<13|ce>>>32-13,ce=we+Re|0,ae^=ce<<18|ce>>>32-18,ce=_t+be|0,Te^=ce<<7|ce>>>32-7,ce=Te+_t|0,Ee^=ce<<9|ce>>>32-9,ce=Ee+Te|0,be^=ce<<13|ce>>>32-13,ce=be+Ee|0,_t^=ce<<18|ce>>>32-18,ce=_e+Te|0,ke^=ce<<7|ce>>>32-7,ce=ke+_e|0,Re^=ce<<9|ce>>>32-9,ce=Re+ke|0,Te^=ce<<13|ce>>>32-13,ce=Te+Re|0,_e^=ce<<18|ce>>>32-18,ce=rt+it|0,we^=ce<<7|ce>>>32-7,ce=we+rt|0,Ee^=ce<<9|ce>>>32-9,ce=Ee+we|0,it^=ce<<13|ce>>>32-13,ce=it+Ee|0,rt^=ce<<18|ce>>>32-18,ce=ae+Le|0,be^=ce<<7|ce>>>32-7,ce=be+ae|0,De^=ce<<9|ce>>>32-9,ce=De+be|0,Le^=ce<<13|ce>>>32-13,ce=Le+De|0,ae^=ce<<18|ce>>>32-18,ce=_t+st|0,Ue^=ce<<7|ce>>>32-7,ce=Ue+_t|0,We^=ce<<9|ce>>>32-9,ce=We+Ue|0,st^=ce<<13|ce>>>32-13,ce=st+We|0,_t^=ce<<18|ce>>>32-18;_e=_e+le|0,ke=ke+je|0,Re=Re+Ke|0,Te=Te+St|0,it=it+It|0,rt=rt+Yt|0,we=we+Ht|0,Ee=Ee+$n|0,De=De+Kt|0,Le=Le+Sn|0,ae=ae+Mn|0,be=be+kn|0,Ue=Ue+Ln|0,We=We+vn|0,st=st+bn|0,_t=_t+ie|0,X[0]=_e>>>0&255,X[1]=_e>>>8&255,X[2]=_e>>>16&255,X[3]=_e>>>24&255,X[4]=ke>>>0&255,X[5]=ke>>>8&255,X[6]=ke>>>16&255,X[7]=ke>>>24&255,X[8]=Re>>>0&255,X[9]=Re>>>8&255,X[10]=Re>>>16&255,X[11]=Re>>>24&255,X[12]=Te>>>0&255,X[13]=Te>>>8&255,X[14]=Te>>>16&255,X[15]=Te>>>24&255,X[16]=it>>>0&255,X[17]=it>>>8&255,X[18]=it>>>16&255,X[19]=it>>>24&255,X[20]=rt>>>0&255,X[21]=rt>>>8&255,X[22]=rt>>>16&255,X[23]=rt>>>24&255,X[24]=we>>>0&255,X[25]=we>>>8&255,X[26]=we>>>16&255,X[27]=we>>>24&255,X[28]=Ee>>>0&255,X[29]=Ee>>>8&255,X[30]=Ee>>>16&255,X[31]=Ee>>>24&255,X[32]=De>>>0&255,X[33]=De>>>8&255,X[34]=De>>>16&255,X[35]=De>>>24&255,X[36]=Le>>>0&255,X[37]=Le>>>8&255,X[38]=Le>>>16&255,X[39]=Le>>>24&255,X[40]=ae>>>0&255,X[41]=ae>>>8&255,X[42]=ae>>>16&255,X[43]=ae>>>24&255,X[44]=be>>>0&255,X[45]=be>>>8&255,X[46]=be>>>16&255,X[47]=be>>>24&255,X[48]=Ue>>>0&255,X[49]=Ue>>>8&255,X[50]=Ue>>>16&255,X[51]=Ue>>>24&255,X[52]=We>>>0&255,X[53]=We>>>8&255,X[54]=We>>>16&255,X[55]=We>>>24&255,X[56]=st>>>0&255,X[57]=st>>>8&255,X[58]=st>>>16&255,X[59]=st>>>24&255,X[60]=_t>>>0&255,X[61]=_t>>>8&255,X[62]=_t>>>16&255,X[63]=_t>>>24&255}function S(X,se,te,z){for(var le=z[0]&255|(z[1]&255)<<8|(z[2]&255)<<16|(z[3]&255)<<24,je=te[0]&255|(te[1]&255)<<8|(te[2]&255)<<16|(te[3]&255)<<24,Ke=te[4]&255|(te[5]&255)<<8|(te[6]&255)<<16|(te[7]&255)<<24,St=te[8]&255|(te[9]&255)<<8|(te[10]&255)<<16|(te[11]&255)<<24,It=te[12]&255|(te[13]&255)<<8|(te[14]&255)<<16|(te[15]&255)<<24,Yt=z[4]&255|(z[5]&255)<<8|(z[6]&255)<<16|(z[7]&255)<<24,Ht=se[0]&255|(se[1]&255)<<8|(se[2]&255)<<16|(se[3]&255)<<24,$n=se[4]&255|(se[5]&255)<<8|(se[6]&255)<<16|(se[7]&255)<<24,Kt=se[8]&255|(se[9]&255)<<8|(se[10]&255)<<16|(se[11]&255)<<24,Sn=se[12]&255|(se[13]&255)<<8|(se[14]&255)<<16|(se[15]&255)<<24,Mn=z[8]&255|(z[9]&255)<<8|(z[10]&255)<<16|(z[11]&255)<<24,kn=te[16]&255|(te[17]&255)<<8|(te[18]&255)<<16|(te[19]&255)<<24,Ln=te[20]&255|(te[21]&255)<<8|(te[22]&255)<<16|(te[23]&255)<<24,vn=te[24]&255|(te[25]&255)<<8|(te[26]&255)<<16|(te[27]&255)<<24,bn=te[28]&255|(te[29]&255)<<8|(te[30]&255)<<16|(te[31]&255)<<24,ie=z[12]&255|(z[13]&255)<<8|(z[14]&255)<<16|(z[15]&255)<<24,_e=le,ke=je,Re=Ke,Te=St,it=It,rt=Yt,we=Ht,Ee=$n,De=Kt,Le=Sn,ae=Mn,be=kn,Ue=Ln,We=vn,st=bn,_t=ie,ce,Bt=0;Bt<20;Bt+=2)ce=_e+Ue|0,it^=ce<<7|ce>>>32-7,ce=it+_e|0,De^=ce<<9|ce>>>32-9,ce=De+it|0,Ue^=ce<<13|ce>>>32-13,ce=Ue+De|0,_e^=ce<<18|ce>>>32-18,ce=rt+ke|0,Le^=ce<<7|ce>>>32-7,ce=Le+rt|0,We^=ce<<9|ce>>>32-9,ce=We+Le|0,ke^=ce<<13|ce>>>32-13,ce=ke+We|0,rt^=ce<<18|ce>>>32-18,ce=ae+we|0,st^=ce<<7|ce>>>32-7,ce=st+ae|0,Re^=ce<<9|ce>>>32-9,ce=Re+st|0,we^=ce<<13|ce>>>32-13,ce=we+Re|0,ae^=ce<<18|ce>>>32-18,ce=_t+be|0,Te^=ce<<7|ce>>>32-7,ce=Te+_t|0,Ee^=ce<<9|ce>>>32-9,ce=Ee+Te|0,be^=ce<<13|ce>>>32-13,ce=be+Ee|0,_t^=ce<<18|ce>>>32-18,ce=_e+Te|0,ke^=ce<<7|ce>>>32-7,ce=ke+_e|0,Re^=ce<<9|ce>>>32-9,ce=Re+ke|0,Te^=ce<<13|ce>>>32-13,ce=Te+Re|0,_e^=ce<<18|ce>>>32-18,ce=rt+it|0,we^=ce<<7|ce>>>32-7,ce=we+rt|0,Ee^=ce<<9|ce>>>32-9,ce=Ee+we|0,it^=ce<<13|ce>>>32-13,ce=it+Ee|0,rt^=ce<<18|ce>>>32-18,ce=ae+Le|0,be^=ce<<7|ce>>>32-7,ce=be+ae|0,De^=ce<<9|ce>>>32-9,ce=De+be|0,Le^=ce<<13|ce>>>32-13,ce=Le+De|0,ae^=ce<<18|ce>>>32-18,ce=_t+st|0,Ue^=ce<<7|ce>>>32-7,ce=Ue+_t|0,We^=ce<<9|ce>>>32-9,ce=We+Ue|0,st^=ce<<13|ce>>>32-13,ce=st+We|0,_t^=ce<<18|ce>>>32-18;X[0]=_e>>>0&255,X[1]=_e>>>8&255,X[2]=_e>>>16&255,X[3]=_e>>>24&255,X[4]=rt>>>0&255,X[5]=rt>>>8&255,X[6]=rt>>>16&255,X[7]=rt>>>24&255,X[8]=ae>>>0&255,X[9]=ae>>>8&255,X[10]=ae>>>16&255,X[11]=ae>>>24&255,X[12]=_t>>>0&255,X[13]=_t>>>8&255,X[14]=_t>>>16&255,X[15]=_t>>>24&255,X[16]=we>>>0&255,X[17]=we>>>8&255,X[18]=we>>>16&255,X[19]=we>>>24&255,X[20]=Ee>>>0&255,X[21]=Ee>>>8&255,X[22]=Ee>>>16&255,X[23]=Ee>>>24&255,X[24]=De>>>0&255,X[25]=De>>>8&255,X[26]=De>>>16&255,X[27]=De>>>24&255,X[28]=Le>>>0&255,X[29]=Le>>>8&255,X[30]=Le>>>16&255,X[31]=Le>>>24&255}function M(X,se,te,z){T(X,se,te,z)}function P(X,se,te,z){S(X,se,te,z)}var R=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function O(X,se,te,z,le,je,Ke){var St=new Uint8Array(16),It=new Uint8Array(64),Yt,Ht;for(Ht=0;Ht<16;Ht++)St[Ht]=0;for(Ht=0;Ht<8;Ht++)St[Ht]=je[Ht];for(;le>=64;){for(M(It,St,Ke,R),Ht=0;Ht<64;Ht++)X[se+Ht]=te[z+Ht]^It[Ht];for(Yt=1,Ht=8;Ht<16;Ht++)Yt=Yt+(St[Ht]&255)|0,St[Ht]=Yt&255,Yt>>>=8;le-=64,se+=64,z+=64}if(le>0)for(M(It,St,Ke,R),Ht=0;Ht<le;Ht++)X[se+Ht]=te[z+Ht]^It[Ht];return 0}function B(X,se,te,z,le){var je=new Uint8Array(16),Ke=new Uint8Array(64),St,It;for(It=0;It<16;It++)je[It]=0;for(It=0;It<8;It++)je[It]=z[It];for(;te>=64;){for(M(Ke,je,le,R),It=0;It<64;It++)X[se+It]=Ke[It];for(St=1,It=8;It<16;It++)St=St+(je[It]&255)|0,je[It]=St&255,St>>>=8;te-=64,se+=64}if(te>0)for(M(Ke,je,le,R),It=0;It<te;It++)X[se+It]=Ke[It];return 0}function N(X,se,te,z,le){var je=new Uint8Array(32);P(je,z,le,R);for(var Ke=new Uint8Array(8),St=0;St<8;St++)Ke[St]=z[St+16];return B(X,se,te,Ke,je)}function I(X,se,te,z,le,je,Ke){var St=new Uint8Array(32);P(St,je,Ke,R);for(var It=new Uint8Array(8),Yt=0;Yt<8;Yt++)It[Yt]=je[Yt+16];return O(X,se,te,z,le,It,St)}var F=function(X){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var se,te,z,le,je,Ke,St,It;se=X[0]&255|(X[1]&255)<<8,this.r[0]=se&8191,te=X[2]&255|(X[3]&255)<<8,this.r[1]=(se>>>13|te<<3)&8191,z=X[4]&255|(X[5]&255)<<8,this.r[2]=(te>>>10|z<<6)&7939,le=X[6]&255|(X[7]&255)<<8,this.r[3]=(z>>>7|le<<9)&8191,je=X[8]&255|(X[9]&255)<<8,this.r[4]=(le>>>4|je<<12)&255,this.r[5]=je>>>1&8190,Ke=X[10]&255|(X[11]&255)<<8,this.r[6]=(je>>>14|Ke<<2)&8191,St=X[12]&255|(X[13]&255)<<8,this.r[7]=(Ke>>>11|St<<5)&8065,It=X[14]&255|(X[15]&255)<<8,this.r[8]=(St>>>8|It<<8)&8191,this.r[9]=It>>>5&127,this.pad[0]=X[16]&255|(X[17]&255)<<8,this.pad[1]=X[18]&255|(X[19]&255)<<8,this.pad[2]=X[20]&255|(X[21]&255)<<8,this.pad[3]=X[22]&255|(X[23]&255)<<8,this.pad[4]=X[24]&255|(X[25]&255)<<8,this.pad[5]=X[26]&255|(X[27]&255)<<8,this.pad[6]=X[28]&255|(X[29]&255)<<8,this.pad[7]=X[30]&255|(X[31]&255)<<8};F.prototype.blocks=function(X,se,te){for(var z=this.fin?0:2048,le,je,Ke,St,It,Yt,Ht,$n,Kt,Sn,Mn,kn,Ln,vn,bn,ie,_e,ke,Re,Te=this.h[0],it=this.h[1],rt=this.h[2],we=this.h[3],Ee=this.h[4],De=this.h[5],Le=this.h[6],ae=this.h[7],be=this.h[8],Ue=this.h[9],We=this.r[0],st=this.r[1],_t=this.r[2],ce=this.r[3],Bt=this.r[4],Nt=this.r[5],hn=this.r[6],Rn=this.r[7],gn=this.r[8],fn=this.r[9];te>=16;)le=X[se+0]&255|(X[se+1]&255)<<8,Te+=le&8191,je=X[se+2]&255|(X[se+3]&255)<<8,it+=(le>>>13|je<<3)&8191,Ke=X[se+4]&255|(X[se+5]&255)<<8,rt+=(je>>>10|Ke<<6)&8191,St=X[se+6]&255|(X[se+7]&255)<<8,we+=(Ke>>>7|St<<9)&8191,It=X[se+8]&255|(X[se+9]&255)<<8,Ee+=(St>>>4|It<<12)&8191,De+=It>>>1&8191,Yt=X[se+10]&255|(X[se+11]&255)<<8,Le+=(It>>>14|Yt<<2)&8191,Ht=X[se+12]&255|(X[se+13]&255)<<8,ae+=(Yt>>>11|Ht<<5)&8191,$n=X[se+14]&255|(X[se+15]&255)<<8,be+=(Ht>>>8|$n<<8)&8191,Ue+=$n>>>5|z,Kt=0,Sn=Kt,Sn+=Te*We,Sn+=it*(5*fn),Sn+=rt*(5*gn),Sn+=we*(5*Rn),Sn+=Ee*(5*hn),Kt=Sn>>>13,Sn&=8191,Sn+=De*(5*Nt),Sn+=Le*(5*Bt),Sn+=ae*(5*ce),Sn+=be*(5*_t),Sn+=Ue*(5*st),Kt+=Sn>>>13,Sn&=8191,Mn=Kt,Mn+=Te*st,Mn+=it*We,Mn+=rt*(5*fn),Mn+=we*(5*gn),Mn+=Ee*(5*Rn),Kt=Mn>>>13,Mn&=8191,Mn+=De*(5*hn),Mn+=Le*(5*Nt),Mn+=ae*(5*Bt),Mn+=be*(5*ce),Mn+=Ue*(5*_t),Kt+=Mn>>>13,Mn&=8191,kn=Kt,kn+=Te*_t,kn+=it*st,kn+=rt*We,kn+=we*(5*fn),kn+=Ee*(5*gn),Kt=kn>>>13,kn&=8191,kn+=De*(5*Rn),kn+=Le*(5*hn),kn+=ae*(5*Nt),kn+=be*(5*Bt),kn+=Ue*(5*ce),Kt+=kn>>>13,kn&=8191,Ln=Kt,Ln+=Te*ce,Ln+=it*_t,Ln+=rt*st,Ln+=we*We,Ln+=Ee*(5*fn),Kt=Ln>>>13,Ln&=8191,Ln+=De*(5*gn),Ln+=Le*(5*Rn),Ln+=ae*(5*hn),Ln+=be*(5*Nt),Ln+=Ue*(5*Bt),Kt+=Ln>>>13,Ln&=8191,vn=Kt,vn+=Te*Bt,vn+=it*ce,vn+=rt*_t,vn+=we*st,vn+=Ee*We,Kt=vn>>>13,vn&=8191,vn+=De*(5*fn),vn+=Le*(5*gn),vn+=ae*(5*Rn),vn+=be*(5*hn),vn+=Ue*(5*Nt),Kt+=vn>>>13,vn&=8191,bn=Kt,bn+=Te*Nt,bn+=it*Bt,bn+=rt*ce,bn+=we*_t,bn+=Ee*st,Kt=bn>>>13,bn&=8191,bn+=De*We,bn+=Le*(5*fn),bn+=ae*(5*gn),bn+=be*(5*Rn),bn+=Ue*(5*hn),Kt+=bn>>>13,bn&=8191,ie=Kt,ie+=Te*hn,ie+=it*Nt,ie+=rt*Bt,ie+=we*ce,ie+=Ee*_t,Kt=ie>>>13,ie&=8191,ie+=De*st,ie+=Le*We,ie+=ae*(5*fn),ie+=be*(5*gn),ie+=Ue*(5*Rn),Kt+=ie>>>13,ie&=8191,_e=Kt,_e+=Te*Rn,_e+=it*hn,_e+=rt*Nt,_e+=we*Bt,_e+=Ee*ce,Kt=_e>>>13,_e&=8191,_e+=De*_t,_e+=Le*st,_e+=ae*We,_e+=be*(5*fn),_e+=Ue*(5*gn),Kt+=_e>>>13,_e&=8191,ke=Kt,ke+=Te*gn,ke+=it*Rn,ke+=rt*hn,ke+=we*Nt,ke+=Ee*Bt,Kt=ke>>>13,ke&=8191,ke+=De*ce,ke+=Le*_t,ke+=ae*st,ke+=be*We,ke+=Ue*(5*fn),Kt+=ke>>>13,ke&=8191,Re=Kt,Re+=Te*fn,Re+=it*gn,Re+=rt*Rn,Re+=we*hn,Re+=Ee*Nt,Kt=Re>>>13,Re&=8191,Re+=De*Bt,Re+=Le*ce,Re+=ae*_t,Re+=be*st,Re+=Ue*We,Kt+=Re>>>13,Re&=8191,Kt=(Kt<<2)+Kt|0,Kt=Kt+Sn|0,Sn=Kt&8191,Kt=Kt>>>13,Mn+=Kt,Te=Sn,it=Mn,rt=kn,we=Ln,Ee=vn,De=bn,Le=ie,ae=_e,be=ke,Ue=Re,se+=16,te-=16;this.h[0]=Te,this.h[1]=it,this.h[2]=rt,this.h[3]=we,this.h[4]=Ee,this.h[5]=De,this.h[6]=Le,this.h[7]=ae,this.h[8]=be,this.h[9]=Ue},F.prototype.finish=function(X,se){var te=new Uint16Array(10),z,le,je,Ke;if(this.leftover){for(Ke=this.leftover,this.buffer[Ke++]=1;Ke<16;Ke++)this.buffer[Ke]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(z=this.h[1]>>>13,this.h[1]&=8191,Ke=2;Ke<10;Ke++)this.h[Ke]+=z,z=this.h[Ke]>>>13,this.h[Ke]&=8191;for(this.h[0]+=z*5,z=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=z,z=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=z,te[0]=this.h[0]+5,z=te[0]>>>13,te[0]&=8191,Ke=1;Ke<10;Ke++)te[Ke]=this.h[Ke]+z,z=te[Ke]>>>13,te[Ke]&=8191;for(te[9]-=8192,le=(z^1)-1,Ke=0;Ke<10;Ke++)te[Ke]&=le;for(le=~le,Ke=0;Ke<10;Ke++)this.h[Ke]=this.h[Ke]&le|te[Ke];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,je=this.h[0]+this.pad[0],this.h[0]=je&65535,Ke=1;Ke<8;Ke++)je=(this.h[Ke]+this.pad[Ke]|0)+(je>>>16)|0,this.h[Ke]=je&65535;X[se+0]=this.h[0]>>>0&255,X[se+1]=this.h[0]>>>8&255,X[se+2]=this.h[1]>>>0&255,X[se+3]=this.h[1]>>>8&255,X[se+4]=this.h[2]>>>0&255,X[se+5]=this.h[2]>>>8&255,X[se+6]=this.h[3]>>>0&255,X[se+7]=this.h[3]>>>8&255,X[se+8]=this.h[4]>>>0&255,X[se+9]=this.h[4]>>>8&255,X[se+10]=this.h[5]>>>0&255,X[se+11]=this.h[5]>>>8&255,X[se+12]=this.h[6]>>>0&255,X[se+13]=this.h[6]>>>8&255,X[se+14]=this.h[7]>>>0&255,X[se+15]=this.h[7]>>>8&255},F.prototype.update=function(X,se,te){var z,le;if(this.leftover){for(le=16-this.leftover,le>te&&(le=te),z=0;z<le;z++)this.buffer[this.leftover+z]=X[se+z];if(te-=le,se+=le,this.leftover+=le,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(te>=16&&(le=te-te%16,this.blocks(X,se,le),se+=le,te-=le),te){for(z=0;z<te;z++)this.buffer[this.leftover+z]=X[se+z];this.leftover+=te}};function j(X,se,te,z,le,je){var Ke=new F(je);return Ke.update(te,z,le),Ke.finish(X,se),0}function W(X,se,te,z,le,je){var Ke=new Uint8Array(16);return j(Ke,0,te,z,le,je),w(X,se,Ke,0)}function U(X,se,te,z,le){var je;if(te<32)return-1;for(I(X,0,se,0,te,z,le),j(X,16,X,32,te-32,X),je=0;je<16;je++)X[je]=0;return 0}function H(X,se,te,z,le){var je,Ke=new Uint8Array(32);if(te<32||(N(Ke,0,32,z,le),W(se,16,se,32,te-32,Ke)!==0))return-1;for(I(X,0,se,0,te,z,le),je=0;je<32;je++)X[je]=0;return 0}function q(X,se){var te;for(te=0;te<16;te++)X[te]=se[te]|0}function J(X){var se,te,z=1;for(se=0;se<16;se++)te=X[se]+z+65535,z=Math.floor(te/65536),X[se]=te-z*65536;X[0]+=z-1+37*(z-1)}function G(X,se,te){for(var z,le=~(te-1),je=0;je<16;je++)z=le&(X[je]^se[je]),X[je]^=z,se[je]^=z}function ee(X,se){var te,z,le,je=t(),Ke=t();for(te=0;te<16;te++)Ke[te]=se[te];for(J(Ke),J(Ke),J(Ke),z=0;z<2;z++){for(je[0]=Ke[0]-65517,te=1;te<15;te++)je[te]=Ke[te]-65535-(je[te-1]>>16&1),je[te-1]&=65535;je[15]=Ke[15]-32767-(je[14]>>16&1),le=je[15]>>16&1,je[14]&=65535,G(Ke,je,1-le)}for(te=0;te<16;te++)X[2*te]=Ke[te]&255,X[2*te+1]=Ke[te]>>8}function Q(X,se){var te=new Uint8Array(32),z=new Uint8Array(32);return ee(te,X),ee(z,se),v(te,0,z,0)}function ne(X){var se=new Uint8Array(32);return ee(se,X),se[0]&1}function fe(X,se){var te;for(te=0;te<16;te++)X[te]=se[2*te]+(se[2*te+1]<<8);X[15]&=32767}function Ae(X,se,te){for(var z=0;z<16;z++)X[z]=se[z]+te[z]}function Pe(X,se,te){for(var z=0;z<16;z++)X[z]=se[z]-te[z]}function Ce(X,se,te){var z,le,je=0,Ke=0,St=0,It=0,Yt=0,Ht=0,$n=0,Kt=0,Sn=0,Mn=0,kn=0,Ln=0,vn=0,bn=0,ie=0,_e=0,ke=0,Re=0,Te=0,it=0,rt=0,we=0,Ee=0,De=0,Le=0,ae=0,be=0,Ue=0,We=0,st=0,_t=0,ce=te[0],Bt=te[1],Nt=te[2],hn=te[3],Rn=te[4],gn=te[5],fn=te[6],pn=te[7],En=te[8],Un=te[9],Fn=te[10],zn=te[11],Zi=te[12],Ni=te[13],wr=te[14],gr=te[15];z=se[0],je+=z*ce,Ke+=z*Bt,St+=z*Nt,It+=z*hn,Yt+=z*Rn,Ht+=z*gn,$n+=z*fn,Kt+=z*pn,Sn+=z*En,Mn+=z*Un,kn+=z*Fn,Ln+=z*zn,vn+=z*Zi,bn+=z*Ni,ie+=z*wr,_e+=z*gr,z=se[1],Ke+=z*ce,St+=z*Bt,It+=z*Nt,Yt+=z*hn,Ht+=z*Rn,$n+=z*gn,Kt+=z*fn,Sn+=z*pn,Mn+=z*En,kn+=z*Un,Ln+=z*Fn,vn+=z*zn,bn+=z*Zi,ie+=z*Ni,_e+=z*wr,ke+=z*gr,z=se[2],St+=z*ce,It+=z*Bt,Yt+=z*Nt,Ht+=z*hn,$n+=z*Rn,Kt+=z*gn,Sn+=z*fn,Mn+=z*pn,kn+=z*En,Ln+=z*Un,vn+=z*Fn,bn+=z*zn,ie+=z*Zi,_e+=z*Ni,ke+=z*wr,Re+=z*gr,z=se[3],It+=z*ce,Yt+=z*Bt,Ht+=z*Nt,$n+=z*hn,Kt+=z*Rn,Sn+=z*gn,Mn+=z*fn,kn+=z*pn,Ln+=z*En,vn+=z*Un,bn+=z*Fn,ie+=z*zn,_e+=z*Zi,ke+=z*Ni,Re+=z*wr,Te+=z*gr,z=se[4],Yt+=z*ce,Ht+=z*Bt,$n+=z*Nt,Kt+=z*hn,Sn+=z*Rn,Mn+=z*gn,kn+=z*fn,Ln+=z*pn,vn+=z*En,bn+=z*Un,ie+=z*Fn,_e+=z*zn,ke+=z*Zi,Re+=z*Ni,Te+=z*wr,it+=z*gr,z=se[5],Ht+=z*ce,$n+=z*Bt,Kt+=z*Nt,Sn+=z*hn,Mn+=z*Rn,kn+=z*gn,Ln+=z*fn,vn+=z*pn,bn+=z*En,ie+=z*Un,_e+=z*Fn,ke+=z*zn,Re+=z*Zi,Te+=z*Ni,it+=z*wr,rt+=z*gr,z=se[6],$n+=z*ce,Kt+=z*Bt,Sn+=z*Nt,Mn+=z*hn,kn+=z*Rn,Ln+=z*gn,vn+=z*fn,bn+=z*pn,ie+=z*En,_e+=z*Un,ke+=z*Fn,Re+=z*zn,Te+=z*Zi,it+=z*Ni,rt+=z*wr,we+=z*gr,z=se[7],Kt+=z*ce,Sn+=z*Bt,Mn+=z*Nt,kn+=z*hn,Ln+=z*Rn,vn+=z*gn,bn+=z*fn,ie+=z*pn,_e+=z*En,ke+=z*Un,Re+=z*Fn,Te+=z*zn,it+=z*Zi,rt+=z*Ni,we+=z*wr,Ee+=z*gr,z=se[8],Sn+=z*ce,Mn+=z*Bt,kn+=z*Nt,Ln+=z*hn,vn+=z*Rn,bn+=z*gn,ie+=z*fn,_e+=z*pn,ke+=z*En,Re+=z*Un,Te+=z*Fn,it+=z*zn,rt+=z*Zi,we+=z*Ni,Ee+=z*wr,De+=z*gr,z=se[9],Mn+=z*ce,kn+=z*Bt,Ln+=z*Nt,vn+=z*hn,bn+=z*Rn,ie+=z*gn,_e+=z*fn,ke+=z*pn,Re+=z*En,Te+=z*Un,it+=z*Fn,rt+=z*zn,we+=z*Zi,Ee+=z*Ni,De+=z*wr,Le+=z*gr,z=se[10],kn+=z*ce,Ln+=z*Bt,vn+=z*Nt,bn+=z*hn,ie+=z*Rn,_e+=z*gn,ke+=z*fn,Re+=z*pn,Te+=z*En,it+=z*Un,rt+=z*Fn,we+=z*zn,Ee+=z*Zi,De+=z*Ni,Le+=z*wr,ae+=z*gr,z=se[11],Ln+=z*ce,vn+=z*Bt,bn+=z*Nt,ie+=z*hn,_e+=z*Rn,ke+=z*gn,Re+=z*fn,Te+=z*pn,it+=z*En,rt+=z*Un,we+=z*Fn,Ee+=z*zn,De+=z*Zi,Le+=z*Ni,ae+=z*wr,be+=z*gr,z=se[12],vn+=z*ce,bn+=z*Bt,ie+=z*Nt,_e+=z*hn,ke+=z*Rn,Re+=z*gn,Te+=z*fn,it+=z*pn,rt+=z*En,we+=z*Un,Ee+=z*Fn,De+=z*zn,Le+=z*Zi,ae+=z*Ni,be+=z*wr,Ue+=z*gr,z=se[13],bn+=z*ce,ie+=z*Bt,_e+=z*Nt,ke+=z*hn,Re+=z*Rn,Te+=z*gn,it+=z*fn,rt+=z*pn,we+=z*En,Ee+=z*Un,De+=z*Fn,Le+=z*zn,ae+=z*Zi,be+=z*Ni,Ue+=z*wr,We+=z*gr,z=se[14],ie+=z*ce,_e+=z*Bt,ke+=z*Nt,Re+=z*hn,Te+=z*Rn,it+=z*gn,rt+=z*fn,we+=z*pn,Ee+=z*En,De+=z*Un,Le+=z*Fn,ae+=z*zn,be+=z*Zi,Ue+=z*Ni,We+=z*wr,st+=z*gr,z=se[15],_e+=z*ce,ke+=z*Bt,Re+=z*Nt,Te+=z*hn,it+=z*Rn,rt+=z*gn,we+=z*fn,Ee+=z*pn,De+=z*En,Le+=z*Un,ae+=z*Fn,be+=z*zn,Ue+=z*Zi,We+=z*Ni,st+=z*wr,_t+=z*gr,je+=38*ke,Ke+=38*Re,St+=38*Te,It+=38*it,Yt+=38*rt,Ht+=38*we,$n+=38*Ee,Kt+=38*De,Sn+=38*Le,Mn+=38*ae,kn+=38*be,Ln+=38*Ue,vn+=38*We,bn+=38*st,ie+=38*_t,le=1,z=je+le+65535,le=Math.floor(z/65536),je=z-le*65536,z=Ke+le+65535,le=Math.floor(z/65536),Ke=z-le*65536,z=St+le+65535,le=Math.floor(z/65536),St=z-le*65536,z=It+le+65535,le=Math.floor(z/65536),It=z-le*65536,z=Yt+le+65535,le=Math.floor(z/65536),Yt=z-le*65536,z=Ht+le+65535,le=Math.floor(z/65536),Ht=z-le*65536,z=$n+le+65535,le=Math.floor(z/65536),$n=z-le*65536,z=Kt+le+65535,le=Math.floor(z/65536),Kt=z-le*65536,z=Sn+le+65535,le=Math.floor(z/65536),Sn=z-le*65536,z=Mn+le+65535,le=Math.floor(z/65536),Mn=z-le*65536,z=kn+le+65535,le=Math.floor(z/65536),kn=z-le*65536,z=Ln+le+65535,le=Math.floor(z/65536),Ln=z-le*65536,z=vn+le+65535,le=Math.floor(z/65536),vn=z-le*65536,z=bn+le+65535,le=Math.floor(z/65536),bn=z-le*65536,z=ie+le+65535,le=Math.floor(z/65536),ie=z-le*65536,z=_e+le+65535,le=Math.floor(z/65536),_e=z-le*65536,je+=le-1+37*(le-1),le=1,z=je+le+65535,le=Math.floor(z/65536),je=z-le*65536,z=Ke+le+65535,le=Math.floor(z/65536),Ke=z-le*65536,z=St+le+65535,le=Math.floor(z/65536),St=z-le*65536,z=It+le+65535,le=Math.floor(z/65536),It=z-le*65536,z=Yt+le+65535,le=Math.floor(z/65536),Yt=z-le*65536,z=Ht+le+65535,le=Math.floor(z/65536),Ht=z-le*65536,z=$n+le+65535,le=Math.floor(z/65536),$n=z-le*65536,z=Kt+le+65535,le=Math.floor(z/65536),Kt=z-le*65536,z=Sn+le+65535,le=Math.floor(z/65536),Sn=z-le*65536,z=Mn+le+65535,le=Math.floor(z/65536),Mn=z-le*65536,z=kn+le+65535,le=Math.floor(z/65536),kn=z-le*65536,z=Ln+le+65535,le=Math.floor(z/65536),Ln=z-le*65536,z=vn+le+65535,le=Math.floor(z/65536),vn=z-le*65536,z=bn+le+65535,le=Math.floor(z/65536),bn=z-le*65536,z=ie+le+65535,le=Math.floor(z/65536),ie=z-le*65536,z=_e+le+65535,le=Math.floor(z/65536),_e=z-le*65536,je+=le-1+37*(le-1),X[0]=je,X[1]=Ke,X[2]=St,X[3]=It,X[4]=Yt,X[5]=Ht,X[6]=$n,X[7]=Kt,X[8]=Sn,X[9]=Mn,X[10]=kn,X[11]=Ln,X[12]=vn,X[13]=bn,X[14]=ie,X[15]=_e}function de(X,se){Ce(X,se,se)}function Ne(X,se){var te=t(),z;for(z=0;z<16;z++)te[z]=se[z];for(z=253;z>=0;z--)de(te,te),z!==2&&z!==4&&Ce(te,te,se);for(z=0;z<16;z++)X[z]=te[z]}function et(X,se){var te=t(),z;for(z=0;z<16;z++)te[z]=se[z];for(z=250;z>=0;z--)de(te,te),z!==1&&Ce(te,te,se);for(z=0;z<16;z++)X[z]=te[z]}function me(X,se,te){var z=new Uint8Array(32),le=new Float64Array(80),je,Ke,St=t(),It=t(),Yt=t(),Ht=t(),$n=t(),Kt=t();for(Ke=0;Ke<31;Ke++)z[Ke]=se[Ke];for(z[31]=se[31]&127|64,z[0]&=248,fe(le,te),Ke=0;Ke<16;Ke++)It[Ke]=le[Ke],Ht[Ke]=St[Ke]=Yt[Ke]=0;for(St[0]=Ht[0]=1,Ke=254;Ke>=0;--Ke)je=z[Ke>>>3]>>>(Ke&7)&1,G(St,It,je),G(Yt,Ht,je),Ae($n,St,Yt),Pe(St,St,Yt),Ae(Yt,It,Ht),Pe(It,It,Ht),de(Ht,$n),de(Kt,St),Ce(St,Yt,St),Ce(Yt,It,$n),Ae($n,St,Yt),Pe(St,St,Yt),de(It,St),Pe(Yt,Ht,Kt),Ce(St,Yt,l),Ae(St,St,Ht),Ce(Yt,Yt,St),Ce(St,Ht,Kt),Ce(Ht,It,le),de(It,$n),G(St,It,je),G(Yt,Ht,je);for(Ke=0;Ke<16;Ke++)le[Ke+16]=St[Ke],le[Ke+32]=Yt[Ke],le[Ke+48]=It[Ke],le[Ke+64]=Ht[Ke];var Sn=le.subarray(32),Mn=le.subarray(16);return Ne(Sn,Sn),Ce(Mn,Mn,Sn),ee(X,Mn),0}function nt(X,se){return me(X,se,s)}function Pt(X,se){return i(se,32),nt(X,se)}function zt(X,se,te){var z=new Uint8Array(32);return me(z,te,se),P(X,r,z,R)}var Dt=U,gt=H;function vt(X,se,te,z,le,je){var Ke=new Uint8Array(32);return zt(Ke,le,je),Dt(X,se,te,z,Ke)}function Oe(X,se,te,z,le,je){var Ke=new Uint8Array(32);return zt(Ke,le,je),gt(X,se,te,z,Ke)}var xt=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function pe(X,se,te,z){for(var le=new Int32Array(16),je=new Int32Array(16),Ke,St,It,Yt,Ht,$n,Kt,Sn,Mn,kn,Ln,vn,bn,ie,_e,ke,Re,Te,it,rt,we,Ee,De,Le,ae,be,Ue=X[0],We=X[1],st=X[2],_t=X[3],ce=X[4],Bt=X[5],Nt=X[6],hn=X[7],Rn=se[0],gn=se[1],fn=se[2],pn=se[3],En=se[4],Un=se[5],Fn=se[6],zn=se[7],Zi=0;z>=128;){for(it=0;it<16;it++)rt=8*it+Zi,le[it]=te[rt+0]<<24|te[rt+1]<<16|te[rt+2]<<8|te[rt+3],je[it]=te[rt+4]<<24|te[rt+5]<<16|te[rt+6]<<8|te[rt+7];for(it=0;it<80;it++)if(Ke=Ue,St=We,It=st,Yt=_t,Ht=ce,$n=Bt,Kt=Nt,Sn=hn,Mn=Rn,kn=gn,Ln=fn,vn=pn,bn=En,ie=Un,_e=Fn,ke=zn,we=hn,Ee=zn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=(ce>>>14|En<<32-14)^(ce>>>18|En<<32-18)^(En>>>41-32|ce<<32-(41-32)),Ee=(En>>>14|ce<<32-14)^(En>>>18|ce<<32-18)^(ce>>>41-32|En<<32-(41-32)),De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,we=ce&Bt^~ce&Nt,Ee=En&Un^~En&Fn,De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,we=xt[it*2],Ee=xt[it*2+1],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,we=le[it%16],Ee=je[it%16],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,Re=ae&65535|be<<16,Te=De&65535|Le<<16,we=Re,Ee=Te,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=(Ue>>>28|Rn<<32-28)^(Rn>>>34-32|Ue<<32-(34-32))^(Rn>>>39-32|Ue<<32-(39-32)),Ee=(Rn>>>28|Ue<<32-28)^(Ue>>>34-32|Rn<<32-(34-32))^(Ue>>>39-32|Rn<<32-(39-32)),De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,we=Ue&We^Ue&st^We&st,Ee=Rn&gn^Rn&fn^gn&fn,De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,Sn=ae&65535|be<<16,ke=De&65535|Le<<16,we=Yt,Ee=vn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=Re,Ee=Te,De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,Yt=ae&65535|be<<16,vn=De&65535|Le<<16,We=Ke,st=St,_t=It,ce=Yt,Bt=Ht,Nt=$n,hn=Kt,Ue=Sn,gn=Mn,fn=kn,pn=Ln,En=vn,Un=bn,Fn=ie,zn=_e,Rn=ke,it%16===15)for(rt=0;rt<16;rt++)we=le[rt],Ee=je[rt],De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=le[(rt+9)%16],Ee=je[(rt+9)%16],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Re=le[(rt+1)%16],Te=je[(rt+1)%16],we=(Re>>>1|Te<<32-1)^(Re>>>8|Te<<32-8)^Re>>>7,Ee=(Te>>>1|Re<<32-1)^(Te>>>8|Re<<32-8)^(Te>>>7|Re<<32-7),De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Re=le[(rt+14)%16],Te=je[(rt+14)%16],we=(Re>>>19|Te<<32-19)^(Te>>>61-32|Re<<32-(61-32))^Re>>>6,Ee=(Te>>>19|Re<<32-19)^(Re>>>61-32|Te<<32-(61-32))^(Te>>>6|Re<<32-6),De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,le[rt]=ae&65535|be<<16,je[rt]=De&65535|Le<<16;we=Ue,Ee=Rn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[0],Ee=se[0],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[0]=Ue=ae&65535|be<<16,se[0]=Rn=De&65535|Le<<16,we=We,Ee=gn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[1],Ee=se[1],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[1]=We=ae&65535|be<<16,se[1]=gn=De&65535|Le<<16,we=st,Ee=fn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[2],Ee=se[2],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[2]=st=ae&65535|be<<16,se[2]=fn=De&65535|Le<<16,we=_t,Ee=pn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[3],Ee=se[3],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[3]=_t=ae&65535|be<<16,se[3]=pn=De&65535|Le<<16,we=ce,Ee=En,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[4],Ee=se[4],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[4]=ce=ae&65535|be<<16,se[4]=En=De&65535|Le<<16,we=Bt,Ee=Un,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[5],Ee=se[5],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[5]=Bt=ae&65535|be<<16,se[5]=Un=De&65535|Le<<16,we=Nt,Ee=Fn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[6],Ee=se[6],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[6]=Nt=ae&65535|be<<16,se[6]=Fn=De&65535|Le<<16,we=hn,Ee=zn,De=Ee&65535,Le=Ee>>>16,ae=we&65535,be=we>>>16,we=X[7],Ee=se[7],De+=Ee&65535,Le+=Ee>>>16,ae+=we&65535,be+=we>>>16,Le+=De>>>16,ae+=Le>>>16,be+=ae>>>16,X[7]=hn=ae&65535|be<<16,se[7]=zn=De&65535|Le<<16,Zi+=128,z-=128}return z}function qe(X,se,te){var z=new Int32Array(8),le=new Int32Array(8),je=new Uint8Array(256),Ke,St=te;for(z[0]=1779033703,z[1]=3144134277,z[2]=1013904242,z[3]=2773480762,z[4]=1359893119,z[5]=2600822924,z[6]=528734635,z[7]=1541459225,le[0]=4089235720,le[1]=2227873595,le[2]=4271175723,le[3]=1595750129,le[4]=2917565137,le[5]=725511199,le[6]=4215389547,le[7]=327033209,pe(z,le,se,te),te%=128,Ke=0;Ke<te;Ke++)je[Ke]=se[St-te+Ke];for(je[te]=128,te=256-128*(te<112?1:0),je[te-9]=0,y(je,te-8,St/536870912|0,St<<3),pe(z,le,je,te),Ke=0;Ke<8;Ke++)y(X,8*Ke,z[Ke],le[Ke]);return 0}function $e(X,se){var te=t(),z=t(),le=t(),je=t(),Ke=t(),St=t(),It=t(),Yt=t(),Ht=t();Pe(te,X[1],X[0]),Pe(Ht,se[1],se[0]),Ce(te,te,Ht),Ae(z,X[0],X[1]),Ae(Ht,se[0],se[1]),Ce(z,z,Ht),Ce(le,X[3],se[3]),Ce(le,le,u),Ce(je,X[2],se[2]),Ae(je,je,je),Pe(Ke,z,te),Pe(St,je,le),Ae(It,je,le),Ae(Yt,z,te),Ce(X[0],Ke,St),Ce(X[1],Yt,It),Ce(X[2],It,St),Ce(X[3],Ke,Yt)}function Xe(X,se,te){var z;for(z=0;z<4;z++)G(X[z],se[z],te)}function Ye(X,se){var te=t(),z=t(),le=t();Ne(le,se[2]),Ce(te,se[0],le),Ce(z,se[1],le),ee(X,z),X[31]^=ne(te)<<7}function oe(X,se,te){var z,le;for(q(X[0],o),q(X[1],a),q(X[2],a),q(X[3],o),le=255;le>=0;--le)z=te[le/8|0]>>(le&7)&1,Xe(X,se,z),$e(se,X),$e(X,X),Xe(X,se,z)}function Z(X,se){var te=[t(),t(),t(),t()];q(te[0],h),q(te[1],p),q(te[2],a),Ce(te[3],h,p),oe(X,te,se)}function he(X,se,te){var z=new Uint8Array(64),le=[t(),t(),t(),t()],je;for(te||i(se,32),qe(z,se,32),z[0]&=248,z[31]&=127,z[31]|=64,Z(le,z),Ye(X,le),je=0;je<32;je++)se[je+32]=X[je];return 0}var Ge=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ct(X,se){var te,z,le,je;for(z=63;z>=32;--z){for(te=0,le=z-32,je=z-12;le<je;++le)se[le]+=te-16*se[z]*Ge[le-(z-32)],te=Math.floor((se[le]+128)/256),se[le]-=te*256;se[le]+=te,se[z]=0}for(te=0,le=0;le<32;le++)se[le]+=te-(se[31]>>4)*Ge[le],te=se[le]>>8,se[le]&=255;for(le=0;le<32;le++)se[le]-=te*Ge[le];for(z=0;z<32;z++)se[z+1]+=se[z]>>8,X[z]=se[z]&255}function tt(X){var se=new Float64Array(64),te;for(te=0;te<64;te++)se[te]=X[te];for(te=0;te<64;te++)X[te]=0;ct(X,se)}function Lt(X,se,te,z){var le=new Uint8Array(64),je=new Uint8Array(64),Ke=new Uint8Array(64),St,It,Yt=new Float64Array(64),Ht=[t(),t(),t(),t()];qe(le,z,32),le[0]&=248,le[31]&=127,le[31]|=64;var $n=te+64;for(St=0;St<te;St++)X[64+St]=se[St];for(St=0;St<32;St++)X[32+St]=le[32+St];for(qe(Ke,X.subarray(32),te+32),tt(Ke),Z(Ht,Ke),Ye(X,Ht),St=32;St<64;St++)X[St]=z[St];for(qe(je,X,te+64),tt(je),St=0;St<64;St++)Yt[St]=0;for(St=0;St<32;St++)Yt[St]=Ke[St];for(St=0;St<32;St++)for(It=0;It<32;It++)Yt[St+It]+=je[St]*le[It];return ct(X.subarray(32),Yt),$n}function Ct(X,se){var te=t(),z=t(),le=t(),je=t(),Ke=t(),St=t(),It=t();return q(X[2],a),fe(X[1],se),de(le,X[1]),Ce(je,le,c),Pe(le,le,X[2]),Ae(je,X[2],je),de(Ke,je),de(St,Ke),Ce(It,St,Ke),Ce(te,It,le),Ce(te,te,je),et(te,te),Ce(te,te,le),Ce(te,te,je),Ce(te,te,je),Ce(X[0],te,je),de(z,X[0]),Ce(z,z,je),Q(z,le)&&Ce(X[0],X[0],m),de(z,X[0]),Ce(z,z,je),Q(z,le)?-1:(ne(X[0])===se[31]>>7&&Pe(X[0],o,X[0]),Ce(X[3],X[0],X[1]),0)}function Ot(X,se,te,z){var le,je=new Uint8Array(32),Ke=new Uint8Array(64),St=[t(),t(),t(),t()],It=[t(),t(),t(),t()];if(te<64||Ct(It,z))return-1;for(le=0;le<te;le++)X[le]=se[le];for(le=0;le<32;le++)X[le+32]=z[le];if(qe(Ke,X,te),tt(Ke),oe(St,It,Ke),Z(It,se.subarray(32)),$e(St,It),Ye(je,St),te-=64,v(se,0,je,0)){for(le=0;le<te;le++)X[le]=0;return-1}for(le=0;le<te;le++)X[le]=se[le+64];return te}var nn=32,Tt=24,Ve=32,ut=16,ue=32,Ie=32,ft=32,xe=32,pt=32,ge=Tt,Qe=Ve,ht=ut,at=64,yt=32,Gt=64,on=32,mn=64;e.lowlevel={crypto_core_hsalsa20:P,crypto_stream_xor:I,crypto_stream:N,crypto_stream_salsa20_xor:O,crypto_stream_salsa20:B,crypto_onetimeauth:j,crypto_onetimeauth_verify:W,crypto_verify_16:w,crypto_verify_32:v,crypto_secretbox:U,crypto_secretbox_open:H,crypto_scalarmult:me,crypto_scalarmult_base:nt,crypto_box_beforenm:zt,crypto_box_afternm:Dt,crypto_box:vt,crypto_box_open:Oe,crypto_box_keypair:Pt,crypto_hash:qe,crypto_sign:Lt,crypto_sign_keypair:he,crypto_sign_open:Ot,crypto_secretbox_KEYBYTES:nn,crypto_secretbox_NONCEBYTES:Tt,crypto_secretbox_ZEROBYTES:Ve,crypto_secretbox_BOXZEROBYTES:ut,crypto_scalarmult_BYTES:ue,crypto_scalarmult_SCALARBYTES:Ie,crypto_box_PUBLICKEYBYTES:ft,crypto_box_SECRETKEYBYTES:xe,crypto_box_BEFORENMBYTES:pt,crypto_box_NONCEBYTES:ge,crypto_box_ZEROBYTES:Qe,crypto_box_BOXZEROBYTES:ht,crypto_sign_BYTES:at,crypto_sign_PUBLICKEYBYTES:yt,crypto_sign_SECRETKEYBYTES:Gt,crypto_sign_SEEDBYTES:on,crypto_hash_BYTES:mn,gf:t,D:c,L:Ge,pack25519:ee,unpack25519:fe,M:Ce,A:Ae,S:de,Z:Pe,pow2523:et,add:$e,set25519:q,modL:ct,scalarmult:oe,scalarbase:Z};function Cn(X,se){if(X.length!==nn)throw new Error("bad key size");if(se.length!==Tt)throw new Error("bad nonce size")}function gi(X,se){if(X.length!==ft)throw new Error("bad public key size");if(se.length!==xe)throw new Error("bad secret key size")}function $r(){for(var X=0;X<arguments.length;X++)if(!(arguments[X]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function Il(X){for(var se=0;se<X.length;se++)X[se]=0}e.randomBytes=function(X){var se=new Uint8Array(X);return i(se,X),se},e.secretbox=function(X,se,te){$r(X,se,te),Cn(te,se);for(var z=new Uint8Array(Ve+X.length),le=new Uint8Array(z.length),je=0;je<X.length;je++)z[je+Ve]=X[je];return U(le,z,z.length,se,te),le.subarray(ut)},e.secretbox.open=function(X,se,te){$r(X,se,te),Cn(te,se);for(var z=new Uint8Array(ut+X.length),le=new Uint8Array(z.length),je=0;je<X.length;je++)z[je+ut]=X[je];return z.length<32||H(le,z,z.length,se,te)!==0?null:le.subarray(Ve)},e.secretbox.keyLength=nn,e.secretbox.nonceLength=Tt,e.secretbox.overheadLength=ut,e.scalarMult=function(X,se){if($r(X,se),X.length!==Ie)throw new Error("bad n size");if(se.length!==ue)throw new Error("bad p size");var te=new Uint8Array(ue);return me(te,X,se),te},e.scalarMult.base=function(X){if($r(X),X.length!==Ie)throw new Error("bad n size");var se=new Uint8Array(ue);return nt(se,X),se},e.scalarMult.scalarLength=Ie,e.scalarMult.groupElementLength=ue,e.box=function(X,se,te,z){var le=e.box.before(te,z);return e.secretbox(X,se,le)},e.box.before=function(X,se){$r(X,se),gi(X,se);var te=new Uint8Array(pt);return zt(te,X,se),te},e.box.after=e.secretbox,e.box.open=function(X,se,te,z){var le=e.box.before(te,z);return e.secretbox.open(X,se,le)},e.box.open.after=e.secretbox.open,e.box.keyPair=function(){var X=new Uint8Array(ft),se=new Uint8Array(xe);return Pt(X,se),{publicKey:X,secretKey:se}},e.box.keyPair.fromSecretKey=function(X){if($r(X),X.length!==xe)throw new Error("bad secret key size");var se=new Uint8Array(ft);return nt(se,X),{publicKey:se,secretKey:new Uint8Array(X)}},e.box.publicKeyLength=ft,e.box.secretKeyLength=xe,e.box.sharedKeyLength=pt,e.box.nonceLength=ge,e.box.overheadLength=e.secretbox.overheadLength,e.sign=function(X,se){if($r(X,se),se.length!==Gt)throw new Error("bad secret key size");var te=new Uint8Array(at+X.length);return Lt(te,X,X.length,se),te},e.sign.open=function(X,se){if($r(X,se),se.length!==yt)throw new Error("bad public key size");var te=new Uint8Array(X.length),z=Ot(te,X,X.length,se);if(z<0)return null;for(var le=new Uint8Array(z),je=0;je<le.length;je++)le[je]=te[je];return le},e.sign.detached=function(X,se){for(var te=e.sign(X,se),z=new Uint8Array(at),le=0;le<z.length;le++)z[le]=te[le];return z},e.sign.detached.verify=function(X,se,te){if($r(X,se,te),se.length!==at)throw new Error("bad signature size");if(te.length!==yt)throw new Error("bad public key size");var z=new Uint8Array(at+X.length),le=new Uint8Array(at+X.length),je;for(je=0;je<at;je++)z[je]=se[je];for(je=0;je<X.length;je++)z[je+at]=X[je];return Ot(le,z,z.length,te)>=0},e.sign.keyPair=function(){var X=new Uint8Array(yt),se=new Uint8Array(Gt);return he(X,se),{publicKey:X,secretKey:se}},e.sign.keyPair.fromSecretKey=function(X){if($r(X),X.length!==Gt)throw new Error("bad secret key size");for(var se=new Uint8Array(yt),te=0;te<se.length;te++)se[te]=X[32+te];return{publicKey:se,secretKey:new Uint8Array(X)}},e.sign.keyPair.fromSeed=function(X){if($r(X),X.length!==on)throw new Error("bad seed size");for(var se=new Uint8Array(yt),te=new Uint8Array(Gt),z=0;z<32;z++)te[z]=X[z];return he(se,te,!0),{publicKey:se,secretKey:te}},e.sign.publicKeyLength=yt,e.sign.secretKeyLength=Gt,e.sign.seedLength=on,e.sign.signatureLength=at,e.hash=function(X){$r(X);var se=new Uint8Array(mn);return qe(se,X,X.length),se},e.hash.hashLength=mn,e.verify=function(X,se){return $r(X,se),X.length===0||se.length===0||X.length!==se.length?!1:b(X,0,se,0,X.length)===0},e.setPRNG=function(X){i=X},function(){var X=typeof self<"u"?self.crypto||self.msCrypto:null;if(X&&X.getRandomValues){var se=65536;e.setPRNG(function(te,z){var le,je=new Uint8Array(z);for(le=0;le<z;le+=se)X.getRandomValues(je.subarray(le,le+Math.min(z-le,se)));for(le=0;le<z;le++)te[le]=je[le];Il(je)})}else typeof qle<"u"&&(X=f7,X&&X.randomBytes&&e.setPRNG(function(te,z){var le,je=X.randomBytes(z);for(le=0;le<z;le++)te[le]=je[le];Il(je)}))}()})(n.exports?n.exports:self.nacl=self.nacl||{})})(qK);var Xle=qK.exports;const Vn=wc(Xle);var ZK={exports:{}};(function(n){(function(e,t){n.exports?n.exports=t():(e.nacl||(e.nacl={}),e.nacl.util=t())})($E,function(){var e={};function t(i){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(i))throw new TypeError("invalid encoding")}return e.decodeUTF8=function(i){if(typeof i!="string")throw new TypeError("expected string");var r,s=unescape(encodeURIComponent(i)),o=new Uint8Array(s.length);for(r=0;r<s.length;r++)o[r]=s.charCodeAt(r);return o},e.encodeUTF8=function(i){var r,s=[];for(r=0;r<i.length;r++)s.push(String.fromCharCode(i[r]));return decodeURIComponent(escape(s.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(e.encodeBase64=function(i){return Buffer.from(i).toString("base64")},e.decodeBase64=function(i){return t(i),new Uint8Array(Array.prototype.slice.call(Buffer.from(i,"base64"),0))}):(e.encodeBase64=function(i){return new Buffer(i).toString("base64")},e.decodeBase64=function(i){return t(i),new Uint8Array(Array.prototype.slice.call(new Buffer(i,"base64"),0))}):(e.encodeBase64=function(i){var r,s=[],o=i.length;for(r=0;r<o;r++)s.push(String.fromCharCode(i[r]));return btoa(s.join(""))},e.decodeBase64=function(i){t(i);var r,s=atob(i),o=new Uint8Array(s.length);for(r=0;r<s.length;r++)o[r]=s.charCodeAt(r);return o}),e})})(ZK);var Lu=ZK.exports;const ai=wc(Lu);function YK(n,e){let i=n;if(n.length>128&&(i=Vn.hash(n)),i.length<128){const c=new Uint8Array(128);c.set(i),i=c}const r=new Uint8Array(128),s=new Uint8Array(128);for(let c=0;c<128;c++)r[c]=i[c]^54,s[c]=i[c]^92;const o=new Uint8Array(r.length+e.length);o.set(r),o.set(e,r.length);const a=Vn.hash(o),l=new Uint8Array(s.length+a.length);return l.set(s),l.set(a,s.length),Vn.hash(l)}function XK(n,e){const t=n.length>0?n:new Uint8Array(64);return YK(t,e).slice(0,32)}function Qle(n,e,t){const i=new Uint8Array(t);let r=new Uint8Array(0),s=0,o=1;for(;s<t;){const a=new Uint8Array(r.length+e.length+1);a.set(r),a.set(e,r.length),a[r.length+e.length]=o;const l=YK(n,a).slice(0,32),c=Math.min(32,t-s);i.set(l.slice(0,c),s),r=l,s+=c,o++}return i}function sv(n,e){const t=XK(n,e),i=Qle(t,ai.decodeUTF8("G3ZKP_RATCHET"),64);return{newRootKey:i.slice(0,32),chainKey:i.slice(32,64)}}function RU(n){const e=ai.decodeUTF8("G3ZKP_MSG"),t=ai.decodeUTF8("G3ZKP_CHAIN"),i=Vn.hash(new Uint8Array([...n,...e])).slice(0,32),r=Vn.hash(new Uint8Array([...n,...t])).slice(0,32);return{messageKey:i,newChainKey:r}}class Jle{constructor(){E(this,"identityKeyPair",null);E(this,"signedPreKeyPair",null);E(this,"signedPreKeyId",0);E(this,"signingKeyPair",null);E(this,"oneTimePreKeys",[]);E(this,"sessions",new Map);E(this,"peerBundles",new Map);E(this,"initialized",!1)}async initialize(){this.initialized||(this.identityKeyPair=Vn.box.keyPair(),this.signedPreKeyPair=Vn.box.keyPair(),this.signedPreKeyId=Date.now(),this.signingKeyPair=Vn.sign.keyPair(),this.oneTimePreKeys=Array.from({length:10},(e,t)=>({id:Date.now()+t,keyPair:Vn.box.keyPair()})),this.initialized=!0)}isInitialized(){return this.initialized}getPublicKey(){if(!this.identityKeyPair)throw new Error("CryptoService not initialized");return ai.encodeBase64(this.identityKeyPair.publicKey)}getKeyBundle(){if(!this.identityKeyPair||!this.signedPreKeyPair||!this.signingKeyPair)throw new Error("CryptoService not initialized");const e=ai.encodeBase64(this.signedPreKeyPair.publicKey),t=ai.decodeUTF8(e),i=Vn.sign.detached(t,this.signingKeyPair.secretKey);return{identityKey:ai.encodeBase64(this.identityKeyPair.publicKey),signedPreKey:e,signedPreKeyId:this.signedPreKeyId,signature:ai.encodeBase64(i),oneTimePreKeys:this.oneTimePreKeys.map(r=>({id:r.id,key:ai.encodeBase64(r.keyPair.publicKey)})),timestamp:Date.now()}}establishSession(e,t){if(!this.identityKeyPair||!this.signedPreKeyPair)throw new Error("CryptoService not initialized");this.peerBundles.set(e,t);const i=ai.decodeBase64(t.identityKey),r=ai.decodeBase64(t.signedPreKey),s=Vn.box.keyPair(),o=Vn.box.before(r,this.identityKeyPair.secretKey),a=Vn.box.before(i,s.secretKey),l=Vn.box.before(r,s.secretKey);let c=null;if(t.oneTimePreKeys.length>0){const T=ai.decodeBase64(t.oneTimePreKeys[0].key);c=Vn.box.before(T,s.secretKey)}const u=c?new Uint8Array([...o,...a,...l,...c]):new Uint8Array([...o,...a,...l]),h=new Uint8Array(32).fill(255),p=XK(h,u),{newRootKey:m,chainKey:y}=sv(p,Vn.box.before(r,s.secretKey)),{newRootKey:b,chainKey:w}=sv(m,Vn.box.before(i,s.secretKey)),v={rootKey:b,sendingChainKey:y,receivingChainKey:w,sendingRatchetKey:s,receivingRatchetKey:r,sendMessageNumber:0,receiveMessageNumber:0,previousChainLength:0,peerId:e,createdAt:Date.now(),lastUsed:Date.now()};return this.sessions.set(e,v),this.getSessionInfo(e)}getSessionInfo(e){const t=this.sessions.get(e);if(t)return{sessionId:`session_${e}_${t.createdAt}`,peerId:t.peerId,rootKey:ai.encodeBase64(t.rootKey),chainKey:ai.encodeBase64(t.sendingChainKey),messageCount:t.sendMessageNumber,createdAt:t.createdAt,lastUsed:t.lastUsed,isActive:!0}}encrypt(e,t){if(!this.identityKeyPair)throw new Error("CryptoService not initialized");const i=this.sessions.get(e);if(i)return this.doubleRatchetEncrypt(i,t);const r=Vn.randomBytes(Vn.box.nonceLength),s=ai.decodeUTF8(t),o=this.peerBundles.get(e);if(o){const l=ai.decodeBase64(o.identityKey),c=Vn.box(s,r,l,this.identityKeyPair.secretKey);return{ciphertext:ai.encodeBase64(c),nonce:ai.encodeBase64(r),ephemeralPublicKey:ai.encodeBase64(this.identityKeyPair.publicKey),messageNumber:0,previousChainLength:0,ratchetPublicKey:ai.encodeBase64(this.identityKeyPair.publicKey)}}const a=Vn.secretbox(s,r,Vn.hash(this.identityKeyPair.secretKey).slice(0,32));return{ciphertext:ai.encodeBase64(a),nonce:ai.encodeBase64(r),ephemeralPublicKey:ai.encodeBase64(this.identityKeyPair.publicKey),messageNumber:0,previousChainLength:0,ratchetPublicKey:ai.encodeBase64(this.identityKeyPair.publicKey)}}doubleRatchetEncrypt(e,t){const i=e.sendMessageNumber;e.sendMessageNumber++;const{messageKey:r,newChainKey:s}=RU(e.sendingChainKey);e.sendingChainKey=s,e.lastUsed=Date.now();const o=Vn.randomBytes(Vn.box.nonceLength),a=ai.decodeUTF8(t),l=Vn.secretbox(a,o,r);return{ciphertext:ai.encodeBase64(l),nonce:ai.encodeBase64(o),ephemeralPublicKey:ai.encodeBase64(e.sendingRatchetKey.publicKey),messageNumber:i,previousChainLength:e.previousChainLength,ratchetPublicKey:ai.encodeBase64(e.sendingRatchetKey.publicKey)}}decrypt(e,t){if(!this.identityKeyPair)throw new Error("CryptoService not initialized");const i=this.sessions.get(e),r=ai.decodeBase64(t.ciphertext),s=ai.decodeBase64(t.nonce);if(i&&i.receivingChainKey){const l=ai.decodeBase64(t.ratchetPublicKey);this.keysEqual(l,i.receivingRatchetKey)||this.performDHRatchet(i,l);const{messageKey:c,newChainKey:u}=RU(i.receivingChainKey);i.receivingChainKey=u,i.receiveMessageNumber++,i.lastUsed=Date.now();const h=Vn.secretbox.open(r,s,c);if(h)return ai.encodeUTF8(h)}const o=ai.decodeBase64(t.ephemeralPublicKey);let a=Vn.box.open(r,s,o,this.identityKeyPair.secretKey);if(a||(a=Vn.secretbox.open(r,s,Vn.hash(this.identityKeyPair.secretKey).slice(0,32))),!a)throw new Error("Decryption failed");return ai.encodeUTF8(a)}performDHRatchet(e,t){e.previousChainLength=e.sendMessageNumber,e.sendMessageNumber=0,e.receiveMessageNumber=0,e.receivingRatchetKey=t;const i=Vn.box.before(t,e.sendingRatchetKey.secretKey),{newRootKey:r,chainKey:s}=sv(e.rootKey,i);e.rootKey=r,e.receivingChainKey=s,e.sendingRatchetKey=Vn.box.keyPair();const o=Vn.box.before(t,e.sendingRatchetKey.secretKey),a=sv(e.rootKey,o);e.rootKey=a.newRootKey,e.sendingChainKey=a.chainKey}keysEqual(e,t){if(!t||e.length!==t.length)return!1;let i=0;for(let r=0;r<e.length;r++)i|=e[r]^t[r];return i===0}generateMessageHash(e){const t=ai.decodeUTF8(e),i=Vn.hash(t);return ai.encodeBase64(i).substring(0,32)}rotateSessionKey(e){const t=this.sessions.get(e);if(!t)return;const i=Vn.box.keyPair();if(t.previousChainLength=t.sendMessageNumber,t.sendMessageNumber=0,t.receivingRatchetKey){const r=Vn.box.before(t.receivingRatchetKey,i.secretKey),{newRootKey:s,chainKey:o}=sv(t.rootKey,r);t.rootKey=s,t.sendingChainKey=o}t.sendingRatchetKey=i,t.lastUsed=Date.now()}hasSession(e){return this.sessions.has(e)}getAllSessions(){return Array.from(this.sessions.keys()).map(e=>this.getSessionInfo(e)).filter(e=>e!==void 0)}terminateSession(e){const t=this.sessions.get(e);t&&(t.rootKey.fill(0),t.sendingChainKey.fill(0),t.receivingChainKey&&t.receivingChainKey.fill(0),t.sendingRatchetKey.secretKey.fill(0)),this.sessions.delete(e),this.peerBundles.delete(e)}}const Tr=new Jle,ece=Symbol.for("@libp2p/connection"),HR=Symbol.for("@libp2p/content-routing"),b6=Symbol.for("@libp2p/peer-discovery"),ak=Symbol.for("@libp2p/peer-id");function QK(n){return n!=null&&!!n[ak]}const $R=Symbol.for("@libp2p/peer-routing"),tce="keep-alive",_6="StrictSign",lk="StrictNoSign";var nc;(function(n){n.Accept="accept",n.Ignore="ignore",n.Reject="reject"})(nc||(nc={}));const JK=Symbol.for("@libp2p/transport");var Ty;(function(n){n[n.FATAL_ALL=0]="FATAL_ALL",n[n.NO_FATAL=1]="NO_FATAL"})(Ty||(Ty={}));var o0;let ck=(o0=class extends Error{constructor(t="The operation was aborted"){super(t);E(this,"code");E(this,"type");this.name="AbortError",this.code=o0.code,this.type=o0.type}},E(o0,"code","ABORT_ERR"),E(o0,"type","aborted"),o0),Se=class extends Error{constructor(t,i,r){super(t);E(this,"code");E(this,"props");this.code=i,this.name=r?.name??"CodeError",this.props=r??{}}};class nce extends AggregateError{constructor(t,i,r,s){super(t,i);E(this,"code");E(this,"props");this.code=r,this.name=s?.name??"AggregateCodeError",this.props=s??{}}}const tb="ERR_TIMEOUT",ice="ERR_INVALID_PARAMETERS",eq="ERR_INVALID_MESSAGE";const tr=(n,...e)=>{try{[...e]}catch{}};var ju,Q$;let yc=(Q$=class extends EventTarget{constructor(){super();$t(this,ju,new Map);tr(1/0,this)}listenerCount(t){const i=ze(this,ju).get(t);return i==null?0:i.length}addEventListener(t,i,r){super.addEventListener(t,i,r);let s=ze(this,ju).get(t);s==null&&(s=[],ze(this,ju).set(t,s)),s.push({callback:i,once:(r!==!0&&r!==!1&&r?.once)??!1})}removeEventListener(t,i,r){super.removeEventListener(t.toString(),i??null,r);let s=ze(this,ju).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==i),ze(this,ju).set(t,s))}dispatchEvent(t){const i=super.dispatchEvent(t);let r=ze(this,ju).get(t.type);return r==null||(r=r.filter(({once:s})=>!s),ze(this,ju).set(t.type,r)),i}safeDispatchEvent(t,i={}){return this.dispatchEvent(new ko(t,i))}},ju=new WeakMap,Q$);const ko=globalThis.CustomEvent;function uk(n){return n!=null&&typeof n.start=="function"&&typeof n.stop=="function"}async function rce(...n){const e=[];for(const t of n)uk(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function sce(...n){const e=[];for(const t of n)uk(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const kd=Symbol.for("@libp2p/service-capabilities"),w6=Symbol.for("@libp2p/service-dependencies");function oce(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function p7(n){if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")}function ace(n){return new TextEncoder().encode(n)}function lce(n){return new TextDecoder().decode(n)}function cce(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var r=0;r<n.length;r++){var s=n.charAt(r),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=r}var a=n.length,l=n.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(y){if(y instanceof Uint8Array||(ArrayBuffer.isView(y)?y=new Uint8Array(y.buffer,y.byteOffset,y.byteLength):Array.isArray(y)&&(y=Uint8Array.from(y))),!(y instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(y.length===0)return"";for(var b=0,w=0,v=0,T=y.length;v!==T&&y[v]===0;)v++,b++;for(var S=(T-v)*u+1>>>0,M=new Uint8Array(S);v!==T;){for(var P=y[v],R=0,O=S-1;(P!==0||R<w)&&O!==-1;O--,R++)P+=256*M[O]>>>0,M[O]=P%a>>>0,P=P/a>>>0;if(P!==0)throw new Error("Non-zero carry");w=R,v++}for(var B=S-w;B!==S&&M[B]===0;)B++;for(var N=l.repeat(b);B<S;++B)N+=n.charAt(M[B]);return N}function p(y){if(typeof y!="string")throw new TypeError("Expected String");if(y.length===0)return new Uint8Array;var b=0;if(y[b]!==" "){for(var w=0,v=0;y[b]===l;)w++,b++;for(var T=(y.length-b)*c+1>>>0,S=new Uint8Array(T);y[b];){var M=t[y.charCodeAt(b)];if(M===255)return;for(var P=0,R=T-1;(M!==0||P<v)&&R!==-1;R--,P++)M+=a*S[R]>>>0,S[R]=M%256>>>0,M=M/256>>>0;if(M!==0)throw new Error("Non-zero carry");v=P,b++}if(y[b]!==" "){for(var O=T-v;O!==T&&S[O]===0;)O++;for(var B=new Uint8Array(w+(T-O)),N=w;O!==T;)B[N++]=S[O++];return B}}}function m(y){var b=p(y);if(b)return b;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:p,decode:m}}var uce=cce,hce=uce;let dce=class{constructor(e,t,i){E(this,"name");E(this,"prefix");E(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},fce=class{constructor(e,t,i){E(this,"name");E(this,"prefix");E(this,"baseDecode");E(this,"prefixCodePoint");this.name=e,this.prefix=t;const r=t.codePointAt(0);if(r===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r,this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return tq(this,e)}};class pce{constructor(e){E(this,"decoders");this.decoders=e}or(e){return tq(this,e)}decode(e){const t=e[0],i=this.decoders[t];if(i!=null)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function tq(n,e){return new pce({...n.decoders??{[n.prefix]:n},...e.decoders??{[e.prefix]:e}})}class mce{constructor(e,t,i,r){E(this,"name");E(this,"prefix");E(this,"baseEncode");E(this,"baseDecode");E(this,"encoder");E(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=r,this.encoder=new dce(e,t,i),this.decoder=new fce(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function m7({name:n,prefix:e,encode:t,decode:i}){return new mce(n,e,t,i)}function g_({name:n,prefix:e,alphabet:t}){const{encode:i,decode:r}=hce(t,n);return m7({prefix:e,name:n,encode:i,decode:s=>p7(r(s))})}function gce(n,e,t,i){let r=n.length;for(;n[r-1]==="=";)--r;const s=new Uint8Array(r*t/8|0);let o=0,a=0,l=0;for(let c=0;c<r;++c){const u=e[n[c]];if(u===void 0)throw new SyntaxError(`Non-${i} character`);a=a<<t|u,o+=t,o>=8&&(o-=8,s[l++]=255&a>>o)}if(o>=t||255&a<<8-o)throw new SyntaxError("Unexpected end of data");return s}function yce(n,e,t){const i=e[e.length-1]==="=",r=(1<<t)-1;let s="",o=0,a=0;for(let l=0;l<n.length;++l)for(a=a<<8|n[l],o+=8;o>t;)o-=t,s+=e[r&a>>o];if(o!==0&&(s+=e[r&a<<t-o]),i)for(;s.length*t&7;)s+="=";return s}function xce(n){const e={};for(let t=0;t<n.length;++t)e[n[t]]=t;return e}function lo({name:n,prefix:e,bitsPerChar:t,alphabet:i}){const r=xce(i);return m7({prefix:e,name:n,encode(s){return yce(s,i,t)},decode(s){return gce(s,r,t,n)}})}const Lr=g_({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),vce=g_({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),bce=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Lr,base58flickr:vce},Symbol.toStringTag,{value:"Module"}));var _ce=nq,IU=128,wce=127,Sce=~wce,Ece=Math.pow(2,31);function nq(n,e,t){e=e||[],t=t||0;for(var i=t;n>=Ece;)e[t++]=n&255|IU,n/=128;for(;n&Sce;)e[t++]=n&255|IU,n>>>=7;return e[t]=n|0,nq.bytes=t-i+1,e}var Tce=GR,Ace=128,NU=127;function GR(n,i){var t=0,i=i||0,r=0,s=i,o,a=n.length;do{if(s>=a)throw GR.bytes=0,new RangeError("Could not decode varint");o=n[s++],t+=r<28?(o&NU)<<r:(o&NU)*Math.pow(2,r),r+=7}while(o>=Ace);return GR.bytes=s-i,t}var Cce=Math.pow(2,7),Mce=Math.pow(2,14),Rce=Math.pow(2,21),Ice=Math.pow(2,28),Nce=Math.pow(2,35),Pce=Math.pow(2,42),kce=Math.pow(2,49),Lce=Math.pow(2,56),Dce=Math.pow(2,63),Oce=function(n){return n<Cce?1:n<Mce?2:n<Rce?3:n<Ice?4:n<Nce?5:n<Pce?6:n<kce?7:n<Lce?8:n<Dce?9:10},Bce={encode:_ce,decode:Tce,encodingLength:Oce},S6=Bce;function WR(n,e=0){return[S6.decode(n,e),S6.decode.bytes]}function E6(n,e,t=0){return S6.encode(n,e,t),e}function T6(n){return S6.encodingLength(n)}function nb(n,e){const t=e.byteLength,i=T6(n),r=i+T6(t),s=new Uint8Array(r+t);return E6(n,s,0),E6(t,s,i),s.set(e,r),new hk(n,t,e,s)}function g2(n){const e=p7(n),[t,i]=WR(e),[r,s]=WR(e.subarray(i)),o=e.subarray(i+s);if(o.byteLength!==r)throw new Error("Incorrect length");return new hk(t,r,o,e)}function Uce(n,e){if(n===e)return!0;{const t=e;return n.code===t.code&&n.size===t.size&&t.bytes instanceof Uint8Array&&oce(n.bytes,t.bytes)}}class hk{constructor(e,t,i,r){E(this,"code");E(this,"size");E(this,"digest");E(this,"bytes");this.code=e,this.size=t,this.digest=i,this.bytes=r}}const iq=0,Fce="identity",rq=p7;function zce(n,e){if(e?.truncate!=null&&e.truncate!==n.byteLength){if(e.truncate<0||e.truncate>n.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${n.byteLength}`);n=n.subarray(0,e.truncate)}return nb(iq,rq(n))}const xc={code:iq,name:Fce,encode:rq,digest:zce},jce=20;function Vce({name:n,code:e,encode:t,minDigestLength:i,maxDigestLength:r}){return new Hce(n,e,t,i,r)}class Hce{constructor(e,t,i,r,s){E(this,"name");E(this,"code");E(this,"encode");E(this,"minDigestLength");E(this,"maxDigestLength");this.name=e,this.code=t,this.encode=i,this.minDigestLength=r??jce,this.maxDigestLength=s}digest(e,t){if(t?.truncate!=null){if(t.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&t.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){const i=this.encode(e);return i instanceof Uint8Array?PU(i,this.code,t?.truncate):i.then(r=>PU(r,this.code,t?.truncate))}else throw Error("Unknown type, must be binary type")}}function PU(n,e,t){if(t!=null&&t!==n.byteLength){if(t>n.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${n.byteLength}`);n=n.subarray(0,t)}return nb(e,n)}function $ce(n){return async e=>new Uint8Array(await crypto.subtle.digest(n,e))}const Ir=Vce({name:"sha2-256",code:18,encode:$ce("SHA-256")});function li(n,e){if(n===e)return!0;if(n.byteLength!==e.byteLength)return!1;for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return!1;return!0}function qn(n=0){return new Uint8Array(n)}function Cs(n=0){return new Uint8Array(n)}function Ms(n,e){e==null&&(e=n.reduce((r,s)=>r+s.length,0));const t=Cs(e);let i=0;for(const r of n)t.set(r,i),i+=r.length;return t}const Gce=g_({prefix:"9",name:"base10",alphabet:"0123456789"}),Wce=Object.freeze(Object.defineProperty({__proto__:null,base10:Gce},Symbol.toStringTag,{value:"Module"})),Kce=lo({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),qce=lo({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Zce=Object.freeze(Object.defineProperty({__proto__:null,base16:Kce,base16upper:qce},Symbol.toStringTag,{value:"Module"})),Yce=lo({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Xce=Object.freeze(Object.defineProperty({__proto__:null,base2:Yce},Symbol.toStringTag,{value:"Module"})),sq=Array.from(""),Qce=sq.reduce((n,e,t)=>(n[t]=e,n),[]),Jce=sq.reduce((n,e,t)=>{const i=e.codePointAt(0);if(i==null)throw new Error(`Invalid character: ${e}`);return n[i]=t,n},[]);function eue(n){return n.reduce((e,t)=>(e+=Qce[t],e),"")}function tue(n){const e=[];for(const t of n){const i=t.codePointAt(0);if(i==null)throw new Error(`Invalid character: ${t}`);const r=Jce[i];if(r==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const nue=m7({prefix:"",name:"base256emoji",encode:eue,decode:tue}),iue=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:nue},Symbol.toStringTag,{value:"Module"})),oh=lo({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),rue=lo({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),sue=lo({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),oue=lo({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),aue=lo({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),lue=lo({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cue=lo({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),uue=lo({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),hue=lo({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),due=Object.freeze(Object.defineProperty({__proto__:null,base32:oh,base32hex:aue,base32hexpad:cue,base32hexpadupper:uue,base32hexupper:lue,base32pad:sue,base32padupper:oue,base32upper:rue,base32z:hue},Symbol.toStringTag,{value:"Module"})),dS=g_({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),fue=g_({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),pue=Object.freeze(Object.defineProperty({__proto__:null,base36:dS,base36upper:fue},Symbol.toStringTag,{value:"Module"})),g7=lo({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),mue=lo({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),V0=lo({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),gue=lo({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),yue=Object.freeze(Object.defineProperty({__proto__:null,base64:g7,base64pad:mue,base64url:V0,base64urlpad:gue},Symbol.toStringTag,{value:"Module"})),xue=lo({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),vue=Object.freeze(Object.defineProperty({__proto__:null,base8:xue},Symbol.toStringTag,{value:"Module"})),bue=m7({prefix:"\0",name:"identity",encode:n=>lce(n),decode:n=>ace(n)}),_ue=Object.freeze(Object.defineProperty({__proto__:null,identity:bue},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;function kU(n,e){const{bytes:t,version:i}=n;switch(i){case 0:return Sue(t,KR(n),e??Lr.encoder);default:return Eue(t,KR(n),e??oh.encoder)}}const LU=new WeakMap;function KR(n){const e=LU.get(n);if(e==null){const t=new Map;return LU.set(n,t),t}return e}var WUe;class Fi{constructor(e,t,i,r){E(this,"code");E(this,"version");E(this,"multihash");E(this,"bytes");E(this,"/");E(this,WUe,"CID");this.code=t,this.version=e,this.multihash=i,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==ov)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Tue)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Fi.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,i=nb(e,t);return Fi.createV1(this.code,i)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Fi.equals(this,e)}static equals(e,t){const i=t;return i!=null&&e.code===i.code&&e.version===i.version&&Uce(e.multihash,i.multihash)}toString(e){return kU(this,e)}toJSON(){return{"/":kU(this)}}link(){return this}[(WUe=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Fi)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:i,code:r,multihash:s,bytes:o}=t;return new Fi(i,r,s,o??DU(i,r,s.bytes))}else if(t[Aue]===!0){const{version:i,multihash:r,code:s}=t,o=g2(r);return Fi.create(i,s,o)}else return null}static create(e,t,i){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(i.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==ov)throw new Error(`Version 0 CID must use dag-pb (code: ${ov}) block encoding`);return new Fi(e,t,i,i.bytes)}case 1:{const r=DU(e,t,i.bytes);return new Fi(e,t,i,r)}default:throw new Error("Invalid version")}}static createV0(e){return Fi.create(0,ov,e)}static createV1(e,t){return Fi.create(1,e,t)}static decode(e){const[t,i]=Fi.decodeFirst(e);if(i.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Fi.inspectBytes(e),i=t.size-t.multihashSize,r=p7(e.subarray(i,i+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=r.subarray(t.multihashSize-t.digestSize),o=new hk(t.multihashCode,t.digestSize,s,r);return[t.version===0?Fi.createV0(o):Fi.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const i=()=>{const[h,p]=WR(e.subarray(t));return t+=p,h};let r=i(),s=ov;if(r===18?(r=0,t=0):s=i(),r!==0&&r!==1)throw new RangeError(`Invalid CID version ${r}`);const o=t,a=i(),l=i(),c=t+l,u=c-o;return{version:r,codec:s,multihashCode:a,digestSize:l,multihashSize:u,size:c}}static parse(e,t){const[i,r]=wue(e,t),s=Fi.decode(r);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return KR(s).set(i,e),s}}function wue(n,e){switch(n[0]){case"Q":{const t=e??Lr;return[Lr.prefix,t.decode(`${Lr.prefix}${n}`)]}case Lr.prefix:{const t=e??Lr;return[Lr.prefix,t.decode(n)]}case oh.prefix:{const t=e??oh;return[oh.prefix,t.decode(n)]}case dS.prefix:{const t=e??dS;return[dS.prefix,t.decode(n)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[n[0],e.decode(n)]}}}function Sue(n,e,t){const{prefix:i}=t;if(i!==Lr.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const r=e.get(i);if(r==null){const s=t.encode(n).slice(1);return e.set(i,s),s}else return r}function Eue(n,e,t){const{prefix:i}=t,r=e.get(i);if(r==null){const s=t.encode(n);return e.set(i,s),s}else return r}const ov=112,Tue=18;function DU(n,e,t){const i=T6(n),r=i+T6(e),s=new Uint8Array(r+t.byteLength);return E6(n,s,0),E6(e,s,i),s.set(t,r),s}const Aue=Symbol.for("@ipld/js-cid/CID"),$m={..._ue,...Xce,...vue,...Wce,...Zce,...due,...pue,...bce,...yue,...iue};function oq(n,e,t,i){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:i}}}const OU=oq("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),dA=oq("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Cs(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),aq={utf8:OU,"utf-8":OU,hex:$m.base16,latin1:dA,ascii:dA,binary:dA,...$m};function Ut(n,e="utf8"){const t=aq[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${n}`)}function H0(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}const Y1=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function y_(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Em(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function Ud(n,...e){if(!y_(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function x_(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Em(n.outputLen),Em(n.blockLen)}function A6(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function Cue(n,e){Ud(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function C0(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function fS(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function Eu(n,e){return n<<32-e|n>>>e}const lq=(()=>typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function")(),Mue=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Tm(n){if(Ud(n),lq)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=Mue[n[t]];return e}const Ih={_0:48,_9:57,A:65,F:70,a:97,f:102};function BU(n){if(n>=Ih._0&&n<=Ih._9)return n-Ih._0;if(n>=Ih.A&&n<=Ih.F)return n-(Ih.A-10);if(n>=Ih.a&&n<=Ih.f)return n-(Ih.a-10)}function C6(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(lq)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let r=0,s=0;r<t;r++,s+=2){const o=BU(n.charCodeAt(s)),a=BU(n.charCodeAt(s+1));if(o===void 0||a===void 0){const l=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}i[r]=o*16+a}return i}const Rue=async()=>{};async function Iue(n,e,t){let i=Date.now();for(let r=0;r<n;r++){t(r);const s=Date.now()-i;s>=0&&s<e||(await Rue(),i+=s)}}function cq(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}function ib(n){return typeof n=="string"&&(n=cq(n)),Ud(n),n}function UU(n){return typeof n=="string"&&(n=cq(n)),Ud(n),n}function Ku(...n){let e=0;for(let i=0;i<n.length;i++){const r=n[i];Ud(r),e+=r.length}const t=new Uint8Array(e);for(let i=0,r=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}function Nue(n,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options should be object or undefined");return Object.assign(n,e)}class uq{}function hq(n){const e=i=>n().update(ib(i)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function rx(n=32){if(Y1&&typeof Y1.getRandomValues=="function")return Y1.getRandomValues(new Uint8Array(n));if(Y1&&typeof Y1.randomBytes=="function")return Uint8Array.from(Y1.randomBytes(n));throw new Error("crypto.getRandomValues must be defined")}function Pue(n,e,t,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(t>>r&s),a=Number(t&s),l=i?4:0,c=i?0:4;n.setUint32(e+l,o,i),n.setUint32(e+c,a,i)}function kue(n,e,t){return n&e^~n&t}function Lue(n,e,t){return n&e^n&t^e&t}let dq=class extends uq{constructor(e,t,i,r){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=r,this.buffer=new Uint8Array(e),this.view=fS(this.buffer)}update(e){A6(this),e=ib(e),Ud(e);const{view:t,buffer:i,blockLen:r}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a===r){const l=fS(e);for(;r<=s-o;o+=r)this.process(l,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){A6(this),Cue(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:r,isLE:s}=this;let{pos:o}=this;t[o++]=128,C0(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(i,0),o=0);for(let h=o;h<r;h++)t[h]=0;Pue(i,r-8,BigInt(this.length*8),s),this.process(i,0);const a=fS(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:r,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=r,e.pos=a,r%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}};const ff=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),yo=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),o4=BigInt(2**32-1),FU=BigInt(32);function Due(n,e=!1){return e?{h:Number(n&o4),l:Number(n>>FU&o4)}:{h:Number(n>>FU&o4)|0,l:Number(n&o4)|0}}function Oue(n,e=!1){const t=n.length;let i=new Uint32Array(t),r=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=Due(n[s],e);[i[s],r[s]]=[o,a]}return[i,r]}const zU=(n,e,t)=>n>>>t,jU=(n,e,t)=>n<<32-t|e>>>t,X1=(n,e,t)=>n>>>t|e<<32-t,Q1=(n,e,t)=>n<<32-t|e>>>t,a4=(n,e,t)=>n<<64-t|e>>>t-32,l4=(n,e,t)=>n>>>t-32|e<<64-t;function Nh(n,e,t,i){const r=(e>>>0)+(i>>>0);return{h:n+t+(r/2**32|0)|0,l:r|0}}const Bue=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),Uue=(n,e,t,i)=>e+t+i+(n/2**32|0)|0,Fue=(n,e,t,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(i>>>0),zue=(n,e,t,i,r)=>e+t+i+r+(n/2**32|0)|0,jue=(n,e,t,i,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0),Vue=(n,e,t,i,r,s)=>e+t+i+r+s+(n/2**32|0)|0,Hue=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pf=new Uint32Array(64);class $ue extends dq{constructor(e=32){super(64,e,8,!1),this.A=ff[0]|0,this.B=ff[1]|0,this.C=ff[2]|0,this.D=ff[3]|0,this.E=ff[4]|0,this.F=ff[5]|0,this.G=ff[6]|0,this.H=ff[7]|0}get(){const{A:e,B:t,C:i,D:r,E:s,F:o,G:a,H:l}=this;return[e,t,i,r,s,o,a,l]}set(e,t,i,r,s,o,a,l){this.A=e|0,this.B=t|0,this.C=i|0,this.D=r|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,t){for(let h=0;h<16;h++,t+=4)pf[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=pf[h-15],m=pf[h-2],y=Eu(p,7)^Eu(p,18)^p>>>3,b=Eu(m,17)^Eu(m,19)^m>>>10;pf[h]=b+pf[h-7]+y+pf[h-16]|0}let{A:i,B:r,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let h=0;h<64;h++){const p=Eu(a,6)^Eu(a,11)^Eu(a,25),m=u+p+kue(a,l,c)+Hue[h]+pf[h]|0,b=(Eu(i,2)^Eu(i,13)^Eu(i,22))+Lue(i,r,s)|0;u=c,c=l,l=a,a=o+m|0,o=s,s=r,r=i,i=m+b|0}i=i+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(i,r,s,o,a,l,c,u)}roundClean(){C0(pf)}destroy(){this.set(0,0,0,0,0,0,0,0),C0(this.buffer)}}const fq=(()=>Oue(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))))(),Gue=(()=>fq[0])(),Wue=(()=>fq[1])(),mf=new Uint32Array(80),gf=new Uint32Array(80);class Kue extends dq{constructor(e=64){super(128,e,16,!1),this.Ah=yo[0]|0,this.Al=yo[1]|0,this.Bh=yo[2]|0,this.Bl=yo[3]|0,this.Ch=yo[4]|0,this.Cl=yo[5]|0,this.Dh=yo[6]|0,this.Dl=yo[7]|0,this.Eh=yo[8]|0,this.El=yo[9]|0,this.Fh=yo[10]|0,this.Fl=yo[11]|0,this.Gh=yo[12]|0,this.Gl=yo[13]|0,this.Hh=yo[14]|0,this.Hl=yo[15]|0}get(){const{Ah:e,Al:t,Bh:i,Bl:r,Ch:s,Cl:o,Dh:a,Dl:l,Eh:c,El:u,Fh:h,Fl:p,Gh:m,Gl:y,Hh:b,Hl:w}=this;return[e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w]}set(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=r|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=l|0,this.Eh=c|0,this.El=u|0,this.Fh=h|0,this.Fl=p|0,this.Gh=m|0,this.Gl=y|0,this.Hh=b|0,this.Hl=w|0}process(e,t){for(let S=0;S<16;S++,t+=4)mf[S]=e.getUint32(t),gf[S]=e.getUint32(t+=4);for(let S=16;S<80;S++){const M=mf[S-15]|0,P=gf[S-15]|0,R=X1(M,P,1)^X1(M,P,8)^zU(M,P,7),O=Q1(M,P,1)^Q1(M,P,8)^jU(M,P,7),B=mf[S-2]|0,N=gf[S-2]|0,I=X1(B,N,19)^a4(B,N,61)^zU(B,N,6),F=Q1(B,N,19)^l4(B,N,61)^jU(B,N,6),j=Fue(O,F,gf[S-7],gf[S-16]),W=zue(j,R,I,mf[S-7],mf[S-16]);mf[S]=W|0,gf[S]=j|0}let{Ah:i,Al:r,Bh:s,Bl:o,Ch:a,Cl:l,Dh:c,Dl:u,Eh:h,El:p,Fh:m,Fl:y,Gh:b,Gl:w,Hh:v,Hl:T}=this;for(let S=0;S<80;S++){const M=X1(h,p,14)^X1(h,p,18)^a4(h,p,41),P=Q1(h,p,14)^Q1(h,p,18)^l4(h,p,41),R=h&m^~h&b,O=p&y^~p&w,B=jue(T,P,O,Wue[S],gf[S]),N=Vue(B,v,M,R,Gue[S],mf[S]),I=B|0,F=X1(i,r,28)^a4(i,r,34)^a4(i,r,39),j=Q1(i,r,28)^l4(i,r,34)^l4(i,r,39),W=i&s^i&a^s&a,U=r&o^r&l^o&l;v=b|0,T=w|0,b=m|0,w=y|0,m=h|0,y=p|0,{h,l:p}=Nh(c|0,u|0,N|0,I|0),c=a|0,u=l|0,a=s|0,l=o|0,s=i|0,o=r|0;const H=Bue(I,j,U);i=Uue(H,N,F,W),r=H|0}({h:i,l:r}=Nh(this.Ah|0,this.Al|0,i|0,r|0)),{h:s,l:o}=Nh(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l}=Nh(this.Ch|0,this.Cl|0,a|0,l|0),{h:c,l:u}=Nh(this.Dh|0,this.Dl|0,c|0,u|0),{h,l:p}=Nh(this.Eh|0,this.El|0,h|0,p|0),{h:m,l:y}=Nh(this.Fh|0,this.Fl|0,m|0,y|0),{h:b,l:w}=Nh(this.Gh|0,this.Gl|0,b|0,w|0),{h:v,l:T}=Nh(this.Hh|0,this.Hl|0,v|0,T|0),this.set(i,r,s,o,a,l,c,u,h,p,m,y,b,w,v,T)}roundClean(){C0(mf,gf)}destroy(){C0(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const pq=hq(()=>new $ue),mq=hq(()=>new Kue);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const dk=BigInt(0),qR=BigInt(1);function Gm(n,e=""){if(typeof n!="boolean"){const t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof n)}return n}function Jc(n,e,t=""){const i=y_(n),r=n?.length,s=e!==void 0;if(!i||s&&r!==e){const o=t&&`"${t}" `,a=s?` of length ${e}`:"",l=i?`length=${r}`:`type=${typeof n}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return n}function c4(n){const e=n.toString(16);return e.length&1?"0"+e:e}function gq(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?dk:BigInt("0x"+n)}function y7(n){return gq(Tm(n))}function Wm(n){return Ud(n),gq(Tm(Uint8Array.from(n).reverse()))}function fk(n,e){return C6(n.toString(16).padStart(e*2,"0"))}function pk(n,e){return fk(n,e).reverse()}function Pr(n,e,t){let i;if(typeof e=="string")try{i=C6(e)}catch(s){throw new Error(n+" must be hex string or Uint8Array, cause: "+s)}else if(y_(e))i=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const r=i.length;if(typeof t=="number"&&r!==t)throw new Error(n+" of length "+t+" expected, got "+r);return i}function VU(n){return Uint8Array.from(n)}const fA=n=>typeof n=="bigint"&&dk<=n;function que(n,e,t){return fA(n)&&fA(e)&&fA(t)&&e<=n&&n<t}function rb(n,e,t,i){if(!que(e,t,i))throw new Error("expected valid "+n+": "+t+" <= n < "+i+", got "+e)}function yq(n){let e;for(e=0;n>dk;n>>=qR,e+=1);return e}const v_=n=>(qR<<BigInt(n))-qR;function Zue(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const i=m=>new Uint8Array(m),r=m=>Uint8Array.of(m);let s=i(n),o=i(n),a=0;const l=()=>{s.fill(1),o.fill(0),a=0},c=(...m)=>t(o,s,...m),u=(m=i(0))=>{o=c(r(0),m),s=c(),m.length!==0&&(o=c(r(1),m),s=c())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let m=0;const y=[];for(;m<e;){s=c();const b=s.slice();y.push(b),m+=s.length}return Ku(...y)};return(m,y)=>{l(),u(m);let b;for(;!(b=y(h()));)u();return l(),b}}function sx(n,e,t={}){if(!n||typeof n!="object")throw new Error("expected valid options object");function i(r,s,o){const a=n[r];if(o&&a===void 0)return;const l=typeof a;if(l!==s||a===null)throw new Error(`param "${r}" is invalid: expected ${s}, got ${l}`)}Object.entries(e).forEach(([r,s])=>i(r,s,!1)),Object.entries(t).forEach(([r,s])=>i(r,s,!0))}function M6(n){const e=new WeakMap;return(t,...i)=>{const r=e.get(t);if(r!==void 0)return r;const s=n(t,...i);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Va=BigInt(0),no=BigInt(1),tm=BigInt(2),xq=BigInt(3),vq=BigInt(4),bq=BigInt(5),Yue=BigInt(7),_q=BigInt(8),Xue=BigInt(9),wq=BigInt(16);function Yr(n,e){const t=n%e;return t>=Va?t:e+t}function Br(n,e,t){let i=n;for(;e-- >Va;)i*=i,i%=t;return i}function HU(n,e){if(n===Va)throw new Error("invert: expected non-zero number");if(e<=Va)throw new Error("invert: expected positive modulus, got "+e);let t=Yr(n,e),i=e,r=Va,s=no;for(;t!==Va;){const a=i/t,l=i%t,c=r-s*a;i=t,t=l,r=s,s=c}if(i!==no)throw new Error("invert: does not exist");return Yr(r,e)}function mk(n,e,t){if(!n.eql(n.sqr(e),t))throw new Error("Cannot find square root")}function Sq(n,e){const t=(n.ORDER+no)/vq,i=n.pow(e,t);return mk(n,i,e),i}function Que(n,e){const t=(n.ORDER-bq)/_q,i=n.mul(e,tm),r=n.pow(i,t),s=n.mul(e,r),o=n.mul(n.mul(s,tm),r),a=n.mul(s,n.sub(o,n.ONE));return mk(n,a,e),a}function Jue(n){const e=c1(n),t=Eq(n),i=t(e,e.neg(e.ONE)),r=t(e,i),s=t(e,e.neg(i)),o=(n+Yue)/wq;return(a,l)=>{let c=a.pow(l,o),u=a.mul(c,i);const h=a.mul(c,r),p=a.mul(c,s),m=a.eql(a.sqr(u),l),y=a.eql(a.sqr(h),l);c=a.cmov(c,u,m),u=a.cmov(p,h,y);const b=a.eql(a.sqr(u),l),w=a.cmov(c,u,b);return mk(a,w,l),w}}function Eq(n){if(n<xq)throw new Error("sqrt is not defined for small field");let e=n-no,t=0;for(;e%tm===Va;)e/=tm,t++;let i=tm;const r=c1(n);for(;$U(r,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return Sq;let s=r.pow(i,e);const o=(e+no)/tm;return function(l,c){if(l.is0(c))return c;if($U(l,c)!==1)throw new Error("Cannot find square root");let u=t,h=l.mul(l.ONE,s),p=l.pow(c,e),m=l.pow(c,o);for(;!l.eql(p,l.ONE);){if(l.is0(p))return l.ZERO;let y=1,b=l.sqr(p);for(;!l.eql(b,l.ONE);)if(y++,b=l.sqr(b),y===u)throw new Error("Cannot find square root");const w=no<<BigInt(u-y-1),v=l.pow(h,w);u=y,h=l.sqr(v),p=l.mul(p,h),m=l.mul(m,v)}return m}}function ehe(n){return n%vq===xq?Sq:n%_q===bq?Que:n%wq===Xue?Jue(n):Eq(n)}const the=(n,e)=>(Yr(n,e)&no)===no,nhe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ihe(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=nhe.reduce((i,r)=>(i[r]="function",i),e);return sx(n,t),n}function rhe(n,e,t){if(t<Va)throw new Error("invalid exponent, negatives unsupported");if(t===Va)return n.ONE;if(t===no)return e;let i=n.ONE,r=e;for(;t>Va;)t&no&&(i=n.mul(i,r)),r=n.sqr(r),t>>=no;return i}function Tq(n,e,t=!1){const i=new Array(e.length).fill(t?n.ZERO:void 0),r=e.reduce((o,a,l)=>n.is0(a)?o:(i[l]=o,n.mul(o,a)),n.ONE),s=n.inv(r);return e.reduceRight((o,a,l)=>n.is0(a)?o:(i[l]=n.mul(o,i[l]),n.mul(o,a)),s),i}function $U(n,e){const t=(n.ORDER-no)/tm,i=n.pow(e,t),r=n.eql(i,n.ONE),s=n.eql(i,n.ZERO),o=n.eql(i,n.neg(n.ONE));if(!r&&!s&&!o)throw new Error("invalid Legendre symbol result");return r?1:s?0:-1}function Aq(n,e){e!==void 0&&Em(e);const t=e!==void 0?e:n.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function c1(n,e,t=!1,i={}){if(n<=Va)throw new Error("invalid field: expected ORDER > 0, got "+n);let r,s,o=!1,a;if(typeof e=="object"&&e!=null){if(i.sqrt||t)throw new Error("cannot specify opts in two arguments");const p=e;p.BITS&&(r=p.BITS),p.sqrt&&(s=p.sqrt),typeof p.isLE=="boolean"&&(t=p.isLE),typeof p.modFromBytes=="boolean"&&(o=p.modFromBytes),a=p.allowedLengths}else typeof e=="number"&&(r=e),i.sqrt&&(s=i.sqrt);const{nBitLength:l,nByteLength:c}=Aq(n,r);if(c>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:n,isLE:t,BITS:l,BYTES:c,MASK:v_(l),ZERO:Va,ONE:no,allowedLengths:a,create:p=>Yr(p,n),isValid:p=>{if(typeof p!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof p);return Va<=p&&p<n},is0:p=>p===Va,isValidNot0:p=>!h.is0(p)&&h.isValid(p),isOdd:p=>(p&no)===no,neg:p=>Yr(-p,n),eql:(p,m)=>p===m,sqr:p=>Yr(p*p,n),add:(p,m)=>Yr(p+m,n),sub:(p,m)=>Yr(p-m,n),mul:(p,m)=>Yr(p*m,n),pow:(p,m)=>rhe(h,p,m),div:(p,m)=>Yr(p*HU(m,n),n),sqrN:p=>p*p,addN:(p,m)=>p+m,subN:(p,m)=>p-m,mulN:(p,m)=>p*m,inv:p=>HU(p,n),sqrt:s||(p=>(u||(u=ehe(n)),u(h,p))),toBytes:p=>t?pk(p,c):fk(p,c),fromBytes:(p,m=!0)=>{if(a){if(!a.includes(p.length)||p.length>c)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+p.length);const b=new Uint8Array(c);b.set(p,t?0:b.length-p.length),p=b}if(p.length!==c)throw new Error("Field.fromBytes: expected "+c+" bytes, got "+p.length);let y=t?Wm(p):y7(p);if(o&&(y=Yr(y,n)),!m&&!h.isValid(y))throw new Error("invalid field element: outside of range 0..ORDER");return y},invertBatch:p=>Tq(h,p),cmov:(p,m,y)=>y?m:p});return Object.freeze(h)}function Cq(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function Mq(n){const e=Cq(n);return e+Math.ceil(e/2)}function she(n,e,t=!1){const i=n.length,r=Cq(e),s=Mq(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=t?Wm(n):y7(n),a=Yr(o,e-no)+no;return t?pk(a,r):fk(a,r)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const y2=BigInt(0),nm=BigInt(1);function R6(n,e){const t=e.negate();return n?t:e}function im(n,e){const t=Tq(n.Fp,e.map(i=>i.Z));return e.map((i,r)=>n.fromAffine(i.toAffine(t[r])))}function Rq(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function pA(n,e){Rq(n,e);const t=Math.ceil(e/n)+1,i=2**(n-1),r=2**n,s=v_(n),o=BigInt(n);return{windows:t,windowSize:i,mask:s,maxNumber:r,shiftBy:o}}function GU(n,e,t){const{windowSize:i,mask:r,maxNumber:s,shiftBy:o}=t;let a=Number(n&r),l=n>>o;a>i&&(a-=s,l+=nm);const c=e*i,u=c+Math.abs(a)-1,h=a===0,p=a<0,m=e%2!==0;return{nextN:l,offset:u,isZero:h,isNeg:p,isNegF:m,offsetF:c}}function ohe(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function ahe(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}const mA=new WeakMap,Iq=new WeakMap;function gA(n){return Iq.get(n)||1}function WU(n){if(n!==y2)throw new Error("invalid wNAF")}let Nq=class{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,i=this.ZERO){let r=e;for(;t>y2;)t&nm&&(i=i.add(r)),r=r.double(),t>>=nm;return i}precomputeWindow(e,t){const{windows:i,windowSize:r}=pA(t,this.bits),s=[];let o=e,a=o;for(let l=0;l<i;l++){a=o,s.push(a);for(let c=1;c<r;c++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,t,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let r=this.ZERO,s=this.BASE;const o=pA(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:l,offset:c,isZero:u,isNeg:h,isNegF:p,offsetF:m}=GU(i,a,o);i=l,u?s=s.add(R6(p,t[m])):r=r.add(R6(h,t[c]))}return WU(i),{p:r,f:s}}wNAFUnsafe(e,t,i,r=this.ZERO){const s=pA(e,this.bits);for(let o=0;o<s.windows&&i!==y2;o++){const{nextN:a,offset:l,isZero:c,isNeg:u}=GU(i,o,s);if(i=a,!c){const h=t[l];r=r.add(u?h.negate():h)}}return WU(i),r}getPrecomputes(e,t,i){let r=mA.get(t);return r||(r=this.precomputeWindow(t,e),e!==1&&(typeof i=="function"&&(r=i(r)),mA.set(t,r))),r}cached(e,t,i){const r=gA(e);return this.wNAF(r,this.getPrecomputes(r,e,i),t)}unsafe(e,t,i,r){const s=gA(e);return s===1?this._unsafeLadder(e,t,r):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),t,r)}createCache(e,t){Rq(t,this.bits),Iq.set(e,t),mA.delete(e)}hasCache(e){return gA(e)!==1}};function lhe(n,e,t,i){let r=e,s=n.ZERO,o=n.ZERO;for(;t>y2||i>y2;)t&nm&&(s=s.add(r)),i&nm&&(o=o.add(r)),r=r.double(),t>>=nm,i>>=nm;return{p1:s,p2:o}}function Pq(n,e,t,i){ohe(t,n),ahe(i,e);const r=t.length,s=i.length;if(r!==s)throw new Error("arrays of points and scalars must have equal length");const o=n.ZERO,a=yq(BigInt(r));let l=1;a>12?l=a-3:a>4?l=a-2:a>0&&(l=2);const c=v_(l),u=new Array(Number(c)+1).fill(o),h=Math.floor((e.BITS-1)/l)*l;let p=o;for(let m=h;m>=0;m-=l){u.fill(o);for(let b=0;b<s;b++){const w=i[b],v=Number(w>>BigInt(m)&c);u[v]=u[v].add(t[b])}let y=o;for(let b=u.length-1,w=o;b>0;b--)w=w.add(u[b]),y=y.add(w);if(p=p.add(y),m!==0)for(let b=0;b<l;b++)p=p.double()}return p}function KU(n,e,t){if(e){if(e.ORDER!==n)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return ihe(e),e}else return c1(n,{isLE:t})}function kq(n,e,t={},i){if(i===void 0&&(i=n==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${n} CURVE object`);for(const l of["p","n","h"]){const c=e[l];if(!(typeof c=="bigint"&&c>y2))throw new Error(`CURVE.${l} must be positive bigint`)}const r=KU(e.p,t.Fp,i),s=KU(e.n,t.Fn,i),a=["Gx","Gy","a",n==="weierstrass"?"b":"d"];for(const l of a)if(!r.isValid(e[l]))throw new Error(`CURVE.${l} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:r,Fn:s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const yf=BigInt(0),Bs=BigInt(1),yA=BigInt(2),che=BigInt(8);function uhe(n,e,t,i){const r=n.sqr(t),s=n.sqr(i),o=n.add(n.mul(e.a,r),s),a=n.add(n.ONE,n.mul(e.d,n.mul(r,s)));return n.eql(o,a)}function hhe(n,e={}){const t=kq("edwards",n,e,e.FpFnLE),{Fp:i,Fn:r}=t;let s=t.CURVE;const{h:o}=s;sx(e,{},{uvRatio:"function"});const a=yA<<BigInt(r.BYTES*8)-Bs,l=w=>i.create(w),c=e.uvRatio||((w,v)=>{try{return{isValid:!0,value:i.sqrt(i.div(w,v))}}catch{return{isValid:!1,value:yf}}});if(!uhe(i,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function u(w,v,T=!1){const S=T?Bs:yf;return rb("coordinate "+w,v,S,a),v}function h(w){if(!(w instanceof y))throw new Error("ExtendedPoint expected")}const p=M6((w,v)=>{const{X:T,Y:S,Z:M}=w,P=w.is0();v==null&&(v=P?che:i.inv(M));const R=l(T*v),O=l(S*v),B=i.mul(M,v);if(P)return{x:yf,y:Bs};if(B!==Bs)throw new Error("invZ was invalid");return{x:R,y:O}}),m=M6(w=>{const{a:v,d:T}=s;if(w.is0())throw new Error("bad point: ZERO");const{X:S,Y:M,Z:P,T:R}=w,O=l(S*S),B=l(M*M),N=l(P*P),I=l(N*N),F=l(O*v),j=l(N*l(F+B)),W=l(I+l(T*l(O*B)));if(j!==W)throw new Error("bad point: equation left != right (1)");const U=l(S*M),H=l(P*R);if(U!==H)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(v,T,S,M){this.X=u("x",v),this.Y=u("y",T),this.Z=u("z",S,!0),this.T=u("t",M),Object.freeze(this)}static CURVE(){return s}static fromAffine(v){if(v instanceof y)throw new Error("extended point not allowed");const{x:T,y:S}=v||{};return u("x",T),u("y",S),new y(T,S,Bs,l(T*S))}static fromBytes(v,T=!1){const S=i.BYTES,{a:M,d:P}=s;v=VU(Jc(v,S,"point")),Gm(T,"zip215");const R=VU(v),O=v[S-1];R[S-1]=O&-129;const B=Wm(R),N=T?a:i.ORDER;rb("point.y",B,yf,N);const I=l(B*B),F=l(I-Bs),j=l(P*I-M);let{isValid:W,value:U}=c(F,j);if(!W)throw new Error("bad point: invalid y coordinate");const H=(U&Bs)===Bs,q=(O&128)!==0;if(!T&&U===yf&&q)throw new Error("bad point: x=0 and x_0=1");return q!==H&&(U=l(-U)),y.fromAffine({x:U,y:B})}static fromHex(v,T=!1){return y.fromBytes(Pr("point",v),T)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(v=8,T=!0){return b.createCache(this,v),T||this.multiply(yA),this}assertValidity(){m(this)}equals(v){h(v);const{X:T,Y:S,Z:M}=this,{X:P,Y:R,Z:O}=v,B=l(T*O),N=l(P*M),I=l(S*O),F=l(R*M);return B===N&&I===F}is0(){return this.equals(y.ZERO)}negate(){return new y(l(-this.X),this.Y,this.Z,l(-this.T))}double(){const{a:v}=s,{X:T,Y:S,Z:M}=this,P=l(T*T),R=l(S*S),O=l(yA*l(M*M)),B=l(v*P),N=T+S,I=l(l(N*N)-P-R),F=B+R,j=F-O,W=B-R,U=l(I*j),H=l(F*W),q=l(I*W),J=l(j*F);return new y(U,H,J,q)}add(v){h(v);const{a:T,d:S}=s,{X:M,Y:P,Z:R,T:O}=this,{X:B,Y:N,Z:I,T:F}=v,j=l(M*B),W=l(P*N),U=l(O*S*F),H=l(R*I),q=l((M+P)*(B+N)-j-W),J=H-U,G=H+U,ee=l(W-T*j),Q=l(q*J),ne=l(G*ee),fe=l(q*ee),Ae=l(J*G);return new y(Q,ne,Ae,fe)}subtract(v){return this.add(v.negate())}multiply(v){if(!r.isValidNot0(v))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:T,f:S}=b.cached(this,v,M=>im(y,M));return im(y,[T,S])[0]}multiplyUnsafe(v,T=y.ZERO){if(!r.isValid(v))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return v===yf?y.ZERO:this.is0()||v===Bs?this:b.unsafe(this,v,S=>im(y,S),T)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return b.unsafe(this,s.n).is0()}toAffine(v){return p(this,v)}clearCofactor(){return o===Bs?this:this.multiplyUnsafe(o)}toBytes(){const{x:v,y:T}=this.toAffine(),S=i.toBytes(T);return S[S.length-1]|=v&Bs?128:0,S}toHex(){return Tm(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get ex(){return this.X}get ey(){return this.Y}get ez(){return this.Z}get et(){return this.T}static normalizeZ(v){return im(y,v)}static msm(v,T){return Pq(y,r,v,T)}_setWindowSize(v){this.precompute(v)}toRawBytes(){return this.toBytes()}}y.BASE=new y(s.Gx,s.Gy,Bs,l(s.Gx*s.Gy)),y.ZERO=new y(yf,Bs,Bs,yf),y.Fp=i,y.Fn=r;const b=new Nq(y,r.BITS);return y.BASE.precompute(8),y}function dhe(n,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');sx(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:i}=t,{BASE:r,Fp:s,Fn:o}=n,a=t.randomBytes||rx,l=t.adjustScalarBytes||(N=>N),c=t.domain||((N,I,F)=>{if(Gm(F,"phflag"),I.length||F)throw new Error("Contexts/pre-hash are not supported");return N});function u(N){return o.create(Wm(N))}function h(N){const I=S.secretKey;N=Pr("private key",N,I);const F=Pr("hashed private key",e(N),2*I),j=l(F.slice(0,I)),W=F.slice(I,2*I),U=u(j);return{head:j,prefix:W,scalar:U}}function p(N){const{head:I,prefix:F,scalar:j}=h(N),W=r.multiply(j),U=W.toBytes();return{head:I,prefix:F,scalar:j,point:W,pointBytes:U}}function m(N){return p(N).pointBytes}function y(N=Uint8Array.of(),...I){const F=Ku(...I);return u(e(c(F,Pr("context",N),!!i)))}function b(N,I,F={}){N=Pr("message",N),i&&(N=i(N));const{prefix:j,scalar:W,pointBytes:U}=p(I),H=y(F.context,j,N),q=r.multiply(H).toBytes(),J=y(F.context,q,U,N),G=o.create(H+J*W);if(!o.isValid(G))throw new Error("sign failed: invalid s");const ee=Ku(q,o.toBytes(G));return Jc(ee,S.signature,"result")}const w={zip215:!0};function v(N,I,F,j=w){const{context:W,zip215:U}=j,H=S.signature;N=Pr("signature",N,H),I=Pr("message",I),F=Pr("publicKey",F,S.publicKey),U!==void 0&&Gm(U,"zip215"),i&&(I=i(I));const q=H/2,J=N.subarray(0,q),G=Wm(N.subarray(q,H));let ee,Q,ne;try{ee=n.fromBytes(F,U),Q=n.fromBytes(J,U),ne=r.multiplyUnsafe(G)}catch{return!1}if(!U&&ee.isSmallOrder())return!1;const fe=y(W,Q.toBytes(),ee.toBytes(),I);return Q.add(ee.multiplyUnsafe(fe)).subtract(ne).clearCofactor().is0()}const T=s.BYTES,S={secretKey:T,publicKey:T,signature:2*T,seed:T};function M(N=a(S.seed)){return Jc(N,S.seed,"seed")}function P(N){const I=B.randomSecretKey(N);return{secretKey:I,publicKey:m(I)}}function R(N){return y_(N)&&N.length===o.BYTES}function O(N,I){try{return!!n.fromBytes(N,I)}catch{return!1}}const B={getExtendedPublicKey:p,randomSecretKey:M,isValidSecretKey:R,isValidPublicKey:O,toMontgomery(N){const{y:I}=n.fromBytes(N),F=S.publicKey,j=F===32;if(!j&&F!==57)throw new Error("only defined for 25519 and 448");const W=j?s.div(Bs+I,Bs-I):s.div(I-Bs,I+Bs);return s.toBytes(W)},toMontgomerySecret(N){const I=S.secretKey;Jc(N,I);const F=e(N.subarray(0,I));return l(F).subarray(0,I)},randomPrivateKey:M,precompute(N=8,I=n.BASE){return I.precompute(N,!1)}};return Object.freeze({keygen:P,getPublicKey:m,sign:b,verify:v,utils:B,Point:n,lengths:S})}function fhe(n){const e={a:n.a,d:n.d,p:n.Fp.ORDER,n:n.n,h:n.h,Gx:n.Gx,Gy:n.Gy},t=n.Fp,i=c1(e.n,n.nBitLength,!0),r={Fp:t,Fn:i,uvRatio:n.uvRatio},s={randomBytes:n.randomBytes,adjustScalarBytes:n.adjustScalarBytes,domain:n.domain,prehash:n.prehash,mapToCurve:n.mapToCurve};return{CURVE:e,curveOpts:r,hash:n.hash,eddsaOpts:s}}function phe(n,e){const t=e.Point;return Object.assign({},e,{ExtendedPoint:t,CURVE:n,nBitLength:t.Fn.BITS,nByteLength:t.Fn.BYTES})}function mhe(n){const{CURVE:e,curveOpts:t,hash:i,eddsaOpts:r}=fhe(n),s=hhe(e,t),o=dhe(s,i,r);return phe(n,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const av=BigInt(0),J1=BigInt(1),u4=BigInt(2);function ghe(n){return sx(n,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...n})}function yhe(n){const e=ghe(n),{P:t,type:i,adjustScalarBytes:r,powPminus2:s,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");const l=o||rx,c=a?255:448,u=a?32:56,h=BigInt(a?9:5),p=BigInt(a?121665:39081),m=a?u4**BigInt(254):u4**BigInt(447),y=a?BigInt(8)*u4**BigInt(251)-J1:BigInt(4)*u4**BigInt(445)-J1,b=m+y+J1,w=W=>Yr(W,t),v=T(h);function T(W){return pk(w(W),u)}function S(W){const U=Pr("u coordinate",W,u);return a&&(U[31]&=127),w(Wm(U))}function M(W){return Wm(r(Pr("scalar",W,u)))}function P(W,U){const H=B(S(U),M(W));if(H===av)throw new Error("invalid private or public key received");return T(H)}function R(W){return P(W,v)}function O(W,U,H){const q=w(W*(U-H));return U=w(U-q),H=w(H+q),{x_2:U,x_3:H}}function B(W,U){rb("u",W,av,t),rb("scalar",U,m,b);const H=U,q=W;let J=J1,G=av,ee=W,Q=J1,ne=av;for(let Ae=BigInt(c-1);Ae>=av;Ae--){const Pe=H>>Ae&J1;ne^=Pe,{x_2:J,x_3:ee}=O(ne,J,ee),{x_2:G,x_3:Q}=O(ne,G,Q),ne=Pe;const Ce=J+G,de=w(Ce*Ce),Ne=J-G,et=w(Ne*Ne),me=de-et,nt=ee+Q,Pt=ee-Q,zt=w(Pt*Ce),Dt=w(nt*Ne),gt=zt+Dt,vt=zt-Dt;ee=w(gt*gt),Q=w(q*w(vt*vt)),J=w(de*et),G=w(me*(de+w(p*me)))}({x_2:J,x_3:ee}=O(ne,J,ee)),{x_2:G,x_3:Q}=O(ne,G,Q);const fe=s(G);return w(J*fe)}const N={secretKey:u,publicKey:u,seed:u},I=(W=l(u))=>(Ud(W,N.seed),W);function F(W){const U=I(W);return{secretKey:U,publicKey:R(U)}}return{keygen:F,getSharedSecret:(W,U)=>P(W,U),getPublicKey:W=>R(W),scalarMult:P,scalarMultBase:R,utils:{randomSecretKey:I,randomPrivateKey:I},GuBytes:v.slice(),lengths:N}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const xhe=BigInt(1),qU=BigInt(2),vhe=BigInt(3),bhe=BigInt(5),_he=BigInt(8),gk=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),Lq=(()=>({p:gk,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:_he,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function Dq(n){const e=BigInt(10),t=BigInt(20),i=BigInt(40),r=BigInt(80),s=gk,a=n*n%s*n%s,l=Br(a,qU,s)*a%s,c=Br(l,xhe,s)*n%s,u=Br(c,bhe,s)*c%s,h=Br(u,e,s)*u%s,p=Br(h,t,s)*h%s,m=Br(p,i,s)*p%s,y=Br(m,r,s)*m%s,b=Br(y,r,s)*m%s,w=Br(b,e,s)*u%s;return{pow_p_5_8:Br(w,qU,s)*n%s,b2:a}}function Oq(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}const ZU=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function whe(n,e){const t=gk,i=Yr(e*e*e,t),r=Yr(i*i*e,t),s=Dq(n*r).pow_p_5_8;let o=Yr(n*i*s,t);const a=Yr(e*o*o,t),l=o,c=Yr(o*ZU,t),u=a===n,h=a===Yr(-n,t),p=a===Yr(-n*ZU,t);return u&&(o=l),(h||p)&&(o=c),the(o,t)&&(o=Yr(-o,t)),{isValid:u||h,value:o}}const Bq=(()=>c1(Lq.p,{isLE:!0}))(),She=(()=>({...Lq,Fp:Bq,hash:mq,adjustScalarBytes:Oq,uvRatio:whe}))(),hh=(()=>mhe(She))(),h4=(()=>{const n=Bq.ORDER;return yhe({P:n,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:i}=Dq(e);return Yr(Br(t,vhe,n)*i,n)},adjustScalarBytes:Oq})})(),sb=32,Bf=64,I6=32;function Ehe(){const n=hh.utils.randomPrivateKey(),e=hh.getPublicKey(n);return{privateKey:Uq(n,e),publicKey:e}}function The(n){if(n.length!==I6)throw new TypeError('"seed" must be 32 bytes in length.');if(!(n instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=n,t=hh.getPublicKey(e);return{privateKey:Uq(e,t),publicKey:t}}function Ahe(n,e){const t=n.subarray(0,I6);return hh.sign(e instanceof Uint8Array?e:e.subarray(),t)}function Che(n,e,t){return hh.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}function Uq(n,e){const t=new Uint8Array(Bf);for(let i=0;i<I6;i++)t[i]=n[i],t[I6+i]=e[i];return t}const hu={get(n=globalThis){const e=n.crypto;if(e?.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},xA={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Mhe(n){const e=n?.algorithm??"AES-GCM";let t=n?.keyLength??16;const i=n?.nonceLength??12,r=n?.digest??"SHA-256",s=n?.saltLength??16,o=n?.iterations??32767,a=hu.get();t*=8;async function l(h,p){const m=a.getRandomValues(new Uint8Array(s)),y=a.getRandomValues(new Uint8Array(i)),b={name:e,iv:y};typeof p=="string"&&(p=Ut(p));let w;if(p.length===0){w=await a.subtle.importKey("jwk",xA,{name:"AES-GCM"},!0,["encrypt"]);try{const T={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},S=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(T,S,{name:e,length:t},!0,["encrypt"])}catch{w=await a.subtle.importKey("jwk",xA,{name:"AES-GCM"},!0,["encrypt"])}}else{const T={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},S=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(T,S,{name:e,length:t},!0,["encrypt"])}const v=await a.subtle.encrypt(b,w,h);return Ms([m,b.iv,new Uint8Array(v)])}async function c(h,p){const m=h.subarray(0,s),y=h.subarray(s,s+i),b=h.subarray(s+i),w={name:e,iv:y};typeof p=="string"&&(p=Ut(p));let v;if(p.length===0)try{const S={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},M=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(S,M,{name:e,length:t},!0,["decrypt"])}catch{v=await a.subtle.importKey("jwk",xA,{name:"AES-GCM"},!0,["decrypt"])}else{const S={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},M=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(S,M,{name:e,length:t},!0,["decrypt"])}const T=await a.subtle.decrypt(w,v,b);return new Uint8Array(T)}return{encrypt:l,decrypt:c}}async function yk(n,e){const i=await Mhe().encrypt(n,e);return g7.encode(i)}const Rhe=Math.pow(2,7),Ihe=Math.pow(2,14),Nhe=Math.pow(2,21),xk=Math.pow(2,28),vk=Math.pow(2,35),bk=Math.pow(2,42),_k=Math.pow(2,49),Wi=128,Co=127;function nr(n){if(n<Rhe)return 1;if(n<Ihe)return 2;if(n<Nhe)return 3;if(n<xk)return 4;if(n<vk)return 5;if(n<bk)return 6;if(n<_k)return 7;if(Number.MAX_SAFE_INTEGER!=null&&n>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function M0(n,e,t=0){switch(nr(n)){case 8:e[t++]=n&255|Wi,n/=128;case 7:e[t++]=n&255|Wi,n/=128;case 6:e[t++]=n&255|Wi,n/=128;case 5:e[t++]=n&255|Wi,n/=128;case 4:e[t++]=n&255|Wi,n>>>=7;case 3:e[t++]=n&255|Wi,n>>>=7;case 2:e[t++]=n&255|Wi,n>>>=7;case 1:{e[t++]=n&255,n>>>=7;break}default:throw new Error("unreachable")}return e}function Phe(n,e,t=0){switch(nr(n)){case 8:e.set(t++,n&255|Wi),n/=128;case 7:e.set(t++,n&255|Wi),n/=128;case 6:e.set(t++,n&255|Wi),n/=128;case 5:e.set(t++,n&255|Wi),n/=128;case 4:e.set(t++,n&255|Wi),n>>>=7;case 3:e.set(t++,n&255|Wi),n>>>=7;case 2:e.set(t++,n&255|Wi),n>>>=7;case 1:{e.set(t++,n&255),n>>>=7;break}default:throw new Error("unreachable")}return e}function x7(n,e){let t=n[e],i=0;if(i+=t&Co,t<Wi||(t=n[e+1],i+=(t&Co)<<7,t<Wi)||(t=n[e+2],i+=(t&Co)<<14,t<Wi)||(t=n[e+3],i+=(t&Co)<<21,t<Wi)||(t=n[e+4],i+=(t&Co)*xk,t<Wi)||(t=n[e+5],i+=(t&Co)*vk,t<Wi)||(t=n[e+6],i+=(t&Co)*bk,t<Wi)||(t=n[e+7],i+=(t&Co)*_k,t<Wi))return i;throw new RangeError("Could not decode varint")}function khe(n,e){let t=n.get(e),i=0;if(i+=t&Co,t<Wi||(t=n.get(e+1),i+=(t&Co)<<7,t<Wi)||(t=n.get(e+2),i+=(t&Co)<<14,t<Wi)||(t=n.get(e+3),i+=(t&Co)<<21,t<Wi)||(t=n.get(e+4),i+=(t&Co)*xk,t<Wi)||(t=n.get(e+5),i+=(t&Co)*vk,t<Wi)||(t=n.get(e+6),i+=(t&Co)*bk,t<Wi)||(t=n.get(e+7),i+=(t&Co)*_k,t<Wi))return i;throw new RangeError("Could not decode varint")}function Za(n,e,t=0){return e==null&&(e=Cs(nr(n))),e instanceof Uint8Array?M0(n,e,t):Phe(n,e,t)}function $0(n,e=0){return n instanceof Uint8Array?x7(n,e):khe(n,e)}const wk=new Float32Array([-0]),Yf=new Uint8Array(wk.buffer);function Lhe(n,e,t){wk[0]=n,e[t]=Yf[0],e[t+1]=Yf[1],e[t+2]=Yf[2],e[t+3]=Yf[3]}function Dhe(n,e){return Yf[0]=n[e],Yf[1]=n[e+1],Yf[2]=n[e+2],Yf[3]=n[e+3],wk[0]}const Sk=new Float64Array([-0]),Mo=new Uint8Array(Sk.buffer);function Ohe(n,e,t){Sk[0]=n,e[t]=Mo[0],e[t+1]=Mo[1],e[t+2]=Mo[2],e[t+3]=Mo[3],e[t+4]=Mo[4],e[t+5]=Mo[5],e[t+6]=Mo[6],e[t+7]=Mo[7]}function Bhe(n,e){return Mo[0]=n[e],Mo[1]=n[e+1],Mo[2]=n[e+2],Mo[3]=n[e+3],Mo[4]=n[e+4],Mo[5]=n[e+5],Mo[6]=n[e+6],Mo[7]=n[e+7],Sk[0]}const Uhe=BigInt(Number.MAX_SAFE_INTEGER),Fhe=BigInt(Number.MIN_SAFE_INTEGER);let td=class Vp{constructor(e,t){E(this,"lo");E(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let i=~this.hi>>>0;return t===0&&(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let i=~this.hi>>>0;return t===0&&(i=i+1>>>0),-(BigInt(t)+(BigInt(i)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}static fromBigInt(e){if(e===0n)return Am;if(e<Uhe&&e>Fhe)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let i=e>>32n,r=e-(i<<32n);return t&&(i=~i|0n,r=~r|0n,++r>YU&&(r=0n,++i>YU&&(i=0n))),new Vp(Number(r),Number(i))}static fromNumber(e){if(e===0)return Am;const t=e<0;t&&(e=-e);let i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new Vp(i,r)}static from(e){return typeof e=="number"?Vp.fromNumber(e):typeof e=="bigint"?Vp.fromBigInt(e):typeof e=="string"?Vp.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Vp(e.low>>>0,e.high>>>0):Am}};const Am=new td(0,0);Am.toBigInt=function(){return 0n};Am.zzEncode=Am.zzDecode=function(){return this};Am.length=function(){return 1};const YU=4294967296n;function zhe(n){let e=0,t=0;for(let i=0;i<n.length;++i)t=n.charCodeAt(i),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(n.charCodeAt(i+1)&64512)===56320?(++i,e+=4):e+=3;return e}function jhe(n,e,t){if(t-e<1)return"";let r;const s=[];let o=0,a;for(;e<t;)a=n[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|n[e++]&63:a>239&&a<365?(a=((a&7)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(n[e++]&63)<<6|n[e++]&63,o>8191&&((r??(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r!=null?(o>0&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function Fq(n,e,t){const i=t;let r,s;for(let o=0;o<n.length;++o)r=n.charCodeAt(o),r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&((s=n.charCodeAt(o+1))&64512)===56320?(r=65536+((r&1023)<<10)+(s&1023),++o,e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128);return t-i}function Nc(n,e){return RangeError(`index out of range: ${n.pos} + ${e??1} > ${n.len}`)}function d4(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}let Vhe=class{constructor(e){E(this,"buf");E(this,"pos");E(this,"len");E(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Nc(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Nc(this,4);return d4(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Nc(this,4);return d4(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Nc(this,4);const e=Dhe(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Nc(this,4);const e=Bhe(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw Nc(this,e);return this.pos+=e,t===i?new Uint8Array(0):this.buf.subarray(t,i)}string(){const e=this.bytes();return jhe(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Nc(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Nc(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new td(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Nc(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Nc(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Nc(this,8);const e=d4(this.buf,this.pos+=4),t=d4(this.buf,this.pos+=4);return new td(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=x7(this.buf,this.pos);return this.pos+=nr(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Hhe(n){return new Vhe(n instanceof Uint8Array?n:n.subarray())}function Ei(n,e,t){const i=Hhe(n);return e.decode(i,void 0,t)}function $he(n){const e=n??8192,t=e>>>1;let i,r=e;return function(o){if(o<1||o>t)return Cs(o);r+o>e&&(i=Cs(e),r=0);const a=i.subarray(r,r+=o);return r&7&&(r=(r|7)+1),a}}let Gv=class{constructor(e,t,i){E(this,"fn");E(this,"len");E(this,"next");E(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=i}};function vA(){}let Ghe=class{constructor(e){E(this,"head");E(this,"tail");E(this,"len");E(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}};const Whe=$he();function Khe(n){return globalThis.Buffer!=null?Cs(n):Whe(n)}let ZR=class{constructor(){E(this,"len");E(this,"head");E(this,"tail");E(this,"states");this.len=0,this.head=new Gv(vA,0,0),this.tail=this.head,this.states=null}_push(e,t,i){return this.tail=this.tail.next=new Gv(e,t,i),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Zhe((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(f4,10,td.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=td.fromBigInt(e);return this._push(f4,t.length(),t)}uint64Number(e){return this._push(M0,nr(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=td.fromBigInt(e).zzEncode();return this._push(f4,t.length(),t)}sint64Number(e){const t=td.fromNumber(e).zzEncode();return this._push(f4,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(bA,1,e?1:0)}fixed32(e){return this._push(lv,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=td.fromBigInt(e);return this._push(lv,4,t.lo)._push(lv,4,t.hi)}fixed64Number(e){const t=td.fromNumber(e);return this._push(lv,4,t.lo)._push(lv,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(Lhe,4,e)}double(e){return this._push(Ohe,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(bA,1,0):this.uint32(t)._push(Yhe,t,e)}string(e){const t=zhe(e);return t!==0?this.uint32(t)._push(Fq,t,e):this._push(bA,1,0)}fork(){return this.states=new Ghe(this),this.head=this.tail=new Gv(vA,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Gv(vA,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i!==0&&(this.tail.next=e.next,this.tail=t,this.len+=i),this}finish(){let e=this.head.next;const t=Khe(this.len);let i=0;for(;e!=null;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t}};function bA(n,e,t){e[t]=n&255}function qhe(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}let Zhe=class extends Gv{constructor(t,i){super(qhe,t,i);E(this,"next");this.next=void 0}};function f4(n,e,t){for(;n.hi!==0;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}function lv(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function Yhe(n,e,t){e.set(n,t)}globalThis.Buffer!=null&&(ZR.prototype.bytes=function(n){const e=n.length>>>0;return this.uint32(e),e>0&&this._push(Xhe,e,n),this},ZR.prototype.string=function(n){const e=globalThis.Buffer.byteLength(n);return this.uint32(e),e>0&&this._push(Qhe,e,n),this});function Xhe(n,e,t){e.set(n,t)}function Qhe(n,e,t){n.length<40?Fq(n,e,t):e.utf8Write!=null?e.utf8Write(n,t):e.set(Ut(n),t)}function Jhe(){return new ZR}function Ti(n,e){const t=Jhe();return e.encode(n,t,{lengthDelimited:!1}),t.finish()}var N6;(function(n){n[n.VARINT=0]="VARINT",n[n.BIT64=1]="BIT64",n[n.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",n[n.START_GROUP=3]="START_GROUP",n[n.END_GROUP=4]="END_GROUP",n[n.BIT32=5]="BIT32"})(N6||(N6={}));function zq(n,e,t,i){return{name:n,type:e,encode:t,decode:i}}function u1(n){function e(r){if(n[r.toString()]==null)throw new Error("Invalid enum value");return n[r]}const t=function(s,o){const a=e(s);o.int32(a)},i=function(s){const o=s.int32();return e(o)};return zq("enum",N6.VARINT,t,i)}function Ai(n,e){return zq("message",N6.LENGTH_DELIMITED,n,e)}let zc=class extends Error{constructor(t,i,r){super(t,r);E(this,"code");this.code=i}};var ps;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.Secp256k1="Secp256k1"})(ps||(ps={}));var YR;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.Secp256k1=2]="Secp256k1"})(YR||(YR={}));(function(n){n.codec=()=>u1(YR)})(ps||(ps={}));var x2;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.Type!=null&&(i.uint32(8),ps.codec().encode(t.Type,i)),t.Data!=null&&(i.uint32(18),i.bytes(t.Data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.Type=ps.codec().decode(t);break;case 2:r.Data=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(x2||(x2={}));var v2;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.Type!=null&&(i.uint32(8),ps.codec().encode(t.Type,i)),t.Data!=null&&(i.uint32(18),i.bytes(t.Data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.Type=ps.codec().decode(t);break;case 2:r.Data=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(v2||(v2={}));let Ek=class{constructor(e){E(this,"_key");this._key=b2(e,sb)}verify(e,t){return Che(this._key,t,e)}marshal(){return this._key}get bytes(){return x2.encode({Type:ps.Ed25519,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return H0(e)?e.then(({bytes:t})=>t):e.bytes}},ob=class{constructor(e,t){E(this,"_key");E(this,"_publicKey");this._key=b2(e,Bf),this._publicKey=b2(t,sb)}sign(e){return Ahe(this._key,e)}get public(){return new Ek(this._publicKey)}marshal(){return this._key}get bytes(){return v2.encode({Type:ps.Ed25519,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}async hash(){const e=Ir.digest(this.bytes);let t;return H0(e)?{bytes:t}=await e:t=e.bytes,t}async id(){const e=xc.digest(this.public.bytes);return Lr.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return yk(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function ede(n){if(n.length>Bf){n=b2(n,Bf+sb);const i=n.subarray(0,Bf),r=n.subarray(Bf,n.length);return new ob(i,r)}n=b2(n,Bf);const e=n.subarray(0,Bf),t=n.subarray(sb);return new ob(e,t)}function tde(n){return n=b2(n,sb),new Ek(n)}async function nde(){const{privateKey:n,publicKey:e}=Ehe();return new ob(n,e)}async function ide(n){const{privateKey:e,publicKey:t}=The(n);return new ob(e,t)}function b2(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new Se(`Key must be a Uint8Array of length ${e}, got ${n.length}`,"ERR_INVALID_KEY_TYPE");return n}const rde=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey:ob,Ed25519PublicKey:Ek,generateKeyPair:nde,generateKeyPairFromSeed:ide,unmarshalEd25519PrivateKey:ede,unmarshalEd25519PublicKey:tde},Symbol.toStringTag,{value:"Module"}));function Vt(n,e="utf8"){const t=aq[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(n).substring(1)}function R0(n){if(isNaN(n)||n<=0)throw new Se("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return rx(n)}class jq extends uq{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,x_(e);const i=ib(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(i.length>r?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),C0(s)}update(e){return A6(this),this.iHash.update(e),this}digestInto(e){A6(this),Ud(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:r,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const b_=(n,e,t)=>new jq(n,e).update(t).digest();b_.create=(n,e)=>new jq(n,e);function sde(n,e,t,i){x_(n);const r=Nue({dkLen:32,asyncTick:10},i),{c:s,dkLen:o,asyncTick:a}=r;if(Em(s),Em(o),Em(a),s<1)throw new Error("iterations (c) should be >= 1");const l=UU(e),c=UU(t),u=new Uint8Array(o),h=b_.create(n,l),p=h._cloneInto().update(c);return{c:s,dkLen:o,asyncTick:a,DK:u,PRF:h,PRFSalt:p}}function ode(n,e,t,i,r){return n.destroy(),e.destroy(),i&&i.destroy(),C0(r),t}async function ade(n,e,t,i){const{c:r,dkLen:s,asyncTick:o,DK:a,PRF:l,PRFSalt:c}=sde(n,e,t,i);let u;const h=new Uint8Array(4),p=fS(h),m=new Uint8Array(l.outputLen);for(let y=1,b=0;b<s;y++,b+=l.outputLen){const w=a.subarray(b,b+l.outputLen);p.setInt32(0,y,!1),(u=c._cloneInto(u)).update(h).digestInto(m),w.set(m.subarray(0,w.length)),await Iue(r-1,o,()=>{l._cloneInto(u).update(m).digestInto(m);for(let v=0;v<w.length;v++)w[v]^=m[v]})}return ode(l,c,a,u,m)}const lde=mq;/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const cde="[object ArrayBuffer]";class pr{static isArrayBuffer(e){return Object.prototype.toString.call(e)===cde}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const i=pr.toUint8Array(e),r=pr.toUint8Array(t);if(i.length!==r.byteLength)return!1;for(let s=0;s<i.length;s++)if(i[s]!==r[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let i=0;for(const o of t)i+=o.byteLength;const r=new Uint8Array(i);let s=0;for(const o of t){const a=this.toUint8Array(o);r.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(r,e[e.length-1]):r.buffer}}const _A="string",ude=/^[0-9a-f\s]+$/i,hde=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,dde=/^[a-zA-Z0-9-_]+$/;class XU{static fromString(e){const t=unescape(encodeURIComponent(e)),i=new Uint8Array(t.length);for(let r=0;r<t.length;r++)i[r]=t.charCodeAt(r);return i.buffer}static toString(e){const t=pr.toUint8Array(e);let i="";for(let s=0;s<t.length;s++)i+=String.fromCharCode(t[s]);return decodeURIComponent(escape(i))}}class Tu{static toString(e,t=!1){const i=pr.toArrayBuffer(e),r=new DataView(i);let s="";for(let o=0;o<i.byteLength;o+=2){const a=r.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const i=new ArrayBuffer(e.length*2),r=new DataView(i);for(let s=0;s<e.length;s++)r.setUint16(s*2,e.charCodeAt(s),t);return i}}class Xr{static isHex(e){return typeof e===_A&&ude.test(e)}static isBase64(e){return typeof e===_A&&hde.test(e)}static isBase64Url(e){return typeof e===_A&&dde.test(e)}static ToString(e,t="utf8"){const i=pr.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(i);case"binary":return this.ToBinary(i);case"hex":return this.ToHex(i);case"base64":return this.ToBase64(i);case"base64url":return this.ToBase64Url(i);case"utf16le":return Tu.toString(i,!0);case"utf16":case"utf16be":return Tu.toString(i);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Tu.fromString(e,!0);case"utf16":case"utf16be":return Tu.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=pr.toUint8Array(e);if(typeof btoa<"u"){const i=this.ToString(t,"binary");return btoa(i)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Xr.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Xr.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Xr.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return XU.fromString(e);case"utf16":case"utf16be":return Tu.fromString(e);case"utf16le":case"usc2":return Tu.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Xr.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return XU.toString(e);case"utf16":case"utf16be":return Tu.toString(e);case"utf16le":case"usc2":return Tu.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,i=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);return i.buffer}static ToBinary(e){const t=pr.toUint8Array(e);let i="";for(let r=0;r<t.length;r++)i+=String.fromCharCode(t[r]);return i}static ToHex(e){const t=pr.toUint8Array(e);let i="";const r=t.length;for(let s=0;s<r;s++){const o=t[s];o<16&&(i+="0"),i+=o.toString(16)}return i}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Xr.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const i=new Uint8Array(t.length/2);for(let r=0;r<t.length;r=r+2){const s=t.slice(r,r+2);i[r/2]=parseInt(s,16)}return i.buffer}static ToUtf16String(e,t=!1){return Tu.toString(e,t)}static FromUtf16String(e,t=!1){return Tu.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let i=0;i<t;i++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}}Xr.DEFAULT_UTF8_ENCODING="utf8";/*!
 Copyright (c) Peculiar Ventures, LLC
*/function _2(n,e){let t=0;if(n.length===1)return n[0];for(let i=n.length-1;i>=0;i--)t+=n[n.length-1-i]*Math.pow(2,e*i);return t}function Km(n,e,t=-1){const i=t;let r=n,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(n<o){let l;if(i<0)l=new ArrayBuffer(a),s=a;else{if(i<a)return new ArrayBuffer(0);l=new ArrayBuffer(i),s=i}const c=new Uint8Array(l);for(let u=a-1;u>=0;u--){const h=Math.pow(2,u*e);c[s-u-1]=Math.floor(r/h),r-=c[s-u-1]*h}return l}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function XR(...n){let e=0,t=0;for(const s of n)e+=s.length;const i=new ArrayBuffer(e),r=new Uint8Array(i);for(const s of n)r.set(s,t),t+=s.length;return r}function Vq(){const n=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=n[0]===255&&n[1]&128,l=n[0]===0&&(n[1]&128)===0;(a||l)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=n[0]&128;const i=_2(t,8),r=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(r);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=n[a];return s[0]&=127,_2(s,8)-i}function fde(n){const e=n<0?n*-1:n;let t=128;for(let i=1;i<8;i++){if(e<=t){if(n<0){const o=t-e,a=Km(o,8,i),l=new Uint8Array(a);return l[0]|=128,a}let r=Km(e,8,i),s=new Uint8Array(r);if(s[0]&128){const o=r.slice(0),a=new Uint8Array(o);r=new ArrayBuffer(r.byteLength+1),s=new Uint8Array(r);for(let l=0;l<o.byteLength;l++)s[l+1]=a[l];s[0]=0}return r}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function pde(n,e){if(n.byteLength!==e.byteLength)return!1;const t=new Uint8Array(n),i=new Uint8Array(e);for(let r=0;r<t.length;r++)if(t[r]!==i[r])return!1;return!0}function xl(n,e){const t=n.toString(10);if(e<t.length)return"";const i=e-t.length,r=new Array(i);for(let o=0;o<i;o++)r[o]="0";return r.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function P6(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function Tk(n){let e=0,t=0;for(let r=0;r<n.length;r++){const s=n[r];e+=s.byteLength}const i=new Uint8Array(e);for(let r=0;r<n.length;r++){const s=n[r];i.set(new Uint8Array(s),t),t+=s.byteLength}return i.buffer}function Fd(n,e,t,i){return e instanceof Uint8Array?e.byteLength?t<0?(n.error="Wrong parameter: inputOffset less than zero",!1):i<0?(n.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-i<0?(n.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(n.error="Wrong parameter: inputBuffer has zero length",!1):(n.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Ak{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return Tk(this.items)}}const cv=[new Uint8Array([1])],QU="0123456789",ox="",mh=new ArrayBuffer(0),Ck=new Uint8Array(0),ab="EndOfContent",Hq="OCTET STRING",$q="BIT STRING";function zd(n){var e;return e=class extends n{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(i){this.valueHexView=new Uint8Array(i)}constructor(...i){var r;super(...i);const s=i[0]||{};this.isHexOnly=(r=s.isHexOnly)!==null&&r!==void 0?r:!1,this.valueHexView=s.valueHex?pr.toUint8Array(s.valueHex):Ck}fromBER(i,r,s){const o=i instanceof ArrayBuffer?new Uint8Array(i):i;if(!Fd(this,o,r,s))return-1;const a=r+s;return this.valueHexView=o.subarray(r,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),r)}toBER(i=!1){return this.isHexOnly?i?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",mh)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Xr.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class h1{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=ox,warnings:i=[],valueBeforeDecode:r=Ck}={}){this.blockLength=e,this.error=t,this.warnings=i,this.valueBeforeDecodeView=pr.toUint8Array(r)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Xr.ToHex(this.valueBeforeDecodeView)}}}h1.NAME="baseBlock";class Ja extends h1{fromBER(e,t,i){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}Ja.NAME="valueBlock";class Gq extends zd(h1){constructor({idBlock:e={}}={}){var t,i,r,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?pr.toUint8Array(e.valueHex):Ck,this.tagClass=(i=e.tagClass)!==null&&i!==void 0?i:-1,this.tagNumber=(r=e.tagNumber)!==null&&r!==void 0?r:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",mh}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const r=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,r[0]=t}return r.buffer}if(!this.isHexOnly){const r=Km(this.tagNumber,7),s=new Uint8Array(r),o=r.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let l=0;l<o-1;l++)a[l+1]=s[l]|128;a[o]=s[o-1]}return a.buffer}const i=new Uint8Array(this.valueHexView.byteLength+1);if(i[0]=t|31,!e){const r=this.valueHexView;for(let s=0;s<r.length-1;s++)i[s+1]=r[s]|128;i[this.valueHexView.byteLength]=r[r.length-1]}return i.buffer}fromBER(e,t,i){const r=pr.toUint8Array(e);if(!Fd(this,r,t,i))return-1;const s=r.subarray(t,t+i);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let l=1,c=this.valueHexView=new Uint8Array(255),u=255;for(;s[l]&128;){if(c[l-1]=s[l]&127,l++,l>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(l===u){u+=255;const p=new Uint8Array(u);for(let m=0;m<c.length;m++)p[m]=c[m];c=this.valueHexView=new Uint8Array(u)}}this.blockLength=l+1,c[l-1]=s[l]&127;const h=new Uint8Array(l);for(let p=0;p<l;p++)h[p]=c[p];c=this.valueHexView=new Uint8Array(l),c.set(h),this.blockLength<=9?this.tagNumber=_2(c,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Gq.NAME="identificationBlock";class Wq extends h1{constructor({lenBlock:e={}}={}){var t,i,r;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(i=e.longFormUsed)!==null&&i!==void 0?i:!1,this.length=(r=e.length)!==null&&r!==void 0?r:0}fromBER(e,t,i){const r=pr.toUint8Array(e);if(!Fd(this,r,t,i))return-1;const s=r.subarray(t,t+i);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,l=r.subarray(a,a+o);return l[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=_2(l,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,i;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(i=new Uint8Array(t),i[0]=128),t;if(this.longFormUsed){const r=Km(this.length,8);if(r.byteLength>127)return this.error="Too big length",mh;if(t=new ArrayBuffer(r.byteLength+1),e)return t;const s=new Uint8Array(r);i=new Uint8Array(t),i[0]=r.byteLength|128;for(let o=0;o<r.byteLength;o++)i[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(i=new Uint8Array(t),i[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}Wq.NAME="lengthBlock";const ln={};class pa extends h1{constructor({name:e=ox,optional:t=!1,primitiveSchema:i,...r}={},s){super(r),this.name=e,this.optional=t,i&&(this.primitiveSchema=i),this.idBlock=new Gq(r),this.lenBlock=new Wq(r),this.valueBlock=s?new s(r):new Ja(r)}fromBER(e,t,i){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return r===-1?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}toBER(e,t){const i=t||new Ak;t||Kq(this);const r=this.idBlock.toBER(e);if(i.write(r),this.lenBlock.isIndefiniteForm)i.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,i),i.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);i.write(o),i.write(s)}return t?mh:i.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Xr.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Xr.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),i=e.toBER();return pde(t,i)}}pa.NAME="BaseBlock";function Kq(n){var e;if(n instanceof ln.Constructed)for(const t of n.valueBlock.value)Kq(t)&&(n.lenBlock.isIndefiniteForm=!0);return!!(!((e=n.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class qq extends pa{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=ox,...t}={},i){super(t,i),e&&this.fromString(e)}fromBER(e,t,i){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return r===-1?(this.error=this.valueBlock.error,r):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}qq.NAME="BaseStringBlock";class Zq extends zd(Ja){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}Zq.NAME="PrimitiveValueBlock";var Yq;class Xq extends pa{constructor(e={}){super(e,Zq),this.idBlock.isConstructed=!1}}Yq=Xq;ln.Primitive=Yq;Xq.NAME="PRIMITIVE";function mde(n,e){if(n instanceof e)return n;const t=new e;return t.idBlock=n.idBlock,t.lenBlock=n.lenBlock,t.warnings=n.warnings,t.valueBeforeDecodeView=n.valueBeforeDecodeView,t}function v7(n,e=0,t=n.length){const i=e;let r=new pa({},Ja);const s=new h1;if(!Fd(s,n,e,t))return r.error=s.error,{offset:-1,result:r};if(!n.subarray(e,e+t).length)return r.error="Zero buffer length",{offset:-1,result:r};let a=r.idBlock.fromBER(n,e,t);if(r.idBlock.warnings.length&&r.warnings.concat(r.idBlock.warnings),a===-1)return r.error=r.idBlock.error,{offset:-1,result:r};if(e=a,t-=r.idBlock.blockLength,a=r.lenBlock.fromBER(n,e,t),r.lenBlock.warnings.length&&r.warnings.concat(r.lenBlock.warnings),a===-1)return r.error=r.lenBlock.error,{offset:-1,result:r};if(e=a,t-=r.lenBlock.blockLength,!r.idBlock.isConstructed&&r.lenBlock.isIndefiniteForm)return r.error="Indefinite length form used for primitive encoding form",{offset:-1,result:r};let l=pa;switch(r.idBlock.tagClass){case 1:if(r.idBlock.tagNumber>=37&&r.idBlock.isHexOnly===!1)return r.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:r};switch(r.idBlock.tagNumber){case 0:if(r.idBlock.isConstructed&&r.lenBlock.length>0)return r.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:r};l=ln.EndOfContent;break;case 1:l=ln.Boolean;break;case 2:l=ln.Integer;break;case 3:l=ln.BitString;break;case 4:l=ln.OctetString;break;case 5:l=ln.Null;break;case 6:l=ln.ObjectIdentifier;break;case 10:l=ln.Enumerated;break;case 12:l=ln.Utf8String;break;case 13:l=ln.RelativeObjectIdentifier;break;case 14:l=ln.TIME;break;case 15:return r.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:r};case 16:l=ln.Sequence;break;case 17:l=ln.Set;break;case 18:l=ln.NumericString;break;case 19:l=ln.PrintableString;break;case 20:l=ln.TeletexString;break;case 21:l=ln.VideotexString;break;case 22:l=ln.IA5String;break;case 23:l=ln.UTCTime;break;case 24:l=ln.GeneralizedTime;break;case 25:l=ln.GraphicString;break;case 26:l=ln.VisibleString;break;case 27:l=ln.GeneralString;break;case 28:l=ln.UniversalString;break;case 29:l=ln.CharacterString;break;case 30:l=ln.BmpString;break;case 31:l=ln.DATE;break;case 32:l=ln.TimeOfDay;break;case 33:l=ln.DateTime;break;case 34:l=ln.Duration;break;default:{const c=r.idBlock.isConstructed?new ln.Constructed:new ln.Primitive;c.idBlock=r.idBlock,c.lenBlock=r.lenBlock,c.warnings=r.warnings,r=c}}break;case 2:case 3:case 4:default:l=r.idBlock.isConstructed?ln.Constructed:ln.Primitive}return r=mde(r,l),a=r.fromBER(n,e,r.lenBlock.isIndefiniteForm?t:r.lenBlock.length),r.valueBeforeDecodeView=n.subarray(i,i+r.blockLength),{offset:a,result:r}}function Qq(n){if(!n.byteLength){const e=new pa({},Ja);return e.error="Input buffer has zero length",{offset:-1,result:e}}return v7(pr.toUint8Array(n).slice(),0,n.byteLength)}function gde(n,e){return n?1:e}class y0 extends Ja{constructor({value:e=[],isIndefiniteForm:t=!1,...i}={}){super(i),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,i){const r=pr.toUint8Array(e);if(!Fd(this,r,t,i))return-1;if(this.valueBeforeDecodeView=r.subarray(t,t+i),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;gde(this.isIndefiniteForm,i)>0;){const o=v7(r,s,i);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,i-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===ab)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===ab?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const i=t||new Ak;for(let r=0;r<this.value.length;r++)this.value[r].toBER(e,i);return t?mh:i.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}y0.NAME="ConstructedValueBlock";var Jq;class ax extends pa{constructor(e={}){super(e,y0),this.idBlock.isConstructed=!0}fromBER(e,t,i){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?i:this.lenBlock.length);return r===-1?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){const e=[];for(const i of this.valueBlock.value)e.push(i.toString("ascii").split(`
`).map(r=>`  ${r}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}Jq=ax;ln.Constructed=Jq;ax.NAME="CONSTRUCTED";class eZ extends Ja{fromBER(e,t,i){return t}toBER(e){return mh}}eZ.override="EndOfContentValueBlock";var tZ;class nZ extends pa{constructor(e={}){super(e,eZ),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}tZ=nZ;ln.EndOfContent=tZ;nZ.NAME=ab;var iZ;class lb extends pa{constructor(e={}){super(e,Ja),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,i){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=i,t+i>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+i}toBER(e,t){const i=new ArrayBuffer(2);if(!e){const r=new Uint8Array(i);r[0]=5,r[1]=0}return t&&t.write(i),i}onAsciiEncoding(){return`${this.constructor.NAME}`}}iZ=lb;ln.Null=iZ;lb.NAME="NULL";class rZ extends zd(Ja){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=pr.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,i){const r=pr.toUint8Array(e);return Fd(this,r,t,i)?(this.valueHexView=r.subarray(t,t+i),i>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,Vq.call(this),this.blockLength=i,t+i):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}rZ.NAME="BooleanValueBlock";var sZ;let oZ=class extends pa{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,rZ),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};sZ=oZ;ln.Boolean=sZ;oZ.NAME="BOOLEAN";class aZ extends zd(y0){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,i){let r=0;if(this.isConstructed){if(this.isHexOnly=!1,r=y0.prototype.fromBER.call(this,e,t,i),r===-1)return r;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===ab){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==Hq)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,r=super.fromBER(e,t,i),this.blockLength=i;return r}toBER(e,t){return this.isConstructed?y0.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}aZ.NAME="OctetStringValueBlock";var Mk;class ty extends pa{constructor({idBlock:e={},lenBlock:t={},...i}={}){var r,s;(r=i.isConstructed)!==null&&r!==void 0||(i.isConstructed=!!(!((s=i.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:i.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!i.isIndefiniteForm},...i},aZ),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,i){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,i===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+i);try{if(s.byteLength){const o=v7(s,0,s.byteLength);o.offset!==-1&&o.offset===i&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,i)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return ax.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Xr.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof Mk&&e.push(t.valueBlock.valueHexView);return pr.concat(e)}}Mk=ty;ln.OctetString=Mk;ty.NAME=Hq;class lZ extends zd(y0){constructor({unusedBits:e=0,isConstructed:t=!1,...i}={}){super(i),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,i){if(!i)return t;let r=-1;if(this.isConstructed){if(r=y0.prototype.fromBER.call(this,e,t,i),r===-1)return r;for(const a of this.value){const l=a.constructor.NAME;if(l===ab){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(l!==$q)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const c=a.valueBlock;if(this.unusedBits>0&&c.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=c.unusedBits}return r}const s=pr.toUint8Array(e);if(!Fd(this,s,t,i))return-1;const o=s.subarray(t,t+i);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const l=v7(a,0,a.byteLength);l.offset!==-1&&l.offset===i-1&&(this.value=[l.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+i}toBER(e,t){if(this.isConstructed)return y0.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength){const r=new Uint8Array(1);return r[0]=0,r.buffer}const i=new Uint8Array(this.valueHexView.length+1);return i[0]=this.unusedBits,i.set(this.valueHexView,1),i.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}lZ.NAME="BitStringValueBlock";var cZ;class Rk extends pa{constructor({idBlock:e={},lenBlock:t={},...i}={}){var r,s;(r=i.isConstructed)!==null&&r!==void 0||(i.isConstructed=!!(!((s=i.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:i.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!i.isIndefiniteForm},...i},lZ),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,i){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,i)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return ax.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const i=e.join(""),r=this.constructor.NAME,s=i.substring(0,i.length-this.valueBlock.unusedBits);return`${r} : ${s}`}}}cZ=Rk;ln.BitString=cZ;Rk.NAME=$q;var uZ;function yde(n,e){const t=new Uint8Array([0]),i=new Uint8Array(n),r=new Uint8Array(e);let s=i.slice(0);const o=s.length-1,a=r.slice(0),l=a.length-1;let c=0;const u=l<o?o:l;let h=0;for(let p=u;p>=0;p--,h++){switch(!0){case h<a.length:c=s[o-h]+a[l-h]+t[0];break;default:c=s[o-h]+t[0]}switch(t[0]=c/10,!0){case h>=s.length:s=XR(new Uint8Array([c%10]),s);break;default:s[o-h]=c%10}}return t[0]>0&&(s=XR(t,s)),s}function JU(n){if(n>=cv.length)for(let e=cv.length;e<=n;e++){const t=new Uint8Array([0]);let i=cv[e-1].slice(0);for(let r=i.length-1;r>=0;r--){const s=new Uint8Array([(i[r]<<1)+t[0]]);t[0]=s[0]/10,i[r]=s[0]%10}t[0]>0&&(i=XR(t,i)),cv.push(i)}return cv[n]}function xde(n,e){let t=0;const i=new Uint8Array(n),r=new Uint8Array(e),s=i.slice(0),o=s.length-1,a=r.slice(0),l=a.length-1;let c,u=0;for(let h=l;h>=0;h--,u++)switch(c=s[o-u]-a[l-u]-t,!0){case c<0:t=1,s[o-u]=c+10;break;default:t=0,s[o-u]=c}if(t>0)for(let h=o-l+1;h>=0;h--,u++)if(c=s[o-u]-t,c<0)t=1,s[o-u]=c+10;else{t=0,s[o-u]=c;break}return s.slice()}class Ik extends zd(Ja){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=Vq.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(fde(e))}get valueDec(){return this._valueDec}fromDER(e,t,i,r=0){const s=this.fromBER(e,t,i);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&o[1]&128?this.valueHexView=o.subarray(1):r!==0&&o.length<r&&(r-o.length>1&&(r=o.length+1),this.valueHexView=o.subarray(r-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const i=new Uint8Array(this.valueHexView.length+1);i[0]=0,i.set(t,1),this.valueHexView=i}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,i){const r=super.fromBER(e,t,i);return r===-1||this.setValueHex(),r}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),i=0,r;const s=this.valueHexView;let o="",a=!1;for(let l=s.byteLength-1;l>=0;l--){r=s[l];for(let c=0;c<8;c++){if((r&1)===1)switch(i){case e:t=xde(JU(i),t),o="-";break;default:t=yde(t,JU(i))}i++,r>>=1}}for(let l=0;l<t.length;l++)t[l]&&(a=!0),a&&(o+=QU.charAt(t[l]));return a===!1&&(o+=QU.charAt(0)),o}}uZ=Ik;Ik.NAME="IntegerValueBlock";Object.defineProperty(uZ.prototype,"valueHex",{set:function(n){this.valueHexView=new Uint8Array(n),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var v3;class eo extends pa{constructor(e={}){super(e,Ik),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return P6(),BigInt(this.valueBlock.toString())}static fromBigInt(e){P6();const t=BigInt(e),i=new Ak,r=t.toString(16).replace(/^-/,""),s=new Uint8Array(Xr.FromHex(r));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const c=BigInt(`0x${Xr.ToHex(a)}`)+t,u=pr.toUint8Array(Xr.FromHex(c.toString(16)));u[0]|=128,i.write(u)}else s[0]&128&&i.write(new Uint8Array([0])),i.write(s);return new v3({valueHex:i.final()})}convertToDER(){const e=new v3({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new v3({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}v3=eo;ln.Integer=v3;eo.NAME="INTEGER";var hZ;class dZ extends eo{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}hZ=dZ;ln.Enumerated=hZ;dZ.NAME="ENUMERATED";class QR extends zd(Ja){constructor({valueDec:e=-1,isFirstSid:t=!1,...i}={}){super(i),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,i){if(!i)return t;const r=pr.toUint8Array(e);if(!Fd(this,r,t,i))return-1;const s=r.subarray(t,t+i);this.valueHexView=new Uint8Array(i);for(let a=0;a<i&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=_2(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){P6();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const i=new Uint8Array(t.length/7);for(let r=0;r<i.length;r++)i[r]=parseInt(t.slice(r*7,r*7+7),2)+(r+1<i.length?128:0);this.fromBER(i.buffer,0,i.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const r=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=r[o]|128;return s[this.blockLength-1]=r[this.blockLength-1],s.buffer}const t=Km(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",mh;const i=new Uint8Array(t.byteLength);if(!e){const r=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)i[o]=r[o]|128;i[s]=r[s]}return i}toString(){let e="";if(this.isHexOnly)e=Xr.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}QR.NAME="sidBlock";class fZ extends Ja{constructor({value:e=ox,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,i){let r=t;for(;i>0;){const s=new QR;if(r=s.fromBER(e,r,i),r===-1)return this.blockLength=0,this.error=s.error,r;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,i-=s.blockLength,this.value.push(s)}return r}toBER(e){const t=[];for(let i=0;i<this.value.length;i++){const r=this.value[i].toBER(e);if(r.byteLength===0)return this.error=this.value[i].error,mh;t.push(r)}return Tk(t)}fromString(e){this.value=[];let t=0,i=0,r="",s=!1;do if(i=e.indexOf(".",t),i===-1?r=e.substring(t):r=e.substring(t,i),t=i+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const l=parseInt(r,10);if(isNaN(l))return;o.valueDec=l+a,s=!1}else{const o=new QR;if(r>Number.MAX_SAFE_INTEGER){P6();const a=BigInt(r);o.valueBigInt=a}else if(o.valueDec=parseInt(r,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(i!==-1)}toString(){let e="",t=!1;for(let i=0;i<this.value.length;i++){t=this.value[i].isHexOnly;let r=this.value[i].toString();i!==0&&(e=`${e}.`),t?(r=`{${r}}`,this.value[i].isFirstSid?e=`2.{${r} - 80}`:e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}fZ.NAME="ObjectIdentifierValueBlock";var pZ;class Hf extends pa{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,fZ),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}pZ=Hf;ln.ObjectIdentifier=pZ;Hf.NAME="OBJECT IDENTIFIER";class JR extends zd(h1){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,i){if(i===0)return t;const r=pr.toUint8Array(e);if(!Fd(this,r,t,i))return-1;const s=r.subarray(t,t+i);this.valueHexView=new Uint8Array(i);for(let a=0;a<i&&(this.valueHexView[a]=s[a]&127,this.blockLength++,!!(s[a]&128));a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,s[this.blockLength-1]&128?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=_2(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const r=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=r[o]|128;return s[this.blockLength-1]=r[this.blockLength-1],s.buffer}const t=Km(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",mh;const i=new Uint8Array(t.byteLength);if(!e){const r=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)i[o]=r[o]|128;i[s]=r[s]}return i.buffer}toString(){let e="";return this.isHexOnly?e=Xr.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}JR.NAME="relativeSidBlock";class mZ extends Ja{constructor({value:e=ox,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,i){let r=t;for(;i>0;){const s=new JR;if(r=s.fromBER(e,r,i),r===-1)return this.blockLength=0,this.error=s.error,r;this.blockLength+=s.blockLength,i-=s.blockLength,this.value.push(s)}return r}toBER(e,t){const i=[];for(let r=0;r<this.value.length;r++){const s=this.value[r].toBER(e);if(s.byteLength===0)return this.error=this.value[r].error,mh;i.push(s)}return Tk(i)}fromString(e){this.value=[];let t=0,i=0,r="";do{i=e.indexOf(".",t),i===-1?r=e.substring(t):r=e.substring(t,i),t=i+1;const s=new JR;if(s.valueDec=parseInt(r,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(i!==-1);return!0}toString(){let e="",t=!1;for(let i=0;i<this.value.length;i++){t=this.value[i].isHexOnly;let r=this.value[i].toString();i!==0&&(e=`${e}.`),t&&(r=`{${r}}`),e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}mZ.NAME="RelativeObjectIdentifierValueBlock";var gZ;class yZ extends pa{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,mZ),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}gZ=yZ;ln.RelativeObjectIdentifier=gZ;yZ.NAME="RelativeObjectIdentifier";var xZ;class oa extends ax{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}xZ=oa;ln.Sequence=xZ;oa.NAME="SEQUENCE";var vZ;let bZ=class extends ax{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};vZ=bZ;ln.Set=vZ;bZ.NAME="SET";class _Z extends zd(Ja){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=ox}toJSON(){return{...super.toJSON(),value:this.value}}}_Z.NAME="StringValueBlock";class wZ extends _Z{}wZ.NAME="SimpleStringValueBlock";class Rl extends qq{constructor({...e}={}){super(e,wZ)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,pr.toUint8Array(e))}fromString(e){const t=e.length,i=this.valueBlock.valueHexView=new Uint8Array(t);for(let r=0;r<t;r++)i[r]=e.charCodeAt(r);this.valueBlock.value=e}}Rl.NAME="SIMPLE STRING";class SZ extends Rl{fromBuffer(e){this.valueBlock.valueHexView=pr.toUint8Array(e);try{this.valueBlock.value=Xr.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Xr.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Xr.FromUtf8String(e)),this.valueBlock.value=e}}SZ.NAME="Utf8StringValueBlock";var EZ;class d1 extends SZ{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}EZ=d1;ln.Utf8String=EZ;d1.NAME="UTF8String";class TZ extends Rl{fromBuffer(e){this.valueBlock.value=Xr.ToUtf16String(e),this.valueBlock.valueHexView=pr.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Xr.FromUtf16String(e))}}TZ.NAME="BmpStringValueBlock";var AZ;class CZ extends TZ{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}AZ=CZ;ln.BmpString=AZ;CZ.NAME="BMPString";class MZ extends Rl{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),i=new Uint8Array(t);for(let r=0;r<i.length;r+=4)i[r]=i[r+3],i[r+1]=i[r+2],i[r+2]=0,i[r+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,i=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let r=0;r<t;r++){const s=Km(e.charCodeAt(r),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let l=o.length-1;l>=0;l--)i[r*4+l+a]=o[l]}this.valueBlock.value=e}}MZ.NAME="UniversalStringValueBlock";var RZ;class IZ extends MZ{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}RZ=IZ;ln.UniversalString=RZ;IZ.NAME="UniversalString";var NZ;class PZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}NZ=PZ;ln.NumericString=NZ;PZ.NAME="NumericString";var kZ;class LZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}kZ=LZ;ln.PrintableString=kZ;LZ.NAME="PrintableString";var DZ;class OZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}DZ=OZ;ln.TeletexString=DZ;OZ.NAME="TeletexString";var BZ;class UZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}BZ=UZ;ln.VideotexString=BZ;UZ.NAME="VideotexString";var FZ;class zZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}FZ=zZ;ln.IA5String=FZ;zZ.NAME="IA5String";var jZ;class VZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}jZ=VZ;ln.GraphicString=jZ;VZ.NAME="GraphicString";var HZ;class Nk extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}HZ=Nk;ln.VisibleString=HZ;Nk.NAME="VisibleString";var $Z;class GZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}$Z=GZ;ln.GeneralString=$Z;GZ.NAME="GeneralString";var WZ;class KZ extends Rl{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}WZ=KZ;ln.CharacterString=WZ;KZ.NAME="CharacterString";var qZ;class Pk extends Nk{constructor({value:e,valueDate:t,...i}={}){if(super(i),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let r=0;r<e.length;r++)this.valueBlock.valueHexView[r]=e.charCodeAt(r)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,pr.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),i=new Uint8Array(t);for(let r=0;r<e.length;r++)i[r]=e.charCodeAt(r);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const i=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(i===null){this.error="Wrong input string for conversion";return}const r=parseInt(i[1],10);r>=50?this.year=1900+r:this.year=2e3+r,this.month=parseInt(i[2],10),this.day=parseInt(i[3],10),this.hour=parseInt(i[4],10),this.minute=parseInt(i[5],10),this.second=parseInt(i[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=xl(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=xl(this.month,2),t[2]=xl(this.day,2),t[3]=xl(this.hour,2),t[4]=xl(this.minute,2),t[5]=xl(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}qZ=Pk;ln.UTCTime=qZ;Pk.NAME="UTCTime";var ZZ;class YZ extends Pk{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,i="",r="",s=0,o,a=0,l=0;if(e[e.length-1]==="Z")i=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");i=e}if(t){if(i.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(i.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,p=i.indexOf("+"),m="";if(p===-1&&(p=i.indexOf("-"),h=-1),p!==-1){if(m=i.substring(p+1),i=i.substring(0,p),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let y=parseInt(m.substring(0,2),10);if(isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*y,m.length===4){if(y=parseInt(m.substring(2,4),10),isNaN(y.valueOf()))throw new Error("Wrong input string for conversion");l=h*y}}}let c=i.indexOf(".");if(c===-1&&(c=i.indexOf(",")),c!==-1){const h=new Number(`0${i.substring(c)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");s=h.valueOf(),r=i.substring(0,c)}else r=i;switch(!0){case r.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,c!==-1)throw new Error("Wrong input string for conversion");break;case r.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let h=60*s;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case r.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,c!==-1){let h=60*s;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case r.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,c!==-1){const h=1e3*s;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const u=o.exec(r);if(u===null)throw new Error("Wrong input string for conversion");for(let h=1;h<u.length;h++)switch(h){case 1:this.year=parseInt(u[h],10);break;case 2:this.month=parseInt(u[h],10);break;case 3:this.day=parseInt(u[h],10);break;case 4:this.hour=parseInt(u[h],10)+a;break;case 5:this.minute=parseInt(u[h],10)+l;break;case 6:this.second=parseInt(u[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(xl(this.year,4)),t.push(xl(this.month,2)),t.push(xl(this.day,2)),t.push(xl(this.hour,2)),t.push(xl(this.minute,2)),t.push(xl(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(xl(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}ZZ=YZ;ln.GeneralizedTime=ZZ;YZ.NAME="GeneralizedTime";var XZ;class QZ extends d1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}XZ=QZ;ln.DATE=XZ;QZ.NAME="DATE";var JZ;class eY extends d1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}JZ=eY;ln.TimeOfDay=JZ;eY.NAME="TimeOfDay";var tY;class nY extends d1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}tY=nY;ln.DateTime=tY;nY.NAME="DateTime";var iY;class rY extends d1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}iY=rY;ln.Duration=iY;rY.NAME="Duration";var sY;class oY extends d1{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}sY=oY;ln.TIME=sY;oY.NAME="TIME";function vde(n){const{result:e}=Qq(n),t=e.valueBlock.value;return{n:Vt(Du(t[1].toBigInt()),"base64url"),e:Vt(Du(t[2].toBigInt()),"base64url"),d:Vt(Du(t[3].toBigInt()),"base64url"),p:Vt(Du(t[4].toBigInt()),"base64url"),q:Vt(Du(t[5].toBigInt()),"base64url"),dp:Vt(Du(t[6].toBigInt()),"base64url"),dq:Vt(Du(t[7].toBigInt()),"base64url"),qi:Vt(Du(t[8].toBigInt()),"base64url"),kty:"RSA",alg:"RS256"}}function bde(n){if(n.n==null||n.e==null||n.d==null||n.p==null||n.q==null||n.dp==null||n.dq==null||n.qi==null)throw new Se("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new oa({value:[new eo({value:0}),eo.fromBigInt(Ou(Ut(n.n,"base64url"))),eo.fromBigInt(Ou(Ut(n.e,"base64url"))),eo.fromBigInt(Ou(Ut(n.d,"base64url"))),eo.fromBigInt(Ou(Ut(n.p,"base64url"))),eo.fromBigInt(Ou(Ut(n.q,"base64url"))),eo.fromBigInt(Ou(Ut(n.dp,"base64url"))),eo.fromBigInt(Ou(Ut(n.dq,"base64url"))),eo.fromBigInt(Ou(Ut(n.qi,"base64url")))]}).toBER();return new Uint8Array(t,0,t.byteLength)}function _de(n){const{result:e}=Qq(n),t=e.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:Vt(Du(t[0].toBigInt()),"base64url"),e:Vt(Du(t[1].toBigInt()),"base64url")}}function wde(n){if(n.n==null||n.e==null)throw new Se("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new oa({value:[new oa({value:[new Hf({value:"1.2.840.113549.1.1.1"}),new lb]}),new Rk({valueHex:new oa({value:[eo.fromBigInt(Ou(Ut(n.n,"base64url"))),eo.fromBigInt(Ou(Ut(n.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}function Du(n){let e=n.toString(16);e.length%2>0&&(e=`0${e}`);const t=e.length/2,i=new Uint8Array(t);let r=0,s=0;for(;r<t;)i[r]=parseInt(e.slice(s,s+2),16),r+=1,s+=2;return i}function Ou(n){const e=[];return n.forEach(function(t){let i=t.toString(16);i.length%2>0&&(i=`0${i}`),e.push(i)}),BigInt("0x"+e.join(""))}const Sde=16,eF=32,tF=1e4;async function Ede(n,e){const t=hu.get(),r=new oa({value:[new eo({value:0}),new oa({value:[new Hf({value:"1.2.840.113549.1.1.1"}),new lb]}),new ty({valueHex:n.marshal()})]}).toBER(),s=new Uint8Array(r,0,r.byteLength),o=R0(Sde),a=await ade(lde,e,o,{c:tF,dkLen:eF}),l=R0(16),c=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await t.subtle.encrypt({name:"AES-CBC",iv:l},c,s),h=new oa({value:[new ty({valueHex:o}),new eo({value:tF}),new eo({value:eF}),new oa({value:[new Hf({value:"1.2.840.113549.2.11"}),new lb]})]}),p=new oa({value:[new Hf({value:"1.2.840.113549.1.5.13"}),new oa({value:[new oa({value:[new Hf({value:"1.2.840.113549.1.5.12"}),h]}),new oa({value:[new Hf({value:"2.16.840.1.101.3.4.1.42"}),new ty({valueHex:l})]})]})]}),y=new oa({value:[p,new ty({valueHex:u})]}).toBER(),b=new Uint8Array(y,0,y.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...Vt(b,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function Tde(n){const e=await hu.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await lY(e);return{privateKey:t[0],publicKey:t[1]}}async function aY(n){const t=[await hu.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await Mde(n)],i=await lY({privateKey:t[0],publicKey:t[1]});return{privateKey:i[0],publicKey:i[1]}}async function Ade(n,e){const t=await hu.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),i=await hu.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)}async function Cde(n,e,t){const i=await hu.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return hu.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},i,e,t instanceof Uint8Array?t:t.subarray())}async function lY(n){if(n.privateKey==null||n.publicKey==null)throw new Se("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([hu.get().subtle.exportKey("jwk",n.privateKey),hu.get().subtle.exportKey("jwk",n.publicKey)])}async function Mde(n){return hu.get().subtle.importKey("jwk",{kty:n.kty,n:n.n,e:n.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function kk(n){if(n.kty!=="RSA")throw new Se("invalid key type","ERR_INVALID_KEY_TYPE");if(n.n==null)throw new Se("invalid key modulus","ERR_INVALID_KEY_MODULUS");return Ut(n.n,"base64url").length*8}const __=8192;let Lk=class{constructor(e){E(this,"_key");this._key=e}verify(e,t){return Cde(this._key,t,e)}marshal(){return wde(this._key)}get bytes(){return x2.encode({Type:ps.RSA,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return H0(e)?e.then(({bytes:t})=>t):e.bytes}},b7=class{constructor(e,t){E(this,"_key");E(this,"_publicKey");this._key=e,this._publicKey=t}genSecret(){return R0(16)}sign(e){return Ade(this._key,e)}get public(){if(this._publicKey==null)throw new Se("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Lk(this._publicKey)}marshal(){return bde(this._key)}get bytes(){return v2.encode({Type:ps.RSA,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return H0(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return Vt(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8")return Ede(this,e);if(t==="libp2p-key")return yk(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};async function Rde(n){const e=vde(n);if(kk(e)>__)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await aY(e);return new b7(t.privateKey,t.publicKey)}function Ide(n){const e=_de(n);if(kk(e)>__)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Lk(e)}async function Nde(n){if(kk(n)>__)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await aY(n);return new b7(e.privateKey,e.publicKey)}async function Pde(n){if(n>__)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await Tde(n);return new b7(e.privateKey,e.publicKey)}const kde=Object.freeze(Object.defineProperty({__proto__:null,MAX_RSA_KEY_SIZE:__,RsaPrivateKey:b7,RsaPublicKey:Lk,fromJwk:Nde,generateKeyPair:Pde,unmarshalRsaPrivateKey:Rde,unmarshalRsaPublicKey:Ide},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nF=(n,e)=>(n+(n>=0?e:-e)/cY)/e;function Lde(n,e,t){const[[i,r],[s,o]]=e,a=nF(o*n,t),l=nF(-r*n,t);let c=n-a*i-l*s,u=-a*r-l*o;const h=c<gd,p=u<gd;h&&(c=-c),p&&(u=-u);const m=v_(Math.ceil(yq(t)/2))+Ay;if(c<gd||c>=m||u<gd||u>=m)throw new Error("splitScalar (endomorphism): failed, k="+n);return{k1neg:h,k1:c,k2neg:p,k2:u}}function eI(n){if(!["compact","recovered","der"].includes(n))throw new Error('Signature format must be "compact", "recovered", or "der"');return n}function wA(n,e){const t={};for(let i of Object.keys(e))t[i]=n[i]===void 0?e[i]:n[i];return Gm(t.lowS,"lowS"),Gm(t.prehash,"prehash"),t.format!==void 0&&eI(t.format),t}let Dde=class extends Error{constructor(e=""){super(e)}};const nd={Err:Dde,_tlv:{encode:(n,e)=>{const{Err:t}=nd;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const i=e.length/2,r=c4(i);if(r.length/2&128)throw new t("tlv.encode: long form length too big");const s=i>127?c4(r.length/2|128):"";return c4(n)+s+r+e},decode(n,e){const{Err:t}=nd;let i=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==n)throw new t("tlv.decode: wrong tlv");const r=e[i++],s=!!(r&128);let o=0;if(!s)o=r;else{const l=r&127;if(!l)throw new t("tlv.decode(long): indefinite length not supported");if(l>4)throw new t("tlv.decode(long): byte length is too big");const c=e.subarray(i,i+l);if(c.length!==l)throw new t("tlv.decode: length bytes not complete");if(c[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of c)o=o<<8|u;if(i+=l,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(n){const{Err:e}=nd;if(n<gd)throw new e("integer: negative integers are not allowed");let t=c4(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=nd;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return y7(n)}},toSig(n){const{Err:e,_int:t,_tlv:i}=nd,r=Pr("signature",n),{v:s,l:o}=i.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l}=i.decode(2,s),{v:c,l:u}=i.decode(2,l);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(c)}},hexFromSig(n){const{_tlv:e,_int:t}=nd,i=e.encode(2,t.encode(n.r)),r=e.encode(2,t.encode(n.s)),s=i+r;return e.encode(48,s)}},gd=BigInt(0),Ay=BigInt(1),cY=BigInt(2),p4=BigInt(3),Ode=BigInt(4);function ny(n,e){const{BYTES:t}=n;let i;if(typeof e=="bigint")i=e;else{let r=Pr("private key",e);try{i=n.fromBytes(r)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!n.isValidNot0(i))throw new Error("invalid private key: out of range [1..N-1]");return i}function Bde(n,e={}){const t=kq("weierstrass",n,e),{Fp:i,Fn:r}=t;let s=t.CURVE;const{h:o,n:a}=s;sx(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:l}=e;if(l&&(!i.is0(s.a)||typeof l.beta!="bigint"||!Array.isArray(l.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const c=hY(i,r);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(j,W,U){const{x:H,y:q}=W.toAffine(),J=i.toBytes(H);if(Gm(U,"isCompressed"),U){u();const G=!i.isOdd(q);return Ku(uY(G),J)}else return Ku(Uint8Array.of(4),J,i.toBytes(q))}function p(j){Jc(j,void 0,"Point");const{publicKey:W,publicKeyUncompressed:U}=c,H=j.length,q=j[0],J=j.subarray(1);if(H===W&&(q===2||q===3)){const G=i.fromBytes(J);if(!i.isValid(G))throw new Error("bad point: is not on curve, wrong x");const ee=b(G);let Q;try{Q=i.sqrt(ee)}catch(Ae){const Pe=Ae instanceof Error?": "+Ae.message:"";throw new Error("bad point: is not on curve, sqrt error"+Pe)}u();const ne=i.isOdd(Q);return(q&1)===1!==ne&&(Q=i.neg(Q)),{x:G,y:Q}}else if(H===U&&q===4){const G=i.BYTES,ee=i.fromBytes(J.subarray(0,G)),Q=i.fromBytes(J.subarray(G,G*2));if(!w(ee,Q))throw new Error("bad point: is not on curve");return{x:ee,y:Q}}else throw new Error(`bad point: got length ${H}, expected compressed=${W} or uncompressed=${U}`)}const m=e.toBytes||h,y=e.fromBytes||p;function b(j){const W=i.sqr(j),U=i.mul(W,j);return i.add(i.add(U,i.mul(j,s.a)),s.b)}function w(j,W){const U=i.sqr(W),H=b(j);return i.eql(U,H)}if(!w(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const v=i.mul(i.pow(s.a,p4),Ode),T=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(v,T)))throw new Error("bad curve params: a or b");function S(j,W,U=!1){if(!i.isValid(W)||U&&i.is0(W))throw new Error(`bad point coordinate ${j}`);return W}function M(j){if(!(j instanceof N))throw new Error("ProjectivePoint expected")}function P(j){if(!l||!l.basises)throw new Error("no endo");return Lde(j,l.basises,r.ORDER)}const R=M6((j,W)=>{const{X:U,Y:H,Z:q}=j;if(i.eql(q,i.ONE))return{x:U,y:H};const J=j.is0();W==null&&(W=J?i.ONE:i.inv(q));const G=i.mul(U,W),ee=i.mul(H,W),Q=i.mul(q,W);if(J)return{x:i.ZERO,y:i.ZERO};if(!i.eql(Q,i.ONE))throw new Error("invZ was invalid");return{x:G,y:ee}}),O=M6(j=>{if(j.is0()){if(e.allowInfinityPoint&&!i.is0(j.Y))return;throw new Error("bad point: ZERO")}const{x:W,y:U}=j.toAffine();if(!i.isValid(W)||!i.isValid(U))throw new Error("bad point: x or y not field elements");if(!w(W,U))throw new Error("bad point: equation left != right");if(!j.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function B(j,W,U,H,q){return U=new N(i.mul(U.X,j),U.Y,U.Z),W=R6(H,W),U=R6(q,U),W.add(U)}class N{constructor(W,U,H){this.X=S("x",W),this.Y=S("y",U,!0),this.Z=S("z",H),Object.freeze(this)}static CURVE(){return s}static fromAffine(W){const{x:U,y:H}=W||{};if(!W||!i.isValid(U)||!i.isValid(H))throw new Error("invalid affine point");if(W instanceof N)throw new Error("projective point not allowed");return i.is0(U)&&i.is0(H)?N.ZERO:new N(U,H,i.ONE)}static fromBytes(W){const U=N.fromAffine(y(Jc(W,void 0,"point")));return U.assertValidity(),U}static fromHex(W){return N.fromBytes(Pr("pointHex",W))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(W=8,U=!0){return F.createCache(this,W),U||this.multiply(p4),this}assertValidity(){O(this)}hasEvenY(){const{y:W}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(W)}equals(W){M(W);const{X:U,Y:H,Z:q}=this,{X:J,Y:G,Z:ee}=W,Q=i.eql(i.mul(U,ee),i.mul(J,q)),ne=i.eql(i.mul(H,ee),i.mul(G,q));return Q&&ne}negate(){return new N(this.X,i.neg(this.Y),this.Z)}double(){const{a:W,b:U}=s,H=i.mul(U,p4),{X:q,Y:J,Z:G}=this;let ee=i.ZERO,Q=i.ZERO,ne=i.ZERO,fe=i.mul(q,q),Ae=i.mul(J,J),Pe=i.mul(G,G),Ce=i.mul(q,J);return Ce=i.add(Ce,Ce),ne=i.mul(q,G),ne=i.add(ne,ne),ee=i.mul(W,ne),Q=i.mul(H,Pe),Q=i.add(ee,Q),ee=i.sub(Ae,Q),Q=i.add(Ae,Q),Q=i.mul(ee,Q),ee=i.mul(Ce,ee),ne=i.mul(H,ne),Pe=i.mul(W,Pe),Ce=i.sub(fe,Pe),Ce=i.mul(W,Ce),Ce=i.add(Ce,ne),ne=i.add(fe,fe),fe=i.add(ne,fe),fe=i.add(fe,Pe),fe=i.mul(fe,Ce),Q=i.add(Q,fe),Pe=i.mul(J,G),Pe=i.add(Pe,Pe),fe=i.mul(Pe,Ce),ee=i.sub(ee,fe),ne=i.mul(Pe,Ae),ne=i.add(ne,ne),ne=i.add(ne,ne),new N(ee,Q,ne)}add(W){M(W);const{X:U,Y:H,Z:q}=this,{X:J,Y:G,Z:ee}=W;let Q=i.ZERO,ne=i.ZERO,fe=i.ZERO;const Ae=s.a,Pe=i.mul(s.b,p4);let Ce=i.mul(U,J),de=i.mul(H,G),Ne=i.mul(q,ee),et=i.add(U,H),me=i.add(J,G);et=i.mul(et,me),me=i.add(Ce,de),et=i.sub(et,me),me=i.add(U,q);let nt=i.add(J,ee);return me=i.mul(me,nt),nt=i.add(Ce,Ne),me=i.sub(me,nt),nt=i.add(H,q),Q=i.add(G,ee),nt=i.mul(nt,Q),Q=i.add(de,Ne),nt=i.sub(nt,Q),fe=i.mul(Ae,me),Q=i.mul(Pe,Ne),fe=i.add(Q,fe),Q=i.sub(de,fe),fe=i.add(de,fe),ne=i.mul(Q,fe),de=i.add(Ce,Ce),de=i.add(de,Ce),Ne=i.mul(Ae,Ne),me=i.mul(Pe,me),de=i.add(de,Ne),Ne=i.sub(Ce,Ne),Ne=i.mul(Ae,Ne),me=i.add(me,Ne),Ce=i.mul(de,me),ne=i.add(ne,Ce),Ce=i.mul(nt,me),Q=i.mul(et,Q),Q=i.sub(Q,Ce),Ce=i.mul(et,de),fe=i.mul(nt,fe),fe=i.add(fe,Ce),new N(Q,ne,fe)}subtract(W){return this.add(W.negate())}is0(){return this.equals(N.ZERO)}multiply(W){const{endo:U}=e;if(!r.isValidNot0(W))throw new Error("invalid scalar: out of range");let H,q;const J=G=>F.cached(this,G,ee=>im(N,ee));if(U){const{k1neg:G,k1:ee,k2neg:Q,k2:ne}=P(W),{p:fe,f:Ae}=J(ee),{p:Pe,f:Ce}=J(ne);q=Ae.add(Ce),H=B(U.beta,fe,Pe,G,Q)}else{const{p:G,f:ee}=J(W);H=G,q=ee}return im(N,[H,q])[0]}multiplyUnsafe(W){const{endo:U}=e,H=this;if(!r.isValid(W))throw new Error("invalid scalar: out of range");if(W===gd||H.is0())return N.ZERO;if(W===Ay)return H;if(F.hasCache(this))return this.multiply(W);if(U){const{k1neg:q,k1:J,k2neg:G,k2:ee}=P(W),{p1:Q,p2:ne}=lhe(N,H,J,ee);return B(U.beta,Q,ne,q,G)}else return F.unsafe(H,W)}multiplyAndAddUnsafe(W,U,H){const q=this.multiplyUnsafe(U).add(W.multiplyUnsafe(H));return q.is0()?void 0:q}toAffine(W){return R(this,W)}isTorsionFree(){const{isTorsionFree:W}=e;return o===Ay?!0:W?W(N,this):F.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:W}=e;return o===Ay?this:W?W(N,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(W=!0){return Gm(W,"isCompressed"),this.assertValidity(),m(N,this,W)}toHex(W=!0){return Tm(this.toBytes(W))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(W=!0){return this.toBytes(W)}_setWindowSize(W){this.precompute(W)}static normalizeZ(W){return im(N,W)}static msm(W,U){return Pq(N,r,W,U)}static fromPrivateKey(W){return N.BASE.multiply(ny(r,W))}}N.BASE=new N(s.Gx,s.Gy,i.ONE),N.ZERO=new N(i.ZERO,i.ONE,i.ZERO),N.Fp=i,N.Fn=r;const I=r.BITS,F=new Nq(N,e.endo?Math.ceil(I/2):I);return N.BASE.precompute(8),N}function uY(n){return Uint8Array.of(n?2:3)}function hY(n,e){return{secretKey:e.BYTES,publicKey:1+n.BYTES,publicKeyUncompressed:1+2*n.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Ude(n,e={}){const{Fn:t}=n,i=e.randomBytes||rx,r=Object.assign(hY(n.Fp,t),{seed:Mq(t.ORDER)});function s(m){try{return!!ny(t,m)}catch{return!1}}function o(m,y){const{publicKey:b,publicKeyUncompressed:w}=r;try{const v=m.length;return y===!0&&v!==b||y===!1&&v!==w?!1:!!n.fromBytes(m)}catch{return!1}}function a(m=i(r.seed)){return she(Jc(m,r.seed,"seed"),t.ORDER)}function l(m,y=!0){return n.BASE.multiply(ny(t,m)).toBytes(y)}function c(m){const y=a(m);return{secretKey:y,publicKey:l(y)}}function u(m){if(typeof m=="bigint")return!1;if(m instanceof n)return!0;const{secretKey:y,publicKey:b,publicKeyUncompressed:w}=r;if(t.allowedLengths||y===b)return;const v=Pr("key",m).length;return v===b||v===w}function h(m,y,b=!0){if(u(m)===!0)throw new Error("first arg must be private key");if(u(y)===!1)throw new Error("second arg must be public key");const w=ny(t,m);return n.fromHex(y).multiply(w).toBytes(b)}return Object.freeze({getPublicKey:l,getSharedSecret:h,keygen:c,Point:n,utils:{isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:s,randomPrivateKey:a,normPrivateKeyToScalar:m=>ny(t,m),precompute(m=8,y=n.BASE){return y.precompute(m,!1)}},lengths:r})}function Fde(n,e,t={}){x_(e),sx(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const i=t.randomBytes||rx,r=t.hmac||((U,...H)=>b_(e,U,Ku(...H))),{Fp:s,Fn:o}=n,{ORDER:a,BITS:l}=o,{keygen:c,getPublicKey:u,getSharedSecret:h,utils:p,lengths:m}=Ude(n,t),y={prehash:!1,lowS:typeof t.lowS=="boolean"?t.lowS:!1,format:void 0,extraEntropy:!1},b="compact";function w(U){const H=a>>Ay;return U>H}function v(U,H){if(!o.isValidNot0(H))throw new Error(`invalid signature ${U}: out of range 1..Point.Fn.ORDER`);return H}function T(U,H){eI(H);const q=m.signature,J=H==="compact"?q:H==="recovered"?q+1:void 0;return Jc(U,J,`${H} signature`)}class S{constructor(H,q,J){this.r=v("r",H),this.s=v("s",q),J!=null&&(this.recovery=J),Object.freeze(this)}static fromBytes(H,q=b){T(H,q);let J;if(q==="der"){const{r:ne,s:fe}=nd.toSig(Jc(H));return new S(ne,fe)}q==="recovered"&&(J=H[0],q="compact",H=H.subarray(1));const G=o.BYTES,ee=H.subarray(0,G),Q=H.subarray(G,G*2);return new S(o.fromBytes(ee),o.fromBytes(Q),J)}static fromHex(H,q){return this.fromBytes(C6(H),q)}addRecoveryBit(H){return new S(this.r,this.s,H)}recoverPublicKey(H){const q=s.ORDER,{r:J,s:G,recovery:ee}=this;if(ee==null||![0,1,2,3].includes(ee))throw new Error("recovery id invalid");if(a*cY<q&&ee>1)throw new Error("recovery id is ambiguous for h>1 curve");const ne=ee===2||ee===3?J+a:J;if(!s.isValid(ne))throw new Error("recovery id 2 or 3 invalid");const fe=s.toBytes(ne),Ae=n.fromBytes(Ku(uY((ee&1)===0),fe)),Pe=o.inv(ne),Ce=P(Pr("msgHash",H)),de=o.create(-Ce*Pe),Ne=o.create(G*Pe),et=n.BASE.multiplyUnsafe(de).add(Ae.multiplyUnsafe(Ne));if(et.is0())throw new Error("point at infinify");return et.assertValidity(),et}hasHighS(){return w(this.s)}toBytes(H=b){if(eI(H),H==="der")return C6(nd.hexFromSig(this));const q=o.toBytes(this.r),J=o.toBytes(this.s);if(H==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Ku(Uint8Array.of(this.recovery),q,J)}return Ku(q,J)}toHex(H){return Tm(this.toBytes(H))}assertValidity(){}static fromCompact(H){return S.fromBytes(Pr("sig",H),"compact")}static fromDER(H){return S.fromBytes(Pr("sig",H),"der")}normalizeS(){return this.hasHighS()?new S(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Tm(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Tm(this.toBytes("compact"))}}const M=t.bits2int||function(H){if(H.length>8192)throw new Error("input is too large");const q=y7(H),J=H.length*8-l;return J>0?q>>BigInt(J):q},P=t.bits2int_modN||function(H){return o.create(M(H))},R=v_(l);function O(U){return rb("num < 2^"+l,U,gd,R),o.toBytes(U)}function B(U,H){return Jc(U,void 0,"message"),H?Jc(e(U),void 0,"prehashed message"):U}function N(U,H,q){if(["recovered","canonical"].some(de=>de in q))throw new Error("sign() legacy options not supported");const{lowS:J,prehash:G,extraEntropy:ee}=wA(q,y);U=B(U,G);const Q=P(U),ne=ny(o,H),fe=[O(ne),O(Q)];if(ee!=null&&ee!==!1){const de=ee===!0?i(m.secretKey):ee;fe.push(Pr("extraEntropy",de))}const Ae=Ku(...fe),Pe=Q;function Ce(de){const Ne=M(de);if(!o.isValidNot0(Ne))return;const et=o.inv(Ne),me=n.BASE.multiply(Ne).toAffine(),nt=o.create(me.x);if(nt===gd)return;const Pt=o.create(et*o.create(Pe+nt*ne));if(Pt===gd)return;let zt=(me.x===nt?0:2)|Number(me.y&Ay),Dt=Pt;return J&&w(Pt)&&(Dt=o.neg(Pt),zt^=1),new S(nt,Dt,zt)}return{seed:Ae,k2sig:Ce}}function I(U,H,q={}){U=Pr("message",U);const{seed:J,k2sig:G}=N(U,H,q);return Zue(e.outputLen,o.BYTES,r)(J,G)}function F(U){let H;const q=typeof U=="string"||y_(U),J=!q&&U!==null&&typeof U=="object"&&typeof U.r=="bigint"&&typeof U.s=="bigint";if(!q&&!J)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(J)H=new S(U.r,U.s);else if(q){try{H=S.fromBytes(Pr("sig",U),"der")}catch(G){if(!(G instanceof nd.Err))throw G}if(!H)try{H=S.fromBytes(Pr("sig",U),"compact")}catch{return!1}}return H||!1}function j(U,H,q,J={}){const{lowS:G,prehash:ee,format:Q}=wA(J,y);if(q=Pr("publicKey",q),H=B(Pr("message",H),ee),"strict"in J)throw new Error("options.strict was renamed to lowS");const ne=Q===void 0?F(U):S.fromBytes(Pr("sig",U),Q);if(ne===!1)return!1;try{const fe=n.fromBytes(q);if(G&&ne.hasHighS())return!1;const{r:Ae,s:Pe}=ne,Ce=P(H),de=o.inv(Pe),Ne=o.create(Ce*de),et=o.create(Ae*de),me=n.BASE.multiplyUnsafe(Ne).add(fe.multiplyUnsafe(et));return me.is0()?!1:o.create(me.x)===Ae}catch{return!1}}function W(U,H,q={}){const{prehash:J}=wA(q,y);return H=B(H,J),S.fromBytes(U,"recovered").recoverPublicKey(H).toBytes()}return Object.freeze({keygen:c,getPublicKey:u,getSharedSecret:h,utils:p,lengths:m,Point:n,sign:I,verify:j,recoverPublicKey:W,Signature:S,hash:e})}function zde(n){const e={a:n.a,b:n.b,p:n.Fp.ORDER,n:n.n,h:n.h,Gx:n.Gx,Gy:n.Gy},t=n.Fp;let i=n.allowedPrivateKeyLengths?Array.from(new Set(n.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const r=c1(e.n,{BITS:n.nBitLength,allowedLengths:i,modFromBytes:n.wrapPrivateKey}),s={Fp:t,Fn:r,allowInfinityPoint:n.allowInfinityPoint,endo:n.endo,isTorsionFree:n.isTorsionFree,clearCofactor:n.clearCofactor,fromBytes:n.fromBytes,toBytes:n.toBytes};return{CURVE:e,curveOpts:s}}function jde(n){const{CURVE:e,curveOpts:t}=zde(n),i={hmac:n.hmac,randomBytes:n.randomBytes,lowS:n.lowS,bits2int:n.bits2int,bits2int_modN:n.bits2int_modN};return{CURVE:e,curveOpts:t,hash:n.hash,ecdsaOpts:i}}function Vde(n,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},n,Aq(t.Fn.ORDER,t.Fn.BITS))})}function Hde(n){const{CURVE:e,curveOpts:t,hash:i,ecdsaOpts:r}=jde(n),s=Bde(e,t),o=Fde(s,i,r);return Vde(n,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function $de(n,e){const t=i=>Hde({...n,hash:i});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Dk={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Gde={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},iF=BigInt(2);function Wde(n){const e=Dk.p,t=BigInt(3),i=BigInt(6),r=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=n*n*n%e,u=c*c*n%e,h=Br(u,t,e)*u%e,p=Br(h,t,e)*u%e,m=Br(p,iF,e)*c%e,y=Br(m,r,e)*m%e,b=Br(y,s,e)*y%e,w=Br(b,a,e)*b%e,v=Br(w,l,e)*w%e,T=Br(v,a,e)*b%e,S=Br(T,t,e)*u%e,M=Br(S,o,e)*y%e,P=Br(M,i,e)*c%e,R=Br(P,iF,e);if(!tI.eql(tI.sqr(R),n))throw new Error("Cannot find square root");return R}const tI=c1(Dk.p,{sqrt:Wde}),Hs=$de({...Dk,Fp:tI,lowS:!0,endo:Gde},pq);function Kde(){return Hs.utils.randomPrivateKey()}function qde(n,e){const t=Ir.digest(e instanceof Uint8Array?e:e.subarray());if(H0(t))return t.then(({digest:i})=>Hs.sign(i,n).toDERRawBytes()).catch(i=>{throw new Se(String(i),"ERR_INVALID_INPUT")});try{return Hs.sign(t.digest,n).toDERRawBytes()}catch(i){throw new Se(String(i),"ERR_INVALID_INPUT")}}function Zde(n,e,t){const i=Ir.digest(t instanceof Uint8Array?t:t.subarray());if(H0(i))return i.then(({digest:r})=>Hs.verify(e,r,n)).catch(r=>{throw new Se(String(r),"ERR_INVALID_INPUT")});try{return Hs.verify(e,i.digest,n)}catch(r){throw new Se(String(r),"ERR_INVALID_INPUT")}}function Yde(n){return Hs.ProjectivePoint.fromHex(n).toRawBytes(!0)}function Xde(n){try{Hs.getPublicKey(n,!0)}catch(e){throw new Se(String(e),"ERR_INVALID_PRIVATE_KEY")}}function dY(n){try{Hs.ProjectivePoint.fromHex(n)}catch(e){throw new Se(String(e),"ERR_INVALID_PUBLIC_KEY")}}function Qde(n){try{return Hs.getPublicKey(n,!0)}catch(e){throw new Se(String(e),"ERR_INVALID_PRIVATE_KEY")}}let Ok=class{constructor(e){E(this,"_key");dY(e),this._key=e}verify(e,t){return Zde(this._key,t,e)}marshal(){return Yde(this._key)}get bytes(){return x2.encode({Type:ps.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}async hash(){const e=Ir.digest(this.bytes);let t;return H0(e)?{bytes:t}=await e:t=e.bytes,t}},Bk=class{constructor(e,t){E(this,"_key");E(this,"_publicKey");this._key=e,this._publicKey=t??Qde(e),Xde(this._key),dY(this._publicKey)}sign(e){return qde(this._key,e)}get public(){return new Ok(this._publicKey)}marshal(){return this._key}get bytes(){return v2.encode({Type:ps.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return H0(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return Vt(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return yk(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}};function Jde(n){return new Bk(n)}function efe(n){return new Ok(n)}async function tfe(){const n=Kde();return new Bk(n)}const nfe=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey:Bk,Secp256k1PublicKey:Ok,generateKeyPair:tfe,unmarshalSecp256k1PrivateKey:Jde,unmarshalSecp256k1PublicKey:efe},Symbol.toStringTag,{value:"Module"})),x0={rsa:kde,ed25519:rde,secp256k1:nfe};function Uk(n){const e=Object.keys(x0).join(" / ");return new Se(`invalid or unsupported key type ${n}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function Fk(n){if(n=n.toLowerCase(),n==="rsa"||n==="ed25519"||n==="secp256k1")return x0[n];throw Uk(n)}async function ife(n,e){return Fk(n).generateKeyPair(e??2048)}function cb(n){const e=x2.decode(n),t=e.Data??new Uint8Array;switch(e.Type){case ps.RSA:return x0.rsa.unmarshalRsaPublicKey(t);case ps.Ed25519:return x0.ed25519.unmarshalEd25519PublicKey(t);case ps.Secp256k1:return x0.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw Uk(e.Type??"unknown")}}function zk(n,e){return e=(e??"rsa").toLowerCase(),Fk(e),n.bytes}async function _7(n){const e=v2.decode(n),t=e.Data??new Uint8Array;switch(e.Type){case ps.RSA:return x0.rsa.unmarshalRsaPrivateKey(t);case ps.Ed25519:return x0.ed25519.unmarshalEd25519PrivateKey(t);case ps.Secp256k1:return x0.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw Uk(e.Type??"RSA")}}function rfe(n,e){return e=(e??"rsa").toLowerCase(),Fk(e),n.bytes}const w2=1e3,S2=w2*60,E2=S2*60,qm=E2*24,ub=qm*7,T2=qm*365.25,hb=T2/12;function sfe(n,e){if(typeof n=="string")return ofe(n);if(typeof n=="number")return cfe(n,e);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(n)}`)}var fY=sfe;function ofe(n){if(typeof n!="string"||n.length===0||n.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(n)}`);let e=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(n);if(!e?.groups)return NaN;let{value:t,unit:i="ms"}=e.groups,r=parseFloat(t),s=i.toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return r*T2;case"months":case"month":case"mo":return r*hb;case"weeks":case"week":case"w":return r*ub;case"days":case"day":case"d":return r*qm;case"hours":case"hour":case"hrs":case"hr":case"h":return r*E2;case"minutes":case"minute":case"mins":case"min":case"m":return r*S2;case"seconds":case"second":case"secs":case"sec":case"s":return r*w2;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:throw Error(`Unknown unit "${s}" provided to ms.parse(). value=${JSON.stringify(n)}`)}}function afe(n){let e=Math.abs(n);return e>=T2?`${Math.round(n/T2)}y`:e>=hb?`${Math.round(n/hb)}mo`:e>=ub?`${Math.round(n/ub)}w`:e>=qm?`${Math.round(n/qm)}d`:e>=E2?`${Math.round(n/E2)}h`:e>=S2?`${Math.round(n/S2)}m`:e>=w2?`${Math.round(n/w2)}s`:`${n}ms`}function lfe(n){let e=Math.abs(n);return e>=T2?vp(n,e,T2,"year"):e>=hb?vp(n,e,hb,"month"):e>=ub?vp(n,e,ub,"week"):e>=qm?vp(n,e,qm,"day"):e>=E2?vp(n,e,E2,"hour"):e>=S2?vp(n,e,S2,"minute"):e>=w2?vp(n,e,w2,"second"):`${n} ms`}function cfe(n,e){if(typeof n!="number"||!Number.isFinite(n))throw Error("Value provided to ms.format() must be of type number.");return e?.long?lfe(n):afe(n)}function vp(n,e,t,i){let r=e>=t*1.5;return`${Math.round(n/t)} ${i}${r?"s":""}`}function ufe(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=r,t.enabled=o,t.humanize=fY,t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let h=0;for(let p=0;p<u.length;p++)h=(h<<5)-h+u.charCodeAt(p),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(u,h){let p,m=null,y,b;function w(...v){if(!w.enabled)return;const T=w,S=Number(new Date),M=S-(p||S);T.diff=M,T.prev=p,T.curr=S,p=S,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let P=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(O,B)=>{if(O==="%%")return"%";P++;const N=t.formatters[B];if(typeof N=="function"){const I=v[P];O=N.call(T,I),v.splice(P,1),P--}return O}),t.formatArgs.call(T,v),h?.onLog!=null&&h.onLog(...v),(T.log||t.log).apply(T,v)}return w.namespace=u,w.useColors=t.useColors(),w.color=t.selectColor(u),w.extend=i,w.destroy=t.destroy,Object.defineProperty(w,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(y!==t.namespaces&&(y=t.namespaces,b=t.enabled(u)),b),set:v=>{m=v}}),typeof t.init=="function"&&t.init(w),w}function i(u,h){const p=t(this.namespace+(typeof h>"u"?":":h)+u);return p.log=this.log,p}function r(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let h;const p=(typeof u=="string"?u:"").split(/[\s,]+/),m=p.length;for(h=0;h<m;h++)p[h]&&(u=p[h].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let h,p;for(h=0,p=t.skips.length;h<p;h++)if(t.skips[h].test(u))return!1;for(h=0,p=t.names.length;h<p;h++)if(t.names[h].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function l(u){return u instanceof Error?u.stack??u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}const k6=yfe(),hfe=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function dfe(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function ffe(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+fY(this.diff),!this.useColors)return;const e="color: "+this.color;n.splice(1,0,e,"color: inherit");let t=0,i=0;n[0].replace(/%[a-zA-Z%]/g,r=>{r!=="%%"&&(t++,r==="%c"&&(i=t))}),n.splice(i,0,e)}const pfe=console.debug??console.log??(()=>{});function mfe(n){try{n?k6?.setItem("debug",n):k6?.removeItem("debug")}catch{}}function gfe(){let n;try{n=k6?.getItem("debug")}catch{}return!n&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(n={}.DEBUG),n}function yfe(){try{return localStorage}catch{}}function xfe(n){n.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const ic=ufe({formatArgs:ffe,save:mfe,load:gfe,useColors:dfe,setupFormatters:xfe,colors:hfe,storage:k6,log:pfe});ic.formatters.b=n=>n==null?"undefined":Lr.baseEncode(n);ic.formatters.t=n=>n==null?"undefined":oh.baseEncode(n);ic.formatters.m=n=>n==null?"undefined":g7.baseEncode(n);ic.formatters.p=n=>n==null?"undefined":n.toString();ic.formatters.c=n=>n==null?"undefined":n.toString();ic.formatters.k=n=>n==null?"undefined":n.toString();ic.formatters.a=n=>n==null?"undefined":n.toString();function vfe(n){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=n,e.destroy=()=>!0,e.extend=()=>e,e}function pY(){return{forComponent(n){return bfe(n)}}}function bfe(n){let e=vfe(`${n}:trace`);return ic.enabled(`${n}:trace`)&&ic.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=ic(`${n}:trace`)),Object.assign(ic(n),{error:ic(`${n}:error`),trace:e})}const mY=Symbol.for("nodejs.util.inspect.custom"),_fe=Object.values($m).map(n=>n.decoder).reduce((n,e)=>n.or(e),$m.identity.decoder),gY=114,jk=36,Vk=37;var KUe;let Hk=class{constructor(e){E(this,"type");E(this,"multihash");E(this,"privateKey");E(this,"publicKey");E(this,"string");E(this,KUe,!0);this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Lr.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Fi.createV1(gY,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return li(this.multihash.bytes,e);if(typeof e=="string")return Bi(e).equals(this);if(e?.multihash?.bytes!=null)return li(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[(KUe=ak,mY)](){return`PeerId(${this.toString()})`}};class w_ extends Hk{constructor(t){super({...t,type:"RSA"});E(this,"type","RSA");E(this,"publicKey");this.publicKey=t.publicKey}}class S_ extends Hk{constructor(t){super({...t,type:"Ed25519"});E(this,"type","Ed25519");E(this,"publicKey");this.publicKey=t.multihash.digest}}class E_ extends Hk{constructor(t){super({...t,type:"secp256k1"});E(this,"type","secp256k1");E(this,"publicKey");this.publicKey=t.multihash.digest}}const nI=2336;var qUe;class wfe{constructor(e){E(this,"type","url");E(this,"multihash");E(this,"privateKey");E(this,"publicKey");E(this,"url");E(this,qUe,!0);this.url=e.toString(),this.multihash=xc.digest(Ut(this.url))}[mY](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toCID(){return Fi.createV1(nI,this.multihash)}toBytes(){return this.toCID().bytes}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=Vt(e)),e.toString()===this.toString())}}qUe=ak;function Sfe(n){if(n.type==="RSA")return new w_(n);if(n.type==="Ed25519")return new S_(n);if(n.type==="secp256k1")return new E_(n);throw new Se("Not a PeerId","ERR_INVALID_PARAMETERS")}function Bi(n,e){if(n.charAt(0)==="1"||n.charAt(0)==="Q"){const t=g2(Lr.decode(`z${n}`));return n.startsWith("12D")?new S_({multihash:t}):n.startsWith("16U")?new E_({multihash:t}):new w_({multihash:t})}return gh(_fe.decode(n))}function gh(n){try{const e=g2(n);if(e.code===xc.code){if(e.digest.length===jk)return new S_({multihash:e});if(e.digest.length===Vk)return new E_({multihash:e})}if(e.code===Ir.code)return new w_({multihash:e})}catch{return Efe(Fi.decode(n))}throw new Error("Supplied PeerID CID is invalid")}function Efe(n){if(n?.multihash==null||n.version==null||n.version===1&&n.code!==gY&&n.code!==nI)throw new Error("Supplied PeerID CID is invalid");if(n.code===nI){const t=Vt(n.multihash.digest);return new wfe(new URL(t))}const e=n.multihash;if(e.code===Ir.code)return new w_({multihash:n.multihash});if(e.code===xc.code){if(e.digest.length===jk)return new S_({multihash:n.multihash});if(e.digest.length===Vk)return new E_({multihash:n.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function jd(n,e){return n.length===jk?new S_({multihash:nb(xc.code,n),privateKey:e}):n.length===Vk?new E_({multihash:nb(xc.code,n),privateKey:e}):new w_({multihash:await Ir.digest(n),publicKey:n,privateKey:e})}function L6(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const i=n.next(),r=i.value;return i.done===!0||r==null?{done:!0,value:void 0}:{done:!1,value:e(r)}}};return t}let w7=class{constructor(e){E(this,"map");if(this.map=new Map,e!=null)for(const[t,i]of e.entries())this.map.set(t.toString(),i)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return L6(this.map.entries(),e=>[Bi(e[0]),e[1]])}forEach(e){this.map.forEach((t,i)=>{e(t,Bi(i),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return L6(this.map.keys(),e=>Bi(e))}values(){return this.map.values()}get size(){return this.map.size}},$k=class pS{constructor(e){E(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return L6(this.set.entries(),e=>{const t=Bi(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const i=Bi(t);e(i,i,this)})}has(e){return this.set.has(e.toString())}values(){return L6(this.set.values(),e=>Bi(e))}intersection(e){const t=new pS;for(const i of e)this.has(i)&&t.add(i);return t}difference(e){const t=new pS;for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=new pS;for(const i of e)t.add(i);for(const i of this)t.add(i);return t}};const SA=pq;var rF={exports:{}};(function(n,e){(function(t,i){var r={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(b){if(!Array.isArray(b)&&!ArrayBuffer.isView(b))return!1;for(var w=0;w<b.length;w++)if(!Number.isInteger(b[w])||b[w]<0||b[w]>255)return!1;return!0}function o(b,w){return(b&65535)*w+(((b>>>16)*w&65535)<<16)}function a(b,w){return b<<w|b>>>32-w}function l(b){return b^=b>>>16,b=o(b,2246822507),b^=b>>>13,b=o(b,3266489909),b^=b>>>16,b}function c(b,w){b=[b[0]>>>16,b[0]&65535,b[1]>>>16,b[1]&65535],w=[w[0]>>>16,w[0]&65535,w[1]>>>16,w[1]&65535];var v=[0,0,0,0];return v[3]+=b[3]+w[3],v[2]+=v[3]>>>16,v[3]&=65535,v[2]+=b[2]+w[2],v[1]+=v[2]>>>16,v[2]&=65535,v[1]+=b[1]+w[1],v[0]+=v[1]>>>16,v[1]&=65535,v[0]+=b[0]+w[0],v[0]&=65535,[v[0]<<16|v[1],v[2]<<16|v[3]]}function u(b,w){b=[b[0]>>>16,b[0]&65535,b[1]>>>16,b[1]&65535],w=[w[0]>>>16,w[0]&65535,w[1]>>>16,w[1]&65535];var v=[0,0,0,0];return v[3]+=b[3]*w[3],v[2]+=v[3]>>>16,v[3]&=65535,v[2]+=b[2]*w[3],v[1]+=v[2]>>>16,v[2]&=65535,v[2]+=b[3]*w[2],v[1]+=v[2]>>>16,v[2]&=65535,v[1]+=b[1]*w[3],v[0]+=v[1]>>>16,v[1]&=65535,v[1]+=b[2]*w[2],v[0]+=v[1]>>>16,v[1]&=65535,v[1]+=b[3]*w[1],v[0]+=v[1]>>>16,v[1]&=65535,v[0]+=b[0]*w[3]+b[1]*w[2]+b[2]*w[1]+b[3]*w[0],v[0]&=65535,[v[0]<<16|v[1],v[2]<<16|v[3]]}function h(b,w){return w%=64,w===32?[b[1],b[0]]:w<32?[b[0]<<w|b[1]>>>32-w,b[1]<<w|b[0]>>>32-w]:(w-=32,[b[1]<<w|b[0]>>>32-w,b[0]<<w|b[1]>>>32-w])}function p(b,w){return w%=64,w===0?b:w<32?[b[0]<<w|b[1]>>>32-w,b[1]<<w]:[b[1]<<w-32,0]}function m(b,w){return[b[0]^w[0],b[1]^w[1]]}function y(b){return b=m(b,[0,b[0]>>>1]),b=u(b,[4283543511,3981806797]),b=m(b,[0,b[0]>>>1]),b=u(b,[3301882366,444984403]),b=m(b,[0,b[0]>>>1]),b}r.x86.hash32=function(b,w){if(r.inputValidation&&!s(b))return i;w=w||0;for(var v=b.length%4,T=b.length-v,S=w,M=0,P=3432918353,R=461845907,O=0;O<T;O=O+4)M=b[O]|b[O+1]<<8|b[O+2]<<16|b[O+3]<<24,M=o(M,P),M=a(M,15),M=o(M,R),S^=M,S=a(S,13),S=o(S,5)+3864292196;switch(M=0,v){case 3:M^=b[O+2]<<16;case 2:M^=b[O+1]<<8;case 1:M^=b[O],M=o(M,P),M=a(M,15),M=o(M,R),S^=M}return S^=b.length,S=l(S),S>>>0},r.x86.hash128=function(b,w){if(r.inputValidation&&!s(b))return i;w=w||0;for(var v=b.length%16,T=b.length-v,S=w,M=w,P=w,R=w,O=0,B=0,N=0,I=0,F=597399067,j=2869860233,W=951274213,U=2716044179,H=0;H<T;H=H+16)O=b[H]|b[H+1]<<8|b[H+2]<<16|b[H+3]<<24,B=b[H+4]|b[H+5]<<8|b[H+6]<<16|b[H+7]<<24,N=b[H+8]|b[H+9]<<8|b[H+10]<<16|b[H+11]<<24,I=b[H+12]|b[H+13]<<8|b[H+14]<<16|b[H+15]<<24,O=o(O,F),O=a(O,15),O=o(O,j),S^=O,S=a(S,19),S+=M,S=o(S,5)+1444728091,B=o(B,j),B=a(B,16),B=o(B,W),M^=B,M=a(M,17),M+=P,M=o(M,5)+197830471,N=o(N,W),N=a(N,17),N=o(N,U),P^=N,P=a(P,15),P+=R,P=o(P,5)+2530024501,I=o(I,U),I=a(I,18),I=o(I,F),R^=I,R=a(R,13),R+=S,R=o(R,5)+850148119;switch(O=0,B=0,N=0,I=0,v){case 15:I^=b[H+14]<<16;case 14:I^=b[H+13]<<8;case 13:I^=b[H+12],I=o(I,U),I=a(I,18),I=o(I,F),R^=I;case 12:N^=b[H+11]<<24;case 11:N^=b[H+10]<<16;case 10:N^=b[H+9]<<8;case 9:N^=b[H+8],N=o(N,W),N=a(N,17),N=o(N,U),P^=N;case 8:B^=b[H+7]<<24;case 7:B^=b[H+6]<<16;case 6:B^=b[H+5]<<8;case 5:B^=b[H+4],B=o(B,j),B=a(B,16),B=o(B,W),M^=B;case 4:O^=b[H+3]<<24;case 3:O^=b[H+2]<<16;case 2:O^=b[H+1]<<8;case 1:O^=b[H],O=o(O,F),O=a(O,15),O=o(O,j),S^=O}return S^=b.length,M^=b.length,P^=b.length,R^=b.length,S+=M,S+=P,S+=R,M+=S,P+=S,R+=S,S=l(S),M=l(M),P=l(P),R=l(R),S+=M,S+=P,S+=R,M+=S,P+=S,R+=S,("00000000"+(S>>>0).toString(16)).slice(-8)+("00000000"+(M>>>0).toString(16)).slice(-8)+("00000000"+(P>>>0).toString(16)).slice(-8)+("00000000"+(R>>>0).toString(16)).slice(-8)},r.x64.hash128=function(b,w){if(r.inputValidation&&!s(b))return i;w=w||0;for(var v=b.length%16,T=b.length-v,S=[0,w],M=[0,w],P=[0,0],R=[0,0],O=[2277735313,289559509],B=[1291169091,658871167],N=0;N<T;N=N+16)P=[b[N+4]|b[N+5]<<8|b[N+6]<<16|b[N+7]<<24,b[N]|b[N+1]<<8|b[N+2]<<16|b[N+3]<<24],R=[b[N+12]|b[N+13]<<8|b[N+14]<<16|b[N+15]<<24,b[N+8]|b[N+9]<<8|b[N+10]<<16|b[N+11]<<24],P=u(P,O),P=h(P,31),P=u(P,B),S=m(S,P),S=h(S,27),S=c(S,M),S=c(u(S,[0,5]),[0,1390208809]),R=u(R,B),R=h(R,33),R=u(R,O),M=m(M,R),M=h(M,31),M=c(M,S),M=c(u(M,[0,5]),[0,944331445]);switch(P=[0,0],R=[0,0],v){case 15:R=m(R,p([0,b[N+14]],48));case 14:R=m(R,p([0,b[N+13]],40));case 13:R=m(R,p([0,b[N+12]],32));case 12:R=m(R,p([0,b[N+11]],24));case 11:R=m(R,p([0,b[N+10]],16));case 10:R=m(R,p([0,b[N+9]],8));case 9:R=m(R,[0,b[N+8]]),R=u(R,B),R=h(R,33),R=u(R,O),M=m(M,R);case 8:P=m(P,p([0,b[N+7]],56));case 7:P=m(P,p([0,b[N+6]],48));case 6:P=m(P,p([0,b[N+5]],40));case 5:P=m(P,p([0,b[N+4]],32));case 4:P=m(P,p([0,b[N+3]],24));case 3:P=m(P,p([0,b[N+2]],16));case 2:P=m(P,p([0,b[N+1]],8));case 1:P=m(P,[0,b[N]]),P=u(P,O),P=h(P,31),P=u(P,B),S=m(S,P)}return S=m(S,[0,b.length]),M=m(M,[0,b.length]),S=c(S,M),M=c(M,S),S=y(S),M=y(M),S=c(S,M),M=c(M,S),("00000000"+(S[0]>>>0).toString(16)).slice(-8)+("00000000"+(S[1]>>>0).toString(16)).slice(-8)+("00000000"+(M[0]>>>0).toString(16)).slice(-8)+("00000000"+(M[1]>>>0).toString(16)).slice(-8)},n.exports&&(e=n.exports=r),e.murmurHash3=r})()})(rF,rF.exports);const yY=Symbol.for("@achingbrain/uint8arraylist");function sF(n,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const i of n){const r=t+i.byteLength;if(e<r)return{buf:i,index:e-t};t=r}throw new RangeError("index is out of bounds")}function Wv(n){return!!n?.[yY]}var ZUe;class Zn{constructor(...e){E(this,"bufs");E(this,"length");E(this,ZUe,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(ZUe=yY,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const i of e)if(i instanceof Uint8Array)t+=i.byteLength,this.bufs.push(i);else if(Wv(i))t+=i.byteLength,this.bufs.push(...i.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const i of e.reverse())if(i instanceof Uint8Array)t+=i.byteLength,this.bufs.unshift(i);else if(Wv(i))t+=i.byteLength,this.bufs.unshift(...i.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=sF(this.bufs,e);return t.buf[t.index]}set(e,t){const i=sF(this.bufs,e);i.buf[i.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let i=0;i<e.length;i++)this.set(t+i,e[i]);else if(Wv(e))for(let i=0;i<e.length;i++)this.set(t+i,e.get(i));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:i,length:r}=this._subList(e,t);return Ms(i,r)}subarray(e,t){const{bufs:i,length:r}=this._subList(e,t);return i.length===1?i[0]:Ms(i,r)}sublist(e,t){const{bufs:i,length:r}=this._subList(e,t),s=new Zn;return s.length=r,s.bufs=[...i],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const i=[];let r=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=r,l=a+o.byteLength;if(r=l,e>=l)continue;const c=e>=a&&e<l,u=t>a&&t<=l;if(c&&u){if(e===a&&t===l){i.push(o);break}const h=e-a;i.push(o.subarray(h,h+(t-e)));break}if(c){if(e===0){i.push(o);continue}i.push(o.subarray(e-a));continue}if(u){if(t===l){i.push(o);break}i.push(o.subarray(0,t-a));break}i.push(o)}return{bufs:i,length:t-e}}indexOf(e,t=0){if(!Wv(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const i=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const r=i.byteLength;if(r===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let h=0;h<s;h++)o[h]=-1;for(let h=0;h<r;h++)o[i[h]]=h;const a=o,l=this.byteLength-i.byteLength,c=i.byteLength-1;let u;for(let h=t;h<=l;h+=u){u=0;for(let p=c;p>=0;p--){const m=this.get(h+p);if(i[p]!==m){u=Math.max(1,p-a[m]);break}}if(u===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const i=Cs(1);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt8(0,t),this.write(i,e)}getInt16(e,t){const i=this.subarray(e,e+2);return new DataView(i.buffer,i.byteOffset,i.byteLength).getInt16(0,t)}setInt16(e,t,i){const r=qn(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt16(0,t,i),this.write(r,e)}getInt32(e,t){const i=this.subarray(e,e+4);return new DataView(i.buffer,i.byteOffset,i.byteLength).getInt32(0,t)}setInt32(e,t,i){const r=qn(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt32(0,t,i),this.write(r,e)}getBigInt64(e,t){const i=this.subarray(e,e+8);return new DataView(i.buffer,i.byteOffset,i.byteLength).getBigInt64(0,t)}setBigInt64(e,t,i){const r=qn(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigInt64(0,t,i),this.write(r,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const i=Cs(1);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint8(0,t),this.write(i,e)}getUint16(e,t){const i=this.subarray(e,e+2);return new DataView(i.buffer,i.byteOffset,i.byteLength).getUint16(0,t)}setUint16(e,t,i){const r=qn(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint16(0,t,i),this.write(r,e)}getUint32(e,t){const i=this.subarray(e,e+4);return new DataView(i.buffer,i.byteOffset,i.byteLength).getUint32(0,t)}setUint32(e,t,i){const r=qn(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint32(0,t,i),this.write(r,e)}getBigUint64(e,t){const i=this.subarray(e,e+8);return new DataView(i.buffer,i.byteOffset,i.byteLength).getBigUint64(0,t)}setBigUint64(e,t,i){const r=qn(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigUint64(0,t,i),this.write(r,e)}getFloat32(e,t){const i=this.subarray(e,e+4);return new DataView(i.buffer,i.byteOffset,i.byteLength).getFloat32(0,t)}setFloat32(e,t,i){const r=qn(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat32(0,t,i),this.write(r,e)}getFloat64(e,t){const i=this.subarray(e,e+8);return new DataView(i.buffer,i.byteOffset,i.byteLength).getFloat64(0,t)}setFloat64(e,t,i){const r=qn(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat64(0,t,i),this.write(r,e)}equals(e){if(e==null||!(e instanceof Zn)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!li(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const i=new Zn;return i.bufs=e,t==null&&(t=e.reduce((r,s)=>r+s.byteLength,0)),i.length=t,i}}const xY=64;let rm=class{constructor(e,t,i,r=2){E(this,"fp");E(this,"h");E(this,"seed");if(r>xY)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,i),o=qn(r);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=i}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?li(this.fp,e.fp):!1}};function D6(n,e){return Math.floor(Math.random()*(e-n))+n}let m4=class{constructor(e){E(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof rm))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof rm))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof rm))throw new TypeError("Invalid Fingerprint");const t=D6(0,this.contents.length-1),i=this.contents[t];return this.contents[t]=e,i}remove(e){if(!(e instanceof rm))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(i=>e.equals(i));return t>-1?(this.contents[t]=null,!0):!1}};const Gk={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},vY={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},bY=new globalThis.TextEncoder;function Tfe(n,e){const t=Gk[e];let i=vY[e];for(let r=0;r<n.length;r++)i^=BigInt(n[r]),i=BigInt.asUintN(e,i*t);return i}function Afe(n,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const i=Gk[e];let r=vY[e],s=n;for(;s.length>0;){const o=bY.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)r^=BigInt(t[a]),r=BigInt.asUintN(e,r*i)}return r}function Wk(n,{size:e=32,utf8Buffer:t}={}){if(!Gk[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof n=="string"){if(t)return Afe(n,e,t);n=bY.encode(n)}return Tfe(n,e)}const Kk={hash:n=>Number(Wk(n,{size:32})),hashV:(n,e)=>Cfe(Kk.hash(n,e))};function Cfe(n){let e=n.toString(16);return e.length%2===1&&(e=`0${e}`),Ut(e,"base16")}const Mfe=500;let oF=class{constructor(e){E(this,"bucketSize");E(this,"filterSize");E(this,"fingerprintSize");E(this,"buckets");E(this,"count");E(this,"hash");E(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??Kk,this.seed=e.seed??D6(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=Ut(e));const t=new rm(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=(i^t.hash())%this.filterSize;if(this.buckets[i]==null&&(this.buckets[i]=new m4(this.bucketSize)),this.buckets[r]==null&&(this.buckets[r]=new m4(this.bucketSize)),this.buckets[i].add(t)||this.buckets[r].add(t))return this.count++,!0;const s=[i,r];let o=s[D6(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new m4(this.bucketSize));for(let a=0;a<Mfe;a++){const l=this.buckets[o].swap(t);if(l!=null&&(o=(o^l.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new m4(this.bucketSize)),this.buckets[o].add(l)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=Ut(e));const t=new rm(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=this.buckets[i]?.has(t)??!1;if(r)return r;const s=(i^t.hash())%this.filterSize;return this.buckets[s]?.has(t)??!1}remove(e){typeof e=="string"&&(e=Ut(e));const t=new rm(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=this.buckets[i]?.remove(t)??!1;if(r)return this.count--,r;const s=(i^t.hash())%this.filterSize,o=this.buckets[s]?.remove(t)??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}};const Rfe={1:.5,2:.84,4:.95,8:.98};function Ife(n=.001){return n>.002?2:n>1e-5?4:8}function Nfe(n,e=.001){const t=Ife(e),i=Rfe[t],r=Math.round(n/i),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),xY);return{filterSize:r,bucketSize:t,fingerprintSize:s}}let Pfe=class{constructor(e){E(this,"filterSize");E(this,"bucketSize");E(this,"fingerprintSize");E(this,"scale");E(this,"filterSeries");E(this,"hash");E(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??Kk,this.seed=e.seed??D6(0,Math.pow(2,10)),this.filterSeries=[new oF({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=Ut(e)),this.has(e))return!0;let t=this.filterSeries.find(i=>i.reliable);if(t==null){const i=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new oF({filterSize:i,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=Ut(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=Ut(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}};function kfe(n,e=.001,t){return new Pfe({...Nfe(n,e),...t??{}})}const Lfe=async()=>{const n=await ife("Ed25519"),e=await Dfe(n);if(e.type==="Ed25519")return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)};async function Dfe(n){return jd(zk(n.public),rfe(n))}const Ofe={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var O6;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(i.uint32(10),i.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(i.uint32(18),i.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(i.uint32(26),i.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(i.uint32(42),i.bytes(t.signature)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.publicKey=t.bytes();break;case 2:r.payloadType=t.bytes();break;case 3:r.payload=t.bytes();break;case 5:r.signature=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(O6||(O6={}));var Xu;let aF=(Xu=class{constructor(e){E(this,"peerId");E(this,"payloadType");E(this,"payload");E(this,"signature");E(this,"marshaled");const{peerId:t,payloadType:i,payload:r,signature:s}=e;this.peerId=t,this.payloadType=i,this.payload=r,this.signature=s}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=O6.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return li(this.marshal(),e.marshal())}async validate(e){const t=lF(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return cb(this.peerId.publicKey).verify(t.subarray(),this.signature)}},E(Xu,"createFromProtobuf",async e=>{const t=O6.decode(e),i=await jd(t.publicKey);return new Xu({peerId:i,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),E(Xu,"seal",async(e,t)=>{if(t.privateKey==null)throw new Error("Missing private key");const i=e.domain,r=e.codec,s=e.marshal(),o=lF(i,r,s),l=await(await _7(t.privateKey)).sign(o.subarray());return new Xu({peerId:t,payloadType:r,payload:s,signature:l})}),E(Xu,"openAndCertify",async(e,t)=>{const i=await Xu.createFromProtobuf(e);if(!await i.validate(t))throw new Se("envelope signature is not valid for the given domain",Ofe.ERR_SIGNATURE_NOT_VALID);return i}),Xu);const lF=(n,e,t)=>{const i=Ut(n),r=Za(i.byteLength),s=Za(e.length),o=Za(t.length);return new Zn(r,i,s,e,o,t)};function _Y(n,e){const t=(i,r)=>i.toString().localeCompare(r.toString());return n.length!==e.length?!1:(e.sort(t),n.sort(t).every((i,r)=>e[r].equals(i)))}var PM;let oc=(PM=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidMultiaddrError")}},E(PM,"name","InvalidMultiaddrError"),PM);var kM;let db=(kM=class extends Error{constructor(){super(...arguments);E(this,"name","ValidationError")}},E(kM,"name","ValidationError"),kM);var LM;let Bfe=(LM=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidParametersError")}},E(LM,"name","InvalidParametersError"),LM);var DM;let Ufe=(DM=class extends Error{constructor(){super(...arguments);E(this,"name","UnknownProtocolError")}},E(DM,"name","UnknownProtocolError"),DM);class Ffe{constructor(){E(this,"index",0);E(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,i=e();return i===void 0&&(this.index=t),i}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,i){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return i()})}readNumber(e,t,i,r){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const l=a==="0",c=2**(8*r)-1;for(;;){const u=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const p=Number.parseInt(h,e);if(!Number.isNaN(p))return p});if(u===void 0)break;if(s*=e,s+=u,s>c||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!i&&l&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const i=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(i===void 0)return;e[t]=i}return e})}readIPv6Addr(){const e=t=>{for(let i=0;i<t.length/2;i++){const r=i*2;if(i<t.length-3){const o=this.readSeparator(":",i,()=>this.readIPv4Addr());if(o!==void 0)return t[r]=o[0],t[r+1]=o[1],t[r+2]=o[2],t[r+3]=o[3],[r+4,!0]}const s=this.readSeparator(":",i,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[r,!1];t[r]=s>>8,t[r+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[i,r]=e(t);if(i===16)return t;if(r||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(i+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const zfe=45,jfe=15,B6=new Ffe;function Vfe(n){if(!(n.length>jfe))return B6.new(n).parseWith(()=>B6.readIPv4Addr())}function Hfe(n){if(n.includes("%")&&(n=n.split("%")[0]),!(n.length>zfe))return B6.new(n).parseWith(()=>B6.readIPv6Addr())}function pu(n){return!!Vfe(n)}function G0(n){return!!Hfe(n)}const iI=4,rI=6,sI=273,$fe=33,mS=41,wY=42,Gfe=43,SY=53,EY=54,qk=55,TY=56,Wfe=132,Kfe=301,qfe=302,Zfe=400,AY=421,Yfe=444,Xfe=445,Qfe=446,Jfe=447,e0e=448,t0e=449,n0e=454,i0e=460,r0e=461,s0e=465,o0e=466,a0e=480,l0e=481,c0e=443,u0e=477,h0e=478,d0e=479,f0e=277,p0e=275,m0e=276,g0e=280,y0e=281,CY=290,x0e=777;function cF(n){return e=>Vt(e,n)}function uF(n){return e=>Ut(e,n)}function Kv(n){return new DataView(n.buffer).getUint16(n.byteOffset).toString()}function iy(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof n=="string"?parseInt(n):n),new Uint8Array(e)}function v0e(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ut(e[0],"base32"),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const r=iy(i);return Ms([t,r],t.length+r.length)}function b0e(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=oh.decode(`b${e[0]}`),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const r=iy(i);return Ms([t,r],t.length+r.length)}function hF(n){const e=n.subarray(0,n.length-2),t=n.subarray(n.length-2),i=Vt(e,"base32"),r=Kv(t);return`${i}:${r}`}const MY=function(n){n=n.toString().trim();const e=new Uint8Array(4);return n.split(/\./g).forEach((t,i)=>{const r=parseInt(t,10);if(isNaN(r)||r<0||r>255)throw new oc("Invalid byte value in IP address");e[i]=r}),e},_0e=function(n){let e=0;n=n.toString().trim();const t=n.split(":",8);let i;for(i=0;i<t.length;i++){const s=pu(t[i]);let o;s&&(o=MY(t[i]),t[i]=Vt(o.subarray(0,2),"base16")),o!=null&&++i<8&&t.splice(i,0,Vt(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(i=0;i<t.length&&t[i]!=="";i++);const s=[i,1];for(i=9-t.length;i>0;i--)s.push("0");t.splice.apply(t,s)}const r=new Uint8Array(e+16);for(i=0;i<t.length;i++){t[i]===""&&(t[i]="0");const s=parseInt(t[i],16);if(isNaN(s)||s<0||s>65535)throw new oc("Invalid byte value in IP address");r[e++]=s>>8&255,r[e++]=s&255}return r},w0e=function(n){if(n.byteLength!==4)throw new oc("IPv4 address was incorrect length");const e=[];for(let t=0;t<n.byteLength;t++)e.push(n[t]);return e.join(".")},S0e=function(n){if(n.byteLength!==16)throw new oc("IPv6 address was incorrect length");const e=[];for(let i=0;i<n.byteLength;i+=2){const r=n[i],s=n[i+1],o=`${r.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const i=new URL(`http://[${t}]`);return i.hostname.substring(1,i.hostname.length-1)}catch{throw new oc(`Invalid IPv6 address "${t}"`)}};function E0e(n){try{const e=new URL(`http://[${n}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new oc(`Invalid IPv6 address "${n}"`)}}const EA=Object.values($m).map(n=>n.decoder),T0e=function(){let n=EA[0].or(EA[1]);return EA.slice(2).forEach(e=>n=n.or(e)),n}();function A0e(n){return T0e.decode(n)}function C0e(n){return e=>n.encoder.encode(e)}function M0e(n){if(parseInt(n).toString()!==n)throw new db("Value must be an integer")}function R0e(n){if(n<0)throw new db("Value must be a positive integer, or zero")}function I0e(n){return e=>{if(e>n)throw new db(`Value must be smaller than or equal to ${n}`)}}function N0e(...n){return e=>{for(const t of n)t(e)}}const g4=N0e(M0e,R0e,I0e(65535)),Eo=-1;let P0e=class{constructor(){E(this,"protocolsByCode",new Map);E(this,"protocolsByName",new Map)}getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new Ufe(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(i=>{this.protocolsByName.delete(i)}))}};const ou=new P0e,k0e=[{code:iI,name:"ip4",size:32,valueToBytes:MY,bytesToValue:w0e,validate:n=>{if(!pu(n))throw new db(`Invalid IPv4 address "${n}"`)}},{code:rI,name:"tcp",size:16,valueToBytes:iy,bytesToValue:Kv,validate:g4},{code:sI,name:"udp",size:16,valueToBytes:iy,bytesToValue:Kv,validate:g4},{code:$fe,name:"dccp",size:16,valueToBytes:iy,bytesToValue:Kv,validate:g4},{code:mS,name:"ip6",size:128,valueToBytes:_0e,bytesToValue:S0e,stringToValue:E0e,validate:n=>{if(!G0(n))throw new db(`Invalid IPv6 address "${n}"`)}},{code:wY,name:"ip6zone",size:Eo},{code:Gfe,name:"ipcidr",size:8,bytesToValue:cF("base10"),valueToBytes:uF("base10")},{code:SY,name:"dns",size:Eo,resolvable:!0},{code:EY,name:"dns4",size:Eo,resolvable:!0},{code:qk,name:"dns6",size:Eo,resolvable:!0},{code:TY,name:"dnsaddr",size:Eo,resolvable:!0},{code:Wfe,name:"sctp",size:16,valueToBytes:iy,bytesToValue:Kv,validate:g4},{code:Kfe,name:"udt"},{code:qfe,name:"utp"},{code:Zfe,name:"unix",size:Eo,path:!0,stringToValue:n=>decodeURIComponent(n),valueToString:n=>encodeURIComponent(n)},{code:AY,name:"p2p",aliases:["ipfs"],size:Eo,bytesToValue:cF("base58btc"),valueToBytes:n=>n.startsWith("Q")||n.startsWith("1")?uF("base58btc")(n):Fi.parse(n).multihash.bytes},{code:Yfe,name:"onion",size:96,bytesToValue:hF,valueToBytes:v0e},{code:Xfe,name:"onion3",size:296,bytesToValue:hF,valueToBytes:b0e},{code:Qfe,name:"garlic64",size:Eo},{code:Jfe,name:"garlic32",size:Eo},{code:e0e,name:"tls"},{code:t0e,name:"sni",size:Eo},{code:n0e,name:"noise"},{code:i0e,name:"quic"},{code:r0e,name:"quic-v1"},{code:s0e,name:"webtransport"},{code:o0e,name:"certhash",size:Eo,bytesToValue:C0e(V0),valueToBytes:A0e},{code:a0e,name:"http"},{code:l0e,name:"http-path",size:Eo,stringToValue:n=>`/${decodeURIComponent(n)}`,valueToString:n=>encodeURIComponent(n.substring(1))},{code:c0e,name:"https"},{code:u0e,name:"ws"},{code:h0e,name:"wss"},{code:d0e,name:"p2p-websocket-star"},{code:f0e,name:"p2p-stardust"},{code:p0e,name:"p2p-webrtc-star"},{code:m0e,name:"p2p-webrtc-direct"},{code:g0e,name:"webrtc-direct"},{code:y0e,name:"webrtc"},{code:CY,name:"p2p-circuit"},{code:x0e,name:"memory",size:Eo}];k0e.forEach(n=>{ou.addProtocol(n)});function L0e(n){const e=[];let t=0;for(;t<n.length;){const i=$0(n,t),r=ou.getProtocol(i),s=nr(i),o=U0e(r,n,t+s);let a=0;o>0&&r.size===Eo&&(a=nr(o));const l=s+a+o,c={code:i,name:r.name,bytes:n.subarray(t,t+l)};if(o>0){const u=t+s+a,h=n.subarray(u,u+o);c.value=r.bytesToValue?.(h)??Vt(h)}e.push(c),t+=l}return e}function D0e(n){let e=0;const t=[];for(const i of n){if(i.bytes==null){const r=ou.getProtocol(i.code),s=nr(i.code);let o,a=0,l=0;i.value!=null&&(o=r.valueToBytes?.(i.value)??Ut(i.value),a=o.byteLength,r.size===Eo&&(l=nr(a)));const c=new Uint8Array(s+l+a);let u=0;M0(i.code,c,u),u+=s,o!=null&&(r.size===Eo&&(M0(a,c,u),u+=l),c.set(o,u)),i.bytes=c}t.push(i.bytes),e+=i.bytes.byteLength}return Ms(t,e)}function O0e(n){if(n.charAt(0)!=="/")throw new oc('String multiaddr must start with "/"');const e=[];let t="protocol",i="",r="";for(let s=1;s<n.length;s++){const o=n.charAt(s);o!=="/"&&(t==="protocol"?r+=n.charAt(s):i+=n.charAt(s));const a=s===n.length-1;if(o==="/"||a){const l=ou.getProtocol(r);if(t==="protocol"){if(l.size==null||l.size===0){e.push({code:l.code,name:l.name}),i="",r="",t="protocol";continue}else if(a)throw new oc(`Component ${r} was missing value`);t="value"}else if(t==="value"){const c={code:l.code,name:l.name};if(l.size!=null&&l.size!==0){if(i==="")throw new oc(`Component ${r} was missing value`);c.value=l.stringToValue?.(i)??i}e.push(c),i="",r="",t="protocol"}}}if(r!==""&&i!=="")throw new oc("Incomplete multiaddr");return e}function B0e(n){return`/${n.flatMap(e=>{if(e.value==null)return e.name;const t=ou.getProtocol(e.code);if(t==null)throw new oc(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function U0e(n,e,t){return n.size==null||n.size===0?0:n.size>0?n.size/8:$0(e,t)}const F0e=Symbol.for("nodejs.util.inspect.custom"),RY=Symbol.for("@multiformats/multiaddr"),z0e=[SY,EY,qk,TY];class j0e extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}function V0e(n){if(n==null&&(n="/"),S7(n))return n.getComponents();if(n instanceof Uint8Array)return L0e(n);if(typeof n=="string")return n=n.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),n===""&&(n="/"),O0e(n);if(Array.isArray(n))return n;throw new oc("Must be a string, Uint8Array, Component[], or another Multiaddr")}var YUe,Nr,By,Uy,a0;let H0e=(a0=class{constructor(e="/",t={}){E(this,YUe,!0);$t(this,Nr,void 0);$t(this,By,void 0);$t(this,Uy,void 0);On(this,Nr,V0e(e)),t.validate!==!1&&$0e(this)}get bytes(){return ze(this,Uy)==null&&On(this,Uy,D0e(ze(this,Nr))),ze(this,Uy)}toString(){return ze(this,By)==null&&On(this,By,B0e(ze(this,Nr))),ze(this,By)}toJSON(){return this.toString()}toOptions(){let e,t,i,r,s="";for(const{code:a,name:l,value:c}of ze(this,Nr))a===wY&&(s=`%${c??""}`),z0e.includes(a)&&(t="tcp",r=443,i=`${c??""}${s}`,e=a===qk?6:4),(a===rI||a===sI)&&(t=l==="tcp"?"tcp":"udp",r=parseInt(c??"")),(a===iI||a===mS)&&(t="tcp",i=`${c??""}${s}`,e=a===mS?6:4);if(e==null||t==null||i==null||r==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:i,transport:t,port:r}}getComponents(){return[...ze(this,Nr)]}protos(){return ze(this,Nr).map(({code:e,value:t})=>{const i=ou.getProtocol(e);return{code:e,size:i.size??0,name:i.name,resolvable:!!i.resolvable,path:!!i.path}})}protoCodes(){return ze(this,Nr).map(({code:e})=>e)}protoNames(){return ze(this,Nr).map(({name:e})=>e)}tuples(){return ze(this,Nr).map(({code:e,value:t})=>{if(t==null)return[e];const i=ou.getProtocol(e),r=[e];return t!=null&&r.push(i.valueToBytes?.(t)??Ut(t)),r})}stringTuples(){return ze(this,Nr).map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){const t=new a0(e);return new a0([...ze(this,Nr),...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),i=this.toString(),r=i.lastIndexOf(t);if(r<0)throw new Bfe(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new a0(i.slice(0,r),{validate:!1})}decapsulateCode(e){let t;for(let i=ze(this,Nr).length-1;i>-1;i--)if(ze(this,Nr)[i].code===e){t=i;break}return new a0(ze(this,Nr).slice(0,t),{validate:!1})}getPeerId(){try{let e=[];ze(this,Nr).forEach(({code:i,value:r})=>{i===AY&&e.push([i,r]),i===CY&&(e=[])});const t=e.pop();if(t?.[1]!=null){const i=t[1];return i[0]==="Q"||i[0]==="1"?Vt(Lr.decode(`z${i}`),"base58btc"):Vt(Fi.parse(i).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(const e of ze(this,Nr))if(ou.getProtocol(e.code).path)return e.value??null;return null}equals(e){return li(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const i=Zk.get(t.name);if(i==null)throw new j0e(`no available resolver for ${t.name}`);return(await i(this,e)).map(s=>zi(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(ze(this,Nr).length!==2||ze(this,Nr)[0].code!==iI&&ze(this,Nr)[0].code!==mS||ze(this,Nr)[1].code!==rI&&ze(this,Nr)[1].code!==sI)}[(YUe=RY,F0e)](){return`Multiaddr(${this.toString()})`}},Nr=new WeakMap,By=new WeakMap,Uy=new WeakMap,a0);function $0e(n){n.getComponents().forEach(e=>{const t=ou.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}function G0e(n,e){return ou.getProtocol(n).bytesToValue?.(e)??Vt(e,"base16")}const Zk=new Map;function S7(n){return!!n?.[RY]}function zi(n){return new H0e(n)}function vl(n){const e=ou.getProtocol(n);return{code:e.code,size:e.size??0,name:e.name,resolvable:!!e.resolvable,path:!!e.path}}const W0e="libp2p-peer-record",K0e=Uint8Array.from([3,1]);var U6;(function(n){(function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.multiaddr!=null&&r.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(r.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(r,s)=>{const o={multiaddr:new Uint8Array(0)},a=s==null?r.len:r.pos+s;for(;r.pos<a;){const l=r.uint32();switch(l>>>3){case 1:o.multiaddr=r.bytes();break;default:r.skipType(l&7);break}}return o})),i),t.encode=r=>Ti(r,t.codec()),t.decode=r=>Ei(r,t.codec())})(n.AddressInfo||(n.AddressInfo={}));let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(i.uint32(10),i.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(i.uint32(16),i.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)i.uint32(26),n.AddressInfo.codec().encode(s,i);r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={peerId:new Uint8Array(0),seq:0n,addresses:[]},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.peerId=t.bytes();break;case 2:r.seq=t.uint64();break;case 3:r.addresses.push(n.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(U6||(U6={}));var Qc;let TA=(Qc=class{constructor(e){E(this,"peerId");E(this,"multiaddrs");E(this,"seqNumber");E(this,"domain",Qc.DOMAIN);E(this,"codec",Qc.CODEC);E(this,"marshaled");const{peerId:t,multiaddrs:i,seqNumber:r}=e;this.peerId=t,this.multiaddrs=i??[],this.seqNumber=r??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=U6.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Qc)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!_Y(this.multiaddrs,e.multiaddrs))}},E(Qc,"createFromProtobuf",e=>{const t=U6.decode(e),i=gh(t.peerId),r=(t.addresses??[]).map(o=>zi(o.multiaddr)),s=t.seq;return new Qc({peerId:i,multiaddrs:r,seqNumber:s})}),E(Qc,"DOMAIN",W0e),E(Qc,"CODEC",K0e),Qc);function q0e(n){return n[Symbol.asyncIterator]!=null}function oI(n){if(q0e(n))return(async()=>{const t=[];for await(const i of n)t.push(i);return t})();const e=[];for(const t of n)e.push(t);return e}function dF(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const i=n.next(),r=i.value;return i.done===!0||r==null?{done:!0,value:void 0}:{done:!1,value:e(r)}}};return t}let Z0e=class{constructor(e){E(this,"map");if(this.map=new Map,e!=null)for(const[t,i]of e.entries())this.map.set(t.toString(),i)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return dF(this.map.entries(),e=>[Bi(e[0]),e[1]])}forEach(e){this.map.forEach((t,i)=>{e(t,Bi(i),this)})}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return dF(this.map.keys(),e=>Bi(e))}values(){return this.map.values()}get size(){return this.map.size}};var OM;let A2=(OM=class extends Error{constructor(t="The operation was aborted",...i){super(t,...i);E(this,"name","AbortError")}},E(OM,"name","AbortError"),OM);function Ki(){const n={};return n.promise=new Promise((e,t)=>{n.resolve=e,n.reject=t}),n}class fF{constructor(e){E(this,"buffer");E(this,"mask");E(this,"top");E(this,"btm");E(this,"next");if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class AA{constructor(e={}){E(this,"size");E(this,"hwm");E(this,"head");E(this,"tail");this.hwm=e.splitLimit??16,this.head=new fF(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new fF(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let Y0e=class extends Error{constructor(t,i){super(t??"The operation was aborted");E(this,"type");E(this,"code");this.type="aborted",this.code=i??"ABORT_ERR"}};function vc(n={}){return X0e(t=>{const i=t.shift();if(i==null)return{done:!0};if(i.error!=null)throw i.error;return{done:i.done===!0,value:i.value}},n)}function X0e(n,e){e=e??{};let t=e.onEnd,i=new AA,r,s,o,a=Ki();const l=async()=>{try{return i.isEmpty()?o?{done:!0}:await new Promise((w,v)=>{s=T=>{s=null,i.push(T);try{w(n(i))}catch(S){v(S)}return r}}):n(i)}finally{i.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Ki()})}},c=w=>s!=null?s(w):(i.push(w),r),u=w=>(i=new AA,s!=null?s({error:w}):(i.push({error:w}),r)),h=w=>{if(o)return r;if(e?.objectMode!==!0&&w?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:w})},p=w=>o?r:(o=!0,w!=null?u(w):c({done:!0})),m=()=>(i=new AA,p(),{done:!0}),y=w=>(p(w),{done:!0});if(r={[Symbol.asyncIterator](){return this},next:l,return:m,throw:y,push:h,end:p,get readableLength(){return i.size},onEmpty:async w=>{const v=w?.signal;if(v?.throwIfAborted(),i.isEmpty())return;let T,S;v!=null&&(T=new Promise((M,P)=>{S=()=>{P(new Y0e)},v.addEventListener("abort",S)}));try{await Promise.race([a.promise,T])}finally{S!=null&&v!=null&&v?.removeEventListener("abort",S)}}},t==null)return r;const b=r;return r={[Symbol.asyncIterator](){return this},next(){return b.next()},throw(w){return b.throw(w),t!=null&&(t(w),t=void 0),{done:!0}},return(){return b.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(w){return b.end(w),t!=null&&(t(w),t=void 0),r},get readableLength(){return b.readableLength},onEmpty:w=>b.onEmpty(w)},r}var Vu;class f1 extends EventTarget{constructor(){super();$t(this,Vu,new Map)}listenerCount(t){const i=ze(this,Vu).get(t);return i==null?0:i.length}addEventListener(t,i,r){super.addEventListener(t,i,r);let s=ze(this,Vu).get(t);s==null&&(s=[],ze(this,Vu).set(t,s)),s.push({callback:i,once:(r!==!0&&r!==!1&&r?.once)??!1})}removeEventListener(t,i,r){super.removeEventListener(t.toString(),i??null,r);let s=ze(this,Vu).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==i),ze(this,Vu).set(t,s))}dispatchEvent(t){const i=super.dispatchEvent(t);let r=ze(this,Vu).get(t.type);return r==null||(r=r.filter(({once:s})=>!s),ze(this,Vu).set(t.type,r)),i}safeDispatchEvent(t,i={}){return this.dispatchEvent(new CustomEvent(t,i))}}Vu=new WeakMap;async function Cm(n,e,t,i){const r=new A2(i?.errorMessage);i?.errorCode!=null&&(r.code=i.errorCode);const s=i?.errorEvent??"error";return t?.aborted===!0?Promise.reject(r):new Promise((o,a)=>{function l(){MA(t,"abort",h),MA(n,e,c),MA(n,s,u)}const c=p=>{try{if(i?.filter?.(p)===!1)return}catch(m){l(),a(m);return}l(),o(p)},u=p=>{if(l(),p instanceof Error){a(p);return}a(p.detail??i?.error??new Error(`The "${i?.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},h=()=>{l(),a(r)};CA(t,"abort",h),CA(n,e,c),CA(n,s,u)})}function CA(n,e,t){n!=null&&(IY(n)?n.addEventListener(e,t):n.addListener(e,t))}function MA(n,e,t){n!=null&&(IY(n)?n.removeEventListener(e,t):n.removeListener(e,t))}function IY(n){return typeof n.addEventListener=="function"&&typeof n.removeEventListener=="function"}var BM;let Q0e=(BM=class extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}},E(BM,"name","QueueFullError"),BM);function J0e(n){return n.reason}async function epe(n,e,t){if(e==null)return n;const i=t?.translateError??J0e;if(e.aborted)return n.catch(()=>{}),Promise.reject(i(e));let r;try{return await Promise.race([n,new Promise((s,o)=>{r=()=>{o(i(e))},e.addEventListener("abort",r)})])}finally{r!=null&&e.removeEventListener("abort",r)}}let tpe=class{constructor(e){E(this,"deferred");E(this,"signal");this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new A2)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function npe(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let ipe=class{constructor(e,t){E(this,"id");E(this,"fn");E(this,"options");E(this,"recipients");E(this,"status");E(this,"timeline");E(this,"controller");this.id=npe(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,i)=>t&&i.signal?.aborted===!0,!0)&&(this.controller.abort(new A2),this.cleanup())}async join(e={}){const t=new tpe(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await epe(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}};function pF(n,e){let t;const i=function(){const r=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(r,e)};return i.start=()=>{},i.stop=()=>{clearTimeout(t)},i}let mF=class extends f1{constructor(t={}){super();E(this,"concurrency");E(this,"maxSize");E(this,"queue");E(this,"pending");E(this,"sort");E(this,"autoStart");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=t.autoStart??!0,this.sort=t.sort,this.queue=[],this.emitEmpty=pF(this.emitEmpty.bind(this),1),this.emitIdle=pF(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(const i of this.queue)if(i.status==="queued"){t=i;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let i=0;i<this.queue.length;i++)if(this.queue[i]===t){this.queue.splice(i,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(t,i){if(i?.signal?.throwIfAborted(),this.size===this.maxSize)throw new Q0e;const r=new ipe(t,i);return this.enqueue(r),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),r.join(i).then(s=>(this.safeDispatchEvent("success",{detail:{job:r,result:s}}),s)).catch(s=>{if(r.status==="queued"){for(let o=0;o<this.queue.length;o++)if(this.queue[o]===r){this.queue.splice(o,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:r,error:s}}),s})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new A2)}),this.clear()}async onEmpty(t){this.size!==0&&await Cm(this,"empty",t?.signal)}async onSizeLessThan(t,i){this.size<t||await Cm(this,"next",i?.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Cm(this,"idle",t?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){t?.signal?.throwIfAborted();const i=vc({objectMode:!0}),r=c=>{c!=null?this.abort():this.clear(),i.end(c)},s=c=>{c.detail!=null&&i.push(c.detail.result)},o=c=>{r(c.detail.error)},a=()=>{r()},l=()=>{r(new A2("Queue aborted"))};this.addEventListener("success",s),this.addEventListener("failure",o),this.addEventListener("idle",a),t?.signal?.addEventListener("abort",l);try{yield*i}finally{this.removeEventListener("success",s),this.removeEventListener("failure",o),this.removeEventListener("idle",a),t?.signal?.removeEventListener("abort",l),r()}}};const NY="lock:worker:request-read",PY="lock:worker:abort-read-request",kY="lock:worker:release-read",LY="lock:master:grant-read",DY="lock:master:error-read",OY="lock:worker:request-write",BY="lock:worker:abort-write-request",UY="lock:worker:release-write",FY="lock:master:grant-write",zY="lock:master:error-write",jY="lock:worker:finalize",VY="mortice",rpe={singleProcess:!1},gF=(n,e,t,i,r,s,o,a,l)=>c=>{if(c.data==null)return;const u={type:c.data.type,name:c.data.name,identifier:c.data.identifier};u.type===r&&n.safeDispatchEvent(t,{detail:{name:u.name,identifier:u.identifier,handler:async()=>{e.postMessage({type:l,name:u.name,identifier:u.identifier}),await new Promise(h=>{const p=m=>{if(m?.data==null)return;const y={type:m.data.type,name:m.data.name,identifier:m.data.identifier};y.type===a&&y.identifier===u.identifier&&(e.removeEventListener("message",p),h())};e.addEventListener("message",p)})},onError:h=>{e.postMessage({type:o,name:u.name,identifier:u.identifier,error:{message:h.message,name:h.name,stack:h.stack}})}}}),u.type===s&&n.safeDispatchEvent(i,{detail:{name:u.name,identifier:u.identifier}}),u.type===jY&&n.safeDispatchEvent("finalizeRequest",{detail:{name:u.name}})},spe=(n=10)=>Math.random().toString().substring(2,n+2);class ope{constructor(e){E(this,"name");E(this,"channel");this.name=e,this.channel=new BroadcastChannel(VY)}readLock(e){return this.sendRequest(NY,PY,LY,DY,kY,e)}writeLock(e){return this.sendRequest(OY,BY,FY,zY,UY,e)}finalize(){this.channel.postMessage({type:jY,name:this.name}),this.channel.close()}async sendRequest(e,t,i,r,s,o){o?.signal?.throwIfAborted();const a=spe();return this.channel.postMessage({type:e,identifier:a,name:this.name}),new Promise((l,c)=>{const u=()=>{this.channel.postMessage({type:t,identifier:a,name:this.name})};o?.signal?.addEventListener("abort",u,{once:!0});const h=p=>{if(p.data?.identifier===a&&(p.data?.type===i&&(this.channel.removeEventListener("message",h),o?.signal?.removeEventListener("abort",u),l(()=>{this.channel.postMessage({type:s,identifier:a,name:this.name})})),p.data.type===r)){this.channel.removeEventListener("message",h),o?.signal?.removeEventListener("abort",u);const m=new Error;p.data.error!=null&&(m.message=p.data.error.message,m.name=p.data.error.name,m.stack=p.data.error.stack),c(m)}};this.channel.addEventListener("message",h)})}}const ape=n=>{if(n=Object.assign({},rpe,n),!!globalThis.document||n.singleProcess){const t=new BroadcastChannel(VY),i=new f1;return t.addEventListener("message",gF(i,t,"requestReadLock","abortReadLockRequest",NY,PY,DY,kY,LY)),t.addEventListener("message",gF(i,t,"requestWriteLock","abortWriteLockRequest",OY,BY,zY,UY,FY)),i}return new ope(n.name)},sm=new Map;let uv;function HY(n){return typeof n?.readLock=="function"&&typeof n?.writeLock=="function"}function lpe(n){if(uv==null&&(uv=ape(n),!HY(uv))){const e=uv;e.addEventListener("requestReadLock",t=>{const i=t.detail.name,r=t.detail.identifier,s=sm.get(i);if(s==null)return;const o=new AbortController,a=l=>{l.detail.name!==i||l.detail.identifier!==r||o.abort()};e.addEventListener("abortReadLockRequest",a),s.readLock({signal:o.signal}).then(async l=>{await t.detail.handler().finally(()=>{l()})}).catch(l=>{t.detail.onError(l)}).finally(()=>{e.removeEventListener("abortReadLockRequest",a)})}),e.addEventListener("requestWriteLock",t=>{const i=t.detail.name,r=t.detail.identifier,s=sm.get(i);if(s==null)return;const o=new AbortController,a=l=>{l.detail.name!==i||l.detail.identifier!==r||o.abort()};e.addEventListener("abortWriteLockRequest",a),s.writeLock({signal:o.signal}).then(async l=>{await t.detail.handler().finally(()=>{l()})}).catch(l=>{t.detail.onError(l)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",a)})}),e.addEventListener("finalizeRequest",t=>{const i=t.detail.name,r=sm.get(i);r?.finalize()})}return uv}async function RA(n,e){let t,i;const r=new Promise((o,a)=>{t=o,i=a}),s=()=>{i(new A2)};return e?.signal?.addEventListener("abort",s,{once:!0}),n.add(async()=>{await new Promise(o=>{t(()=>{e?.signal?.removeEventListener("abort",s),o()})})},{signal:e?.signal}).catch(o=>{i(o)}),r}const cpe=(n,e)=>{let t=sm.get(n);if(t!=null)return t;const i=lpe(e);if(HY(i))return t=i,sm.set(n,t),t;const r=new mF({concurrency:1});let s;return t={async readLock(o){if(s!=null)return RA(s,o);s=new mF({concurrency:e.concurrency,autoStart:!1});const a=s,l=RA(s,o);return r.add(async()=>{a.start(),await a.onIdle().then(()=>{s===a&&(s=null)})}),l},async writeLock(o){return s=null,RA(r,o)},finalize:()=>{sm.delete(n)},queue:r},sm.set(n,t),e.autoFinalize===!0&&r.addEventListener("idle",()=>{t.finalize()},{once:!0}),t},upe={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function hpe(n){const e=Object.assign({},upe,n);return cpe(e.name,e)}const bl={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};var F6;(function(n){(function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.key!=null&&r.key!==""&&(s.uint32(10),s.string(r.key)),r.value!=null&&r.value.byteLength>0&&(s.uint32(18),s.bytes(r.value)),o.lengthDelimited!==!1&&s.ldelim()},(r,s)=>{const o={key:"",value:new Uint8Array(0)},a=s==null?r.len:r.pos+s;for(;r.pos<a;){const l=r.uint32();switch(l>>>3){case 1:o.key=r.string();break;case 2:o.value=r.bytes();break;default:r.skipType(l&7);break}}return o})),i),t.encode=r=>Ti(r,t.codec()),t.decode=r=>Ei(r,t.codec())})(n.Peer$metadataEntry||(n.Peer$metadataEntry={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.key!=null&&r.key!==""&&(s.uint32(10),s.string(r.key)),r.value!=null&&(s.uint32(18),j6.codec().encode(r.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(r,s)=>{const o={key:""},a=s==null?r.len:r.pos+s;for(;r.pos<a;){const l=r.uint32();switch(l>>>3){case 1:o.key=r.string();break;case 2:o.value=j6.codec().decode(r,r.uint32());break;default:r.skipType(l&7);break}}return o})),i),t.encode=r=>Ti(r,t.codec()),t.decode=r=>Ei(r,t.codec())}(n.Peer$tagsEntry||(n.Peer$tagsEntry={}));let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.addresses!=null)for(const s of t.addresses)i.uint32(10),z6.codec().encode(s,i);if(t.protocols!=null)for(const s of t.protocols)i.uint32(18),i.string(s);if(t.publicKey!=null&&(i.uint32(34),i.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(i.uint32(42),i.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())i.uint32(50),n.Peer$metadataEntry.codec().encode({key:s,value:o},i);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())i.uint32(58),n.Peer$tagsEntry.codec().encode({key:s,value:o},i);r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={addresses:[],protocols:[],metadata:new Map,tags:new Map},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.addresses.push(z6.codec().decode(t,t.uint32()));break;case 2:r.protocols.push(t.string());break;case 4:r.publicKey=t.bytes();break;case 5:r.peerRecordEnvelope=t.bytes();break;case 6:{const a=n.Peer$metadataEntry.codec().decode(t,t.uint32());r.metadata.set(a.key,a.value);break}case 7:{const a=n.Peer$tagsEntry.codec().decode(t,t.uint32());r.tags.set(a.key,a.value);break}default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(F6||(F6={}));var z6;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(t.multiaddr)),t.isCertified!=null&&(i.uint32(16),i.bool(t.isCertified)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={multiaddr:new Uint8Array(0)},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.multiaddr=t.bytes();break;case 2:r.isCertified=t.bool();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(z6||(z6={}));var j6;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.value!=null&&t.value!==0&&(i.uint32(8),i.uint32(t.value)),t.expiry!=null&&(i.uint32(16),i.uint64(t.expiry)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={value:0},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.value=t.uint32();break;case 2:r.expiry=t.uint64();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(j6||(j6={}));function qv(n,e){const t=F6.decode(e);t.publicKey!=null&&n.publicKey==null&&(n=Sfe({...n,publicKey:n.publicKey}));const i=new Map,r=BigInt(Date.now());for(const[s,o]of t.tags.entries())o.expiry!=null&&o.expiry<r||i.set(s,o);return{...t,id:n,addresses:t.addresses.map(({multiaddr:s,isCertified:o})=>({multiaddr:zi(s),isCertified:o??!1})),metadata:t.metadata,peerRecordEnvelope:t.peerRecordEnvelope??void 0,tags:i}}const Kh="/",$Y=new TextEncoder().encode(Kh),y4=$Y[0];class Js{constructor(e,t){E(this,"_buf");if(typeof e=="string")this._buf=Ut(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==y4)throw new Error("Invalid key")}toString(e="utf8"){return Vt(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Js(e.join(Kh))}static random(){return new Js(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Js(e):typeof e.uint8Array=="function"?new Js(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=$Y),this._buf[0]!==y4){const e=new Uint8Array(this._buf.byteLength+1);e.fill(y4,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===y4;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),i=e.list();for(let r=0;r<t.length;r++){if(i.length<r+1)return!1;const s=t[r],o=i[r];if(s<o)return!0;if(s>o)return!1}return t.length<i.length}reverse(){return Js.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(Kh).slice(1)}type(){return dpe(this.baseNamespace())}name(){return fpe(this.baseNamespace())}instance(e){return new Js(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(Kh)||(e+=Kh),e+=this.type(),new Js(e)}parent(){const e=this.list();return e.length===1?new Js(Kh):new Js(e.slice(0,-1).join(Kh))}child(e){return this.toString()===Kh?e:e.toString()===Kh?this:new Js(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Js.withNamespaces([...this.namespaces(),...ppe(e.map(t=>t.namespaces()))])}}function dpe(n){const e=n.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function fpe(n){const e=n.split(":");return e[e.length-1]}function ppe(n){return[].concat(...n)}const GY="/peers/";function hv(n){if(!QK(n)||n.type==null)throw new Se("Invalid PeerId",bl.ERR_INVALID_PARAMETERS);const e=n.toCID().toString();return new Js(`${GY}${e}`)}async function mpe(n,e,t){const i=new Map;for(const r of t){if(r==null)continue;if(r.multiaddr instanceof Uint8Array&&(r.multiaddr=zi(r.multiaddr)),!S7(r.multiaddr))throw new Se("Multiaddr was invalid",bl.ERR_INVALID_PARAMETERS);if(!await e(n,r.multiaddr))continue;const s=r.isCertified??!1,o=r.multiaddr.toString(),a=i.get(o);a!=null?r.isCertified=a.isCertified||s:i.set(o,{multiaddr:r.multiaddr,isCertified:s})}return[...i.values()].sort((r,s)=>r.multiaddr.toString().localeCompare(s.multiaddr.toString())).map(({isCertified:r,multiaddr:s})=>({isCertified:r,multiaddr:s.bytes}))}async function IA(n,e,t,i){if(e==null)throw new Se("Invalid PeerData",bl.ERR_INVALID_PARAMETERS);if(e.publicKey!=null&&n.publicKey!=null&&!li(e.publicKey,n.publicKey))throw new Se("publicKey bytes do not match peer id publicKey bytes",bl.ERR_INVALID_PARAMETERS);const r=i.existingPeer;if(r!=null&&!n.equals(r.id))throw new Se("peer id did not match existing peer id",bl.ERR_INVALID_PARAMETERS);let s=r?.addresses??[],o=new Set(r?.protocols??[]),a=r?.metadata??new Map,l=r?.tags??new Map,c=r?.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(h=>({isCertified:!1,multiaddr:h}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const h=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=x4(h,{validate:yF})}if(e.tags!=null){const h=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);l=x4(h,{validate:xF,map:vF})}e.peerRecordEnvelope!=null&&(c=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(h=>({isCertified:!1,multiaddr:h}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const h=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[p,m]of h)m==null?a.delete(p):a.set(p,m);a=x4([...a.entries()],{validate:yF})}if(e.tags!=null){const h=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),p=new Map(l);for(const[m,y]of h)y==null?p.delete(m):p.set(m,y);l=x4([...p.entries()],{validate:xF,map:vF})}e.peerRecordEnvelope!=null&&(c=e.peerRecordEnvelope)}const u={addresses:await mpe(n,i.addressFilter??(async()=>!0),s),protocols:[...o.values()].sort((h,p)=>h.localeCompare(p)),metadata:a,tags:l,publicKey:r?.id.publicKey??e.publicKey??n.publicKey,peerRecordEnvelope:c};return n.type!=="RSA"&&delete u.publicKey,u}function x4(n,e){const t=new Map;for(const[i,r]of n)r!=null&&e.validate(i,r);for(const[i,r]of n.sort(([s],[o])=>s.localeCompare(o)))r!=null&&t.set(i,e.map?.(i,r)??r);return t}function yF(n,e){if(typeof n!="string")throw new Se("Metadata key must be a string",bl.ERR_INVALID_PARAMETERS);if(!(e instanceof Uint8Array))throw new Se("Metadata value must be a Uint8Array",bl.ERR_INVALID_PARAMETERS)}function xF(n,e){if(typeof n!="string")throw new Se("Tag name must be a string",bl.ERR_INVALID_PARAMETERS);if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new Se("Tag value must be an integer",bl.ERR_INVALID_PARAMETERS);if(e.value<0||e.value>100)throw new Se("Tag value must be between 0-100",bl.ERR_INVALID_PARAMETERS)}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new Se("Tag ttl must be an integer",bl.ERR_INVALID_PARAMETERS);if(e.ttl<0)throw new Se("Tag ttl must be between greater than 0",bl.ERR_INVALID_PARAMETERS)}}function vF(n,e){let t;return e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl))),{value:e.value??0,expiry:t}}function gS(n,e,t){const i=n.toString().split("/")[2],r=oh.decode(i),s=gh(r),o=t.get(s);if(o!=null)return o;const a=qv(s,e);return t.set(s,a),a}function gpe(n,e){return n==null?{}:{prefix:GY,filters:(n.filters??[]).map(t=>({key:i,value:r})=>t(gS(i,r,e))),orders:(n.orders??[]).map(t=>(i,r)=>t(gS(i.key,i.value,e),gS(r.key,r.value,e)))}}var Fy,yS,zy,xS;class ype{constructor(e,t={}){$t(this,Fy);$t(this,zy);E(this,"peerId");E(this,"datastore");E(this,"lock");E(this,"addressFilter");this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=hpe({name:"peer-store",singleProcess:!0})}async has(e){return this.datastore.has(hv(e))}async delete(e){if(this.peerId.equals(e))throw new Se("Cannot delete self peer",bl.ERR_INVALID_PARAMETERS);await this.datastore.delete(hv(e))}async load(e){const t=await this.datastore.get(hv(e));return qv(e,t)}async save(e,t){const{existingBuf:i,existingPeer:r}=await rn(this,Fy,yS).call(this,e),s=await IA(e,t,"patch",{addressFilter:this.addressFilter});return rn(this,zy,xS).call(this,e,s,i,r)}async patch(e,t){const{existingBuf:i,existingPeer:r}=await rn(this,Fy,yS).call(this,e),s=await IA(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:r});return rn(this,zy,xS).call(this,e,s,i,r)}async merge(e,t){const{existingBuf:i,existingPeer:r}=await rn(this,Fy,yS).call(this,e),s=await IA(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:r});return rn(this,zy,xS).call(this,e,s,i,r)}async*all(e){const t=new Z0e;for await(const{key:i,value:r}of this.datastore.query(gpe(e??{},t))){const s=gS(i,r,t);s.id.equals(this.peerId)||(yield s)}}}Fy=new WeakSet,yS=async function(e){try{const t=await this.datastore.get(hv(e)),i=qv(e,t);return{existingBuf:t,existingPeer:i}}catch(t){if(t.code!=="ERR_NOT_FOUND")throw t}return{}},zy=new WeakSet,xS=async function(e,t,i,r){const s=F6.encode(t);return i!=null&&li(s,i)?{peer:qv(e,s),previous:r,updated:!1}:(await this.datastore.put(hv(e),s),{peer:qv(e,s),previous:r,updated:!0})};var XUe,jy,vS;class xpe{constructor(e,t={}){$t(this,jy);E(this,"store");E(this,"events");E(this,"peerId");E(this,"log");E(this,XUe,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new ype(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const i=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const r of this.store.all(t))e(r)}finally{this.log.trace("forEach release read lock"),i()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await oI(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const i=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const r=await this.store.save(e,t);return rn(this,jy,vS).call(this,e,r),r.peer}finally{this.log.trace("save release write lock"),i()}}async patch(e,t){this.log.trace("patch await write lock");const i=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const r=await this.store.patch(e,t);return rn(this,jy,vS).call(this,e,r),r.peer}finally{this.log.trace("patch release write lock"),i()}}async merge(e,t){this.log.trace("merge await write lock");const i=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const r=await this.store.merge(e,t);return rn(this,jy,vS).call(this,e,r),r.peer}finally{this.log.trace("merge release write lock"),i()}}async consumePeerRecord(e,t){const i=await aF.openAndCertify(e,TA.DOMAIN);if(t?.equals(i.peerId)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,i.peerId),!1;const r=TA.createFromProtobuf(i.payload);let s;try{s=await this.get(i.peerId)}catch(o){if(o.code!=="ERR_NOT_FOUND")throw o}if(s?.peerRecordEnvelope!=null){const o=await aF.createFromProtobuf(s.peerRecordEnvelope),a=TA.createFromProtobuf(o.payload);if(a.seqNumber>=r.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",a.seqNumber,r.seqNumber),!1}return await this.patch(r.peerId,{peerRecordEnvelope:e,addresses:r.multiaddrs.map(o=>({isCertified:!0,multiaddr:o}))}),!0}}XUe=Symbol.toStringTag,jy=new WeakSet,vS=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function vpe(n){return n[Symbol.asyncIterator]!=null}function V6(n){if(vpe(n))return(async()=>{for await(const e of n);})();for(const e of n);}function Yk(n){const[e,t]=n[Symbol.asyncIterator]!=null?[n[Symbol.asyncIterator](),Symbol.asyncIterator]:[n[Symbol.iterator](),Symbol.iterator],i=[];return{peek:()=>e.next(),push:r=>{i.push(r)},next:()=>i.length>0?{done:!1,value:i.shift()}:e.next(),[t](){return this}}}function bpe(n){return n[Symbol.asyncIterator]!=null}function eg(n,e){let t=0;if(bpe(n))return async function*(){for await(const l of n)await e(l,t++)&&(yield l)}();const i=Yk(n),{value:r,done:s}=i.next();if(s===!0)return function*(){}();const o=e(r,t++);if(typeof o.then=="function")return async function*(){await o&&(yield r);for(const l of i)await e(l,t++)&&(yield l)}();const a=e;return function*(){o===!0&&(yield r);for(const l of i)a(l,t++)&&(yield l)}()}function _pe(n){return n[Symbol.asyncIterator]!=null}function bF(n,e){return _pe(n)?async function*(){yield*(await oI(n)).sort(e)}():function*(){yield*oI(n).sort(e)}()}function wpe(n){return n[Symbol.asyncIterator]!=null}function aI(n,e){return wpe(n)?async function*(){let t=0;if(!(e<1)){for await(const i of n)if(yield i,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const i of n)if(yield i,t++,t===e)return}}()}class Spe{put(e,t,i){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:i,value:r}of e)await this.put(i,r,t),yield i}async*getMany(e,t={}){for await(const i of e)yield{key:i,value:await this.get(i,t)}}async*deleteMany(e,t={}){for await(const i of e)await this.delete(i,t),yield i}batch(){let e=[],t=[];return{put(i,r){e.push({key:i,value:r})},delete(i){t.push(i)},commit:async i=>{await V6(this.putMany(e,i)),e=[],await V6(this.deleteMany(t,i)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let i=this._all(e,t);if(e.prefix!=null){const r=e.prefix;i=eg(i,s=>s.key.toString().startsWith(r))}if(Array.isArray(e.filters)&&(i=e.filters.reduce((r,s)=>eg(r,s),i)),Array.isArray(e.orders)&&(i=e.orders.reduce((r,s)=>bF(r,s),i)),e.offset!=null){let r=0;const s=e.offset;i=eg(i,()=>r++>=s)}return e.limit!=null&&(i=aI(i,e.limit)),i}queryKeys(e,t){let i=this._allKeys(e,t);if(e.prefix!=null){const r=e.prefix;i=eg(i,s=>s.toString().startsWith(r))}if(Array.isArray(e.filters)&&(i=e.filters.reduce((r,s)=>eg(r,s),i)),Array.isArray(e.orders)&&(i=e.orders.reduce((r,s)=>bF(r,s),i)),e.offset!=null){const r=e.offset;let s=0;i=eg(i,()=>s++>=r)}return e.limit!=null&&(i=aI(i,e.limit)),i}}function _F(n,e){for(const t in e)Object.defineProperty(n,t,{value:e[t],enumerable:!0,configurable:!0});return n}function Epe(n,e,t){if(!n||typeof n=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return _F(n,t)}catch{t.message=n.message,t.stack=n.stack;const r=function(){};return r.prototype=Object.create(Object.getPrototypeOf(n)),_F(new r,t)}}var Tpe=Epe;const Ape=wc(Tpe);function Cpe(n){return n=n??new Error("Not Found"),Ape(n,"ERR_NOT_FOUND")}class Mpe extends Spe{constructor(){super();E(this,"data");this.data=new Map}put(t,i){return this.data.set(t.toString(),i),t}get(t){const i=this.data.get(t.toString());if(i==null)throw Cpe();return i}has(t){return this.data.has(t.toString())}delete(t){this.data.delete(t.toString())}*_all(){for(const[t,i]of this.data.entries())yield{key:new Js(t),value:i}}*_allKeys(){for(const t of this.data.keys())yield new Js(t)}}function Rpe(n,e){let t;return function(){const i=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(i,e)}}const Ipe=n=>n;function NA(n,e){const t=n.getPeerId();return t!=null&&Bi(t).equals(e)&&(n=n.decapsulate(zi(`/p2p/${e.toString()}`))),n}var QUe;class Npe{constructor(e,t={}){E(this,"log");E(this,"components");E(this,"listen");E(this,"announce");E(this,"observed");E(this,"announceFilter");E(this,QUe,"@libp2p/address-manager");const{listen:i=[],announce:r=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=i.map(s=>s.toString()),this.announce=new Set(r.map(s=>s.toString())),this.observed=new Map,this.announceFilter=t.announceFilter??Ipe,this._updatePeerStoreAddresses=Rpe(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter(([t,i])=>i.confident).map(([t])=>zi(t))).map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>zi(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>zi(e))}getObservedAddrs(){return Array.from(this.observed).map(([e])=>zi(e))}addObservedAddr(e){e=NA(e,this.components.peerId);const t=e.toString();this.observed.has(t)||this.observed.set(t,{confident:!1})}confirmObservedAddr(e){e=NA(e,this.components.peerId);const t=e.toString(),r=(this.observed.get(t)??{confident:!1}).confident;this.observed.set(t,{confident:!0}),r||this._updatePeerStoreAddresses()}removeObservedAddr(e){e=NA(e,this.components.peerId);const t=e.toString();this.observed.delete(t)}getAddresses(){let e=this.getAnnounceAddrs().map(i=>i.toString());e.length===0&&(e=this.components.transportManager.getAddrs().map(i=>i.toString())),e=e.concat(Array.from(this.observed).filter(([i,r])=>r.confident).map(([i])=>i));const t=new Set(e);return this.announceFilter(Array.from(t).map(i=>zi(i))).map(i=>i.protos().pop()?.path===!0||i.getPeerId()===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`))}}QUe=Symbol.toStringTag;class Ppe{constructor(e={}){E(this,"components",{});E(this,"_started",!1);this.components={};for(const[t,i]of Object.entries(e))this.components[t]=i;this.components.logger==null&&(this.components.logger=pY())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>uk(t)).map(async t=>{await t[e]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const kpe=["metrics","connectionProtector","dns"],Lpe=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function Dpe(n={}){const e=new Ppe(n);return new Proxy(e,{get(i,r,s){if(typeof r=="string"&&!Lpe.includes(r)){const o=e.components[r];if(o==null&&!kpe.includes(r))throw new Se(`${r} not set`,"ERR_SERVICE_MISSING");return o}return Reflect.get(i,r,s)},set(i,r,s){return typeof r=="string"?e.components[r]=s:Reflect.set(i,r,s),!0}})}function Ope(n){const e={};for(const t of Object.values(n.components))for(const i of Bpe(t))e[i]=!0;for(const t of Object.values(n.components))for(const i of Upe(t))if(e[i]!==!0)throw new Se(`Service "${Fpe(t)}" required capability "${i}" but it was not provided by any component, you may need to add additional configuration when creating your node.`,"ERR_UNMET_SERVICE_DEPENDENCIES")}function Bpe(n){return Array.isArray(n?.[kd])?n[kd]:[]}function Upe(n){return Array.isArray(n?.[w6])?n[w6]:[]}function Fpe(n){return n?.[Symbol.toStringTag]??n?.toString()??"unknown"}var WY;(function(){var n,e,t,i,r,s,o,a;a=function(l){var c,u,h,p;return c=(l&255<<24)>>>24,u=(l&255<<16)>>>16,h=(l&65280)>>>8,p=l&255,[c,u,h,p].join(".")},o=function(l){var c,u,h,p,m,y;for(c=[],h=p=0;p<=3&&l.length!==0;h=++p){if(h>0){if(l[0]!==".")throw new Error("Invalid IP");l=l.substring(1)}y=e(l),m=y[0],u=y[1],l=l.substring(u),c.push(m)}if(l.length!==0)throw new Error("Invalid IP");switch(c.length){case 1:if(c[0]>4294967295)throw new Error("Invalid IP");return c[0]>>>0;case 2:if(c[0]>255||c[1]>16777215)throw new Error("Invalid IP");return(c[0]<<24|c[1])>>>0;case 3:if(c[0]>255||c[1]>255||c[2]>65535)throw new Error("Invalid IP");return(c[0]<<24|c[1]<<16|c[2])>>>0;case 4:if(c[0]>255||c[1]>255||c[2]>255||c[3]>255)throw new Error("Invalid IP");return(c[0]<<24|c[1]<<16|c[2]<<8|c[3])>>>0;default:throw new Error("Invalid IP")}},t=function(l){return l.charCodeAt(0)},i=t("0"),s=t("a"),r=t("A"),e=function(l){var c,u,h,p,m;for(p=0,c=10,u="9",h=0,l.length>1&&l[h]==="0"&&(l[h+1]==="x"||l[h+1]==="X"?(h+=2,c=16):"0"<=l[h+1]&&l[h+1]<="9"&&(h++,c=8,u="7")),m=h;h<l.length;){if("0"<=l[h]&&l[h]<=u)p=p*c+(t(l[h])-i)>>>0;else if(c===16)if("a"<=l[h]&&l[h]<="f")p=p*c+(10+t(l[h])-s)>>>0;else if("A"<=l[h]&&l[h]<="F")p=p*c+(10+t(l[h])-r)>>>0;else break;else break;if(p>4294967295)throw new Error("too large");h++}if(h===m)throw new Error("empty octet");return[p,h]},n=function(){function l(c,u){var h,p,m;if(typeof c!="string")throw new Error("Missing `net' parameter");if(u||(m=c.split("/",2),c=m[0],u=m[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch{throw new Error("Invalid mask: "+u)}for(h=p=32;p>=0;h=--p)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(c)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+c)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return l.prototype.contains=function(c){return typeof c=="string"&&(c.indexOf("/")>0||c.split(".").length!==4)&&(c=new l(c)),c instanceof l?this.contains(c.base)&&this.contains(c.broadcast||c.last):(o(c)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},l.prototype.next=function(c){return c==null&&(c=1),new l(a(this.netLong+this.size*c),this.mask)},l.prototype.forEach=function(c){var u,h,p;for(p=o(this.first),h=o(this.last),u=0;p<=h;)c(a(p),p,u),u++,p++},l.prototype.toString=function(){return this.base+"/"+this.bitmask},l}(),WY=n}).call($E);const zpe=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],jpe=zpe.map(n=>new WY(n));function Xk(n){for(const e of jpe)if(e.contains(n))return!0;return!1}function Vpe(n){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(n)}function Hpe(n){const e=n.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),i=e[e.length-2].padStart(4,"0"),r=`${parseInt(i.substring(0,2),16)}.${parseInt(i.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return Xk(r)}function $pe(n){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)}function Gpe(n){const e=n.split(":"),t=e[e.length-1];return Xk(t)}function Wpe(n){return/^::$/.test(n)||/^::1$/.test(n)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(n)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(n)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(n)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(n)||/^ff([0-9a-fA-F]{2,2}):/i.test(n)}function E7(n){return pu(n)?Xk(n):Vpe(n)?Hpe(n):$pe(n)?Gpe(n):G0(n)?Wpe(n):void 0}function Kpe(n={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{const t=e.stringTuples();return t[0][0]===4||t[0][0]===41?!!E7(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...n}}const qpe=n=>n.toString().split("/").slice(1),T_=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),di=n=>({match:e=>T_(t=>t===n).match(e),pattern:n}),p1=()=>({match:n=>T_(e=>typeof e=="string").match(n),pattern:"{string}"}),fb=()=>({match:n=>T_(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),ir=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{Lr.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),H6=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{V0.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),ji=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),jo=(...n)=>({match:e=>{let t;for(const i of n){const r=i.match(e);r!==!1&&(t==null||r.length<t.length)&&(t=r)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),vi=(...n)=>({match:e=>{for(const t of n){const i=t.match(e);if(i===!1)return!1;e=i}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function m1(...n){function e(r){let s=qpe(r);for(const o of n){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(r){return e(r)!==!1}function i(r){const s=e(r);return s===!1?!1:s.length===0}return{matchers:n,matches:t,exactMatch:i}}const T7=vi(di("dns4"),p1()),A7=vi(di("dns6"),p1()),C7=vi(di("dnsaddr"),p1()),Qk=vi(di("dns"),p1());m1(T7,ji(ir()));m1(A7,ji(ir()));m1(C7,ji(ir()));m1(jo(Qk,C7,T7,A7),ji(ir()));const Zpe=vi(di("ip4"),T_(pu)),Ype=vi(di("ip6"),T_(G0)),KY=jo(Zpe,Ype),_d=jo(KY,Qk,T7,A7,C7);m1(jo(KY,vi(jo(Qk,C7,T7,A7),ji(ir()))));const Jk=vi(_d,di("tcp"),fb()),M7=vi(_d,di("udp"),fb());m1(vi(Jk,ji(ir())));const qY=vi(M7,di("quic"),ji(ir())),eL=vi(M7,di("quic-v1"),ji(ir())),Xpe=jo(qY,eL),lI=jo(_d,Jk,M7,qY,eL),Qpe=jo(vi(lI,di("ws"),ji(ir()))),Jpe=jo(vi(lI,di("wss"),ji(ir())),vi(lI,di("tls"),ji(vi(di("sni"),p1())),di("ws"),ji(ir()))),eme=vi(M7,di("webrtc-direct"),ji(H6()),ji(H6()),ji(ir())),tme=vi(eL,di("webtransport"),ji(H6()),ji(H6()),ji(ir())),cI=jo(Qpe,Jpe,vi(Jk,ji(ir())),vi(Xpe,ji(ir())),vi(_d,ji(ir())),eme,tme,ir()),nme=vi(cI,di("p2p-circuit"),ir()),wF=m1(nme);jo(vi(cI,di("p2p-circuit"),di("webrtc"),ji(ir())),vi(cI,di("webrtc"),ji(ir())),vi(di("webrtc"),ji(ir())));jo(vi(_d,di("tcp"),fb(),di("http"),ji(ir())),vi(_d,di("http"),ji(ir())));jo(vi(_d,di("tcp"),jo(vi(di("443"),di("http")),vi(fb(),di("https")),vi(fb(),di("tls"),di("http"))),ji(ir())),vi(_d,di("tls"),di("http"),ji(ir())),vi(_d,di("https"),ji(ir())));jo(vi(di("memory"),p1(),ji(ir())));jo(vi(di("unix"),p1(),ji(ir())));function SF(n){try{const{address:e}=n.nodeAddress();return!!E7(e)}catch{return!0}}function ime(n,e){const t=SF(n.multiaddr),i=SF(e.multiaddr);return t&&!i?1:!t&&i?-1:0}function rme(n,e){return n.isCertified&&!e.isCertified?-1:!n.isCertified&&e.isCertified?1:0}function sme(n,e){const t=wF.exactMatch(n.multiaddr),i=wF.exactMatch(e.multiaddr);return t&&!i?1:!t&&i?-1:0}function tL(n,e){const t=ime(n,e);if(t!==0)return t;const i=sme(n,e);return i!==0?i:rme(n,e)}class er extends Event{constructor(t,i){super(t);E(this,"type");E(this,"detail");this.type=t,this.detail=i}}class ZY extends AggregateError{constructor(){super(...arguments);E(this,"name","DNSQueryFailedError")}}E(ZY,"name","DNSQueryFailedError");var YY={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(t=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function s(l,c,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new r(u,h||l,p),y=t?t+c:c;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],m]:l._events[y].push(m):(l._events[y]=m,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new i:delete l._events[c]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],u,h;if(this._eventsCount===0)return c;for(h in u=this._events)e.call(u,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},a.prototype.listeners=function(c){var u=t?t+c:c,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,m=h.length,y=new Array(m);p<m;p++)y[p]=h[p].fn;return y},a.prototype.listenerCount=function(c){var u=t?t+c:c,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(c,u,h,p,m,y){var b=t?t+c:c;if(!this._events[b])return!1;var w=this._events[b],v=arguments.length,T,S;if(w.fn){switch(w.once&&this.removeListener(c,w.fn,void 0,!0),v){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,u),!0;case 3:return w.fn.call(w.context,u,h),!0;case 4:return w.fn.call(w.context,u,h,p),!0;case 5:return w.fn.call(w.context,u,h,p,m),!0;case 6:return w.fn.call(w.context,u,h,p,m,y),!0}for(S=1,T=new Array(v-1);S<v;S++)T[S-1]=arguments[S];w.fn.apply(w.context,T)}else{var M=w.length,P;for(S=0;S<M;S++)switch(w[S].once&&this.removeListener(c,w[S].fn,void 0,!0),v){case 1:w[S].fn.call(w[S].context);break;case 2:w[S].fn.call(w[S].context,u);break;case 3:w[S].fn.call(w[S].context,u,h);break;case 4:w[S].fn.call(w[S].context,u,h,p);break;default:if(!T)for(P=1,T=new Array(v-1);P<v;P++)T[P-1]=arguments[P];w[S].fn.apply(w[S].context,T)}}return!0},a.prototype.on=function(c,u,h){return s(this,c,u,h,!1)},a.prototype.once=function(c,u,h){return s(this,c,u,h,!0)},a.prototype.removeListener=function(c,u,h,p){var m=t?t+c:c;if(!this._events[m])return this;if(!u)return o(this,m),this;var y=this._events[m];if(y.fn)y.fn===u&&(!p||y.once)&&(!h||y.context===h)&&o(this,m);else{for(var b=0,w=[],v=y.length;b<v;b++)(y[b].fn!==u||p&&!y[b].once||h&&y[b].context!==h)&&w.push(y[b]);w.length?this._events[m]=w.length===1?w[0]:w:o(this,m)}return this},a.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&o(this,u)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(YY);var ome=YY.exports;const XY=wc(ome);let ame=class QY extends Error{constructor(t,i){super(t,i);E(this,"name","TimeoutError");Error.captureStackTrace?.(this,QY)}};const EF=n=>n.reason??new DOMException("This operation was aborted.","AbortError");function lme(n,e){const{milliseconds:t,fallback:i,message:r,customTimers:s={setTimeout,clearTimeout},signal:o}=e;let a,l;const u=new Promise((h,p)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(o?.aborted){p(EF(o));return}if(o&&(l=()=>{p(EF(o))},o.addEventListener("abort",l,{once:!0})),n.then(h,p),t===Number.POSITIVE_INFINITY)return;const m=new ame;a=s.setTimeout.call(void 0,()=>{if(i){try{h(i())}catch(y){p(y)}return}typeof n.cancel=="function"&&n.cancel(),r===!1?h():r instanceof Error?p(r):(m.message=r??`Promise timed out after ${t} milliseconds`,p(m))},t)}).finally(()=>{u.clear(),l&&o&&o.removeEventListener("abort",l)});return u.clear=()=>{s.clearTimeout.call(void 0,a),a=void 0},u}function cme(n,e,t){let i=0,r=n.length;for(;r>0;){const s=Math.trunc(r/2);let o=i+s;t(n[o],e)<=0?(i=++o,r-=s+1):r=s}return i}var Kl,J$;let ume=(J$=class{constructor(){$t(this,Kl,[])}enqueue(e,t){const{priority:i=0,id:r}=t??{},s={priority:i,id:r,run:e};if(this.size===0||ze(this,Kl)[this.size-1].priority>=i){ze(this,Kl).push(s);return}const o=cme(ze(this,Kl),s,(a,l)=>l.priority-a.priority);ze(this,Kl).splice(o,0,s)}setPriority(e,t){const i=ze(this,Kl).findIndex(s=>s.id===e);if(i===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[r]=ze(this,Kl).splice(i,1);this.enqueue(r.run,{priority:t,id:e})}dequeue(){return ze(this,Kl).shift()?.run}filter(e){return ze(this,Kl).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ze(this,Kl).length}},Kl=new WeakMap,J$);var Vy,$c,Hu,Hy,$y,Gy,Gf,Wb,Wy,$u,sd,cs,Kb,Ao,ym,od,EE,xm,TE,JY,AE,eX,CE,tX,ME,nX,RE,iX,qb,uI,Zb,hI,IE,rX,Ky,bS,Yb,dI,Xb,fI,qy,_S,ad,Hp,NE,sX,vm,Zv,Qb,pI,eG;let hme=(eG=class extends XY{constructor(t){super();$t(this,TE);$t(this,AE);$t(this,CE);$t(this,ME);$t(this,RE);$t(this,qb);$t(this,Zb);$t(this,IE);$t(this,Ky);$t(this,Yb);$t(this,Xb);$t(this,qy);$t(this,ad);$t(this,NE);$t(this,vm);$t(this,Qb);$t(this,Vy,void 0);$t(this,$c,void 0);$t(this,Hu,0);$t(this,Hy,void 0);$t(this,$y,!1);$t(this,Gy,!1);$t(this,Gf,void 0);$t(this,Wb,0);$t(this,Wy,0);$t(this,$u,void 0);$t(this,sd,void 0);$t(this,cs,void 0);$t(this,Kb,void 0);$t(this,Ao,0);$t(this,ym,void 0);$t(this,od,void 0);$t(this,EE,1n);$t(this,xm,new Map);E(this,"timeout");if(t={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:ume,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap?.toString()??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval?.toString()??""}\` (${typeof t.interval})`);if(On(this,Vy,t.carryoverIntervalCount??t.carryoverConcurrencyCount??!1),On(this,$c,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),On(this,Hy,t.intervalCap),On(this,Gf,t.interval),On(this,cs,new t.queueClass),On(this,Kb,t.queueClass),this.concurrency=t.concurrency,t.timeout!==void 0&&!(Number.isFinite(t.timeout)&&t.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${t.timeout}\` (${typeof t.timeout})`);this.timeout=t.timeout,On(this,od,t.autoStart===!1),rn(this,NE,sX).call(this)}get concurrency(){return ze(this,ym)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);On(this,ym,t),rn(this,qy,_S).call(this)}setPriority(t,i){if(typeof i!="number"||!Number.isFinite(i))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${i}\` (${typeof i})`);ze(this,cs).setPriority(t,i)}async add(t,i={}){return i.id??(i.id=(wu(this,EE)._++).toString()),i={timeout:this.timeout,...i},new Promise((r,s)=>{const o=Symbol(`task-${i.id}`);ze(this,cs).enqueue(async()=>{wu(this,Ao)._++,ze(this,xm).set(o,{id:i.id,priority:i.priority??0,startTime:Date.now(),timeout:i.timeout});let a;try{try{i.signal?.throwIfAborted()}catch(u){throw ze(this,$c)||wu(this,Hu)._--,ze(this,xm).delete(o),u}let l=t({signal:i.signal});if(i.timeout&&(l=lme(Promise.resolve(l),{milliseconds:i.timeout,message:`Task timed out after ${i.timeout}ms (queue has ${ze(this,Ao)} running, ${ze(this,cs).size} waiting)`})),i.signal){const{signal:u}=i;l=Promise.race([l,new Promise((h,p)=>{a=()=>{p(u.reason)},u.addEventListener("abort",a,{once:!0})})])}const c=await l;r(c),this.emit("completed",c)}catch(l){s(l),this.emit("error",l)}finally{a&&i.signal?.removeEventListener("abort",a),ze(this,xm).delete(o),queueMicrotask(()=>{rn(this,CE,tX).call(this)})}},i),this.emit("add"),rn(this,Ky,bS).call(this)})}async addAll(t,i){return Promise.all(t.map(async r=>this.add(r,i)))}start(){return ze(this,od)?(On(this,od,!1),rn(this,qy,_S).call(this),this):this}pause(){On(this,od,!0)}clear(){On(this,cs,new(ze(this,Kb))),rn(this,Qb,pI).call(this)}async onEmpty(){ze(this,cs).size!==0&&await rn(this,ad,Hp).call(this,"empty")}async onSizeLessThan(t){ze(this,cs).size<t||await rn(this,ad,Hp).call(this,"next",()=>ze(this,cs).size<t)}async onIdle(){ze(this,Ao)===0&&ze(this,cs).size===0||await rn(this,ad,Hp).call(this,"idle")}async onPendingZero(){ze(this,Ao)!==0&&await rn(this,ad,Hp).call(this,"pendingZero")}async onRateLimit(){this.isRateLimited||await rn(this,ad,Hp).call(this,"rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await rn(this,ad,Hp).call(this,"rateLimitCleared")}async onError(){return new Promise((t,i)=>{const r=s=>{this.off("error",r),i(s)};this.on("error",r)})}get size(){return ze(this,cs).size}sizeBy(t){return ze(this,cs).filter(t).length}get pending(){return ze(this,Ao)}get isPaused(){return ze(this,od)}get isRateLimited(){return ze(this,$y)}get isSaturated(){return ze(this,Ao)===ze(this,ym)&&ze(this,cs).size>0||this.isRateLimited&&ze(this,cs).size>0}get runningTasks(){return[...ze(this,xm).values()].map(t=>({...t}))}},Vy=new WeakMap,$c=new WeakMap,Hu=new WeakMap,Hy=new WeakMap,$y=new WeakMap,Gy=new WeakMap,Gf=new WeakMap,Wb=new WeakMap,Wy=new WeakMap,$u=new WeakMap,sd=new WeakMap,cs=new WeakMap,Kb=new WeakMap,Ao=new WeakMap,ym=new WeakMap,od=new WeakMap,EE=new WeakMap,xm=new WeakMap,TE=new WeakSet,JY=function(){return ze(this,$c)||ze(this,Hu)<ze(this,Hy)},AE=new WeakSet,eX=function(){return ze(this,Ao)<ze(this,ym)},CE=new WeakSet,tX=function(){wu(this,Ao)._--,ze(this,Ao)===0&&this.emit("pendingZero"),rn(this,Ky,bS).call(this),this.emit("next")},ME=new WeakSet,nX=function(){rn(this,Xb,fI).call(this),rn(this,Yb,dI).call(this),On(this,sd,void 0)},RE=new WeakSet,iX=function(){const t=Date.now();if(ze(this,$u)===void 0){const i=ze(this,Wb)-t;if(i<0){if(ze(this,Wy)>0){const r=t-ze(this,Wy);if(r<ze(this,Gf))return rn(this,qb,uI).call(this,ze(this,Gf)-r),!0}On(this,Hu,ze(this,Vy)?ze(this,Ao):0)}else return rn(this,qb,uI).call(this,i),!0}return!1},qb=new WeakSet,uI=function(t){ze(this,sd)===void 0&&On(this,sd,setTimeout(()=>{rn(this,ME,nX).call(this)},t))},Zb=new WeakSet,hI=function(){ze(this,$u)&&(clearInterval(ze(this,$u)),On(this,$u,void 0))},IE=new WeakSet,rX=function(){ze(this,sd)&&(clearTimeout(ze(this,sd)),On(this,sd,void 0))},Ky=new WeakSet,bS=function(){if(ze(this,cs).size===0)return rn(this,Zb,hI).call(this),this.emit("empty"),ze(this,Ao)===0&&(rn(this,IE,rX).call(this),this.emit("idle")),!1;let t=!1;if(!ze(this,od)){const i=!ze(this,RE,iX);if(ze(this,TE,JY)&&ze(this,AE,eX)){const r=ze(this,cs).dequeue();ze(this,$c)||(wu(this,Hu)._++,rn(this,vm,Zv).call(this)),this.emit("active"),On(this,Wy,Date.now()),r(),i&&rn(this,Yb,dI).call(this),t=!0}}return t},Yb=new WeakSet,dI=function(){ze(this,$c)||ze(this,$u)!==void 0||(On(this,$u,setInterval(()=>{rn(this,Xb,fI).call(this)},ze(this,Gf))),On(this,Wb,Date.now()+ze(this,Gf)))},Xb=new WeakSet,fI=function(){ze(this,Hu)===0&&ze(this,Ao)===0&&ze(this,$u)&&rn(this,Zb,hI).call(this),On(this,Hu,ze(this,Vy)?ze(this,Ao):0),rn(this,qy,_S).call(this),rn(this,vm,Zv).call(this)},qy=new WeakSet,_S=function(){for(;rn(this,Ky,bS).call(this););},ad=new WeakSet,Hp=async function(t,i){return new Promise(r=>{const s=()=>{i&&!i()||(this.off(t,s),r())};this.on(t,s)})},NE=new WeakSet,sX=function(){ze(this,$c)||(this.on("add",()=>{ze(this,cs).size>0&&rn(this,vm,Zv).call(this)}),this.on("next",()=>{rn(this,vm,Zv).call(this)}))},vm=new WeakSet,Zv=function(){ze(this,$c)||ze(this,Gy)||(On(this,Gy,!0),queueMicrotask(()=>{On(this,Gy,!1),rn(this,Qb,pI).call(this)}))},Qb=new WeakSet,pI=function(){const t=ze(this,$y),i=!ze(this,$c)&&ze(this,Hu)>=ze(this,Hy)&&ze(this,cs).size>0;i!==t&&(On(this,$y,i),this.emit(i?"rateLimit":"rateLimitCleared"))},eG);function oX(n){const e=[I0.A];return n==null?e:Array.isArray(n)?n.length===0?e:n:[n]}const aX=60;function lX(n){return{Status:n.Status??0,TC:n.TC??n.flag_tc??!1,RD:n.RD??n.flag_rd??!1,RA:n.RA??n.flag_ra??!1,AD:n.AD??n.flag_ad??!1,CD:n.CD??n.flag_cd??!1,Question:(n.Question??n.questions??[]).map(e=>({name:e.name,type:I0[e.type]})),Answer:(n.Answer??n.answers??[]).map(e=>({name:e.name,type:I0[e.type],TTL:e.TTL??e.ttl??aX,data:e.data instanceof Uint8Array?Vt(e.data):e.data}))}}const dme=4;function TF(n,e={}){const t=new hme({concurrency:e.queryConcurrency??dme});return async(i,r={})=>{const s=new URLSearchParams;s.set("name",i),oX(r.types).forEach(a=>{s.append("type",I0[a])}),r.onProgress?.(new er("dns:query",i));const o=await t.add(async()=>{const a=await fetch(`${n}?${s}`,{headers:{accept:"application/dns-json"},signal:r?.signal});if(a.status!==200)throw new Error(`Unexpected HTTP status: ${a.status} - ${a.statusText}`);const l=lX(await a.json());return r.onProgress?.(new er("dns:response",l)),l},{signal:r.signal});if(o==null)throw new Error("No DNS response received");return o}}function fme(){return[TF("https://cloudflare-dns.com/dns-query"),TF("https://dns.google/resolve")]}var pme=function(n){if(!n)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),i=Object.create(null);function r(s,o){t[s]=o,e++,e>=n&&(e=0,i=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||i[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),i[s]!==void 0&&(i[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=i[s])!==void 0)return r(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:r(s,o)},clear:function(){t=Object.create(null),i=Object.create(null)}}};const cX=wc(pme);class mme{constructor(e){E(this,"lru");this.lru=cX(e)}get(e,t){let i=!0;const r=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){i=!1;break}r.push(...o)}if(i)return lX({answers:r})}getAnswers(e,t){const i=`${e.toLowerCase()}-${t}`,r=this.lru.get(i);if(r!=null){const s=r.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:I0[a.type]}));return s.length===0&&this.lru.remove(i),s}return[]}add(e,t){const i=`${e.toLowerCase()}-${t.type}`,r=this.lru.get(i)??[];r.push({expires:Date.now()+(t.TTL??aX)*1e3,value:t}),this.lru.set(i,r)}remove(e,t){const i=`${e.toLowerCase()}-${t}`;this.lru.remove(i)}clear(){this.lru.clear()}}function gme(n){return new mme(n)}const yme=1e3;let xme=class{constructor(e){E(this,"resolvers");E(this,"cache");this.resolvers={},this.cache=gme(e.cacheSize??yme),Object.entries(e.resolvers??{}).forEach(([t,i])=>{Array.isArray(i)||(i=[i]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=i}),this.resolvers["."]==null&&(this.resolvers["."]=fme())}async query(e,t={}){const i=oX(t.types),r=t.cached!==!1?this.cache.get(e,i):void 0;if(r!=null)return t.onProgress?.(new er("dns:cache",r)),r;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const l of o){if(t.signal?.aborted===!0)break;try{const c=await l(e,{...t,types:i});for(const u of c.Answer)this.cache.add(e,u);return c}catch(c){a.push(c),t.onProgress?.(new er("dns:error",c))}}throw new ZY(a,`DNS lookup of ${e} ${i} failed`)}};var I0;(function(n){n[n.A=1]="A",n[n.CNAME=5]="CNAME",n[n.TXT=16]="TXT",n[n.AAAA=28]="AAAA"})(I0||(I0={}));function vme(n={}){return new xme(n)}const cl=-1,mI={},gI={},bme=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,cl,"ip6zone"],[43,8,"ipcidr"],[53,cl,"dns",!0],[54,cl,"dns4",!0],[55,cl,"dns6",!0],[56,cl,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,cl,"unix",!1,!0],[421,cl,"ipfs"],[421,cl,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,cl,"garlic64"],[448,0,"tls"],[449,cl,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,cl,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,cl,"http-path"],[777,cl,"memory"]];bme.forEach(n=>{const e=_me(...n);gI[e.code]=e,mI[e.name]=e});function _me(n,e,t,i,r){return{code:n,size:e,name:t,resolvable:!!i,path:!!r}}function wme(n){if(typeof n=="number"){if(gI[n]!=null)return gI[n];throw new Error(`no protocol with code: ${n}`)}else if(typeof n=="string"){if(mI[n]!=null)return mI[n];throw new Error(`no protocol with name: ${n}`)}throw new Error(`invalid protocol id type: ${typeof n}`)}const Sme=32,{code:Eme}=wme("dnsaddr");class Tme extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const nL=async function(e,t={}){const i=t.maxRecursiveDepth??Sme;if(i===0)throw new Tme("Max recursive depth reached");const[,r]=e.stringTuples().find(([c])=>c===Eme)??[],o=await(t?.dns??vme()).query(`_dnsaddr.${r}`,{signal:t?.signal,types:[I0.TXT]}),a=e.getPeerId(),l=[];for(const c of o.Answer){const u=c.data.replace(/["']/g,"").trim().split("=")[1];if(u==null||a!=null&&!u.includes(a))continue;const h=zi(u);if(u.startsWith("/dnsaddr")){const p=await h.resolve({...t,maxRecursiveDepth:i-1});l.push(...p.map(m=>m.toString()))}else l.push(h.toString())}return l};var Ame=n=>{if(Object.prototype.toString.call(n)!=="[object Object]")return!1;const e=Object.getPrototypeOf(n);return e===null||e===Object.prototype};const $6=Ame,{hasOwnProperty:uX}=Object.prototype,{propertyIsEnumerable:Cme}=Object,C2=(n,e,t)=>Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0}),Mme=$E,AF={concatArrays:!1,ignoreUndefined:!1},R7=n=>{const e=[];for(const t in n)uX.call(n,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(n);for(const i of t)Cme.call(n,i)&&e.push(i)}return e};function lx(n){return Array.isArray(n)?Rme(n):$6(n)?Ime(n):n}function Rme(n){const e=n.slice(0,0);return R7(n).forEach(t=>{C2(e,t,lx(n[t]))}),e}function Ime(n){const e=Object.getPrototypeOf(n)===null?Object.create(null):{};return R7(n).forEach(t=>{C2(e,t,lx(n[t]))}),e}const hX=(n,e,t,i)=>(t.forEach(r=>{typeof e[r]>"u"&&i.ignoreUndefined||(r in n&&n[r]!==Object.getPrototypeOf(n)?C2(n,r,yI(n[r],e[r],i)):C2(n,r,lx(e[r])))}),n),Nme=(n,e,t)=>{let i=n.slice(0,0),r=0;return[n,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)uX.call(s,a)&&(o.push(String(a)),s===n?C2(i,r++,s[a]):C2(i,r++,lx(s[a])));i=hX(i,s,R7(s).filter(a=>!o.includes(a)),t)}),i};function yI(n,e,t){return t.concatArrays&&Array.isArray(n)&&Array.isArray(e)?Nme(n,e,t):!$6(e)||!$6(n)?lx(e):hX(n,e,R7(e),t)}var Pme=function(...n){const e=yI(lx(AF),this!==Mme&&this||{},AF);let t={_:{}};for(const i of n)if(i!==void 0){if(!$6(i))throw new TypeError("`"+i+"` is not an Option Object");t=yI(t,{_:i},e)}return t._};const dX=wc(Pme);var M2;(function(n){n.NOT_STARTED_YET="The libp2p node is not started yet",n.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",n.NOT_FOUND="Not found"})(M2||(M2={}));var wn;(function(n){n.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",n.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",n.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",n.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",n.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",n.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",n.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",n.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",n.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",n.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",n.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",n.ERR_DIALED_SELF="ERR_DIALED_SELF",n.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",n.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",n.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",n.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",n.ERR_INVALID_KEY="ERR_INVALID_KEY",n.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",n.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",n.ERR_INVALID_PEER="ERR_INVALID_PEER",n.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",n.ERR_NOT_FOUND="ERR_NOT_FOUND",n.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",n.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",n.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",n.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",n.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",n.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",n.ERR_FIND_SELF="ERR_FIND_SELF",n.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",n.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",n.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",n.ERR_INVALID_CMS="ERR_INVALID_CMS",n.ERR_MISSING_KEYS="ERR_MISSING_KEYS",n.ERR_NO_KEY="ERR_NO_KEY",n.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",n.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",n.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",n.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",n.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",n.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",n.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",n.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",n.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",n.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",n.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",n.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",n.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",n.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",n.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",n.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",n.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",n.ERR_INVALID_RECORD="ERR_INVALID_RECORD",n.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",n.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",n.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",n.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",n.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",n.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"})(wn||(wn={}));const kme={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:n=>n},connectionManager:{resolvers:{dnsaddr:nL},addressSorter:tL},transportManager:{faultTolerance:Ty.FATAL_ALL}};async function Lme(n){const e=dX(kme,n);if(e.connectionProtector===null&&globalThis.process?.env?.LIBP2P_FORCE_PNET!=null)throw new Se(M2.ERR_PROTECTOR_REQUIRED,wn.ERR_PROTECTOR_REQUIRED);if(e.privateKey!=null&&!(await jd(e.privateKey.public.bytes,e.privateKey.bytes)).equals(e.peerId))throw new Se("Private key doesn't match peer id",wn.ERR_INVALID_KEY);return e}const CF=()=>{const n=new Error("Delay aborted");return n.name="AbortError",n},Dme=new WeakMap;function Ome({clearTimeout:n,setTimeout:e}={}){return(t,{value:i,signal:r}={})=>{if(r?.aborted)return Promise.reject(CF());let s,o,a;const l=n??clearTimeout,c=()=>{l(s),a(CF())},u=()=>{r&&r.removeEventListener("abort",c)},h=new Promise((p,m)=>{o=()=>{u(),p(i)},a=m,s=(e??setTimeout)(o,t)});return r&&r.addEventListener("abort",c,{once:!0}),Dme.set(h,()=>{l(s),s=null,o()}),h}}const Bme=Ome();class fX{constructor(e={}){E(this,"memoryStorage");E(this,"points");E(this,"duration");E(this,"blockDuration");E(this,"execEvenly");E(this,"execEvenlyMinDelayMs");E(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new Ume}async consume(e,t=1,i={}){const r=this.getKey(e),s=this._getKeySecDuration(i);let o=this.memoryStorage.incrby(r,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(r,o.consumedPoints,this.blockDuration)),new Se("Rate limit exceeded","ERR_RATE_LIMIT_EXCEEDED",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await Bme(a)}return o}penalty(e,t=1,i={}){const r=this.getKey(e),s=this._getKeySecDuration(i),o=this.memoryStorage.incrby(r,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,i={}){const r=this.getKey(e),s=this._getKeySecDuration(i),o=this.memoryStorage.incrby(r,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const i=t*1e3,r=this.points+1;return this.memoryStorage.set(this.getKey(e),r,t),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:r,isFirstInDuration:!1}}set(e,t,i=0){const r=(i>=0?i:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,i),{remainingPoints:0,msBeforeNext:r===0?-1:r,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class Ume{constructor(){E(this,"storage");this.storage=new Map}incrby(e,t,i){const r=this.storage.get(e);if(r!=null){const s=r.expiresAt!=null?r.expiresAt.getTime()-new Date().getTime():-1;return r.expiresAt==null||s>0?(r.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:r.value,isFirstInDuration:!1}):this.set(e,t,i)}return this.set(e,t,i)}set(e,t,i){const r=i*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:r>0?new Date(Date.now()+r):void 0};return this.storage.set(e,o),r>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},r),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:r===0?-1:r,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}function pX(n){if(QK(n))return{peerId:n,multiaddrs:[]};Array.isArray(n)||(n=[n]);let e;if(n.length>0){const t=n[0].getPeerId();e=t==null?void 0:Bi(t),n.forEach(i=>{if(!S7(i))throw new Se("Invalid Multiaddr",wn.ERR_INVALID_MULTIADDR);const r=i.getPeerId();if(r==null){if(e!=null)throw new Se("Multiaddrs must all have the same peer id or have no peer id",wn.ERR_INVALID_PARAMETERS)}else{const s=Bi(r);if(e?.equals(s)!==!0)throw new Se("Multiaddrs must all have the same peer id or have no peer id",wn.ERR_INVALID_PARAMETERS)}})}return{peerId:e,multiaddrs:n}}let MF=class extends Error{constructor(t,i,r){super(t??"The operation was aborted");E(this,"type");E(this,"code");this.type="aborted",this.name=r??"AbortError",this.code=i??"ABORT_ERR"}};async function eu(n,e,t){if(e==null)return n;if(e.aborted)return n.catch(()=>{}),Promise.reject(new MF(t?.errorMessage,t?.errorCode,t?.errorName));let i;const r=new MF(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([n,new Promise((s,o)=>{i=()=>{o(r)},e.addEventListener("abort",i)})])}finally{i!=null&&e.removeEventListener("abort",i)}}let Fme=class{constructor(e){E(this,"deferred");E(this,"signal");this.signal=e,this.deferred=Ki(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new ck)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function zme(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let jme=class{constructor(e,t){E(this,"id");E(this,"fn");E(this,"options");E(this,"recipients");E(this,"status");E(this,"timeline");E(this,"controller");this.id=zme(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,tr(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,i)=>t&&i.signal?.aborted===!0,!0)&&(this.controller.abort(new ck),this.cleanup())}async join(e={}){const t=new Fme(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await eu(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}},iL=class extends yc{constructor(t={}){super();E(this,"concurrency");E(this,"queue");E(this,"pending");E(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&t.metrics?.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=t.sort,this.queue=[]}tryToStartAnother(){if(this.size===0)return queueMicrotask(()=>{this.safeDispatchEvent("empty")}),this.running===0&&queueMicrotask(()=>{this.safeDispatchEvent("idle")}),!1;if(this.pending<this.concurrency){let t;for(const i of this.queue)if(i.status==="queued"){t=i;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let i=0;i<this.queue.length;i++)if(this.queue[i]===t){this.queue.splice(i,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,i){i?.signal?.throwIfAborted();const r=new jme(t,i);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(i).then(s=>(this.safeDispatchEvent("completed",{detail:s}),this.safeDispatchEvent("success",{detail:{job:r,result:s}}),s)).catch(s=>{if(r.status==="queued"){for(let o=0;o<this.queue.length;o++)if(this.queue[o]===r){this.queue.splice(o,1);break}}throw this.safeDispatchEvent("error",{detail:s}),this.safeDispatchEvent("failure",{detail:{job:r,error:s}}),s})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new ck)}),this.clear()}async onEmpty(t){this.size!==0&&await Cm(this,"empty",t?.signal)}async onSizeLessThan(t,i){this.size<t||await Cm(this,"next",i?.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Cm(this,"idle",t?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){t?.signal?.throwIfAborted();const i=vc({objectMode:!0}),r=c=>{c!=null?this.abort():this.clear(),i.end(c)},s=c=>{c.detail!=null&&i.push(c.detail)},o=c=>{r(c.detail)},a=()=>{r()},l=()=>{r(new Se("Queue aborted","ERR_QUEUE_ABORTED"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),t?.signal?.addEventListener("abort",l);try{yield*i}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),t?.signal?.removeEventListener("abort",l),r()}}},mX=class extends iL{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}};const gX=5e3,Vme=2e3,yX=25,Hme=5e3,xX=25,vX=0,bX=100,_X=10,$me=5,Gme=10,wX="last-dial-failure",SX=500,EX=5,TX=100,AX=50,CX=1e3*60*7,bp={minConnections:EX,maxQueueLength:bX,autoDialConcurrency:xX,autoDialPriority:vX,autoDialInterval:Hme,autoDialPeerRetryThreshold:CX,autoDialDiscoveredPeersDebounce:_X};class Wme{constructor(e,t){E(this,"connectionManager");E(this,"peerStore");E(this,"queue");E(this,"minConnections");E(this,"autoDialPriority");E(this,"autoDialIntervalMs");E(this,"autoDialMaxQueueLength");E(this,"autoDialPeerRetryThresholdMs");E(this,"autoDialDiscoveredPeersDebounce");E(this,"autoDialInterval");E(this,"started");E(this,"running");E(this,"log");this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.minConnections=t.minConnections??bp.minConnections,this.autoDialPriority=t.autoDialPriority??bp.autoDialPriority,this.autoDialIntervalMs=t.autoDialInterval??bp.autoDialInterval,this.autoDialMaxQueueLength=t.maxQueueLength??bp.maxQueueLength,this.autoDialPeerRetryThresholdMs=t.autoDialPeerRetryThreshold??bp.autoDialPeerRetryThreshold,this.autoDialDiscoveredPeersDebounce=t.autoDialDiscoveredPeersDebounce??bp.autoDialDiscoveredPeersDebounce,this.log=e.logger.forComponent("libp2p:connection-manager:auto-dial"),this.started=!1,this.running=!1,this.queue=new mX({concurrency:t.autoDialConcurrency??bp.autoDialConcurrency,metricName:"libp2p_autodial_queue",metrics:e.metrics}),this.queue.addEventListener("error",r=>{this.log.error("error during auto-dial",r.detail)}),e.events.addEventListener("connection:close",()=>{this.autoDial().catch(r=>{this.log.error(r)})});let i;e.events.addEventListener("peer:discovery",()=>{clearTimeout(i),i=setTimeout(()=>{this.autoDial().catch(r=>{this.log.error(r)})},this.autoDialDiscoveredPeersDebounce)})}isStarted(){return this.started}start(){this.started=!0}afterStart(){this.autoDial().catch(e=>{this.log.error("error while autodialing",e)})}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started||this.running)return;const e=this.connectionManager.getConnectionsMap(),t=e.size;if(t>=this.minConnections){this.minConnections>0&&this.log.trace("have enough connections %d/%d",t,this.minConnections);return}if(this.queue.size>this.autoDialMaxQueueLength){this.log("not enough connections %d/%d but auto dial queue is full",t,this.minConnections),this.sheduleNextAutodial();return}this.running=!0,this.log("not enough connections %d/%d - will dial peers to increase the number of connections",t,this.minConnections);const i=new $k(this.connectionManager.getDialQueue().map(c=>c.peerId).filter(Boolean)),r=await this.peerStore.all({filters:[c=>c.addresses.length===0?(this.log.trace("not autodialing %p because they have no addresses",c.id),!1):e.has(c.id)?(this.log.trace("not autodialing %p because they are already connected",c.id),!1):i.has(c.id)?(this.log.trace("not autodialing %p because they are already being dialed",c.id),!1):this.queue.has(c.id)?(this.log.trace("not autodialing %p because they are already being autodialed",c.id),!1):!0]}),s=r.sort(()=>Math.random()>.5?1:-1),o=new w7;for(const c of s)o.has(c.id)||o.set(c.id,[...c.tags.values()].reduce((u,h)=>u+h.value,0));const l=s.sort((c,u)=>{const h=o.get(c.id)??0,p=o.get(u.id)??0;return h>p?-1:h<p?1:0}).filter(c=>{const u=c.metadata.get(wX);if(u==null)return!0;const h=parseInt(Vt(u));return isNaN(h)?!0:Date.now()-h>this.autoDialPeerRetryThresholdMs});this.log("selected %d/%d peers to dial",l.length,r.length);for(const c of l)this.queue.add(async()=>{const u=this.connectionManager.getConnectionsMap().size;if(u>=this.minConnections){this.log("got enough connections now %d/%d",u,this.minConnections),this.queue.clear();return}this.log("connecting to a peerStore stored peer %p",c.id),await this.connectionManager.openConnection(c.id,{priority:this.autoDialPriority})},{peerId:c.id}).catch(u=>{this.log.error("could not connect to peerStore stored peer",u)});this.running=!1,this.sheduleNextAutodial()}sheduleNextAutodial(){this.started&&(this.autoDialInterval=setTimeout(()=>{this.autoDial().catch(e=>{this.log.error("error while autodialing",e)})},this.autoDialIntervalMs))}}const Kme=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function qme(n,e){const t=n?.streams?.map(r=>r.protocol)??[],i=e?.closableProtocols??Kme;if(!(t.filter(r=>r!=null&&!i.includes(r)).length>0))try{await n?.close(e)}catch(r){n?.abort(r)}}const RF={maxConnections:TX,allow:[]};class Zme{constructor(e,t={}){E(this,"maxConnections");E(this,"connectionManager");E(this,"peerStore");E(this,"allow");E(this,"events");E(this,"log");this.maxConnections=t.maxConnections??RF.maxConnections,this.allow=t.allow??RF.allow,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),e.events.addEventListener("connection:open",()=>{this.maybePruneConnections().catch(i=>{this.log.error(i)})})}async maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length;if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;const i=new w7;for(const a of e){const l=a.remotePeer;if(!i.has(l)){i.set(l,0);try{const c=await this.peerStore.get(l);i.set(l,[...c.tags.values()].reduce((u,h)=>u+h.value,0))}catch(c){c.code!=="ERR_NOT_FOUND"&&this.log.error("error loading peer tags",c)}}}const r=this.sortConnections(e,i),s=Math.max(t-this.maxConnections,0),o=[];for(const a of r)if(this.log("too many connections open - closing a connection to %p",a.remotePeer),this.allow.some(c=>a.remoteAddr.toString().startsWith(c.toString()))||o.push(a),o.length===s)break;await Promise.all(o.map(async a=>{await qme(a,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:o})}sortConnections(e,t){return e.sort((i,r)=>{const s=i.timeline.open,o=r.timeline.open;return s<o?1:s>o?-1:0}).sort((i,r)=>i.direction==="outbound"&&r.direction==="inbound"?1:i.direction==="inbound"&&r.direction==="outbound"?-1:0).sort((i,r)=>i.streams.length>r.streams.length?1:i.streams.length<r.streams.length?-1:0).sort((i,r)=>{const s=t.get(i.remotePeer)??0,o=t.get(r.remotePeer)??0;return s>o?1:s<o?-1:0})}}let Yme=class extends iL{constructor(e={}){super({...e,sort:(t,i)=>t.options.priority>i.options.priority?-1:t.options.priority<i.options.priority?1:0})}};const Xme=n=>n.toString().split("/").slice(1),A_=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),fi=n=>({match:e=>A_(t=>t===n).match(e),pattern:n}),g1=()=>({match:n=>A_(e=>typeof e=="string").match(n),pattern:"{string}"}),pb=()=>({match:n=>A_(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),rr=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{Lr.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),G6=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{V0.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),Vi=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),Vo=(...n)=>({match:e=>{let t;for(const i of n){const r=i.match(e);r!==!1&&(t==null||r.length<t.length)&&(t=r)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),bi=(...n)=>({match:e=>{for(const t of n){const i=t.match(e);if(i===!1)return!1;e=i}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function y1(...n){function e(r){let s=Xme(r);for(const o of n){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(r){return e(r)!==!1}function i(r){const s=e(r);return s===!1?!1:s.length===0}return{matchers:n,matches:t,exactMatch:i}}const I7=bi(fi("dns4"),g1()),N7=bi(fi("dns6"),g1()),P7=bi(fi("dnsaddr"),g1()),rL=bi(fi("dns"),g1());y1(I7,Vi(rr()));y1(N7,Vi(rr()));y1(P7,Vi(rr()));y1(Vo(rL,P7,I7,N7),Vi(rr()));const Qme=bi(fi("ip4"),A_(pu)),Jme=bi(fi("ip6"),A_(G0)),MX=Vo(Qme,Jme),wd=Vo(MX,rL,I7,N7,P7);y1(Vo(MX,bi(Vo(rL,P7,I7,N7),Vi(rr()))));const sL=bi(wd,fi("tcp"),pb()),k7=bi(wd,fi("udp"),pb());y1(bi(sL,Vi(rr())));const RX=bi(k7,fi("quic"),Vi(rr())),oL=bi(k7,fi("quic-v1"),Vi(rr())),e1e=Vo(RX,oL),xI=Vo(wd,sL,k7,RX,oL),t1e=Vo(bi(xI,fi("ws"),Vi(rr()))),n1e=Vo(bi(xI,fi("wss"),Vi(rr())),bi(xI,fi("tls"),Vi(bi(fi("sni"),g1())),fi("ws"),Vi(rr()))),i1e=bi(k7,fi("webrtc-direct"),Vi(G6()),Vi(G6()),Vi(rr())),r1e=bi(oL,fi("webtransport"),Vi(G6()),Vi(G6()),Vi(rr())),vI=Vo(t1e,n1e,bi(sL,Vi(rr())),bi(e1e,Vi(rr())),bi(wd,Vi(rr())),i1e,r1e,rr()),s1e=bi(vI,fi("p2p-circuit"),rr()),o1e=y1(s1e);Vo(bi(vI,fi("p2p-circuit"),fi("webrtc"),Vi(rr())),bi(vI,fi("webrtc"),Vi(rr())),bi(fi("webrtc"),Vi(rr())));Vo(bi(wd,fi("tcp"),pb(),fi("http"),Vi(rr())),bi(wd,fi("http"),Vi(rr())));Vo(bi(wd,fi("tcp"),Vo(bi(fi("443"),fi("http")),bi(pb(),fi("https")),bi(pb(),fi("tls"),fi("http"))),Vi(rr())),bi(wd,fi("tls"),fi("http"),Vi(rr())),bi(wd,fi("https"),Vi(rr())));Vo(bi(fi("memory"),g1(),Vi(rr())));Vo(bi(fi("unix"),g1(),Vi(rr())));function N0(n){const e=new globalThis.AbortController;function t(){const s=n.filter(o=>o?.aborted===!0).map(o=>o?.reason).pop();e.abort(s);for(const o of n)o?.removeEventListener!=null&&o.removeEventListener("abort",t)}for(const s of n){if(s?.aborted===!0){t();break}s?.addEventListener!=null&&s.addEventListener("abort",t)}function i(){for(const s of n)s?.removeEventListener!=null&&s.removeEventListener("abort",t)}const r=e.signal;return r.clear=i,r}async function a1e(n,e){let t=!1;for(const r of Zk.keys())if(t=n.protoNames().includes(r),t)break;if(!t)return[n];const i=await n.resolve(e);return e.log("resolved %s to",n,i.map(r=>r.toString())),i}const dv={addressSorter:tL,maxParallelDials:AX,maxDialQueueLength:SX,maxPeerAddrsToDial:yX,dialTimeout:gX,resolvers:{dnsaddr:nL}};class l1e{constructor(e,t={}){E(this,"queue");E(this,"components");E(this,"addressSorter");E(this,"maxPeerAddrsToDial");E(this,"maxDialQueueLength");E(this,"dialTimeout");E(this,"shutDownController");E(this,"connections");E(this,"log");this.addressSorter=t.addressSorter??dv.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??dv.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??dv.maxDialQueueLength,this.dialTimeout=t.dialTimeout??dv.dialTimeout,this.connections=t.connections??new w7,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,tr(1/0,this.shutDownController.signal);for(const[i,r]of Object.entries(t.resolvers??{}))Zk.set(i,r);this.queue=new Yme({concurrency:t.maxParallelDials??dv.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",i=>{this.log.error("error in dial queue",i.detail)})}start(){this.shutDownController=new AbortController,tr(1/0,this.shutDownController.signal)}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){const{peerId:i,multiaddrs:r}=pX(e),s=Array.from(this.connections.values()).flat().find(a=>t.force===!0?!1:a.remotePeer.equals(i)?!0:r.find(l=>l.equals(a.remoteAddr)));if(s!=null)return this.log("already connected to %a",s.remoteAddr),t.onProgress?.(new er("dial-queue:already-connected")),s;const o=this.queue.queue.find(a=>{if(i?.equals(a.options.peerId)===!0)return!0;const l=a.options.multiaddrs;if(l==null)return!1;for(const c of r)if(l.has(c.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",i);for(const a of r)o.options.multiaddrs.add(a.toString());return t.onProgress?.(new er("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Se("Dial queue is full","ERR_DIAL_QUEUE_FULL");return this.log("creating dial target for %p",i,r.map(a=>a.toString())),t.onProgress?.(new er("dial-queue:add-to-dial-queue")),this.queue.add(async a=>{a?.onProgress?.(new er("dial-queue:start-dial"));const l=this.createDialAbortController(a?.signal);let c;try{c=await this.calculateMultiaddrs(i,a?.multiaddrs,{...a,signal:l}),a?.onProgress?.(new er("dial-queue:calculated-addresses",c)),c.map(({multiaddr:u})=>u.toString()).forEach(u=>{a?.multiaddrs.add(u)})}catch(u){throw l.clear(),u}try{let u=0;const h=[];for(const p of c){if(u===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",u,i),new Se("Peer had more than maxPeerAddrsToDial",wn.ERR_TOO_MANY_ADDRESSES);u++;try{const m=await this.components.transportManager.dial(p.multiaddr,{...a,signal:l});return this.log("dial to %a succeeded",p.multiaddr),m}catch(m){if(this.log.error("dial failed to %a",p.multiaddr,m),i!=null)try{await this.components.peerStore.patch(i,{metadata:{[wX]:Ut(Date.now().toString())}})}catch(y){this.log.error("could not update last dial failure key for %p",i,y)}if(l.aborted)throw new Se(m.message,tb);h.push(m)}}throw h.length===1?h[0]:new nce(h,"All multiaddr dials failed",wn.ERR_TRANSPORT_DIAL_FAILED)}finally{l.clear()}},{peerId:i,priority:t.priority??IX,multiaddrs:new Set(r.map(a=>a.toString())),signal:t.signal,onProgress:t.onProgress})}createDialAbortController(e){const t=N0([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,e]);return tr(1/0,t),t}async calculateMultiaddrs(e,t=new Set,i={}){const r=[...t].map(h=>({multiaddr:zi(h),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new Se("Tried to dial self",wn.ERR_DIALED_SELF);if(await this.components.connectionGater.denyDialPeer?.(e)===!0)throw new Se("The dial request is blocked by gater.allowDialPeer",wn.ERR_PEER_DIAL_INTERCEPTED);if(r.length===0){this.log("loading multiaddrs for %p",e);try{const h=await this.components.peerStore.get(e);r.push(...h.addresses),this.log("loaded multiaddrs for %p",e,r.map(({multiaddr:p})=>p.toString()))}catch(h){if(h.code!==wn.ERR_NOT_FOUND)throw h}}if(r.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const h=await this.components.peerRouting.findPeer(e);this.log("found multiaddrs for %p in the peer routing",e,r.map(({multiaddr:p})=>p.toString())),r.push(...h.multiaddrs.map(p=>({multiaddr:p,isCertified:!1})))}catch(h){h.code!==wn.ERR_NO_ROUTERS_AVAILABLE&&this.log.error("looking up multiaddrs for %p in the peer routing failed",e,h)}}}let s=(await Promise.all(r.map(async h=>{const p=await a1e(h.multiaddr,{dns:this.components.dns,...i,log:this.log});return p.length===1&&p[0].equals(h.multiaddr)?h:p.map(m=>({multiaddr:m,isCertified:!1}))}))).flat();if(e!=null){const h=`/p2p/${e.toString()}`;s=s.map(p=>p.multiaddr.protos().pop()?.path===!0?p:p.multiaddr.getPeerId()==null?{multiaddr:p.multiaddr.encapsulate(h),isCertified:p.isCertified}:p)}const o=s.filter(h=>{if(this.components.transportManager.dialTransportForMultiaddr(h.multiaddr)==null)return!1;const p=h.multiaddr.getPeerId();return e!=null&&p!=null?e.equals(p):!0}),a=new Map;for(const h of o){const p=h.multiaddr.toString(),m=a.get(p);if(m!=null){m.isCertified=m.isCertified||h.isCertified||!1;continue}a.set(p,h)}const l=[...a.values()];if(l.length===0)throw new Se("The dial request has no valid addresses",wn.ERR_NO_VALID_ADDRESSES);const c=[];for(const h of l)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(h.multiaddr)||c.push(h);const u=c.sort(this.addressSorter);if(u.length===0)throw new Se("The connection gater denied all addresses in the dial request",wn.ERR_NO_VALID_ADDRESSES);return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:h})=>h.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:h})=>h.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const i=await this.calculateMultiaddrs(void 0,new Set(e.map(r=>r.toString())),t);return t.runOnTransientConnection===!1?i.find(r=>!o1e.matches(r.multiaddr))!=null:!0}catch(i){this.log.trace("error calculating if multiaddr(s) were dialable",i)}return!1}}const IX=50,Ph={minConnections:EX,maxConnections:TX,inboundConnectionThreshold:$me,maxIncomingPendingConnections:Gme,autoDialConcurrency:xX,autoDialPriority:vX,autoDialMaxQueueLength:bX,autoDialPeerRetryThreshold:CX,autoDialDiscoveredPeersDebounce:_X};var JUe;class c1e{constructor(e,t={}){E(this,"started");E(this,"connections");E(this,"allow");E(this,"deny");E(this,"maxIncomingPendingConnections");E(this,"incomingPendingConnections");E(this,"maxConnections");E(this,"dialQueue");E(this,"autoDial");E(this,"connectionPruner");E(this,"inboundConnectionRateLimiter");E(this,"peerStore");E(this,"metrics");E(this,"events");E(this,"log");E(this,JUe,"@libp2p/connection-manager");this.maxConnections=t.maxConnections??Ph.maxConnections;const i=t.minConnections??Ph.minConnections;if(this.maxConnections<i)throw new Se("Connection Manager maxConnections must be greater than minConnections",wn.ERR_INVALID_PARAMETERS);this.connections=new w7,this.started=!1,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(t.allow??[]).map(r=>zi(r)),this.deny=(t.deny??[]).map(r=>zi(r)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??Ph.maxIncomingPendingConnections,this.inboundConnectionRateLimiter=new fX({points:t.inboundConnectionThreshold??Ph.inboundConnectionThreshold,duration:1}),this.autoDial=new Wme({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{minConnections:i,autoDialConcurrency:t.autoDialConcurrency??Ph.autoDialConcurrency,autoDialPriority:t.autoDialPriority??Ph.autoDialPriority,autoDialPeerRetryThreshold:t.autoDialPeerRetryThreshold??Ph.autoDialPeerRetryThreshold,autoDialDiscoveredPeersDebounce:t.autoDialDiscoveredPeersDebounce??Ph.autoDialDiscoveredPeersDebounce,maxQueueLength:t.autoDialMaxQueueLength??Ph.autoDialMaxQueueLength}),this.connectionPruner=new Zme({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new l1e(e,{addressSorter:t.addressSorter??tL,maxParallelDials:t.maxParallelDials??AX,maxDialQueueLength:t.maxDialQueueLength??SX,maxPeerAddrsToDial:t.maxPeerAddrsToDial??yX,dialTimeout:t.dialTimeout??gX,resolvers:t.resolvers??{dnsaddr:nL},connections:this.connections})}isStarted(){return this.started}async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const i of t)i.direction==="inbound"?e.inbound++:e.outbound++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const i of t)for(const r of i.streams){const s=`${r.direction} ${r.protocol??"unnegotiated"}`;e[s]=(e[s]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const i of this.connections.values())for(const r of i){const s={};for(const o of r.streams){const a=`${o.direction} ${o.protocol??"unnegotiated"}`;s[a]=(s[a]??0)+1}for(const[o,a]of Object.entries(s))e[o]=e[o]??[],e[o].push(a)}const t={};for(let[i,r]of Object.entries(e)){r=r.sort((o,a)=>o-a);const s=Math.floor(r.length*.9);t[i]=r[s]}return t}}),this.dialQueue.start(),this.autoDial.start(),this.started=!0,this.log("started")}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>t.tags.has(tce)]});await Promise.all(e.map(async t=>{await this.openConnection(t.id).catch(i=>{this.log.error(i)})}))}).catch(e=>{this.log.error(e)}),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();const e=[];for(const t of this.connections.values())for(const i of t)e.push((async()=>{try{await i.close()}catch(r){this.log.error(r)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}const i=t.remotePeer,r=this.connections.get(i);let s=!1;r!=null?r.push(t):(s=!0,this.connections.set(i,[t])),i.publicKey!=null&&i.type==="RSA"&&await this.peerStore.patch(i,{publicKey:i.publicKey}),s&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const i=t.remotePeer;let r=this.connections.get(i);r!=null&&r.length>1?(r=r.filter(s=>s.id!==t.id),this.connections.set(i,r)):r!=null&&(this.connections.delete(i),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const i of this.connections.values())t=t.concat(i);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.isStarted())throw new Se("Not started",wn.ERR_NODE_NOT_STARTED);t.signal?.throwIfAborted();const{peerId:i}=pX(e);if(i!=null&&t.force!==!0){this.log("dial %p",i);const a=this.getConnections(i).find(l=>!l.transient);if(a!=null)return this.log("had an existing non-transient connection to %p",i),t.onProgress?.(new er("dial-queue:already-connected")),a}const r=await this.dialQueue.dial(e,{...t,priority:t.priority??IX});let s=this.connections.get(r.remotePeer);s==null&&(s=[],this.connections.set(r.remotePeer,s));let o=!1;for(const a of s)a.id===r.id&&(o=!0);return o||s.push(r),r}async closeConnections(e,t={}){const i=this.connections.get(e)??[];await Promise.all(i.map(async r=>{try{await r.close(t)}catch(s){r.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(r=>e.remoteAddr.toString().startsWith(r.toString())))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(r=>e.remoteAddr.toString().startsWith(r.toString())))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const r=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(r,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,r),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(i=>zi(i))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}JUe=Symbol.toStringTag;class PA{constructor(e){E(this,"movingAverage");E(this,"variance");E(this,"deviation");E(this,"forecast");E(this,"timespan");E(this,"previousTime");this.timespan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timespan)}push(e,t=Date.now()){if(this.previousTime!=null){const i=this.alpha(t,this.previousTime),r=e-this.movingAverage,s=i*r;this.movingAverage=i*e+(1-i)*this.movingAverage,this.variance=(1-i)*(this.variance+r*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+i*r}else this.movingAverage=e;this.previousTime=t}}const u1e=1.2,h1e=2,d1e=2e3;class NX{constructor(e={}){E(this,"success");E(this,"failure");E(this,"next");E(this,"metric");E(this,"timeoutMultiplier");E(this,"failureMultiplier");E(this,"minTimeout");this.success=new PA(e.interval??5e3),this.failure=new PA(e.interval??5e3),this.next=new PA(e.interval??5e3),this.failureMultiplier=e.failureMultiplier??h1e,this.timeoutMultiplier=e.timeoutMultiplier??u1e,this.minTimeout=e.minTimeout??d1e,e.metricName!=null&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){const t=Math.max(Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier)),this.minTimeout),i=AbortSignal.timeout(t),r=N0([e.signal,i]);return tr(1/0,r,i),r.start=Date.now(),r.timeout=t,r}cleanUp(e){const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}let f1e=class{constructor(){E(this,"readNext");E(this,"haveNext");E(this,"ended");E(this,"nextResult");this.ended=!1,this.readNext=Ki(),this.haveNext=Ki()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ki(),e}async throw(e){return this.ended=!0,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ki(),await eu(this.readNext.promise,t?.signal,t)}};function p1e(){return new f1e}let m1e=class extends Error{constructor(){super(...arguments);E(this,"name","UnexpectedEOFError");E(this,"code","ERR_UNEXPECTED_EOF")}};class g1e extends Error{constructor(t,i){super(t);E(this,"code");this.code=i}}let y1e=class extends g1e{constructor(t){super(t,"ABORT_ERR");E(this,"type");this.type="aborted",this.name="AbortError"}};function PX(n,e){const t=p1e();n.sink(t).catch(async o=>{await t.end(o)}),n.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let i=n.source;n.source[Symbol.iterator]!=null?i=n.source[Symbol.iterator]():n.source[Symbol.asyncIterator]!=null&&(i=n.source[Symbol.asyncIterator]());const r=new Zn;return{read:async(o,a)=>{a?.signal?.throwIfAborted();let l;const c=new Promise((u,h)=>{l=()=>{h(new y1e("Read aborted"))},a?.signal?.addEventListener("abort",l)});try{if(o==null){const{done:h,value:p}=await Promise.race([i.next(),c]);return h===!0?new Zn:p}for(;r.byteLength<o;){const{value:h,done:p}=await Promise.race([i.next(),c]);if(p===!0)throw new m1e("unexpected end of input");r.append(h)}const u=r.sublist(0,o);return r.consume(o),u}finally{l!=null&&a?.signal?.removeEventListener("abort",l)}},write:async(o,a)=>{a?.signal?.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(r.byteLength>0){const o=n.source;n.source=async function*(){e?.yieldBytes===!1?yield r:yield*r,yield*o}()}return n}}}const x1e=1e4,v1e="1.0.0",b1e="ping",_1e="ipfs",IF=32;var eFe,tFe;class w1e{constructor(e,t={}){E(this,"protocol");E(this,"components");E(this,"log");E(this,"heartbeatInterval");E(this,"pingIntervalMs");E(this,"abortController");E(this,"timeout");E(this,eFe,"@libp2p/connection-monitor");E(this,tFe,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??_1e}/${b1e}/${v1e}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??x1e,this.timeout=new NX({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),r=await e.newStream(this.protocol,{signal:i,runOnTransientConnection:!0}),s=PX(r);t=Date.now(),await Promise.all([s.write(R0(IF),{signal:i}),s.read(IF,{signal:i})]),e.rtt=Date.now()-t,await s.unwrap().close({signal:i})}catch(i){if(i.code!=="ERR_UNSUPPORTED_PROTOCOL")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat, aborting connection",t),e.abort(t)})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}eFe=Symbol.toStringTag,tFe=kd;function S1e(n){return n.reason}async function E1e(n,e,t){if(e==null)return n;const i=t?.translateError??S1e;if(e.aborted)return n.catch(()=>{}),Promise.reject(i(e));let r;try{return await Promise.race([n,new Promise((s,o)=>{r=()=>{o(i(e))},e.addEventListener("abort",r)})])}finally{r!=null&&e.removeEventListener("abort",r)}}class T1e{constructor(){E(this,"readNext");E(this,"haveNext");E(this,"ended");E(this,"nextResult");E(this,"error");this.ended=!1,this.readNext=Ki(),this.haveNext=Ki()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Ki(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Ki(),await E1e(this.readNext.promise,t?.signal,t)}}function A1e(){return new T1e}function C1e(n){return n[Symbol.asyncIterator]!=null}async function M1e(n,e,t){try{await Promise.all(n.map(async i=>{for await(const r of i)await e.push(r,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(i){await e.end(i,{signal:t}).catch(()=>{})}}async function*R1e(n){const e=new AbortController,t=A1e();M1e(n,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*I1e(n){for(const e of n)yield*e}function mb(...n){const e=[];for(const t of n)C1e(t)||e.push(t);return e.length===n.length?I1e(e):R1e(n)}var nFe;class N1e{constructor(e,t){E(this,"routers");E(this,"started");E(this,"components");E(this,nFe,"@libp2p/content-routing");this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new Se("No content routers available",wn.ERR_NO_ROUTERS_AVAILABLE);const i=this,r=new $k;for await(const s of mb(...i.routers.map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!r.has(s.id)&&(r.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new Se("No content routers available",wn.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map(async i=>{await i.provide(e,t)}))}async put(e,t,i){if(!this.isStarted())throw new Se(M2.NOT_STARTED_YET,wn.ERR_NODE_NOT_STARTED);await Promise.all(this.routers.map(async r=>{await r.put(e,t,i)}))}async get(e,t){if(!this.isStarted())throw new Se(M2.NOT_STARTED_YET,wn.ERR_NODE_NOT_STARTED);return Promise.any(this.routers.map(async i=>i.get(e,t)))}}nFe=Symbol.toStringTag;const v4=globalThis.CustomEvent??Event;async function*aL(n,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const i=e.ordered??!1,r=new EventTarget,s=[];let o=Ki(),a=Ki(),l=!1,c,u=!1;r.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const y of n){if(s.length===t&&(o=Ki(),await o.promise),u)break;const b={done:!1};s.push(b),y().then(w=>{b.done=!0,b.ok=!0,b.value=w,r.dispatchEvent(new v4("task-complete"))},w=>{b.done=!0,b.err=w,r.dispatchEvent(new v4("task-complete"))})}l=!0,r.dispatchEvent(new v4("task-complete"))}catch(y){c=y,r.dispatchEvent(new v4("task-complete"))}});function h(){return i?s[0]?.done:!!s.find(y=>y.done)}function*p(){for(;s.length>0&&s[0].done;){const y=s[0];if(s.shift(),y.ok)yield y.value;else throw u=!0,o.resolve(),y.err;o.resolve()}}function*m(){for(;h();)for(let y=0;y<s.length;y++)if(s[y].done){const b=s[y];if(s.splice(y,1),y--,b.ok)yield b.value;else throw u=!0,o.resolve(),b.err;o.resolve()}}for(;;){if(h()||(a=Ki(),await a.promise),c!=null||(i?yield*p():yield*m(),c!=null))throw c;if(l&&s.length===0)break}}var iFe;class P1e{constructor(e,t={}){E(this,"log");E(this,"peerId");E(this,"peerStore");E(this,"routers");E(this,iFe,"@libp2p/peer-routing");this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[]}async findPeer(e,t){if(this.routers.length===0)throw new Se("No peer routers available",wn.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.peerId.toString())throw new Se("Should not try to find self",wn.ERR_FIND_SELF);const i=this,r=mb(...this.routers.map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){i.log.error(o)}}()));for await(const s of r)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),s;throw new Se(M2.NOT_FOUND,wn.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new Se("No peer routers available",wn.ERR_NO_ROUTERS_AVAILABLE);const i=this,r=kfe(1024);for await(const s of aL(async function*(){const o=mb(...i.routers.map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await i.findPeer(a.id,{...t,useCache:!1})}catch(l){i.log.error("could not find peer multiaddrs",l);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs}),!r.has(s.id.toBytes())&&(r.add(s.id.toBytes()),yield s))}}iFe=Symbol.toStringTag;var rFe;class k1e extends yc{constructor(t){super();E(this,"peerRouting");E(this,"log");E(this,"walking");E(this,"walkers");E(this,"shutdownController");E(this,"walkController");E(this,"needNext");E(this,rFe,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,tr(1/0,this.shutdownController.signal)}start(){this.shutdownController=new AbortController,tr(1/0,this.shutdownController.signal)}stop(){this.shutdownController.abort()}async*walk(t){this.walking||this.startWalk(),this.walkers++;const i=N0([this.shutdownController.signal,t?.signal]);tr(1/0,i);try{for(;;)this.needNext?.resolve(),this.needNext=Ki(),yield(await Cm(this,"walk:peer",i,{errorEvent:"walk:error"})).detail}finally{i.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,tr(1/0,this.walkController.signal);const t=N0([this.walkController.signal,this.shutdownController.signal]);tr(1/0,t);const i=Date.now();let r=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=R0(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),r++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await eu(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,r)}catch(s){this.log.error("randomwalk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("randomwalk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",r,Date.now()-i),this.walking=!1})}}rFe=Symbol.toStringTag;const kX=32,LX=64;var sFe;class L1e{constructor(e){E(this,"log");E(this,"topologies");E(this,"handlers");E(this,"components");E(this,sFe,"@libp2p/registrar");this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new Se(`No handler registered for protocol ${e}`,wn.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,i){if(this.handlers.has(e))throw new Se(`Handler already registered for protocol ${e}`,wn.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const r=dX.bind({ignoreUndefined:!0})({maxInboundStreams:kX,maxOutboundStreams:LX},i);this.handlers.set(e,{handler:t,options:r}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach(i=>{this.handlers.delete(i)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(t==null)throw new Se("invalid topology",wn.ERR_INVALID_PARAMETERS);const i=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let r=this.topologies.get(e);return r==null&&(r=new Map,this.topologies.set(e,r)),r.set(i,t),i}unregister(e){for(const[t,i]of this.topologies.entries())i.has(e)&&(i.delete(e),i.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then(i=>{for(const r of i.protocols){const s=this.topologies.get(r);if(s!=null)for(const o of s.values())o.filter?.has(t)!==!1&&(o.filter?.remove(t),o.onDisconnect?.(t))}}).catch(i=>{i.code!==wn.ERR_NOT_FOUND&&this.log.error("could not inform topologies of disconnecting peer %p",t,i)})}_onPeerUpdate(e){const{peer:t,previous:i}=e.detail,r=(i?.protocols??[]).filter(s=>!t.protocols.includes(s));for(const s of r){const o=this.topologies.get(s);if(o!=null)for(const a of o.values())a.filter?.has(t.id)!==!1&&(a.filter?.remove(t.id),a.onDisconnect?.(t.id))}}_onPeerIdentify(e){const t=e.detail.protocols,i=e.detail.connection,r=e.detail.peerId;for(const s of t){const o=this.topologies.get(s);if(o!=null)for(const a of o.values())i.transient&&a.notifyOnTransient!==!0||a.filter?.has(r)!==!0&&(a.filter?.add(r),a.onConnect?.(r,i))}}}sFe=Symbol.toStringTag;class D1e extends Map{constructor(t){super();E(this,"metric");const{name:i,metrics:r}=t;this.metric=r.registerMetric(i),this.updateComponentMetric()}set(t,i){return super.set(t,i),this.updateComponentMetric(),this}delete(t){const i=super.delete(t);return this.updateComponentMetric(),i}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function O1e(n){const{name:e,metrics:t}=n;let i;return t!=null?i=new D1e({name:e,metrics:t}):i=new Map,i}var oFe;class B1e{constructor(e,t={}){E(this,"log");E(this,"components");E(this,"transports");E(this,"listeners");E(this,"faultTolerance");E(this,"started");E(this,oFe,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=O1e({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Ty.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new Se("Transport must have a valid tag",wn.ERR_INVALID_KEY);if(this.transports.has(t))throw new Se(`There is already a transport with the tag ${t}`,wn.ERR_DUPLICATE_TRANSPORT);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,i]of this.listeners)for(this.log("closing listeners for %s",t);i.length>0;){const r=i.pop();r!=null&&e.push(r.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){const i=this.dialTransportForMultiaddr(e);if(i==null)throw new Se(`No transport available for address ${String(e)}`,wn.ERR_TRANSPORT_UNAVAILABLE);t?.onProgress?.(new er("transport-manager:selected-transport",i[Symbol.toStringTag]));try{return await i.dial(e,{...t,upgrader:this.components.upgrader})}catch(r){throw r.code==null&&(r.code=wn.ERR_TRANSPORT_DIAL_FAILED),r}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const i of t)e=[...e,...i.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Se("Not started",wn.ERR_NODE_NOT_STARTED);if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t=[];for(const[i,r]of this.transports.entries()){const s=r.listenFilter(e),o=[];for(const c of s){this.log("creating listener for %s on %a",i,c);const u=r.createListener({upgrader:this.components.upgrader});let h=this.listeners.get(i)??[];h==null&&(h=[],this.listeners.set(i,h)),h.push(u),u.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:u})}),u.addEventListener("close",()=>{const p=h.findIndex(m=>m===u);h.splice(p,1),this.components.events.safeDispatchEvent("transport:close",{detail:u})}),o.push(u.listen(c))}if(o.length===0){t.push(i);continue}if((await Promise.allSettled(o)).find(c=>c.status==="fulfilled")==null&&this.faultTolerance!==Ty.NO_FATAL)throw new Se(`Transport (${i}) could not listen on any available address`,wn.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){const i=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===Ty.FATAL_ALL)throw new Se(i,wn.ERR_NO_VALID_ADDRESSES);this.log(`libp2p in dial mode only: ${i}`)}}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const i=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const r=t.pop();r!=null&&i.push(r.close())}await Promise.all(i),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}oFe=Symbol.toStringTag;const Pa="/multistream/1.0.0",lL=1024;let U1e=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidMessageLengthError");E(this,"code","ERR_INVALID_MSG_LENGTH")}},F1e=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidDataLengthError");E(this,"code","ERR_MSG_DATA_TOO_LONG")}},z1e=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidDataLengthLengthError");E(this,"code","ERR_MSG_LENGTH_TOO_LONG")}};function R2(n,e={}){const t=PX(n,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=nr(e.maxDataLength));const i=e?.lengthDecoder??$0,r=e?.lengthEncoder??Za;return{read:async o=>{let a=-1;const l=new Zn;for(;;){l.append(await t.read(1,o));try{a=i(l)}catch(c){if(c instanceof RangeError)continue;throw c}if(a<0)throw new U1e("Invalid message length");if(e?.maxLengthLength!=null&&l.byteLength>e.maxLengthLength)throw new z1e("message length length too long");if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new F1e("message length too long");return t.read(a,o)},write:async(o,a)=>{await t.write(new Zn(r(o.byteLength),o),a)},writeV:async(o,a)=>{const l=new Zn(...o.flatMap(c=>[r(c.byteLength),c]));await t.write(l,a)},unwrap:()=>t.unwrap()}}const j1e=Ut(`
`);async function Yv(n,e,t){await n.write(e,t)}async function V1e(n,e,t){await n.writeV(e,t)}async function H1e(n,e){const t=await n.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==j1e[0])throw e.log.error("Invalid mss message - missing newline",t),new Se("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return t.sublist(0,-1)}async function Cy(n,e){const t=await H1e(n,e);return Vt(t.subarray())}async function kA(n,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return $1e(n,e[0],t);const i=R2(n,{...t,maxDataLength:lL}),r=e.shift();if(r==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',Pa,r);const s=Ut(`${Pa}
`),o=Ut(`${r}
`);await V1e(i,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await Cy(i,t);if(t.log.trace('select: read "%s"',a),a===Pa&&(t.log.trace("select: reading protocol response"),a=await Cy(i,t),t.log.trace('select: read "%s"',a)),a===r)return{stream:i.unwrap(),protocol:r};for(const l of e){t.log.trace('select: write "%s"',l),await Yv(i,Ut(`${l}
`),t),t.log.trace("select: reading protocol response");const c=await Cy(i,t);if(t.log.trace('select: read "%s" for "%s"',c,l),c===l)return{stream:i.unwrap(),protocol:l}}throw new Se("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}function $1e(n,e,t){const i=n.sink.bind(n),r=n.source;let s=!1,o=!1;const a=Ki();let l=!1,c=!1;const u=Ki();let h=!1,p=!1;const m=Ki(),y=R2({sink:i,source:r},{...t,maxDataLength:lL});n.sink=async T=>{const{sink:S}=y.unwrap();await S(async function*(){let M=!1;for await(const P of T){if(c&&await u.promise,l)yield P;else{c=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',Pa,e,P.byteLength);const R=`${e}
`;yield new Zn(Uint8Array.from([19]),Ut(`${Pa}
`),Za(R.length),Ut(R),P).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',Pa,e,P.byteLength),l=!0,c=!1,u.resolve(),b().catch(O=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,O)})}M=!0}M||await b()}())};async function b(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{l||(t.log.trace("optimistic: doing send protocol for %s stream",e),await w()),h||(t.log.trace("optimistic: doing read protocol for %s stream",e),await v())}finally{o=!1,s=!0,a.resolve()}}async function w(){if(c){await u.promise;return}c=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',Pa,e),await y.writeV([Ut(`${Pa}
`),Ut(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',Pa,e)}finally{l=!0,c=!1,u.resolve()}}async function v(){if(p){await m.promise;return}p=!0;try{t.log.trace("optimistic: reading multistream select header");let T=await Cy(y,t);if(t.log.trace('optimistic: read multistream select header "%s"',T),T===Pa&&(T=await Cy(y,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',T,e),T!==e)throw new Se("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}finally{h=!0,p=!1,m.resolve()}}if(n.source=async function*(){await b(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*y.unwrap().source}(),n.closeRead!=null){const T=n.closeRead.bind(n);n.closeRead=async S=>{s||await b().catch(M=>{t.log.error("could not negotiate protocol before close read",M)}),await T(S)}}if(n.closeWrite!=null){const T=n.closeWrite.bind(n);n.closeWrite=async S=>{s||await b().catch(M=>{t.log.error("could not negotiate protocol before close write",M)}),await T(S)}}if(n.close!=null){const T=n.close.bind(n);n.close=async S=>{const M=[];c&&M.push(u.promise),p&&M.push(m.promise),M.length>0?await eu(Promise.all(M),S?.signal):(s=!0,o=!1,a.resolve()),await T(S)}}return{stream:n,protocol:e}}function DX(n){return n[Symbol.asyncIterator]!=null}const L7=n=>{const e=nr(n),t=Cs(e);return Za(n,t),L7.bytes=e,t};L7.bytes=0;function Zm(n,e){e=e??{};const t=e.lengthEncoder??L7;function*i(r){const s=t(r.byteLength);s instanceof Uint8Array?yield s:yield*s,r instanceof Uint8Array?yield r:yield*r}return DX(n)?async function*(){for await(const r of n)yield*i(r)}():function*(){for(const r of n)yield*i(r)}()}Zm.single=(n,e)=>{e=e??{};const t=e.lengthEncoder??L7;return new Zn(t(n.byteLength),n)};let G1e=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidMessageLengthError");E(this,"code","ERR_INVALID_MSG_LENGTH")}},W1e=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidDataLengthError");E(this,"code","ERR_MSG_DATA_TOO_LONG")}},K1e=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidDataLengthLengthError");E(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},NF=class extends Error{constructor(){super(...arguments);E(this,"name","UnexpectedEOFError");E(this,"code","ERR_UNEXPECTED_EOF")}};const q1e=8,Z1e=1024*1024*4;var qp;(function(n){n[n.LENGTH=0]="LENGTH",n[n.DATA=1]="DATA"})(qp||(qp={}));const cL=n=>{const e=$0(n);return cL.bytes=nr(e),e};cL.bytes=0;function I2(n,e){const t=new Zn;let i=qp.LENGTH,r=-1;const s=e?.lengthDecoder??cL,o=e?.maxLengthLength??q1e,a=e?.maxDataLength??Z1e;function*l(){for(;t.byteLength>0;){if(i===qp.LENGTH)try{if(r=s(t),r<0)throw new G1e("Invalid message length");if(r>a)throw new W1e("Message length too long");const c=s.bytes;t.consume(c),e?.onLength!=null&&e.onLength(r),i=qp.DATA}catch(c){if(c instanceof RangeError){if(t.byteLength>o)throw new K1e("Message length length too long");break}throw c}if(i===qp.DATA){if(t.byteLength<r)break;const c=t.sublist(0,r);t.consume(r),e?.onData!=null&&e.onData(c),yield c,i=qp.LENGTH}}}return DX(n)?async function*(){for await(const c of n)t.append(c),yield*l();if(t.byteLength>0)throw new NF("Unexpected end of input")}():function*(){for(const c of n)t.append(c),yield*l();if(t.byteLength>0)throw new NF("Unexpected end of input")}()}I2.fromReader=(n,e)=>{let t=1;const i=async function*(){for(;;)try{const{done:s,value:o}=await n.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return I2(i,{...e??{},onLength:s=>{t=s}})};async function LA(n,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const i=R2(n,{...t,maxDataLength:lL,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const r=await Cy(i,t);if(t.log.trace('handle: read "%s"',r),r===Pa){t.log.trace('handle: respond with "%s" for "%s"',Pa,r),await Yv(i,Ut(`${Pa}
`),t),t.log.trace('handle: responded with "%s" for "%s"',Pa,r);continue}if(e.includes(r))return t.log.trace('handle: respond with "%s" for "%s"',r,r),await Yv(i,Ut(`${r}
`),t),t.log.trace('handle: responded with "%s" for "%s"',r,r),{stream:i.unwrap(),protocol:r};if(r==="ls"){const s=new Zn(...e.map(o=>Zm.single(Ut(`${o}
`))),Ut(`
`));t.log.trace('handle: respond with "%s" for %s',e,r),await Yv(i,s,t),t.log.trace('handle: responded with "%s" for %s',e,r);continue}t.log('handle: respond with "na" for "%s"',r),await Yv(i,Ut(`na
`),t),t.log('handle: responded with "na" for "%s"',r)}}const Y1e=500;var aFe,lFe;class X1e{constructor(e){E(this,"id");E(this,"remoteAddr");E(this,"remotePeer");E(this,"direction");E(this,"timeline");E(this,"multiplexer");E(this,"encryption");E(this,"status");E(this,"transient");E(this,"log");E(this,"tags");E(this,"_newStream");E(this,"_close");E(this,"_abort");E(this,"_getStreams");E(this,aFe,"Connection");E(this,lFe,!0);const{remoteAddr:t,remotePeer:i,newStream:r,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=i,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.transient=e.transient??!1,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=r,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new Se("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if(this.status==="closed")throw new Se("the connection is closed","ERR_CONNECTION_CLOSED");if(Array.isArray(e)||(e=[e]),this.transient&&t?.runOnTransientConnection!==!0)throw new Se("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");const i=await this._newStream(e,t);return i.direction="outbound",i}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(Y1e);tr(1/0,t),e={...e,signal:t}}try{this.log.trace("closing all streams"),await Promise.all(this.streams.map(async t=>t.close(e))),this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this.streams.forEach(t=>{t.abort(e)}),this.log.error("all streams aborted",this.streams.length),this._abort(e),this.timeline.close=Date.now(),this.status="closed"}}aFe=Symbol.toStringTag,lFe=ece;function Q1e(n){return new X1e(n)}const J1e=3e4;function ege(n,e){try{const{options:t}=e.getHandler(n);return t.maxInboundStreams}catch(t){if(t.code!==wn.ERR_NO_HANDLER_FOR_PROTOCOL)throw t}return kX}function tge(n,e,t={}){try{const{options:i}=e.getHandler(n);if(i.maxOutboundStreams!=null)return i.maxOutboundStreams}catch(i){if(i.code!==wn.ERR_NO_HANDLER_FOR_PROTOCOL)throw i}return t.maxOutboundStreams??LX}function PF(n,e,t){let i=0;return t.streams.forEach(r=>{r.direction===e&&r.protocol===n&&i++}),i}var cFe;class nge{constructor(e,t){E(this,"components");E(this,"connectionEncryption");E(this,"muxers");E(this,"inboundUpgradeTimeout");E(this,"events");E(this,cFe,"@libp2p/upgrader");this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach(i=>{this.connectionEncryption.set(i.protocol,i)}),this.muxers=new Map,t.muxers.forEach(i=>{this.muxers.set(i.protocol,i)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??Vme,this.events=e.events}async shouldBlockConnection(e,t,i){const r=this.components.connectionGater[i];if(r!==void 0&&await r(e,t))throw new Se(`The multiaddr connection is blocked by gater.${i}`,wn.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw new Se("connection denied",wn.ERR_CONNECTION_DENIED);let r,s,o,a,l;const c=AbortSignal.timeout(this.inboundUpgradeTimeout),u=()=>{e.abort(new Se("inbound upgrade timeout",tb))};c.addEventListener("abort",u,{once:!0}),tr(1/0,c);try{if(await this.components.connectionGater.denyInboundConnection?.(e)===!0)throw new Se("The multiaddr connection is blocked by gater.acceptConnection",wn.ERR_CONNECTION_INTERCEPTED);this.components.metrics?.trackMultiaddrConnection(e),e.log("starting the inbound connection upgrade");let h=e;if(t?.skipProtection!==!0){const p=this.components.connectionProtector;p!=null&&(e.log("protecting the inbound connection"),h=await p.protect(e))}try{if(r=h,t?.skipEncryption!==!0){t?.onProgress?.(new er("upgrader:encrypt-inbound-connection")),{conn:r,remotePeer:s,protocol:l}=await this._encryptInbound(h);const p={...h,...r};await this.shouldBlockConnection(s,p,"denyInboundEncryptedConnection")}else{const p=e.remoteAddr.getPeerId();if(p==null)throw new Se("inbound connection that skipped encryption must have a peer id",wn.ERR_INVALID_MULTIADDR);const m=Bi(p);l="native",s=m}if(o=r,t?.muxerFactory!=null)a=t.muxerFactory;else if(this.muxers.size>0){t?.onProgress?.(new er("upgrader:multiplex-inbound-connection"));const p=await this._multiplexInbound({...h,...r},this.muxers);a=p.muxerFactory,o=p.stream}}catch(p){throw e.log.error("failed to upgrade inbound connection",p),p}return await this.shouldBlockConnection(s,e,"denyInboundUpgradedConnection"),e.log("successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:l,direction:"inbound",maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,transient:t?.transient})}finally{c.removeEventListener("abort",u),this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){const i=e.remoteAddr.getPeerId();let r;i!=null&&(r=Bi(i),await this.shouldBlockConnection(r,e,"denyOutboundConnection"));let s,o,a,l,c;this.components.metrics?.trackMultiaddrConnection(e),e.log("starting the outbound connection upgrade");let u=e;if(t?.skipProtection!==!0){const h=this.components.connectionProtector;h!=null&&(u=await h.protect(e))}try{if(s=u,t?.skipEncryption!==!0){({conn:s,remotePeer:o,protocol:l}=await this._encryptOutbound(u,r));const h={...u,...s};await this.shouldBlockConnection(o,h,"denyOutboundEncryptedConnection")}else{if(r==null)throw new Se("Encryption was skipped but no peer id was passed",wn.ERR_INVALID_PEER);l="native",o=r}if(a=s,t?.muxerFactory!=null)c=t.muxerFactory;else if(this.muxers.size>0){const h=await this._multiplexOutbound({...u,...s},this.muxers);c=h.muxerFactory,a=h.stream}}catch(h){throw e.log.error("failed to upgrade outbound connection",h),await e.close(h),h}return await this.shouldBlockConnection(o,e,"denyOutboundUpgradedConnection"),e.log("successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:l,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:c,remotePeer:o,transient:t?.transient})}_createConnection(e){const{cryptoProtocol:t,direction:i,maConn:r,upgradedConn:s,remotePeer:o,muxerFactory:a,transient:l}=e;let c,u,h;a!=null&&(c=a.createStreamMuxer({direction:i,onIncomingStream:y=>{h!=null&&Promise.resolve().then(async()=>{const b=this.components.registrar.getProtocols(),{stream:w,protocol:v}=await LA(y,b,{log:y.log,yieldBytes:!1});if(h==null)return;h.log("incoming stream opened on %s",v);const T=ege(v,this.components.registrar);if(PF(v,"inbound",h)===T){const M=new Se(`Too many inbound protocol streams for protocol "${v}" - limit ${T}`,wn.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw y.abort(M),M}y.source=w.source,y.sink=w.sink,y.protocol=v,w.closeWrite!=null&&(y.closeWrite=w.closeWrite),w.closeRead!=null&&(y.closeRead=w.closeRead),w.close!=null&&(y.close=w.close),await this.components.peerStore.merge(o,{protocols:[v]}),this.components.metrics?.trackProtocolStream(y,h),this._onStream({connection:h,stream:y,protocol:v})}).catch(async b=>{h.log.error("error handling incoming stream id %s",y.id,b.message,b.code,b.stack),y.timeline.close==null&&await y.close()})}}),u=async(y,b={})=>{if(c==null)throw new Se("Stream is not multiplexed",wn.ERR_MUXER_UNAVAILABLE);h.log("starting new stream for protocols %s",y);const w=await c.newStream();h.log.trace("started new stream %s for protocols %s",w.id,y);try{if(b.signal==null){w.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",y);const P=AbortSignal.timeout(J1e);tr(1/0,P),b={...b,signal:P}}w.log.trace("selecting protocol from protocols %s",y);const{stream:v,protocol:T}=await kA(w,y,{...b,log:w.log,yieldBytes:!0});w.log("selected protocol %s",T);const S=tge(T,this.components.registrar,b),M=PF(T,"outbound",h);if(M>=S){const P=new Se(`Too many outbound protocol streams for protocol "${T}" - ${M}/${S}`,wn.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw w.abort(P),P}return await this.components.peerStore.merge(o,{protocols:[T]}),w.source=v.source,w.sink=v.sink,w.protocol=T,v.closeWrite!=null&&(w.closeWrite=v.closeWrite),v.closeRead!=null&&(w.closeRead=v.closeRead),v.close!=null&&(w.close=v.close),this.components.metrics?.trackProtocolStream(w,h),w}catch(v){throw h.log.error("could not create new stream for protocols %s",y,v),w.timeline.close==null&&w.abort(v),v.code!=null?v:new Se(String(v),wn.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([c.sink(s.source),s.sink(c.source)]).catch(y=>{h.log.error("error piping data through muxer",y)}));const p=r.timeline;r.timeline=new Proxy(p,{set:(...y)=>(h!=null&&y[1]==="close"&&y[2]!=null&&p.close==null&&(async()=>{try{h.status==="open"&&await h.close()}catch(b){h.log.error("error closing connection after timeline close",b)}finally{this.events.safeDispatchEvent("connection:close",{detail:h})}})().catch(b=>{h.log.error("error thrown while dispatching connection:close event",b)}),Reflect.set(...y))}),r.timeline.upgraded=Date.now();const m=()=>{throw new Se("connection is not multiplexed",wn.ERR_CONNECTION_NOT_MULTIPLEXED)};return h=Q1e({remoteAddr:r.remoteAddr,remotePeer:o,status:"open",direction:i,timeline:r.timeline,multiplexer:c?.protocol,encryption:t,transient:l,logger:this.components.logger,newStream:u??m,getStreams:()=>c!=null?c.streams:[],close:async y=>{c!=null&&(h.log.trace("close muxer"),await c.close(y)),h.log.trace("close maconn"),await r.close(y),h.log.trace("closed maconn")},abort:y=>{r.abort(y),c?.abort(y)}}),this.events.safeDispatchEvent("connection:open",{detail:h}),h}_onStream(e){const{connection:t,stream:i,protocol:r}=e,{handler:s,options:o}=this.components.registrar.getHandler(r);if(t.transient&&o.runOnTransientConnection!==!0)throw new Se("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");s({connection:t,stream:i})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());e.log("handling inbound crypto protocol selection",t);try{const{stream:i,protocol:r}=await LA(e,t,{log:e.log}),s=this.connectionEncryption.get(r);if(s==null)throw new Error(`no crypto module found for ${r}`);return e.log("encrypting inbound connection using",r),{...await s.secureInbound(this.components.peerId,i),protocol:r}}catch(i){throw e.log.error("encrypting inbound connection failed",i),new Se(i.message,wn.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const i=Array.from(this.connectionEncryption.keys());e.log("selecting outbound crypto protocol",i);try{e.log.trace("selecting encrypter from %s",i);const{stream:r,protocol:s}=await kA(e,i,{log:e.log,yieldBytes:!0}),o=this.connectionEncryption.get(s);if(o==null)throw new Error(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %p using %s",t,o),{...await o.secureOutbound(this.components.peerId,r,t),protocol:s}}catch(r){throw e.log.error("encrypting outbound connection to %p failed",t,r),new Se(r.message,wn.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:r,protocol:s}=await kA(e,i,{log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",s);const o=t.get(s);return{stream:r,muxerFactory:o}}catch(r){throw e.log.error("error multiplexing outbound connection",r),new Se(String(r),wn.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:r,protocol:s}=await LA(e,i,{log:e.log}),o=t.get(s);return{stream:r,muxerFactory:o}}catch(r){throw e.log.error("error multiplexing inbound connection",r),new Se(String(r),wn.ERR_MUXER_UNAVAILABLE)}}}cFe=Symbol.toStringTag;const ige="1.9.4",rge="libp2p";var Jb,bI;class sge extends yc{constructor(t){super();$t(this,Jb);E(this,"peerId");E(this,"peerStore");E(this,"contentRouting");E(this,"peerRouting");E(this,"metrics");E(this,"services");E(this,"logger");E(this,"status");E(this,"components");E(this,"log");this.status="stopped";const i=new yc,r=i.dispatchEvent.bind(i);i.dispatchEvent=l=>{const c=r(l),u=this.dispatchEvent(new ko(l.type,{detail:l.detail}));return c||u},tr(1/0,i),this.peerId=t.peerId,this.logger=t.logger??pY(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=this.components=Dpe({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:t.nodeInfo??{name:rge,version:ige},logger:this.logger,events:i,datastore:t.datastore??new Mpe,connectionGater:Kpe(t.connectionGater),dns:t.dns});this.peerStore=this.configureComponent("peerStore",new xpe(s,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),s.events.addEventListener("peer:update",l=>{if(l.detail.previous==null){const c={id:l.detail.peer.id,multiaddrs:l.detail.peer.addresses.map(u=>u.multiaddr)};s.events.safeDispatchEvent("peer:discovery",{detail:c})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(s)),this.components.upgrader=new nge(this.components,{connectionEncryption:(t.connectionEncryption??[]).map((l,c)=>this.configureComponent(`connection-encryption-${c}`,l(this.components))),muxers:(t.streamMuxers??[]).map((l,c)=>this.configureComponent(`stream-muxers-${c}`,l(this.components))),inboundUpgradeTimeout:t.connectionManager?.inboundUpgradeTimeout}),this.configureComponent("transportManager",new B1e(this.components,t.transportManager)),this.configureComponent("connectionManager",new c1e(this.components,t.connectionManager)),t.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new w1e(this.components,t.connectionMonitor)),this.configureComponent("registrar",new L1e(this.components)),this.configureComponent("addressManager",new Npe(this.components,t.addresses));const o=(t.peerRouters??[]).map((l,c)=>this.configureComponent(`peer-router-${c}`,l(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new P1e(this.components,{routers:o}));const a=(t.contentRouters??[]).map((l,c)=>this.configureComponent(`content-router-${c}`,l(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new N1e(this.components,{routers:a})),this.configureComponent("randomWalk",new k1e(this.components)),(t.peerDiscovery??[]).forEach((l,c)=>{this.configureComponent(`peer-discovery-${c}`,l(this.components)).addEventListener("peer",h=>{rn(this,Jb,bI).call(this,h)})}),t.transports?.forEach((l,c)=>{this.components.transportManager.add(this.configureComponent(`transport-${c}`,l(this.components)))}),t.services!=null)for(const l of Object.keys(t.services)){const c=t.services[l],u=c(this.components);if(u==null){this.log.error("service factory %s returned null or undefined instance",l);continue}this.services[l]=u,this.configureComponent(l,u),u[HR]!=null&&(this.log("registering service %s for content routing",l),a.push(u[HR])),u[$R]!=null&&(this.log("registering service %s for peer routing",l),o.push(u[$R])),u[b6]!=null&&(this.log("registering service %s for peer discovery",l),u[b6].addEventListener?.("peer",h=>{rn(this,Jb,bI).call(this,h)}))}Ope(s)}configureComponent(t,i){return i==null&&this.log.error("component %s was null or undefined",t),this.components[t]=i,i}async start(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(t){throw this.log.error("An error occurred starting libp2p",t),this.status="started",await this.stop(),t}}}async stop(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new $k;for(const i of this.components.connectionManager.getConnections())t.add(i.remotePeer);return Array.from(t)}async dial(t,i={}){return this.components.connectionManager.openConnection(t,{priority:75,...i})}async dialProtocol(t,i,r={}){if(i==null)throw new Se("no protocols were provided to open a stream",wn.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(i=Array.isArray(i)?i:[i],i.length===0)throw new Se("no protocols were provided to open a stream",wn.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this.dial(t,r)).newStream(i,r)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,i={}){S7(t)&&(t=Bi(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,i)}async getPublicKey(t,i={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const o=await this.peerStore.get(t);if(o.id.publicKey!=null)return o.id.publicKey}catch(o){if(o.code!==wn.ERR_NOT_FOUND)throw o}const r=Ms([Ut("/pk/"),t.multihash.digest]),s=await this.contentRouting.get(r,i);return cb(s),await this.peerStore.patch(t,{publicKey:s}),s}async handle(t,i,r){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,i,r)}))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async i=>{await this.components.registrar.unhandle(i)}))}async register(t,i){return this.components.registrar.register(t,i)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,i={}){return this.components.connectionManager.isDialable(t,i)}}Jb=new WeakSet,bI=function(t){const{detail:i}=t;if(i.id.toString()===this.peerId.toString()){this.log.error(new Error(wn.ERR_DISCOVERED_SELF));return}this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}).catch(r=>{this.log.error(r)})};async function oge(n={}){const e=n.peerId??(n.peerId=await Lfe());if(e.privateKey==null)throw new Se("peer id was missing private key","ERR_MISSING_PRIVATE_KEY");return n.privateKey??(n.privateKey=await _7(e.privateKey)),new sge(await Lme(n))}async function age(n={}){const e=await oge(n);return n.start!==!1&&await e.start(),e}function kF(){const n=Ki();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,n.resolve(t)},source:async function*(){yield*await n.promise}()}}function lge(){const n=kF(),e=kF();return[{source:n.source,sink:e.sink},{source:e.source,sink:n.sink}]}function Qa(n,...e){if(n==null)throw new Error("Empty pipeline");if(DA(n)){const i=n;n=()=>i.source}else if(BX(n)||OX(n)){const i=n;n=()=>i}const t=[n,...e];if(t.length>1&&DA(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let i=1;i<t.length-1;i++)DA(t[i])&&(t[i]=uge(t[i]));return cge(...t)}const cge=(...n)=>{let e;for(;n.length>0;)e=n.shift()(e);return e},OX=n=>n?.[Symbol.asyncIterator]!=null,BX=n=>n?.[Symbol.iterator]!=null,DA=n=>n==null?!1:n.sink!=null&&n.source!=null,uge=n=>e=>{const t=n.sink(e);if(t?.then!=null){const i=vc({objectMode:!0});t.then(()=>{i.end()},o=>{i.end(o)});let r;const s=n.source;if(OX(s))r=async function*(){yield*s,i.end()};else if(BX(s))r=function*(){yield*s,i.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return mb(i,r())}return n.source},gb=65535,LF=gb-16,C_=!!globalThis.process?.env?.DUMP_SESSION_KEYS;/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const v0=n=>new Uint32Array(n.buffer,n.byteOffset,Math.floor(n.byteLength/4));function UX(n){return n instanceof Uint8Array||n!=null&&typeof n=="object"&&n.constructor.name==="Uint8Array"}const hge=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),dge=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!dge)throw new Error("Non little-endian hardware is not supported");function uL(n){if(typeof n!="string")throw new Error(`utf8ToBytes expected string, got ${typeof n}`);return new Uint8Array(new TextEncoder().encode(n))}function _I(n){if(typeof n=="string")n=uL(n);else if(UX(n))n=n.slice();else throw new Error(`expected Uint8Array, got ${typeof n}`);return n}const fge=n=>Object.prototype.toString.call(n)==="[object Object]"&&n.constructor===Object;function pge(n,e){if(e!==void 0&&(typeof e!="object"||!fge(e)))throw new Error("options must be object or undefined");return Object.assign(n,e)}function Xv(n,e){if(!UX(n))throw new Error("Uint8Array expected");if(typeof e=="number"&&n.length!==e)throw new Error(`Uint8Array length ${e} expected`)}function mge(n,e){if(n.length!==e.length)return!1;let t=0;for(let i=0;i<n.length;i++)t|=n[i]^e[i];return t===0}const gge=(n,e)=>(Object.assign(e,n),e);function DF(n,e,t,i){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,i);const r=BigInt(32),s=BigInt(4294967295),o=Number(t>>r&s),a=Number(t&s),l=i?4:0,c=i?0:4;n.setUint32(e+l,o,i),n.setUint32(e+c,a,i)}function OA(n){if(!Number.isSafeInteger(n)||n<0)throw new Error(`wrong positive integer: ${n}`)}function OF(n){if(typeof n!="boolean")throw new Error(`boolean expected, not ${n}`)}function yge(n){return n!=null&&typeof n=="object"&&(n instanceof Uint8Array||n.constructor.name==="Uint8Array")}function Qv(n,...e){if(!yge(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${n.length}`)}function BF(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function xge(n,e){Qv(n);const t=e.outputLen;if(n.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const Xs=(n,e)=>n[e++]&255|(n[e++]&255)<<8;class vge{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=_I(e),Xv(e,32);const t=Xs(e,0),i=Xs(e,2),r=Xs(e,4),s=Xs(e,6),o=Xs(e,8),a=Xs(e,10),l=Xs(e,12),c=Xs(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|r<<6)&7939,this.r[3]=(r>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|l<<5)&8065,this.r[8]=(l>>>8|c<<8)&8191,this.r[9]=c>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Xs(e,16+2*u)}process(e,t,i=!1){const r=i?0:2048,{h:s,r:o}=this,a=o[0],l=o[1],c=o[2],u=o[3],h=o[4],p=o[5],m=o[6],y=o[7],b=o[8],w=o[9],v=Xs(e,t+0),T=Xs(e,t+2),S=Xs(e,t+4),M=Xs(e,t+6),P=Xs(e,t+8),R=Xs(e,t+10),O=Xs(e,t+12),B=Xs(e,t+14);let N=s[0]+(v&8191),I=s[1]+((v>>>13|T<<3)&8191),F=s[2]+((T>>>10|S<<6)&8191),j=s[3]+((S>>>7|M<<9)&8191),W=s[4]+((M>>>4|P<<12)&8191),U=s[5]+(P>>>1&8191),H=s[6]+((P>>>14|R<<2)&8191),q=s[7]+((R>>>11|O<<5)&8191),J=s[8]+((O>>>8|B<<8)&8191),G=s[9]+(B>>>5|r),ee=0,Q=ee+N*a+I*(5*w)+F*(5*b)+j*(5*y)+W*(5*m);ee=Q>>>13,Q&=8191,Q+=U*(5*p)+H*(5*h)+q*(5*u)+J*(5*c)+G*(5*l),ee+=Q>>>13,Q&=8191;let ne=ee+N*l+I*a+F*(5*w)+j*(5*b)+W*(5*y);ee=ne>>>13,ne&=8191,ne+=U*(5*m)+H*(5*p)+q*(5*h)+J*(5*u)+G*(5*c),ee+=ne>>>13,ne&=8191;let fe=ee+N*c+I*l+F*a+j*(5*w)+W*(5*b);ee=fe>>>13,fe&=8191,fe+=U*(5*y)+H*(5*m)+q*(5*p)+J*(5*h)+G*(5*u),ee+=fe>>>13,fe&=8191;let Ae=ee+N*u+I*c+F*l+j*a+W*(5*w);ee=Ae>>>13,Ae&=8191,Ae+=U*(5*b)+H*(5*y)+q*(5*m)+J*(5*p)+G*(5*h),ee+=Ae>>>13,Ae&=8191;let Pe=ee+N*h+I*u+F*c+j*l+W*a;ee=Pe>>>13,Pe&=8191,Pe+=U*(5*w)+H*(5*b)+q*(5*y)+J*(5*m)+G*(5*p),ee+=Pe>>>13,Pe&=8191;let Ce=ee+N*p+I*h+F*u+j*c+W*l;ee=Ce>>>13,Ce&=8191,Ce+=U*a+H*(5*w)+q*(5*b)+J*(5*y)+G*(5*m),ee+=Ce>>>13,Ce&=8191;let de=ee+N*m+I*p+F*h+j*u+W*c;ee=de>>>13,de&=8191,de+=U*l+H*a+q*(5*w)+J*(5*b)+G*(5*y),ee+=de>>>13,de&=8191;let Ne=ee+N*y+I*m+F*p+j*h+W*u;ee=Ne>>>13,Ne&=8191,Ne+=U*c+H*l+q*a+J*(5*w)+G*(5*b),ee+=Ne>>>13,Ne&=8191;let et=ee+N*b+I*y+F*m+j*p+W*h;ee=et>>>13,et&=8191,et+=U*u+H*c+q*l+J*a+G*(5*w),ee+=et>>>13,et&=8191;let me=ee+N*w+I*b+F*y+j*m+W*p;ee=me>>>13,me&=8191,me+=U*h+H*u+q*c+J*l+G*a,ee+=me>>>13,me&=8191,ee=(ee<<2)+ee|0,ee=ee+Q|0,Q=ee&8191,ee=ee>>>13,ne+=ee,s[0]=Q,s[1]=ne,s[2]=fe,s[3]=Ae,s[4]=Pe,s[5]=Ce,s[6]=de,s[7]=Ne,s[8]=et,s[9]=me}finalize(){const{h:e,pad:t}=this,i=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=r,r=e[a]>>>13,e[a]&=8191;e[0]+=r*5,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,i[0]=e[0]+5,r=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+r,r=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(r^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535}update(e){BF(this);const{buffer:t,blockLen:i}=this;e=_I(e);const r=e.length;for(let s=0;s<r;){const o=Math.min(i-this.pos,r-s);if(o===i){for(;i<=r-s;s+=i)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){BF(this),xge(e,this),this.finished=!0;const{buffer:t,h:i}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}}function bge(n){const e=(i,r)=>n(r).update(_I(i)).digest(),t=n(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>n(i),e}const _ge=bge(n=>new vge(n)),wge=uL("expand 16-byte k"),Sge=uL("expand 32-byte k"),Ege=v0(wge),Tge=v0(Sge);function Li(n,e){return n<<e|n>>>32-e}function wI(n){return n.byteOffset%4===0}const b4=64,Age=16,FX=2**32-1,UF=new Uint32Array;function Cge(n,e,t,i,r,s,o,a){const l=r.length,c=new Uint8Array(b4),u=v0(c),h=wI(r)&&wI(s),p=h?v0(r):UF,m=h?v0(s):UF;for(let y=0;y<l;o++){if(n(e,t,i,u,o,a),o>=FX)throw new Error("arx: counter overflow");const b=Math.min(b4,l-y);if(h&&b===b4){const w=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let v=0,T;v<Age;v++)T=w+v,m[T]=p[T]^u[v];y+=b4;continue}for(let w=0,v;w<b;w++)v=y+w,s[v]=r[v]^c[w];y+=b}}function Mge(n,e){const{allowShortKeys:t,extendNonceFn:i,counterLength:r,counterRight:s,rounds:o}=pge({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof n!="function")throw new Error("core must be a function");return OA(r),OA(o),OF(s),OF(t),(a,l,c,u,h=0)=>{Qv(a),Qv(l),Qv(c);const p=c.length;if(u||(u=new Uint8Array(p)),Qv(u),OA(h),h<0||h>=FX)throw new Error("arx: counter overflow");if(u.length<p)throw new Error(`arx: output (${u.length}) is shorter than data (${p})`);const m=[];let y=a.length,b,w;if(y===32)b=a.slice(),m.push(b),w=Tge;else if(y===16&&t)b=new Uint8Array(32),b.set(a),b.set(a,16),w=Ege,m.push(b);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);wI(l)||(l=l.slice(),m.push(l));const v=v0(b);if(i){if(l.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(w,v,v0(l.subarray(0,16)),v),l=l.subarray(16)}const T=16-r;if(T!==l.length)throw new Error(`arx: nonce must be ${T} or 16 bytes`);if(T!==12){const M=new Uint8Array(12);M.set(l,s?0:12-l.length),l=M,m.push(l)}const S=v0(l);for(Cge(n,w,v,S,c,u,h,o);m.length>0;)m.pop().fill(0);return u}}function Rge(n,e,t,i,r,s=20){let o=n[0],a=n[1],l=n[2],c=n[3],u=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],w=e[6],v=e[7],T=r,S=t[0],M=t[1],P=t[2],R=o,O=a,B=l,N=c,I=u,F=h,j=p,W=m,U=y,H=b,q=w,J=v,G=T,ee=S,Q=M,ne=P;for(let Ae=0;Ae<s;Ae+=2)R=R+I|0,G=Li(G^R,16),U=U+G|0,I=Li(I^U,12),R=R+I|0,G=Li(G^R,8),U=U+G|0,I=Li(I^U,7),O=O+F|0,ee=Li(ee^O,16),H=H+ee|0,F=Li(F^H,12),O=O+F|0,ee=Li(ee^O,8),H=H+ee|0,F=Li(F^H,7),B=B+j|0,Q=Li(Q^B,16),q=q+Q|0,j=Li(j^q,12),B=B+j|0,Q=Li(Q^B,8),q=q+Q|0,j=Li(j^q,7),N=N+W|0,ne=Li(ne^N,16),J=J+ne|0,W=Li(W^J,12),N=N+W|0,ne=Li(ne^N,8),J=J+ne|0,W=Li(W^J,7),R=R+F|0,ne=Li(ne^R,16),q=q+ne|0,F=Li(F^q,12),R=R+F|0,ne=Li(ne^R,8),q=q+ne|0,F=Li(F^q,7),O=O+j|0,G=Li(G^O,16),J=J+G|0,j=Li(j^J,12),O=O+j|0,G=Li(G^O,8),J=J+G|0,j=Li(j^J,7),B=B+W|0,ee=Li(ee^B,16),U=U+ee|0,W=Li(W^U,12),B=B+W|0,ee=Li(ee^B,8),U=U+ee|0,W=Li(W^U,7),N=N+I|0,Q=Li(Q^N,16),H=H+Q|0,I=Li(I^H,12),N=N+I|0,Q=Li(Q^N,8),H=H+Q|0,I=Li(I^H,7);let fe=0;i[fe++]=o+R|0,i[fe++]=a+O|0,i[fe++]=l+B|0,i[fe++]=c+N|0,i[fe++]=u+I|0,i[fe++]=h+F|0,i[fe++]=p+j|0,i[fe++]=m+W|0,i[fe++]=y+U|0,i[fe++]=b+H|0,i[fe++]=w+q|0,i[fe++]=v+J|0,i[fe++]=T+G|0,i[fe++]=S+ee|0,i[fe++]=M+Q|0,i[fe++]=P+ne|0}const Ige=Mge(Rge,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Nge=new Uint8Array(16),FF=(n,e)=>{n.update(e);const t=e.length%16;t&&n.update(Nge.subarray(t))},Pge=new Uint8Array(32);function zF(n,e,t,i,r){const s=n(e,t,Pge),o=_ge.create(s);r&&FF(o,r),FF(o,i);const a=new Uint8Array(16),l=hge(a);DF(l,0,BigInt(r?r.length:0),!0),DF(l,8,BigInt(i.length),!0),o.update(a);const c=o.digest();return s.fill(0),c}const kge=n=>(e,t,i)=>(Xv(e,32),Xv(t),{encrypt:(s,o)=>{const a=s.length,l=a+16;o?Xv(o,l):o=new Uint8Array(l),n(e,t,s,o,1);const c=zF(n,e,t,o.subarray(0,-16),i);return o.set(c,a),o},decrypt:(s,o)=>{const a=s.length,l=a-16;if(a<16)throw new Error("encrypted data must be at least 16 bytes");o?Xv(o,l):o=new Uint8Array(l);const c=s.subarray(0,-16),u=s.subarray(-16),h=zF(n,e,t,c,i);if(!mge(u,h))throw new Error("invalid tag");return n(e,t,c,o,1),o}}),jF=gge({blockSize:64,nonceLength:12,tagLength:16},kge(Ige));function Lge(n,e,t){return x_(n),t===void 0&&(t=new Uint8Array(n.outputLen)),b_(n,ib(t),ib(e))}const BA=Uint8Array.from([0]),VF=Uint8Array.of();function Dge(n,e,t,i=32){x_(n),Em(i);const r=n.outputLen;if(i>255*r)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(i/r);t===void 0&&(t=VF);const o=new Uint8Array(s*r),a=b_.create(n,e),l=a._cloneInto(),c=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)BA[0]=u+1,l.update(u===0?VF:c).update(t).update(BA).digestInto(c),o.set(c,r*u),a._cloneInto(l);return a.destroy(),l.destroy(),C0(c,BA),o.slice(0,i)}const Oge={hashSHA256(n){return SA(n.subarray())},getHKDF(n,e){const t=Lge(SA,e,n),r=Dge(SA,t,void 0,96),s=r.subarray(0,32),o=r.subarray(32,64),a=r.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const n=h4.utils.randomPrivateKey();return{publicKey:h4.getPublicKey(n),privateKey:n}},generateX25519KeyPairFromSeed(n){return{publicKey:h4.getPublicKey(n),privateKey:n}},generateX25519SharedKey(n,e){return h4.getSharedSecret(n.subarray(),e.subarray())},chaCha20Poly1305Encrypt(n,e,t,i){return jF(i,e,t).encrypt(n.subarray())},chaCha20Poly1305Decrypt(n,e,t,i,r){return jF(i,e,t).decrypt(n.subarray(),r)}},Bge=Oge,W6=n=>{const e=Cs(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,n,!1),e};W6.bytes=2;const wS=n=>{if(n.length<2)throw RangeError("Could not decode int16BE");return n instanceof Uint8Array?new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,!1):n.getUint16(0)};wS.bytes=2;function Uge(n){return new Zn(n.ne,n.ciphertext)}function Fge(n){return new Zn(n.ne,n.ns,n.ciphertext)}function zge(n){return new Zn(n.ns,n.ciphertext)}function jge(n){if(n.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:n.subarray(0,32),ciphertext:n.subarray(32,n.length),ns:qn(0)}}function Vge(n){if(n.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:n.subarray(0,32),ns:n.subarray(32,80),ciphertext:n.subarray(80,n.length)}}function Hge(n){if(n.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:qn(0),ns:n.subarray(0,48),ciphertext:n.subarray(48,n.length)}}const HF=16;function $ge(n,e){return async function*(t){for await(const i of t)for(let r=0;r<i.length;r+=LF){let s=r+LF;s>i.length&&(s=i.length);let o;i instanceof Uint8Array?o=n.encrypt(i.subarray(r,s),n.session):o=n.encrypt(i.sublist(r,s),n.session),e?.encryptedPackets.increment(),yield new Zn(W6(o.byteLength),o)}}}function Gge(n,e){return async function*(t){for await(const i of t)for(let r=0;r<i.length;r+=gb){let s=r+gb;if(s>i.length&&(s=i.length),s-HF<r)throw new Error("Invalid chunk");const o=i.sublist(r,s),a=i.subarray(r,s-HF),{plaintext:l,valid:c}=n.decrypt(o,n.session,a);if(!c)throw e?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e?.decryptedPackets.increment(),yield l}}}const PE=class PE extends Error{constructor(t="Unexpected Peer"){super(t);E(this,"code");this.code=PE.code}};E(PE,"code","ERR_UNEXPECTED_PEER");let K6=PE;const kE=class kE extends Error{constructor(t="Invalid crypto exchange"){super(t);E(this,"code");this.code=kE.code}};E(kE,"code","ERR_INVALID_CRYPTO_EXCHANGE");let ry=kE;var Vr={options:{usePureJavaScript:!1}};const ha=wc(Vr);var hL={},Wge=hL,$F={};hL.encode=function(n,e,t){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(t!==void 0&&typeof t!="number")throw new TypeError('"maxline" must be a number.');var i="";if(!(n instanceof Uint8Array))i=Kge(n,e);else{var r=0,s=e.length,o=e.charAt(0),a=[0];for(r=0;r<n.length;++r){for(var l=0,c=n[r];l<a.length;++l)c+=a[l]<<8,a[l]=c%s,c=c/s|0;for(;c>0;)a.push(c%s),c=c/s|0}for(r=0;n[r]===0&&r<n.length-1;++r)i+=o;for(r=a.length-1;r>=0;--r)i+=e[a[r]]}if(t){var u=new RegExp(".{1,"+t+"}","g");i=i.match(u).join(`\r
`)}return i};hL.decode=function(n,e){if(typeof n!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var t=$F[e];if(!t){t=$F[e]=[];for(var i=0;i<e.length;++i)t[e.charCodeAt(i)]=i}n=n.replace(/\s/g,"");for(var r=e.length,s=e.charAt(0),o=[0],i=0;i<n.length;i++){var a=t[n.charCodeAt(i)];if(a===void 0)return;for(var l=0,c=a;l<o.length;++l)c+=o[l]*r,o[l]=c&255,c>>=8;for(;c>0;)o.push(c&255),c>>=8}for(var u=0;n[u]===s&&u<n.length-1;++u)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function Kge(n,e){var t=0,i=e.length,r=e.charAt(0),s=[0];for(t=0;t<n.length();++t){for(var o=0,a=n.at(t);o<s.length;++o)a+=s[o]<<8,s[o]=a%i,a=a/i|0;for(;a>0;)s.push(a%i),a=a/i|0}var l="";for(t=0;n.at(t)===0&&t<n.length()-1;++t)l+=r;for(t=s.length-1;t>=0;--t)l+=e[s[t]];return l}var GF=Vr,WF=Wge,Be=GF.util=GF.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){Be.nextTick=process.nextTick,typeof setImmediate=="function"?Be.setImmediate=setImmediate:Be.setImmediate=Be.nextTick;return}if(typeof setImmediate=="function"){Be.setImmediate=function(){return setImmediate.apply(void 0,arguments)},Be.nextTick=function(o){return setImmediate(o)};return}if(Be.setImmediate=function(o){setTimeout(o,0)},typeof window<"u"&&typeof window.postMessage=="function"){let o=function(a){if(a.source===window&&a.data===n){a.stopPropagation();var l=e.slice();e.length=0,l.forEach(function(c){c()})}};var n="forge.setImmediate",e=[];Be.setImmediate=function(a){e.push(a),e.length===1&&window.postMessage(n,"*")},window.addEventListener("message",o,!0)}if(typeof MutationObserver<"u"){var t=Date.now(),i=!0,r=document.createElement("div"),e=[];new MutationObserver(function(){var a=e.slice();e.length=0,a.forEach(function(l){l()})}).observe(r,{attributes:!0});var s=Be.setImmediate;Be.setImmediate=function(a){Date.now()-t>15?(t=Date.now(),s(a)):(e.push(a),e.length===1&&r.setAttribute("a",i=!i))}}Be.nextTick=Be.setImmediate})();Be.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;Be.globalScope=function(){return Be.isNodejs?globalThis:typeof self>"u"?window:self}();Be.isArray=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};Be.isArrayBuffer=function(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer};Be.isArrayBufferView=function(n){return n&&Be.isArrayBuffer(n.buffer)&&n.byteLength!==void 0};function M_(n){if(!(n===8||n===16||n===24||n===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+n)}Be.ByteBuffer=dL;function dL(n){if(this.data="",this.read=0,typeof n=="string")this.data=n;else if(Be.isArrayBuffer(n)||Be.isArrayBufferView(n))if(typeof Buffer<"u"&&n instanceof Buffer)this.data=n.toString("binary");else{var e=new Uint8Array(n);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var t=0;t<e.length;++t)this.putByte(e[t])}}else(n instanceof dL||typeof n=="object"&&typeof n.data=="string"&&typeof n.read=="number")&&(this.data=n.data,this.read=n.read);this._constructedStringLength=0}Be.ByteStringBuffer=dL;var qge=4096;Be.ByteStringBuffer.prototype._optimizeConstructedString=function(n){this._constructedStringLength+=n,this._constructedStringLength>qge&&(this.data.substr(0,1),this._constructedStringLength=0)};Be.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};Be.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};Be.ByteStringBuffer.prototype.putByte=function(n){return this.putBytes(String.fromCharCode(n))};Be.ByteStringBuffer.prototype.fillWithByte=function(n,e){n=String.fromCharCode(n);for(var t=this.data;e>0;)e&1&&(t+=n),e>>>=1,e>0&&(n+=n);return this.data=t,this._optimizeConstructedString(e),this};Be.ByteStringBuffer.prototype.putBytes=function(n){return this.data+=n,this._optimizeConstructedString(n.length),this};Be.ByteStringBuffer.prototype.putString=function(n){return this.putBytes(Be.encodeUtf8(n))};Be.ByteStringBuffer.prototype.putInt16=function(n){return this.putBytes(String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};Be.ByteStringBuffer.prototype.putInt24=function(n){return this.putBytes(String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};Be.ByteStringBuffer.prototype.putInt32=function(n){return this.putBytes(String.fromCharCode(n>>24&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255))};Be.ByteStringBuffer.prototype.putInt16Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255))};Be.ByteStringBuffer.prototype.putInt24Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n>>16&255))};Be.ByteStringBuffer.prototype.putInt32Le=function(n){return this.putBytes(String.fromCharCode(n&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>24&255))};Be.ByteStringBuffer.prototype.putInt=function(n,e){M_(e);var t="";do e-=8,t+=String.fromCharCode(n>>e&255);while(e>0);return this.putBytes(t)};Be.ByteStringBuffer.prototype.putSignedInt=function(n,e){return n<0&&(n+=2<<e-1),this.putInt(n,e)};Be.ByteStringBuffer.prototype.putBuffer=function(n){return this.putBytes(n.getBytes())};Be.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};Be.ByteStringBuffer.prototype.getInt16=function(){var n=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,n};Be.ByteStringBuffer.prototype.getInt24=function(){var n=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,n};Be.ByteStringBuffer.prototype.getInt32=function(){var n=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,n};Be.ByteStringBuffer.prototype.getInt16Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,n};Be.ByteStringBuffer.prototype.getInt24Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,n};Be.ByteStringBuffer.prototype.getInt32Le=function(){var n=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,n};Be.ByteStringBuffer.prototype.getInt=function(n){M_(n);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),n-=8;while(n>0);return e};Be.ByteStringBuffer.prototype.getSignedInt=function(n){var e=this.getInt(n),t=2<<n-2;return e>=t&&(e-=t<<1),e};Be.ByteStringBuffer.prototype.getBytes=function(n){var e;return n?(n=Math.min(this.length(),n),e=this.data.slice(this.read,this.read+n),this.read+=n):n===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};Be.ByteStringBuffer.prototype.bytes=function(n){return typeof n>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+n)};Be.ByteStringBuffer.prototype.at=function(n){return this.data.charCodeAt(this.read+n)};Be.ByteStringBuffer.prototype.setAt=function(n,e){return this.data=this.data.substr(0,this.read+n)+String.fromCharCode(e)+this.data.substr(this.read+n+1),this};Be.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};Be.ByteStringBuffer.prototype.copy=function(){var n=Be.createBuffer(this.data);return n.read=this.read,n};Be.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};Be.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};Be.ByteStringBuffer.prototype.truncate=function(n){var e=Math.max(0,this.length()-n);return this.data=this.data.substr(this.read,e),this.read=0,this};Be.ByteStringBuffer.prototype.toHex=function(){for(var n="",e=this.read;e<this.data.length;++e){var t=this.data.charCodeAt(e);t<16&&(n+="0"),n+=t.toString(16)}return n};Be.ByteStringBuffer.prototype.toString=function(){return Be.decodeUtf8(this.bytes())};function Zge(n,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var t=Be.isArrayBuffer(n),i=Be.isArrayBufferView(n);if(t||i){t?this.data=new DataView(n):this.data=new DataView(n.buffer,n.byteOffset,n.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,n!=null&&this.putBytes(n),"writeOffset"in e&&(this.write=e.writeOffset)}Be.DataBuffer=Zge;Be.DataBuffer.prototype.length=function(){return this.write-this.read};Be.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};Be.DataBuffer.prototype.accommodate=function(n,e){if(this.length()>=n)return this;e=Math.max(e||this.growSize,n);var t=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),i=new Uint8Array(this.length()+e);return i.set(t),this.data=new DataView(i.buffer),this};Be.DataBuffer.prototype.putByte=function(n){return this.accommodate(1),this.data.setUint8(this.write++,n),this};Be.DataBuffer.prototype.fillWithByte=function(n,e){this.accommodate(e);for(var t=0;t<e;++t)this.data.setUint8(n);return this};Be.DataBuffer.prototype.putBytes=function(n,e){if(Be.isArrayBufferView(n)){var t=new Uint8Array(n.buffer,n.byteOffset,n.byteLength),i=t.byteLength-t.byteOffset;this.accommodate(i);var r=new Uint8Array(this.data.buffer,this.write);return r.set(t),this.write+=i,this}if(Be.isArrayBuffer(n)){var t=new Uint8Array(n);this.accommodate(t.byteLength);var r=new Uint8Array(this.data.buffer);return r.set(t,this.write),this.write+=t.byteLength,this}if(n instanceof Be.DataBuffer||typeof n=="object"&&typeof n.read=="number"&&typeof n.write=="number"&&Be.isArrayBufferView(n.data)){var t=new Uint8Array(n.data.byteLength,n.read,n.length());this.accommodate(t.byteLength);var r=new Uint8Array(n.data.byteLength,this.write);return r.set(t),this.write+=t.byteLength,this}if(n instanceof Be.ByteStringBuffer&&(n=n.data,e="binary"),e=e||"binary",typeof n=="string"){var s;if(e==="hex")return this.accommodate(Math.ceil(n.length/2)),s=new Uint8Array(this.data.buffer,this.write),this.write+=Be.binary.hex.decode(n,s,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(n.length/4)*3),s=new Uint8Array(this.data.buffer,this.write),this.write+=Be.binary.base64.decode(n,s,this.write),this;if(e==="utf8"&&(n=Be.encodeUtf8(n),e="binary"),e==="binary"||e==="raw")return this.accommodate(n.length),s=new Uint8Array(this.data.buffer,this.write),this.write+=Be.binary.raw.decode(s),this;if(e==="utf16")return this.accommodate(n.length*2),s=new Uint16Array(this.data.buffer,this.write),this.write+=Be.text.utf16.encode(s),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+n)};Be.DataBuffer.prototype.putBuffer=function(n){return this.putBytes(n),n.clear(),this};Be.DataBuffer.prototype.putString=function(n){return this.putBytes(n,"utf16")};Be.DataBuffer.prototype.putInt16=function(n){return this.accommodate(2),this.data.setInt16(this.write,n),this.write+=2,this};Be.DataBuffer.prototype.putInt24=function(n){return this.accommodate(3),this.data.setInt16(this.write,n>>8&65535),this.data.setInt8(this.write,n>>16&255),this.write+=3,this};Be.DataBuffer.prototype.putInt32=function(n){return this.accommodate(4),this.data.setInt32(this.write,n),this.write+=4,this};Be.DataBuffer.prototype.putInt16Le=function(n){return this.accommodate(2),this.data.setInt16(this.write,n,!0),this.write+=2,this};Be.DataBuffer.prototype.putInt24Le=function(n){return this.accommodate(3),this.data.setInt8(this.write,n>>16&255),this.data.setInt16(this.write,n>>8&65535,!0),this.write+=3,this};Be.DataBuffer.prototype.putInt32Le=function(n){return this.accommodate(4),this.data.setInt32(this.write,n,!0),this.write+=4,this};Be.DataBuffer.prototype.putInt=function(n,e){M_(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,n>>e&255);while(e>0);return this};Be.DataBuffer.prototype.putSignedInt=function(n,e){return M_(e),this.accommodate(e/8),n<0&&(n+=2<<e-1),this.putInt(n,e)};Be.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};Be.DataBuffer.prototype.getInt16=function(){var n=this.data.getInt16(this.read);return this.read+=2,n};Be.DataBuffer.prototype.getInt24=function(){var n=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,n};Be.DataBuffer.prototype.getInt32=function(){var n=this.data.getInt32(this.read);return this.read+=4,n};Be.DataBuffer.prototype.getInt16Le=function(){var n=this.data.getInt16(this.read,!0);return this.read+=2,n};Be.DataBuffer.prototype.getInt24Le=function(){var n=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,n};Be.DataBuffer.prototype.getInt32Le=function(){var n=this.data.getInt32(this.read,!0);return this.read+=4,n};Be.DataBuffer.prototype.getInt=function(n){M_(n);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),n-=8;while(n>0);return e};Be.DataBuffer.prototype.getSignedInt=function(n){var e=this.getInt(n),t=2<<n-2;return e>=t&&(e-=t<<1),e};Be.DataBuffer.prototype.getBytes=function(n){var e;return n?(n=Math.min(this.length(),n),e=this.data.slice(this.read,this.read+n),this.read+=n):n===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};Be.DataBuffer.prototype.bytes=function(n){return typeof n>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+n)};Be.DataBuffer.prototype.at=function(n){return this.data.getUint8(this.read+n)};Be.DataBuffer.prototype.setAt=function(n,e){return this.data.setUint8(n,e),this};Be.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};Be.DataBuffer.prototype.copy=function(){return new Be.DataBuffer(this)};Be.DataBuffer.prototype.compact=function(){if(this.read>0){var n=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(n.byteLength);e.set(n),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};Be.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};Be.DataBuffer.prototype.truncate=function(n){return this.write=Math.max(0,this.length()-n),this.read=Math.min(this.read,this.write),this};Be.DataBuffer.prototype.toHex=function(){for(var n="",e=this.read;e<this.data.byteLength;++e){var t=this.data.getUint8(e);t<16&&(n+="0"),n+=t.toString(16)}return n};Be.DataBuffer.prototype.toString=function(n){var e=new Uint8Array(this.data,this.read,this.length());if(n=n||"utf8",n==="binary"||n==="raw")return Be.binary.raw.encode(e);if(n==="hex")return Be.binary.hex.encode(e);if(n==="base64")return Be.binary.base64.encode(e);if(n==="utf8")return Be.text.utf8.decode(e);if(n==="utf16")return Be.text.utf16.decode(e);throw new Error("Invalid encoding: "+n)};Be.createBuffer=function(n,e){return e=e||"raw",n!==void 0&&e==="utf8"&&(n=Be.encodeUtf8(n)),new Be.ByteBuffer(n)};Be.fillString=function(n,e){for(var t="";e>0;)e&1&&(t+=n),e>>>=1,e>0&&(n+=n);return t};Be.xorBytes=function(n,e,t){for(var i="",r="",s="",o=0,a=0;t>0;--t,++o)r=n.charCodeAt(o)^e.charCodeAt(o),a>=10&&(i+=s,s="",a=0),s+=String.fromCharCode(r),++a;return i+=s,i};Be.hexToBytes=function(n){var e="",t=0;for(n.length&!0&&(t=1,e+=String.fromCharCode(parseInt(n[0],16)));t<n.length;t+=2)e+=String.fromCharCode(parseInt(n.substr(t,2),16));return e};Be.bytesToHex=function(n){return Be.createBuffer(n).toHex()};Be.int32ToBytes=function(n){return String.fromCharCode(n>>24&255)+String.fromCharCode(n>>16&255)+String.fromCharCode(n>>8&255)+String.fromCharCode(n&255)};var Xf="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Qf=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],zX="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";Be.encode64=function(n,e){for(var t="",i="",r,s,o,a=0;a<n.length;)r=n.charCodeAt(a++),s=n.charCodeAt(a++),o=n.charCodeAt(a++),t+=Xf.charAt(r>>2),t+=Xf.charAt((r&3)<<4|s>>4),isNaN(s)?t+="==":(t+=Xf.charAt((s&15)<<2|o>>6),t+=isNaN(o)?"=":Xf.charAt(o&63)),e&&t.length>e&&(i+=t.substr(0,e)+`\r
`,t=t.substr(e));return i+=t,i};Be.decode64=function(n){n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",t,i,r,s,o=0;o<n.length;)t=Qf[n.charCodeAt(o++)-43],i=Qf[n.charCodeAt(o++)-43],r=Qf[n.charCodeAt(o++)-43],s=Qf[n.charCodeAt(o++)-43],e+=String.fromCharCode(t<<2|i>>4),r!==64&&(e+=String.fromCharCode((i&15)<<4|r>>2),s!==64&&(e+=String.fromCharCode((r&3)<<6|s)));return e};Be.encodeUtf8=function(n){return unescape(encodeURIComponent(n))};Be.decodeUtf8=function(n){return decodeURIComponent(escape(n))};Be.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:WF.encode,decode:WF.decode}};Be.binary.raw.encode=function(n){return String.fromCharCode.apply(null,n)};Be.binary.raw.decode=function(n,e,t){var i=e;i||(i=new Uint8Array(n.length)),t=t||0;for(var r=t,s=0;s<n.length;++s)i[r++]=n.charCodeAt(s);return e?r-t:i};Be.binary.hex.encode=Be.bytesToHex;Be.binary.hex.decode=function(n,e,t){var i=e;i||(i=new Uint8Array(Math.ceil(n.length/2))),t=t||0;var r=0,s=t;for(n.length&1&&(r=1,i[s++]=parseInt(n[0],16));r<n.length;r+=2)i[s++]=parseInt(n.substr(r,2),16);return e?s-t:i};Be.binary.base64.encode=function(n,e){for(var t="",i="",r,s,o,a=0;a<n.byteLength;)r=n[a++],s=n[a++],o=n[a++],t+=Xf.charAt(r>>2),t+=Xf.charAt((r&3)<<4|s>>4),isNaN(s)?t+="==":(t+=Xf.charAt((s&15)<<2|o>>6),t+=isNaN(o)?"=":Xf.charAt(o&63)),e&&t.length>e&&(i+=t.substr(0,e)+`\r
`,t=t.substr(e));return i+=t,i};Be.binary.base64.decode=function(n,e,t){var i=e;i||(i=new Uint8Array(Math.ceil(n.length/4)*3)),n=n.replace(/[^A-Za-z0-9\+\/\=]/g,""),t=t||0;for(var r,s,o,a,l=0,c=t;l<n.length;)r=Qf[n.charCodeAt(l++)-43],s=Qf[n.charCodeAt(l++)-43],o=Qf[n.charCodeAt(l++)-43],a=Qf[n.charCodeAt(l++)-43],i[c++]=r<<2|s>>4,o!==64&&(i[c++]=(s&15)<<4|o>>2,a!==64&&(i[c++]=(o&3)<<6|a));return e?c-t:i.subarray(0,c)};Be.binary.base58.encode=function(n,e){return Be.binary.baseN.encode(n,zX,e)};Be.binary.base58.decode=function(n,e){return Be.binary.baseN.decode(n,zX,e)};Be.text={utf8:{},utf16:{}};Be.text.utf8.encode=function(n,e,t){n=Be.encodeUtf8(n);var i=e;i||(i=new Uint8Array(n.length)),t=t||0;for(var r=t,s=0;s<n.length;++s)i[r++]=n.charCodeAt(s);return e?r-t:i};Be.text.utf8.decode=function(n){return Be.decodeUtf8(String.fromCharCode.apply(null,n))};Be.text.utf16.encode=function(n,e,t){var i=e;i||(i=new Uint8Array(n.length*2));var r=new Uint16Array(i.buffer);t=t||0;for(var s=t,o=t,a=0;a<n.length;++a)r[o++]=n.charCodeAt(a),s+=2;return e?s-t:i};Be.text.utf16.decode=function(n){return String.fromCharCode.apply(null,new Uint16Array(n.buffer))};Be.deflate=function(n,e,t){if(e=Be.decode64(n.deflate(Be.encode64(e)).rval),t){var i=2,r=e.charCodeAt(1);r&32&&(i=6),e=e.substring(i,e.length-4)}return e};Be.inflate=function(n,e,t){var i=n.inflate(Be.encode64(e)).rval;return i===null?null:Be.decode64(i)};var fL=function(n,e,t){if(!n)throw new Error("WebStorage not available.");var i;if(t===null?i=n.removeItem(e):(t=Be.encode64(JSON.stringify(t)),i=n.setItem(e,t)),typeof i<"u"&&i.rval!==!0){var r=new Error(i.error.message);throw r.id=i.error.id,r.name=i.error.name,r}},pL=function(n,e){if(!n)throw new Error("WebStorage not available.");var t=n.getItem(e);if(n.init)if(t.rval===null){if(t.error){var i=new Error(t.error.message);throw i.id=t.error.id,i.name=t.error.name,i}t=null}else t=t.rval;return t!==null&&(t=JSON.parse(Be.decode64(t))),t},Yge=function(n,e,t,i){var r=pL(n,e);r===null&&(r={}),r[t]=i,fL(n,e,r)},Xge=function(n,e,t){var i=pL(n,e);return i!==null&&(i=t in i?i[t]:null),i},Qge=function(n,e,t){var i=pL(n,e);if(i!==null&&t in i){delete i[t];var r=!0;for(var s in i){r=!1;break}r&&(i=null),fL(n,e,i)}},Jge=function(n,e){fL(n,e,null)},D7=function(n,e,t){var i=null;typeof t>"u"&&(t=["web","flash"]);var r,s=!1,o=null;for(var a in t){r=t[a];try{if(r==="flash"||r==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");i=n.apply(this,e),s=r==="flash"}(r==="web"||r==="both")&&(e[0]=localStorage,i=n.apply(this,e),s=!0)}catch(l){o=l}if(s)break}if(!s)throw o;return i};Be.setItem=function(n,e,t,i,r){D7(Yge,arguments,r)};Be.getItem=function(n,e,t,i){return D7(Xge,arguments,i)};Be.removeItem=function(n,e,t,i){D7(Qge,arguments,i)};Be.clearItems=function(n,e,t){D7(Jge,arguments,t)};Be.isEmpty=function(n){for(var e in n)if(n.hasOwnProperty(e))return!1;return!0};Be.format=function(n){for(var e=/%./g,t,i,r=0,s=[],o=0;t=e.exec(n);){i=n.substring(o,e.lastIndex-2),i.length>0&&s.push(i),o=e.lastIndex;var a=t[0][1];switch(a){case"s":case"o":r<arguments.length?s.push(arguments[r+++1]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(n.substring(o)),s.join("")};Be.formatNumber=function(n,e,t,i){var r=n,s=isNaN(e=Math.abs(e))?2:e,o=t===void 0?",":t,a=i===void 0?".":i,l=r<0?"-":"",c=parseInt(r=Math.abs(+r||0).toFixed(s),10)+"",u=c.length>3?c.length%3:0;return l+(u?c.substr(0,u)+a:"")+c.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(r-c).toFixed(s).slice(2):"")};Be.formatSize=function(n){return n>=1073741824?n=Be.formatNumber(n/1073741824,2,".","")+" GiB":n>=1048576?n=Be.formatNumber(n/1048576,2,".","")+" MiB":n>=1024?n=Be.formatNumber(n/1024,0)+" KiB":n=Be.formatNumber(n,0)+" bytes",n};Be.bytesFromIP=function(n){return n.indexOf(".")!==-1?Be.bytesFromIPv4(n):n.indexOf(":")!==-1?Be.bytesFromIPv6(n):null};Be.bytesFromIPv4=function(n){if(n=n.split("."),n.length!==4)return null;for(var e=Be.createBuffer(),t=0;t<n.length;++t){var i=parseInt(n[t],10);if(isNaN(i))return null;e.putByte(i)}return e.getBytes()};Be.bytesFromIPv6=function(n){var e=0;n=n.split(":").filter(function(o){return o.length===0&&++e,!0});for(var t=(8-n.length+e)*2,i=Be.createBuffer(),r=0;r<8;++r){if(!n[r]||n[r].length===0){i.fillWithByte(0,t),t=0;continue}var s=Be.hexToBytes(n[r]);s.length<2&&i.putByte(0),i.putBytes(s)}return i.getBytes()};Be.bytesToIP=function(n){return n.length===4?Be.bytesToIPv4(n):n.length===16?Be.bytesToIPv6(n):null};Be.bytesToIPv4=function(n){if(n.length!==4)return null;for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e.join(".")};Be.bytesToIPv6=function(n){if(n.length!==16)return null;for(var e=[],t=[],i=0,r=0;r<n.length;r+=2){for(var s=Be.bytesToHex(n[r]+n[r+1]);s[0]==="0"&&s!=="0";)s=s.substr(1);if(s==="0"){var o=t[t.length-1],a=e.length;!o||a!==o.end+1?t.push({start:a,end:a}):(o.end=a,o.end-o.start>t[i].end-t[i].start&&(i=t.length-1))}e.push(s)}if(t.length>0){var l=t[i];l.end-l.start>0&&(e.splice(l.start,l.end-l.start+1,""),l.start===0&&e.unshift(""),l.end===7&&e.push(""))}return e.join(":")};Be.estimateCores=function(n,e){if(typeof n=="function"&&(e=n,n={}),n=n||{},"cores"in Be&&!n.update)return e(null,Be.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return Be.cores=navigator.hardwareConcurrency,e(null,Be.cores);if(typeof Worker>"u")return Be.cores=1,e(null,Be.cores);if(typeof Blob>"u")return Be.cores=2,e(null,Be.cores);var t=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){var a=Date.now(),l=a+4;self.postMessage({st:a,et:l})})}.toString(),")()"],{type:"application/javascript"}));i([],5,16);function i(o,a,l){if(a===0){var c=Math.floor(o.reduce(function(u,h){return u+h},0)/o.length);return Be.cores=Math.max(1,c),URL.revokeObjectURL(t),e(null,Be.cores)}r(l,function(u,h){o.push(s(l,h)),i(o,a-1,l)})}function r(o,a){for(var l=[],c=[],u=0;u<o;++u){var h=new Worker(t);h.addEventListener("message",function(p){if(c.push(p.data),c.length===o){for(var m=0;m<o;++m)l[m].terminate();a(null,c)}}),l.push(h)}for(var u=0;u<o;++u)l[u].postMessage(u)}function s(o,a){for(var l=[],c=0;c<o;++c)for(var u=a[c],h=l[c]=[],p=0;p<o;++p)if(c!==p){var m=a[p];(u.st>m.st&&u.st<m.et||m.st>u.st&&m.st<u.et)&&h.push(p)}return l.reduce(function(y,b){return Math.max(y,b.length)},0)}};var b3=Vr;b3.pki=b3.pki||{};var SI=b3.pki.oids=b3.oids=b3.oids||{};function kt(n,e){SI[n]=e,SI[e]=n}function qi(n,e){SI[n]=e}kt("1.2.840.113549.1.1.1","rsaEncryption");kt("1.2.840.113549.1.1.4","md5WithRSAEncryption");kt("1.2.840.113549.1.1.5","sha1WithRSAEncryption");kt("1.2.840.113549.1.1.7","RSAES-OAEP");kt("1.2.840.113549.1.1.8","mgf1");kt("1.2.840.113549.1.1.9","pSpecified");kt("1.2.840.113549.1.1.10","RSASSA-PSS");kt("1.2.840.113549.1.1.11","sha256WithRSAEncryption");kt("1.2.840.113549.1.1.12","sha384WithRSAEncryption");kt("1.2.840.113549.1.1.13","sha512WithRSAEncryption");kt("1.3.101.112","EdDSA25519");kt("1.2.840.10040.4.3","dsa-with-sha1");kt("1.3.14.3.2.7","desCBC");kt("1.3.14.3.2.26","sha1");kt("1.3.14.3.2.29","sha1WithRSASignature");kt("2.16.840.1.101.3.4.2.1","sha256");kt("2.16.840.1.101.3.4.2.2","sha384");kt("2.16.840.1.101.3.4.2.3","sha512");kt("2.16.840.1.101.3.4.2.4","sha224");kt("2.16.840.1.101.3.4.2.5","sha512-224");kt("2.16.840.1.101.3.4.2.6","sha512-256");kt("1.2.840.113549.2.2","md2");kt("1.2.840.113549.2.5","md5");kt("1.2.840.113549.1.7.1","data");kt("1.2.840.113549.1.7.2","signedData");kt("1.2.840.113549.1.7.3","envelopedData");kt("1.2.840.113549.1.7.4","signedAndEnvelopedData");kt("1.2.840.113549.1.7.5","digestedData");kt("1.2.840.113549.1.7.6","encryptedData");kt("1.2.840.113549.1.9.1","emailAddress");kt("1.2.840.113549.1.9.2","unstructuredName");kt("1.2.840.113549.1.9.3","contentType");kt("1.2.840.113549.1.9.4","messageDigest");kt("1.2.840.113549.1.9.5","signingTime");kt("1.2.840.113549.1.9.6","counterSignature");kt("1.2.840.113549.1.9.7","challengePassword");kt("1.2.840.113549.1.9.8","unstructuredAddress");kt("1.2.840.113549.1.9.14","extensionRequest");kt("1.2.840.113549.1.9.20","friendlyName");kt("1.2.840.113549.1.9.21","localKeyId");kt("1.2.840.113549.1.9.22.1","x509Certificate");kt("1.2.840.113549.1.12.10.1.1","keyBag");kt("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");kt("1.2.840.113549.1.12.10.1.3","certBag");kt("1.2.840.113549.1.12.10.1.4","crlBag");kt("1.2.840.113549.1.12.10.1.5","secretBag");kt("1.2.840.113549.1.12.10.1.6","safeContentsBag");kt("1.2.840.113549.1.5.13","pkcs5PBES2");kt("1.2.840.113549.1.5.12","pkcs5PBKDF2");kt("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");kt("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");kt("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");kt("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");kt("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");kt("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");kt("1.2.840.113549.2.7","hmacWithSHA1");kt("1.2.840.113549.2.8","hmacWithSHA224");kt("1.2.840.113549.2.9","hmacWithSHA256");kt("1.2.840.113549.2.10","hmacWithSHA384");kt("1.2.840.113549.2.11","hmacWithSHA512");kt("1.2.840.113549.3.7","des-EDE3-CBC");kt("2.16.840.1.101.3.4.1.2","aes128-CBC");kt("2.16.840.1.101.3.4.1.22","aes192-CBC");kt("2.16.840.1.101.3.4.1.42","aes256-CBC");kt("2.5.4.3","commonName");kt("2.5.4.4","surname");kt("2.5.4.5","serialNumber");kt("2.5.4.6","countryName");kt("2.5.4.7","localityName");kt("2.5.4.8","stateOrProvinceName");kt("2.5.4.9","streetAddress");kt("2.5.4.10","organizationName");kt("2.5.4.11","organizationalUnitName");kt("2.5.4.12","title");kt("2.5.4.13","description");kt("2.5.4.15","businessCategory");kt("2.5.4.17","postalCode");kt("2.5.4.42","givenName");kt("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");kt("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");kt("2.16.840.1.113730.1.1","nsCertType");kt("2.16.840.1.113730.1.13","nsComment");qi("2.5.29.1","authorityKeyIdentifier");qi("2.5.29.2","keyAttributes");qi("2.5.29.3","certificatePolicies");qi("2.5.29.4","keyUsageRestriction");qi("2.5.29.5","policyMapping");qi("2.5.29.6","subtreesConstraint");qi("2.5.29.7","subjectAltName");qi("2.5.29.8","issuerAltName");qi("2.5.29.9","subjectDirectoryAttributes");qi("2.5.29.10","basicConstraints");qi("2.5.29.11","nameConstraints");qi("2.5.29.12","policyConstraints");qi("2.5.29.13","basicConstraints");kt("2.5.29.14","subjectKeyIdentifier");kt("2.5.29.15","keyUsage");qi("2.5.29.16","privateKeyUsagePeriod");kt("2.5.29.17","subjectAltName");kt("2.5.29.18","issuerAltName");kt("2.5.29.19","basicConstraints");qi("2.5.29.20","cRLNumber");qi("2.5.29.21","cRLReason");qi("2.5.29.22","expirationDate");qi("2.5.29.23","instructionCode");qi("2.5.29.24","invalidityDate");qi("2.5.29.25","cRLDistributionPoints");qi("2.5.29.26","issuingDistributionPoint");qi("2.5.29.27","deltaCRLIndicator");qi("2.5.29.28","issuingDistributionPoint");qi("2.5.29.29","certificateIssuer");qi("2.5.29.30","nameConstraints");kt("2.5.29.31","cRLDistributionPoints");kt("2.5.29.32","certificatePolicies");qi("2.5.29.33","policyMappings");qi("2.5.29.34","policyConstraints");kt("2.5.29.35","authorityKeyIdentifier");qi("2.5.29.36","policyConstraints");kt("2.5.29.37","extKeyUsage");qi("2.5.29.46","freshestCRL");qi("2.5.29.54","inhibitAnyPolicy");kt("1.3.6.1.4.1.11129.2.4.2","timestampList");kt("1.3.6.1.5.5.7.1.1","authorityInfoAccess");kt("1.3.6.1.5.5.7.3.1","serverAuth");kt("1.3.6.1.5.5.7.3.2","clientAuth");kt("1.3.6.1.5.5.7.3.3","codeSigning");kt("1.3.6.1.5.5.7.3.4","emailProtection");kt("1.3.6.1.5.5.7.3.8","timeStamping");var Ar=Vr,Zt=Ar.asn1=Ar.asn1||{};Zt.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};Zt.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};Zt.maxDepth=256;Zt.create=function(n,e,t,i,r){if(Ar.util.isArray(i)){for(var s=[],o=0;o<i.length;++o)i[o]!==void 0&&s.push(i[o]);i=s}var a={tagClass:n,type:e,constructed:t,composed:t||Ar.util.isArray(i),value:i};return r&&"bitStringContents"in r&&(a.bitStringContents=r.bitStringContents,a.original=Zt.copy(a)),a};Zt.copy=function(n,e){var t;if(Ar.util.isArray(n)){t=[];for(var i=0;i<n.length;++i)t.push(Zt.copy(n[i],e));return t}return typeof n=="string"?n:(t={tagClass:n.tagClass,type:n.type,constructed:n.constructed,composed:n.composed,value:Zt.copy(n.value,e)},e&&!e.excludeBitStringContents&&(t.bitStringContents=n.bitStringContents),t)};Zt.equals=function(n,e,t){if(Ar.util.isArray(n)){if(!Ar.util.isArray(e)||n.length!==e.length)return!1;for(var i=0;i<n.length;++i)if(!Zt.equals(n[i],e[i]))return!1;return!0}if(typeof n!=typeof e)return!1;if(typeof n=="string")return n===e;var r=n.tagClass===e.tagClass&&n.type===e.type&&n.constructed===e.constructed&&n.composed===e.composed&&Zt.equals(n.value,e.value);return t&&t.includeBitStringContents&&(r=r&&n.bitStringContents===e.bitStringContents),r};Zt.getBerValueLength=function(n){var e=n.getByte();if(e!==128){var t,i=e&128;return i?t=n.getInt((e&127)<<3):t=e,t}};function Jv(n,e,t){if(t>e){var i=new Error("Too few bytes to parse DER.");throw i.available=n.length(),i.remaining=e,i.requested=t,i}}var eye=function(n,e){var t=n.getByte();if(e--,t!==128){var i,r=t&128;if(!r)i=t;else{var s=t&127;Jv(n,e,s),i=n.getInt(s<<3)}if(i<0)throw new Error("Negative length: "+i);return i}};Zt.fromDer=function(n,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),"maxDepth"in e||(e.maxDepth=Zt.maxDepth),typeof n=="string"&&(n=Ar.util.createBuffer(n));var t=n.length(),i=SS(n,n.length(),0,e);if(e.parseAllBytes&&n.length()!==0){var r=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw r.byteCount=t,r.remaining=n.length(),r}return i};function SS(n,e,t,i){if(t>=i.maxDepth)throw new Error("ASN.1 parsing error: Max depth exceeded.");var r;Jv(n,e,2);var s=n.getByte();e--;var o=s&192,a=s&31;r=n.length();var l=eye(n,e);if(e-=r-n.length(),l!==void 0&&l>e){if(i.strict){var c=new Error("Too few bytes to read ASN.1 value.");throw c.available=n.length(),c.remaining=e,c.requested=l,c}l=e}var u,h,p=(s&32)===32;if(p)if(u=[],l===void 0)for(;;){if(Jv(n,e,2),n.bytes(2)===String.fromCharCode(0,0)){n.getBytes(2),e-=2;break}r=n.length(),u.push(SS(n,e,t+1,i)),e-=r-n.length()}else for(;l>0;)r=n.length(),u.push(SS(n,l,t+1,i)),e-=r-n.length(),l-=r-n.length();if(u===void 0&&o===Zt.Class.UNIVERSAL&&a===Zt.Type.BITSTRING&&(h=n.bytes(l)),u===void 0&&i.decodeBitStrings&&o===Zt.Class.UNIVERSAL&&a===Zt.Type.BITSTRING&&l>1){var m=n.read,y=e,b=0;if(a===Zt.Type.BITSTRING&&(Jv(n,e,1),b=n.getByte(),e--),b===0)try{r=n.length();var w={strict:!0,decodeBitStrings:!0},v=SS(n,e,t+1,w),T=r-n.length();e-=T,a==Zt.Type.BITSTRING&&T++;var S=v.tagClass;T===l&&(S===Zt.Class.UNIVERSAL||S===Zt.Class.CONTEXT_SPECIFIC)&&(u=[v])}catch{}u===void 0&&(n.read=m,e=y)}if(u===void 0){if(l===void 0){if(i.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");l=e}if(a===Zt.Type.BMPSTRING)for(u="";l>0;l-=2)Jv(n,e,2),u+=String.fromCharCode(n.getInt16()),e-=2;else u=n.getBytes(l),e-=l}var M=h===void 0?null:{bitStringContents:h};return Zt.create(o,a,p,u,M)}Zt.toDer=function(n){var e=Ar.util.createBuffer(),t=n.tagClass|n.type,i=Ar.util.createBuffer(),r=!1;if("bitStringContents"in n&&(r=!0,n.original&&(r=Zt.equals(n,n.original))),r)i.putBytes(n.bitStringContents);else if(n.composed){n.constructed?t|=32:i.putByte(0);for(var s=0;s<n.value.length;++s)n.value[s]!==void 0&&i.putBuffer(Zt.toDer(n.value[s]))}else if(n.type===Zt.Type.BMPSTRING)for(var s=0;s<n.value.length;++s)i.putInt16(n.value.charCodeAt(s));else n.type===Zt.Type.INTEGER&&n.value.length>1&&(n.value.charCodeAt(0)===0&&!(n.value.charCodeAt(1)&128)||n.value.charCodeAt(0)===255&&(n.value.charCodeAt(1)&128)===128)?i.putBytes(n.value.substr(1)):i.putBytes(n.value);if(e.putByte(t),i.length()<=127)e.putByte(i.length()&127);else{var o=i.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var s=a.length-1;s>=0;--s)e.putByte(a.charCodeAt(s))}return e.putBuffer(i),e};Zt.oidToDer=function(n){var e=n.split("."),t=Ar.util.createBuffer();t.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var i,r,s,o,a=2;a<e.length;++a){if(i=!0,r=[],s=parseInt(e[a],10),s>4294967295)throw new Error("OID value too large; max is 32-bits.");do o=s&127,s=s>>>7,i||(o|=128),r.push(o),i=!1;while(s>0);for(var l=r.length-1;l>=0;--l)t.putByte(r[l])}return t};Zt.derToOid=function(n){var e;typeof n=="string"&&(n=Ar.util.createBuffer(n));var t=n.getByte();e=Math.floor(t/40)+"."+t%40;for(var i=0;n.length()>0;){if(i>70368744177663)throw new Error("OID value too large; max is 53-bits.");t=n.getByte(),i=i*128,t&128?i+=t&127:(e+="."+(i+t),i=0)}return e};Zt.utcTimeToDate=function(n){var e=new Date,t=parseInt(n.substr(0,2),10);t=t>=50?1900+t:2e3+t;var i=parseInt(n.substr(2,2),10)-1,r=parseInt(n.substr(4,2),10),s=parseInt(n.substr(6,2),10),o=parseInt(n.substr(8,2),10),a=0;if(n.length>11){var l=n.charAt(10),c=10;l!=="+"&&l!=="-"&&(a=parseInt(n.substr(10,2),10),c+=2)}if(e.setUTCFullYear(t,i,r),e.setUTCHours(s,o,a,0),c&&(l=n.charAt(c),l==="+"||l==="-")){var u=parseInt(n.substr(c+1,2),10),h=parseInt(n.substr(c+4,2),10),p=u*60+h;p*=6e4,l==="+"?e.setTime(+e-p):e.setTime(+e+p)}return e};Zt.generalizedTimeToDate=function(n){var e=new Date,t=parseInt(n.substr(0,4),10),i=parseInt(n.substr(4,2),10)-1,r=parseInt(n.substr(6,2),10),s=parseInt(n.substr(8,2),10),o=parseInt(n.substr(10,2),10),a=parseInt(n.substr(12,2),10),l=0,c=0,u=!1;n.charAt(n.length-1)==="Z"&&(u=!0);var h=n.length-5,p=n.charAt(h);if(p==="+"||p==="-"){var m=parseInt(n.substr(h+1,2),10),y=parseInt(n.substr(h+4,2),10);c=m*60+y,c*=6e4,p==="+"&&(c*=-1),u=!0}return n.charAt(14)==="."&&(l=parseFloat(n.substr(14),10)*1e3),u?(e.setUTCFullYear(t,i,r),e.setUTCHours(s,o,a,l),e.setTime(+e+c)):(e.setFullYear(t,i,r),e.setHours(s,o,a,l)),e};Zt.dateToUtcTime=function(n){if(typeof n=="string")return n;var e="",t=[];t.push((""+n.getUTCFullYear()).substr(2)),t.push(""+(n.getUTCMonth()+1)),t.push(""+n.getUTCDate()),t.push(""+n.getUTCHours()),t.push(""+n.getUTCMinutes()),t.push(""+n.getUTCSeconds());for(var i=0;i<t.length;++i)t[i].length<2&&(e+="0"),e+=t[i];return e+="Z",e};Zt.dateToGeneralizedTime=function(n){if(typeof n=="string")return n;var e="",t=[];t.push(""+n.getUTCFullYear()),t.push(""+(n.getUTCMonth()+1)),t.push(""+n.getUTCDate()),t.push(""+n.getUTCHours()),t.push(""+n.getUTCMinutes()),t.push(""+n.getUTCSeconds());for(var i=0;i<t.length;++i)t[i].length<2&&(e+="0"),e+=t[i];return e+="Z",e};Zt.integerToDer=function(n){var e=Ar.util.createBuffer();if(n>=-128&&n<128)return e.putSignedInt(n,8);if(n>=-32768&&n<32768)return e.putSignedInt(n,16);if(n>=-8388608&&n<8388608)return e.putSignedInt(n,24);if(n>=-2147483648&&n<2147483648)return e.putSignedInt(n,32);var t=new Error("Integer too large; max is 32-bits.");throw t.integer=n,t};Zt.derToInteger=function(n){typeof n=="string"&&(n=Ar.util.createBuffer(n));var e=n.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return n.getSignedInt(e)};Zt.validate=function(n,e,t,i){var r=!1;if((n.tagClass===e.tagClass||typeof e.tagClass>"u")&&(n.type===e.type||typeof e.type>"u"))if(n.constructed===e.constructed||typeof e.constructed>"u"){if(r=!0,e.value&&Ar.util.isArray(e.value))for(var s=0,o=0;r&&o<e.value.length;++o){var a=e.value[o];r=!!a.optional;var l=n.value[s];if(!l){a.optional||(r=!1,i&&i.push("["+e.name+'] Missing required element. Expected tag class "'+a.tagClass+'", type "'+a.type+'"'));continue}var c=typeof a.tagClass<"u"&&typeof a.type<"u";if(c&&(l.tagClass!==a.tagClass||l.type!==a.type))if(a.optional){r=!0;continue}else{r=!1,i&&i.push("["+e.name+"] Tag mismatch. Expected ("+a.tagClass+","+a.type+"), got ("+l.tagClass+","+l.type+")");break}var u=Zt.validate(l,a,t,i);if(u)++s,r=!0;else if(a.optional)r=!0;else{r=!1;break}}if(r&&t&&(e.capture&&(t[e.capture]=n.value),e.captureAsn1&&(t[e.captureAsn1]=n),e.captureBitStringContents&&"bitStringContents"in n&&(t[e.captureBitStringContents]=n.bitStringContents),e.captureBitStringValue&&"bitStringContents"in n))if(n.bitStringContents.length<2)t[e.captureBitStringValue]="";else{var h=n.bitStringContents.charCodeAt(0);if(h!==0)throw new Error("captureBitStringValue only supported for zero unused bits");t[e.captureBitStringValue]=n.bitStringContents.slice(1)}}else i&&i.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+n.constructed+'"');else i&&(n.tagClass!==e.tagClass&&i.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+n.tagClass+'"'),n.type!==e.type&&i.push("["+e.name+'] Expected type "'+e.type+'", got "'+n.type+'"'));return r};var KF=/[^\\u0000-\\u00ff]/;Zt.prettyPrint=function(n,e,t){var i="";e=e||0,t=t||2,e>0&&(i+=`
`);for(var r="",s=0;s<e*t;++s)r+=" ";switch(i+=r+"Tag: ",n.tagClass){case Zt.Class.UNIVERSAL:i+="Universal:";break;case Zt.Class.APPLICATION:i+="Application:";break;case Zt.Class.CONTEXT_SPECIFIC:i+="Context-Specific:";break;case Zt.Class.PRIVATE:i+="Private:";break}if(n.tagClass===Zt.Class.UNIVERSAL)switch(i+=n.type,n.type){case Zt.Type.NONE:i+=" (None)";break;case Zt.Type.BOOLEAN:i+=" (Boolean)";break;case Zt.Type.INTEGER:i+=" (Integer)";break;case Zt.Type.BITSTRING:i+=" (Bit string)";break;case Zt.Type.OCTETSTRING:i+=" (Octet string)";break;case Zt.Type.NULL:i+=" (Null)";break;case Zt.Type.OID:i+=" (Object Identifier)";break;case Zt.Type.ODESC:i+=" (Object Descriptor)";break;case Zt.Type.EXTERNAL:i+=" (External or Instance of)";break;case Zt.Type.REAL:i+=" (Real)";break;case Zt.Type.ENUMERATED:i+=" (Enumerated)";break;case Zt.Type.EMBEDDED:i+=" (Embedded PDV)";break;case Zt.Type.UTF8:i+=" (UTF8)";break;case Zt.Type.ROID:i+=" (Relative Object Identifier)";break;case Zt.Type.SEQUENCE:i+=" (Sequence)";break;case Zt.Type.SET:i+=" (Set)";break;case Zt.Type.PRINTABLESTRING:i+=" (Printable String)";break;case Zt.Type.IA5String:i+=" (IA5String (ASCII))";break;case Zt.Type.UTCTIME:i+=" (UTC time)";break;case Zt.Type.GENERALIZEDTIME:i+=" (Generalized time)";break;case Zt.Type.BMPSTRING:i+=" (BMP String)";break}else i+=n.type;if(i+=`
`,i+=r+"Constructed: "+n.constructed+`
`,n.composed){for(var o=0,a="",s=0;s<n.value.length;++s)n.value[s]!==void 0&&(o+=1,a+=Zt.prettyPrint(n.value[s],e+1,t),s+1<n.value.length&&(a+=","));i+=r+"Sub values: "+o+a}else{if(i+=r+"Value: ",n.type===Zt.Type.OID){var l=Zt.derToOid(n.value);i+=l,Ar.pki&&Ar.pki.oids&&l in Ar.pki.oids&&(i+=" ("+Ar.pki.oids[l]+") ")}if(n.type===Zt.Type.INTEGER)try{i+=Zt.derToInteger(n.value)}catch{i+="0x"+Ar.util.bytesToHex(n.value)}else if(n.type===Zt.Type.BITSTRING){if(n.value.length>1?i+="0x"+Ar.util.bytesToHex(n.value.slice(1)):i+="(none)",n.value.length>0){var c=n.value.charCodeAt(0);c==1?i+=" (1 unused bit shown)":c>1&&(i+=" ("+c+" unused bits shown)")}}else if(n.type===Zt.Type.OCTETSTRING)KF.test(n.value)||(i+="("+n.value+") "),i+="0x"+Ar.util.bytesToHex(n.value);else if(n.type===Zt.Type.UTF8)try{i+=Ar.util.decodeUtf8(n.value)}catch(u){if(u.message==="URI malformed")i+="0x"+Ar.util.bytesToHex(n.value)+" (malformed UTF8)";else throw u}else n.type===Zt.Type.PRINTABLESTRING||n.type===Zt.Type.IA5String?i+=n.value:KF.test(n.value)?i+="0x"+Ar.util.bytesToHex(n.value):n.value.length===0?i+="[null]":i+=n.value}return i};var Vs=Vr;Vs.cipher=Vs.cipher||{};Vs.cipher.algorithms=Vs.cipher.algorithms||{};Vs.cipher.createCipher=function(n,e){var t=n;if(typeof t=="string"&&(t=Vs.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+n);return new Vs.cipher.BlockCipher({algorithm:t,key:e,decrypt:!1})};Vs.cipher.createDecipher=function(n,e){var t=n;if(typeof t=="string"&&(t=Vs.cipher.getAlgorithm(t),t&&(t=t())),!t)throw new Error("Unsupported algorithm: "+n);return new Vs.cipher.BlockCipher({algorithm:t,key:e,decrypt:!0})};Vs.cipher.registerAlgorithm=function(n,e){n=n.toUpperCase(),Vs.cipher.algorithms[n]=e};Vs.cipher.getAlgorithm=function(n){return n=n.toUpperCase(),n in Vs.cipher.algorithms?Vs.cipher.algorithms[n]:null};var mL=Vs.cipher.BlockCipher=function(n){this.algorithm=n.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=n.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=n.decrypt,this.algorithm.initialize(n)};mL.prototype.start=function(n){n=n||{};var e={};for(var t in n)e[t]=n[t];e.decrypt=this._decrypt,this._finish=!1,this._input=Vs.util.createBuffer(),this.output=n.output||Vs.util.createBuffer(),this.mode.start(e)};mL.prototype.update=function(n){for(n&&this._input.putBuffer(n);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};mL.prototype.finish=function(n){n&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(t){return n(this.blockSize,t,!1)},this.mode.unpad=function(t){return n(this.blockSize,t,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))};var zs=Vr;zs.cipher=zs.cipher||{};var ci=zs.cipher.modes=zs.cipher.modes||{};ci.ecb=function(n){n=n||{},this.name="ECB",this.cipher=n.cipher,this.blockSize=n.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};ci.ecb.prototype.start=function(n){};ci.ecb.prototype.encrypt=function(n,e,t){if(n.length()<this.blockSize&&!(t&&n.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=n.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i])};ci.ecb.prototype.decrypt=function(n,e,t){if(n.length()<this.blockSize&&!(t&&n.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=n.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i])};ci.ecb.prototype.pad=function(n,e){var t=n.length()===this.blockSize?this.blockSize:this.blockSize-n.length();return n.fillWithByte(t,t),!0};ci.ecb.prototype.unpad=function(n,e){if(e.overflow>0)return!1;var t=n.length(),i=n.at(t-1);return i>this.blockSize<<2?!1:(n.truncate(i),!0)};ci.cbc=function(n){n=n||{},this.name="CBC",this.cipher=n.cipher,this.blockSize=n.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};ci.cbc.prototype.start=function(n){if(n.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in n)this._iv=O7(n.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};ci.cbc.prototype.encrypt=function(n,e,t){if(n.length()<this.blockSize&&!(t&&n.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=this._prev[i]^n.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]);this._prev=this._outBlock};ci.cbc.prototype.decrypt=function(n,e,t){if(n.length()<this.blockSize&&!(t&&n.length()>0))return!0;for(var i=0;i<this._ints;++i)this._inBlock[i]=n.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._prev[i]^this._outBlock[i]);this._prev=this._inBlock.slice(0)};ci.cbc.prototype.pad=function(n,e){var t=n.length()===this.blockSize?this.blockSize:this.blockSize-n.length();return n.fillWithByte(t,t),!0};ci.cbc.prototype.unpad=function(n,e){if(e.overflow>0)return!1;var t=n.length(),i=n.at(t-1);return i>this.blockSize<<2?!1:(n.truncate(i),!0)};ci.cfb=function(n){n=n||{},this.name="CFB",this.cipher=n.cipher,this.blockSize=n.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=zs.util.createBuffer(),this._partialBytes=0};ci.cfb.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=O7(n.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};ci.cfb.prototype.encrypt=function(n,e,t){var i=n.length();if(i===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&i>=this.blockSize){for(var r=0;r<this._ints;++r)this._inBlock[r]=n.getInt32()^this._outBlock[r],e.putInt32(this._inBlock[r]);return}var s=(this.blockSize-i)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialBlock[r]=n.getInt32()^this._outBlock[r],this._partialOutput.putInt32(this._partialBlock[r]);if(s>0)n.read-=this.blockSize;else for(var r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0};ci.cfb.prototype.decrypt=function(n,e,t){var i=n.length();if(i===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&i>=this.blockSize){for(var r=0;r<this._ints;++r)this._inBlock[r]=n.getInt32(),e.putInt32(this._inBlock[r]^this._outBlock[r]);return}var s=(this.blockSize-i)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialBlock[r]=n.getInt32(),this._partialOutput.putInt32(this._partialBlock[r]^this._outBlock[r]);if(s>0)n.read-=this.blockSize;else for(var r=0;r<this._ints;++r)this._inBlock[r]=this._partialBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0};ci.ofb=function(n){n=n||{},this.name="OFB",this.cipher=n.cipher,this.blockSize=n.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=zs.util.createBuffer(),this._partialBytes=0};ci.ofb.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=O7(n.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};ci.ofb.prototype.encrypt=function(n,e,t){var i=n.length();if(n.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&i>=this.blockSize){for(var r=0;r<this._ints;++r)e.putInt32(n.getInt32()^this._outBlock[r]),this._inBlock[r]=this._outBlock[r];return}var s=(this.blockSize-i)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialOutput.putInt32(n.getInt32()^this._outBlock[r]);if(s>0)n.read-=this.blockSize;else for(var r=0;r<this._ints;++r)this._inBlock[r]=this._outBlock[r];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0};ci.ofb.prototype.decrypt=ci.ofb.prototype.encrypt;ci.ctr=function(n){n=n||{},this.name="CTR",this.cipher=n.cipher,this.blockSize=n.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=zs.util.createBuffer(),this._partialBytes=0};ci.ctr.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");this._iv=O7(n.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};ci.ctr.prototype.encrypt=function(n,e,t){var i=n.length();if(i===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&i>=this.blockSize)for(var r=0;r<this._ints;++r)e.putInt32(n.getInt32()^this._outBlock[r]);else{var s=(this.blockSize-i)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialOutput.putInt32(n.getInt32()^this._outBlock[r]);if(s>0&&(n.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}B7(this._inBlock)};ci.ctr.prototype.decrypt=ci.ctr.prototype.encrypt;ci.gcm=function(n){n=n||{},this.name="GCM",this.cipher=n.cipher,this.blockSize=n.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=zs.util.createBuffer(),this._partialBytes=0,this._R=3774873600};ci.gcm.prototype.start=function(n){if(!("iv"in n))throw new Error("Invalid IV parameter.");var e=zs.util.createBuffer(n.iv);this._cipherLength=0;var t;if("additionalData"in n?t=zs.util.createBuffer(n.additionalData):t=zs.util.createBuffer(),"tagLength"in n?this._tagLength=n.tagLength:this._tagLength=128,this._tag=null,n.decrypt&&(this._tag=zs.util.createBuffer(n.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=e.length();if(i===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(EI(i*8)))}this._inBlock=this._j0.slice(0),B7(this._inBlock),this._partialBytes=0,t=zs.util.createBuffer(t),this._aDataLength=EI(t.length()*8);var r=t.length()%this.blockSize;for(r&&t.fillWithByte(0,this.blockSize-r),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])};ci.gcm.prototype.encrypt=function(n,e,t){var i=n.length();if(i===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&i>=this.blockSize){for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r]^=n.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-i)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(var r=0;r<this._ints;++r)this._partialOutput.putInt32(n.getInt32()^this._outBlock[r]);if(s<=0||t){if(t){var o=i%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var r=0;r<this._ints;++r)this._outBlock[r]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!t)return n.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),B7(this._inBlock)};ci.gcm.prototype.decrypt=function(n,e,t){var i=n.length();if(i<this.blockSize&&!(t&&i>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),B7(this._inBlock),this._hashBlock[0]=n.getInt32(),this._hashBlock[1]=n.getInt32(),this._hashBlock[2]=n.getInt32(),this._hashBlock[3]=n.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var r=0;r<this._ints;++r)e.putInt32(this._outBlock[r]^this._hashBlock[r]);i<this.blockSize?this._cipherLength+=i%this.blockSize:this._cipherLength+=this.blockSize};ci.gcm.prototype.afterFinish=function(n,e){var t=!0;e.decrypt&&e.overflow&&n.truncate(this.blockSize-e.overflow),this.tag=zs.util.createBuffer();var i=this._aDataLength.concat(EI(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,i);var r=[];this.cipher.encrypt(this._j0,r);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^r[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(t=!1),t};ci.gcm.prototype.multiply=function(n,e){for(var t=[0,0,0,0],i=e.slice(0),r=0;r<128;++r){var s=n[r/32|0]&1<<31-r%32;s&&(t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]),this.pow(i,i)}return t};ci.gcm.prototype.pow=function(n,e){for(var t=n[3]&1,i=3;i>0;--i)e[i]=n[i]>>>1|(n[i-1]&1)<<31;e[0]=n[0]>>>1,t&&(e[0]^=this._R)};ci.gcm.prototype.tableMultiply=function(n){for(var e=[0,0,0,0],t=0;t<32;++t){var i=t/8|0,r=n[i]>>>(7-t%8)*4&15,s=this._m[t][r];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e};ci.gcm.prototype.ghash=function(n,e,t){return e[0]^=t[0],e[1]^=t[1],e[2]^=t[2],e[3]^=t[3],this.tableMultiply(e)};ci.gcm.prototype.generateHashTable=function(n,e){for(var t=8/e,i=4*t,r=16*t,s=new Array(r),o=0;o<r;++o){var a=[0,0,0,0],l=o/i|0,c=(i-1-o%i)*e;a[l]=1<<e-1<<c,s[o]=this.generateSubHashTable(this.multiply(a,n),e)}return s};ci.gcm.prototype.generateSubHashTable=function(n,e){var t=1<<e,i=t>>>1,r=new Array(t);r[i]=n.slice(0);for(var s=i>>>1;s>0;)this.pow(r[2*s],r[s]=[]),s>>=1;for(s=2;s<i;){for(var o=1;o<s;++o){var a=r[s],l=r[o];r[s+o]=[a[0]^l[0],a[1]^l[1],a[2]^l[2],a[3]^l[3]]}s*=2}for(r[0]=[0,0,0,0],s=i+1;s<t;++s){var c=r[s^i];r[s]=[n[0]^c[0],n[1]^c[1],n[2]^c[2],n[3]^c[3]]}return r};function O7(n,e){if(typeof n=="string"&&(n=zs.util.createBuffer(n)),zs.util.isArray(n)&&n.length>4){var t=n;n=zs.util.createBuffer();for(var i=0;i<t.length;++i)n.putByte(t[i])}if(n.length()<e)throw new Error("Invalid IV length; got "+n.length()+" bytes and expected "+e+" bytes.");if(!zs.util.isArray(n)){for(var r=[],s=e/4,i=0;i<s;++i)r.push(n.getInt32());n=r}return n}function B7(n){n[n.length-1]=n[n.length-1]+1&4294967295}function EI(n){return[n/4294967296|0,n&4294967295]}var vr=Vr;vr.aes=vr.aes||{};vr.aes.startEncrypting=function(n,e,t,i){var r=U7({key:n,output:t,decrypt:!1,mode:i});return r.start(e),r};vr.aes.createEncryptionCipher=function(n,e){return U7({key:n,output:null,decrypt:!1,mode:e})};vr.aes.startDecrypting=function(n,e,t,i){var r=U7({key:n,output:t,decrypt:!0,mode:i});return r.start(e),r};vr.aes.createDecryptionCipher=function(n,e){return U7({key:n,output:null,decrypt:!0,mode:e})};vr.aes.Algorithm=function(n,e){gL||VX();var t=this;t.name=n,t.mode=new e({blockSize:16,cipher:{encrypt:function(i,r){return AI(t._w,i,r,!1)},decrypt:function(i,r){return AI(t._w,i,r,!0)}}}),t._init=!1};vr.aes.Algorithm.prototype.initialize=function(n){if(!this._init){var e=n.key,t;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=vr.util.createBuffer(e);else if(vr.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){t=e,e=vr.util.createBuffer();for(var i=0;i<t.length;++i)e.putByte(t[i])}if(!vr.util.isArray(e)){t=e,e=[];var r=t.length();if(r===16||r===24||r===32){r=r>>>2;for(var i=0;i<r;++i)e.push(t.getInt32())}}if(!vr.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var s=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(s)!==-1;this._w=HX(e,n.decrypt&&!o),this._init=!0}};vr.aes._expandKey=function(n,e){return gL||VX(),HX(n,e)};vr.aes._updateBlock=AI;cx("AES-ECB",vr.cipher.modes.ecb);cx("AES-CBC",vr.cipher.modes.cbc);cx("AES-CFB",vr.cipher.modes.cfb);cx("AES-OFB",vr.cipher.modes.ofb);cx("AES-CTR",vr.cipher.modes.ctr);cx("AES-GCM",vr.cipher.modes.gcm);function cx(n,e){var t=function(){return new vr.aes.Algorithm(n,e)};vr.cipher.registerAlgorithm(n,t)}var gL=!1,tg=4,na,TI,jX,om,tu;function VX(){gL=!0,jX=[0,1,2,4,8,16,32,64,128,27,54];for(var n=new Array(256),e=0;e<128;++e)n[e]=e<<1,n[e+128]=e+128<<1^283;na=new Array(256),TI=new Array(256),om=new Array(4),tu=new Array(4);for(var e=0;e<4;++e)om[e]=new Array(256),tu[e]=new Array(256);for(var t=0,i=0,r,s,o,a,l,c,u,e=0;e<256;++e){a=i^i<<1^i<<2^i<<3^i<<4,a=a>>8^a&255^99,na[t]=a,TI[a]=t,l=n[a],r=n[t],s=n[r],o=n[s],c=l<<24^a<<16^a<<8^(a^l),u=(r^s^o)<<24^(t^o)<<16^(t^s^o)<<8^(t^r^o);for(var h=0;h<4;++h)om[h][t]=c,tu[h][a]=u,c=c<<24|c>>>8,u=u<<24|u>>>8;t===0?t=i=1:(t=r^n[n[n[r^o]]],i^=n[n[i]])}}function HX(n,e){for(var t=n.slice(0),i,r=1,s=t.length,o=s+6+1,a=tg*o,l=s;l<a;++l)i=t[l-1],l%s===0?(i=na[i>>>16&255]<<24^na[i>>>8&255]<<16^na[i&255]<<8^na[i>>>24]^jX[r]<<24,r++):s>6&&l%s===4&&(i=na[i>>>24]<<24^na[i>>>16&255]<<16^na[i>>>8&255]<<8^na[i&255]),t[l]=t[l-s]^i;if(e){var c,u=tu[0],h=tu[1],p=tu[2],m=tu[3],y=t.slice(0);a=t.length;for(var l=0,b=a-tg;l<a;l+=tg,b-=tg)if(l===0||l===a-tg)y[l]=t[b],y[l+1]=t[b+3],y[l+2]=t[b+2],y[l+3]=t[b+1];else for(var w=0;w<tg;++w)c=t[b+w],y[l+(3&-w)]=u[na[c>>>24]]^h[na[c>>>16&255]]^p[na[c>>>8&255]]^m[na[c&255]];t=y}return t}function AI(n,e,t,i){var r=n.length/4-1,s,o,a,l,c;i?(s=tu[0],o=tu[1],a=tu[2],l=tu[3],c=TI):(s=om[0],o=om[1],a=om[2],l=om[3],c=na);var u,h,p,m,y,b,w;u=e[0]^n[0],h=e[i?3:1]^n[1],p=e[2]^n[2],m=e[i?1:3]^n[3];for(var v=3,T=1;T<r;++T)y=s[u>>>24]^o[h>>>16&255]^a[p>>>8&255]^l[m&255]^n[++v],b=s[h>>>24]^o[p>>>16&255]^a[m>>>8&255]^l[u&255]^n[++v],w=s[p>>>24]^o[m>>>16&255]^a[u>>>8&255]^l[h&255]^n[++v],m=s[m>>>24]^o[u>>>16&255]^a[h>>>8&255]^l[p&255]^n[++v],u=y,h=b,p=w;t[0]=c[u>>>24]<<24^c[h>>>16&255]<<16^c[p>>>8&255]<<8^c[m&255]^n[++v],t[i?3:1]=c[h>>>24]<<24^c[p>>>16&255]<<16^c[m>>>8&255]<<8^c[u&255]^n[++v],t[2]=c[p>>>24]<<24^c[m>>>16&255]<<16^c[u>>>8&255]<<8^c[h&255]^n[++v],t[i?1:3]=c[m>>>24]<<24^c[u>>>16&255]<<16^c[h>>>8&255]<<8^c[p&255]^n[++v]}function U7(n){n=n||{};var e=(n.mode||"CBC").toUpperCase(),t="AES-"+e,i;n.decrypt?i=vr.cipher.createDecipher(t,n.key):i=vr.cipher.createCipher(t,n.key);var r=i.start;return i.start=function(s,o){var a=null;o instanceof vr.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,r.call(i,o)},i}var Dr=Vr;Dr.des=Dr.des||{};Dr.des.startEncrypting=function(n,e,t,i){var r=F7({key:n,output:t,decrypt:!1,mode:i||(e===null?"ECB":"CBC")});return r.start(e),r};Dr.des.createEncryptionCipher=function(n,e){return F7({key:n,output:null,decrypt:!1,mode:e})};Dr.des.startDecrypting=function(n,e,t,i){var r=F7({key:n,output:t,decrypt:!0,mode:i||(e===null?"ECB":"CBC")});return r.start(e),r};Dr.des.createDecryptionCipher=function(n,e){return F7({key:n,output:null,decrypt:!0,mode:e})};Dr.des.Algorithm=function(n,e){var t=this;t.name=n,t.mode=new e({blockSize:8,cipher:{encrypt:function(i,r){return qF(t._keys,i,r,!1)},decrypt:function(i,r){return qF(t._keys,i,r,!0)}}}),t._init=!1};Dr.des.Algorithm.prototype.initialize=function(n){if(!this._init){var e=Dr.util.createBuffer(n.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=cye(e),this._init=!0}};yh("DES-ECB",Dr.cipher.modes.ecb);yh("DES-CBC",Dr.cipher.modes.cbc);yh("DES-CFB",Dr.cipher.modes.cfb);yh("DES-OFB",Dr.cipher.modes.ofb);yh("DES-CTR",Dr.cipher.modes.ctr);yh("3DES-ECB",Dr.cipher.modes.ecb);yh("3DES-CBC",Dr.cipher.modes.cbc);yh("3DES-CFB",Dr.cipher.modes.cfb);yh("3DES-OFB",Dr.cipher.modes.ofb);yh("3DES-CTR",Dr.cipher.modes.ctr);function yh(n,e){var t=function(){return new Dr.des.Algorithm(n,e)};Dr.cipher.registerAlgorithm(n,t)}var tye=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],nye=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],iye=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],rye=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],sye=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],oye=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],aye=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],lye=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function cye(n){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],t=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],r=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],c=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],u=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],h=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],m=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],y=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],b=n.length()>8?3:1,w=[],v=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],T=0,S,M=0;M<b;M++){var P=n.getInt32(),R=n.getInt32();S=(P>>>4^R)&252645135,R^=S,P^=S<<4,S=(R>>>-16^P)&65535,P^=S,R^=S<<-16,S=(P>>>2^R)&858993459,R^=S,P^=S<<2,S=(R>>>-16^P)&65535,P^=S,R^=S<<-16,S=(P>>>1^R)&1431655765,R^=S,P^=S<<1,S=(R>>>8^P)&16711935,P^=S,R^=S<<8,S=(P>>>1^R)&1431655765,R^=S,P^=S<<1,S=P<<8|R>>>20&240,P=R<<24|R<<8&16711680|R>>>8&65280|R>>>24&240,R=S;for(var O=0;O<v.length;++O){v[O]?(P=P<<2|P>>>26,R=R<<2|R>>>26):(P=P<<1|P>>>27,R=R<<1|R>>>27),P&=-15,R&=-15;var B=e[P>>>28]|t[P>>>24&15]|i[P>>>20&15]|r[P>>>16&15]|s[P>>>12&15]|o[P>>>8&15]|a[P>>>4&15],N=l[R>>>28]|c[R>>>24&15]|u[R>>>20&15]|h[R>>>16&15]|p[R>>>12&15]|m[R>>>8&15]|y[R>>>4&15];S=(N>>>16^B)&65535,w[T++]=B^S,w[T++]=N^S<<16}}return w}function qF(n,e,t,i){var r=n.length===32?3:9,s;r===3?s=i?[30,-2,-2]:[0,32,2]:s=i?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],l=e[1];o=(a>>>4^l)&252645135,l^=o,a^=o<<4,o=(a>>>16^l)&65535,l^=o,a^=o<<16,o=(l>>>2^a)&858993459,a^=o,l^=o<<2,o=(l>>>8^a)&16711935,a^=o,l^=o<<8,o=(a>>>1^l)&1431655765,l^=o,a^=o<<1,a=a<<1|a>>>31,l=l<<1|l>>>31;for(var c=0;c<r;c+=3){for(var u=s[c+1],h=s[c+2],p=s[c];p!=u;p+=h){var m=l^n[p],y=(l>>>4|l<<28)^n[p+1];o=a,a=l,l=o^(nye[m>>>24&63]|rye[m>>>16&63]|oye[m>>>8&63]|lye[m&63]|tye[y>>>24&63]|iye[y>>>16&63]|sye[y>>>8&63]|aye[y&63])}o=a,a=l,l=o}a=a>>>1|a<<31,l=l>>>1|l<<31,o=(a>>>1^l)&1431655765,l^=o,a^=o<<1,o=(l>>>8^a)&16711935,a^=o,l^=o<<8,o=(l>>>2^a)&858993459,a^=o,l^=o<<2,o=(a>>>16^l)&65535,l^=o,a^=o<<16,o=(a>>>4^l)&252645135,l^=o,a^=o<<4,t[0]=a,t[1]=l}function F7(n){n=n||{};var e=(n.mode||"CBC").toUpperCase(),t="DES-"+e,i;n.decrypt?i=Dr.cipher.createDecipher(t,n.key):i=Dr.cipher.createCipher(t,n.key);var r=i.start;return i.start=function(s,o){var a=null;o instanceof Dr.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=s,r.call(i,o)},i}var q6=Vr;q6.md=q6.md||{};q6.md.algorithms=q6.md.algorithms||{};var Yh=Vr,uye=Yh.hmac=Yh.hmac||{};uye.create=function(){var n=null,e=null,t=null,i=null,r={};return r.start=function(s,o){if(s!==null)if(typeof s=="string")if(s=s.toLowerCase(),s in Yh.md.algorithms)e=Yh.md.algorithms[s].create();else throw new Error('Unknown hash algorithm "'+s+'"');else e=s;if(o===null)o=n;else{if(typeof o=="string")o=Yh.util.createBuffer(o);else if(Yh.util.isArray(o)){var a=o;o=Yh.util.createBuffer();for(var l=0;l<a.length;++l)o.putByte(a[l])}var c=o.length();c>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),t=Yh.util.createBuffer(),i=Yh.util.createBuffer(),c=o.length();for(var l=0;l<c;++l){var a=o.at(l);t.putByte(54^a),i.putByte(92^a)}if(c<e.blockLength)for(var a=e.blockLength-c,l=0;l<a;++l)t.putByte(54),i.putByte(92);n=o,t=t.bytes(),i=i.bytes()}e.start(),e.update(t)},r.update=function(s){e.update(s)},r.getMac=function(){var s=e.digest().bytes();return e.start(),e.update(i),e.update(s),e.digest()},r.digest=r.getMac,r};var ra=Vr,hye=ra.pkcs5=ra.pkcs5||{},qh;ra.util.isNodejs&&!ra.options.usePureJavaScript&&(qh=f7);ra.pbkdf2=hye.pbkdf2=function(n,e,t,i,r,s){if(typeof r=="function"&&(s=r,r=null),ra.util.isNodejs&&!ra.options.usePureJavaScript&&qh.pbkdf2&&(r===null||typeof r!="object")&&(qh.pbkdf2Sync.length>4||!r||r==="sha1"))return typeof r!="string"&&(r="sha1"),n=Buffer.from(n,"binary"),e=Buffer.from(e,"binary"),s?qh.pbkdf2Sync.length===4?qh.pbkdf2(n,e,t,i,function(S,M){if(S)return s(S);s(null,M.toString("binary"))}):qh.pbkdf2(n,e,t,i,r,function(S,M){if(S)return s(S);s(null,M.toString("binary"))}):qh.pbkdf2Sync.length===4?qh.pbkdf2Sync(n,e,t,i).toString("binary"):qh.pbkdf2Sync(n,e,t,i,r).toString("binary");if((typeof r>"u"||r===null)&&(r="sha1"),typeof r=="string"){if(!(r in ra.md.algorithms))throw new Error("Unknown hash algorithm: "+r);r=ra.md[r].create()}var o=r.digestLength;if(i>4294967295*o){var a=new Error("Derived key is too long.");if(s)return s(a);throw a}var l=Math.ceil(i/o),c=i-(l-1)*o,u=ra.hmac.create();u.start(r,n);var h="",p,m,y;if(!s){for(var b=1;b<=l;++b){u.start(null,null),u.update(e),u.update(ra.util.int32ToBytes(b)),p=y=u.digest().getBytes();for(var w=2;w<=t;++w)u.start(null,null),u.update(y),m=u.digest().getBytes(),p=ra.util.xorBytes(p,m,o),y=m;h+=b<l?p:p.substr(0,c)}return h}var b=1,w;function v(){if(b>l)return s(null,h);u.start(null,null),u.update(e),u.update(ra.util.int32ToBytes(b)),p=y=u.digest().getBytes(),w=2,T()}function T(){if(w<=t)return u.start(null,null),u.update(y),m=u.digest().getBytes(),p=ra.util.xorBytes(p,m,o),y=m,++w,ra.util.setImmediate(T);h+=b<l?p:p.substr(0,c),++b,v()}v()};var Z6=Vr,$X=Z6.pem=Z6.pem||{};$X.encode=function(n,e){e=e||{};var t="-----BEGIN "+n.type+`-----\r
`,i;if(n.procType&&(i={name:"Proc-Type",values:[String(n.procType.version),n.procType.type]},t+=_4(i)),n.contentDomain&&(i={name:"Content-Domain",values:[n.contentDomain]},t+=_4(i)),n.dekInfo&&(i={name:"DEK-Info",values:[n.dekInfo.algorithm]},n.dekInfo.parameters&&i.values.push(n.dekInfo.parameters),t+=_4(i)),n.headers)for(var r=0;r<n.headers.length;++r)t+=_4(n.headers[r]);return n.procType&&(t+=`\r
`),t+=Z6.util.encode64(n.body,e.maxline||64)+`\r
`,t+="-----END "+n.type+`-----\r
`,t};$X.decode=function(n){for(var e=[],t=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,i=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,r=/\r?\n/,s;s=t.exec(n),!!s;){var o=s[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:Z6.util.decode64(s[3])};if(e.push(a),!!s[2]){for(var l=s[2].split(r),c=0;s&&c<l.length;){for(var u=l[c].replace(/\s+$/,""),h=c+1;h<l.length;++h){var p=l[h];if(!/\s/.test(p[0]))break;u+=p,c=h}if(s=u.match(i),s){for(var m={name:s[1],values:[]},y=s[2].split(","),b=0;b<y.length;++b)m.values.push(dye(y[b]));if(a.procType)if(!a.contentDomain&&m.name==="Content-Domain")a.contentDomain=y[0]||"";else if(!a.dekInfo&&m.name==="DEK-Info"){if(m.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:y[0],parameters:y[1]||null}}else a.headers.push(m);else{if(m.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(m.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:y[0],type:y[1]}}}++c}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function _4(n){for(var e=n.name+": ",t=[],i=function(l,c){return" "+c},r=0;r<n.values.length;++r)t.push(n.values[r].replace(/^(\S+\r\n)/,i));e+=t.join(",")+`\r
`;for(var s=0,o=-1,r=0;r<e.length;++r,++s)if(s>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),s=r-o-1,o=-1,++r}else(e[r]===" "||e[r]==="	"||e[r]===",")&&(o=r);return e}function dye(n){return n.replace(/^\s+/,"")}var qu=Vr,GX=qu.sha256=qu.sha256||{};qu.md.sha256=qu.md.algorithms.sha256=GX;GX.create=function(){WX||fye();var n=null,e=qu.util.createBuffer(),t=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return i.start=function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,s=0;s<r;++s)i.fullMessageLength.push(0);return e=qu.util.createBuffer(),n={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i},i.start(),i.update=function(r,s){s==="utf8"&&(r=qu.util.encodeUtf8(r));var o=r.length;i.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=i.fullMessageLength.length-1;a>=0;--a)i.fullMessageLength[a]+=o[1],o[1]=o[0]+(i.fullMessageLength[a]/4294967296>>>0),i.fullMessageLength[a]=i.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(r),ZF(n,t,e),(e.read>2048||e.length()===0)&&e.compact(),i},i.digest=function(){var r=qu.util.createBuffer();r.putBytes(e.bytes());var s=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize,o=s&i.blockLength-1;r.putBytes(CI.substr(0,i.blockLength-o));for(var a,l,c=i.fullMessageLength[0]*8,u=0;u<i.fullMessageLength.length-1;++u)a=i.fullMessageLength[u+1]*8,l=a/4294967296>>>0,c+=l,r.putInt32(c>>>0),c=a>>>0;r.putInt32(c);var h={h0:n.h0,h1:n.h1,h2:n.h2,h3:n.h3,h4:n.h4,h5:n.h5,h6:n.h6,h7:n.h7};ZF(h,t,r);var p=qu.util.createBuffer();return p.putInt32(h.h0),p.putInt32(h.h1),p.putInt32(h.h2),p.putInt32(h.h3),p.putInt32(h.h4),p.putInt32(h.h5),p.putInt32(h.h6),p.putInt32(h.h7),p},i};var CI=null,WX=!1,KX=null;function fye(){CI=String.fromCharCode(128),CI+=qu.util.fillString(String.fromCharCode(0),64),KX=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],WX=!0}function ZF(n,e,t){for(var i,r,s,o,a,l,c,u,h,p,m,y,b,w,v,T=t.length();T>=64;){for(c=0;c<16;++c)e[c]=t.getInt32();for(;c<64;++c)i=e[c-2],i=(i>>>17|i<<15)^(i>>>19|i<<13)^i>>>10,r=e[c-15],r=(r>>>7|r<<25)^(r>>>18|r<<14)^r>>>3,e[c]=i+e[c-7]+r+e[c-16]|0;for(u=n.h0,h=n.h1,p=n.h2,m=n.h3,y=n.h4,b=n.h5,w=n.h6,v=n.h7,c=0;c<64;++c)o=(y>>>6|y<<26)^(y>>>11|y<<21)^(y>>>25|y<<7),a=w^y&(b^w),s=(u>>>2|u<<30)^(u>>>13|u<<19)^(u>>>22|u<<10),l=u&h|p&(u^h),i=v+o+a+KX[c]+e[c],r=s+l,v=w,w=b,b=y,y=m+i>>>0,m=p,p=h,h=u,u=i+r>>>0;n.h0=n.h0+u|0,n.h1=n.h1+h|0,n.h2=n.h2+p|0,n.h3=n.h3+m|0,n.h4=n.h4+y|0,n.h5=n.h5+b|0,n.h6=n.h6+w|0,n.h7=n.h7+v|0,T-=64}}var Gu=Vr,ES=null;Gu.util.isNodejs&&!Gu.options.usePureJavaScript&&!process.versions["node-webkit"]&&(ES=f7);var pye=Gu.prng=Gu.prng||{};pye.create=function(n){for(var e={plugin:n,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},t=n.md,i=new Array(32),r=0;r<32;++r)i[r]=t.create();e.pools=i,e.pool=0,e.generate=function(c,u){if(!u)return e.generateSync(c);var h=e.plugin.cipher,p=e.plugin.increment,m=e.plugin.formatKey,y=e.plugin.formatSeed,b=Gu.util.createBuffer();e.key=null,w();function w(v){if(v)return u(v);if(b.length()>=c)return u(null,b.getBytes(c));if(e.generated>1048575&&(e.key=null),e.key===null)return Gu.util.nextTick(function(){s(w)});var T=h(e.key,e.seed);e.generated+=T.length,b.putBytes(T),e.key=m(h(e.key,p(e.seed))),e.seed=y(h(e.key,e.seed)),Gu.util.setImmediate(w)}},e.generateSync=function(c){var u=e.plugin.cipher,h=e.plugin.increment,p=e.plugin.formatKey,m=e.plugin.formatSeed;e.key=null;for(var y=Gu.util.createBuffer();y.length()<c;){e.generated>1048575&&(e.key=null),e.key===null&&o();var b=u(e.key,e.seed);e.generated+=b.length,y.putBytes(b),e.key=p(u(e.key,h(e.seed))),e.seed=m(u(e.key,e.seed))}return y.getBytes(c)};function s(c){if(e.pools[0].messageLength>=32)return a(),c();var u=32-e.pools[0].messageLength<<5;e.seedFile(u,function(h,p){if(h)return c(h);e.collect(p),a(),c()})}function o(){if(e.pools[0].messageLength>=32)return a();var c=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(c)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var c=e.plugin.md.create();c.update(e.keyBytes);for(var u=1,h=0;h<32;++h)e.reseeds%u===0&&(c.update(e.pools[h].digest().getBytes()),e.pools[h].start()),u=u<<1;e.keyBytes=c.digest().getBytes(),c.start(),c.update(e.keyBytes);var p=c.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(p),e.generated=0}function l(c){var u=null,h=Gu.util.globalScope,p=h.crypto||h.msCrypto;p&&p.getRandomValues&&(u=function(P){return p.getRandomValues(P)});var m=Gu.util.createBuffer();if(u)for(;m.length()<c;){var y=Math.max(1,Math.min(c-m.length(),65536)/4),b=new Uint32Array(Math.floor(y));try{u(b);for(var w=0;w<b.length;++w)m.putInt32(b[w])}catch(P){if(!(typeof QuotaExceededError<"u"&&P instanceof QuotaExceededError))throw P}}if(m.length()<c)for(var v,T,S,M=Math.floor(Math.random()*65536);m.length()<c;){T=16807*(M&65535),v=16807*(M>>16),T+=(v&32767)<<16,T+=v>>15,T=(T&2147483647)+(T>>31),M=T&4294967295;for(var w=0;w<3;++w)S=M>>>(w<<3),S^=Math.floor(Math.random()*256),m.putByte(S&255)}return m.getBytes(c)}return ES?(e.seedFile=function(c,u){ES.randomBytes(c,function(h,p){if(h)return u(h);u(null,p.toString())})},e.seedFileSync=function(c){return ES.randomBytes(c).toString()}):(e.seedFile=function(c,u){try{u(null,l(c))}catch(h){u(h)}},e.seedFileSync=l),e.collect=function(c){for(var u=c.length,h=0;h<u;++h)e.pools[e.pool].update(c.substr(h,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(c,u){for(var h="",p=0;p<u;p+=8)h+=String.fromCharCode(c>>p&255);e.collect(h)},e.registerWorker=function(c){if(c===self)e.seedFile=function(h,p){function m(y){var b=y.data;b.forge&&b.forge.prng&&(self.removeEventListener("message",m),p(b.forge.prng.err,b.forge.prng.bytes))}self.addEventListener("message",m),self.postMessage({forge:{prng:{needed:h}}})};else{var u=function(h){var p=h.data;p.forge&&p.forge.prng&&e.seedFile(p.forge.prng.needed,function(m,y){c.postMessage({forge:{prng:{err:m,bytes:y}}})})};c.addEventListener("message",u)}},e};var Ls=Vr;(function(){if(Ls.random&&Ls.random.getBytes){Ls.random;return}(function(n){var e={},t=new Array(4),i=Ls.util.createBuffer();e.formatKey=function(h){var p=Ls.util.createBuffer(h);return h=new Array(4),h[0]=p.getInt32(),h[1]=p.getInt32(),h[2]=p.getInt32(),h[3]=p.getInt32(),Ls.aes._expandKey(h,!1)},e.formatSeed=function(h){var p=Ls.util.createBuffer(h);return h=new Array(4),h[0]=p.getInt32(),h[1]=p.getInt32(),h[2]=p.getInt32(),h[3]=p.getInt32(),h},e.cipher=function(h,p){return Ls.aes._updateBlock(h,p,t,!1),i.putInt32(t[0]),i.putInt32(t[1]),i.putInt32(t[2]),i.putInt32(t[3]),i.getBytes()},e.increment=function(h){return++h[3],h},e.md=Ls.md.sha256;function r(){var h=Ls.prng.create(e);return h.getBytes=function(p,m){return h.generate(p,m)},h.getBytesSync=function(p){return h.generate(p)},h}var s=r(),o=null,a=Ls.util.globalScope,l=a.crypto||a.msCrypto;if(l&&l.getRandomValues&&(o=function(h){return l.getRandomValues(h)}),Ls.options.usePureJavaScript||!Ls.util.isNodejs&&!o){if(s.collectInt(+new Date,32),typeof navigator<"u"){var c="";for(var u in navigator)try{typeof navigator[u]=="string"&&(c+=navigator[u])}catch{}s.collect(c),c=null}n&&(n().mousemove(function(h){s.collectInt(h.clientX,16),s.collectInt(h.clientY,16)}),n().keypress(function(h){s.collectInt(h.charCode,8)}))}if(!Ls.random)Ls.random=s;else for(var u in s)Ls.random[u]=s[u];Ls.random.createInstance=r,Ls.random})(typeof jQuery<"u"?jQuery:null)})();var Ha=Vr,UA=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],YF=[1,2,3,5],mye=function(n,e){return n<<e&65535|(n&65535)>>16-e},gye=function(n,e){return(n&65535)>>e|n<<16-e&65535};Ha.rc2=Ha.rc2||{};Ha.rc2.expandKey=function(n,e){typeof n=="string"&&(n=Ha.util.createBuffer(n)),e=e||128;var t=n,i=n.length(),r=e,s=Math.ceil(r/8),o=255>>(r&7),a;for(a=i;a<128;a++)t.putByte(UA[t.at(a-1)+t.at(a-i)&255]);for(t.setAt(128-s,UA[t.at(128-s)&o]),a=127-s;a>=0;a--)t.setAt(a,UA[t.at(a+1)^t.at(a+s)]);return t};var qX=function(n,e,t){var i=!1,r=null,s=null,o=null,a,l,c,u,h=[];for(n=Ha.rc2.expandKey(n,e),c=0;c<64;c++)h.push(n.getInt16Le());t?(a=function(y){for(c=0;c<4;c++)y[c]+=h[u]+(y[(c+3)%4]&y[(c+2)%4])+(~y[(c+3)%4]&y[(c+1)%4]),y[c]=mye(y[c],YF[c]),u++},l=function(y){for(c=0;c<4;c++)y[c]+=h[y[(c+3)%4]&63]}):(a=function(y){for(c=3;c>=0;c--)y[c]=gye(y[c],YF[c]),y[c]-=h[u]+(y[(c+3)%4]&y[(c+2)%4])+(~y[(c+3)%4]&y[(c+1)%4]),u--},l=function(y){for(c=3;c>=0;c--)y[c]-=h[y[(c+3)%4]&63]});var p=function(y){var b=[];for(c=0;c<4;c++){var w=r.getInt16Le();o!==null&&(t?w^=o.getInt16Le():o.putInt16Le(w)),b.push(w&65535)}u=t?0:63;for(var v=0;v<y.length;v++)for(var T=0;T<y[v][0];T++)y[v][1](b);for(c=0;c<4;c++)o!==null&&(t?o.putInt16Le(b[c]):b[c]^=o.getInt16Le()),s.putInt16Le(b[c])},m=null;return m={start:function(y,b){y&&typeof y=="string"&&(y=Ha.util.createBuffer(y)),i=!1,r=Ha.util.createBuffer(),s=b||new Ha.util.createBuffer,o=y,m.output=s},update:function(y){for(i||r.putBuffer(y);r.length()>=8;)p([[5,a],[1,l],[6,a],[1,l],[5,a]])},finish:function(y){var b=!0;if(t)if(y)b=y(8,r,!t);else{var w=r.length()===8?8:8-r.length();r.fillWithByte(w,w)}if(b&&(i=!0,m.update()),!t&&(b=r.length()===0,b))if(y)b=y(8,s,!t);else{var v=s.length(),T=s.at(v-1);T>v?b=!1:s.truncate(T)}return b}},m};Ha.rc2.startEncrypting=function(n,e,t){var i=Ha.rc2.createEncryptionCipher(n,128);return i.start(e,t),i};Ha.rc2.createEncryptionCipher=function(n,e){return qX(n,e,!0)};Ha.rc2.startDecrypting=function(n,e,t){var i=Ha.rc2.createDecryptionCipher(n,128);return i.start(e,t),i};Ha.rc2.createDecryptionCipher=function(n,e){return qX(n,e,!1)};var MI=Vr;MI.jsbn=MI.jsbn||{};var yd;function Rt(n,e,t){this.data=[],n!=null&&(typeof n=="number"?this.fromNumber(n,e,t):e==null&&typeof n!="string"?this.fromString(n,256):this.fromString(n,e))}MI.jsbn.BigInteger=Rt;function Ii(){return new Rt(null)}function yye(n,e,t,i,r,s){for(;--s>=0;){var o=e*this.data[n++]+t.data[i]+r;r=Math.floor(o/67108864),t.data[i++]=o&67108863}return r}function xye(n,e,t,i,r,s){for(var o=e&32767,a=e>>15;--s>=0;){var l=this.data[n]&32767,c=this.data[n++]>>15,u=a*l+c*o;l=o*l+((u&32767)<<15)+t.data[i]+(r&1073741823),r=(l>>>30)+(u>>>15)+a*c+(r>>>30),t.data[i++]=l&1073741823}return r}function XF(n,e,t,i,r,s){for(var o=e&16383,a=e>>14;--s>=0;){var l=this.data[n]&16383,c=this.data[n++]>>14,u=a*l+c*o;l=o*l+((u&16383)<<14)+t.data[i]+r,r=(l>>28)+(u>>14)+a*c,t.data[i++]=l&268435455}return r}typeof navigator>"u"?(Rt.prototype.am=XF,yd=28):navigator.appName=="Microsoft Internet Explorer"?(Rt.prototype.am=xye,yd=30):navigator.appName!="Netscape"?(Rt.prototype.am=yye,yd=26):(Rt.prototype.am=XF,yd=28);Rt.prototype.DB=yd;Rt.prototype.DM=(1<<yd)-1;Rt.prototype.DV=1<<yd;var yL=52;Rt.prototype.FV=Math.pow(2,yL);Rt.prototype.F1=yL-yd;Rt.prototype.F2=2*yd-yL;var vye="0123456789abcdefghijklmnopqrstuvwxyz",z7=new Array,ux,ac;ux="0".charCodeAt(0);for(ac=0;ac<=9;++ac)z7[ux++]=ac;ux="a".charCodeAt(0);for(ac=10;ac<36;++ac)z7[ux++]=ac;ux="A".charCodeAt(0);for(ac=10;ac<36;++ac)z7[ux++]=ac;function QF(n){return vye.charAt(n)}function ZX(n,e){var t=z7[n.charCodeAt(e)];return t??-1}function bye(n){for(var e=this.t-1;e>=0;--e)n.data[e]=this.data[e];n.t=this.t,n.s=this.s}function _ye(n){this.t=1,this.s=n<0?-1:0,n>0?this.data[0]=n:n<-1?this.data[0]=n+this.DV:this.t=0}function Jf(n){var e=Ii();return e.fromInt(n),e}function wye(n,e){var t;if(e==16)t=4;else if(e==8)t=3;else if(e==256)t=8;else if(e==2)t=1;else if(e==32)t=5;else if(e==4)t=2;else{this.fromRadix(n,e);return}this.t=0,this.s=0;for(var i=n.length,r=!1,s=0;--i>=0;){var o=t==8?n[i]&255:ZX(n,i);if(o<0){n.charAt(i)=="-"&&(r=!0);continue}r=!1,s==0?this.data[this.t++]=o:s+t>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,s+=t,s>=this.DB&&(s-=this.DB)}t==8&&n[0]&128&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),r&&Rt.ZERO.subTo(this,this)}function Sye(){for(var n=this.s&this.DM;this.t>0&&this.data[this.t-1]==n;)--this.t}function Eye(n){if(this.s<0)return"-"+this.negate().toString(n);var e;if(n==16)e=4;else if(n==8)e=3;else if(n==2)e=1;else if(n==32)e=5;else if(n==4)e=2;else return this.toRadix(n);var t=(1<<e)-1,i,r=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(i=this.data[o]>>a)>0&&(r=!0,s=QF(i));o>=0;)a<e?(i=(this.data[o]&(1<<a)-1)<<e-a,i|=this.data[--o]>>(a+=this.DB-e)):(i=this.data[o]>>(a-=e)&t,a<=0&&(a+=this.DB,--o)),i>0&&(r=!0),r&&(s+=QF(i));return r?s:"0"}function Tye(){var n=Ii();return Rt.ZERO.subTo(this,n),n}function Aye(){return this.s<0?this.negate():this}function Cye(n){var e=this.s-n.s;if(e!=0)return e;var t=this.t;if(e=t-n.t,e!=0)return this.s<0?-e:e;for(;--t>=0;)if((e=this.data[t]-n.data[t])!=0)return e;return 0}function j7(n){var e=1,t;return(t=n>>>16)!=0&&(n=t,e+=16),(t=n>>8)!=0&&(n=t,e+=8),(t=n>>4)!=0&&(n=t,e+=4),(t=n>>2)!=0&&(n=t,e+=2),(t=n>>1)!=0&&(n=t,e+=1),e}function Mye(){return this.t<=0?0:this.DB*(this.t-1)+j7(this.data[this.t-1]^this.s&this.DM)}function Rye(n,e){var t;for(t=this.t-1;t>=0;--t)e.data[t+n]=this.data[t];for(t=n-1;t>=0;--t)e.data[t]=0;e.t=this.t+n,e.s=this.s}function Iye(n,e){for(var t=n;t<this.t;++t)e.data[t-n]=this.data[t];e.t=Math.max(this.t-n,0),e.s=this.s}function Nye(n,e){var t=n%this.DB,i=this.DB-t,r=(1<<i)-1,s=Math.floor(n/this.DB),o=this.s<<t&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+s+1]=this.data[a]>>i|o,o=(this.data[a]&r)<<t;for(a=s-1;a>=0;--a)e.data[a]=0;e.data[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()}function Pye(n,e){e.s=this.s;var t=Math.floor(n/this.DB);if(t>=this.t){e.t=0;return}var i=n%this.DB,r=this.DB-i,s=(1<<i)-1;e.data[0]=this.data[t]>>i;for(var o=t+1;o<this.t;++o)e.data[o-t-1]|=(this.data[o]&s)<<r,e.data[o-t]=this.data[o]>>i;i>0&&(e.data[this.t-t-1]|=(this.s&s)<<r),e.t=this.t-t,e.clamp()}function kye(n,e){for(var t=0,i=0,r=Math.min(n.t,this.t);t<r;)i+=this.data[t]-n.data[t],e.data[t++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i-=n.s;t<this.t;)i+=this.data[t],e.data[t++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;t<n.t;)i-=n.data[t],e.data[t++]=i&this.DM,i>>=this.DB;i-=n.s}e.s=i<0?-1:0,i<-1?e.data[t++]=this.DV+i:i>0&&(e.data[t++]=i),e.t=t,e.clamp()}function Lye(n,e){var t=this.abs(),i=n.abs(),r=t.t;for(e.t=r+i.t;--r>=0;)e.data[r]=0;for(r=0;r<i.t;++r)e.data[r+t.t]=t.am(0,i.data[r],e,r,0,t.t);e.s=0,e.clamp(),this.s!=n.s&&Rt.ZERO.subTo(e,e)}function Dye(n){for(var e=this.abs(),t=n.t=2*e.t;--t>=0;)n.data[t]=0;for(t=0;t<e.t-1;++t){var i=e.am(t,e.data[t],n,2*t,0,1);(n.data[t+e.t]+=e.am(t+1,2*e.data[t],n,2*t+1,i,e.t-t-1))>=e.DV&&(n.data[t+e.t]-=e.DV,n.data[t+e.t+1]=1)}n.t>0&&(n.data[n.t-1]+=e.am(t,e.data[t],n,2*t,0,1)),n.s=0,n.clamp()}function Oye(n,e,t){var i=n.abs();if(!(i.t<=0)){var r=this.abs();if(r.t<i.t){e?.fromInt(0),t!=null&&this.copyTo(t);return}t==null&&(t=Ii());var s=Ii(),o=this.s,a=n.s,l=this.DB-j7(i.data[i.t-1]);l>0?(i.lShiftTo(l,s),r.lShiftTo(l,t)):(i.copyTo(s),r.copyTo(t));var c=s.t,u=s.data[c-1];if(u!=0){var h=u*(1<<this.F1)+(c>1?s.data[c-2]>>this.F2:0),p=this.FV/h,m=(1<<this.F1)/h,y=1<<this.F2,b=t.t,w=b-c,v=e??Ii();for(s.dlShiftTo(w,v),t.compareTo(v)>=0&&(t.data[t.t++]=1,t.subTo(v,t)),Rt.ONE.dlShiftTo(c,v),v.subTo(s,s);s.t<c;)s.data[s.t++]=0;for(;--w>=0;){var T=t.data[--b]==u?this.DM:Math.floor(t.data[b]*p+(t.data[b-1]+y)*m);if((t.data[b]+=s.am(0,T,t,w,0,c))<T)for(s.dlShiftTo(w,v),t.subTo(v,t);t.data[b]<--T;)t.subTo(v,t)}e!=null&&(t.drShiftTo(c,e),o!=a&&Rt.ZERO.subTo(e,e)),t.t=c,t.clamp(),l>0&&t.rShiftTo(l,t),o<0&&Rt.ZERO.subTo(t,t)}}}function Bye(n){var e=Ii();return this.abs().divRemTo(n,null,e),this.s<0&&e.compareTo(Rt.ZERO)>0&&n.subTo(e,e),e}function x1(n){this.m=n}function Uye(n){return n.s<0||n.compareTo(this.m)>=0?n.mod(this.m):n}function Fye(n){return n}function zye(n){n.divRemTo(this.m,null,n)}function jye(n,e,t){n.multiplyTo(e,t),this.reduce(t)}function Vye(n,e){n.squareTo(e),this.reduce(e)}x1.prototype.convert=Uye;x1.prototype.revert=Fye;x1.prototype.reduce=zye;x1.prototype.mulTo=jye;x1.prototype.sqrTo=Vye;function Hye(){if(this.t<1)return 0;var n=this.data[0];if(!(n&1))return 0;var e=n&3;return e=e*(2-(n&15)*e)&15,e=e*(2-(n&255)*e)&255,e=e*(2-((n&65535)*e&65535))&65535,e=e*(2-n*e%this.DV)%this.DV,e>0?this.DV-e:-e}function v1(n){this.m=n,this.mp=n.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<n.DB-15)-1,this.mt2=2*n.t}function $ye(n){var e=Ii();return n.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),n.s<0&&e.compareTo(Rt.ZERO)>0&&this.m.subTo(e,e),e}function Gye(n){var e=Ii();return n.copyTo(e),this.reduce(e),e}function Wye(n){for(;n.t<=this.mt2;)n.data[n.t++]=0;for(var e=0;e<this.m.t;++e){var t=n.data[e]&32767,i=t*this.mpl+((t*this.mph+(n.data[e]>>15)*this.mpl&this.um)<<15)&n.DM;for(t=e+this.m.t,n.data[t]+=this.m.am(0,i,n,e,0,this.m.t);n.data[t]>=n.DV;)n.data[t]-=n.DV,n.data[++t]++}n.clamp(),n.drShiftTo(this.m.t,n),n.compareTo(this.m)>=0&&n.subTo(this.m,n)}function Kye(n,e){n.squareTo(e),this.reduce(e)}function qye(n,e,t){n.multiplyTo(e,t),this.reduce(t)}v1.prototype.convert=$ye;v1.prototype.revert=Gye;v1.prototype.reduce=Wye;v1.prototype.mulTo=qye;v1.prototype.sqrTo=Kye;function Zye(){return(this.t>0?this.data[0]&1:this.s)==0}function Yye(n,e){if(n>4294967295||n<1)return Rt.ONE;var t=Ii(),i=Ii(),r=e.convert(this),s=j7(n)-1;for(r.copyTo(t);--s>=0;)if(e.sqrTo(t,i),(n&1<<s)>0)e.mulTo(i,r,t);else{var o=t;t=i,i=o}return e.revert(t)}function Xye(n,e){var t;return n<256||e.isEven()?t=new x1(e):t=new v1(e),this.exp(n,t)}Rt.prototype.copyTo=bye;Rt.prototype.fromInt=_ye;Rt.prototype.fromString=wye;Rt.prototype.clamp=Sye;Rt.prototype.dlShiftTo=Rye;Rt.prototype.drShiftTo=Iye;Rt.prototype.lShiftTo=Nye;Rt.prototype.rShiftTo=Pye;Rt.prototype.subTo=kye;Rt.prototype.multiplyTo=Lye;Rt.prototype.squareTo=Dye;Rt.prototype.divRemTo=Oye;Rt.prototype.invDigit=Hye;Rt.prototype.isEven=Zye;Rt.prototype.exp=Yye;Rt.prototype.toString=Eye;Rt.prototype.negate=Tye;Rt.prototype.abs=Aye;Rt.prototype.compareTo=Cye;Rt.prototype.bitLength=Mye;Rt.prototype.mod=Bye;Rt.prototype.modPowInt=Xye;Rt.ZERO=Jf(0);Rt.ONE=Jf(1);function Qye(){var n=Ii();return this.copyTo(n),n}function Jye(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function e2e(){return this.t==0?this.s:this.data[0]<<24>>24}function t2e(){return this.t==0?this.s:this.data[0]<<16>>16}function n2e(n){return Math.floor(Math.LN2*this.DB/Math.log(n))}function i2e(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function r2e(n){if(n==null&&(n=10),this.signum()==0||n<2||n>36)return"0";var e=this.chunkSize(n),t=Math.pow(n,e),i=Jf(t),r=Ii(),s=Ii(),o="";for(this.divRemTo(i,r,s);r.signum()>0;)o=(t+s.intValue()).toString(n).substr(1)+o,r.divRemTo(i,r,s);return s.intValue().toString(n)+o}function s2e(n,e){this.fromInt(0),e==null&&(e=10);for(var t=this.chunkSize(e),i=Math.pow(e,t),r=!1,s=0,o=0,a=0;a<n.length;++a){var l=ZX(n,a);if(l<0){n.charAt(a)=="-"&&this.signum()==0&&(r=!0);continue}o=e*o+l,++s>=t&&(this.dMultiply(i),this.dAddOffset(o,0),s=0,o=0)}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),r&&Rt.ZERO.subTo(this,this)}function o2e(n,e,t){if(typeof e=="number")if(n<2)this.fromInt(1);else for(this.fromNumber(n,t),this.testBit(n-1)||this.bitwiseTo(Rt.ONE.shiftLeft(n-1),xL,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>n&&this.subTo(Rt.ONE.shiftLeft(n-1),this);else{var i=new Array,r=n&7;i.length=(n>>3)+1,e.nextBytes(i),r>0?i[0]&=(1<<r)-1:i[0]=0,this.fromString(i,256)}}function a2e(){var n=this.t,e=new Array;e[0]=this.s;var t=this.DB-n*this.DB%8,i,r=0;if(n-- >0)for(t<this.DB&&(i=this.data[n]>>t)!=(this.s&this.DM)>>t&&(e[r++]=i|this.s<<this.DB-t);n>=0;)t<8?(i=(this.data[n]&(1<<t)-1)<<8-t,i|=this.data[--n]>>(t+=this.DB-8)):(i=this.data[n]>>(t-=8)&255,t<=0&&(t+=this.DB,--n)),i&128&&(i|=-256),r==0&&(this.s&128)!=(i&128)&&++r,(r>0||i!=this.s)&&(e[r++]=i);return e}function l2e(n){return this.compareTo(n)==0}function c2e(n){return this.compareTo(n)<0?this:n}function u2e(n){return this.compareTo(n)>0?this:n}function h2e(n,e,t){var i,r,s=Math.min(n.t,this.t);for(i=0;i<s;++i)t.data[i]=e(this.data[i],n.data[i]);if(n.t<this.t){for(r=n.s&this.DM,i=s;i<this.t;++i)t.data[i]=e(this.data[i],r);t.t=this.t}else{for(r=this.s&this.DM,i=s;i<n.t;++i)t.data[i]=e(r,n.data[i]);t.t=n.t}t.s=e(this.s,n.s),t.clamp()}function d2e(n,e){return n&e}function f2e(n){var e=Ii();return this.bitwiseTo(n,d2e,e),e}function xL(n,e){return n|e}function p2e(n){var e=Ii();return this.bitwiseTo(n,xL,e),e}function YX(n,e){return n^e}function m2e(n){var e=Ii();return this.bitwiseTo(n,YX,e),e}function XX(n,e){return n&~e}function g2e(n){var e=Ii();return this.bitwiseTo(n,XX,e),e}function y2e(){for(var n=Ii(),e=0;e<this.t;++e)n.data[e]=this.DM&~this.data[e];return n.t=this.t,n.s=~this.s,n}function x2e(n){var e=Ii();return n<0?this.rShiftTo(-n,e):this.lShiftTo(n,e),e}function v2e(n){var e=Ii();return n<0?this.lShiftTo(-n,e):this.rShiftTo(n,e),e}function b2e(n){if(n==0)return-1;var e=0;return n&65535||(n>>=16,e+=16),n&255||(n>>=8,e+=8),n&15||(n>>=4,e+=4),n&3||(n>>=2,e+=2),n&1||++e,e}function _2e(){for(var n=0;n<this.t;++n)if(this.data[n]!=0)return n*this.DB+b2e(this.data[n]);return this.s<0?this.t*this.DB:-1}function w2e(n){for(var e=0;n!=0;)n&=n-1,++e;return e}function S2e(){for(var n=0,e=this.s&this.DM,t=0;t<this.t;++t)n+=w2e(this.data[t]^e);return n}function E2e(n){var e=Math.floor(n/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<n%this.DB)!=0}function T2e(n,e){var t=Rt.ONE.shiftLeft(n);return this.bitwiseTo(t,e,t),t}function A2e(n){return this.changeBit(n,xL)}function C2e(n){return this.changeBit(n,XX)}function M2e(n){return this.changeBit(n,YX)}function R2e(n,e){for(var t=0,i=0,r=Math.min(n.t,this.t);t<r;)i+=this.data[t]+n.data[t],e.data[t++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i+=n.s;t<this.t;)i+=this.data[t],e.data[t++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;t<n.t;)i+=n.data[t],e.data[t++]=i&this.DM,i>>=this.DB;i+=n.s}e.s=i<0?-1:0,i>0?e.data[t++]=i:i<-1&&(e.data[t++]=this.DV+i),e.t=t,e.clamp()}function I2e(n){var e=Ii();return this.addTo(n,e),e}function N2e(n){var e=Ii();return this.subTo(n,e),e}function P2e(n){var e=Ii();return this.multiplyTo(n,e),e}function k2e(n){var e=Ii();return this.divRemTo(n,e,null),e}function L2e(n){var e=Ii();return this.divRemTo(n,null,e),e}function D2e(n){var e=Ii(),t=Ii();return this.divRemTo(n,e,t),new Array(e,t)}function O2e(n){this.data[this.t]=this.am(0,n-1,this,0,0,this.t),++this.t,this.clamp()}function B2e(n,e){if(n!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=n;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function R_(){}function QX(n){return n}function U2e(n,e,t){n.multiplyTo(e,t)}function F2e(n,e){n.squareTo(e)}R_.prototype.convert=QX;R_.prototype.revert=QX;R_.prototype.mulTo=U2e;R_.prototype.sqrTo=F2e;function z2e(n){return this.exp(n,new R_)}function j2e(n,e,t){var i=Math.min(this.t+n.t,e);for(t.s=0,t.t=i;i>0;)t.data[--i]=0;var r;for(r=t.t-this.t;i<r;++i)t.data[i+this.t]=this.am(0,n.data[i],t,i,0,this.t);for(r=Math.min(n.t,e);i<r;++i)this.am(0,n.data[i],t,i,0,e-i);t.clamp()}function V2e(n,e,t){--e;var i=t.t=this.t+n.t-e;for(t.s=0;--i>=0;)t.data[i]=0;for(i=Math.max(e-this.t,0);i<n.t;++i)t.data[this.t+i-e]=this.am(e-i,n.data[i],t,0,0,this.t+i-e);t.clamp(),t.drShiftTo(1,t)}function hx(n){this.r2=Ii(),this.q3=Ii(),Rt.ONE.dlShiftTo(2*n.t,this.r2),this.mu=this.r2.divide(n),this.m=n}function H2e(n){if(n.s<0||n.t>2*this.m.t)return n.mod(this.m);if(n.compareTo(this.m)<0)return n;var e=Ii();return n.copyTo(e),this.reduce(e),e}function $2e(n){return n}function G2e(n){for(n.drShiftTo(this.m.t-1,this.r2),n.t>this.m.t+1&&(n.t=this.m.t+1,n.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);n.compareTo(this.r2)<0;)n.dAddOffset(1,this.m.t+1);for(n.subTo(this.r2,n);n.compareTo(this.m)>=0;)n.subTo(this.m,n)}function W2e(n,e){n.squareTo(e),this.reduce(e)}function K2e(n,e,t){n.multiplyTo(e,t),this.reduce(t)}hx.prototype.convert=H2e;hx.prototype.revert=$2e;hx.prototype.reduce=G2e;hx.prototype.mulTo=K2e;hx.prototype.sqrTo=W2e;function q2e(n,e){var t=n.bitLength(),i,r=Jf(1),s;if(t<=0)return r;t<18?i=1:t<48?i=3:t<144?i=4:t<768?i=5:i=6,t<8?s=new x1(e):e.isEven()?s=new hx(e):s=new v1(e);var o=new Array,a=3,l=i-1,c=(1<<i)-1;if(o[1]=s.convert(this),i>1){var u=Ii();for(s.sqrTo(o[1],u);a<=c;)o[a]=Ii(),s.mulTo(u,o[a-2],o[a]),a+=2}var h=n.t-1,p,m=!0,y=Ii(),b;for(t=j7(n.data[h])-1;h>=0;){for(t>=l?p=n.data[h]>>t-l&c:(p=(n.data[h]&(1<<t+1)-1)<<l-t,h>0&&(p|=n.data[h-1]>>this.DB+t-l)),a=i;!(p&1);)p>>=1,--a;if((t-=a)<0&&(t+=this.DB,--h),m)o[p].copyTo(r),m=!1;else{for(;a>1;)s.sqrTo(r,y),s.sqrTo(y,r),a-=2;a>0?s.sqrTo(r,y):(b=r,r=y,y=b),s.mulTo(y,o[p],r)}for(;h>=0&&!(n.data[h]&1<<t);)s.sqrTo(r,y),b=r,r=y,y=b,--t<0&&(t=this.DB-1,--h)}return s.revert(r)}function Z2e(n){var e=this.s<0?this.negate():this.clone(),t=n.s<0?n.negate():n.clone();if(e.compareTo(t)<0){var i=e;e=t,t=i}var r=e.getLowestSetBit(),s=t.getLowestSetBit();if(s<0)return e;for(r<s&&(s=r),s>0&&(e.rShiftTo(s,e),t.rShiftTo(s,t));e.signum()>0;)(r=e.getLowestSetBit())>0&&e.rShiftTo(r,e),(r=t.getLowestSetBit())>0&&t.rShiftTo(r,t),e.compareTo(t)>=0?(e.subTo(t,e),e.rShiftTo(1,e)):(t.subTo(e,t),t.rShiftTo(1,t));return s>0&&t.lShiftTo(s,t),t}function Y2e(n){if(n<=0)return 0;var e=this.DV%n,t=this.s<0?n-1:0;if(this.t>0)if(e==0)t=this.data[0]%n;else for(var i=this.t-1;i>=0;--i)t=(e*t+this.data[i])%n;return t}function X2e(n){var e=n.isEven();if(this.isEven()&&e||n.signum()==0)return Rt.ZERO;for(var t=n.clone(),i=this.clone(),r=Jf(1),s=Jf(0),o=Jf(0),a=Jf(1);t.signum()!=0;){for(;t.isEven();)t.rShiftTo(1,t),e?((!r.isEven()||!s.isEven())&&(r.addTo(this,r),s.subTo(n,s)),r.rShiftTo(1,r)):s.isEven()||s.subTo(n,s),s.rShiftTo(1,s);for(;i.isEven();)i.rShiftTo(1,i),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(n,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(n,a),a.rShiftTo(1,a);t.compareTo(i)>=0?(t.subTo(i,t),e&&r.subTo(o,r),s.subTo(a,s)):(i.subTo(t,i),e&&o.subTo(r,o),a.subTo(s,a))}if(i.compareTo(Rt.ONE)!=0)return Rt.ZERO;if(a.compareTo(n)>=0)return a.subtract(n);if(a.signum()<0)a.addTo(n,a);else return a;return a.signum()<0?a.add(n):a}var jc=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],Q2e=(1<<26)/jc[jc.length-1];function J2e(n){var e,t=this.abs();if(t.t==1&&t.data[0]<=jc[jc.length-1]){for(e=0;e<jc.length;++e)if(t.data[0]==jc[e])return!0;return!1}if(t.isEven())return!1;for(e=1;e<jc.length;){for(var i=jc[e],r=e+1;r<jc.length&&i<Q2e;)i*=jc[r++];for(i=t.modInt(i);e<r;)if(i%jc[e++]==0)return!1}return t.millerRabin(n)}function exe(n){var e=this.subtract(Rt.ONE),t=e.getLowestSetBit();if(t<=0)return!1;for(var i=e.shiftRight(t),r=txe(),s,o=0;o<n;++o){do s=new Rt(this.bitLength(),r);while(s.compareTo(Rt.ONE)<=0||s.compareTo(e)>=0);var a=s.modPow(i,this);if(a.compareTo(Rt.ONE)!=0&&a.compareTo(e)!=0){for(var l=1;l++<t&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(Rt.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function txe(){return{nextBytes:function(n){for(var e=0;e<n.length;++e)n[e]=Math.floor(Math.random()*256)}}}Rt.prototype.chunkSize=n2e;Rt.prototype.toRadix=r2e;Rt.prototype.fromRadix=s2e;Rt.prototype.fromNumber=o2e;Rt.prototype.bitwiseTo=h2e;Rt.prototype.changeBit=T2e;Rt.prototype.addTo=R2e;Rt.prototype.dMultiply=O2e;Rt.prototype.dAddOffset=B2e;Rt.prototype.multiplyLowerTo=j2e;Rt.prototype.multiplyUpperTo=V2e;Rt.prototype.modInt=Y2e;Rt.prototype.millerRabin=exe;Rt.prototype.clone=Qye;Rt.prototype.intValue=Jye;Rt.prototype.byteValue=e2e;Rt.prototype.shortValue=t2e;Rt.prototype.signum=i2e;Rt.prototype.toByteArray=a2e;Rt.prototype.equals=l2e;Rt.prototype.min=c2e;Rt.prototype.max=u2e;Rt.prototype.and=f2e;Rt.prototype.or=p2e;Rt.prototype.xor=m2e;Rt.prototype.andNot=g2e;Rt.prototype.not=y2e;Rt.prototype.shiftLeft=x2e;Rt.prototype.shiftRight=v2e;Rt.prototype.getLowestSetBit=_2e;Rt.prototype.bitCount=S2e;Rt.prototype.testBit=E2e;Rt.prototype.setBit=A2e;Rt.prototype.clearBit=C2e;Rt.prototype.flipBit=M2e;Rt.prototype.add=I2e;Rt.prototype.subtract=N2e;Rt.prototype.multiply=P2e;Rt.prototype.divide=k2e;Rt.prototype.remainder=L2e;Rt.prototype.divideAndRemainder=D2e;Rt.prototype.modPow=q2e;Rt.prototype.modInverse=X2e;Rt.prototype.pow=z2e;Rt.prototype.gcd=Z2e;Rt.prototype.isProbablePrime=J2e;var Zu=Vr,JX=Zu.sha1=Zu.sha1||{};Zu.md.sha1=Zu.md.algorithms.sha1=JX;JX.create=function(){eQ||nxe();var n=null,e=Zu.util.createBuffer(),t=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return i.start=function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,s=0;s<r;++s)i.fullMessageLength.push(0);return e=Zu.util.createBuffer(),n={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i},i.start(),i.update=function(r,s){s==="utf8"&&(r=Zu.util.encodeUtf8(r));var o=r.length;i.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=i.fullMessageLength.length-1;a>=0;--a)i.fullMessageLength[a]+=o[1],o[1]=o[0]+(i.fullMessageLength[a]/4294967296>>>0),i.fullMessageLength[a]=i.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(r),JF(n,t,e),(e.read>2048||e.length()===0)&&e.compact(),i},i.digest=function(){var r=Zu.util.createBuffer();r.putBytes(e.bytes());var s=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize,o=s&i.blockLength-1;r.putBytes(RI.substr(0,i.blockLength-o));for(var a,l,c=i.fullMessageLength[0]*8,u=0;u<i.fullMessageLength.length-1;++u)a=i.fullMessageLength[u+1]*8,l=a/4294967296>>>0,c+=l,r.putInt32(c>>>0),c=a>>>0;r.putInt32(c);var h={h0:n.h0,h1:n.h1,h2:n.h2,h3:n.h3,h4:n.h4};JF(h,t,r);var p=Zu.util.createBuffer();return p.putInt32(h.h0),p.putInt32(h.h1),p.putInt32(h.h2),p.putInt32(h.h3),p.putInt32(h.h4),p},i};var RI=null,eQ=!1;function nxe(){RI=String.fromCharCode(128),RI+=Zu.util.fillString(String.fromCharCode(0),64),eQ=!0}function JF(n,e,t){for(var i,r,s,o,a,l,c,u,h=t.length();h>=64;){for(r=n.h0,s=n.h1,o=n.h2,a=n.h3,l=n.h4,u=0;u<16;++u)i=t.getInt32(),e[u]=i,c=a^s&(o^a),i=(r<<5|r>>>27)+c+l+1518500249+i,l=a,a=o,o=(s<<30|s>>>2)>>>0,s=r,r=i;for(;u<20;++u)i=e[u-3]^e[u-8]^e[u-14]^e[u-16],i=i<<1|i>>>31,e[u]=i,c=a^s&(o^a),i=(r<<5|r>>>27)+c+l+1518500249+i,l=a,a=o,o=(s<<30|s>>>2)>>>0,s=r,r=i;for(;u<32;++u)i=e[u-3]^e[u-8]^e[u-14]^e[u-16],i=i<<1|i>>>31,e[u]=i,c=s^o^a,i=(r<<5|r>>>27)+c+l+1859775393+i,l=a,a=o,o=(s<<30|s>>>2)>>>0,s=r,r=i;for(;u<40;++u)i=e[u-6]^e[u-16]^e[u-28]^e[u-32],i=i<<2|i>>>30,e[u]=i,c=s^o^a,i=(r<<5|r>>>27)+c+l+1859775393+i,l=a,a=o,o=(s<<30|s>>>2)>>>0,s=r,r=i;for(;u<60;++u)i=e[u-6]^e[u-16]^e[u-28]^e[u-32],i=i<<2|i>>>30,e[u]=i,c=s&o|a&(s^o),i=(r<<5|r>>>27)+c+l+2400959708+i,l=a,a=o,o=(s<<30|s>>>2)>>>0,s=r,r=i;for(;u<80;++u)i=e[u-6]^e[u-16]^e[u-28]^e[u-32],i=i<<2|i>>>30,e[u]=i,c=s^o^a,i=(r<<5|r>>>27)+c+l+3395469782+i,l=a,a=o,o=(s<<30|s>>>2)>>>0,s=r,r=i;n.h0=n.h0+r|0,n.h1=n.h1+s|0,n.h2=n.h2+o|0,n.h3=n.h3+a|0,n.h4=n.h4+l|0,h-=64}}var Qu=Vr,tQ=Qu.pkcs1=Qu.pkcs1||{};tQ.encode_rsa_oaep=function(n,e,t){var i,r,s,o;typeof t=="string"?(i=t,r=arguments[3]||void 0,s=arguments[4]||void 0):t&&(i=t.label||void 0,r=t.seed||void 0,s=t.md||void 0,t.mgf1&&t.mgf1.md&&(o=t.mgf1.md)),s?s.start():s=Qu.md.sha1.create(),o||(o=s);var a=Math.ceil(n.n.bitLength()/8),l=a-2*s.digestLength-2;if(e.length>l){var c=new Error("RSAES-OAEP input message length is too long.");throw c.length=e.length,c.maxLength=l,c}i||(i=""),s.update(i,"raw");for(var u=s.digest(),h="",p=l-e.length,m=0;m<p;m++)h+="\0";var y=u.getBytes()+h+""+e;if(!r)r=Qu.random.getBytes(s.digestLength);else if(r.length!==s.digestLength){var c=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw c.seedLength=r.length,c.digestLength=s.digestLength,c}var b=Y6(r,a-s.digestLength-1,o),w=Qu.util.xorBytes(y,b,y.length),v=Y6(w,s.digestLength,o),T=Qu.util.xorBytes(r,v,r.length);return"\0"+T+w};tQ.decode_rsa_oaep=function(n,e,t){var i,r,s;typeof t=="string"?(i=t,r=arguments[3]||void 0):t&&(i=t.label||void 0,r=t.md||void 0,t.mgf1&&t.mgf1.md&&(s=t.mgf1.md));var o=Math.ceil(n.n.bitLength()/8);if(e.length!==o){var w=new Error("RSAES-OAEP encoded message length is invalid.");throw w.length=e.length,w.expectedLength=o,w}if(r===void 0?r=Qu.md.sha1.create():r.start(),s||(s=r),o<2*r.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");i||(i=""),r.update(i,"raw");for(var a=r.digest().getBytes(),l=e.charAt(0),c=e.substring(1,r.digestLength+1),u=e.substring(1+r.digestLength),h=Y6(u,r.digestLength,s),p=Qu.util.xorBytes(c,h,c.length),m=Y6(p,o-r.digestLength-1,s),y=Qu.util.xorBytes(u,m,u.length),b=y.substring(0,r.digestLength),w=l!=="\0",v=0;v<r.digestLength;++v)w|=a.charAt(v)!==b.charAt(v);for(var T=1,S=r.digestLength,M=r.digestLength;M<y.length;M++){var P=y.charCodeAt(M),R=P&1^1,O=T?65534:0;w|=P&O,T=T&R,S+=T}if(w||y.charCodeAt(S)!==1)throw new Error("Invalid RSAES-OAEP padding.");return y.substring(S+1)};function Y6(n,e,t){t||(t=Qu.md.sha1.create());for(var i="",r=Math.ceil(e/t.digestLength),s=0;s<r;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255);t.start(),t.update(n+o),i+=t.digest().getBytes()}return i.substring(0,e)}var xf=Vr;(function(){if(xf.prime){xf.prime;return}var n=xf.prime=xf.prime||{},e=xf.jsbn.BigInteger,t=[6,4,2,4,2,4,6,2],i=new e(null);i.fromInt(30);var r=function(h,p){return h|p};n.generateProbablePrime=function(h,p,m){typeof p=="function"&&(m=p,p={}),p=p||{};var y=p.algorithm||"PRIMEINC";typeof y=="string"&&(y={name:y}),y.options=y.options||{};var b=p.prng||xf.random,w={nextBytes:function(v){for(var T=b.getBytesSync(v.length),S=0;S<v.length;++S)v[S]=T.charCodeAt(S)}};if(y.name==="PRIMEINC")return s(h,w,y.options,m);throw new Error("Invalid prime generation algorithm: "+y.name)};function s(h,p,m,y){return"workers"in m?l(h,p,m,y):o(h,p,m,y)}function o(h,p,m,y){var b=c(h,p),w=0,v=u(b.bitLength());"millerRabinTests"in m&&(v=m.millerRabinTests);var T=10;"maxBlockTime"in m&&(T=m.maxBlockTime),a(b,h,p,w,v,T,y)}function a(h,p,m,y,b,w,v){var T=+new Date;do{if(h.bitLength()>p&&(h=c(p,m)),h.isProbablePrime(b))return v(null,h);h.dAddOffset(t[y++%8],0)}while(w<0||+new Date-T<w);xf.util.setImmediate(function(){a(h,p,m,y,b,w,v)})}function l(h,p,m,y){if(typeof Worker>"u")return o(h,p,m,y);var b=c(h,p),w=m.workers,v=m.workLoad||100,T=v*30/8,S=m.workerScript||"forge/prime.worker.js";if(w===-1)return xf.util.estimateCores(function(P,R){P&&(R=2),w=R-1,M()});M();function M(){w=Math.max(1,w);for(var P=[],R=0;R<w;++R)P[R]=new Worker(S);for(var R=0;R<w;++R)P[R].addEventListener("message",B);var O=!1;function B(N){if(!O){var I=N.data;if(I.found){for(var F=0;F<P.length;++F)P[F].terminate();return O=!0,y(null,new e(I.prime,16))}b.bitLength()>h&&(b=c(h,p));var j=b.toString(16);N.target.postMessage({hex:j,workLoad:v}),b.dAddOffset(T,0)}}}}function c(h,p){var m=new e(h,p),y=h-1;return m.testBit(y)||m.bitwiseTo(e.ONE.shiftLeft(y),r,m),m.dAddOffset(31-m.mod(i).byteValue(),0),m}function u(h){return h<=100?27:h<=150?18:h<=200?15:h<=250?12:h<=300?9:h<=350?8:h<=400?7:h<=500?6:h<=600?5:h<=800?4:h<=1250?3:2}})();var In=Vr;if(typeof Mi>"u")var Mi=In.jsbn.BigInteger;var II=In.util.isNodejs?f7:null,Je=In.asn1,lc=In.util;In.pki=In.pki||{};In.pki.rsa=In.rsa=In.rsa||{};var Kn=In.pki,ixe=[6,4,2,4,2,4,6,2],rxe={name:"PrivateKeyInfo",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Je.Class.UNIVERSAL,type:Je.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:Je.Class.UNIVERSAL,type:Je.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},sxe={name:"RSAPrivateKey",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},oxe={name:"RSAPublicKey",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:Je.Class.UNIVERSAL,type:Je.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},axe=In.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:Je.Class.UNIVERSAL,type:Je.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:Je.Class.UNIVERSAL,type:Je.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},lxe={name:"DigestInfo",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:Je.Class.UNIVERSAL,type:Je.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:Je.Class.UNIVERSAL,type:Je.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:Je.Class.UNIVERSAL,type:Je.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:Je.Class.UNIVERSAL,type:Je.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},cxe=function(n){var e;if(n.algorithm in Kn.oids)e=Kn.oids[n.algorithm];else{var t=new Error("Unknown message digest algorithm.");throw t.algorithm=n.algorithm,t}var i=Je.oidToDer(e).getBytes(),r=Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[]),s=Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[]);s.value.push(Je.create(Je.Class.UNIVERSAL,Je.Type.OID,!1,i)),s.value.push(Je.create(Je.Class.UNIVERSAL,Je.Type.NULL,!1,""));var o=Je.create(Je.Class.UNIVERSAL,Je.Type.OCTETSTRING,!1,n.digest().getBytes());return r.value.push(s),r.value.push(o),Je.toDer(r).getBytes()},nQ=function(n,e,t){if(t)return n.modPow(e.e,e.n);if(!e.p||!e.q)return n.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(Mi.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(Mi.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var i;do i=new Mi(In.util.bytesToHex(In.random.getBytes(e.n.bitLength()/8)),16);while(i.compareTo(e.n)>=0||!i.gcd(e.n).equals(Mi.ONE));n=n.multiply(i.modPow(e.e,e.n)).mod(e.n);for(var r=n.mod(e.p).modPow(e.dP,e.p),s=n.mod(e.q).modPow(e.dQ,e.q);r.compareTo(s)<0;)r=r.add(e.p);var o=r.subtract(s).multiply(e.qInv).mod(e.p).multiply(e.q).add(s);return o=o.multiply(i.modInverse(e.n)).mod(e.n),o};Kn.rsa.encrypt=function(n,e,t){var i=t,r,s=Math.ceil(e.n.bitLength()/8);t!==!1&&t!==!0?(i=t===2,r=iQ(n,e,t)):(r=In.util.createBuffer(),r.putBytes(n));for(var o=new Mi(r.toHex(),16),a=nQ(o,e,i),l=a.toString(16),c=In.util.createBuffer(),u=s-Math.ceil(l.length/2);u>0;)c.putByte(0),--u;return c.putBytes(In.util.hexToBytes(l)),c.getBytes()};Kn.rsa.decrypt=function(n,e,t,i){var r=Math.ceil(e.n.bitLength()/8);if(n.length!==r){var s=new Error("Encrypted message length is invalid.");throw s.length=n.length,s.expected=r,s}var o=new Mi(In.util.createBuffer(n).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=nQ(o,e,t),l=a.toString(16),c=In.util.createBuffer(),u=r-Math.ceil(l.length/2);u>0;)c.putByte(0),--u;return c.putBytes(In.util.hexToBytes(l)),i!==!1?X6(c.getBytes(),e,t):c.getBytes()};Kn.rsa.createKeyPairGenerationState=function(n,e,t){typeof n=="string"&&(n=parseInt(n,10)),n=n||2048,t=t||{};var i=t.prng||In.random,r={nextBytes:function(a){for(var l=i.getBytesSync(a.length),c=0;c<a.length;++c)a[c]=l.charCodeAt(c)}},s=t.algorithm||"PRIMEINC",o;if(s==="PRIMEINC")o={algorithm:s,state:0,bits:n,rng:r,eInt:e||65537,e:new Mi(null),p:null,q:null,qBits:n>>1,pBits:n-(n>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+s);return o};Kn.rsa.stepKeyPairGenerationState=function(n,e){"algorithm"in n||(n.algorithm="PRIMEINC");var t=new Mi(null);t.fromInt(30);for(var i=0,r=function(h,p){return h|p},s=+new Date,o,a=0;n.keys===null&&(e<=0||a<e);){if(n.state===0){var l=n.p===null?n.pBits:n.qBits,c=l-1;n.pqState===0?(n.num=new Mi(l,n.rng),n.num.testBit(c)||n.num.bitwiseTo(Mi.ONE.shiftLeft(c),r,n.num),n.num.dAddOffset(31-n.num.mod(t).byteValue(),0),i=0,++n.pqState):n.pqState===1?n.num.bitLength()>l?n.pqState=0:n.num.isProbablePrime(hxe(n.num.bitLength()))?++n.pqState:n.num.dAddOffset(ixe[i++%8],0):n.pqState===2?n.pqState=n.num.subtract(Mi.ONE).gcd(n.e).compareTo(Mi.ONE)===0?3:0:n.pqState===3&&(n.pqState=0,n.p===null?n.p=n.num:n.q=n.num,n.p!==null&&n.q!==null&&++n.state,n.num=null)}else if(n.state===1)n.p.compareTo(n.q)<0&&(n.num=n.p,n.p=n.q,n.q=n.num),++n.state;else if(n.state===2)n.p1=n.p.subtract(Mi.ONE),n.q1=n.q.subtract(Mi.ONE),n.phi=n.p1.multiply(n.q1),++n.state;else if(n.state===3)n.phi.gcd(n.e).compareTo(Mi.ONE)===0?++n.state:(n.p=null,n.q=null,n.state=0);else if(n.state===4)n.n=n.p.multiply(n.q),n.n.bitLength()===n.bits?++n.state:(n.q=null,n.state=0);else if(n.state===5){var u=n.e.modInverse(n.phi);n.keys={privateKey:Kn.rsa.setPrivateKey(n.n,n.e,u,n.p,n.q,u.mod(n.p1),u.mod(n.q1),n.q.modInverse(n.p)),publicKey:Kn.rsa.setPublicKey(n.n,n.e)}}o=+new Date,a+=o-s,s=o}return n.keys!==null};Kn.rsa.generateKeyPair=function(n,e,t,i){if(arguments.length===1?typeof n=="object"?(t=n,n=void 0):typeof n=="function"&&(i=n,n=void 0):arguments.length===2?typeof n=="number"?typeof e=="function"?(i=e,e=void 0):typeof e!="number"&&(t=e,e=void 0):(t=n,i=e,n=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof t=="function"&&(i=t,t=void 0):(i=t,t=e,e=void 0)),t=t||{},n===void 0&&(n=t.bits||2048),e===void 0&&(e=t.e||65537),!In.options.usePureJavaScript&&!t.prng&&n>=256&&n<=16384&&(e===65537||e===3)){if(i){if(ez("generateKeyPair"))return II.generateKeyPair("rsa",{modulusLength:n,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,l,c){if(a)return i(a);i(null,{privateKey:Kn.privateKeyFromPem(c),publicKey:Kn.publicKeyFromPem(l)})});if(tz("generateKey")&&tz("exportKey"))return lc.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:iz(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return lc.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){i(a)}).then(function(a){if(a){var l=Kn.privateKeyFromAsn1(Je.fromDer(In.util.createBuffer(a)));i(null,{privateKey:l,publicKey:Kn.setRsaPublicKey(l.n,l.e)})}});if(nz("generateKey")&&nz("exportKey")){var r=lc.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:iz(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);r.oncomplete=function(a){var l=a.target.result,c=lc.globalScope.msCrypto.subtle.exportKey("pkcs8",l.privateKey);c.oncomplete=function(u){var h=u.target.result,p=Kn.privateKeyFromAsn1(Je.fromDer(In.util.createBuffer(h)));i(null,{privateKey:p,publicKey:Kn.setRsaPublicKey(p.n,p.e)})},c.onerror=function(u){i(u)}},r.onerror=function(a){i(a)};return}}else if(ez("generateKeyPairSync")){var s=II.generateKeyPairSync("rsa",{modulusLength:n,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:Kn.privateKeyFromPem(s.privateKey),publicKey:Kn.publicKeyFromPem(s.publicKey)}}}var o=Kn.rsa.createKeyPairGenerationState(n,e,t);if(!i)return Kn.rsa.stepKeyPairGenerationState(o,0),o.keys;uxe(o,t,i)};Kn.setRsaPublicKey=Kn.rsa.setPublicKey=function(n,e){var t={n,e};return t.encrypt=function(i,r,s){if(typeof r=="string"?r=r.toUpperCase():r===void 0&&(r="RSAES-PKCS1-V1_5"),r==="RSAES-PKCS1-V1_5")r={encode:function(a,l,c){return iQ(a,l,2).getBytes()}};else if(r==="RSA-OAEP"||r==="RSAES-OAEP")r={encode:function(a,l){return In.pkcs1.encode_rsa_oaep(l,a,s)}};else if(["RAW","NONE","NULL",null].indexOf(r)!==-1)r={encode:function(a){return a}};else if(typeof r=="string")throw new Error('Unsupported encryption scheme: "'+r+'".');var o=r.encode(i,t,!0);return Kn.rsa.encrypt(o,t,!0)},t.verify=function(i,r,s,o){typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),s==="RSASSA-PKCS1-V1_5"?s={verify:function(l,c){c=X6(c,t,!0);var u=Je.fromDer(c,{parseAllBytes:o._parseAllDigestBytes}),h={},p=[];if(!Je.validate(u,lxe,h,p)){var m=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw m.errors=p,m}var y=Je.derToOid(h.algorithmIdentifier);if(!(y===In.oids.md2||y===In.oids.md5||y===In.oids.sha1||y===In.oids.sha224||y===In.oids.sha256||y===In.oids.sha384||y===In.oids.sha512||y===In.oids["sha512-224"]||y===In.oids["sha512-256"])){var m=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw m.oid=y,m}if((y===In.oids.md2||y===In.oids.md5)&&!("parameters"in h))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifier NULL parameters.");return l===h.digest}}:(s==="NONE"||s==="NULL"||s===null)&&(s={verify:function(l,c){return c=X6(c,t,!0),l===c}});var a=Kn.rsa.decrypt(r,t,!0,!1);return s.verify(i,a,t.n.bitLength())},t};Kn.setRsaPrivateKey=Kn.rsa.setPrivateKey=function(n,e,t,i,r,s,o,a){var l={n,e,d:t,p:i,q:r,dP:s,dQ:o,qInv:a};return l.decrypt=function(c,u,h){typeof u=="string"?u=u.toUpperCase():u===void 0&&(u="RSAES-PKCS1-V1_5");var p=Kn.rsa.decrypt(c,l,!1,!1);if(u==="RSAES-PKCS1-V1_5")u={decode:X6};else if(u==="RSA-OAEP"||u==="RSAES-OAEP")u={decode:function(m,y){return In.pkcs1.decode_rsa_oaep(y,m,h)}};else if(["RAW","NONE","NULL",null].indexOf(u)!==-1)u={decode:function(m){return m}};else throw new Error('Unsupported encryption scheme: "'+u+'".');return u.decode(p,l,!1)},l.sign=function(c,u){var h=!1;typeof u=="string"&&(u=u.toUpperCase()),u===void 0||u==="RSASSA-PKCS1-V1_5"?(u={encode:cxe},h=1):(u==="NONE"||u==="NULL"||u===null)&&(u={encode:function(){return c}},h=1);var p=u.encode(c,l.n.bitLength());return Kn.rsa.encrypt(p,l,h)},l};Kn.wrapRsaPrivateKey=function(n){return Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Je.integerToDer(0).getBytes()),Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[Je.create(Je.Class.UNIVERSAL,Je.Type.OID,!1,Je.oidToDer(Kn.oids.rsaEncryption).getBytes()),Je.create(Je.Class.UNIVERSAL,Je.Type.NULL,!1,"")]),Je.create(Je.Class.UNIVERSAL,Je.Type.OCTETSTRING,!1,Je.toDer(n).getBytes())])};Kn.privateKeyFromAsn1=function(n){var e={},t=[];if(Je.validate(n,rxe,e,t)&&(n=Je.fromDer(In.util.createBuffer(e.privateKey))),e={},t=[],!Je.validate(n,sxe,e,t)){var i=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw i.errors=t,i}var r,s,o,a,l,c,u,h;return r=In.util.createBuffer(e.privateKeyModulus).toHex(),s=In.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=In.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=In.util.createBuffer(e.privateKeyPrime1).toHex(),l=In.util.createBuffer(e.privateKeyPrime2).toHex(),c=In.util.createBuffer(e.privateKeyExponent1).toHex(),u=In.util.createBuffer(e.privateKeyExponent2).toHex(),h=In.util.createBuffer(e.privateKeyCoefficient).toHex(),Kn.setRsaPrivateKey(new Mi(r,16),new Mi(s,16),new Mi(o,16),new Mi(a,16),new Mi(l,16),new Mi(c,16),new Mi(u,16),new Mi(h,16))};Kn.privateKeyToAsn1=Kn.privateKeyToRSAPrivateKey=function(n){return Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Je.integerToDer(0).getBytes()),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.n)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.e)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.d)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.p)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.q)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.dP)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.dQ)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.qInv))])};Kn.publicKeyFromAsn1=function(n){var e={},t=[];if(Je.validate(n,axe,e,t)){var i=Je.derToOid(e.publicKeyOid);if(i!==Kn.oids.rsaEncryption){var r=new Error("Cannot read public key. Unknown OID.");throw r.oid=i,r}n=e.rsaPublicKey}if(t=[],!Je.validate(n,oxe,e,t)){var r=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw r.errors=t,r}var s=In.util.createBuffer(e.publicKeyModulus).toHex(),o=In.util.createBuffer(e.publicKeyExponent).toHex();return Kn.setRsaPublicKey(new Mi(s,16),new Mi(o,16))};Kn.publicKeyToAsn1=Kn.publicKeyToSubjectPublicKeyInfo=function(n){return Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[Je.create(Je.Class.UNIVERSAL,Je.Type.OID,!1,Je.oidToDer(Kn.oids.rsaEncryption).getBytes()),Je.create(Je.Class.UNIVERSAL,Je.Type.NULL,!1,"")]),Je.create(Je.Class.UNIVERSAL,Je.Type.BITSTRING,!1,[Kn.publicKeyToRSAPublicKey(n)])])};Kn.publicKeyToRSAPublicKey=function(n){return Je.create(Je.Class.UNIVERSAL,Je.Type.SEQUENCE,!0,[Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.n)),Je.create(Je.Class.UNIVERSAL,Je.Type.INTEGER,!1,Bu(n.e))])};function iQ(n,e,t){var i=In.util.createBuffer(),r=Math.ceil(e.n.bitLength()/8);if(n.length>r-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=n.length,s.max=r-11,s}i.putByte(0),i.putByte(t);var o=r-3-n.length,a;if(t===0||t===1){a=t===0?0:255;for(var l=0;l<o;++l)i.putByte(a)}else for(;o>0;){for(var c=0,u=In.random.getBytes(o),l=0;l<o;++l)a=u.charCodeAt(l),a===0?++c:i.putByte(a);o=c}return i.putByte(0),i.putBytes(n),i}function X6(n,e,t,i){var r=Math.ceil(e.n.bitLength()/8),s=In.util.createBuffer(n),o=s.getByte(),a=s.getByte();if(o!==0||t&&a!==0&&a!==1||!t&&a!=2||t&&a===0&&typeof i>"u")throw new Error("Encryption block is invalid.");var l=0;if(a===0){l=r-3-i;for(var c=0;c<l;++c)if(s.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(l=0;s.length()>1;){if(s.getByte()!==255){--s.read;break}++l}else if(a===2)for(l=0;s.length()>1;){if(s.getByte()===0){--s.read;break}++l}var u=s.getByte();if(u!==0||l!==r-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function uxe(n,e,t){typeof e=="function"&&(t=e,e={}),e=e||{};var i={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(i.prng=e.prng),r();function r(){s(n.pBits,function(a,l){if(a)return t(a);if(n.p=l,n.q!==null)return o(a,n.q);s(n.qBits,o)})}function s(a,l){In.prime.generateProbablePrime(a,i,l)}function o(a,l){if(a)return t(a);if(n.q=l,n.p.compareTo(n.q)<0){var c=n.p;n.p=n.q,n.q=c}if(n.p.subtract(Mi.ONE).gcd(n.e).compareTo(Mi.ONE)!==0){n.p=null,r();return}if(n.q.subtract(Mi.ONE).gcd(n.e).compareTo(Mi.ONE)!==0){n.q=null,s(n.qBits,o);return}if(n.p1=n.p.subtract(Mi.ONE),n.q1=n.q.subtract(Mi.ONE),n.phi=n.p1.multiply(n.q1),n.phi.gcd(n.e).compareTo(Mi.ONE)!==0){n.p=n.q=null,r();return}if(n.n=n.p.multiply(n.q),n.n.bitLength()!==n.bits){n.q=null,s(n.qBits,o);return}var u=n.e.modInverse(n.phi);n.keys={privateKey:Kn.rsa.setPrivateKey(n.n,n.e,u,n.p,n.q,u.mod(n.p1),u.mod(n.q1),n.q.modInverse(n.p)),publicKey:Kn.rsa.setPublicKey(n.n,n.e)},t(null,n.keys)}}function Bu(n){var e=n.toString(16);e[0]>="8"&&(e="00"+e);var t=In.util.hexToBytes(e);return t.length>1&&(t.charCodeAt(0)===0&&!(t.charCodeAt(1)&128)||t.charCodeAt(0)===255&&(t.charCodeAt(1)&128)===128)?t.substr(1):t}function hxe(n){return n<=100?27:n<=150?18:n<=200?15:n<=250?12:n<=300?9:n<=350?8:n<=400?7:n<=500?6:n<=600?5:n<=800?4:n<=1250?3:2}function ez(n){return In.util.isNodejs&&typeof II[n]=="function"}function tz(n){return typeof lc.globalScope<"u"&&typeof lc.globalScope.crypto=="object"&&typeof lc.globalScope.crypto.subtle=="object"&&typeof lc.globalScope.crypto.subtle[n]=="function"}function nz(n){return typeof lc.globalScope<"u"&&typeof lc.globalScope.msCrypto=="object"&&typeof lc.globalScope.msCrypto.subtle=="object"&&typeof lc.globalScope.msCrypto.subtle[n]=="function"}function iz(n){for(var e=In.util.hexToBytes(n.toString(16)),t=new Uint8Array(e.length),i=0;i<e.length;++i)t[i]=e.charCodeAt(i);return t}var sn=Vr;if(typeof dxe>"u")var dxe=sn.jsbn.BigInteger;var wt=sn.asn1,ni=sn.pki=sn.pki||{};ni.pbe=sn.pbe=sn.pbe||{};var _p=ni.oids,fxe={name:"EncryptedPrivateKeyInfo",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},pxe={name:"PBES2Algorithms",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:wt.Class.UNIVERSAL,type:wt.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:wt.Class.UNIVERSAL,type:wt.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},mxe={name:"pkcs-12PbeParams",tagClass:wt.Class.UNIVERSAL,type:wt.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:wt.Class.UNIVERSAL,type:wt.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:wt.Class.UNIVERSAL,type:wt.Type.INTEGER,constructed:!1,capture:"iterations"}]};ni.encryptPrivateKeyInfo=function(n,e,t){t=t||{},t.saltSize=t.saltSize||8,t.count=t.count||2048,t.algorithm=t.algorithm||"aes128",t.prfAlgorithm=t.prfAlgorithm||"sha1";var i=sn.random.getBytesSync(t.saltSize),r=t.count,s=wt.integerToDer(r),o,a,l;if(t.algorithm.indexOf("aes")===0||t.algorithm==="des"){var c,u,h;switch(t.algorithm){case"aes128":o=16,c=16,u=_p["aes128-CBC"],h=sn.aes.createEncryptionCipher;break;case"aes192":o=24,c=16,u=_p["aes192-CBC"],h=sn.aes.createEncryptionCipher;break;case"aes256":o=32,c=16,u=_p["aes256-CBC"],h=sn.aes.createEncryptionCipher;break;case"des":o=8,c=8,u=_p.desCBC,h=sn.des.createEncryptionCipher;break;default:var p=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw p.algorithm=t.algorithm,p}var m="hmacWith"+t.prfAlgorithm.toUpperCase(),y=sQ(m),b=sn.pkcs5.pbkdf2(e,i,r,o,y),w=sn.random.getBytesSync(c),v=h(b);v.start(w),v.update(wt.toDer(n)),v.finish(),l=v.output.getBytes();var T=gxe(i,s,o,m);a=wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OID,!1,wt.oidToDer(_p.pkcs5PBES2).getBytes()),wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OID,!1,wt.oidToDer(_p.pkcs5PBKDF2).getBytes()),T]),wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OID,!1,wt.oidToDer(u).getBytes()),wt.create(wt.Class.UNIVERSAL,wt.Type.OCTETSTRING,!1,w)])])])}else if(t.algorithm==="3des"){o=24;var S=new sn.util.ByteBuffer(i),b=ni.pbe.generatePkcs12Key(e,S,1,r,o),w=ni.pbe.generatePkcs12Key(e,S,2,r,o),v=sn.des.createEncryptionCipher(b);v.start(w),v.update(wt.toDer(n)),v.finish(),l=v.output.getBytes(),a=wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OID,!1,wt.oidToDer(_p["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OCTETSTRING,!1,i),wt.create(wt.Class.UNIVERSAL,wt.Type.INTEGER,!1,s.getBytes())])])}else{var p=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw p.algorithm=t.algorithm,p}var M=wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[a,wt.create(wt.Class.UNIVERSAL,wt.Type.OCTETSTRING,!1,l)]);return M};ni.decryptPrivateKeyInfo=function(n,e){var t=null,i={},r=[];if(!wt.validate(n,fxe,i,r)){var s=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=r,s}var o=wt.derToOid(i.encryptionOid),a=ni.pbe.getCipher(o,i.encryptionParams,e),l=sn.util.createBuffer(i.encryptedData);return a.update(l),a.finish()&&(t=wt.fromDer(a.output)),t};ni.encryptedPrivateKeyToPem=function(n,e){var t={type:"ENCRYPTED PRIVATE KEY",body:wt.toDer(n).getBytes()};return sn.pem.encode(t,{maxline:e})};ni.encryptedPrivateKeyFromPem=function(n){var e=sn.pem.decode(n)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var t=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw t.headerType=e.type,t}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return wt.fromDer(e.body)};ni.encryptRsaPrivateKey=function(n,e,t){if(t=t||{},!t.legacy){var i=ni.wrapRsaPrivateKey(ni.privateKeyToAsn1(n));return i=ni.encryptPrivateKeyInfo(i,e,t),ni.encryptedPrivateKeyToPem(i)}var r,s,o,a;switch(t.algorithm){case"aes128":r="AES-128-CBC",o=16,s=sn.random.getBytesSync(16),a=sn.aes.createEncryptionCipher;break;case"aes192":r="AES-192-CBC",o=24,s=sn.random.getBytesSync(16),a=sn.aes.createEncryptionCipher;break;case"aes256":r="AES-256-CBC",o=32,s=sn.random.getBytesSync(16),a=sn.aes.createEncryptionCipher;break;case"3des":r="DES-EDE3-CBC",o=24,s=sn.random.getBytesSync(8),a=sn.des.createEncryptionCipher;break;case"des":r="DES-CBC",o=8,s=sn.random.getBytesSync(8),a=sn.des.createEncryptionCipher;break;default:var l=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+t.algorithm+'".');throw l.algorithm=t.algorithm,l}var c=sn.pbe.opensslDeriveBytes(e,s.substr(0,8),o),u=a(c);u.start(s),u.update(wt.toDer(ni.privateKeyToAsn1(n))),u.finish();var h={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:r,parameters:sn.util.bytesToHex(s).toUpperCase()},body:u.output.getBytes()};return sn.pem.encode(h)};ni.decryptRsaPrivateKey=function(n,e){var t=null,i=sn.pem.decode(n)[0];if(i.type!=="ENCRYPTED PRIVATE KEY"&&i.type!=="PRIVATE KEY"&&i.type!=="RSA PRIVATE KEY"){var r=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw r.headerType=r,r}if(i.procType&&i.procType.type==="ENCRYPTED"){var s,o;switch(i.dekInfo.algorithm){case"DES-CBC":s=8,o=sn.des.createDecryptionCipher;break;case"DES-EDE3-CBC":s=24,o=sn.des.createDecryptionCipher;break;case"AES-128-CBC":s=16,o=sn.aes.createDecryptionCipher;break;case"AES-192-CBC":s=24,o=sn.aes.createDecryptionCipher;break;case"AES-256-CBC":s=32,o=sn.aes.createDecryptionCipher;break;case"RC2-40-CBC":s=5,o=function(h){return sn.rc2.createDecryptionCipher(h,40)};break;case"RC2-64-CBC":s=8,o=function(h){return sn.rc2.createDecryptionCipher(h,64)};break;case"RC2-128-CBC":s=16,o=function(h){return sn.rc2.createDecryptionCipher(h,128)};break;default:var r=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".');throw r.algorithm=i.dekInfo.algorithm,r}var a=sn.util.hexToBytes(i.dekInfo.parameters),l=sn.pbe.opensslDeriveBytes(e,a.substr(0,8),s),c=o(l);if(c.start(a),c.update(sn.util.createBuffer(i.body)),c.finish())t=c.output.getBytes();else return t}else t=i.body;return i.type==="ENCRYPTED PRIVATE KEY"?t=ni.decryptPrivateKeyInfo(wt.fromDer(t),e):t=wt.fromDer(t),t!==null&&(t=ni.privateKeyFromAsn1(t)),t};ni.pbe.generatePkcs12Key=function(n,e,t,i,r,s){var o,a;if(typeof s>"u"||s===null){if(!("sha1"in sn.md))throw new Error('"sha1" hash algorithm unavailable.');s=sn.md.sha1.create()}var l=s.digestLength,c=s.blockLength,u=new sn.util.ByteBuffer,h=new sn.util.ByteBuffer;if(n!=null){for(a=0;a<n.length;a++)h.putInt16(n.charCodeAt(a));h.putInt16(0)}var p=h.length(),m=e.length(),y=new sn.util.ByteBuffer;y.fillWithByte(t,c);var b=c*Math.ceil(m/c),w=new sn.util.ByteBuffer;for(a=0;a<b;a++)w.putByte(e.at(a%m));var v=c*Math.ceil(p/c),T=new sn.util.ByteBuffer;for(a=0;a<v;a++)T.putByte(h.at(a%p));var S=w;S.putBuffer(T);for(var M=Math.ceil(r/l),P=1;P<=M;P++){var R=new sn.util.ByteBuffer;R.putBytes(y.bytes()),R.putBytes(S.bytes());for(var O=0;O<i;O++)s.start(),s.update(R.getBytes()),R=s.digest();var B=new sn.util.ByteBuffer;for(a=0;a<c;a++)B.putByte(R.at(a%l));var N=Math.ceil(m/c)+Math.ceil(p/c),I=new sn.util.ByteBuffer;for(o=0;o<N;o++){var F=new sn.util.ByteBuffer(S.getBytes(c)),j=511;for(a=B.length()-1;a>=0;a--)j=j>>8,j+=B.at(a)+F.at(a),F.setAt(a,j&255);I.putBuffer(F)}S=I,u.putBuffer(R)}return u.truncate(u.length()-r),u};ni.pbe.getCipher=function(n,e,t){switch(n){case ni.oids.pkcs5PBES2:return ni.pbe.getCipherForPBES2(n,e,t);case ni.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case ni.oids["pbewithSHAAnd40BitRC2-CBC"]:return ni.pbe.getCipherForPKCS12PBE(n,e,t);default:var i=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw i.oid=n,i.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],i}};ni.pbe.getCipherForPBES2=function(n,e,t){var i={},r=[];if(!wt.validate(e,pxe,i,r)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=r,s}if(n=wt.derToOid(i.kdfOid),n!==ni.oids.pkcs5PBKDF2){var s=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw s.oid=n,s.supportedOids=["pkcs5PBKDF2"],s}if(n=wt.derToOid(i.encOid),n!==ni.oids["aes128-CBC"]&&n!==ni.oids["aes192-CBC"]&&n!==ni.oids["aes256-CBC"]&&n!==ni.oids["des-EDE3-CBC"]&&n!==ni.oids.desCBC){var s=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw s.oid=n,s.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],s}var o=i.kdfSalt,a=sn.util.createBuffer(i.kdfIterationCount);a=a.getInt(a.length()<<3);var l,c;switch(ni.oids[n]){case"aes128-CBC":l=16,c=sn.aes.createDecryptionCipher;break;case"aes192-CBC":l=24,c=sn.aes.createDecryptionCipher;break;case"aes256-CBC":l=32,c=sn.aes.createDecryptionCipher;break;case"des-EDE3-CBC":l=24,c=sn.des.createDecryptionCipher;break;case"desCBC":l=8,c=sn.des.createDecryptionCipher;break}var u=rQ(i.prfOid),h=sn.pkcs5.pbkdf2(t,o,a,l,u),p=i.encIv,m=c(h);return m.start(p),m};ni.pbe.getCipherForPKCS12PBE=function(n,e,t){var i={},r=[];if(!wt.validate(e,mxe,i,r)){var s=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw s.errors=r,s}var o=sn.util.createBuffer(i.salt),a=sn.util.createBuffer(i.iterations);a=a.getInt(a.length()<<3);var l,c,u;switch(n){case ni.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,c=8,u=sn.des.startDecrypting;break;case ni.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,c=8,u=function(b,w){var v=sn.rc2.createDecryptionCipher(b,40);return v.start(w,null),v};break;default:var s=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw s.oid=n,s}var h=rQ(i.prfOid),p=ni.pbe.generatePkcs12Key(t,o,1,a,l,h);h.start();var m=ni.pbe.generatePkcs12Key(t,o,2,a,c,h);return u(p,m)};ni.pbe.opensslDeriveBytes=function(n,e,t,i){if(typeof i>"u"||i===null){if(!("md5"in sn.md))throw new Error('"md5" hash algorithm unavailable.');i=sn.md.md5.create()}e===null&&(e="");for(var r=[rz(i,n+e)],s=16,o=1;s<t;++o,s+=16)r.push(rz(i,r[o-1]+n+e));return r.join("").substr(0,t)};function rz(n,e){return n.start().update(e).digest().getBytes()}function rQ(n){var e;if(!n)e="hmacWithSHA1";else if(e=ni.oids[wt.derToOid(n)],!e){var t=new Error("Unsupported PRF OID.");throw t.oid=n,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}return sQ(e)}function sQ(n){var e=sn.md;switch(n){case"hmacWithSHA224":e=sn.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":n=n.substr(8).toLowerCase();break;default:var t=new Error("Unsupported PRF algorithm.");throw t.algorithm=n,t.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],t}if(!e||!(n in e))throw new Error("Unknown hash algorithm: "+n);return e[n].create()}function gxe(n,e,t,i){var r=wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OCTETSTRING,!1,n),wt.create(wt.Class.UNIVERSAL,wt.Type.INTEGER,!1,e.getBytes())]);return i!=="hmacWithSHA1"&&r.value.push(wt.create(wt.Class.UNIVERSAL,wt.Type.INTEGER,!1,sn.util.hexToBytes(t.toString(16))),wt.create(wt.Class.UNIVERSAL,wt.Type.SEQUENCE,!0,[wt.create(wt.Class.UNIVERSAL,wt.Type.OID,!1,wt.oidToDer(ni.oids[i]).getBytes()),wt.create(wt.Class.UNIVERSAL,wt.Type.NULL,!1,"")])),r}function Uu(n,e){let t=Uint8Array.from(n.abs().toByteArray());if(t=t[0]===0?t.subarray(1):t,e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=Ms([new Uint8Array(e-t.length),t])}return Vt(t,"base64url")}function Hc(n){const e=yxe(n);return new ha.jsbn.BigInteger(Vt(e,"base16"),16)}function yxe(n,e){let t=Ut(n,"base64urlpad");if(e!=null){if(t.length>e)throw new Error("byte array longer than desired length");t=Ms([new Uint8Array(e-t.length),t])}return t}function W0(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}const yb=32,Uf=64,Q6=32;function xxe(){const n=hh.utils.randomPrivateKey(),e=hh.getPublicKey(n);return{privateKey:oQ(n,e),publicKey:e}}function vxe(n){if(n.length!==Q6)throw new TypeError('"seed" must be 32 bytes in length.');if(!(n instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=n,t=hh.getPublicKey(e);return{privateKey:oQ(e,t),publicKey:t}}function bxe(n,e){const t=n.subarray(0,Q6);return hh.sign(e instanceof Uint8Array?e:e.subarray(),t)}function _xe(n,e,t){return hh.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}function oQ(n,e){const t=new Uint8Array(Uf);for(let i=0;i<Q6;i++)t[i]=n[i],t[Q6+i]=e[i];return t}const dh={get(n=globalThis){const e=n.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},FA={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function wxe(n){const e=n?.algorithm??"AES-GCM";let t=n?.keyLength??16;const i=n?.nonceLength??12,r=n?.digest??"SHA-256",s=n?.saltLength??16,o=n?.iterations??32767,a=dh.get();t*=8;async function l(h,p){const m=a.getRandomValues(new Uint8Array(s)),y=a.getRandomValues(new Uint8Array(i)),b={name:e,iv:y};typeof p=="string"&&(p=Ut(p));let w;if(p.length===0){w=await a.subtle.importKey("jwk",FA,{name:"AES-GCM"},!0,["encrypt"]);try{const T={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},S=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(T,S,{name:e,length:t},!0,["encrypt"])}catch{w=await a.subtle.importKey("jwk",FA,{name:"AES-GCM"},!0,["encrypt"])}}else{const T={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},S=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);w=await a.subtle.deriveKey(T,S,{name:e,length:t},!0,["encrypt"])}const v=await a.subtle.encrypt(b,w,h);return Ms([m,b.iv,new Uint8Array(v)])}async function c(h,p){const m=h.subarray(0,s),y=h.subarray(s,s+i),b=h.subarray(s+i),w={name:e,iv:y};typeof p=="string"&&(p=Ut(p));let v;if(p.length===0)try{const S={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},M=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(S,M,{name:e,length:t},!0,["decrypt"])}catch{v=await a.subtle.importKey("jwk",FA,{name:"AES-GCM"},!0,["decrypt"])}else{const S={name:"PBKDF2",salt:m,iterations:o,hash:{name:r}},M=await a.subtle.importKey("raw",p,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(S,M,{name:e,length:t},!0,["decrypt"])}const T=await a.subtle.decrypt(w,v,b);return new Uint8Array(T)}return{encrypt:l,decrypt:c}}async function vL(n,e){const i=await wxe().encrypt(n,e);return g7.encode(i)}var ms;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.Secp256k1="Secp256k1"})(ms||(ms={}));var NI;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.Secp256k1=2]="Secp256k1"})(NI||(NI={}));(function(n){n.codec=()=>u1(NI)})(ms||(ms={}));var N2;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.Type!=null&&(i.uint32(8),ms.codec().encode(t.Type,i)),t.Data!=null&&(i.uint32(18),i.bytes(t.Data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.Type=ms.codec().decode(t);break;case 2:r.Data=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(N2||(N2={}));var P2;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.Type!=null&&(i.uint32(8),ms.codec().encode(t.Type,i)),t.Data!=null&&(i.uint32(18),i.bytes(t.Data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.Type=ms.codec().decode(t);break;case 2:r.Data=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(P2||(P2={}));let bL=class{constructor(e){E(this,"_key");this._key=k2(e,yb)}verify(e,t){return _xe(this._key,t,e)}marshal(){return this._key}get bytes(){return N2.encode({Type:ms.Ed25519,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return W0(e)?e.then(({bytes:t})=>t):e.bytes}};class xb{constructor(e,t){E(this,"_key");E(this,"_publicKey");this._key=k2(e,Uf),this._publicKey=k2(t,yb)}sign(e){return bxe(this._key,e)}get public(){return new bL(this._publicKey)}marshal(){return this._key}get bytes(){return P2.encode({Type:ms.Ed25519,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}async hash(){const e=Ir.digest(this.bytes);let t;return W0(e)?{bytes:t}=await e:t=e.bytes,t}async id(){const e=xc.digest(this.public.bytes);return Lr.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if(t==="libp2p-key")return vL(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function Sxe(n){if(n.length>Uf){n=k2(n,Uf+yb);const i=n.subarray(0,Uf),r=n.subarray(Uf,n.length);return new xb(i,r)}n=k2(n,Uf);const e=n.subarray(0,Uf),t=n.subarray(yb);return new xb(e,t)}function Exe(n){return n=k2(n,yb),new bL(n)}async function Txe(){const{privateKey:n,publicKey:e}=xxe();return new xb(n,e)}async function Axe(n){const{privateKey:e,publicKey:t}=vxe(n);return new xb(e,t)}function k2(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new Se(`Key must be a Uint8Array of length ${e}, got ${n.length}`,"ERR_INVALID_KEY_TYPE");return n}const Cxe=Object.freeze(Object.defineProperty({__proto__:null,Ed25519PrivateKey:xb,Ed25519PublicKey:bL,generateKeyPair:Txe,generateKeyPairFromSeed:Axe,unmarshalEd25519PrivateKey:Sxe,unmarshalEd25519PublicKey:Exe},Symbol.toStringTag,{value:"Module"})),Mxe={"P-256":256,"P-384":384,"P-521":521},Rxe=Object.keys(Mxe);Rxe.join(" / ");var Mr=Vr,I_=Mr.sha512=Mr.sha512||{};Mr.md.sha512=Mr.md.algorithms.sha512=I_;var aQ=Mr.sha384=Mr.sha512.sha384=Mr.sha512.sha384||{};aQ.create=function(){return I_.create("SHA-384")};Mr.md.sha384=Mr.md.algorithms.sha384=aQ;Mr.sha512.sha256=Mr.sha512.sha256||{create:function(){return I_.create("SHA-512/256")}};Mr.md["sha512/256"]=Mr.md.algorithms["sha512/256"]=Mr.sha512.sha256;Mr.sha512.sha224=Mr.sha512.sha224||{create:function(){return I_.create("SHA-512/224")}};Mr.md["sha512/224"]=Mr.md.algorithms["sha512/224"]=Mr.sha512.sha224;I_.create=function(n){if(lQ||Ixe(),typeof n>"u"&&(n="SHA-512"),!(n in Zp))throw new Error("Invalid SHA-512 algorithm: "+n);for(var e=Zp[n],t=null,i=Mr.util.createBuffer(),r=new Array(80),s=0;s<80;++s)r[s]=new Array(2);var o=64;switch(n){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:n.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var l=a.messageLengthSize/4,c=0;c<l;++c)a.fullMessageLength.push(0);i=Mr.util.createBuffer(),t=new Array(e.length);for(var c=0;c<e.length;++c)t[c]=e[c].slice(0);return a},a.start(),a.update=function(l,c){c==="utf8"&&(l=Mr.util.encodeUtf8(l));var u=l.length;a.messageLength+=u,u=[u/4294967296>>>0,u>>>0];for(var h=a.fullMessageLength.length-1;h>=0;--h)a.fullMessageLength[h]+=u[1],u[1]=u[0]+(a.fullMessageLength[h]/4294967296>>>0),a.fullMessageLength[h]=a.fullMessageLength[h]>>>0,u[0]=u[1]/4294967296>>>0;return i.putBytes(l),sz(t,r,i),(i.read>2048||i.length()===0)&&i.compact(),a},a.digest=function(){var l=Mr.util.createBuffer();l.putBytes(i.bytes());var c=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,u=c&a.blockLength-1;l.putBytes(PI.substr(0,a.blockLength-u));for(var h,p,m=a.fullMessageLength[0]*8,y=0;y<a.fullMessageLength.length-1;++y)h=a.fullMessageLength[y+1]*8,p=h/4294967296>>>0,m+=p,l.putInt32(m>>>0),m=h>>>0;l.putInt32(m);for(var b=new Array(t.length),y=0;y<t.length;++y)b[y]=t[y].slice(0);sz(b,r,l);var w=Mr.util.createBuffer(),v;n==="SHA-512"?v=b.length:n==="SHA-384"?v=b.length-2:v=b.length-4;for(var y=0;y<v;++y)w.putInt32(b[y][0]),(y!==v-1||n!=="SHA-512/224")&&w.putInt32(b[y][1]);return w},a};var PI=null,lQ=!1,kI=null,Zp=null;function Ixe(){PI=String.fromCharCode(128),PI+=Mr.util.fillString(String.fromCharCode(0),128),kI=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],Zp={},Zp["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Zp["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Zp["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Zp["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],lQ=!0}function sz(n,e,t){for(var i,r,s,o,a,l,c,u,h,p,m,y,b,w,v,T,S,M,P,R,O,B,N,I,F,j,W,U,H,q,J,G,ee,Q,ne,fe=t.length();fe>=128;){for(H=0;H<16;++H)e[H][0]=t.getInt32()>>>0,e[H][1]=t.getInt32()>>>0;for(;H<80;++H)G=e[H-2],q=G[0],J=G[1],i=((q>>>19|J<<13)^(J>>>29|q<<3)^q>>>6)>>>0,r=((q<<13|J>>>19)^(J<<3|q>>>29)^(q<<26|J>>>6))>>>0,Q=e[H-15],q=Q[0],J=Q[1],s=((q>>>1|J<<31)^(q>>>8|J<<24)^q>>>7)>>>0,o=((q<<31|J>>>1)^(q<<24|J>>>8)^(q<<25|J>>>7))>>>0,ee=e[H-7],ne=e[H-16],J=r+ee[1]+o+ne[1],e[H][0]=i+ee[0]+s+ne[0]+(J/4294967296>>>0)>>>0,e[H][1]=J>>>0;for(b=n[0][0],w=n[0][1],v=n[1][0],T=n[1][1],S=n[2][0],M=n[2][1],P=n[3][0],R=n[3][1],O=n[4][0],B=n[4][1],N=n[5][0],I=n[5][1],F=n[6][0],j=n[6][1],W=n[7][0],U=n[7][1],H=0;H<80;++H)c=((O>>>14|B<<18)^(O>>>18|B<<14)^(B>>>9|O<<23))>>>0,u=((O<<18|B>>>14)^(O<<14|B>>>18)^(B<<23|O>>>9))>>>0,h=(F^O&(N^F))>>>0,p=(j^B&(I^j))>>>0,a=((b>>>28|w<<4)^(w>>>2|b<<30)^(w>>>7|b<<25))>>>0,l=((b<<4|w>>>28)^(w<<30|b>>>2)^(w<<25|b>>>7))>>>0,m=(b&v|S&(b^v))>>>0,y=(w&T|M&(w^T))>>>0,J=U+u+p+kI[H][1]+e[H][1],i=W+c+h+kI[H][0]+e[H][0]+(J/4294967296>>>0)>>>0,r=J>>>0,J=l+y,s=a+m+(J/4294967296>>>0)>>>0,o=J>>>0,W=F,U=j,F=N,j=I,N=O,I=B,J=R+r,O=P+i+(J/4294967296>>>0)>>>0,B=J>>>0,P=S,R=M,S=v,M=T,v=b,T=w,J=r+o,b=i+s+(J/4294967296>>>0)>>>0,w=J>>>0;J=n[0][1]+w,n[0][0]=n[0][0]+b+(J/4294967296>>>0)>>>0,n[0][1]=J>>>0,J=n[1][1]+T,n[1][0]=n[1][0]+v+(J/4294967296>>>0)>>>0,n[1][1]=J>>>0,J=n[2][1]+M,n[2][0]=n[2][0]+S+(J/4294967296>>>0)>>>0,n[2][1]=J>>>0,J=n[3][1]+R,n[3][0]=n[3][0]+P+(J/4294967296>>>0)>>>0,n[3][1]=J>>>0,J=n[4][1]+B,n[4][0]=n[4][0]+O+(J/4294967296>>>0)>>>0,n[4][1]=J>>>0,J=n[5][1]+I,n[5][0]=n[5][0]+N+(J/4294967296>>>0)>>>0,n[5][1]=J>>>0,J=n[6][1]+j,n[6][0]=n[6][0]+F+(J/4294967296>>>0)>>>0,n[6][1]=J>>>0,J=n[7][1]+U,n[7][0]=n[7][0]+W+(J/4294967296>>>0)>>>0,n[7][1]=J>>>0,fe-=128}}function Nxe(n){if(isNaN(n)||n<=0)throw new Se("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return rx(n)}function cQ(n,e){return e.map(t=>Hc(n[t]))}function Pxe(n){return ha.pki.setRsaPrivateKey(...cQ(n,["n","e","d","p","q","dp","dq","qi"]))}function kxe(n){return ha.pki.setRsaPublicKey(...cQ(n,["n","e"]))}function Lxe(n){const e=ha.asn1.fromDer(Vt(n,"ascii")),t=ha.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:Uu(t.n),e:Uu(t.e),d:Uu(t.d),p:Uu(t.p),q:Uu(t.q),dp:Uu(t.dP),dq:Uu(t.dQ),qi:Uu(t.qInv),alg:"RS256"}}function Dxe(n){if(n.n==null||n.e==null||n.d==null||n.p==null||n.q==null||n.dp==null||n.dq==null||n.qi==null)throw new Se("JWK was missing components","ERR_INVALID_PARAMETERS");const e=ha.pki.privateKeyToAsn1({n:Hc(n.n),e:Hc(n.e),d:Hc(n.d),p:Hc(n.p),q:Hc(n.q),dP:Hc(n.dp),dQ:Hc(n.dq),qInv:Hc(n.qi)});return Ut(ha.asn1.toDer(e).getBytes(),"ascii")}function Oxe(n){const e=ha.asn1.fromDer(Vt(n,"ascii")),t=ha.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:Uu(t.n),e:Uu(t.e)}}function Bxe(n){if(n.n==null||n.e==null)throw new Se("JWK was missing components","ERR_INVALID_PARAMETERS");const e=ha.pki.publicKeyToAsn1({n:Hc(n.n),e:Hc(n.e)});return Ut(ha.asn1.toDer(e).getBytes(),"ascii")}async function Uxe(n){const e=await dh.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:n,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),t=await hQ(e);return{privateKey:t[0],publicKey:t[1]}}async function uQ(n){const t=[await dh.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await jxe(n)],i=await hQ({privateKey:t[0],publicKey:t[1]});return{privateKey:i[0],publicKey:i[1]}}async function Fxe(n,e){const t=await dh.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),i=await dh.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},t,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)}async function zxe(n,e,t){const i=await dh.get().subtle.importKey("jwk",n,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return dh.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},i,e,t instanceof Uint8Array?t:t.subarray())}async function hQ(n){if(n.privateKey==null||n.publicKey==null)throw new Se("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([dh.get().subtle.exportKey("jwk",n.privateKey),dh.get().subtle.exportKey("jwk",n.publicKey)])}async function jxe(n){return dh.get().subtle.importKey("jwk",{kty:n.kty,n:n.n,e:n.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function dQ(n,e,t,i){const r=e?kxe(n):Pxe(n),s=Vt(t instanceof Uint8Array?t:t.subarray(),"ascii"),o=i(s,r);return Ut(o,"ascii")}function Vxe(n,e){return dQ(n,!0,e,(t,i)=>i.encrypt(t))}function Hxe(n,e){return dQ(n,!1,e,(t,i)=>i.decrypt(t))}function _L(n){if(n.kty!=="RSA")throw new Se("invalid key type","ERR_INVALID_KEY_TYPE");if(n.n==null)throw new Se("invalid key modulus","ERR_INVALID_KEY_MODULUS");return Ut(n.n,"base64url").length*8}const N_=8192;class wL{constructor(e){E(this,"_key");this._key=e}verify(e,t){return zxe(this._key,t,e)}marshal(){return Bxe(this._key)}get bytes(){return N2.encode({Type:ms.RSA,Data:this.marshal()}).subarray()}encrypt(e){return Vxe(this._key,e)}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return W0(e)?e.then(({bytes:t})=>t):e.bytes}}class V7{constructor(e,t){E(this,"_key");E(this,"_publicKey");this._key=e,this._publicKey=t}genSecret(){return Nxe(16)}sign(e){return Fxe(this._key,e)}get public(){if(this._publicKey==null)throw new Se("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new wL(this._publicKey)}decrypt(e){return Hxe(this._key,e)}marshal(){return Dxe(this._key)}get bytes(){return P2.encode({Type:ms.RSA,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return W0(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return Vt(e,"base58btc")}async export(e,t="pkcs-8"){if(t==="pkcs-8"){const i=new ha.util.ByteBuffer(this.marshal()),r=ha.asn1.fromDer(i),s=ha.pki.privateKeyFromAsn1(r),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return ha.pki.encryptRsaPrivateKey(s,e,o)}else{if(t==="libp2p-key")return vL(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}}async function $xe(n){const e=Lxe(n);if(_L(e)>N_)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await uQ(e);return new V7(t.privateKey,t.publicKey)}function Gxe(n){const e=Oxe(n);if(_L(e)>N_)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new wL(e)}async function Wxe(n){if(_L(n)>N_)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await uQ(n);return new V7(e.privateKey,e.publicKey)}async function Kxe(n){if(n>N_)throw new Se("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const e=await Uxe(n);return new V7(e.privateKey,e.publicKey)}const qxe=Object.freeze(Object.defineProperty({__proto__:null,MAX_KEY_SIZE:N_,RsaPrivateKey:V7,RsaPublicKey:wL,fromJwk:Wxe,generateKeyPair:Kxe,unmarshalRsaPrivateKey:$xe,unmarshalRsaPublicKey:Gxe},Symbol.toStringTag,{value:"Module"}));function Zxe(){return Hs.utils.randomPrivateKey()}function Yxe(n,e){const t=Ir.digest(e instanceof Uint8Array?e:e.subarray());if(W0(t))return t.then(({digest:i})=>Hs.sign(i,n).toDERRawBytes()).catch(i=>{throw new Se(String(i),"ERR_INVALID_INPUT")});try{return Hs.sign(t.digest,n).toDERRawBytes()}catch(i){throw new Se(String(i),"ERR_INVALID_INPUT")}}function Xxe(n,e,t){const i=Ir.digest(t instanceof Uint8Array?t:t.subarray());if(W0(i))return i.then(({digest:r})=>Hs.verify(e,r,n)).catch(r=>{throw new Se(String(r),"ERR_INVALID_INPUT")});try{return Hs.verify(e,i.digest,n)}catch(r){throw new Se(String(r),"ERR_INVALID_INPUT")}}function Qxe(n){return Hs.ProjectivePoint.fromHex(n).toRawBytes(!0)}function Jxe(n){try{Hs.getPublicKey(n,!0)}catch(e){throw new Se(String(e),"ERR_INVALID_PRIVATE_KEY")}}function fQ(n){try{Hs.ProjectivePoint.fromHex(n)}catch(e){throw new Se(String(e),"ERR_INVALID_PUBLIC_KEY")}}function eve(n){try{return Hs.getPublicKey(n,!0)}catch(e){throw new Se(String(e),"ERR_INVALID_PRIVATE_KEY")}}let SL=class{constructor(e){E(this,"_key");fQ(e),this._key=e}verify(e,t){return Xxe(this._key,t,e)}marshal(){return Qxe(this._key)}get bytes(){return N2.encode({Type:ms.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}async hash(){const e=Ir.digest(this.bytes);let t;return W0(e)?{bytes:t}=await e:t=e.bytes,t}};class EL{constructor(e,t){E(this,"_key");E(this,"_publicKey");this._key=e,this._publicKey=t??eve(e),Jxe(this._key),fQ(this._publicKey)}sign(e){return Yxe(this._key,e)}get public(){return new SL(this._publicKey)}marshal(){return this._key}get bytes(){return P2.encode({Type:ms.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return li(this.bytes,e.bytes)}hash(){const e=Ir.digest(this.bytes);return W0(e)?e.then(({bytes:t})=>t):e.bytes}async id(){const e=await this.public.hash();return Vt(e,"base58btc")}async export(e,t="libp2p-key"){if(t==="libp2p-key")return vL(this.bytes,e);throw new Se(`export format '${t}' is not supported`,"ERR_INVALID_EXPORT_FORMAT")}}function tve(n){return new EL(n)}function nve(n){return new SL(n)}async function ive(){const n=Zxe();return new EL(n)}const rve=Object.freeze(Object.defineProperty({__proto__:null,Secp256k1PrivateKey:EL,Secp256k1PublicKey:SL,generateKeyPair:ive,unmarshalSecp256k1PrivateKey:tve,unmarshalSecp256k1PublicKey:nve},Symbol.toStringTag,{value:"Module"})),Mm={rsa:qxe,ed25519:Cxe,secp256k1:rve};function pQ(n){const e=Object.keys(Mm).join(" / ");return new Se(`invalid or unsupported key type ${n}. Must be ${e}`,"ERR_UNSUPPORTED_KEY_TYPE")}function sve(n){const e=N2.decode(n),t=e.Data??new Uint8Array;switch(e.Type){case ms.RSA:return Mm.rsa.unmarshalRsaPublicKey(t);case ms.Ed25519:return Mm.ed25519.unmarshalEd25519PublicKey(t);case ms.Secp256k1:return Mm.secp256k1.unmarshalSecp256k1PublicKey(t);default:throw pQ(e.Type??"unknown")}}async function ove(n){const e=P2.decode(n),t=e.Data??new Uint8Array;switch(e.Type){case ms.RSA:return Mm.rsa.unmarshalRsaPrivateKey(t);case ms.Ed25519:return Mm.ed25519.unmarshalEd25519PrivateKey(t);case ms.Secp256k1:return Mm.secp256k1.unmarshalSecp256k1PrivateKey(t);default:throw pQ(e.Type??"RSA")}}var J6;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)i.uint32(10),i.bytes(s);r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={webtransportCerthashes:[]},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:{r.webtransportCerthashes.push(t.bytes());break}default:{t.skipType(o&7);break}}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(J6||(J6={}));var e8;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(i.uint32(10),i.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(i.uint32(18),i.bytes(t.identitySig)),t.extensions!=null&&(i.uint32(34),J6.codec().encode(t.extensions,i)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={identityKey:qn(0),identitySig:qn(0)},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:{r.identityKey=t.bytes();break}case 2:{r.identitySig=t.bytes();break}case 4:{r.extensions=J6.codec().decode(t,t.uint32());break}default:{t.skipType(o&7);break}}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(e8||(e8={}));async function ave(n,e,t){const i=await cve(n,mQ(e));if(n.publicKey==null)throw new Error("PublicKey was missing from local PeerId");return lve(n.publicKey,i,t)}function lve(n,e,t){return e8.encode({identityKey:n,identitySig:e,extensions:t??{webtransportCerthashes:[]}}).subarray()}async function cve(n,e){if(n.privateKey==null)throw new Error("PrivateKey was missing from PeerId");return(await ove(n.privateKey)).sign(e)}async function oz(n){return jd(n.identityKey)}function az(n){return e8.decode(n)}function mQ(n){const e=Ut("noise-libp2p-static-key:");return n instanceof Uint8Array?Ms([e,n],e.length+n.length):(n.prepend(e),n)}async function lz(n,e,t){const i=await jd(e.identityKey);if(!i.equals(t))throw new Error(`Payload identity key ${i.toString()} does not match expected remote peer ${t.toString()}`);const r=mQ(n);if(i.publicKey==null)throw new Error("PublicKey was missing from PeerId");if(e.identitySig==null)throw new Error("Signature was missing from message");if(!await sve(i.publicKey).verify(r,e.identitySig))throw new Error("Static key doesn't match to peer that signed payload!");return i}function w4(n){return!(!(n instanceof Uint8Array)&&!Wv(n)||n.byteLength!==32)}function L2(n,e){if(n.length!==e.length)throw new Error("Inputs should have the same length");const t=Cs(n.length);for(let i=0;i<n.length;i++)t[i]=n[i]^e[i];return t}const uve=0,hve=4294967295,dve="Cipherstate has reached maximum n, a new handshake must be performed";class fve{constructor(e=uve){E(this,"n");E(this,"bytes");E(this,"view");this.n=e,this.bytes=qn(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>hve)throw new Error(dve)}}class pve{constructor(e,t){E(this,"crypto");E(this,"log");this.log=e.logger.forComponent("libp2p:noise:abstract-handshake"),this.crypto=t}encryptWithAd(e,t,i){const r=this.encrypt(e.k,e.n,t,i);return e.n.increment(),r}decryptWithAd(e,t,i,r){const{plaintext:s,valid:o}=this.decrypt(e.k,e.n,t,i,r);return o&&e.n.increment(),{plaintext:s,valid:o}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return qn(32)}isEmptyKey(e){const t=this.createEmptyKey();return li(t,e)}encrypt(e,t,i,r){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(r,t.getBytes(),i,e)}encryptAndHash(e,t){let i;return this.hasKey(e.cs)?i=this.encryptWithAd(e.cs,e.h,t):i=t,this.mixHash(e,i),i}decrypt(e,t,i,r,s){t.assertValue();const o=this.crypto.chaCha20Poly1305Decrypt(r,t.getBytes(),i,e,s);return o?{plaintext:o,valid:!0}:{plaintext:qn(0),valid:!1}}decryptAndHash(e,t){let i,r=!0;return this.hasKey(e.cs)?{plaintext:i,valid:r}=this.decryptWithAd(e.cs,e.h,t):i=t,this.mixHash(e,t),{plaintext:i,valid:r}}dh(e,t){try{const i=this.crypto.generateX25519SharedKey(e,t);return i.length===32?i:i.subarray(0,32)}catch(i){const r=i;return this.log.error("error deriving shared key",r),qn(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){return this.crypto.hashSHA256(new Zn(e,t))}mixKey(e,t){const[i,r]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(r),e.ck=i}initializeKey(e){return{k:e,n:new fve}}initializeSymmetric(e){const t=Ut(e,"utf-8"),i=this.hashProtocolName(t),r=i,s=this.createEmptyKey();return{cs:this.initializeKey(s),ck:r,h:i}}hashProtocolName(e){if(e.length<=32){const t=qn(32);return t.set(e),t}else return this.getHash(e,qn(0))}split(e){const[t,i]=this.crypto.getHKDF(e.ck,qn(0)),r=this.initializeKey(t),s=this.initializeKey(i);return{cs1:r,cs2:s}}writeMessageRegular(e,t){const i=this.encryptWithAd(e,qn(0),t),r=this.createEmptyKey(),s=qn(0);return{ne:r,ns:s,ciphertext:i}}readMessageRegular(e,t){return this.decryptWithAd(e,qn(0),t.ciphertext)}}class mve extends pve{initializeInitiator(e,t,i,r){const s="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(s);this.mixHash(o,e);const a=qn(32);return{ss:o,s:t,rs:i,psk:r,re:a}}initializeResponder(e,t,i,r){const s="Noise_XX_25519_ChaChaPoly_SHA256",o=this.initializeSymmetric(s);this.mixHash(o,e);const a=qn(32);return{ss:o,s:t,rs:i,psk:r,re:a}}writeMessageA(e,t,i){const r=qn(0);i!==void 0?e.e=i:e.e=this.crypto.generateX25519KeyPair();const s=e.e.publicKey;this.mixHash(e.ss,s);const o=this.encryptAndHash(e.ss,t);return{ne:s,ns:r,ciphertext:o}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const i=e.e.publicKey;this.mixHash(e.ss,i),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const r=e.s.publicKey,s=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const o=this.encryptAndHash(e.ss,t);return{ne:i,ns:s,ciphertext:o}}writeMessageC(e,t){const i=e.s.publicKey,r=this.encryptAndHash(e.ss,i);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const s=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:r,ciphertext:s},{cs1:l,cs2:c}=this.split(e.ss);return{h:e.ss.h,messageBuffer:a,cs1:l,cs2:c}}readMessageA(e,t){return w4(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(w4(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:i,valid:r}=this.decryptAndHash(e.ss,t.ns);r&&w4(i)&&(e.rs=i),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:o}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:r&&o}}readMessageC(e,t){const{plaintext:i,valid:r}=this.decryptAndHash(e.ss,t.ns);if(r&&w4(i)&&(e.rs=i),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:o}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:a,cs2:l}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:r&&o,cs1:a,cs2:l}}initSession(e,t,i){const r=this.createEmptyKey(),s=qn(32);let o;return e?o=this.initializeInitiator(t,i,s,r):o=this.initializeResponder(t,i,s,r),{hs:o,i:e,mc:0}}sendMessage(e,t,i){let r;if(e.mc===0)r=this.writeMessageA(e.hs,t,i);else if(e.mc===1)r=this.writeMessageB(e.hs,t);else if(e.mc===2){const{h:s,messageBuffer:o,cs1:a,cs2:l}=this.writeMessageC(e.hs,t);r=o,e.h=s,e.cs1=a,e.cs2=l}else if(e.mc>2)if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}else throw new Error("Session invalid.");return e.mc++,r}recvMessage(e,t){let i=qn(0),r=!1;if(e.mc===0)({plaintext:i,valid:r}=this.readMessageA(e.hs,t));else if(e.mc===1)({plaintext:i,valid:r}=this.readMessageB(e.hs,t));else if(e.mc===2){const{h:s,plaintext:o,valid:a,cs1:l,cs2:c}=this.readMessageC(e.hs,t);i=o,r=a,e.h=s,e.cs1=l,e.cs2=c}return e.mc++,{plaintext:i,valid:r}}}function gve(n,e){!e.enabled||!C_||(e(`LOCAL_STATIC_PUBLIC_KEY ${Vt(n.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${Vt(n.privateKey,"hex")}`))}function cz(n,e){!e.enabled||!C_||(n?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${Vt(n.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${Vt(n.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function yve(n,e){!e.enabled||!C_||e(`REMOTE_STATIC_PUBLIC_KEY ${Vt(n.subarray(),"hex")}`)}function uz(n,e){!e.enabled||!C_||e(`REMOTE_EPHEMERAL_PUBLIC_KEY ${Vt(n.subarray(),"hex")}`)}function xve(n,e){!e.enabled||!C_||(n.cs1&&n.cs2?(e(`CIPHER_STATE_1 ${n.cs1.n.getUint64()} ${Vt(n.cs1.k,"hex")}`),e(`CIPHER_STATE_2 ${n.cs2.n.getUint64()} ${Vt(n.cs2.k,"hex")}`)):e("Missing cipher state."))}class vve{constructor(e,t,i,r,s,o,a,l,c){E(this,"isInitiator");E(this,"session");E(this,"remotePeer");E(this,"remoteExtensions",{webtransportCerthashes:[]});E(this,"payload");E(this,"connection");E(this,"xx");E(this,"staticKeypair");E(this,"prologue");E(this,"log");this.log=e.logger.forComponent("libp2p:noise:xxhandshake"),this.isInitiator=t,this.payload=i,this.prologue=r,this.staticKeypair=o,this.connection=a,l&&(this.remotePeer=l),this.xx=c??new mve(e,s),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(gve(this.session.hs.s,this.log),this.isInitiator){this.log.trace("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,qn(0));await this.connection.write(Uge(e)),this.log.trace("Stage 0 - Initiator finished sending first message."),cz(this.session.hs.e,this.log)}else{this.log.trace("Stage 0 - Responder waiting to receive first message...");const e=jge((await this.connection.read()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new ry("xx handshake stage 0 validation fail");this.log.trace("Stage 0 - Responder received first message."),uz(this.session.hs.re,this.log)}}async exchange(){if(this.isInitiator){this.log.trace("Stage 1 - Initiator waiting to receive first message from responder...");const e=Vge((await this.connection.read()).subarray()),{plaintext:t,valid:i}=this.xx.recvMessage(this.session,e);if(!i)throw new ry("xx handshake stage 1 validation fail");this.log.trace("Stage 1 - Initiator received the message."),uz(this.session.hs.re,this.log),yve(this.session.hs.rs,this.log),this.log.trace("Initiator going to check remote's signature...");try{const r=az(t);this.remotePeer=this.remotePeer||await oz(r),await lz(this.session.hs.rs,r,this.remotePeer),this.setRemoteNoiseExtension(r.extensions)}catch(r){const s=r;throw new K6(`Error occurred while verifying signed payload: ${s.message}`)}this.log.trace("All good with the signature!")}else{this.log.trace("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(Fge(e)),this.log.trace("Stage 1 - Responder sent the second handshake message with signed payload."),cz(this.session.hs.e,this.log)}}async finish(){if(this.isInitiator){this.log.trace("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);await this.connection.write(zge(e)),this.log.trace("Stage 2 - Initiator sent message with signed payload.")}else{this.log.trace("Stage 2 - Responder waiting for third handshake message...");const e=Hge((await this.connection.read()).subarray()),{plaintext:t,valid:i}=this.xx.recvMessage(this.session,e);if(!i)throw new ry("xx handshake stage 2 validation fail");this.log.trace("Stage 2 - Responder received the message, finished handshake.");try{const r=az(t);this.remotePeer=this.remotePeer||await oz(r),await lz(this.session.hs.rs,r,this.remotePeer),this.setRemoteNoiseExtension(r.extensions)}catch(r){const s=r;throw new K6(`Error occurred while verifying signed payload: ${s.message}`)}}xve(this.session,this.log)}encrypt(e,t){const i=this.getCS(t);return this.xx.encryptWithAd(i,qn(0),e)}decrypt(e,t,i){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,qn(0),e,i)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new ry("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}function bve(n){return{xxHandshakeSuccesses:n.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:n.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:n.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:n.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:n.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}class _ve{constructor(e,t={}){E(this,"protocol","/noise");E(this,"crypto");E(this,"prologue");E(this,"staticKeys");E(this,"extensions");E(this,"metrics");E(this,"components");const{staticNoiseKey:i,extensions:r,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e,this.crypto=s??Bge,this.extensions=r,this.metrics=a?bve(a):void 0,i?this.staticKeys=this.crypto.generateX25519KeyPairFromSeed(i):this.staticKeys=this.crypto.generateX25519KeyPair(),this.prologue=o??qn(0)}async secureOutbound(e,t,i){const r=R2(t,{lengthEncoder:W6,lengthDecoder:wS,maxDataLength:gb}),s=await this.performHandshake({connection:r,isInitiator:!0,localPeer:e,remotePeer:i}),o=await this.createSecureConnection(r,s);return t.source=o.source,t.sink=o.sink,{conn:t,remoteExtensions:s.remoteExtensions,remotePeer:s.remotePeer}}async secureInbound(e,t,i){const r=R2(t,{lengthEncoder:W6,lengthDecoder:wS,maxDataLength:gb}),s=await this.performHandshake({connection:r,isInitiator:!1,localPeer:e,remotePeer:i}),o=await this.createSecureConnection(r,s);return t.source=o.source,t.sink=o.sink,{conn:t,remotePeer:s.remotePeer,remoteExtensions:s.remoteExtensions}}async performHandshake(e){const t=await ave(e.localPeer,this.staticKeys.publicKey,this.extensions);return this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:i,remotePeer:r,connection:s}=e,o=new vve(this.components,i,t,this.prologue,this.crypto,this.staticKeys,s,r);try{await o.propose(),await o.exchange(),await o.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(a){if(this.metrics?.xxHandshakeErrors.increment(),a instanceof Error)throw a.message=`Error occurred during XX handshake: ${a.message}`,a}return o}async createSecureConnection(e,t){const[i,r]=lge(),s=e.unwrap();return await Qa(i,$ge(t,this.metrics),s,o=>I2(o,{lengthDecoder:wS}),Gge(t,this.metrics),i),r}}function wve(n={}){return e=>new _ve(e,n)}function gQ(n){if(n!=null){if(typeof n[Symbol.iterator]=="function")return n[Symbol.iterator]();if(typeof n[Symbol.asyncIterator]=="function")return n[Symbol.asyncIterator]();if(typeof n.next=="function")return n}throw new Error("argument is not an iterator or iterable")}const e3="ERR_INVALID_FRAME",yQ="ERR_UNREQUESTED_PING",xQ="ERR_NOT_MATCHING_PING",vQ="ERR_STREAM_ALREADY_EXISTS",bQ="ERR_DECODE_INVALID_VERSION",_Q="ERR_BOTH_CLIENTS",wQ="ERR_RECV_WINDOW_EXCEEDED",Sve=new Set([e3,yQ,xQ,vQ,bQ,_Q,wQ]),wp="ERR_INVALID_CONFIG",zA="ERR_MUXER_LOCAL_CLOSED",hz="ERR_MUXER_REMOTE_CLOSED",Eve="ERR_STREAM_ABORT",Tve="ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED",Ave="ERR_DECODE_IN_PROGRESS",TL=256*1024,Cve=16*1024*1024,Mve={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:TL,maxStreamWindowSize:Cve,maxMessageSize:64*1024};function Rve(n){if(n.keepAliveInterval<=0)throw new Se("keep-alive interval must be positive",wp);if(n.maxInboundStreams<0)throw new Se("max inbound streams must be larger or equal 0",wp);if(n.maxOutboundStreams<0)throw new Se("max outbound streams must be larger or equal 0",wp);if(n.initialStreamWindowSize<TL)throw new Se("InitialStreamWindowSize must be larger or equal 256 kB",wp);if(n.maxStreamWindowSize<n.initialStreamWindowSize)throw new Se("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",wp);if(n.maxStreamWindowSize>2**32-1)throw new Se("MaxStreamWindowSize must be less than equal MAX_UINT32",wp);if(n.maxMessageSize<1024)throw new Se("MaxMessageSize must be greater than a kilobyte",wp)}var Ss;(function(n){n[n.Data=0]="Data",n[n.WindowUpdate=1]="WindowUpdate",n[n.Ping=2]="Ping",n[n.GoAway=3]="GoAway"})(Ss||(Ss={}));var qr;(function(n){n[n.SYN=1]="SYN",n[n.ACK=2]="ACK",n[n.FIN=4]="FIN",n[n.RST=8]="RST"})(qr||(qr={}));Object.values(qr).filter(n=>typeof n!="string");const Ive=0;var Fu;(function(n){n[n.NormalTermination=0]="NormalTermination",n[n.ProtocolError=1]="ProtocolError",n[n.InternalError=2]="InternalError"})(Fu||(Fu={}));const _3=12,dz=2**24;function Nve(n){if(n[0]!==Ive)throw new Se("Invalid frame version",bQ);return{type:n[1],flag:(n[2]<<8)+n[3],streamID:n[4]*dz+(n[5]<<16)+(n[6]<<8)+n[7],length:n[8]*dz+(n[9]<<16)+(n[10]<<8)+n[11]}}let Pve=class{constructor(e){E(this,"source");E(this,"buffer");E(this,"frameInProgress");this.source=kve(e),this.buffer=new Zn,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:i,length:r}=t;i===Ss.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,r)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new Se("decoding frame already in progress",Ave);if(this.buffer.length<_3)return;const e=Nve(this.buffer.subarray(0,_3));return this.buffer.consume(_3),e}async readBytes(e){if(this.buffer.length<e){for await(const i of this.source)if(this.buffer.append(i),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}};function kve(n){if(n[Symbol.iterator]!==void 0){const e=n[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(n[Symbol.asyncIterator]!==void 0){const e=n[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function fz(n){const e=new Uint8Array(_3);return e[1]=n.type,e[2]=n.flag>>>8,e[3]=n.flag,e[4]=n.streamID>>>24,e[5]=n.streamID>>>16,e[6]=n.streamID>>>8,e[7]=n.streamID,e[8]=n.length>>>24,e[9]=n.length>>>16,e[10]=n.length>>>8,e[11]=n.length,e}function Lve(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}function SQ(n,e){const t=gQ(n).return?.();Lve(t)&&t.catch(i=>{e.error("could not cause iterator to return",i)})}const Dve="ERR_STREAM_RESET",Ove="ERR_SINK_INVALID_STATE",Bve=5e3;function jA(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}class AL{constructor(e){E(this,"id");E(this,"direction");E(this,"timeline");E(this,"protocol");E(this,"metadata");E(this,"source");E(this,"status");E(this,"readStatus");E(this,"writeStatus");E(this,"log");E(this,"sinkController");E(this,"sinkEnd");E(this,"closed");E(this,"endErr");E(this,"streamSource");E(this,"onEnd");E(this,"onCloseRead");E(this,"onCloseWrite");E(this,"onReset");E(this,"onAbort");E(this,"sendCloseWriteTimeout");E(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=Ki(),this.closed=Ki(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??Bve,this.onEnd=e.onEnd,this.onCloseRead=e?.onCloseRead,this.onCloseWrite=e?.onCloseWrite,this.onReset=e?.onReset,this.onAbort=e?.onAbort,this.source=this.streamSource=vc({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new Se(`writable end state is "${this.writeStatus}" not "ready"`,Ove);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const r=this.sendNewStream(t);jA(r)&&await r}const i=()=>{SQ(e,this.log)};try{this.sinkController.signal.addEventListener("abort",i),this.log.trace("sink reading from source");for await(let r of e){r=r instanceof Uint8Array?new Zn(r):r;const s=this.sendData(r,t);jA(s)&&(this.sendingData=Ki(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",i)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseRead?.(),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),this.onCloseWrite?.(),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.log.trace("closing gracefully"),this.status="closing",await eu(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e?.signal),this.status="closed",this.log.trace("closed gracefully")}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await eu(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await eu(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await eu(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();jA(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),this.onAbort?.(e)}reset(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new Se("stream reset",Dve);this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),this.onReset?.()}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}function Uve(n){return n[Symbol.asyncIterator]!=null}function pz(n){return n?.then!=null}function Fve(n,e){let t=0;if(Uve(n))return async function*(){for await(const l of n){const c=e(l,t++);pz(c)&&await c,yield l}}();const i=Yk(n),{value:r,done:s}=i.next();if(s===!0)return function*(){}();const o=e(r,t++);if(typeof o?.then=="function")return async function*(){await o,yield r;for(const l of i){const c=e(l,t++);pz(c)&&await c,yield l}}();const a=e;return function*(){yield r;for(const l of i)a(l,t++),yield l}()}var qc;(function(n){n[n.Init=0]="Init",n[n.SYNSent=1]="SYNSent",n[n.SYNReceived=2]="SYNReceived",n[n.Established=3]="Established",n[n.Finished=4]="Finished"})(qc||(qc={}));class zve extends AL{constructor(t){super({...t,onEnd:i=>{this.state=qc.Finished,t.onEnd?.(i)}});E(this,"name");E(this,"state");E(this,"config");E(this,"_id");E(this,"sendWindowCapacity");E(this,"sendWindowCapacityUpdate");E(this,"recvWindow");E(this,"recvWindowCapacity");E(this,"epochStart");E(this,"getRTT");E(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=TL,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=Fve(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,i={}){for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&(this.log?.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(i),this.status==="closed"||this.status==="aborted"||this.status==="reset")){this.log?.trace("%s while waiting for send window capacity",this.status);return}const r=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-_3,t.length),s=this.getSendFlags();this.sendFrame({type:Ss.Data,flag:s,streamID:this._id,length:r},t.sublist(0,r)),this.sendWindowCapacity-=r,t.consume(r)}}async sendReset(){this.sendFrame({type:Ss.WindowUpdate,flag:qr.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|qr.FIN;this.sendFrame({type:Ss.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){if(this.sendWindowCapacity>0)return;let i,r;const s=()=>{this.status==="open"||this.status==="closing"?r(new Se("stream aborted",Eve)):i()};t.signal?.addEventListener("abort",s);try{await new Promise((o,a)=>{this.sendWindowCapacityUpdate=()=>{o()},r=a,i=o})}finally{t.signal?.removeEventListener("abort",s)}}handleWindowUpdate(t){this.log?.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const i=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,i===0&&t.length>0&&this.sendWindowCapacityUpdate?.()}async handleData(t,i){if(this.log?.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new Se("receive window exceeded",wQ,{available:this.recvWindowCapacity,recv:t.length});const r=await i();this.recvWindowCapacity-=t.length,this.sourcePush(r)}processFlags(t){(t&qr.ACK)===qr.ACK&&this.state===qc.SYNSent&&(this.state=qc.Established),(t&qr.FIN)===qr.FIN&&this.remoteCloseWrite(),(t&qr.RST)===qr.RST&&this.reset()}getSendFlags(){switch(this.state){case qc.Init:return this.state=qc.SYNSent,qr.SYN;case qc.SYNReceived:return this.state=qc.Established,qr.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),i=Date.now(),r=this.getRTT();if(t===0&&r>-1&&i-this.epochStart<r*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=i,this.sendFrame({type:Ss.WindowUpdate,flag:t,streamID:this._id,length:s})}}const EQ="/yamux/1.0.0",jve=500;class Vve{constructor(e,t={}){E(this,"protocol",EQ);E(this,"_components");E(this,"_init");this._components=e,this._init=t}createStreamMuxer(e){return new Hve(this._components,{...this._init,...e})}}class Hve{constructor(e,t){E(this,"protocol",EQ);E(this,"source");E(this,"sink");E(this,"config");E(this,"log");E(this,"logger");E(this,"closeController");E(this,"nextStreamID");E(this,"_streams");E(this,"nextPingID");E(this,"activePing");E(this,"rtt");E(this,"client");E(this,"localGoAway");E(this,"remoteGoAway");E(this,"numInboundStreams");E(this,"numOutboundStreams");E(this,"onIncomingStream");E(this,"onStreamEnd");this.client=t.direction==="outbound",this.config={...Mve,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),Rve(this.config),this.closeController=new AbortController,tr(1/0,this.closeController.signal),this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=vc({onEnd:()=>{this.log?.trace("muxer source ended"),this._streams.forEach(i=>{i.destroy()})}}),this.sink=async i=>{const r=()=>{const a=gQ(i);if(a.return!=null){const l=a.return();$ve(l)&&l.catch(c=>{this.log?.("could not cause sink source to return",c)})}};let s,o;try{const a=new Pve(i);try{this.closeController.signal.addEventListener("abort",r);for await(const l of a.emitFrames())await this.handleFrame(l.header,l.readData)}finally{this.closeController.signal.removeEventListener("abort",r)}s=Fu.NormalTermination}catch(a){const l=a.code;Sve.has(l)?(this.log?.error("protocol error in sink",a),s=Fu.ProtocolError):(this.log?.error("internal error in sink",a),s=Fu.InternalError),o=a}this.log?.trace("muxer sink ended"),o!=null?this.abort(o,s):await this.close({reason:s})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log?.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>this.log?.error("keepalive error: %s",i)),this.ping().catch(i=>this.log?.error("ping error: %s",i))}get streams(){return Array.from(this._streams.values())}newStream(e){if(this.remoteGoAway!==void 0)throw new Se("muxer closed remotely",hz);if(this.localGoAway!==void 0)throw new Se("muxer closed locally",zA);const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new Se("max outbound streams exceeded",Tve);this.log?.trace("new outgoing stream id=%s",t);const i=this._newStream(t,e,qc.Init,"outbound");return this._streams.set(t,i),this.numOutboundStreams++,i.sendWindowUpdate(),i}async ping(){if(this.remoteGoAway!==void 0)throw new Se("muxer closed remotely",hz);if(this.localGoAway!==void 0)throw new Se("muxer closed locally",zA);if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((r,s)=>{const o=()=>{s(new Se("muxer closed locally",zA))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),r()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const i=Date.now();this.rtt=i-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.closeController.signal.aborted)return;const t=e?.reason??Fu.NormalTermination;if(this.log?.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(jve);tr(1/0,i),e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){if(!this.closeController.signal.aborted){t=t??Fu.InternalError,this.log?.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,i,r){if(this._streams.get(e)!=null)throw new Se("Stream already exists",vQ,{id:e});const s=new zve({id:e.toString(),name:t,state:i,direction:r,sendFrame:this.sendFrame.bind(this),onEnd:()=>{this.closeStream(e),this.onStreamEnd?.(s)},log:this.logger.forComponent(`libp2p:yamux:${r}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){const e=new Promise((t,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for(this.log?.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let t;try{await Promise.race([e,new Promise(i=>{t=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>this.log?.error("ping error: %s",i))}catch{clearInterval(t);return}}}async handleFrame(e,t){const{streamID:i,type:r,length:s}=e;if(this.log?.trace("received frame %o",e),i===0)switch(r){case Ss.Ping:{this.handlePing(e);return}case Ss.GoAway:{this.handleGoAway(s);return}default:throw new Se("Invalid frame type",e3,{header:e})}else switch(e.type){case Ss.Data:case Ss.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new Se("Invalid frame type",e3,{header:e})}}handlePing(e){if(e.flag===qr.SYN)this.log?.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,qr.ACK);else if(e.flag===qr.ACK)this.log?.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Se("Invalid frame flag",e3,{header:e})}handlePingResponse(e){if(this.activePing===void 0)throw new Se("ping not requested",yQ);if(this.activePing.id!==e)throw new Se("ping doesn't match our id",xQ);this.activePing.resolve()}handleGoAway(e){this.log?.trace("received GoAway reason=%s",Fu[e]??"unknown"),this.remoteGoAway=e;for(const t of this._streams.values())t.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:i,flag:r,type:s}=e;(r&qr.SYN)===qr.SYN&&this.incomingStream(i);const o=this._streams.get(i);if(o===void 0){if(s===Ss.Data){if(this.log?.("discarding data for stream id=%s",i),t===void 0)throw new Error("unreachable");await t()}else this.log?.("frame for missing stream id=%s",i);return}switch(s){case Ss.WindowUpdate:{o.handleWindowUpdate(e);return}case Ss.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){if(this.client!==(e%2===0))throw new Se("both endpoints are clients",_Q);if(this._streams.has(e))return;if(this.log?.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:Ss.WindowUpdate,flag:qr.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){this.log?.("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:Ss.WindowUpdate,flag:qr.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,qc.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),this.onIncomingStream?.(t)}sendFrame(e,t){if(this.log?.trace("sending frame %o",e),e.type===Ss.Data){if(t===void 0)throw new Se("invalid frame",e3);this.source.push(new Zn(fz(e),t))}else this.source.push(fz(e))}sendPing(e,t=qr.SYN){t===qr.SYN?this.log?.trace("sending ping request pingId=%s",e):this.log?.trace("sending ping response pingId=%s",e),this.sendFrame({type:Ss.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Fu.NormalTermination){this.log?.("sending GoAway reason=%s",Fu[e]),this.localGoAway=e,this.sendFrame({type:Ss.GoAway,flag:0,streamID:0,length:e})}}function $ve(n){return n!=null&&typeof n.then=="function"}function Gve(n={}){return e=>new Vve(e,n)}var Di;(function(n){n[n.NEW_STREAM=0]="NEW_STREAM",n[n.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",n[n.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",n[n.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",n[n.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",n[n.RESET_RECEIVER=5]="RESET_RECEIVER",n[n.RESET_INITIATOR=6]="RESET_INITIATOR"})(Di||(Di={}));const CL=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),mz=Object.freeze({NEW_STREAM:Di.NEW_STREAM,MESSAGE:Di.MESSAGE_INITIATOR,CLOSE:Di.CLOSE_INITIATOR,RESET:Di.RESET_INITIATOR}),Wve=Object.freeze({MESSAGE:Di.MESSAGE_RECEIVER,CLOSE:Di.CLOSE_RECEIVER,RESET:Di.RESET_RECEIVER}),TQ=1<<20,Kve=4<<20;class qve{constructor(e=TQ,t=Kve){E(this,"_buffer");E(this,"_headerInfo");E(this,"_maxMessageSize");E(this,"_maxUnprocessedMessageQueueSize");this._buffer=new Zn,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(c){if(c.code==="ERR_MSG_TOO_BIG")throw c;break}const{id:i,type:r,length:s,offset:o}=this._headerInfo;if(this._buffer.length-o<s)break;const l={id:i,type:r};(r===Di.NEW_STREAM||r===Di.MESSAGE_INITIATOR||r===Di.MESSAGE_RECEIVER)&&(l.data=this._buffer.sublist(o,o+s)),t.push(l),this._buffer.consume(o+s),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:i}=yz(e),{value:r,offset:s}=yz(e,i),o=t&7;if(CL[o]==null)throw new Error(`Invalid type received: ${o}`);if(r>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:i+s,length:r}}}const Zve=128,gz=127;function yz(n,e=0){let t=0,i=0,r=e,s;const o=n.length;do{if(r>=o||i>49)throw e=0,new RangeError("Could not decode varint");s=n.get(r++),t+=i<28?(s&gz)<<i:(s&gz)*Math.pow(2,i),i+=7}while(s>=Zve);return e=r-e,{value:t,offset:e}}const VA=10*1024;class Yve{constructor(){E(this,"_pool");E(this,"_poolOffset");this._pool=Cs(VA),this._poolOffset=0}write(e,t){const i=this._pool;let r=this._poolOffset;Za(e.id<<3|e.type,i,r),r+=nr(e.id<<3|e.type),(e.type===Di.NEW_STREAM||e.type===Di.MESSAGE_INITIATOR||e.type===Di.MESSAGE_RECEIVER)&&e.data!=null?(Za(e.data.length,i,r),r+=nr(e.data.length)):(Za(0,i,r),r+=nr(0));const s=i.subarray(this._poolOffset,r);VA-r<100?(this._pool=Cs(VA),this._poolOffset=0):this._poolOffset=r,t.append(s),(e.type===Di.NEW_STREAM||e.type===Di.MESSAGE_INITIATOR||e.type===Di.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}}const Xve=new Yve;async function*Qve(n){for await(const e of n){const t=new Zn;Xve.write(e,t),yield t}}class Jve extends AL{constructor(t){super(t);E(this,"name");E(this,"streamId");E(this,"send");E(this,"types");E(this,"maxDataSize");this.types=t.direction==="outbound"?mz:Wve,this.send=t.send,this.name=t.name,this.streamId=t.streamId,this.maxDataSize=t.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:mz.NEW_STREAM,data:new Zn(Ut(this.name))})}async sendData(t){for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:t.sublist(0,i)}),t.consume(i)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function e3e(n){const{id:e,name:t,send:i,onEnd:r,type:s="initiator",maxMsgSize:o=TQ}=n;return new Jve({id:s==="initiator"?`i${e}`:`r${e}`,streamId:e,name:`${t??e}`,direction:s==="initiator"?"outbound":"inbound",maxDataSize:o,onEnd:r,send:i,log:n.logger.forComponent(`libp2p:mplex:stream:${s}:${e}`)})}const t3e=1024,n3e=1024,i3e=1024*1024*4,r3e=5,s3e=500;function xz(n){const e={...n,type:`${CL[n.type]} (${n.type})`};return n.type===Di.NEW_STREAM&&(e.data=Vt(n.data instanceof Uint8Array?n.data:n.data.subarray())),(n.type===Di.MESSAGE_INITIATOR||n.type===Di.MESSAGE_RECEIVER)&&(e.data=Vt(n.data instanceof Uint8Array?n.data:n.data.subarray(),"base16")),e}class o3e{constructor(e,t){E(this,"protocol","/mplex/6.7.0");E(this,"sink");E(this,"source");E(this,"log");E(this,"_streamId");E(this,"_streams");E(this,"_init");E(this,"_source");E(this,"closeController");E(this,"rateLimiter");E(this,"closeTimeout");E(this,"logger");t=t??{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=t.closeTimeout??s3e,this.sink=this._createSink(),this._source=vc({objectMode:!0,onEnd:()=>{for(const i of this._streams.initiators.values())i.destroy();for(const i of this._streams.receivers.values())i.destroy()}}),this.source=Qa(this._source,i=>Qve(i)),this.closeController=new AbortController,this.rateLimiter=new fX({points:t.disconnectThreshold??r3e,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=e==null?t.toString():e.toString();const i=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:i})}async close(e){if(this.closeController.signal.aborted)return;const t=e?.signal??AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map(async i=>i.close({signal:t}))),this._source.end(),await this._source.onEmpty({signal:t}),this.closeController.abort()}catch(i){this.abort(i)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach(t=>{t.abort(e)}),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:i}=e,r=this._streams.receivers;return this._newStream({id:t,name:i,type:"receiver",registry:r})}_newStream(e){const{id:t,name:i,type:r,registry:s}=e;if(this.log("new %s stream %s",r,t),r==="initiator"&&this._streams.initiators.size===(this._init.maxOutboundStreams??n3e))throw new Se("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(s.has(t))throw new Error(`${r} stream ${t} already exists!`);const l=e3e({id:t,name:i,send:async c=>{this.log.enabled&&this.log.trace("%s stream %s send",r,t,xz(c)),this._source.push(c)},type:r,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",r,t,l.protocol),s.delete(t),this._init.onStreamEnd!=null&&this._init.onStreamEnd(l)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return s.set(t,l),l}_createSink(){return async t=>{const i=()=>{SQ(t,this.log)};this.closeController.signal.addEventListener("abort",i);try{const r=new qve(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const s of t)for(const o of r.write(s))await this._handleIncoming(o);this._source.end()}catch(r){this.log("error in sink",r),this._source.end(r)}finally{this.closeController.signal.removeEventListener("abort",i)}}}async _handleIncoming(e){const{id:t,type:i}=e;if(this.log.enabled&&this.log.trace("incoming message",xz(e)),e.type===Di.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??t3e)){this.log("too many inbound streams open"),this._source.push({id:t,type:Di.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}return}const a=this._newReceiverStream({id:t,name:Vt(e.data instanceof Uint8Array?e.data:e.data.subarray())});this._init.onIncomingStream!=null&&this._init.onIncomingStream(a);return}const s=((i&1)===1?this._streams.initiators:this._streams.receivers).get(t);if(s==null){this.log("missing stream %s for message type %s",t,CL[i]);try{await this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}const o=this._init.maxStreamBufferSize??i3e;try{switch(i){case Di.MESSAGE_INITIATOR:case Di.MESSAGE_RECEIVER:if(s.sourceReadableLength()>o)throw this._source.push({id:e.id,type:i===Di.MESSAGE_INITIATOR?Di.RESET_RECEIVER:Di.RESET_INITIATOR}),new Se("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");s.sourcePush(e.data);break;case Di.CLOSE_INITIATOR:case Di.CLOSE_RECEIVER:s.remoteCloseWrite();break;case Di.RESET_INITIATOR:case Di.RESET_RECEIVER:s.reset();break;default:this.log("unknown message type %s",i)}}catch(a){this.log.error("error while processing message",a),s.abort(a)}}}var uFe,hFe;class a3e{constructor(e,t={}){E(this,"protocol","/mplex/6.7.0");E(this,"_init");E(this,"components");E(this,uFe,"@libp2p/mplex");E(this,hFe,["@libp2p/stream-multiplexing"]);this.components=e,this._init=t}createStreamMuxer(e={}){return new o3e(this.components,{...e,...this._init})}}uFe=Symbol.toStringTag,hFe=kd;function l3e(n={}){return e=>new a3e(e,n)}const c3e=[vl("tcp").code,vl("dns").code,vl("dnsaddr").code,vl("dns4").code,vl("dns6").code];function vz(n){return AQ("sni",n)?.[1]}function bz(n){const e=AQ("tcp",n)?.[1];return e==null?"":`:${e}`}function AQ(n,e){let t;try{t=vl(n).code}catch{return}for(const[i,r]of e)if(i===t&&r!=null)return[i,r]}function _z(n){return n.some(([e,t])=>e===vl("tls").code)}function Ea(n,e,t){const i=CQ[vl(n).name];if(i==null)throw new Error(`Can't interpret protocol ${vl(n).name}`);const r=i(e,t);return n===vl("ip6").code?`[${r}]`:r}const CQ={ip4:(n,e)=>n,ip6:(n,e)=>e.length===0?n:`[${n}]`,tcp:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${Ea(t[0],t[1]??"",e)}:${n}`},udp:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${Ea(t[0],t[1]??"",e)}:${n}`},dnsaddr:(n,e)=>n,dns4:(n,e)=>n,dns6:(n,e)=>n,dns:(n,e)=>n,ipfs:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ea(t[0],t[1]??"",e)}/ipfs/${n}`},p2p:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ea(t[0],t[1]??"",e)}/p2p/${n}`},http:(n,e)=>{const t=_z(e),i=vz(e),r=bz(e);if(t&&i!=null)return`https://${i}${r}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Ea(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const i=Ea(t[0],t[1]??"",e),r=decodeURIComponent(n);return`${i}/${r}`},tls:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Ea(t[0],t[1]??"",e)},sni:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return Ea(t[0],t[1]??"",e)},https:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let i=Ea(t[0],t[1]??"",e);return i=i.replace("tcp://",""),`https://${i}`},ws:(n,e)=>{const t=_z(e),i=vz(e),r=bz(e);if(t&&i!=null)return`wss://${i}${r}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=Ea(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let i=Ea(t[0],t[1]??"",e);return i=i.replace("tcp://",""),`wss://${i}`},"p2p-websocket-star":(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ea(t[0],t[1]??"",e)}/p2p-websocket-star`},"p2p-webrtc-star":(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ea(t[0],t[1]??"",e)}/p2p-webrtc-star`},"p2p-webrtc-direct":(n,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${Ea(t[0],t[1]??"",e)}/p2p-webrtc-direct`}};function u3e(n,e){const i=zi(n).stringTuples(),r=i.pop();if(r==null)throw new Error("Unexpected end of multiaddr");const s=vl(r[0]),o=CQ[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(r[1]??"",i);return e?.assumeHttp!==!1&&c3e.includes(r[0])&&(a=a.replace(/^.*:\/\//,""),r[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}const h3e=async n=>{if(n.readyState>=2)throw new Error("socket closed");n.readyState!==1&&await new Promise((e,t)=>{function i(){n.removeEventListener("open",r),n.removeEventListener("error",s)}function r(){i(),e()}function s(o){i(),t(o.error??new Error(`connect ECONNREFUSED ${n.url}`))}n.addEventListener("open",r),n.addEventListener("error",s)})},d3e=(n,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async i=>{for await(const r of i){try{await h3e(n)}catch(s){if(s.message==="socket closed")break;throw s}if(n.readyState===n.CLOSING||n.readyState===n.CLOSED)break;n.send(r)}e.closeOnEnd!=null&&n.readyState<=1&&await new Promise((r,s)=>{n.addEventListener("close",o=>{if(o.wasClean||o.code===1006)r();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{n.close()})})});var H7={},$7={};Object.defineProperty($7,"__esModule",{value:!0});class f3e{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const i=this.pullQueue.shift();i&&i.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch(()=>{}),this.pushQueue.push(t)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((i,r)=>{this.pullQueue.push({resolve:i,reject:r})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}let MQ=class{constructor(e,{highWaterMark:t=100,lowWaterMark:i=1}={}){const r=new f3e;r.highWaterMark=t,r.lowWaterMark=i,r.removeCallback=e({push:s=>r.push(s),stop:()=>r.stop(),fail:s=>r.fail(s),on:(s,o)=>{r.eventHandlers[s]=o}})||(()=>{}),this[Symbol.asyncIterator]=()=>r[Symbol.asyncIterator](),Object.freeze(this)}};$7.EventIterator=MQ;$7.default=MQ;Object.defineProperty(H7,"__esModule",{value:!0});const ML=$7;var p3e=H7.EventIterator=ML.EventIterator;function m3e(n,e,t){return new ML.EventIterator(({push:i})=>(this.addEventListener(n,i,e),()=>this.removeEventListener(n,i,e)),t)}H7.subscribe=m3e;H7.default=ML.EventIterator;function wz(n){return n instanceof ArrayBuffer||n?.constructor?.name==="ArrayBuffer"&&typeof n?.byteLength=="number"}const g3e=n=>{n.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(i){s();return}if(r!=null){o(r);return}const a=u=>{n.removeEventListener("open",l),n.removeEventListener("error",c),u()},l=()=>{a(s)},c=u=>{a(()=>{o(u.error??new Error(`connect ECONNREFUSED ${n.url}`))})};n.addEventListener("open",l),n.addEventListener("error",c)})},t=async function*(){const s=new p3e(({push:o,stop:a,fail:l})=>{const c=h=>{let p=null;typeof h.data=="string"&&(p=Ut(h.data)),wz(h.data)&&(p=new Uint8Array(h.data)),h.data instanceof Uint8Array&&(p=h.data),p!=null&&o(p)},u=h=>{l(h.error??new Error("Socket error"))};return n.addEventListener("message",c),n.addEventListener("error",u),n.addEventListener("close",a),()=>{n.removeEventListener("message",c),n.removeEventListener("error",u),n.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield wz(o)?new Uint8Array(o):o}();let i=n.readyState===1,r;return n.addEventListener("open",()=>{i=!0,r=null}),n.addEventListener("close",()=>{i=!1,r=null}),n.addEventListener("error",s=>{i||(r=s.error??new Error(`connect ECONNREFUSED ${n.url}`))}),Object.assign(t,{connected:e})},y3e=(n,e)=>{e=e??{};const t=g3e(n);let i=e.remoteAddress,r=e.remotePort;if(n.url!=null)try{const o=new URL(n.url);i=o.hostname,r=parseInt(o.port,10)}catch{}if(i==null||r==null)throw new Error("Remote connection did not have address and/or port");return{sink:d3e(n,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(n.readyState===n.CONNECTING||n.readyState===n.OPEN)&&await new Promise(o=>{n.addEventListener("close",()=>{o()}),n.close()})},destroy:()=>{n.terminate!=null?n.terminate():n.close()},remoteAddress:i,remotePort:r,socket:n}},x3e=WebSocket,v3e={"http:":"ws:","https:":"wss:"},Sz="ws:",b3e=(n,e)=>{if(n.startsWith("//")&&(n=`${e?.protocol??Sz}${n}`),n.startsWith("/")&&e!=null){const i=e.protocol??Sz,r=e.host,s=e.port!=null&&r?.endsWith(`:${e.port}`)!==!0?`:${e.port}`:"";n=`${i}//${r}${s}${n}`}const t=new URL(n);for(const[i,r]of Object.entries(v3e))t.protocol===i&&(t.protocol=r);return t};function _3e(n,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const i=b3e(n,t),r=new x3e(i.toString(),e.websocket);return y3e(r,e)}function w3e(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var S3e=w3e;const E3e=wc(S3e),RL=typeof window=="object"&&typeof document=="object"&&document.nodeType===9,G7=E3e(),RQ=RL&&!G7,T3e=G7&&!RL,A3e=G7&&RL,C3e=typeof globalThis.process<"u"&&typeof globalThis.process.release<"u"&&globalThis.process.release.name==="node"&&!G7,IQ=typeof importScripts=="function"&&typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope;typeof globalThis.process<"u"&&typeof globalThis.process.env<"u"&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"];const M3e=typeof navigator<"u"&&navigator.product==="ReactNative",R3e=An("dns4"),I3e=An("dns6"),N3e=An("dnsaddr"),Ym=$s(An("dns"),N3e,R3e,I3e),W7=$s(An("ip4"),An("ip6")),D2=$s(Qn(W7,An("tcp")),Qn(Ym,An("tcp"))),K7=Qn(W7,An("udp")),P3e=Qn(K7,An("utp")),k3e=Qn(K7,An("quic")),L3e=Qn(K7,An("quic-v1")),LI=$s(Qn(D2,An("ws")),Qn(Ym,An("ws"))),DI=$s(Qn(LI,An("p2p")),LI),OI=$s(Qn(D2,An("wss")),Qn(Ym,An("wss")),Qn(D2,An("tls"),An("ws")),Qn(Ym,An("tls"),An("ws"))),t8=$s(Qn(OI,An("p2p")),OI),BI=$s(Qn(D2,An("http")),Qn(W7,An("http")),Qn(Ym,An("http"))),UI=$s(Qn(D2,An("https")),Qn(W7,An("https")),Qn(Ym,An("https"))),Ez=Qn(K7,An("webrtc-direct"),An("certhash")),NQ=$s(Qn(Ez,An("p2p")),Ez),Tz=Qn(L3e,An("webtransport"),An("certhash"),An("certhash")),PQ=$s(Qn(Tz,An("p2p")),Tz),kQ=$s(Qn(DI,An("p2p-webrtc-star"),An("p2p")),Qn(t8,An("p2p-webrtc-star"),An("p2p")),Qn(DI,An("p2p-webrtc-star")),Qn(t8,An("p2p-webrtc-star"))),LQ=$s(Qn(BI,An("p2p-webrtc-direct"),An("p2p")),Qn(UI,An("p2p-webrtc-direct"),An("p2p")),Qn(BI,An("p2p-webrtc-direct")),Qn(UI,An("p2p-webrtc-direct"))),FI=$s(LI,OI,BI,UI,kQ,LQ,D2,P3e,k3e,Ym,NQ,PQ),e0=$s(Qn(FI,An("p2p")),kQ,LQ,NQ,PQ,An("p2p")),Az=$s(Qn(e0,An("p2p-circuit"),e0),Qn(e0,An("p2p-circuit")),Qn(An("p2p-circuit"),e0),Qn(FI,An("p2p-circuit")),Qn(An("p2p-circuit"),FI),An("p2p-circuit")),DQ=()=>$s(Qn(Az,DQ),Az),Ug=DQ(),D3e=$s(Qn(Ug,e0,Ug),Qn(e0,Ug),Qn(Ug,e0),Ug,e0);function OQ(n){function e(t){let i;try{i=zi(t)}catch{return!1}const r=n(i.protoNames());return r===null?!1:r===!0||r===!1?r:r.length===0}return e}function Qn(...n){function e(t){if(t.length<n.length)return null;let i=t;return n.some(r=>(i=typeof r=="function"?r().partialMatch(t):r.partialMatch(t),Array.isArray(i)&&(t=i),i===null)),i}return{toString:function(){return"{ "+n.join(" ")+" }"},input:n,matches:OQ(e),partialMatch:e}}function $s(...n){function e(i){let r=null;return n.some(s=>{const o=typeof s=="function"?s().partialMatch(i):s.partialMatch(i);return o!=null?(r=o,!0):!1}),r}return{toString:function(){return"{ "+n.join(" ")+" }"},input:n,matches:OQ(e),partialMatch:e}}function An(n){const e=n;function t(r){let s;try{s=zi(r)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function i(r){return r.length===0?null:r[0]===e?r.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:i}}const BQ=421,UQ=290,O3e=500;function FQ(n){return n.filter(e=>{if(e.protoCodes().includes(UQ))return!1;const t=e.decapsulateCode(BQ);return DI.matches(t)||t8.matches(t)})}function B3e(n){return n.filter(e=>{if(e.protoCodes().includes(UQ))return!1;const t=e.decapsulateCode(BQ);return t8.matches(t)})}function U3e(){throw new Error("WebSocket Servers can not be created in the browser!")}function F3e(n,e,t){const i=t.logger.forComponent("libp2p:websockets:maconn"),r=t.metrics,s=t.metricPrefix??"",o={log:i,async sink(a){try{await n.sink(async function*(){for await(const l of a)l instanceof Uint8Array?yield l:yield l.subarray()}())}catch(l){l.type!=="aborted"&&i.error(l)}},source:n.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){const l=Date.now();if(a.signal==null){const u=AbortSignal.timeout(O3e);a={...a,signal:u}}const c=()=>{const{host:u,port:h}=o.remoteAddr.toOptions();i("timeout closing stream to %s:%s after %dms, destroying it manually",u,h,Date.now()-l),this.abort(new Se("Socket close timeout","ERR_SOCKET_CLOSE_TIMEOUT"))};a.signal?.addEventListener("abort",c);try{await n.close()}catch(u){i.error("error closing WebSocket gracefully",u),this.abort(u)}finally{a.signal?.removeEventListener("abort",c),o.timeline.close=Date.now()}},abort(a){const{host:l,port:c}=o.remoteAddr.toOptions();i("timeout closing stream to %s:%s due to error",l,c,a),n.destroy(),o.timeline.close=Date.now(),r?.increment({[`${s}error`]:!0})}};return n.socket.addEventListener("close",()=>{r?.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var dFe,fFe,pFe;class z3e{constructor(e,t){E(this,"log");E(this,"init");E(this,"logger");E(this,"metrics");E(this,"components");E(this,dFe,!0);E(this,fFe,"@libp2p/websockets");E(this,pFe,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){this.log("dialing %s",e),t=t??{};const i=await this._connect(e,t),r=F3e(i,e,{logger:this.logger,metrics:this.metrics?.dialerEvents});this.log("new outbound connection %s",r.remoteAddr);const s=await t.upgrader.upgradeOutbound(r,t);return this.log("outbound connection %s upgraded",r.remoteAddr),s}async _connect(e,t){t?.signal?.throwIfAborted();const i=e.toOptions();this.log("dialing %s:%s",i.host,i.port);const r=Ki(),s=_3e(u3e(e),this.init);s.socket.addEventListener("error",()=>{const o=new Se(`Could not connect to ${e.toString()}`,"ERR_CONNECTION_FAILED");this.log.error("connection error:",o),this.metrics?.dialerEvents.increment({error:!0}),r.reject(o)});try{t.onProgress?.(new er("websockets:open-connection")),await eu(Promise.race([s.connected(),r.promise]),t.signal)}catch(o){throw t.signal?.aborted===!0&&this.metrics?.dialerEvents.increment({abort:!0}),s.close().catch(a=>{this.log.error("error closing raw socket",a)}),o}return this.log("connected %s",e),this.metrics?.dialerEvents.increment({connect:!0}),s}createListener(e){return U3e({logger:this.logger,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){return e=Array.isArray(e)?e:[e],this.init?.filter!=null?this.init?.filter(e):RQ||IQ?B3e(e):FQ(e)}dialFilter(e){return this.listenFilter(e)}}dFe=JK,fFe=Symbol.toStringTag,pFe=kd;function j3e(n={}){return e=>new z3e(e,n)}const V3e=n=>n.toString().split("/").slice(1),P_=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),pi=n=>({match:e=>P_(t=>t===n).match(e),pattern:n}),b1=()=>({match:n=>P_(e=>typeof e=="string").match(n),pattern:"{string}"}),vb=()=>({match:n=>P_(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),sr=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{Lr.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),n8=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{V0.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),Hi=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),Ho=(...n)=>({match:e=>{let t;for(const i of n){const r=i.match(e);r!==!1&&(t==null||r.length<t.length)&&(t=r)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),_i=(...n)=>({match:e=>{for(const t of n){const i=t.match(e);if(i===!1)return!1;e=i}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function _1(...n){function e(r){let s=V3e(r);for(const o of n){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(r){return e(r)!==!1}function i(r){const s=e(r);return s===!1?!1:s.length===0}return{matchers:n,matches:t,exactMatch:i}}const q7=_i(pi("dns4"),b1()),Z7=_i(pi("dns6"),b1()),Y7=_i(pi("dnsaddr"),b1()),IL=_i(pi("dns"),b1());_1(q7,Hi(sr()));_1(Z7,Hi(sr()));_1(Y7,Hi(sr()));_1(Ho(IL,Y7,q7,Z7),Hi(sr()));const H3e=_i(pi("ip4"),P_(pu)),$3e=_i(pi("ip6"),P_(G0)),zQ=Ho(H3e,$3e),Sd=Ho(zQ,IL,q7,Z7,Y7);_1(Ho(zQ,_i(Ho(IL,Y7,q7,Z7),Hi(sr()))));const NL=_i(Sd,pi("tcp"),vb()),X7=_i(Sd,pi("udp"),vb());_1(_i(NL,Hi(sr())));const jQ=_i(X7,pi("quic"),Hi(sr())),PL=_i(X7,pi("quic-v1"),Hi(sr())),G3e=Ho(jQ,PL),zI=Ho(Sd,NL,X7,jQ,PL),W3e=Ho(_i(zI,pi("ws"),Hi(sr()))),K3e=Ho(_i(zI,pi("wss"),Hi(sr())),_i(zI,pi("tls"),Hi(_i(pi("sni"),b1())),pi("ws"),Hi(sr()))),q3e=_i(X7,pi("webrtc-direct"),Hi(n8()),Hi(n8()),Hi(sr())),Z3e=_i(PL,pi("webtransport"),Hi(n8()),Hi(n8()),Hi(sr())),jI=Ho(W3e,K3e,_i(NL,Hi(sr())),_i(G3e,Hi(sr())),_i(Sd,Hi(sr())),q3e,Z3e,sr());_i(jI,pi("p2p-circuit"),sr());const Y3e=Ho(_i(jI,pi("p2p-circuit"),pi("webrtc"),Hi(sr())),_i(jI,pi("webrtc"),Hi(sr())),_i(pi("webrtc"),Hi(sr()))),X3e=_1(Y3e);Ho(_i(Sd,pi("tcp"),vb(),pi("http"),Hi(sr())),_i(Sd,pi("http"),Hi(sr())));Ho(_i(Sd,pi("tcp"),Ho(_i(pi("443"),pi("http")),_i(vb(),pi("https")),_i(vb(),pi("tls"),pi("http"))),Hi(sr())),_i(Sd,pi("tls"),pi("http"),Hi(sr())),_i(Sd,pi("https"),Hi(sr())));Ho(_i(pi("memory"),b1(),Hi(sr())));Ho(_i(pi("unix"),b1(),Hi(sr())));var sy;(function(n){n.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",n.ERR_DATA_CHANNEL="ERR_DATA_CHANNEL",n.ERR_CONNECTION_CLOSED="ERR_CONNECTION_CLOSED",n.ERR_HASH_NOT_SUPPORTED="ERR_HASH_NOT_SUPPORTED",n.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",n.ERR_INVALID_FINGERPRINT="ERR_INVALID_FINGERPRINT",n.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",n.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",n.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",n.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"})(sy||(sy={}));var Cz=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var i=0,r=e.length,s;i<r;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return n.concat(s||Array.prototype.slice.call(e))},Q3e=function(){function n(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return n}(),J3e=function(){function n(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return n}(),ebe=function(){function n(e,t,i,r){this.name=e,this.version=t,this.os=i,this.bot=r,this.type="bot-device"}return n}(),tbe=function(){function n(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return n}(),nbe=function(){function n(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return n}(),ibe=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,rbe=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Mz=3,sbe=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ibe]],Rz=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function obe(n){return n?Iz(n):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new nbe:typeof navigator<"u"?Iz(navigator.userAgent):cbe()}function abe(n){return n!==""&&sbe.reduce(function(e,t){var i=t[0],r=t[1];if(e)return e;var s=r.exec(n);return!!s&&[i,s]},!1)}function Iz(n){var e=abe(n);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new tbe;var r=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);r?r.length<Mz&&(r=Cz(Cz([],r,!0),ube(Mz-r.length),!0)):r=[];var s=r.join("."),o=lbe(n),a=rbe.exec(n);return a&&a[1]?new ebe(t,s,o,a[1]):new Q3e(t,s,o)}function lbe(n){for(var e=0,t=Rz.length;e<t;e++){var i=Rz[e],r=i[0],s=i[1],o=s.exec(n);if(o)return r}return null}function cbe(){var n=typeof process<"u"&&process.version;return n?new J3e(process.version.slice(1)):null}function ube(n){for(var e=[],t=0;t<n;t++)e.push("0");return e}class kL extends Error{constructor(e){super(e),this.name="TimeoutError"}}let hbe=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const Nz=n=>globalThis.DOMException===void 0?new hbe(n):new DOMException(n),Pz=n=>{const e=n.reason===void 0?Nz("This operation was aborted."):n.reason;return e instanceof Error?e:Nz(e)};function k_(n,e){const{milliseconds:t,fallback:i,message:r,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const c=new Promise((u,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:m}=e;m.aborted&&h(Pz(m)),a=()=>{h(Pz(m))},m.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){n.then(u,h);return}const p=new kL;o=s.setTimeout.call(void 0,()=>{if(i){try{u(i())}catch(m){h(m)}return}typeof n.cancel=="function"&&n.cancel(),r===!1?u():r instanceof Error?h(r):(p.message=r??`Promise timed out after ${t} milliseconds`,h(p))},t),(async()=>{try{u(await n)}catch(m){h(m)}})()}).finally(()=>{c.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return c.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},c}const dbe=["stun:stun.l.google.com:19302","stun:globalThis.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],kz=obe(),VQ=kz!=null&&kz.name==="firefox",HQ=async function*(){},$Q=async n=>{},fbe=30*1e3;function pbe(n,e,t=fbe,i){n.readyState==="open"&&Promise.resolve().then(async()=>{if(n.bufferedAmount>0){i.log("%s drain channel with %d buffered bytes",e,n.bufferedAmount);const r=Ki();let s=!1;n.bufferedAmountLowThreshold=0;const o=()=>{s||(i.log("%s drain channel closed before drain",e),r.resolve())};n.addEventListener("close",o,{once:!0}),n.addEventListener("bufferedamountlow",()=>{s=!0,n.removeEventListener("close",o),r.resolve()}),await k_(r.promise,{milliseconds:t})}}).then(async()=>{n.readyState==="open"&&n.close()}).catch(r=>{i.log.error("error closing outbound stream",r)})}async function Lz(n){return n=n??{},typeof n=="function"&&(n=await n()),n.iceServers=n.iceServers??dbe.map(e=>({urls:[e]})),n}class Dz{constructor(e,t){E(this,"log");E(this,"peerConnection");E(this,"remoteAddr");E(this,"timeline");E(this,"metrics");E(this,"source",HQ());E(this,"sink",$Q);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const i=this.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",this.peerConnection.connectionState,"initial state",i),(this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({close:!0})}abort(e){this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),this.metrics?.increment({abort:!0})}}const mbe=n=>{const e=n.addEventListener||n.on||n.addListener,t=n.removeEventListener||n.off||n.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(n),removeListener:t.bind(n)}};function gbe(n,e,t){let i;const r=new Promise((s,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();const a=[e].flat(),l=[],{addListener:c,removeListener:u}=mbe(n),h=(...m)=>{const y=t.multiArgs?m:m[0];t.filter&&!t.filter(y)||(l.push(y),t.count===l.length&&(i(),s(l)))},p=m=>{i(),o(m)};i=()=>{for(const m of a)u(m,h);for(const m of t.rejectionEvents)u(m,p)};for(const m of a)c(m,h);for(const m of t.rejectionEvents)c(m,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(l)});if(r.cancel=i,typeof t.timeout=="number"){const s=k_(r,{milliseconds:t.timeout});return s.cancel=i,s}return r}function VI(n,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const i=gbe(n,e,t),r=i.then(s=>s[0]);return r.cancel=i.cancel,r}var Ma;(function(n){(function(i){i.FIN="FIN",i.STOP_SENDING="STOP_SENDING",i.RESET="RESET",i.FIN_ACK="FIN_ACK"})(n.Flag||(n.Flag={}));let e;(function(i){i[i.FIN=0]="FIN",i[i.STOP_SENDING=1]="STOP_SENDING",i[i.RESET=2]="RESET",i[i.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(i){i.codec=()=>u1(e)}(n.Flag||(n.Flag={}));let t;n.codec=()=>(t==null&&(t=Ai((i,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),i.flag!=null&&(r.uint32(8),n.Flag.codec().encode(i.flag,r)),i.message!=null&&(r.uint32(18),r.bytes(i.message)),s.lengthDelimited!==!1&&r.ldelim()},(i,r)=>{const s={},o=r==null?i.len:i.pos+r;for(;i.pos<o;){const a=i.uint32();switch(a>>>3){case 1:s.flag=n.Flag.codec().decode(i);break;case 2:s.message=i.bytes();break;default:i.skipType(a&7);break}}return s})),t),n.encode=i=>Ti(i,n.codec()),n.decode=i=>Ei(i,n.codec())})(Ma||(Ma={}));const ybe=2*1024*1024,xbe=30*1e3,GQ=16*1024;function vbe(n=GQ){const e=nr(n-nr(n)),t=1+nr(Object.keys(Ma.Flag).length-1),i=1,r=n-e-t-i,s=nr(r);return e+t+i+s}const bbe=vbe(),_be=5e3,wbe=5e3;class Sbe extends AL{constructor(t){const i=t.onEnd;t.onEnd=s=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await k_(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),i?.(s)}).catch(o=>{this.log.error("error ending stream",o)})};super(t);E(this,"channel");E(this,"incomingData");E(this,"maxBufferedAmount");E(this,"bufferedAmountLowEventTimeout");E(this,"maxMessageSize");E(this,"receiveFinAck");E(this,"finAckTimeout");E(this,"openTimeout");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=vc(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??xbe,this.maxBufferedAmount=t.maxBufferedAmount??ybe,this.maxMessageSize=(t.maxMessageSize??GQ)-bbe,this.receiveFinAck=Ki(),this.finAckTimeout=t.closeTimeout??_be,this.openTimeout=t.openTimeout??wbe,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new Se("Unknown datachannel state","ERR_INVALID_STATE")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const r=this;Promise.resolve().then(async()=>{for await(const s of I2(this.incomingData)){const o=r.processIncomingProtobuf(s);o!=null&&r.sourcePush(new Zn(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,i=!0){if(i&&this.channel.bufferedAmount>this.maxBufferedAmount)try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await VI(this.channel,"bufferedamountlow",{timeout:this.bufferedAmountLowEventTimeout})}catch(r){throw r instanceof kL?new Se(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`,"ERR_BUFFER_CLEAR_TIMEOUT"):r}if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new Se(`Invalid datachannel state - ${this.channel.readyState}`,"ERR_INVALID_STATE");this.channel.readyState!=="open"&&(this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await VI(this.channel,"open",{timeout:this.openTimeout}),this.log('channel state is now "%s", sending data',this.channel.readyState)),this.channel.send(t.subarray())}async sendData(t){for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),r=t.subarray(0,i),s=Ma.encode({message:r}),o=Zm.single(s);await this._sendMessage(o),t.consume(i)}}async sendReset(){await this._sendFlag(Ma.Flag.RESET)}async sendCloseWrite(t){if(await this._sendFlag(Ma.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await eu(this.receiveFinAck.promise,t?.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorCode:"ERR_FIN_ACK_NOT_RECEIVED"})}catch(r){this.log.error("failed to await FIN_ACK",r)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){await this._sendFlag(Ma.Flag.STOP_SENDING)}processIncomingProtobuf(t){const i=Ma.decode(t);if(i.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',i.flag,this.writeStatus,this.readStatus),i.flag===Ma.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(Ma.Flag.FIN_ACK).catch(r=>{this.log.error("error sending FIN_ACK immediately",r)})),i.flag===Ma.Flag.RESET&&this.reset(),i.flag===Ma.Flag.STOP_SENDING&&this.remoteCloseRead(),i.flag===Ma.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return i.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,t.toString()),!1;this.log.trace("sending flag %s",t.toString());const i=Ma.encode({flag:t}),r=Zm.single(i);try{return await this._sendMessage(r,!1),!0}catch(s){this.log.error("could not send flag %s",t.toString(),s)}return!1}}function HI(n){const{channel:e,direction:t}=n;return new Sbe({id:t==="inbound"?`i${e.id}`:`r${e.id}`,log:n.logger.forComponent(`libp2p:webrtc:stream:${t}:${e.id}`),...n})}const WQ="/webrtc";class KQ{constructor(e,t){E(this,"protocol");E(this,"peerConnection");E(this,"bufferedStreams",[]);E(this,"metrics");E(this,"dataChannelOptions");E(this,"components");E(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??WQ,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:datachannelmuxerfactory"),this.peerConnection.ondatachannel=({channel:i})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',i.id),i.label==="init"){this.log.trace("closing early init channel"),i.close();return}const r={},s=HI({channel:i,direction:"inbound",onEnd:o=>{r.onEnd(o)},logger:e.logger,...this.dataChannelOptions});r.stream=s,r.channel=i,r.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(r)}}createStreamMuxer(e){return new Ebe(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var Zy,TS;class Ebe{constructor(e,t){$t(this,Zy);E(this,"init");E(this,"streams");E(this,"protocol");E(this,"log");E(this,"peerConnection");E(this,"dataChannelOptions");E(this,"metrics");E(this,"logger");E(this,"source",HQ());E(this,"sink",$Q);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(i=>i.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??WQ,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:i})=>{if(this.log.trace("incoming datachannel with channel id %d",i.id),i.label==="init"){this.log.trace("closing init channel"),i.close();return}const r=HI({channel:i,direction:"inbound",onEnd:()=>{this.log("incoming channel %s ended with state %s",i.id,i.readyState),rn(this,Zy,TS).call(this,r,i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(r),this.metrics?.increment({incoming_stream:!0}),t?.onIncomingStream?.(r)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(i=>{i.onEnd=()=>{this.log("incoming early channel %s ended with state %s",i.channel.id,i.channel.readyState),rn(this,Zy,TS).call(this,i.stream,i.channel)},this.metrics?.increment({incoming_stream:!0}),this.init?.onIncomingStream?.(i.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){const e=this.peerConnection.createDataChannel("");this.log.trace("opened outgoing datachannel with channel id %s",e.id);const t=HI({channel:e,direction:"outbound",onEnd:()=>{this.log("outgoing channel %s ended with state %s",e.id,e.readyState),rn(this,Zy,TS).call(this,t,e)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(t),this.metrics?.increment({outgoing_stream:!0}),t}}Zy=new WeakSet,TS=function(e,t){this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),pbe(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(i=>i.id!==e.id),this.metrics?.increment({stream_end:!0}),this.init?.onStreamEnd?.(e)};const qQ=globalThis.RTCPeerConnection,ZQ=globalThis.RTCSessionDescription,Tbe=globalThis.RTCIceCandidate;function Ld(n,e){const t=R2(n,e),i={read:async(r,s)=>{const o=await t.read(s);return r.decode(o)},write:async(r,s,o)=>{await t.write(s.encode(r),o)},writeV:async(r,s,o)=>{await t.writeV(r.map(a=>s.encode(a)),o)},pb:r=>({read:async s=>i.read(r,s),write:async(s,o)=>i.write(s,r,o),writeV:async(s,o)=>i.writeV(s,r,o),unwrap:()=>i}),unwrap:()=>t.unwrap()};return i}var nu;(function(n){(function(i){i.SDP_OFFER="SDP_OFFER",i.SDP_ANSWER="SDP_ANSWER",i.ICE_CANDIDATE="ICE_CANDIDATE"})(n.Type||(n.Type={}));let e;(function(i){i[i.SDP_OFFER=0]="SDP_OFFER",i[i.SDP_ANSWER=1]="SDP_ANSWER",i[i.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),function(i){i.codec=()=>u1(e)}(n.Type||(n.Type={}));let t;n.codec=()=>(t==null&&(t=Ai((i,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),i.type!=null&&(r.uint32(8),n.Type.codec().encode(i.type,r)),i.data!=null&&(r.uint32(18),r.string(i.data)),s.lengthDelimited!==!1&&r.ldelim()},(i,r)=>{const s={},o=r==null?i.len:i.pos+r;for(;i.pos<o;){const a=i.uint32();switch(a>>>3){case 1:s.type=n.Type.codec().decode(i);break;case 2:s.data=i.string();break;default:i.skipType(a&7);break}}return s})),t),n.encode=i=>Ti(i,n.codec()),n.decode=i=>Ei(i,n.codec())})(nu||(nu={}));const YQ=async(n,e,t)=>{try{const i=Ki();for(Cbe(n,i);;){const r=await Promise.race([i.promise,e.read({signal:t.signal}).catch(()=>{})]);if(r==null){t.signal?.throwIfAborted();break}if(r.type!==nu.Type.ICE_CANDIDATE)throw new Se("ICE candidate message expected","ERR_NOT_ICE_CANDIDATE");const s=JSON.parse(r.data??"null");if(s===""||s===null){t.onProgress?.(new er("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const o=new Tbe(s);t.log.trace("%s received new ICE candidate %o",t.direction,s);try{t.onProgress?.(new er("webrtc:add-ice-candidate",o.candidate)),await n.addIceCandidate(o)}catch(a){t.log.error("%s bad candidate received",t.direction,s,a)}}}catch(i){if(t.log.error("%s error parsing ICE candidate",t.direction,i),t.signal?.aborted===!0)throw i}};function Abe(n){return VQ?n.iceConnectionState:n.connectionState}function Cbe(n,e){n[VQ?"oniceconnectionstatechange":"onconnectionstatechange"]=t=>{switch(Abe(n)){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new Se("RTCPeerConnection was closed","ERR_CONNECTION_CLOSED_BEFORE_CONNECTED"));break}}}async function Mbe({rtcConfiguration:n,dataChannel:e,signal:t,metrics:i,multiaddr:r,connectionManager:s,transportManager:o,log:a,logger:l,onProgress:c}){const{baseAddr:u}=Dbe(r);i?.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",u);const h=u.getPeerId();if(h==null)throw new Se("Relay peer was missing","ERR_INVALID_ADDRESS");const p=s.getConnections(Bi(h));let m,y=!1;p.length===0?(c?.(new er("webrtc:dial-relay")),m=await o.dial(u,{signal:t,onProgress:c}),y=!0):(c?.(new er("webrtc:reuse-relay-connection")),m=p[0]);try{c?.(new er("webrtc:open-signaling-stream"));const b=await m.newStream($I,{signal:t,runOnTransientConnection:!0}),w=Ld(b).pb(nu),v=new qQ(n),T=new KQ({logger:l},{peerConnection:v,dataChannelOptions:e});try{const S=v.createDataChannel("init");v.onicecandidate=({candidate:O})=>{const B=JSON.stringify(O?.toJSON()??null);a.trace("initiator sending ICE candidate %o",O),w.write({type:nu.Type.ICE_CANDIDATE,data:B},{signal:t}).catch(N=>{a.error("error sending ICE candidate",N)})},v.onicecandidateerror=O=>{a.error("initiator ICE candidate error",O)};const M=await v.createOffer().catch(O=>{throw a.error("could not execute createOffer",O),new Se("Failed to set createOffer","ERR_SDP_HANDSHAKE_FAILED")});a.trace("initiator send SDP offer %s",M.sdp),c?.(new er("webrtc:send-sdp-offer")),await w.write({type:nu.Type.SDP_OFFER,data:M.sdp},{signal:t}),await v.setLocalDescription(M).catch(O=>{throw a.error("could not execute setLocalDescription",O),new Se("Failed to set localDescription","ERR_SDP_HANDSHAKE_FAILED")}),c?.(new er("webrtc:read-sdp-answer"));const P=await w.read({signal:t});if(P.type!==nu.Type.SDP_ANSWER)throw new Se("Remote should send an SDP answer","ERR_SDP_HANDSHAKE_FAILED");a.trace("initiator receive SDP answer %s",P.data);const R=new ZQ({type:"answer",sdp:P.data});return await v.setRemoteDescription(R).catch(O=>{throw a.error("could not execute setRemoteDescription",O),new Se("Failed to set remoteDescription","ERR_SDP_HANDSHAKE_FAILED")}),a.trace("initiator read candidates until connected"),c?.(new er("webrtc:read-ice-candidates")),await YQ(v,w,{direction:"initiator",signal:t,log:a,onProgress:c}),a.trace("initiator connected, closing init channel"),S.close(),c?.(new er("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await b.close({signal:t}),a.trace("initiator connected to remote address %s",r),{remoteAddress:r,peerConnection:v,muxerFactory:T}}catch(S){throw a.error("outgoing signaling error",S),v.close(),b.abort(S),S}finally{v.onicecandidate=null,v.onicecandidateerror=null}}finally{if(y)try{await m.close({signal:t})}catch(b){m.abort(b)}}}class Rbe extends yc{constructor(t,i){super();E(this,"peerId");E(this,"transportManager");E(this,"shutdownController");this.peerId=t.peerId,this.transportManager=t.transportManager,this.shutdownController=i.shutdownController}async listen(){this.safeDispatchEvent("listening",{})}getAddrs(){return this.transportManager.getListeners().filter(t=>t!==this).map(t=>t.getAddrs().filter(i=>Ug.matches(i)).map(i=>i.encapsulate(`/webrtc/p2p/${this.peerId}`))).flat()}async close(){this.shutdownController.abort(),this.safeDispatchEvent("close",{})}}async function Ibe({peerConnection:n,stream:e,signal:t,connection:i,log:r}){r.trace("new inbound signaling stream");const s=Ld(e).pb(nu);try{n.onicecandidate=({candidate:u})=>{const h=JSON.stringify(u?.toJSON()??null);r.trace("recipient sending ICE candidate %s",h),s.write({type:nu.Type.ICE_CANDIDATE,data:h},{signal:t}).catch(p=>{r.error("error sending ICE candidate",p)})};const a=await s.read({signal:t});if(a.type!==nu.Type.SDP_OFFER)throw new Se(`expected message type SDP_OFFER, received: ${a.type??"undefined"} `,"ERR_SDP_HANDSHAKE_FAILED");r.trace("recipient receive SDP offer %s",a.data);const l=new ZQ({type:"offer",sdp:a.data});await n.setRemoteDescription(l).catch(u=>{throw r.error("could not execute setRemoteDescription",u),new Se("Failed to set remoteDescription","ERR_SDP_HANDSHAKE_FAILED")});const c=await n.createAnswer().catch(u=>{throw r.error("could not execute createAnswer",u),new Se("Failed to create answer","ERR_SDP_HANDSHAKE_FAILED")});r.trace("recipient send SDP answer %s",c.sdp),await s.write({type:nu.Type.SDP_ANSWER,data:c.sdp},{signal:t}),await n.setLocalDescription(c).catch(u=>{throw r.error("could not execute setLocalDescription",u),new Se("Failed to set localDescription","ERR_SDP_HANDSHAKE_FAILED")}),r.trace("recipient read candidates until connected"),await YQ(n,s,{direction:"recipient",signal:t,log:r})}catch(a){if(n.connectionState!=="connected")throw r.error("error while handling signaling stream from peer %a",i.remoteAddr,a),n.close(),a;r("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",i.remoteAddr,a)}const o=zi(`/webrtc/p2p/${i.remoteAddr.getPeerId()}`);return r.trace("recipient connected to remote address %s",o),{remoteAddress:o}}const Nbe="/webrtc",Pbe="/p2p-circuit",$I="/webrtc-signaling/0.0.1",kbe=30*1e3;var mFe,gFe,yFe,xFe;class Lbe{constructor(e,t={}){E(this,"components");E(this,"init");E(this,"log");E(this,"_started",!1);E(this,"metrics");E(this,"shutdownController");E(this,mFe,!0);E(this,gFe,"@libp2p/webrtc");E(this,yFe,["@libp2p/transport"]);E(this,xFe,["@libp2p/identify","@libp2p/circuit-relay-v2-transport"]);this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,tr(1/0,this.shutdownController.signal),e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle($I,e=>{this._onProtocol(e).catch(t=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)})},{runOnTransientConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle($I),this._started=!1}createListener(e){return new Rbe(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(X3e.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);const{remoteAddress:i,peerConnection:r,muxerFactory:s}=await Mbe({rtcConfiguration:await Lz(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=new Dz(this.components,{peerConnection:r,timeline:{open:Date.now()},remoteAddr:i,metrics:this.metrics?.dialerEvents}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,muxerFactory:s,onProgress:t.onProgress});return this._closeOnShutdown(r,o),a}async _onProtocol({connection:e,stream:t}){const i=AbortSignal.timeout(this.init.inboundConnectionTimeout??kbe),r=new qQ(await Lz(this.init.rtcConfiguration)),s=new KQ(this.components,{peerConnection:r,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:o}=await Ibe({peerConnection:r,connection:e,stream:t,signal:i,log:this.log});await t.close({signal:i});const a=new Dz(this.components,{peerConnection:r,timeline:{open:new Date().getTime()},remoteAddr:o,metrics:this.metrics?.listenerEvents});await this.components.upgrader.upgradeInbound(a,{skipEncryption:!0,skipProtection:!0,muxerFactory:s}),this._closeOnShutdown(r,a)}catch(o){throw this.log.error("incoming signaling error",o),r.close(),t.abort(o),o}}_closeOnShutdown(e,t){const i=()=>{t.close().catch(r=>{this.log.error("could not close WebRTCMultiaddrConnection",r)})};this.shutdownController.signal.addEventListener("abort",i),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",i)})}}mFe=JK,gFe=Symbol.toStringTag,yFe=kd,xFe=w6;function Dbe(n){const e=n.toString().split(Nbe+"/");if(e.length!==2)throw new Se("webrtc protocol was not present in multiaddr",sy.ERR_INVALID_MULTIADDR);if(!e[0].includes(Pbe))throw new Se("p2p-circuit protocol was not present in multiaddr",sy.ERR_INVALID_MULTIADDR);let t=zi(e[0]);const r=zi("/"+e[1]).getPeerId();if(r==null)throw new Se("destination peer id was missing",sy.ERR_INVALID_MULTIADDR);const s=t.protos().pop();if(s===void 0)throw new Se("invalid multiaddr",sy.ERR_INVALID_MULTIADDR);return s.name!=="p2p"&&(t=t.encapsulate(`/p2p/${r}`)),{baseAddr:t,peerId:Bi(r)}}function Obe(n){return e=>new Lbe(e,n)}class bb extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}}E(bb,"name","AbortError");var UM;let L_=(UM=class extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},E(UM,"name","InvalidParametersError"),UM);class XQ extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}E(XQ,"name","InvalidPublicKeyError");class QQ extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}E(QQ,"name","StreamResetError");class Fg extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}E(Fg,"name","StreamStateError");class GI extends Error{constructor(e="The stream buffer was full"){super(e),this.name="StreamBufferError"}}E(GI,"name","StreamBufferError");class JQ extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}E(JQ,"name","InvalidCIDError");class eJ extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}E(eJ,"name","InvalidMultihashError");class tJ extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}E(tJ,"name","InvalidMessageError");class nJ extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}E(nJ,"name","DialError");class i8 extends Error{constructor(e="Listen error"){super(e),this.name="ListenError"}}E(i8,"name","ListenError");class iJ extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}E(iJ,"name","UnsupportedKeyTypeError");class Bbe extends Event{constructor(t,i){super("message",i);E(this,"data");this.data=t}}class LL extends Event{constructor(t,i,r){super("close",r);E(this,"error");E(this,"local");this.error=i,this.local=t}}class Ube extends LL{constructor(e,t){super(!0,e,t)}}class Fbe extends LL{constructor(e,t){super(!1,e,t)}}const rJ=Symbol.for("@libp2p/peer-id"),zbe="keep-alive";function sJ(n){return n!=null&&typeof n.start=="function"&&typeof n.stop=="function"}async function jbe(...n){const e=[];for(const t of n)sJ(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function Vbe(...n){const e=[];for(const t of n)sJ(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const Hbe=Symbol.for("@libp2p/transport");var Oz;(function(n){n[n.FATAL_ALL=0]="FATAL_ALL",n[n.NO_FATAL=1]="NO_FATAL"})(Oz||(Oz={}));const $be=Symbol.for("@libp2p/service-capabilities"),Gbe=Symbol.for("@libp2p/service-dependencies"),Wbe=parseInt("11111",2),WI=parseInt("10000000",2),Kbe=parseInt("01111111",2),Bz={0:fv,1:fv,2:qbe,3:Xbe,4:Qbe,5:Ybe,6:Zbe,16:fv,22:fv,48:fv};function oJ(n,e={offset:0}){const t=n[e.offset]&Wbe;if(e.offset++,Bz[t]!=null)return Bz[t](n,e);throw new Error("No decoder for tag "+t)}function D_(n,e){let t=0;if((n[e.offset]&WI)===WI){const i=n[e.offset]&Kbe;let r="0x";e.offset++;for(let s=0;s<i;s++,e.offset++)r+=n[e.offset].toString(16).padStart(2,"0");t=parseInt(r,16)}else t=n[e.offset],e.offset++;return t}function fv(n,e){D_(n,e);const t=[];for(;!(e.offset>=n.byteLength);){const i=oJ(n,e);if(i===null)break;t.push(i)}return t}function qbe(n,e){const t=D_(n,e),i=e.offset,r=e.offset+t,s=[];for(let o=i;o<r;o++)o===i&&n[o]===0||s.push(n[o]);return e.offset+=t,Uint8Array.from(s)}function Zbe(n,e){const t=D_(n,e),i=e.offset+t,r=n[e.offset];e.offset++;let s=0,o=0;r<40?(s=0,o=r):r<80?(s=1,o=r-40):(s=2,o=r-80);let a=`${s}.${o}`,l=[];for(;e.offset<i;){const c=n[e.offset];if(e.offset++,l.push(c&127),c<128){l.reverse();let u=0;for(let h=0;h<l.length;h++)u+=l[h]<<h*7;a+=`.${u}`,l=[]}}return a}function Ybe(n,e){return e.offset++,null}function Xbe(n,e){const t=D_(n,e),i=n[e.offset];e.offset++;const r=n.subarray(e.offset,e.offset+t-1);if(e.offset+=t,i!==0)throw new Error("Unused bits in bit string is unimplemented");return r}function Qbe(n,e){const t=D_(n,e),i=n.subarray(e.offset,e.offset+t);return e.offset+=t,i}function Jbe(n){let e=n.toString(16);e.length%2===1&&(e="0"+e);const t=new Zn;for(let i=0;i<e.length;i+=2)t.append(Uint8Array.from([parseInt(`${e[i]}${e[i+1]}`,16)]));return t}function DL(n){if(n.byteLength<128)return Uint8Array.from([n.byteLength]);const e=Jbe(n.byteLength);return new Zn(Uint8Array.from([e.byteLength|WI]),e)}function e_e(n){const e=new Zn,t=128;return(n.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(n),new Zn(Uint8Array.from([2]),DL(e),e)}function t_e(n){const e=Uint8Array.from([0]),t=new Zn(e,n);return new Zn(Uint8Array.from([3]),DL(t),t)}function HA(n,e=48){const t=new Zn;for(const i of n)t.append(i);return new Zn(Uint8Array.from([e]),DL(t),t)}async function n_e(n,e,t,i){const r=await crypto.subtle.importKey("jwk",n,{name:"ECDSA",namedCurve:n.crv??"P-256"},!1,["verify"]);i?.signal?.throwIfAborted();const s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},r,e,t.subarray());return i?.signal?.throwIfAborted(),s}const i_e=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),r_e=Uint8Array.from([6,5,43,129,4,0,34]),s_e=Uint8Array.from([6,5,43,129,4,0,35]),o_e={ext:!0,kty:"EC",crv:"P-256"},a_e={ext:!0,kty:"EC",crv:"P-384"},l_e={ext:!0,kty:"EC",crv:"P-521"},$A=32,GA=48,WA=66;function c_e(n){const e=oJ(n);return u_e(e)}function u_e(n){const e=n[1][1][0],t=1;let i,r;if(e.byteLength===$A*2+1)return i=Vt(e.subarray(t,t+$A),"base64url"),r=Vt(e.subarray(t+$A),"base64url"),new KA({...o_e,key_ops:["verify"],x:i,y:r});if(e.byteLength===GA*2+1)return i=Vt(e.subarray(t,t+GA),"base64url"),r=Vt(e.subarray(t+GA),"base64url"),new KA({...a_e,key_ops:["verify"],x:i,y:r});if(e.byteLength===WA*2+1)return i=Vt(e.subarray(t,t+WA),"base64url"),r=Vt(e.subarray(t+WA),"base64url"),new KA({...l_e,key_ops:["verify"],x:i,y:r});throw new L_(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function h_e(n){return HA([e_e(Uint8Array.from([1])),HA([d_e(n.crv)],160),HA([t_e(new Zn(Uint8Array.from([4]),Ut(n.x??"","base64url"),Ut(n.y??"","base64url")))],161)]).subarray()}function d_e(n){if(n==="P-256")return i_e;if(n==="P-384")return r_e;if(n==="P-521")return s_e;throw new L_(`Invalid curve ${n}`)}class KA{constructor(e){E(this,"type","ECDSA");E(this,"jwk");E(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=h_e(this.jwk)),this._raw}toMultihash(){return xc.digest(GL(this))}toCID(){return Fi.createV1(114,this.toMultihash())}toString(){return Lr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:li(this.raw,e.raw)}async verify(e,t,i){return n_e(this.jwk,t,e,i)}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Q7(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Xm(n,e=""){if(!Number.isSafeInteger(n)||n<0){const t=e&&`"${e}" `;throw new Error(`${t}expected integer >= 0, got ${n}`)}}function Oi(n,e,t=""){const i=Q7(n),r=n?.length,s=e!==void 0;if(!i||s&&r!==e){const o=t&&`"${t}" `,a=s?` of length ${e}`:"",l=i?`length=${r}`:`type=${typeof n}`;throw new Error(o+"expected Uint8Array"+a+", got "+l)}return n}function aJ(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash must wrapped by utils.createHasher");Xm(n.outputLen),Xm(n.blockLen)}function r8(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function f_e(n,e){Oi(n,void 0,"digestInto() output");const t=e.outputLen;if(n.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function O2(...n){for(let e=0;e<n.length;e++)n[e].fill(0)}function qA(n){return new DataView(n.buffer,n.byteOffset,n.byteLength)}function Au(n,e){return n<<32-e|n>>>e}const lJ=(()=>typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function")(),p_e=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function O_(n){if(Oi(n),lJ)return n.toHex();let e="";for(let t=0;t<n.length;t++)e+=p_e[n[t]];return e}const kh={_0:48,_9:57,A:65,F:70,a:97,f:102};function Uz(n){if(n>=kh._0&&n<=kh._9)return n-kh._0;if(n>=kh.A&&n<=kh.F)return n-(kh.A-10);if(n>=kh.a&&n<=kh.f)return n-(kh.a-10)}function _b(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);if(lJ)return Uint8Array.fromHex(n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const i=new Uint8Array(t);for(let r=0,s=0;r<t;r++,s+=2){const o=Uz(n.charCodeAt(s)),a=Uz(n.charCodeAt(s+1));if(o===void 0||a===void 0){const l=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+l+'" at index '+s)}i[r]=o*16+a}return i}function Ju(...n){let e=0;for(let i=0;i<n.length;i++){const r=n[i];Oi(r),e+=r.length}const t=new Uint8Array(e);for(let i=0,r=0;i<n.length;i++){const s=n[i];t.set(s,r),r+=s.length}return t}function cJ(n,e={}){const t=(r,s)=>n(s).update(r).digest(),i=n(void 0);return t.outputLen=i.outputLen,t.blockLen=i.blockLen,t.create=r=>n(r),Object.assign(t,e),Object.freeze(t)}function OL(n=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(n))}const uJ=n=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,n])});function m_e(n,e,t){return n&e^~n&t}function g_e(n,e,t){return n&e^n&t^e&t}class hJ{constructor(e,t,i,r){E(this,"blockLen");E(this,"outputLen");E(this,"padOffset");E(this,"isLE");E(this,"buffer");E(this,"view");E(this,"finished",!1);E(this,"length",0);E(this,"pos",0);E(this,"destroyed",!1);this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=r,this.buffer=new Uint8Array(e),this.view=qA(this.buffer)}update(e){r8(this),Oi(e);const{view:t,buffer:i,blockLen:r}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(r-this.pos,s-o);if(a===r){const l=qA(e);for(;r<=s-o;o+=r)this.process(l,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){r8(this),f_e(e,this),this.finished=!0;const{buffer:t,view:i,blockLen:r,isLE:s}=this;let{pos:o}=this;t[o++]=128,O2(this.buffer.subarray(o)),this.padOffset>r-o&&(this.process(i,0),o=0);for(let h=o;h<r;h++)t[h]=0;i.setBigUint64(r-8,BigInt(this.length*8),s),this.process(i,0);const a=qA(e),l=this.outputLen;if(l%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const c=l/4,u=this.get();if(c>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<c;h++)a.setUint32(4*h,u[h],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:i,length:r,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=r,e.pos=a,r%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}}const vf=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),xo=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),S4=BigInt(2**32-1),Fz=BigInt(32);function y_e(n,e=!1){return e?{h:Number(n&S4),l:Number(n>>Fz&S4)}:{h:Number(n>>Fz&S4)|0,l:Number(n&S4)|0}}function x_e(n,e=!1){const t=n.length;let i=new Uint32Array(t),r=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=y_e(n[s],e);[i[s],r[s]]=[o,a]}return[i,r]}const zz=(n,e,t)=>n>>>t,jz=(n,e,t)=>n<<32-t|e>>>t,ng=(n,e,t)=>n>>>t|e<<32-t,ig=(n,e,t)=>n<<32-t|e>>>t,E4=(n,e,t)=>n<<64-t|e>>>t-32,T4=(n,e,t)=>n>>>t-32|e<<64-t;function Lh(n,e,t,i){const r=(e>>>0)+(i>>>0);return{h:n+t+(r/2**32|0)|0,l:r|0}}const v_e=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),b_e=(n,e,t,i)=>e+t+i+(n/2**32|0)|0,__e=(n,e,t,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(i>>>0),w_e=(n,e,t,i,r)=>e+t+i+r+(n/2**32|0)|0,S_e=(n,e,t,i,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(r>>>0),E_e=(n,e,t,i,r,s)=>e+t+i+r+s+(n/2**32|0)|0,T_e=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),bf=new Uint32Array(64);class A_e extends hJ{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:t,C:i,D:r,E:s,F:o,G:a,H:l}=this;return[e,t,i,r,s,o,a,l]}set(e,t,i,r,s,o,a,l){this.A=e|0,this.B=t|0,this.C=i|0,this.D=r|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=l|0}process(e,t){for(let h=0;h<16;h++,t+=4)bf[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const p=bf[h-15],m=bf[h-2],y=Au(p,7)^Au(p,18)^p>>>3,b=Au(m,17)^Au(m,19)^m>>>10;bf[h]=b+bf[h-7]+y+bf[h-16]|0}let{A:i,B:r,C:s,D:o,E:a,F:l,G:c,H:u}=this;for(let h=0;h<64;h++){const p=Au(a,6)^Au(a,11)^Au(a,25),m=u+p+m_e(a,l,c)+T_e[h]+bf[h]|0,b=(Au(i,2)^Au(i,13)^Au(i,22))+g_e(i,r,s)|0;u=c,c=l,l=a,a=o+m|0,o=s,s=r,r=i,i=m+b|0}i=i+this.A|0,r=r+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,l=l+this.F|0,c=c+this.G|0,u=u+this.H|0,this.set(i,r,s,o,a,l,c,u)}roundClean(){O2(bf)}destroy(){this.set(0,0,0,0,0,0,0,0),O2(this.buffer)}}class C_e extends A_e{constructor(){super(32);E(this,"A",vf[0]|0);E(this,"B",vf[1]|0);E(this,"C",vf[2]|0);E(this,"D",vf[3]|0);E(this,"E",vf[4]|0);E(this,"F",vf[5]|0);E(this,"G",vf[6]|0);E(this,"H",vf[7]|0)}}const dJ=(()=>x_e(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))))(),M_e=(()=>dJ[0])(),R_e=(()=>dJ[1])(),_f=new Uint32Array(80),wf=new Uint32Array(80);class I_e extends hJ{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:t,Bh:i,Bl:r,Ch:s,Cl:o,Dh:a,Dl:l,Eh:c,El:u,Fh:h,Fl:p,Gh:m,Gl:y,Hh:b,Hl:w}=this;return[e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w]}set(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=r|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=l|0,this.Eh=c|0,this.El=u|0,this.Fh=h|0,this.Fl=p|0,this.Gh=m|0,this.Gl=y|0,this.Hh=b|0,this.Hl=w|0}process(e,t){for(let S=0;S<16;S++,t+=4)_f[S]=e.getUint32(t),wf[S]=e.getUint32(t+=4);for(let S=16;S<80;S++){const M=_f[S-15]|0,P=wf[S-15]|0,R=ng(M,P,1)^ng(M,P,8)^zz(M,P,7),O=ig(M,P,1)^ig(M,P,8)^jz(M,P,7),B=_f[S-2]|0,N=wf[S-2]|0,I=ng(B,N,19)^E4(B,N,61)^zz(B,N,6),F=ig(B,N,19)^T4(B,N,61)^jz(B,N,6),j=__e(O,F,wf[S-7],wf[S-16]),W=w_e(j,R,I,_f[S-7],_f[S-16]);_f[S]=W|0,wf[S]=j|0}let{Ah:i,Al:r,Bh:s,Bl:o,Ch:a,Cl:l,Dh:c,Dl:u,Eh:h,El:p,Fh:m,Fl:y,Gh:b,Gl:w,Hh:v,Hl:T}=this;for(let S=0;S<80;S++){const M=ng(h,p,14)^ng(h,p,18)^E4(h,p,41),P=ig(h,p,14)^ig(h,p,18)^T4(h,p,41),R=h&m^~h&b,O=p&y^~p&w,B=S_e(T,P,O,R_e[S],wf[S]),N=E_e(B,v,M,R,M_e[S],_f[S]),I=B|0,F=ng(i,r,28)^E4(i,r,34)^E4(i,r,39),j=ig(i,r,28)^T4(i,r,34)^T4(i,r,39),W=i&s^i&a^s&a,U=r&o^r&l^o&l;v=b|0,T=w|0,b=m|0,w=y|0,m=h|0,y=p|0,{h,l:p}=Lh(c|0,u|0,N|0,I|0),c=a|0,u=l|0,a=s|0,l=o|0,s=i|0,o=r|0;const H=v_e(I,j,U);i=b_e(H,N,F,W),r=H|0}({h:i,l:r}=Lh(this.Ah|0,this.Al|0,i|0,r|0)),{h:s,l:o}=Lh(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l}=Lh(this.Ch|0,this.Cl|0,a|0,l|0),{h:c,l:u}=Lh(this.Dh|0,this.Dl|0,c|0,u|0),{h,l:p}=Lh(this.Eh|0,this.El|0,h|0,p|0),{h:m,l:y}=Lh(this.Fh|0,this.Fl|0,m|0,y|0),{h:b,l:w}=Lh(this.Gh|0,this.Gl|0,b|0,w|0),{h:v,l:T}=Lh(this.Hh|0,this.Hl|0,v|0,T|0),this.set(i,r,s,o,a,l,c,u,h,p,m,y,b,w,v,T)}roundClean(){O2(_f,wf)}destroy(){O2(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class N_e extends I_e{constructor(){super(64);E(this,"Ah",xo[0]|0);E(this,"Al",xo[1]|0);E(this,"Bh",xo[2]|0);E(this,"Bl",xo[3]|0);E(this,"Ch",xo[4]|0);E(this,"Cl",xo[5]|0);E(this,"Dh",xo[6]|0);E(this,"Dl",xo[7]|0);E(this,"Eh",xo[8]|0);E(this,"El",xo[9]|0);E(this,"Fh",xo[10]|0);E(this,"Fl",xo[11]|0);E(this,"Gh",xo[12]|0);E(this,"Gl",xo[13]|0);E(this,"Hh",xo[14]|0);E(this,"Hl",xo[15]|0)}}const P_e=cJ(()=>new C_e,uJ(1)),k_e=cJ(()=>new N_e,uJ(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const BL=BigInt(0),KI=BigInt(1);function Qm(n,e=""){if(typeof n!="boolean"){const t=e&&`"${e}" `;throw new Error(t+"expected boolean, got type="+typeof n)}return n}function fJ(n){if(typeof n=="bigint"){if(!AS(n))throw new Error("positive bigint expected, got "+n)}else Xm(n);return n}function A4(n){const e=fJ(n).toString(16);return e.length&1?"0"+e:e}function pJ(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?BL:BigInt("0x"+n)}function J7(n){return pJ(O_(n))}function wb(n){return pJ(O_(qI(Oi(n)).reverse()))}function UL(n,e){Xm(e),n=fJ(n);const t=_b(n.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function mJ(n,e){return UL(n,e).reverse()}function qI(n){return Uint8Array.from(n)}const AS=n=>typeof n=="bigint"&&BL<=n;function L_e(n,e,t){return AS(n)&&AS(e)&&AS(t)&&e<=n&&n<t}function ZI(n,e,t,i){if(!L_e(e,t,i))throw new Error("expected valid "+n+": "+t+" <= n < "+i+", got "+e)}function D_e(n){let e;for(e=0;n>BL;n>>=KI,e+=1);return e}const FL=n=>(KI<<BigInt(n))-KI;function O_e(n,e,t){if(Xm(n,"hashLen"),Xm(e,"qByteLen"),typeof t!="function")throw new Error("hmacFn must be a function");const i=w=>new Uint8Array(w),r=Uint8Array.of(),s=Uint8Array.of(0),o=Uint8Array.of(1),a=1e3;let l=i(n),c=i(n),u=0;const h=()=>{l.fill(1),c.fill(0),u=0},p=(...w)=>t(c,Ju(l,...w)),m=(w=r)=>{c=p(s,w),l=p(),w.length!==0&&(c=p(o,w),l=p())},y=()=>{if(u++>=a)throw new Error("drbg: tried max amount of iterations");let w=0;const v=[];for(;w<e;){l=p();const T=l.slice();v.push(T),w+=l.length}return Ju(...v)};return(w,v)=>{h(),m(w);let T;for(;!(T=v(y()));)m();return h(),T}}function B_(n,e={},t={}){if(!n||typeof n!="object")throw new Error("expected valid options object");function i(s,o,a){const l=n[s];if(a&&l===void 0)return;const c=typeof l;if(c!==o||l===null)throw new Error(`param "${s}" is invalid: expected ${o}, got ${c}`)}const r=(s,o)=>Object.entries(s).forEach(([a,l])=>i(a,l,o));r(e,!1),r(t,!0)}function s8(n){const e=new WeakMap;return(t,...i)=>{const r=e.get(t);if(r!==void 0)return r;const s=n(t,...i);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $a=BigInt(0),io=BigInt(1),am=BigInt(2),gJ=BigInt(3),yJ=BigInt(4),xJ=BigInt(5),B_e=BigInt(7),vJ=BigInt(8),U_e=BigInt(9),bJ=BigInt(16);function hs(n,e){const t=n%e;return t>=$a?t:e+t}function Kr(n,e,t){let i=n;for(;e-- >$a;)i*=i,i%=t;return i}function Vz(n,e){if(n===$a)throw new Error("invert: expected non-zero number");if(e<=$a)throw new Error("invert: expected positive modulus, got "+e);let t=hs(n,e),i=e,r=$a,s=io;for(;t!==$a;){const a=i/t,l=i%t,c=r-s*a;i=t,t=l,r=s,s=c}if(i!==io)throw new Error("invert: does not exist");return hs(r,e)}function zL(n,e,t){if(!n.eql(n.sqr(e),t))throw new Error("Cannot find square root")}function _J(n,e){const t=(n.ORDER+io)/yJ,i=n.pow(e,t);return zL(n,i,e),i}function F_e(n,e){const t=(n.ORDER-xJ)/vJ,i=n.mul(e,am),r=n.pow(i,t),s=n.mul(e,r),o=n.mul(n.mul(s,am),r),a=n.mul(s,n.sub(o,n.ONE));return zL(n,a,e),a}function z_e(n){const e=e9(n),t=wJ(n),i=t(e,e.neg(e.ONE)),r=t(e,i),s=t(e,e.neg(i)),o=(n+B_e)/bJ;return(a,l)=>{let c=a.pow(l,o),u=a.mul(c,i);const h=a.mul(c,r),p=a.mul(c,s),m=a.eql(a.sqr(u),l),y=a.eql(a.sqr(h),l);c=a.cmov(c,u,m),u=a.cmov(p,h,y);const b=a.eql(a.sqr(u),l),w=a.cmov(c,u,b);return zL(a,w,l),w}}function wJ(n){if(n<gJ)throw new Error("sqrt is not defined for small field");let e=n-io,t=0;for(;e%am===$a;)e/=am,t++;let i=am;const r=e9(n);for(;Hz(r,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return _J;let s=r.pow(i,e);const o=(e+io)/am;return function(l,c){if(l.is0(c))return c;if(Hz(l,c)!==1)throw new Error("Cannot find square root");let u=t,h=l.mul(l.ONE,s),p=l.pow(c,e),m=l.pow(c,o);for(;!l.eql(p,l.ONE);){if(l.is0(p))return l.ZERO;let y=1,b=l.sqr(p);for(;!l.eql(b,l.ONE);)if(y++,b=l.sqr(b),y===u)throw new Error("Cannot find square root");const w=io<<BigInt(u-y-1),v=l.pow(h,w);u=y,h=l.sqr(v),p=l.mul(p,h),m=l.mul(m,v)}return m}}function j_e(n){return n%yJ===gJ?_J:n%vJ===xJ?F_e:n%bJ===U_e?z_e(n):wJ(n)}const V_e=(n,e)=>(hs(n,e)&io)===io,H_e=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function $_e(n){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},t=H_e.reduce((i,r)=>(i[r]="function",i),e);return B_(n,t),n}function G_e(n,e,t){if(t<$a)throw new Error("invalid exponent, negatives unsupported");if(t===$a)return n.ONE;if(t===io)return e;let i=n.ONE,r=e;for(;t>$a;)t&io&&(i=n.mul(i,r)),r=n.sqr(r),t>>=io;return i}function SJ(n,e,t=!1){const i=new Array(e.length).fill(t?n.ZERO:void 0),r=e.reduce((o,a,l)=>n.is0(a)?o:(i[l]=o,n.mul(o,a)),n.ONE),s=n.inv(r);return e.reduceRight((o,a,l)=>n.is0(a)?o:(i[l]=n.mul(o,i[l]),n.mul(o,a)),s),i}function Hz(n,e){const t=(n.ORDER-io)/am,i=n.pow(e,t),r=n.eql(i,n.ONE),s=n.eql(i,n.ZERO),o=n.eql(i,n.neg(n.ONE));if(!r&&!s&&!o)throw new Error("invalid Legendre symbol result");return r?1:s?0:-1}function W_e(n,e){e!==void 0&&Xm(e);const t=e!==void 0?e:n.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}class K_e{constructor(e,t={}){E(this,"ORDER");E(this,"BITS");E(this,"BYTES");E(this,"isLE");E(this,"ZERO",$a);E(this,"ONE",io);E(this,"_lengths");E(this,"_sqrt");E(this,"_mod");if(e<=$a)throw new Error("invalid field: expected ORDER > 0, got "+e);let i;this.isLE=!1,t!=null&&typeof t=="object"&&(typeof t.BITS=="number"&&(i=t.BITS),typeof t.sqrt=="function"&&(this.sqrt=t.sqrt),typeof t.isLE=="boolean"&&(this.isLE=t.isLE),t.allowedLengths&&(this._lengths=t.allowedLengths?.slice()),typeof t.modFromBytes=="boolean"&&(this._mod=t.modFromBytes));const{nBitLength:r,nByteLength:s}=W_e(e,i);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=r,this.BYTES=s,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return hs(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return $a<=e&&e<this.ORDER}is0(e){return e===$a}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&io)===io}neg(e){return hs(-e,this.ORDER)}eql(e,t){return e===t}sqr(e){return hs(e*e,this.ORDER)}add(e,t){return hs(e+t,this.ORDER)}sub(e,t){return hs(e-t,this.ORDER)}mul(e,t){return hs(e*t,this.ORDER)}pow(e,t){return G_e(this,e,t)}div(e,t){return hs(e*Vz(t,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,t){return e+t}subN(e,t){return e-t}mulN(e,t){return e*t}inv(e){return Vz(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=j_e(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?mJ(e,this.BYTES):UL(e,this.BYTES)}fromBytes(e,t=!1){Oi(e);const{_lengths:i,BYTES:r,isLE:s,ORDER:o,_mod:a}=this;if(i){if(!i.includes(e.length)||e.length>r)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+e.length);const c=new Uint8Array(r);c.set(e,s?0:c.length-e.length),e=c}if(e.length!==r)throw new Error("Field.fromBytes: expected "+r+" bytes, got "+e.length);let l=s?wb(e):J7(e);if(a&&(l=hs(l,o)),!t&&!this.isValid(l))throw new Error("invalid field element: outside of range 0..ORDER");return l}invertBatch(e){return SJ(this,e)}cmov(e,t,i){return i?t:e}}function e9(n,e={}){return new K_e(n,e)}function EJ(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function TJ(n){const e=EJ(n);return e+Math.ceil(e/2)}function q_e(n,e,t=!1){Oi(n);const i=n.length,r=EJ(e),s=TJ(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);const o=t?wb(n):J7(n),a=hs(o,e-io)+io;return t?mJ(a,r):UL(a,r)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const B2=BigInt(0),lm=BigInt(1);function o8(n,e){const t=e.negate();return n?t:e}function w3(n,e){const t=SJ(n.Fp,e.map(i=>i.Z));return e.map((i,r)=>n.fromAffine(i.toAffine(t[r])))}function AJ(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function ZA(n,e){AJ(n,e);const t=Math.ceil(e/n)+1,i=2**(n-1),r=2**n,s=FL(n),o=BigInt(n);return{windows:t,windowSize:i,mask:s,maxNumber:r,shiftBy:o}}function $z(n,e,t){const{windowSize:i,mask:r,maxNumber:s,shiftBy:o}=t;let a=Number(n&r),l=n>>o;a>i&&(a-=s,l+=lm);const c=e*i,u=c+Math.abs(a)-1,h=a===0,p=a<0,m=e%2!==0;return{nextN:l,offset:u,isZero:h,isNeg:p,isNegF:m,offsetF:c}}const YA=new WeakMap,CJ=new WeakMap;function XA(n){return CJ.get(n)||1}function Gz(n){if(n!==B2)throw new Error("invalid wNAF")}class MJ{constructor(e,t){E(this,"BASE");E(this,"ZERO");E(this,"Fn");E(this,"bits");this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,i=this.ZERO){let r=e;for(;t>B2;)t&lm&&(i=i.add(r)),r=r.double(),t>>=lm;return i}precomputeWindow(e,t){const{windows:i,windowSize:r}=ZA(t,this.bits),s=[];let o=e,a=o;for(let l=0;l<i;l++){a=o,s.push(a);for(let c=1;c<r;c++)a=a.add(o),s.push(a);o=a.double()}return s}wNAF(e,t,i){if(!this.Fn.isValid(i))throw new Error("invalid scalar");let r=this.ZERO,s=this.BASE;const o=ZA(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:l,offset:c,isZero:u,isNeg:h,isNegF:p,offsetF:m}=$z(i,a,o);i=l,u?s=s.add(o8(p,t[m])):r=r.add(o8(h,t[c]))}return Gz(i),{p:r,f:s}}wNAFUnsafe(e,t,i,r=this.ZERO){const s=ZA(e,this.bits);for(let o=0;o<s.windows&&i!==B2;o++){const{nextN:a,offset:l,isZero:c,isNeg:u}=$z(i,o,s);if(i=a,!c){const h=t[l];r=r.add(u?h.negate():h)}}return Gz(i),r}getPrecomputes(e,t,i){let r=YA.get(t);return r||(r=this.precomputeWindow(t,e),e!==1&&(typeof i=="function"&&(r=i(r)),YA.set(t,r))),r}cached(e,t,i){const r=XA(e);return this.wNAF(r,this.getPrecomputes(r,e,i),t)}unsafe(e,t,i,r){const s=XA(e);return s===1?this._unsafeLadder(e,t,r):this.wNAFUnsafe(s,this.getPrecomputes(s,e,i),t,r)}createCache(e,t){AJ(t,this.bits),CJ.set(e,t),YA.delete(e)}hasCache(e){return XA(e)!==1}}function Z_e(n,e,t,i){let r=e,s=n.ZERO,o=n.ZERO;for(;t>B2||i>B2;)t&lm&&(s=s.add(r)),i&lm&&(o=o.add(r)),r=r.double(),t>>=lm,i>>=lm;return{p1:s,p2:o}}function Wz(n,e,t){if(e){if(e.ORDER!==n)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return $_e(e),e}else return e9(n,{isLE:t})}function RJ(n,e,t={},i){if(i===void 0&&(i=n==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${n} CURVE object`);for(const l of["p","n","h"]){const c=e[l];if(!(typeof c=="bigint"&&c>B2))throw new Error(`CURVE.${l} must be positive bigint`)}const r=Wz(e.p,t.Fp,i),s=Wz(e.n,t.Fn,i),a=["Gx","Gy","a",n==="weierstrass"?"b":"d"];for(const l of a)if(!r.isValid(e[l]))throw new Error(`CURVE.${l} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:r,Fn:s}}function IJ(n,e){return function(i){const r=n(i);return{secretKey:r,publicKey:e(r)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Sf=BigInt(0),Us=BigInt(1),QA=BigInt(2),Y_e=BigInt(8);function X_e(n,e,t,i){const r=n.sqr(t),s=n.sqr(i),o=n.add(n.mul(e.a,r),s),a=n.add(n.ONE,n.mul(e.d,n.mul(r,s)));return n.eql(o,a)}function Q_e(n,e={}){const t=RJ("edwards",n,e,e.FpFnLE),{Fp:i,Fn:r}=t;let s=t.CURVE;const{h:o}=s;B_(e,{},{uvRatio:"function"});const a=QA<<BigInt(r.BYTES*8)-Us,l=v=>i.create(v),c=e.uvRatio||((v,T)=>{try{return{isValid:!0,value:i.sqrt(i.div(v,T))}}catch{return{isValid:!1,value:Sf}}});if(!X_e(i,s,s.Gx,s.Gy))throw new Error("bad curve params: generator point");function u(v,T,S=!1){const M=S?Us:Sf;return ZI("coordinate "+v,T,M,a),T}function h(v){if(!(v instanceof y))throw new Error("EdwardsPoint expected")}const p=s8((v,T)=>{const{X:S,Y:M,Z:P}=v,R=v.is0();T==null&&(T=R?Y_e:i.inv(P));const O=l(S*T),B=l(M*T),N=i.mul(P,T);if(R)return{x:Sf,y:Us};if(N!==Us)throw new Error("invZ was invalid");return{x:O,y:B}}),m=s8(v=>{const{a:T,d:S}=s;if(v.is0())throw new Error("bad point: ZERO");const{X:M,Y:P,Z:R,T:O}=v,B=l(M*M),N=l(P*P),I=l(R*R),F=l(I*I),j=l(B*T),W=l(I*l(j+N)),U=l(F+l(S*l(B*N)));if(W!==U)throw new Error("bad point: equation left != right (1)");const H=l(M*P),q=l(R*O);if(H!==q)throw new Error("bad point: equation left != right (2)");return!0}),w=class w{constructor(T,S,M,P){E(this,"X");E(this,"Y");E(this,"Z");E(this,"T");this.X=u("x",T),this.Y=u("y",S),this.Z=u("z",M,!0),this.T=u("t",P),Object.freeze(this)}static CURVE(){return s}static fromAffine(T){if(T instanceof w)throw new Error("extended point not allowed");const{x:S,y:M}=T||{};return u("x",S),u("y",M),new w(S,M,Us,l(S*M))}static fromBytes(T,S=!1){const M=i.BYTES,{a:P,d:R}=s;T=qI(Oi(T,M,"point")),Qm(S,"zip215");const O=qI(T),B=T[M-1];O[M-1]=B&-129;const N=wb(O),I=S?a:i.ORDER;ZI("point.y",N,Sf,I);const F=l(N*N),j=l(F-Us),W=l(R*F-P);let{isValid:U,value:H}=c(j,W);if(!U)throw new Error("bad point: invalid y coordinate");const q=(H&Us)===Us,J=(B&128)!==0;if(!S&&H===Sf&&J)throw new Error("bad point: x=0 and x_0=1");return J!==q&&(H=l(-H)),w.fromAffine({x:H,y:N})}static fromHex(T,S=!1){return w.fromBytes(_b(T),S)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(T=8,S=!0){return b.createCache(this,T),S||this.multiply(QA),this}assertValidity(){m(this)}equals(T){h(T);const{X:S,Y:M,Z:P}=this,{X:R,Y:O,Z:B}=T,N=l(S*B),I=l(R*P),F=l(M*B),j=l(O*P);return N===I&&F===j}is0(){return this.equals(w.ZERO)}negate(){return new w(l(-this.X),this.Y,this.Z,l(-this.T))}double(){const{a:T}=s,{X:S,Y:M,Z:P}=this,R=l(S*S),O=l(M*M),B=l(QA*l(P*P)),N=l(T*R),I=S+M,F=l(l(I*I)-R-O),j=N+O,W=j-B,U=N-O,H=l(F*W),q=l(j*U),J=l(F*U),G=l(W*j);return new w(H,q,G,J)}add(T){h(T);const{a:S,d:M}=s,{X:P,Y:R,Z:O,T:B}=this,{X:N,Y:I,Z:F,T:j}=T,W=l(P*N),U=l(R*I),H=l(B*M*j),q=l(O*F),J=l((P+R)*(N+I)-W-U),G=q-H,ee=q+H,Q=l(U-S*W),ne=l(J*G),fe=l(ee*Q),Ae=l(J*Q),Pe=l(G*ee);return new w(ne,fe,Pe,Ae)}subtract(T){return this.add(T.negate())}multiply(T){if(!r.isValidNot0(T))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:S,f:M}=b.cached(this,T,P=>w3(w,P));return w3(w,[S,M])[0]}multiplyUnsafe(T,S=w.ZERO){if(!r.isValid(T))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return T===Sf?w.ZERO:this.is0()||T===Us?this:b.unsafe(this,T,M=>w3(w,M),S)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return b.unsafe(this,s.n).is0()}toAffine(T){return p(this,T)}clearCofactor(){return o===Us?this:this.multiplyUnsafe(o)}toBytes(){const{x:T,y:S}=this.toAffine(),M=i.toBytes(S);return M[M.length-1]|=T&Us?128:0,M}toHex(){return O_(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}};E(w,"BASE",new w(s.Gx,s.Gy,Us,l(s.Gx*s.Gy))),E(w,"ZERO",new w(Sf,Us,Us,Sf)),E(w,"Fp",i),E(w,"Fn",r);let y=w;const b=new MJ(y,r.BITS);return y.BASE.precompute(8),y}function J_e(n,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');B_(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:i}=t,{BASE:r,Fp:s,Fn:o}=n,a=t.randomBytes||OL,l=t.adjustScalarBytes||(B=>B),c=t.domain||((B,N,I)=>{if(Qm(I,"phflag"),N.length||I)throw new Error("Contexts/pre-hash are not supported");return B});function u(B){return o.create(wb(B))}function h(B){const N=S.secretKey;Oi(B,S.secretKey,"secretKey");const I=Oi(e(B),2*N,"hashedSecretKey"),F=l(I.slice(0,N)),j=I.slice(N,2*N),W=u(F);return{head:F,prefix:j,scalar:W}}function p(B){const{head:N,prefix:I,scalar:F}=h(B),j=r.multiply(F),W=j.toBytes();return{head:N,prefix:I,scalar:F,point:j,pointBytes:W}}function m(B){return p(B).pointBytes}function y(B=Uint8Array.of(),...N){const I=Ju(...N);return u(e(c(I,Oi(B,void 0,"context"),!!i)))}function b(B,N,I={}){B=Oi(B,void 0,"message"),i&&(B=i(B));const{prefix:F,scalar:j,pointBytes:W}=p(N),U=y(I.context,F,B),H=r.multiply(U).toBytes(),q=y(I.context,H,W,B),J=o.create(U+q*j);if(!o.isValid(J))throw new Error("sign failed: invalid s");const G=Ju(H,o.toBytes(J));return Oi(G,S.signature,"result")}const w={zip215:!0};function v(B,N,I,F=w){const{context:j,zip215:W}=F,U=S.signature;B=Oi(B,U,"signature"),N=Oi(N,void 0,"message"),I=Oi(I,S.publicKey,"publicKey"),W!==void 0&&Qm(W,"zip215"),i&&(N=i(N));const H=U/2,q=B.subarray(0,H),J=wb(B.subarray(H,U));let G,ee,Q;try{G=n.fromBytes(I,W),ee=n.fromBytes(q,W),Q=r.multiplyUnsafe(J)}catch{return!1}if(!W&&G.isSmallOrder())return!1;const ne=y(j,ee.toBytes(),G.toBytes(),N);return ee.add(G.multiplyUnsafe(ne)).subtract(Q).clearCofactor().is0()}const T=s.BYTES,S={secretKey:T,publicKey:T,signature:2*T,seed:T};function M(B=a(S.seed)){return Oi(B,S.seed,"seed")}function P(B){return Q7(B)&&B.length===o.BYTES}function R(B,N){try{return!!n.fromBytes(B,N)}catch{return!1}}const O={getExtendedPublicKey:p,randomSecretKey:M,isValidSecretKey:P,isValidPublicKey:R,toMontgomery(B){const{y:N}=n.fromBytes(B),I=S.publicKey,F=I===32;if(!F&&I!==57)throw new Error("only defined for 25519 and 448");const j=F?s.div(Us+N,Us-N):s.div(N-Us,N+Us);return s.toBytes(j)},toMontgomerySecret(B){const N=S.secretKey;Oi(B,N);const I=e(B.subarray(0,N));return l(I).subarray(0,N)}};return Object.freeze({keygen:IJ(M,m),getPublicKey:m,sign:b,verify:v,utils:O,Point:n,lengths:S})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ewe=BigInt(1),Kz=BigInt(2),twe=BigInt(5),nwe=BigInt(8),jL=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),iwe=(()=>({p:jL,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:nwe,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")}))();function rwe(n){const e=BigInt(10),t=BigInt(20),i=BigInt(40),r=BigInt(80),s=jL,a=n*n%s*n%s,l=Kr(a,Kz,s)*a%s,c=Kr(l,ewe,s)*n%s,u=Kr(c,twe,s)*c%s,h=Kr(u,e,s)*u%s,p=Kr(h,t,s)*h%s,m=Kr(p,i,s)*p%s,y=Kr(m,r,s)*m%s,b=Kr(y,r,s)*m%s,w=Kr(b,e,s)*u%s;return{pow_p_5_8:Kr(w,Kz,s)*n%s,b2:a}}function swe(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}const qz=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function owe(n,e){const t=jL,i=hs(e*e*e,t),r=hs(i*i*e,t),s=rwe(n*r).pow_p_5_8;let o=hs(n*i*s,t);const a=hs(e*o*o,t),l=o,c=hs(o*qz,t),u=a===n,h=a===hs(-n,t),p=a===hs(-n*qz,t);return u&&(o=l),(h||p)&&(o=c),V_e(o,t)&&(o=hs(-o,t)),{isValid:u||h,value:o}}const awe=Q_e(iwe,{uvRatio:owe});function lwe(n){return J_e(awe,k_e,Object.assign({adjustScalarBytes:swe},n))}const cwe=lwe({});class Zz extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class uwe extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const YI={get(n=globalThis){const e=n.crypto;if(e?.subtle==null)throw new uwe("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}},NJ=32;let JA;const hwe=(async()=>{try{return await YI.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();async function dwe(n,e,t){if(n.buffer instanceof ArrayBuffer){const i=await YI.get().subtle.importKey("raw",n.buffer,{name:"Ed25519"},!1,["verify"]);return await YI.get().subtle.verify({name:"Ed25519"},i,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function fwe(n,e,t){return cwe.verify(e,t instanceof Uint8Array?t:t.subarray(),n)}async function pwe(n,e,t){return JA==null&&(JA=await hwe),JA?dwe(n,e,t):fwe(n,e,t)}function PJ(n){return n==null?!1:typeof n.then=="function"&&typeof n.catch=="function"&&typeof n.finally=="function"}class mwe{constructor(e){E(this,"type","Ed25519");E(this,"raw");this.raw=kJ(e,NJ)}toMultihash(){return xc.digest(GL(this))}toCID(){return Fi.createV1(114,this.toMultihash())}toString(){return Lr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:li(this.raw,e.raw)}verify(e,t,i){i?.signal?.throwIfAborted();const r=pwe(this.raw,t,e);return PJ(r)?r.then(s=>(i?.signal?.throwIfAborted(),s)):r}}function gwe(n){return n=kJ(n,NJ),new mwe(n)}function kJ(n,e){if(n=Uint8Array.from(n??[]),n.length!==e)throw new L_(`Key must be a Uint8Array of length ${e}, got ${n.length}`);return n}const VL=new Float32Array([-0]),t0=new Uint8Array(VL.buffer);function ywe(n,e,t){VL[0]=n,e[t]=t0[0],e[t+1]=t0[1],e[t+2]=t0[2],e[t+3]=t0[3]}function xwe(n,e){return t0[0]=n[e],t0[1]=n[e+1],t0[2]=n[e+2],t0[3]=n[e+3],VL[0]}const HL=new Float64Array([-0]),Ro=new Uint8Array(HL.buffer);function vwe(n,e,t){HL[0]=n,e[t]=Ro[0],e[t+1]=Ro[1],e[t+2]=Ro[2],e[t+3]=Ro[3],e[t+4]=Ro[4],e[t+5]=Ro[5],e[t+6]=Ro[6],e[t+7]=Ro[7]}function bwe(n,e){return Ro[0]=n[e],Ro[1]=n[e+1],Ro[2]=n[e+2],Ro[3]=n[e+3],Ro[4]=n[e+4],Ro[5]=n[e+5],Ro[6]=n[e+6],Ro[7]=n[e+7],HL[0]}const _we=BigInt(Number.MAX_SAFE_INTEGER),wwe=BigInt(Number.MIN_SAFE_INTEGER);let id=class $p{constructor(e,t){E(this,"lo");E(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let i=~this.hi>>>0;return t===0&&(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let i=~this.hi>>>0;return t===0&&(i=i+1>>>0),-(BigInt(t)+(BigInt(i)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}static fromBigInt(e){if(e===0n)return Rm;if(e<_we&&e>wwe)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let i=e>>32n,r=e-(i<<32n);return t&&(i=~i|0n,r=~r|0n,++r>Yz&&(r=0n,++i>Yz&&(i=0n))),new $p(Number(r),Number(i))}static fromNumber(e){if(e===0)return Rm;const t=e<0;t&&(e=-e);let i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new $p(i,r)}static from(e){return typeof e=="number"?$p.fromNumber(e):typeof e=="bigint"?$p.fromBigInt(e):typeof e=="string"?$p.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new $p(e.low>>>0,e.high>>>0):Rm}};const Rm=new id(0,0);Rm.toBigInt=function(){return 0n};Rm.zzEncode=Rm.zzDecode=function(){return this};Rm.length=function(){return 1};const Yz=4294967296n;function Swe(n){let e=0,t=0;for(let i=0;i<n.length;++i)t=n.charCodeAt(i),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(n.charCodeAt(i+1)&64512)===56320?(++i,e+=4):e+=3;return e}function Ewe(n,e,t){if(t-e<1)return"";let r;const s=[];let o=0,a;for(;e<t;)a=n[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|n[e++]&63:a>239&&a<365?(a=((a&7)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(n[e++]&63)<<6|n[e++]&63,o>8191&&((r??(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r!=null?(o>0&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function LJ(n,e,t){const i=t;let r,s;for(let o=0;o<n.length;++o)r=n.charCodeAt(o),r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&((s=n.charCodeAt(o+1))&64512)===56320?(r=65536+((r&1023)<<10)+(s&1023),++o,e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128);return t-i}function Pc(n,e){return RangeError(`index out of range: ${n.pos} + ${e??1} > ${n.len}`)}function C4(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}let Twe=class{constructor(e){E(this,"buf");E(this,"pos");E(this,"len");E(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Pc(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw Pc(this,4);return C4(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Pc(this,4);return C4(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw Pc(this,4);const e=xwe(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Pc(this,4);const e=bwe(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw Pc(this,e);return this.pos+=e,t===i?new Uint8Array(0):this.buf.subarray(t,i)}string(){const e=this.bytes();return Ewe(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Pc(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Pc(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new id(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw Pc(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Pc(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Pc(this,8);const e=C4(this.buf,this.pos+=4),t=C4(this.buf,this.pos+=4);return new id(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=x7(this.buf,this.pos);return this.pos+=nr(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}};function Awe(n){return new Twe(n instanceof Uint8Array?n:n.subarray())}function Vd(n,e,t){const i=Awe(n);return e.decode(i,void 0,t)}function Cwe(n){const e=n??8192,t=e>>>1;let i,r=e;return function(o){if(o<1||o>t)return Cs(o);r+o>e&&(i=Cs(e),r=0);const a=i.subarray(r,r+=o);return r&7&&(r=(r|7)+1),a}}let t3=class{constructor(e,t,i){E(this,"fn");E(this,"len");E(this,"next");E(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=i}};function eC(){}let Mwe=class{constructor(e){E(this,"head");E(this,"tail");E(this,"len");E(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}};const Rwe=Cwe();function Iwe(n){return globalThis.Buffer!=null?Cs(n):Rwe(n)}let XI=class{constructor(){E(this,"len");E(this,"head");E(this,"tail");E(this,"states");this.len=0,this.head=new t3(eC,0,0),this.tail=this.head,this.states=null}_push(e,t,i){return this.tail=this.tail.next=new t3(e,t,i),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Pwe((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(M4,10,id.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=id.fromBigInt(e);return this._push(M4,t.length(),t)}uint64Number(e){return this._push(M0,nr(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=id.fromBigInt(e).zzEncode();return this._push(M4,t.length(),t)}sint64Number(e){const t=id.fromNumber(e).zzEncode();return this._push(M4,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(tC,1,e?1:0)}fixed32(e){return this._push(pv,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=id.fromBigInt(e);return this._push(pv,4,t.lo)._push(pv,4,t.hi)}fixed64Number(e){const t=id.fromNumber(e);return this._push(pv,4,t.lo)._push(pv,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(ywe,4,e)}double(e){return this._push(vwe,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(tC,1,0):this.uint32(t)._push(kwe,t,e)}string(e){const t=Swe(e);return t!==0?this.uint32(t)._push(LJ,t,e):this._push(tC,1,0)}fork(){return this.states=new Mwe(this),this.head=this.tail=new t3(eC,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new t3(eC,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i!==0&&(this.tail.next=e.next,this.tail=t,this.len+=i),this}finish(){let e=this.head.next;const t=Iwe(this.len);let i=0;for(;e!=null;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t}};function tC(n,e,t){e[t]=n&255}function Nwe(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}let Pwe=class extends t3{constructor(t,i){super(Nwe,t,i);E(this,"next");this.next=void 0}};function M4(n,e,t){for(;n.hi!==0;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}function pv(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function kwe(n,e,t){e.set(n,t)}globalThis.Buffer!=null&&(XI.prototype.bytes=function(n){const e=n.length>>>0;return this.uint32(e),e>0&&this._push(Lwe,e,n),this},XI.prototype.string=function(n){const e=globalThis.Buffer.byteLength(n);return this.uint32(e),e>0&&this._push(Dwe,e,n),this});function Lwe(n,e,t){e.set(n,t)}function Dwe(n,e,t){n.length<40?LJ(n,e,t):e.utf8Write!=null?e.utf8Write(n,t):e.set(Ut(n),t)}function Owe(){return new XI}function Hd(n,e){const t=Owe();return e.encode(n,t,{lengthDelimited:!1}),t.finish()}var a8;(function(n){n[n.VARINT=0]="VARINT",n[n.BIT64=1]="BIT64",n[n.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",n[n.START_GROUP=3]="START_GROUP",n[n.END_GROUP=4]="END_GROUP",n[n.BIT32=5]="BIT32"})(a8||(a8={}));function DJ(n,e,t,i){return{name:n,type:e,encode:t,decode:i}}function t9(n){function e(r){if(n[r.toString()]==null)throw new Error("Invalid enum value");return n[r]}const t=function(s,o){const a=e(s);o.int32(a)},i=function(s){const o=s.int32();return e(o)};return DJ("enum",a8.VARINT,t,i)}function $d(n,e){return DJ("message",a8.LENGTH_DELIMITED,n,e)}class OJ extends Error{constructor(){super(...arguments);E(this,"code","ERR_MAX_LENGTH");E(this,"name","MaxLengthError")}}var hc;(function(n){n.RSA="RSA",n.Ed25519="Ed25519",n.secp256k1="secp256k1",n.ECDSA="ECDSA"})(hc||(hc={}));var QI;(function(n){n[n.RSA=0]="RSA",n[n.Ed25519=1]="Ed25519",n[n.secp256k1=2]="secp256k1",n[n.ECDSA=3]="ECDSA"})(QI||(QI={}));(function(n){n.codec=()=>t9(QI)})(hc||(hc={}));var l8;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.Type!=null&&(i.uint32(8),hc.codec().encode(t.Type,i)),t.Data!=null&&(i.uint32(18),i.bytes(t.Data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=hc.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(l8||(l8={}));var Xz;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.Type!=null&&(i.uint32(8),hc.codec().encode(t.Type,i)),t.Data!=null&&(i.uint32(18),i.bytes(t.Data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=hc.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(Xz||(Xz={}));class BJ{constructor(e,t){E(this,"oHash");E(this,"iHash");E(this,"blockLen");E(this,"outputLen");E(this,"finished",!1);E(this,"destroyed",!1);if(aJ(e),Oi(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,r=new Uint8Array(i);r.set(t.length>i?e.create().update(t).digest():t);for(let s=0;s<r.length;s++)r[s]^=54;this.iHash.update(r),this.oHash=e.create();for(let s=0;s<r.length;s++)r[s]^=106;this.oHash.update(r),O2(r)}update(e){return r8(this),this.iHash.update(e),this}digestInto(e){r8(this),Oi(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:i,finished:r,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=r,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const UJ=(n,e,t)=>new BJ(n,e).update(t).digest();UJ.create=(n,e)=>new BJ(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qz=(n,e)=>(n+(n>=0?e:-e)/FJ)/e;function Bwe(n,e,t){const[[i,r],[s,o]]=e,a=Qz(o*n,t),l=Qz(-r*n,t);let c=n-a*i-l*s,u=-a*r-l*o;const h=c<xd,p=u<xd;h&&(c=-c),p&&(u=-u);const m=FL(Math.ceil(D_e(t)/2))+My;if(c<xd||c>=m||u<xd||u>=m)throw new Error("splitScalar (endomorphism): failed, k="+n);return{k1neg:h,k1:c,k2neg:p,k2:u}}function JI(n){if(!["compact","recovered","der"].includes(n))throw new Error('Signature format must be "compact", "recovered", or "der"');return n}function nC(n,e){const t={};for(let i of Object.keys(e))t[i]=n[i]===void 0?e[i]:n[i];return Qm(t.lowS,"lowS"),Qm(t.prehash,"prehash"),t.format!==void 0&&JI(t.format),t}class Uwe extends Error{constructor(e=""){super(e)}}const Ff={Err:Uwe,_tlv:{encode:(n,e)=>{const{Err:t}=Ff;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const i=e.length/2,r=A4(i);if(r.length/2&128)throw new t("tlv.encode: long form length too big");const s=i>127?A4(r.length/2|128):"";return A4(n)+s+r+e},decode(n,e){const{Err:t}=Ff;let i=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==n)throw new t("tlv.decode: wrong tlv");const r=e[i++],s=!!(r&128);let o=0;if(!s)o=r;else{const l=r&127;if(!l)throw new t("tlv.decode(long): indefinite length not supported");if(l>4)throw new t("tlv.decode(long): byte length is too big");const c=e.subarray(i,i+l);if(c.length!==l)throw new t("tlv.decode: length bytes not complete");if(c[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of c)o=o<<8|u;if(i+=l,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(n){const{Err:e}=Ff;if(n<xd)throw new e("integer: negative integers are not allowed");let t=A4(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=Ff;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return J7(n)}},toSig(n){const{Err:e,_int:t,_tlv:i}=Ff,r=Oi(n,void 0,"signature"),{v:s,l:o}=i.decode(48,r);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l}=i.decode(2,s),{v:c,l:u}=i.decode(2,l);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(c)}},hexFromSig(n){const{_tlv:e,_int:t}=Ff,i=e.encode(2,t.encode(n.r)),r=e.encode(2,t.encode(n.s)),s=i+r;return e.encode(48,s)}},xd=BigInt(0),My=BigInt(1),FJ=BigInt(2),R4=BigInt(3),Fwe=BigInt(4);function zwe(n,e={}){const t=RJ("weierstrass",n,e),{Fp:i,Fn:r}=t;let s=t.CURVE;const{h:o,n:a}=s;B_(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:l}=e;if(l&&(!i.is0(s.a)||typeof l.beta!="bigint"||!Array.isArray(l.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const c=jJ(i,r);function u(){if(!i.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(W,U,H){const{x:q,y:J}=U.toAffine(),G=i.toBytes(q);if(Qm(H,"isCompressed"),H){u();const ee=!i.isOdd(J);return Ju(zJ(ee),G)}else return Ju(Uint8Array.of(4),G,i.toBytes(J))}function p(W){Oi(W,void 0,"Point");const{publicKey:U,publicKeyUncompressed:H}=c,q=W.length,J=W[0],G=W.subarray(1);if(q===U&&(J===2||J===3)){const ee=i.fromBytes(G);if(!i.isValid(ee))throw new Error("bad point: is not on curve, wrong x");const Q=b(ee);let ne;try{ne=i.sqrt(Q)}catch(Pe){const Ce=Pe instanceof Error?": "+Pe.message:"";throw new Error("bad point: is not on curve, sqrt error"+Ce)}u();const fe=i.isOdd(ne);return(J&1)===1!==fe&&(ne=i.neg(ne)),{x:ee,y:ne}}else if(q===H&&J===4){const ee=i.BYTES,Q=i.fromBytes(G.subarray(0,ee)),ne=i.fromBytes(G.subarray(ee,ee*2));if(!w(Q,ne))throw new Error("bad point: is not on curve");return{x:Q,y:ne}}else throw new Error(`bad point: got length ${q}, expected compressed=${U} or uncompressed=${H}`)}const m=e.toBytes||h,y=e.fromBytes||p;function b(W){const U=i.sqr(W),H=i.mul(U,W);return i.add(i.add(H,i.mul(W,s.a)),s.b)}function w(W,U){const H=i.sqr(U),q=b(W);return i.eql(H,q)}if(!w(s.Gx,s.Gy))throw new Error("bad curve params: generator point");const v=i.mul(i.pow(s.a,R4),Fwe),T=i.mul(i.sqr(s.b),BigInt(27));if(i.is0(i.add(v,T)))throw new Error("bad curve params: a or b");function S(W,U,H=!1){if(!i.isValid(U)||H&&i.is0(U))throw new Error(`bad point coordinate ${W}`);return U}function M(W){if(!(W instanceof N))throw new Error("Weierstrass Point expected")}function P(W){if(!l||!l.basises)throw new Error("no endo");return Bwe(W,l.basises,r.ORDER)}const R=s8((W,U)=>{const{X:H,Y:q,Z:J}=W;if(i.eql(J,i.ONE))return{x:H,y:q};const G=W.is0();U==null&&(U=G?i.ONE:i.inv(J));const ee=i.mul(H,U),Q=i.mul(q,U),ne=i.mul(J,U);if(G)return{x:i.ZERO,y:i.ZERO};if(!i.eql(ne,i.ONE))throw new Error("invZ was invalid");return{x:ee,y:Q}}),O=s8(W=>{if(W.is0()){if(e.allowInfinityPoint&&!i.is0(W.Y))return;throw new Error("bad point: ZERO")}const{x:U,y:H}=W.toAffine();if(!i.isValid(U)||!i.isValid(H))throw new Error("bad point: x or y not field elements");if(!w(U,H))throw new Error("bad point: equation left != right");if(!W.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function B(W,U,H,q,J){return H=new N(i.mul(H.X,W),H.Y,H.Z),U=o8(q,U),H=o8(J,H),U.add(H)}const j=class j{constructor(U,H,q){E(this,"X");E(this,"Y");E(this,"Z");this.X=S("x",U),this.Y=S("y",H,!0),this.Z=S("z",q),Object.freeze(this)}static CURVE(){return s}static fromAffine(U){const{x:H,y:q}=U||{};if(!U||!i.isValid(H)||!i.isValid(q))throw new Error("invalid affine point");if(U instanceof j)throw new Error("projective point not allowed");return i.is0(H)&&i.is0(q)?j.ZERO:new j(H,q,i.ONE)}static fromBytes(U){const H=j.fromAffine(y(Oi(U,void 0,"point")));return H.assertValidity(),H}static fromHex(U){return j.fromBytes(_b(U))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(U=8,H=!0){return F.createCache(this,U),H||this.multiply(R4),this}assertValidity(){O(this)}hasEvenY(){const{y:U}=this.toAffine();if(!i.isOdd)throw new Error("Field doesn't support isOdd");return!i.isOdd(U)}equals(U){M(U);const{X:H,Y:q,Z:J}=this,{X:G,Y:ee,Z:Q}=U,ne=i.eql(i.mul(H,Q),i.mul(G,J)),fe=i.eql(i.mul(q,Q),i.mul(ee,J));return ne&&fe}negate(){return new j(this.X,i.neg(this.Y),this.Z)}double(){const{a:U,b:H}=s,q=i.mul(H,R4),{X:J,Y:G,Z:ee}=this;let Q=i.ZERO,ne=i.ZERO,fe=i.ZERO,Ae=i.mul(J,J),Pe=i.mul(G,G),Ce=i.mul(ee,ee),de=i.mul(J,G);return de=i.add(de,de),fe=i.mul(J,ee),fe=i.add(fe,fe),Q=i.mul(U,fe),ne=i.mul(q,Ce),ne=i.add(Q,ne),Q=i.sub(Pe,ne),ne=i.add(Pe,ne),ne=i.mul(Q,ne),Q=i.mul(de,Q),fe=i.mul(q,fe),Ce=i.mul(U,Ce),de=i.sub(Ae,Ce),de=i.mul(U,de),de=i.add(de,fe),fe=i.add(Ae,Ae),Ae=i.add(fe,Ae),Ae=i.add(Ae,Ce),Ae=i.mul(Ae,de),ne=i.add(ne,Ae),Ce=i.mul(G,ee),Ce=i.add(Ce,Ce),Ae=i.mul(Ce,de),Q=i.sub(Q,Ae),fe=i.mul(Ce,Pe),fe=i.add(fe,fe),fe=i.add(fe,fe),new j(Q,ne,fe)}add(U){M(U);const{X:H,Y:q,Z:J}=this,{X:G,Y:ee,Z:Q}=U;let ne=i.ZERO,fe=i.ZERO,Ae=i.ZERO;const Pe=s.a,Ce=i.mul(s.b,R4);let de=i.mul(H,G),Ne=i.mul(q,ee),et=i.mul(J,Q),me=i.add(H,q),nt=i.add(G,ee);me=i.mul(me,nt),nt=i.add(de,Ne),me=i.sub(me,nt),nt=i.add(H,J);let Pt=i.add(G,Q);return nt=i.mul(nt,Pt),Pt=i.add(de,et),nt=i.sub(nt,Pt),Pt=i.add(q,J),ne=i.add(ee,Q),Pt=i.mul(Pt,ne),ne=i.add(Ne,et),Pt=i.sub(Pt,ne),Ae=i.mul(Pe,nt),ne=i.mul(Ce,et),Ae=i.add(ne,Ae),ne=i.sub(Ne,Ae),Ae=i.add(Ne,Ae),fe=i.mul(ne,Ae),Ne=i.add(de,de),Ne=i.add(Ne,de),et=i.mul(Pe,et),nt=i.mul(Ce,nt),Ne=i.add(Ne,et),et=i.sub(de,et),et=i.mul(Pe,et),nt=i.add(nt,et),de=i.mul(Ne,nt),fe=i.add(fe,de),de=i.mul(Pt,nt),ne=i.mul(me,ne),ne=i.sub(ne,de),de=i.mul(me,Ne),Ae=i.mul(Pt,Ae),Ae=i.add(Ae,de),new j(ne,fe,Ae)}subtract(U){return this.add(U.negate())}is0(){return this.equals(j.ZERO)}multiply(U){const{endo:H}=e;if(!r.isValidNot0(U))throw new Error("invalid scalar: out of range");let q,J;const G=ee=>F.cached(this,ee,Q=>w3(j,Q));if(H){const{k1neg:ee,k1:Q,k2neg:ne,k2:fe}=P(U),{p:Ae,f:Pe}=G(Q),{p:Ce,f:de}=G(fe);J=Pe.add(de),q=B(H.beta,Ae,Ce,ee,ne)}else{const{p:ee,f:Q}=G(U);q=ee,J=Q}return w3(j,[q,J])[0]}multiplyUnsafe(U){const{endo:H}=e,q=this;if(!r.isValid(U))throw new Error("invalid scalar: out of range");if(U===xd||q.is0())return j.ZERO;if(U===My)return q;if(F.hasCache(this))return this.multiply(U);if(H){const{k1neg:J,k1:G,k2neg:ee,k2:Q}=P(U),{p1:ne,p2:fe}=Z_e(j,q,G,Q);return B(H.beta,ne,fe,J,ee)}else return F.unsafe(q,U)}toAffine(U){return R(this,U)}isTorsionFree(){const{isTorsionFree:U}=e;return o===My?!0:U?U(j,this):F.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:U}=e;return o===My?this:U?U(j,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(U=!0){return Qm(U,"isCompressed"),this.assertValidity(),m(j,this,U)}toHex(U=!0){return O_(this.toBytes(U))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}};E(j,"BASE",new j(s.Gx,s.Gy,i.ONE)),E(j,"ZERO",new j(i.ZERO,i.ONE,i.ZERO)),E(j,"Fp",i),E(j,"Fn",r);let N=j;const I=r.BITS,F=new MJ(N,e.endo?Math.ceil(I/2):I);return N.BASE.precompute(8),N}function zJ(n){return Uint8Array.of(n?2:3)}function jJ(n,e){return{secretKey:e.BYTES,publicKey:1+n.BYTES,publicKeyUncompressed:1+2*n.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function jwe(n,e={}){const{Fn:t}=n,i=e.randomBytes||OL,r=Object.assign(jJ(n.Fp,t),{seed:TJ(t.ORDER)});function s(m){try{const y=t.fromBytes(m);return t.isValidNot0(y)}catch{return!1}}function o(m,y){const{publicKey:b,publicKeyUncompressed:w}=r;try{const v=m.length;return y===!0&&v!==b||y===!1&&v!==w?!1:!!n.fromBytes(m)}catch{return!1}}function a(m=i(r.seed)){return q_e(Oi(m,r.seed,"seed"),t.ORDER)}function l(m,y=!0){return n.BASE.multiply(t.fromBytes(m)).toBytes(y)}function c(m){const{secretKey:y,publicKey:b,publicKeyUncompressed:w}=r;if(!Q7(m)||"_lengths"in t&&t._lengths||y===b)return;const v=Oi(m,void 0,"key").length;return v===b||v===w}function u(m,y,b=!0){if(c(m)===!0)throw new Error("first arg must be private key");if(c(y)===!1)throw new Error("second arg must be public key");const w=t.fromBytes(m);return n.fromBytes(y).multiply(w).toBytes(b)}const h={isValidSecretKey:s,isValidPublicKey:o,randomSecretKey:a},p=IJ(a,l);return Object.freeze({getPublicKey:l,getSharedSecret:u,keygen:p,Point:n,utils:h,lengths:r})}function Vwe(n,e,t={}){aJ(e),B_(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),t=Object.assign({},t);const i=t.randomBytes||OL,r=t.hmac||((U,H)=>UJ(e,U,H)),{Fp:s,Fn:o}=n,{ORDER:a,BITS:l}=o,{keygen:c,getPublicKey:u,getSharedSecret:h,utils:p,lengths:m}=jwe(n,t),y={prehash:!0,lowS:typeof t.lowS=="boolean"?t.lowS:!0,format:"compact",extraEntropy:!1},b=a*FJ<s.ORDER;function w(U){const H=a>>My;return U>H}function v(U,H){if(!o.isValidNot0(H))throw new Error(`invalid signature ${U}: out of range 1..Point.Fn.ORDER`);return H}function T(){if(b)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function S(U,H){JI(H);const q=m.signature,J=H==="compact"?q:H==="recovered"?q+1:void 0;return Oi(U,J)}class M{constructor(H,q,J){E(this,"r");E(this,"s");E(this,"recovery");if(this.r=v("r",H),this.s=v("s",q),J!=null){if(T(),![0,1,2,3].includes(J))throw new Error("invalid recovery id");this.recovery=J}Object.freeze(this)}static fromBytes(H,q=y.format){S(H,q);let J;if(q==="der"){const{r:ne,s:fe}=Ff.toSig(Oi(H));return new M(ne,fe)}q==="recovered"&&(J=H[0],q="compact",H=H.subarray(1));const G=m.signature/2,ee=H.subarray(0,G),Q=H.subarray(G,G*2);return new M(o.fromBytes(ee),o.fromBytes(Q),J)}static fromHex(H,q){return this.fromBytes(_b(H),q)}assertRecovery(){const{recovery:H}=this;if(H==null)throw new Error("invalid recovery id: must be present");return H}addRecoveryBit(H){return new M(this.r,this.s,H)}recoverPublicKey(H){const{r:q,s:J}=this,G=this.assertRecovery(),ee=G===2||G===3?q+a:q;if(!s.isValid(ee))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const Q=s.toBytes(ee),ne=n.fromBytes(Ju(zJ((G&1)===0),Q)),fe=o.inv(ee),Ae=R(Oi(H,void 0,"msgHash")),Pe=o.create(-Ae*fe),Ce=o.create(J*fe),de=n.BASE.multiplyUnsafe(Pe).add(ne.multiplyUnsafe(Ce));if(de.is0())throw new Error("invalid recovery: point at infinify");return de.assertValidity(),de}hasHighS(){return w(this.s)}toBytes(H=y.format){if(JI(H),H==="der")return _b(Ff.hexFromSig(this));const{r:q,s:J}=this,G=o.toBytes(q),ee=o.toBytes(J);return H==="recovered"?(T(),Ju(Uint8Array.of(this.assertRecovery()),G,ee)):Ju(G,ee)}toHex(H){return O_(this.toBytes(H))}}const P=t.bits2int||function(H){if(H.length>8192)throw new Error("input is too large");const q=J7(H),J=H.length*8-l;return J>0?q>>BigInt(J):q},R=t.bits2int_modN||function(H){return o.create(P(H))},O=FL(l);function B(U){return ZI("num < 2^"+l,U,xd,O),o.toBytes(U)}function N(U,H){return Oi(U,void 0,"message"),H?Oi(e(U),void 0,"prehashed message"):U}function I(U,H,q){const{lowS:J,prehash:G,extraEntropy:ee}=nC(q,y);U=N(U,G);const Q=R(U),ne=o.fromBytes(H);if(!o.isValidNot0(ne))throw new Error("invalid private key");const fe=[B(ne),B(Q)];if(ee!=null&&ee!==!1){const de=ee===!0?i(m.secretKey):ee;fe.push(Oi(de,void 0,"extraEntropy"))}const Ae=Ju(...fe),Pe=Q;function Ce(de){const Ne=P(de);if(!o.isValidNot0(Ne))return;const et=o.inv(Ne),me=n.BASE.multiply(Ne).toAffine(),nt=o.create(me.x);if(nt===xd)return;const Pt=o.create(et*o.create(Pe+nt*ne));if(Pt===xd)return;let zt=(me.x===nt?0:2)|Number(me.y&My),Dt=Pt;return J&&w(Pt)&&(Dt=o.neg(Pt),zt^=1),new M(nt,Dt,b?void 0:zt)}return{seed:Ae,k2sig:Ce}}function F(U,H,q={}){const{seed:J,k2sig:G}=I(U,H,q);return O_e(e.outputLen,o.BYTES,r)(J,G).toBytes(q.format)}function j(U,H,q,J={}){const{lowS:G,prehash:ee,format:Q}=nC(J,y);if(q=Oi(q,void 0,"publicKey"),H=N(H,ee),!Q7(U)){const ne=U instanceof M?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+ne)}S(U,Q);try{const ne=M.fromBytes(U,Q),fe=n.fromBytes(q);if(G&&ne.hasHighS())return!1;const{r:Ae,s:Pe}=ne,Ce=R(H),de=o.inv(Pe),Ne=o.create(Ce*de),et=o.create(Ae*de),me=n.BASE.multiplyUnsafe(Ne).add(fe.multiplyUnsafe(et));return me.is0()?!1:o.create(me.x)===Ae}catch{return!1}}function W(U,H,q={}){const{prehash:J}=nC(q,y);return H=N(H,J),M.fromBytes(U,"recovered").recoverPublicKey(H).toBytes()}return Object.freeze({keygen:c,getPublicKey:u,getSharedSecret:h,utils:p,lengths:m,Point:n,sign:F,verify:j,recoverPublicKey:W,Signature:M,hash:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $L={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Hwe={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},Jz=BigInt(2);function $we(n){const e=$L.p,t=BigInt(3),i=BigInt(6),r=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),l=BigInt(88),c=n*n*n%e,u=c*c*n%e,h=Kr(u,t,e)*u%e,p=Kr(h,t,e)*u%e,m=Kr(p,Jz,e)*c%e,y=Kr(m,r,e)*m%e,b=Kr(y,s,e)*y%e,w=Kr(b,a,e)*b%e,v=Kr(w,l,e)*w%e,T=Kr(v,a,e)*b%e,S=Kr(T,t,e)*u%e,M=Kr(S,o,e)*y%e,P=Kr(M,i,e)*c%e,R=Kr(P,Jz,e);if(!eN.eql(eN.sqr(R),n))throw new Error("Cannot find square root");return R}const eN=e9($L.p,{sqrt:$we}),Gwe=zwe($L,{Fp:eN,endo:Hwe}),c8=Vwe(Gwe,P_e);function Wwe(n,e,t,i){const r=Ir.digest(t instanceof Uint8Array?t:t.subarray());if(PJ(r))return r.then(({digest:s})=>(i?.signal?.throwIfAborted(),c8.verify(e,s,n,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new Zz(String(s))});try{return i?.signal?.throwIfAborted(),c8.verify(e,r.digest,n,{prehash:!1,format:"der"})}catch(s){throw new Zz(String(s))}}class Kwe{constructor(e){E(this,"type","secp256k1");E(this,"raw");E(this,"_key");this._key=Ywe(e),this.raw=Zwe(this._key)}toMultihash(){return xc.digest(GL(this))}toCID(){return Fi.createV1(114,this.toMultihash())}toString(){return Lr.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:li(this.raw,e.raw)}verify(e,t,i){return Wwe(this._key,t,e,i)}}function qwe(n){return new Kwe(n)}function Zwe(n){return c8.Point.fromBytes(n).toBytes()}function Ywe(n){try{return c8.Point.fromBytes(n),n}catch(e){throw new XQ(String(e))}}function Xwe(n){const{Type:e,Data:t}=l8.decode(n.digest),i=t??new Uint8Array;switch(e){case hc.Ed25519:return gwe(i);case hc.secp256k1:return qwe(i);case hc.ECDSA:return c_e(i);default:throw new iJ}}function GL(n){return l8.encode({Type:hc[n.type],Data:n.raw})}const VJ=Symbol.for("nodejs.util.inspect.custom"),Qwe=114;var vFe;class WL{constructor(e){E(this,"type");E(this,"multihash");E(this,"publicKey");E(this,"string");E(this,vFe,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Lr.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Fi.createV1(Qwe,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return li(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return li(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(vFe=rJ,VJ)](){return`PeerId(${this.toString()})`}}class Jwe extends WL{constructor(t){super({...t,type:"RSA"});E(this,"type","RSA");E(this,"publicKey");this.publicKey=t.publicKey}}class e4e extends WL{constructor(t){super({...t,type:"Ed25519"});E(this,"type","Ed25519");E(this,"publicKey");this.publicKey=t.publicKey}}class t4e extends WL{constructor(t){super({...t,type:"secp256k1"});E(this,"type","secp256k1");E(this,"publicKey");this.publicKey=t.publicKey}}const n4e=2336;var bFe;class HJ{constructor(e){E(this,"type","url");E(this,"multihash");E(this,"publicKey");E(this,"url");E(this,bFe,!0);this.url=e.toString(),this.multihash=xc.digest(Ut(this.url))}[VJ](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Fi.createV1(n4e,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=Vt(e)),e.toString()===this.toString())}}bFe=rJ;const i4e=114,ej=2336;function tj(n,e){let t;if(n.charAt(0)==="1"||n.charAt(0)==="Q")t=g2(Lr.decode(`z${n}`));else{if(n.startsWith("k51qzi5uqu5")||n.startsWith("kzwfwjn5ji4")||n.startsWith("k2k4r8")||n.startsWith("bafz"))return r4e(Fi.parse(n));if(e==null)throw new L_('Please pass a multibase decoder for strings that do not start with "1" or "Q"');t=g2(e.decode(n))}return KL(t)}function KL(n){if(o4e(n))return new Jwe({multihash:n});if(s4e(n))try{const e=Xwe(n);if(e.type==="Ed25519")return new e4e({multihash:n,publicKey:e});if(e.type==="secp256k1")return new t4e({multihash:n,publicKey:e})}catch{const t=Vt(n.digest);return new HJ(new URL(t))}throw new eJ("Supplied PeerID Multihash is invalid")}function r4e(n){if(n?.multihash==null||n.version==null||n.version===1&&n.code!==i4e&&n.code!==ej)throw new JQ("Supplied PeerID CID is invalid");if(n.code===ej){const e=Vt(n.multihash.digest);return new HJ(new URL(e))}return KL(n.multihash)}function s4e(n){return n.code===xc.code}function o4e(n){return n.code===Ir.code}const qL={hash:n=>Number(Wk(n,{size:32})),hashV:(n,e)=>a4e(qL.hash(n,e))};function a4e(n){let e=n.toString(16);return e.length%2===1&&(e=`0${e}`),Ut(e,"base16")}const $J=64;let cm=class{constructor(e,t,i,r=2){E(this,"fp");E(this,"h");E(this,"seed");if(r>$J)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,i),o=qn(r);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=i}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?li(this.fp,e.fp):!1}};function u8(n,e){return Math.floor(Math.random()*(e-n))+n}let I4=class{constructor(e){E(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof cm))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof cm))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof cm))throw new TypeError("Invalid Fingerprint");const t=u8(0,this.contents.length-1),i=this.contents[t];return this.contents[t]=e,i}remove(e){if(!(e instanceof cm))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(i=>e.equals(i));return t>-1?(this.contents[t]=null,!0):!1}};const l4e=500;let nj=class{constructor(e){E(this,"bucketSize");E(this,"filterSize");E(this,"fingerprintSize");E(this,"buckets");E(this,"count");E(this,"hash");E(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??qL,this.seed=e.seed??u8(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=Ut(e));const t=new cm(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=(i^t.hash())%this.filterSize;if(this.buckets[i]==null&&(this.buckets[i]=new I4(this.bucketSize)),this.buckets[r]==null&&(this.buckets[r]=new I4(this.bucketSize)),this.buckets[i].add(t)||this.buckets[r].add(t))return this.count++,!0;const s=[i,r];let o=s[u8(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new I4(this.bucketSize));for(let a=0;a<l4e;a++){const l=this.buckets[o].swap(t);if(l!=null&&(o=(o^l.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new I4(this.bucketSize)),this.buckets[o].add(l)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=Ut(e));const t=new cm(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=this.buckets[i]?.has(t)??!1;if(r)return r;const s=(i^t.hash())%this.filterSize;return this.buckets[s]?.has(t)??!1}remove(e){typeof e=="string"&&(e=Ut(e));const t=new cm(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=this.buckets[i]?.remove(t)??!1;if(r)return this.count--,r;const s=(i^t.hash())%this.filterSize,o=this.buckets[s]?.remove(t)??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}};const c4e={1:.5,2:.84,4:.95,8:.98};function u4e(n=.001){return n>.002?2:n>1e-5?4:8}function h4e(n,e=.001){const t=u4e(e),i=c4e[t],r=Math.round(n/i),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),$J);return{filterSize:r,bucketSize:t,fingerprintSize:s}}let d4e=class{constructor(e){E(this,"filterSize");E(this,"bucketSize");E(this,"fingerprintSize");E(this,"scale");E(this,"filterSeries");E(this,"hash");E(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??qL,this.seed=e.seed??u8(0,Math.pow(2,10)),this.filterSeries=[new nj({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=Ut(e)),this.has(e))return!0;let t=this.filterSeries.find(i=>i.reliable);if(t==null){const i=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new nj({filterSize:i,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=Ut(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=Ut(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}};function ij(n,e=.001,t){return new d4e({...h4e(n,e),...t??{}})}const f4e=n=>{const e=n.addEventListener||n.on||n.addListener,t=n.removeEventListener||n.off||n.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(n),removeListener:t.bind(n)}};function p4e(n,e,t){let i;const r=new Promise((s,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,rejectionMultiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();const a=[e].flat(),l=[],{addListener:c,removeListener:u}=f4e(n),h=async(...m)=>{const y=t.multiArgs?m:m[0];if(t.filter)try{if(!await t.filter(y))return}catch(b){i(),o(b);return}l.push(y),t.count===l.length&&(i(),s(l))},p=(...m)=>{i(),o(t.rejectionMultiArgs?m:m[0])};i=()=>{for(const m of a)u(m,h);for(const m of t.rejectionEvents)a.includes(m)||u(m,p)};for(const m of a)c(m,h);for(const m of t.rejectionEvents)a.includes(m)||c(m,p);t.signal&&t.signal.addEventListener("abort",()=>{p(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(l)});if(r.cancel=i,typeof t.timeout=="number"){const s=k_(r,{milliseconds:t.timeout});return s.cancel=()=>{i(),s.clear()},s}return r}function Ry(n,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const i=p4e(n,e,t),r=i.then(s=>s[0]);return r.cancel=i.cancel,r}function rj(n,e){let t;const i=function(){const r=function(){t=void 0,n()};clearTimeout(t),t=setTimeout(r,e)};return i.start=()=>{},i.stop=()=>{clearTimeout(t)},i}class GJ extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}E(GJ,"name","QueueFullError");class Sb extends Error{constructor(){super(...arguments);E(this,"name","UnexpectedEOFError")}}E(Sb,"name","UnexpectedEOFError");class WJ extends Error{constructor(){super(...arguments);E(this,"name","StreamClosedError")}}E(WJ,"name","StreamClosedError");function m4e(n){return n.reason}async function ZL(n,e,t){if(e==null)return n;const i=t?.translateError??m4e;if(e.aborted)return n.catch(()=>{}),Promise.reject(i(e));let r;try{return await Promise.race([n,new Promise((s,o)=>{r=()=>{o(i(e))},e.addEventListener("abort",r)})])}finally{r!=null&&e.removeEventListener("abort",r)}}class g4e{constructor(e){E(this,"deferred");E(this,"signal");this.signal=e,this.deferred=Ki(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new bb)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function y4e(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class x4e{constructor(e,t){E(this,"id");E(this,"fn");E(this,"options");E(this,"recipients");E(this,"status");E(this,"timeline");E(this,"controller");this.id=y4e(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,i)=>t&&i.signal?.aborted===!0,!0)&&(this.controller.abort(new bb),this.cleanup())}async join(e={}){const t=new g4e(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await ZL(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}class v4e extends f1{constructor(t={}){super();E(this,"concurrency");E(this,"maxSize");E(this,"queue");E(this,"pending");E(this,"sort");E(this,"paused");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.paused=!1,t.metricName!=null&&t.metrics?.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=t.sort,this.queue=[],this.emitEmpty=rj(this.emitEmpty.bind(this),1),this.emitIdle=rj(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.tryToStartAnother())}tryToStartAnother(){if(this.paused)return!1;if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(const i of this.queue)if(i.status==="queued"){t=i;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let i=0;i<this.queue.length;i++)if(this.queue[i]===t){this.queue.splice(i,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,i){if(i?.signal?.throwIfAborted(),this.size===this.maxSize)throw new GJ;const r=new x4e(t,i);return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),r.join(i).then(s=>(this.safeDispatchEvent("completed",{detail:s}),this.safeDispatchEvent("success",{detail:{job:r,result:s}}),s)).catch(s=>{if(r.status==="queued"){for(let o=0;o<this.queue.length;o++)if(this.queue[o]===r){this.queue.splice(o,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:r,error:s}}),s})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new bb)}),this.clear()}async onEmpty(t){this.size!==0&&await Ry(this,"empty",t)}async onSizeLessThan(t,i){this.size<t||await Ry(this,"next",{...i,filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Ry(this,"idle",t)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){t?.signal?.throwIfAborted();const i=vc({objectMode:!0}),r=c=>{c!=null?this.abort():this.clear(),i.end(c)},s=c=>{c.detail!=null&&i.push(c.detail)},o=c=>{r(c.detail.error)},a=()=>{r()},l=()=>{r(new bb("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("failure",o),this.addEventListener("idle",a),t?.signal?.addEventListener("abort",l);try{yield*i}finally{this.removeEventListener("completed",s),this.removeEventListener("failure",o),this.removeEventListener("idle",a),t?.signal?.removeEventListener("abort",l),r()}}}const b4e=Math.pow(2,20)*4;class _4e extends f1{constructor(t){super();E(this,"status");E(this,"timeline");E(this,"inactivityTimeout");E(this,"maxReadBufferLength");E(this,"maxWriteBufferLength");E(this,"log");E(this,"direction");E(this,"maxMessageSize");E(this,"readStatus");E(this,"writeStatus");E(this,"remoteReadStatus");E(this,"remoteWriteStatus");E(this,"writableNeedsDrain");E(this,"readBuffer");E(this,"writeBuffer");E(this,"sendingData");E(this,"onDrainPromise");this.status="open",this.log=t.log,this.direction=t.direction??"outbound",this.inactivityTimeout=t.inactivityTimeout??12e4,this.maxReadBufferLength=t.maxReadBufferLength??b4e,this.maxWriteBufferLength=t.maxWriteBufferLength,this.maxMessageSize=t.maxMessageSize,this.readBuffer=new Zn,this.writeBuffer=new Zn,this.readStatus="readable",this.remoteReadStatus="readable",this.writeStatus="writable",this.remoteWriteStatus="writable",this.sendingData=!1,this.writableNeedsDrain=!1,this.timeline={open:Date.now()},this.processSendQueue=this.processSendQueue.bind(this);const i=()=>{this.writableNeedsDrain&&(this.log.trace("drain event received, continue sending data"),this.writableNeedsDrain=!1,this.processSendQueue()),this.onDrainPromise?.resolve()};this.addEventListener("drain",i);const r=s=>{this.onDrainPromise?.reject(s.error??new WJ)};this.addEventListener("close",r)}get readBufferLength(){return this.readBuffer.byteLength}get writeBufferLength(){return this.writeBuffer.byteLength}async onDrain(t){return this.writableNeedsDrain!==!0?Promise.resolve():(this.onDrainPromise==null&&(this.onDrainPromise=Promise.withResolvers()),ZL(this.onDrainPromise.promise,t?.signal))}async*[Symbol.asyncIterator](){if(this.readStatus!=="readable"&&this.readStatus!=="paused")return;const t=vc(),i=o=>{t.push(o.data)};this.addEventListener("message",i);const r=o=>{t.end(o.error)};this.addEventListener("close",r);const s=()=>{t.end()};this.addEventListener("remoteCloseWrite",s);try{yield*t}finally{this.removeEventListener("message",i),this.removeEventListener("close",r),this.removeEventListener("remoteCloseWrite",s)}}isReadable(){return this.status==="open"}send(t){if(this.writeStatus==="closed"||this.writeStatus==="closing")throw new Fg(`Cannot write to a stream that is ${this.writeStatus}`);return this.log.trace("append %d bytes to write buffer",t.byteLength),this.writeBuffer.append(t),this.processSendQueue()}abort(t){if(!(this.status==="aborted"||this.status==="reset"||this.status==="closed")){this.log.error("abort with error - %e",t),this.status="aborted",this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle")),this.writeStatus="closed",this.remoteWriteStatus="closed",this.readStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now();try{this.sendReset(t)}catch(i){this.log("failed to send reset to remote - %e",i)}this.dispatchEvent(new Ube(t))}}pause(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Fg("Cannot pause a stream that is closing/closed");this.readStatus!=="paused"&&(this.readStatus="paused",this.sendPause())}resume(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Fg("Cannot resume a stream that is closing/closed");this.readStatus!=="readable"&&(this.readStatus="readable",this.dispatchReadBuffer(),this.sendResume())}push(t){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Fg(`Cannot push data onto a stream that is ${this.readStatus}`);if(t.byteLength!==0){if(this.readBuffer.append(t),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}unshift(t){if(this.readStatus==="closed"||this.readStatus==="closing")throw new Fg(`Cannot push data onto a stream that is ${this.readStatus}`);if(t.byteLength!==0){if(this.readBuffer.prepend(t),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}onData(t){if(t.byteLength!==0){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("ignoring data - read status %s",this.readStatus);return}this.readBuffer.append(t),this.dispatchReadBuffer()}}addEventListener(...t){super.addEventListener.apply(this,t),t[0]==="message"&&this.readBuffer.byteLength>0&&queueMicrotask(()=>{this.dispatchReadBuffer()})}onRemoteReset(){this.log("remote reset"),this.status="reset",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now(),this.readBuffer.byteLength===0&&(this.readStatus="closed");const t=new QQ;this.dispatchEvent(new Fbe(t))}onTransportClosed(t){this.log("transport closed"),this.readStatus==="readable"&&this.readBuffer.byteLength===0&&(this.log("close readable end after transport closed and read buffer is empty"),this.readStatus="closed"),this.remoteReadStatus!=="closed"&&(this.remoteReadStatus="closed"),this.remoteWriteStatus!=="closed"&&(this.remoteWriteStatus="closed"),this.writeStatus!=="closed"&&(this.writeStatus="closed"),t!=null?this.abort(t):(this.status==="open"||this.status==="closing")&&(this.timeline.close=Date.now(),this.status="closed",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.dispatchEvent(new LL))}onRemoteCloseWrite(){this.remoteWriteStatus!=="closed"&&(this.log.trace("on remote close write"),this.remoteWriteStatus="closed",this.safeDispatchEvent("remoteCloseWrite"),this.writeStatus==="closed"&&this.onTransportClosed())}onRemoteCloseRead(){this.log.trace("on remote close read"),this.remoteReadStatus="closed",this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle"))}processSendQueue(){if(this.writableNeedsDrain)return this.log.trace("not processing send queue as drain is required"),this.checkWriteBufferLength(),!1;if(this.writeBuffer.byteLength===0)return this.log.trace("not processing send queue as no bytes to send"),!0;if(this.sendingData)return this.log.trace("not processing send queue as already sending data"),!0;this.sendingData=!0,this.log.trace("processing send queue with %d queued bytes",this.writeBuffer.byteLength);try{let t=!0;const i=this.writeBuffer.byteLength;let r=0;for(;this.writeBuffer.byteLength>0;){const s=Math.min(this.maxMessageSize??this.writeBuffer.byteLength,this.writeBuffer.byteLength);if(s===0){t=!1;break}const o=this.writeBuffer.sublist(0,s),a=new Zn(o);this.writeBuffer.consume(o.byteLength);const l=this.sendData(o);if(t=l.canSendMore,r+=l.sentBytes,l.sentBytes!==a.byteLength&&(a.consume(l.sentBytes),this.writeBuffer.prepend(a)),!t)break}return t||(this.log.trace("sent %d/%d bytes, pausing sending because underlying stream is full, %d bytes left in the write buffer",r,i,this.writeBuffer.byteLength),this.writableNeedsDrain=!0,this.checkWriteBufferLength()),this.writeBuffer.byteLength===0&&this.safeDispatchEvent("idle"),t}finally{this.sendingData=!1}}dispatchReadBuffer(){try{if(this.listenerCount("message")===0){this.log.trace("not dispatching pause buffer as there are no listeners for the message event");return}if(this.readBuffer.byteLength===0){this.log.trace("not dispatching pause buffer as there is no data to dispatch");return}if(this.readStatus==="paused"){this.log.trace("not dispatching pause buffer we are paused");return}if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("dropping %d bytes because the readable end is %s",this.readBuffer.byteLength,this.readStatus),this.readBuffer.consume(this.readBuffer.byteLength);return}const t=this.readBuffer.sublist();this.readBuffer.consume(t.byteLength),this.dispatchEvent(new Bbe(t))}finally{this.readBuffer.byteLength===0&&this.remoteWriteStatus==="closed"&&(this.log("close readable end after dispatching read buffer and remote writable end is closed"),this.readStatus="closed"),this.checkReadBufferLength()}}checkReadBufferLength(){this.readBuffer.byteLength>this.maxReadBufferLength&&this.abort(new GI(`Read buffer length of ${this.readBuffer.byteLength} exceeded limit of ${this.maxReadBufferLength}, read status is ${this.readStatus}`))}checkWriteBufferLength(){this.maxWriteBufferLength!=null&&this.writeBuffer.byteLength>this.maxWriteBufferLength&&this.abort(new GI(`Write buffer length of ${this.writeBuffer.byteLength} exceeded limit of ${this.maxWriteBufferLength}, write status is ${this.writeStatus}`))}onMuxerNeedsDrain(){this.writableNeedsDrain=!0}onMuxerDrain(){this.safeDispatchEvent("drain")}}class w4e extends _4e{constructor(t){super(t);E(this,"remoteAddr");E(this,"metricPrefix");E(this,"metrics");this.metricPrefix=t.metricPrefix??"",this.metrics=t.metrics,this.remoteAddr=t.remoteAddr,this.addEventListener("close",i=>{this.metrics?.increment({[`${this.metricPrefix}end`]:!0}),i.error!=null?i.local?this.metrics?.increment({[`${this.metricPrefix}abort`]:!0}):this.metrics?.increment({[`${this.metricPrefix}reset`]:!0}):i.local?this.metrics?.increment({[`${this.metricPrefix}_local_close`]:!0}):this.metrics?.increment({[`${this.metricPrefix}_remote_close`]:!0})})}async close(t){this.status==="open"&&(this.status="closing",this.writeStatus="closing",this.remoteWriteStatus="closing",this.remoteReadStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await Ry(this,"idle",{...t,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await Ry(this,"drain",{...t,rejectionEvents:["close"]})),await this.sendClose(t),this.onTransportClosed())}}var FM;let cc=(FM=class extends Error{constructor(){super(...arguments);E(this,"name","InvalidMultiaddrError")}},E(FM,"name","InvalidMultiaddrError"),FM);var zM;let Eb=(zM=class extends Error{constructor(){super(...arguments);E(this,"name","ValidationError")}},E(zM,"name","ValidationError"),zM);class KJ extends Error{constructor(){super(...arguments);E(this,"name","InvalidParametersError")}}E(KJ,"name","InvalidParametersError");var jM;let S4e=(jM=class extends Error{constructor(){super(...arguments);E(this,"name","UnknownProtocolError")}},E(jM,"name","UnknownProtocolError"),jM);const E4e=4,T4e=6,A4e=273,C4e=33,M4e=41,R4e=42,I4e=43,N4e=53,P4e=54,k4e=55,L4e=56,D4e=132,O4e=301,B4e=302,U4e=400,h8=421,F4e=444,z4e=445,j4e=446,V4e=447,H4e=448,$4e=449,G4e=454,W4e=460,K4e=461,q4e=465,Z4e=466,Y4e=480,X4e=481,Q4e=443,J4e=477,e5e=478,t5e=479,n5e=277,i5e=275,r5e=276,s5e=280,o5e=281,YL=290,a5e=777;function sj(n){return e=>Vt(e,n)}function oj(n){return e=>Ut(e,n)}function n3(n){return new DataView(n.buffer).getUint16(n.byteOffset).toString()}function oy(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof n=="string"?parseInt(n):n),new Uint8Array(e)}function l5e(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ut(e[0],"base32"),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const r=oy(i);return Ms([t,r],t.length+r.length)}function c5e(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=oh.decode(`b${e[0]}`),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const r=oy(i);return Ms([t,r],t.length+r.length)}function aj(n){const e=n.subarray(0,n.length-2),t=n.subarray(n.length-2),i=Vt(e,"base32"),r=n3(t);return`${i}:${r}`}const qJ=function(n){n=n.toString().trim();const e=new Uint8Array(4);return n.split(/\./g).forEach((t,i)=>{const r=parseInt(t,10);if(isNaN(r)||r<0||r>255)throw new cc("Invalid byte value in IP address");e[i]=r}),e},u5e=function(n){let e=0;n=n.toString().trim();const t=n.split(":",8);let i;for(i=0;i<t.length;i++){const s=pu(t[i]);let o;s&&(o=qJ(t[i]),t[i]=Vt(o.subarray(0,2),"base16")),o!=null&&++i<8&&t.splice(i,0,Vt(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(i=0;i<t.length&&t[i]!=="";i++);const s=[i,1];for(i=9-t.length;i>0;i--)s.push("0");t.splice.apply(t,s)}const r=new Uint8Array(e+16);for(i=0;i<t.length;i++){t[i]===""&&(t[i]="0");const s=parseInt(t[i],16);if(isNaN(s)||s<0||s>65535)throw new cc("Invalid byte value in IP address");r[e++]=s>>8&255,r[e++]=s&255}return r},h5e=function(n){if(n.byteLength!==4)throw new cc("IPv4 address was incorrect length");const e=[];for(let t=0;t<n.byteLength;t++)e.push(n[t]);return e.join(".")},d5e=function(n){if(n.byteLength!==16)throw new cc("IPv6 address was incorrect length");const e=[];for(let i=0;i<n.byteLength;i+=2){const r=n[i],s=n[i+1],o=`${r.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const i=new URL(`http://[${t}]`);return i.hostname.substring(1,i.hostname.length-1)}catch{throw new cc(`Invalid IPv6 address "${t}"`)}};function f5e(n){try{const e=new URL(`http://[${n}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new cc(`Invalid IPv6 address "${n}"`)}}const iC=Object.values($m).map(n=>n.decoder),p5e=function(){let n=iC[0].or(iC[1]);return iC.slice(2).forEach(e=>n=n.or(e)),n}();function m5e(n){return p5e.decode(n)}function g5e(n){return e=>n.encoder.encode(e)}function y5e(n){if(parseInt(n).toString()!==n)throw new Eb("Value must be an integer")}function x5e(n){if(n<0)throw new Eb("Value must be a positive integer, or zero")}function v5e(n){return e=>{if(e>n)throw new Eb(`Value must be smaller than or equal to ${n}`)}}function b5e(...n){return e=>{for(const t of n)t(e)}}const N4=b5e(y5e,x5e,v5e(65535)),To=-1;let _5e=class{constructor(){E(this,"protocolsByCode",new Map);E(this,"protocolsByName",new Map)}getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new S4e(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(i=>{this.protocolsByName.delete(i)}))}};const dx=new _5e,w5e=[{code:E4e,name:"ip4",size:32,valueToBytes:qJ,bytesToValue:h5e,validate:n=>{if(!pu(n))throw new Eb(`Invalid IPv4 address "${n}"`)}},{code:T4e,name:"tcp",size:16,valueToBytes:oy,bytesToValue:n3,validate:N4},{code:A4e,name:"udp",size:16,valueToBytes:oy,bytesToValue:n3,validate:N4},{code:C4e,name:"dccp",size:16,valueToBytes:oy,bytesToValue:n3,validate:N4},{code:M4e,name:"ip6",size:128,valueToBytes:u5e,bytesToValue:d5e,stringToValue:f5e,validate:n=>{if(!G0(n))throw new Eb(`Invalid IPv6 address "${n}"`)}},{code:R4e,name:"ip6zone",size:To},{code:I4e,name:"ipcidr",size:8,bytesToValue:sj("base10"),valueToBytes:oj("base10")},{code:N4e,name:"dns",size:To},{code:P4e,name:"dns4",size:To},{code:k4e,name:"dns6",size:To},{code:L4e,name:"dnsaddr",size:To},{code:D4e,name:"sctp",size:16,valueToBytes:oy,bytesToValue:n3,validate:N4},{code:O4e,name:"udt"},{code:B4e,name:"utp"},{code:U4e,name:"unix",size:To,stringToValue:n=>decodeURIComponent(n),valueToString:n=>encodeURIComponent(n)},{code:h8,name:"p2p",aliases:["ipfs"],size:To,bytesToValue:sj("base58btc"),valueToBytes:n=>n.startsWith("Q")||n.startsWith("1")?oj("base58btc")(n):Fi.parse(n).multihash.bytes},{code:F4e,name:"onion",size:96,bytesToValue:aj,valueToBytes:l5e},{code:z4e,name:"onion3",size:296,bytesToValue:aj,valueToBytes:c5e},{code:j4e,name:"garlic64",size:To},{code:V4e,name:"garlic32",size:To},{code:H4e,name:"tls"},{code:$4e,name:"sni",size:To},{code:G4e,name:"noise"},{code:W4e,name:"quic"},{code:K4e,name:"quic-v1"},{code:q4e,name:"webtransport"},{code:Z4e,name:"certhash",size:To,bytesToValue:g5e(V0),valueToBytes:m5e},{code:Y4e,name:"http"},{code:X4e,name:"http-path",size:To,stringToValue:n=>`/${decodeURIComponent(n)}`,valueToString:n=>encodeURIComponent(n.substring(1))},{code:Q4e,name:"https"},{code:J4e,name:"ws"},{code:e5e,name:"wss"},{code:t5e,name:"p2p-websocket-star"},{code:n5e,name:"p2p-stardust"},{code:i5e,name:"p2p-webrtc-star"},{code:r5e,name:"p2p-webrtc-direct"},{code:s5e,name:"webrtc-direct"},{code:o5e,name:"webrtc"},{code:YL,name:"p2p-circuit"},{code:a5e,name:"memory",size:To}];w5e.forEach(n=>{dx.addProtocol(n)});function S5e(n){const e=[];let t=0;for(;t<n.length;){const i=$0(n,t),r=dx.getProtocol(i),s=nr(i),o=C5e(r,n,t+s);let a=0;o>0&&r.size===To&&(a=nr(o));const l=s+a+o,c={code:i,name:r.name,bytes:n.subarray(t,t+l)};if(o>0){const u=t+s+a,h=n.subarray(u,u+o);c.value=r.bytesToValue?.(h)??Vt(h)}e.push(c),t+=l}return e}function E5e(n){let e=0;const t=[];for(const i of n){if(i.bytes==null){const r=dx.getProtocol(i.code),s=nr(i.code);let o,a=0,l=0;i.value!=null&&(o=r.valueToBytes?.(i.value)??Ut(i.value),a=o.byteLength,r.size===To&&(l=nr(a)));const c=new Uint8Array(s+l+a);let u=0;M0(i.code,c,u),u+=s,o!=null&&(r.size===To&&(M0(a,c,u),u+=l),c.set(o,u)),i.bytes=c}t.push(i.bytes),e+=i.bytes.byteLength}return Ms(t,e)}function T5e(n){if(n.charAt(0)!=="/")throw new cc('String multiaddr must start with "/"');const e=[];let t="protocol",i="",r="";for(let s=1;s<n.length;s++){const o=n.charAt(s);o!=="/"&&(t==="protocol"?r+=n.charAt(s):i+=n.charAt(s));const a=s===n.length-1;if(o==="/"||a){const l=dx.getProtocol(r);if(t==="protocol"){if(l.size==null||l.size===0){e.push({code:l.code,name:l.name}),i="",r="",t="protocol";continue}else if(a)throw new cc(`Component ${r} was missing value`);t="value"}else if(t==="value"){const c={code:l.code,name:l.name};if(l.size!=null&&l.size!==0){if(i==="")throw new cc(`Component ${r} was missing value`);c.value=l.stringToValue?.(i)??i}e.push(c),i="",r="",t="protocol"}}}if(r!==""&&i!=="")throw new cc("Incomplete multiaddr");return e}function A5e(n){return`/${n.flatMap(e=>{if(e.value==null)return e.name;const t=dx.getProtocol(e.code);if(t==null)throw new cc(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function C5e(n,e,t){return n.size==null||n.size===0?0:n.size>0?n.size/8:$0(e,t)}const M5e=Symbol.for("nodejs.util.inspect.custom"),ZJ=Symbol.for("@multiformats/multiaddr");function R5e(n){if(n==null&&(n="/"),N5e(n))return n.getComponents();if(n instanceof Uint8Array)return S5e(n);if(typeof n=="string")return n=n.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),n===""&&(n="/"),T5e(n);if(Array.isArray(n))return n;throw new cc("Must be a string, Uint8Array, Component[], or another Multiaddr")}var _Fe,Gc,Yy,Xy;const my=class my{constructor(e="/",t={}){E(this,_Fe,!0);$t(this,Gc,void 0);$t(this,Yy,void 0);$t(this,Xy,void 0);On(this,Gc,R5e(e)),t.validate!==!1&&I5e(this)}get bytes(){return ze(this,Xy)==null&&On(this,Xy,E5e(ze(this,Gc))),ze(this,Xy)}toString(){return ze(this,Yy)==null&&On(this,Yy,A5e(ze(this,Gc))),ze(this,Yy)}toJSON(){return this.toString()}getComponents(){return[...ze(this,Gc).map(e=>({...e}))]}encapsulate(e){const t=new my(e);return new my([...ze(this,Gc),...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),i=this.toString(),r=i.lastIndexOf(t);if(r<0)throw new KJ(`Address ${this.toString()} does not contain subaddress: ${t}`);return new my(i.slice(0,r),{validate:!1})}decapsulateCode(e){let t;for(let i=ze(this,Gc).length-1;i>-1;i--)if(ze(this,Gc)[i].code===e){t=i;break}return new my(ze(this,Gc).slice(0,t),{validate:!1})}equals(e){return li(this.bytes,e.bytes)}[(_Fe=ZJ,M5e)](){return`Multiaddr(${this.toString()})`}};Gc=new WeakMap,Yy=new WeakMap,Xy=new WeakMap;let tN=my;function I5e(n){n.getComponents().forEach(e=>{const t=dx.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}function N5e(n){return!!n?.[ZJ]}function b0(n){return new tN(n)}const P5e=4194304;class nN extends Error{constructor(){super(...arguments);E(this,"name","UnwrappedError")}}E(nN,"name","UnwrappedError");class k5e extends Error{constructor(){super(...arguments);E(this,"name","InvalidMessageLengthError");E(this,"code","ERR_INVALID_MSG_LENGTH")}}class L5e extends Error{constructor(){super(...arguments);E(this,"name","InvalidDataLengthError");E(this,"code","ERR_MSG_DATA_TOO_LONG")}}class D5e extends Error{constructor(){super(...arguments);E(this,"name","InvalidDataLengthLengthError");E(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}function O5e(n){return typeof n?.closeRead=="function"}function B5e(n){return typeof n?.close=="function"}function rC(n){return O5e(n)?n.remoteWriteStatus!=="writable"&&n.readBufferLength===0:B5e(n)?n.status!=="open":!1}function U5e(n){return n?.addEventListener!=null&&n?.removeEventListener!=null&&n?.send!=null&&n?.push!=null&&n?.log!=null}function F5e(n,e){const t=e?.maxBufferSize??P5e,i=new Zn;let r,s=!1;if(!U5e(n))throw new L_("Argument should be a Stream or a Multiaddr");const o=u=>{if(i.append(u.data),i.byteLength>t){const h=i.byteLength;i.consume(i.byteLength),r?.reject(new Error(`Read buffer overflow - ${h} > ${t}`))}r?.resolve()};n.addEventListener("message",o);const a=u=>{u.error!=null?r?.reject(u.error):r?.resolve()};n.addEventListener("close",a);const l=()=>{r?.resolve()};n.addEventListener("remoteCloseWrite",l);const c={readBuffer:i,async read(u){if(s===!0)throw new nN("Stream was unwrapped");if(rC(n)){if(u?.bytes==null)return null;if(i.byteLength<u.bytes)throw n.log.error("closed after reading %d/%d bytes",i.byteLength,u.bytes),new Sb(`Unexpected EOF - stream closed after reading ${i.byteLength}/${u.bytes} bytes`)}const h=u?.bytes??1;for(r=Promise.withResolvers();;){if(i.byteLength>=h){r.resolve();break}if(await ZL(r.promise,u?.signal),rC(n)){if(i.byteLength===0&&u?.bytes==null)return null;break}r=Promise.withResolvers()}const p=u?.bytes??i.byteLength;if(i.byteLength<p){if(rC(n))throw n.log.error("closed while reading %d/%d bytes",i.byteLength,p),new Sb(`Unexpected EOF - stream closed while reading ${i.byteLength}/${p} bytes`);return c.read(u)}const m=i.sublist(0,p);return i.consume(p),m},async write(u,h){if(s===!0)throw new nN("Stream was unwrapped");n.send(u)||await Ry(n,"drain",{signal:h?.signal,rejectionEvents:["close"]})},unwrap(){return s||(s=!0,n.removeEventListener("message",o),n.removeEventListener("close",a),n.removeEventListener("remoteCloseWrite",l),i.byteLength>0&&(n.log("stream unwrapped with %d unread bytes",i.byteLength),n.push(i))),n}};return c}function z5e(n,e={}){const t=F5e(n,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=nr(e.maxDataLength));const i=e?.lengthDecoder??$0,r=e?.lengthEncoder??Za;return{async read(o){let a=-1;const l=new Zn;for(;;){const u=await t.read({...o,bytes:1});if(u==null)break;l.append(u);try{a=i(l)}catch(h){if(h instanceof RangeError)continue;throw h}if(a<0)throw new k5e("Invalid message length");if(e?.maxLengthLength!=null&&l.byteLength>e.maxLengthLength)throw new D5e(`Message length length too long - ${l.byteLength} > ${e.maxLengthLength}`);if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new L5e(`Message length too long - ${a} > ${e.maxDataLength}`);const c=await t.read({...o,bytes:a});if(c==null)throw n.log.error("tried to read %d bytes but the stream closed",a),new Sb(`Unexpected EOF - tried to read ${a} bytes but the stream closed`);if(c.byteLength!==a)throw n.log.error("read %d/%d bytes before the stream closed",c.byteLength,a),new Sb(`Unexpected EOF - read ${c.byteLength}/${a} bytes before the stream closed`);return c},async write(o,a){await t.write(new Zn(r(o.byteLength),o),a)},async writeV(o,a){const l=new Zn(...o.flatMap(c=>[r(c.byteLength),c]));await t.write(l,a)},unwrap(){return t.unwrap()}}}function iN(n,e){const t=z5e(n,e),i={read:async(r,s)=>{const o=await t.read(s);return r.decode(o)},write:async(r,s,o)=>{await t.write(s.encode(r),o)},writeV:async(r,s,o)=>{await t.writeV(r.map(a=>s.encode(a)),o)},pb:r=>({read:async s=>i.read(r,s),write:async(s,o)=>i.write(s,r,o),writeV:async(s,o)=>i.writeV(s,r,o),unwrap:()=>i}),unwrap:()=>t.unwrap()};return i}class YJ extends v4e{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}class Jm extends Error{constructor(){super(...arguments);E(this,"name","InvalidMultiaddrError")}}E(Jm,"name","InvalidMultiaddrError");class U2 extends Error{constructor(){super(...arguments);E(this,"name","ValidationError")}}E(U2,"name","ValidationError");class XJ extends Error{constructor(){super(...arguments);E(this,"name","UnknownProtocolError")}}E(XJ,"name","UnknownProtocolError");const QJ=4,JJ=6,eee=273,j5e=33,tee=41,nee=42,XL=43,iee=53,ree=54,see=55,oee=56,V5e=132,H5e=301,$5e=302,G5e=400,wl=421,W5e=444,K5e=445,q5e=446,Z5e=447,aee=448,lee=449,Y5e=454,cee=460,uee=461,hee=465,Tb=466,X5e=480,Q5e=481,J5e=443,QL=477,dee=478,eSe=479,tSe=277,nSe=275,iSe=276,fee=280,pee=281,mee=290,rSe=777;function lj(n){return e=>Vt(e,n)}function cj(n){return e=>Ut(e,n)}function i3(n){return new DataView(n.buffer).getUint16(n.byteOffset).toString()}function ay(n){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof n=="string"?parseInt(n):n),new Uint8Array(e)}function sSe(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ut(e[0],"base32"),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const r=ay(i);return Ms([t,r],t.length+r.length)}function oSe(n){const e=n.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=oh.decode(`b${e[0]}`),i=parseInt(e[1],10);if(i<1||i>65536)throw new Error("Port number is not in range(1, 65536)");const r=ay(i);return Ms([t,r],t.length+r.length)}function uj(n){const e=n.subarray(0,n.length-2),t=n.subarray(n.length-2),i=Vt(e,"base32"),r=i3(t);return`${i}:${r}`}const gee=function(n){n=n.toString().trim();const e=new Uint8Array(4);return n.split(/\./g).forEach((t,i)=>{const r=parseInt(t,10);if(isNaN(r)||r<0||r>255)throw new Jm("Invalid byte value in IP address");e[i]=r}),e},aSe=function(n){let e=0;n=n.toString().trim();const t=n.split(":",8);let i;for(i=0;i<t.length;i++){const s=pu(t[i]);let o;s&&(o=gee(t[i]),t[i]=Vt(o.subarray(0,2),"base16")),o!=null&&++i<8&&t.splice(i,0,Vt(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(i=0;i<t.length&&t[i]!=="";i++);const s=[i,1];for(i=9-t.length;i>0;i--)s.push("0");t.splice.apply(t,s)}const r=new Uint8Array(e+16);for(i=0;i<t.length;i++){t[i]===""&&(t[i]="0");const s=parseInt(t[i],16);if(isNaN(s)||s<0||s>65535)throw new Jm("Invalid byte value in IP address");r[e++]=s>>8&255,r[e++]=s&255}return r},lSe=function(n){if(n.byteLength!==4)throw new Jm("IPv4 address was incorrect length");const e=[];for(let t=0;t<n.byteLength;t++)e.push(n[t]);return e.join(".")},cSe=function(n){if(n.byteLength!==16)throw new Jm("IPv6 address was incorrect length");const e=[];for(let i=0;i<n.byteLength;i+=2){const r=n[i],s=n[i+1],o=`${r.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const i=new URL(`http://[${t}]`);return i.hostname.substring(1,i.hostname.length-1)}catch{throw new Jm(`Invalid IPv6 address "${t}"`)}};function uSe(n){try{const e=new URL(`http://[${n}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new Jm(`Invalid IPv6 address "${n}"`)}}const sC=Object.values($m).map(n=>n.decoder),hSe=function(){let n=sC[0].or(sC[1]);return sC.slice(2).forEach(e=>n=n.or(e)),n}();function dSe(n){return hSe.decode(n)}function fSe(n){return e=>n.encoder.encode(e)}function pSe(n){if(parseInt(n).toString()!==n)throw new U2("Value must be an integer")}function mSe(n){if(n<0)throw new U2("Value must be a positive integer, or zero")}function gSe(n){return e=>{if(e>n)throw new U2(`Value must be smaller than or equal to ${n}`)}}function ySe(...n){return e=>{for(const t of n)t(e)}}const P4=ySe(pSe,mSe,gSe(65535)),ul=-1;class xSe{constructor(){E(this,"protocolsByCode",new Map);E(this,"protocolsByName",new Map)}getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new XJ(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(i=>{this.protocolsByName.delete(i)}))}}const vSe=new xSe,bSe=[{code:QJ,name:"ip4",size:32,valueToBytes:gee,bytesToValue:lSe,validate:n=>{if(!pu(n))throw new U2(`Invalid IPv4 address "${n}"`)}},{code:JJ,name:"tcp",size:16,valueToBytes:ay,bytesToValue:i3,validate:P4},{code:eee,name:"udp",size:16,valueToBytes:ay,bytesToValue:i3,validate:P4},{code:j5e,name:"dccp",size:16,valueToBytes:ay,bytesToValue:i3,validate:P4},{code:tee,name:"ip6",size:128,valueToBytes:aSe,bytesToValue:cSe,stringToValue:uSe,validate:n=>{if(!G0(n))throw new U2(`Invalid IPv6 address "${n}"`)}},{code:nee,name:"ip6zone",size:ul},{code:XL,name:"ipcidr",size:8,bytesToValue:lj("base10"),valueToBytes:cj("base10")},{code:iee,name:"dns",size:ul},{code:ree,name:"dns4",size:ul},{code:see,name:"dns6",size:ul},{code:oee,name:"dnsaddr",size:ul},{code:V5e,name:"sctp",size:16,valueToBytes:ay,bytesToValue:i3,validate:P4},{code:H5e,name:"udt"},{code:$5e,name:"utp"},{code:G5e,name:"unix",size:ul,stringToValue:n=>decodeURIComponent(n),valueToString:n=>encodeURIComponent(n)},{code:wl,name:"p2p",aliases:["ipfs"],size:ul,bytesToValue:lj("base58btc"),valueToBytes:n=>n.startsWith("Q")||n.startsWith("1")?cj("base58btc")(n):Fi.parse(n).multihash.bytes},{code:W5e,name:"onion",size:96,bytesToValue:uj,valueToBytes:sSe},{code:K5e,name:"onion3",size:296,bytesToValue:uj,valueToBytes:oSe},{code:q5e,name:"garlic64",size:ul},{code:Z5e,name:"garlic32",size:ul},{code:aee,name:"tls"},{code:lee,name:"sni",size:ul},{code:Y5e,name:"noise"},{code:cee,name:"quic"},{code:uee,name:"quic-v1"},{code:hee,name:"webtransport"},{code:Tb,name:"certhash",size:ul,bytesToValue:fSe(V0),valueToBytes:dSe},{code:X5e,name:"http"},{code:Q5e,name:"http-path",size:ul,stringToValue:n=>`/${decodeURIComponent(n)}`,valueToString:n=>encodeURIComponent(n.substring(1))},{code:J5e,name:"https"},{code:QL,name:"ws"},{code:dee,name:"wss"},{code:eSe,name:"p2p-websocket-star"},{code:tSe,name:"p2p-stardust"},{code:nSe,name:"p2p-webrtc-star"},{code:iSe,name:"p2p-webrtc-direct"},{code:fee,name:"webrtc-direct"},{code:pee,name:"webrtc"},{code:mee,name:"p2p-circuit"},{code:rSe,name:"memory",size:ul}];bSe.forEach(n=>{vSe.addProtocol(n)});const dc=n=>({match:e=>{const t=e[0];return t==null||t.code!==n||t.value!=null?!1:e.slice(1)}}),or=(n,e)=>({match:t=>{const i=t[0];return i?.code!==n||i.value==null||e!=null&&i.value!==e?!1:t.slice(1)}}),_Se=n=>({match:e=>n.match(e)===!1?e:!1}),gs=n=>({match:e=>{const t=n.match(e);return t===!1?e:t}}),w1=(...n)=>({match:e=>{let t;for(const i of n){const r=i.match(e);r!==!1&&(t==null||r.length<t.length)&&(t=r)}return t??!1}}),Bo=(...n)=>({match:e=>{for(const t of n){const i=t.match(e);if(i===!1)return!1;e=i}return e}});function n9(...n){function e(r){if(r==null)return!1;let s=r.getComponents();for(const o of n){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(r){return e(r)!==!1}function i(r){const s=e(r);return s===!1?!1:s.length===0}return{matchers:n,matches:t,exactMatch:i}}const wSe=or(ree),SSe=or(see),ESe=or(oee),TSe=or(iee),ASe=Bo(or(QJ),gs(or(XL))),CSe=Bo(gs(or(nee)),or(tee),gs(or(XL))),MSe=w1(ASe,CSe),i9=w1(MSe,TSe,wSe,SSe,ESe),yee=Bo(i9,or(JJ)),r9=Bo(i9,or(eee)),xee=Bo(r9,dc(cee),gs(or(wl))),JL=Bo(r9,dc(uee),gs(or(wl))),RSe=w1(xee,JL),rN=w1(i9,yee,r9,xee,JL),ISe=w1(Bo(rN,dc(QL),gs(or(wl)))),NSe=w1(Bo(rN,dc(dee),gs(or(wl))),Bo(rN,dc(aee),gs(or(lee)),dc(QL),gs(or(wl)))),PSe=Bo(r9,dc(fee),gs(or(Tb)),gs(or(Tb)),gs(or(wl))),kSe=Bo(JL,dc(hee),gs(or(Tb)),gs(or(Tb)),gs(or(wl))),vee=w1(ISe,NSe,Bo(yee,gs(or(wl))),Bo(RSe,gs(or(wl))),Bo(i9,gs(or(wl))),PSe,kSe,or(wl)),LSe=n9(vee),DSe=Bo(gs(vee),dc(mee),_Se(dc(pee)),gs(or(wl))),bee=n9(DSe),OSe=1,_ee=5e3,BSe=100,k4=`${zbe}-circuit-relay`;BigInt(1<<17);const d8="/libp2p/circuit/relay/0.2.0/hop",hj="/libp2p/circuit/relay/0.2.0/stop",dj=300,USe=4096,FSe=.001;var F2;(function(n){(function(i){i.RESERVE="RESERVE",i.CONNECT="CONNECT",i.STATUS="STATUS"})(n.Type||(n.Type={}));let e;(function(i){i[i.RESERVE=0]="RESERVE",i[i.CONNECT=1]="CONNECT",i[i.STATUS=2]="STATUS"})(e||(e={})),function(i){i.codec=()=>t9(e)}(n.Type||(n.Type={}));let t;n.codec=()=>(t==null&&(t=$d((i,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),i.type!=null&&(r.uint32(8),n.Type.codec().encode(i.type,r)),i.peer!=null&&(r.uint32(18),z2.codec().encode(i.peer,r)),i.reservation!=null&&(r.uint32(26),f8.codec().encode(i.reservation,r)),i.limit!=null&&(r.uint32(34),j2.codec().encode(i.limit,r)),i.status!=null&&(r.uint32(40),la.codec().encode(i.status,r)),s.lengthDelimited!==!1&&r.ldelim()},(i,r,s={})=>{const o={},a=r==null?i.len:i.pos+r;for(;i.pos<a;){const l=i.uint32();switch(l>>>3){case 1:{o.type=n.Type.codec().decode(i);break}case 2:{o.peer=z2.codec().decode(i,i.uint32(),{limits:s.limits?.peer});break}case 3:{o.reservation=f8.codec().decode(i,i.uint32(),{limits:s.limits?.reservation});break}case 4:{o.limit=j2.codec().decode(i,i.uint32(),{limits:s.limits?.limit});break}case 5:{o.status=la.codec().decode(i);break}default:{i.skipType(l&7);break}}}return o})),t),n.encode=i=>Hd(i,n.codec()),n.decode=(i,r)=>Vd(i,n.codec(),r)})(F2||(F2={}));var Xh;(function(n){(function(i){i.CONNECT="CONNECT",i.STATUS="STATUS"})(n.Type||(n.Type={}));let e;(function(i){i[i.CONNECT=0]="CONNECT",i[i.STATUS=1]="STATUS"})(e||(e={})),function(i){i.codec=()=>t9(e)}(n.Type||(n.Type={}));let t;n.codec=()=>(t==null&&(t=$d((i,r,s={})=>{s.lengthDelimited!==!1&&r.fork(),i.type!=null&&(r.uint32(8),n.Type.codec().encode(i.type,r)),i.peer!=null&&(r.uint32(18),z2.codec().encode(i.peer,r)),i.limit!=null&&(r.uint32(26),j2.codec().encode(i.limit,r)),i.status!=null&&(r.uint32(32),la.codec().encode(i.status,r)),s.lengthDelimited!==!1&&r.ldelim()},(i,r,s={})=>{const o={},a=r==null?i.len:i.pos+r;for(;i.pos<a;){const l=i.uint32();switch(l>>>3){case 1:{o.type=n.Type.codec().decode(i);break}case 2:{o.peer=z2.codec().decode(i,i.uint32(),{limits:s.limits?.peer});break}case 3:{o.limit=j2.codec().decode(i,i.uint32(),{limits:s.limits?.limit});break}case 4:{o.status=la.codec().decode(i);break}default:{i.skipType(l&7);break}}}return o})),t),n.encode=i=>Hd(i,n.codec()),n.decode=(i,r)=>Vd(i,n.codec(),r)})(Xh||(Xh={}));var z2;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.id!=null&&t.id.byteLength>0&&(i.uint32(10),i.bytes(t.id)),t.addrs!=null)for(const s of t.addrs)i.uint32(18),i.bytes(s);r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={id:qn(0),addrs:[]},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.id=t.bytes();break}case 2:{if(r.limits?.addrs!=null&&s.addrs.length===r.limits.addrs)throw new OJ('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(z2||(z2={}));var f8;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.expire!=null&&t.expire!==0n&&(i.uint32(8),i.uint64(t.expire)),t.addrs!=null)for(const s of t.addrs)i.uint32(18),i.bytes(s);t.voucher!=null&&(i.uint32(26),m8.codec().encode(t.voucher,i)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={expire:0n,addrs:[]},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.expire=t.uint64();break}case 2:{if(r.limits?.addrs!=null&&s.addrs.length===r.limits.addrs)throw new OJ('Decode error - map field "addrs" had too many elements');s.addrs.push(t.bytes());break}case 3:{s.voucher=m8.codec().decode(t,t.uint32(),{limits:r.limits?.voucher});break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(f8||(f8={}));var j2;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.duration!=null&&(i.uint32(8),i.uint32(t.duration)),t.data!=null&&(i.uint32(16),i.uint64(t.data)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.duration=t.uint32();break}case 2:{s.data=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(j2||(j2={}));var la;(function(n){n.UNUSED="UNUSED",n.OK="OK",n.RESERVATION_REFUSED="RESERVATION_REFUSED",n.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",n.PERMISSION_DENIED="PERMISSION_DENIED",n.CONNECTION_FAILED="CONNECTION_FAILED",n.NO_RESERVATION="NO_RESERVATION",n.MALFORMED_MESSAGE="MALFORMED_MESSAGE",n.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(la||(la={}));var sN;(function(n){n[n.UNUSED=0]="UNUSED",n[n.OK=100]="OK",n[n.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",n[n.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",n[n.PERMISSION_DENIED=202]="PERMISSION_DENIED",n[n.CONNECTION_FAILED=203]="CONNECTION_FAILED",n[n.NO_RESERVATION=204]="NO_RESERVATION",n[n.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",n[n.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(sN||(sN={}));(function(n){n.codec=()=>t9(sN)})(la||(la={}));var p8;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.relay!=null&&t.relay.byteLength>0&&(i.uint32(10),i.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(i.uint32(18),i.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(i.uint32(24),i.uint64(t.expiration)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={relay:qn(0),peer:qn(0),expiration:0n},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.relay=t.bytes();break}case 2:{s.peer=t.bytes();break}case 3:{s.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(p8||(p8={}));var m8;(function(n){let e;n.codec=()=>(e==null&&(e=$d((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(i.uint32(10),i.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(i.uint32(18),i.bytes(t.payloadType)),t.payload!=null&&(i.uint32(26),p8.codec().encode(t.payload,i)),t.signature!=null&&t.signature.byteLength>0&&(i.uint32(42),i.bytes(t.signature)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={publicKey:qn(0),payloadType:qn(0),signature:qn(0)},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=p8.codec().decode(t,t.uint32(),{limits:r.limits?.payload});break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Hd(t,n.codec()),n.decode=(t,i)=>Vd(t,n.codec(),i)})(m8||(m8={}));class oN extends Error{constructor(){super(...arguments);E(this,"name","HadEnoughRelaysError")}}E(oN,"name","HadEnoughRelaysError");class wee extends Error{constructor(){super(...arguments);E(this,"name","DoubleRelayError")}}E(wee,"name","DoubleRelayError");class See extends Error{constructor(){super(...arguments);E(this,"name","RelayQueueFullError")}}E(See,"name","RelayQueueFullError");function fj(n){const e=n*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class pj{constructor(e){E(this,"expires");E(this,"bytes");e?.duration!=null&&e?.duration!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e?.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const Eee=n9(Bo(LSe.matchers[0],dc(YL))),Tee=n9(dc(YL));function oC(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const i=n.next(),r=i.value;return i.done===!0||r==null?{done:!0,value:void 0}:{done:!1,value:e(r)}}};return t}class zSe{constructor(e){E(this,"map");if(this.map=new Map,e!=null)for(const[t,i]of e.entries())this.map.set(t.toString(),{key:t,value:i})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return oC(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,i)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return oC(this.map.values(),e=>e.key)}values(){return oC(this.map.values(),e=>e.value)}get size(){return this.map.size}}const eD={hash:n=>Number(Wk(n,{size:32})),hashV:(n,e)=>jSe(eD.hash(n,e))};function jSe(n){let e=n.toString(16);return e.length%2===1&&(e=`0${e}`),Ut(e,"base16")}const Aee=64;class um{constructor(e,t,i,r=2){E(this,"fp");E(this,"h");E(this,"seed");if(r>Aee)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,i),o=qn(r);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=i}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?li(this.fp,e.fp):!1}}function g8(n,e){return Math.floor(Math.random()*(e-n))+n}class L4{constructor(e){E(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof um))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof um))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof um))throw new TypeError("Invalid Fingerprint");const t=g8(0,this.contents.length-1),i=this.contents[t];return this.contents[t]=e,i}remove(e){if(!(e instanceof um))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(i=>e.equals(i));return t>-1?(this.contents[t]=null,!0):!1}}const VSe=500;class mj{constructor(e){E(this,"bucketSize");E(this,"filterSize");E(this,"fingerprintSize");E(this,"buckets");E(this,"count");E(this,"hash");E(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??eD,this.seed=e.seed??g8(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=Ut(e));const t=new um(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=(i^t.hash())%this.filterSize;if(this.buckets[i]==null&&(this.buckets[i]=new L4(this.bucketSize)),this.buckets[r]==null&&(this.buckets[r]=new L4(this.bucketSize)),this.buckets[i].add(t)||this.buckets[r].add(t))return this.count++,!0;const s=[i,r];let o=s[g8(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new L4(this.bucketSize));for(let a=0;a<VSe;a++){const l=this.buckets[o].swap(t);if(l!=null&&(o=(o^l.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new L4(this.bucketSize)),this.buckets[o].add(l)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=Ut(e));const t=new um(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=this.buckets[i]?.has(t)??!1;if(r)return r;const s=(i^t.hash())%this.filterSize;return this.buckets[s]?.has(t)??!1}remove(e){typeof e=="string"&&(e=Ut(e));const t=new um(e,this.hash,this.seed,this.fingerprintSize),i=this.hash.hash(e,this.seed)%this.filterSize,r=this.buckets[i]?.remove(t)??!1;if(r)return this.count--,r;const s=(i^t.hash())%this.filterSize,o=this.buckets[s]?.remove(t)??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const HSe={1:.5,2:.84,4:.95,8:.98};function $Se(n=.001){return n>.002?2:n>1e-5?4:8}function GSe(n,e=.001){const t=$Se(e),i=HSe[t],r=Math.round(n/i),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),Aee);return{filterSize:r,bucketSize:t,fingerprintSize:s}}class WSe{constructor(e){E(this,"filterSize");E(this,"bucketSize");E(this,"fingerprintSize");E(this,"scale");E(this,"filterSeries");E(this,"hash");E(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??eD,this.seed=e.seed??g8(0,Math.pow(2,10)),this.filterSeries=[new mj({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=Ut(e)),this.has(e))return!0;let t=this.filterSeries.find(i=>i.reliable);if(t==null){const i=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new mj({filterSize:i,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=Ut(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=Ut(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function KSe(n,e=.001,t){return new WSe({...GSe(n,e),...t??{}})}class qSe{constructor(e,t){E(this,"filter");this.filter=KSe(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}}function ZSe(n,e=.001){return new qSe(n,e)}class YSe extends f1{constructor(t,i={}){super();E(this,"components");E(this,"started");E(this,"running");E(this,"topologyId");E(this,"log");E(this,"discoveryController");E(this,"filter");E(this,"queue");this.log=t.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=t,this.started=!1,this.running=!1,this.filter=i.filter,this.discoveryController=new AbortController,this.discoveryController.signal,this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}async start(){this.topologyId=await this.components.registrar.register(d8,{filter:this.filter,onConnect:t=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",t,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:t})}}),this.started=!0}stop(){this.topologyId!=null&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(async()=>{this.log("searching peer store for relays");const t=await this.components.peerStore.all({filters:[r=>r.protocols.includes(d8)],orders:[()=>Math.random()<.5?1:-1,(r,s)=>{const o=gj(r),a=gj(s);return o>a?-1:a>o?1:0}]});for(const r of t)this.log.trace("found relay peer %p in peer store",r.id),this.safeDispatchEvent("relay:discover",{detail:r.id});this.log("found %d relay peers in peer store",t.length);const i=this.queue=new YJ({concurrency:5});this.log("start random walk");for await(const r of this.components.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",r.id),i.has(r.id)){this.log.trace("random peer %p was already in queue",r.id);continue}if(this.components.connectionManager.getConnections(r.id)?.length>0){this.log.trace("random peer %p was already connected",r.id);continue}if(!await this.components.connectionManager.isDialable(r.multiaddrs)){this.log.trace("random peer %p was not dialable",r.id,r.multiaddrs.map(s=>s.toString()));continue}i.queued>10&&(this.log.trace("wait for space in queue for %p",r.id),await i.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",r.id,i.size,i.running),i.add(this.dialPeer,{peerId:r.id,signal:this.discoveryController.signal}).catch(s=>{this.log.error("error opening connection to random peer %p - %e",r.id,s)})}this.log("stop random walk"),await i.onIdle()}).catch(t=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network - %e",t)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(t){this.log.trace("maybe dialing discovered peer %p",t.detail.id),this.maybeDialPeer(t).catch(i=>{this.log.trace("error dialing discovered peer %p - %e",t.detail.id,i)})}async maybeDialPeer(t){if(this.queue==null)return;const i=t.detail.id,r=t.detail.multiaddrs;if(this.queue.has(i)){this.log.trace("random peer %p was already in queue",i);return}if(this.components.connectionManager.getConnections(i)?.length>0){this.log.trace("random peer %p was already connected",i);return}if(!await this.components.connectionManager.isDialable(r)){this.log.trace("random peer %p was not dialable",i);return}this.queue?.add(this.dialPeer,{peerId:t.detail.id,signal:this.discoveryController.signal}).catch(s=>{this.log.error("error opening connection to discovered peer %p - %e",t.detail.id,s)})}async dialPeer({peerId:t,signal:i}){const r=N0([AbortSignal.timeout(5e3),i]);try{await this.components.connectionManager.openConnection(t,{signal:r})}finally{r.clear()}}}function gj(n){const e=n.metadata.get("last-dial-success");return e==null?0:new Date(Vt(e)).getTime()}class XSe extends f1{constructor(t,i={}){super();E(this,"connectionManager");E(this,"addressManager");E(this,"reservationStore");E(this,"listeningAddrs");E(this,"log");E(this,"listenTimeout");E(this,"reservationId");E(this,"relay");E(this,"_onRemoveRelayPeer",t=>{this.log("relay removed %p our relay %p",t.detail.relay,this.relay,this.relay?.equals(t.detail.relay)),this.relay?.equals(t.detail.relay)===!0&&(this.log("relay peer removed %p",t.detail.relay),this.listeningAddrs.forEach(i=>{this.addressManager.removeObservedAddr(i)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))});E(this,"_onAddRelayPeer",t=>{const{details:i}=t.detail;i.type!=="configured"&&i.id===this.reservationId&&this.addedRelay(t.detail)});this.log=t.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=t.connectionManager,this.addressManager=t.addressManager,this.reservationStore=t.reservationStore,this.listeningAddrs=[],this.listenTimeout=i.listenTimeout??_ee,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}async listen(t){if(Tee.exactMatch(t))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(Eee.exactMatch(t)){this.log("listen on specific relay server %a",t);const i=AbortSignal.timeout(this.listenTimeout),r=t.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(r,{signal:i});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const o=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(o)}}else throw new i8(`Could not listen on p2p-circuit address "${t}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(t){this.log("relay peer added %p",t.relay),this.relay=t.relay,this.listeningAddrs=t.details.reservation.addrs.map(i=>b0(i).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(i=>{this.addressManager.confirmObservedAddr(i,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function QSe(n){return new XSe(n)}const JSe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let e6e=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=JSe[t[n]&63];return e};const t6e=60*1e3*10,n6e=60*1e3*5,i6e=30*1e3;var LE,Cee,bm,r3,_m,s3;class r6e extends f1{constructor(t,i){super();$t(this,LE);$t(this,bm);$t(this,_m);E(this,"peerId");E(this,"connectionManager");E(this,"peerStore");E(this,"events");E(this,"reserveQueue");E(this,"reservations");E(this,"pendingReservations");E(this,"maxReservationQueueLength");E(this,"reservationCompletionTimeout");E(this,"started");E(this,"log");E(this,"relayFilter");this.log=t.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=t.peerId,this.connectionManager=t.connectionManager,this.peerStore=t.peerStore,this.events=t.events,this.reservations=new zSe,this.pendingReservations=[],this.maxReservationQueueLength=i?.maxReservationQueueLength??BSe,this.reservationCompletionTimeout=i?.reservationCompletionTimeout??_ee,this.started=!1,this.relayFilter=ij(100),this.reserveQueue=new YJ({concurrency:i?.reservationConcurrency??OSe,metricName:"libp2p_relay_reservation_queue",metrics:t.metrics}),this.events.addEventListener("connection:close",r=>{[...this.reservations.values()].find(o=>o.connection===r.detail.id)!=null&&rn(this,bm,r3).call(this,r.detail.remotePeer).catch(o=>{this.log("could not remove relay %p - %e",r.detail,o)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const t=await this.peerStore.all({filters:[i=>i.tags.has(k4)]});this.log("removing tag from %d old relays",t.length),await Promise.all(t.map(async i=>{await this.peerStore.merge(i.id,{tags:{[k4]:void 0}})})),this.log("redialing %d old relays",t.length),await Promise.all(t.map(async i=>this.addRelay(i.id,"discovered"))),rn(this,_m,s3).call(this)}).catch(t=>{this.log.error("failed to clean up and redial old relays during afterStart - %e",t)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:t})=>{clearTimeout(t)}),this.reservations.clear(),this.started=!1}reserveRelay(){const t=e6e();return this.pendingReservations.push(t),rn(this,_m,s3).call(this),t}async addRelay(t,i){if(this.peerId.equals(t))throw this.log.trace("not trying to use self as relay"),new i8("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new See("The reservation queue is full");const r=this.reserveQueue.find(t);if(r!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",t),r.join();if(this.relayFilter.has(t.toMultihash().bytes))throw new i8("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",t),this.reserveQueue.add(async()=>{const s=Date.now();try{const o=this.reservations.get(t);if(o!=null){const b=this.connectionManager.getConnections(t);let w=!1;if(b.length===0&&this.log("already have relay reservation with %p but we are no longer connected",t),b.map(v=>v.id).includes(o.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",t),w=!0),w&&fj(o.reservation.expire)>t6e)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",t),{relay:t,details:o};await rn(this,bm,r3).call(this,t)}if(i==="discovered"&&this.pendingReservations.length===0)throw new oN("Not making reservation on discovered relay because we do not need any more relays");const a=AbortSignal.timeout(this.reservationCompletionTimeout);const l=await this.connectionManager.openConnection(t,{signal:a});if(bee.matches(l.remoteAddr))throw new wee("not creating reservation over relayed connection");const c=await rn(this,LE,Cee).call(this,l,{signal:a}),u=fj(c.expire);this.log("created reservation on relay peer %p, expiry date is %s",t,new Date(Date.now()+u).toString());const h=Math.min(Math.max(u-n6e,i6e),Math.pow(2,31)-1),p=setTimeout(()=>{this.log("refresh reservation to relay %p",t),this.addRelay(t,i).catch(async b=>{this.log.error("could not refresh reservation to relay %p - %e",t,b),await rn(this,bm,r3).call(this,t)}).catch(b=>{this.log.error("could not remove expired reservation to relay %p - %e",t,b)})},h);let m;if(i==="discovered"){const b=this.pendingReservations.pop();if(b==null)throw new oN("Made reservation on relay but did not need any more discovered relays");m={timeout:p,reservation:c,type:i,connection:l.id,id:b}}else m={timeout:p,reservation:c,type:i,connection:l.id};this.reservations.set(t,m),await this.peerStore.merge(t,{tags:{[k4]:{value:1,ttl:u}}}),rn(this,_m,s3).call(this);const y={relay:t,details:m};return this.safeDispatchEvent("relay:created-reservation",{detail:y}),y}catch(o){throw i==="discovered"&&o.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",t,Date.now()-s,o),(o.name==="DialError"||o.name==="UnsupportedProtocolError")&&this.relayFilter.add(t.toMultihash().bytes),rn(this,bm,r3).call(this,t).catch(a=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",t,a)}),o}},{peerId:t})}hasReservation(t){return this.reservations.has(t)}getReservation(t){return this.reservations.get(t)?.reservation}reservationCount(t){return t==null?this.reservations.size:[...this.reservations.values()].reduce((i,r)=>(r.type===t&&i++,i),0)}cancelReservations(){[...this.reservations.values()].forEach(t=>{clearTimeout(t.timeout)}),this.reservations.clear()}}LE=new WeakSet,Cee=async function(t,i){i.signal?.throwIfAborted(),this.log("requesting reservation from %p",t.remotePeer);const r=await t.newStream(d8,i),o=iN(r).pb(F2);this.log.trace("send RESERVE to %p",t.remotePeer),await o.write({type:F2.Type.RESERVE},i);let a;try{this.log.trace("reading response from %p",t.remotePeer),a=await o.read(i)}catch(c){throw r.abort(c),c}finally{r.status!=="closed"&&await r.close(i)}if(this.log.trace("read response %s",a.status),a.status===la.OK&&a.reservation!=null){const c=new Set;c.add(t.remoteAddr.toString());for(const u of a.reservation.addrs){let h=b0(u);h.getComponents().find(p=>p.code===h8)==null&&(h=h.encapsulate(`/p2p/${t.remotePeer}`)),h=b0(h.toString().replace(`/p2p/${t.remotePeer}/p2p/${t.remotePeer}`,`/p2p/${t.remotePeer}`)),c.add(h.toString())}return a.reservation.addrs=[...c].map(u=>b0(u).bytes),a.reservation}const l=`reservation failed with status ${a.status??"undefined"}`;throw this.log.error(l),new Error(l)},bm=new WeakSet,r3=async function(t){const i=this.reservations.get(t);i!=null&&(this.log("removing relay reservation with %p from local store",t),clearTimeout(i.timeout),this.reservations.delete(t),i.type==="discovered"&&this.pendingReservations.push(i.id),await this.peerStore.merge(t,{tags:{[k4]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:t,details:i}}),rn(this,_m,s3).call(this))},_m=new WeakSet,s3=function(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=ij(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")};class s6e extends w4e{constructor(t){super({...t,direction:t.stream.direction});E(this,"stream");E(this,"init");this.init=t,this.stream=t.stream,this.stream.addEventListener("close",i=>{this.onTransportClosed(i.error)}),this.stream.addEventListener("remoteCloseWrite",i=>{this.onRemoteCloseWrite(),this.close().catch(r=>{this.abort(r)})}),this.stream.addEventListener("message",i=>{t.onDataRead?.(i.data),this.onData(i.data)}),this.stream.addEventListener("drain",()=>{this.safeDispatchEvent("drain")})}sendData(t){return this.init.onDataWrite?.(t),{sentBytes:t.byteLength,canSendMore:this.stream.send(t)}}async sendClose(t){await this.stream.close(t)}sendReset(){this.stream.abort(new Error("An error occurred"))}sendPause(){this.stream.pause()}sendResume(){this.stream.resume()}}function yj(n){return new s6e(n)}const o6e=n=>{if(n.peer==null)return!1;try{n.peer.addrs.forEach(b0)}catch{return!1}return!0},xj={maxInboundStopStreams:dj,maxOutboundStopStreams:dj,stopTimeout:3e4};var wFe,SFe,EFe;class a6e{constructor(e,t={}){E(this,"components");E(this,"discovery");E(this,"reservationStore");E(this,"maxInboundStopStreams");E(this,"maxOutboundStopStreams");E(this,"started");E(this,"log");E(this,"shutdownController");E(this,wFe,"@libp2p/circuit-relay-v2-transport");E(this,SFe,["@libp2p/transport","@libp2p/circuit-relay-v2-transport"]);E(this,EFe,!0);this.components=e,this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.maxInboundStopStreams=t.maxInboundStopStreams??xj.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??xj.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new YSe(e,{filter:t.discoveryFilter??ZSe(USe,FSe)}),this.discovery.addEventListener("relay:discover",i=>{this.reservationStore.addRelay(i.detail,"discovered").catch(r=>{r.name!=="HadEnoughRelaysError"&&r.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p - %e",i.detail,r)})}),this.reservationStore=new r6e(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1,this.onStop=this.onStop.bind(this)}get[(wFe=Symbol.toStringTag,SFe=$be,Gbe)](){return this.discovery!=null?["@libp2p/identify"]:[]}isStarted(){return this.started}async start(){this.shutdownController=new AbortController,this.shutdownController.signal,await this.components.registrar.handle(hj,this.onStop,{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await jbe(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await Vbe(this.discovery,this.reservationStore),await this.components.registrar.unhandle(hj),this.started=!1}async dial(e,t){const i=e.toString().split("/p2p-circuit"),r=b0(i[0]),s=b0(i[i.length-1]),o=r.getComponents().find(m=>m.code===h8)?.value,a=s.getComponents().find(m=>m.code===h8)?.value;if(o==null||a==null){const m=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${m}`),new nJ(`C${m}`)}const l=tj(o),c=tj(a);let h=this.components.connectionManager.getConnections(l)[0];h==null?(await this.components.peerStore.merge(l,{multiaddrs:[r]}),t.onProgress?.(new er("circuit-relay:open-connection")),h=await this.components.connectionManager.openConnection(l,t)):t.onProgress?.(new er("circuit-relay:reuse-connection"));let p;try{t.onProgress?.(new er("circuit-relay:open-hop-stream")),p=await h.newStream(d8,t);const m=iN(p).pb(F2);t.onProgress?.(new er("circuit-relay:write-connect-message")),await m.write({type:F2.Type.CONNECT,peer:{id:c.toMultihash().bytes,addrs:[b0(s).bytes]}},t),t.onProgress?.(new er("circuit-relay:read-connect-response"));const y=await m.read(t);if(y.status!==la.OK)throw new tJ(`failed to connect via relay with status ${y?.status?.toString()??"undefined"}`);const b=new pj(y.limit),w=yj({stream:m.unwrap().unwrap(),remoteAddr:e,localAddr:r.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),onDataRead:b.onData,onDataWrite:b.onData,log:p.log.newScope("circuit-relay:connection")}),v=await this.components.upgrader.upgradeOutbound(w,{...t,limits:b.getLimits()});return v.log("outbound relayed connection established to %p with limits %o, over connection %s",v.remotePeer,y.limit??"none",h.id),v}catch(m){throw this.log.error("circuit relay dial to destination %p via relay %p failed - %e",c,l,m),p?.abort(m),m}}createListener(e){return QSe({peerId:this.components.peerId,connectionManager:this.components.connectionManager,addressManager:this.components.addressManager,reservationStore:this.reservationStore,logger:this.components.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>Eee.exactMatch(t)||Tee.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>bee.exactMatch(t))}async onStop(e,t){const i=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);try{if(!this.reservationStore.hasReservation(t.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.components.transportManager.listen([t.remoteAddr.encapsulate("/p2p-circuit")])}catch(h){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on - %e",h)}const r=iN(e).pb(Xh),s=await r.read({signal:i});if(this.log("new circuit relay v2 stop stream from %p with type %s",t.remotePeer,s.type),s?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",t.remotePeer),await r.write({type:Xh.Type.STATUS,status:la.MALFORMED_MESSAGE},{signal:i}),await e.close({signal:i});return}if(s.type!==Xh.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",t.remotePeer),await r.write({type:Xh.Type.STATUS,status:la.UNEXPECTED_MESSAGE},{signal:i}),await e.close({signal:i});return}if(!o6e(s)){this.log.error("invalid stop connect request via peer %p",t.remotePeer),await r.write({type:Xh.Type.STATUS,status:la.MALFORMED_MESSAGE},{signal:i}),await e.close({signal:i});return}const o=KL(g2(s.peer.id));if(await this.components.connectionGater.denyInboundRelayedConnection?.(t.remotePeer,o)===!0){this.log.error("connection gater denied inbound relayed connection from %p",t.remotePeer),await r.write({type:Xh.Type.STATUS,status:la.PERMISSION_DENIED},{signal:i}),await e.close({signal:i});return}this.log.trace("sending success response to %p",t.remotePeer),await r.write({type:Xh.Type.STATUS,status:la.OK},{signal:i});const a=new pj(s.limit),l=t.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`),c=this.components.addressManager.getAddresses()[0],u=yj({stream:r.unwrap().unwrap(),remoteAddr:l,localAddr:c,onDataRead:a.onData,onDataWrite:a.onData,log:e.log.newScope("circuit-relay:connection")});await this.components.upgrader.upgradeInbound(u,{limits:a.getLimits(),signal:i}),u.log("inbound relayed connection established to %p with limits %o, over connection %s",o,s.limit??"none",t.id)}finally{i?.clear()}}}EFe=Hbe;function l6e(n={}){return e=>new a6e(e,n)}const c6e="bootstrap",u6e=50,h6e=12e4,d6e=1e3;var TFe,AFe,CFe;class Mee extends yc{constructor(t,i={list:[]}){if(i.list==null||i.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();E(this,"log");E(this,"timer");E(this,"list");E(this,"timeout");E(this,"components");E(this,"_init");E(this,TFe,this);E(this,AFe,"@libp2p/bootstrap");E(this,CFe,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=i.timeout??d6e,this.list=[];for(const r of i.list){if(!D3e.matches(r)){this.log.error("Invalid multiaddr");continue}const s=zi(r),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:Bi(o),multiaddrs:[s]};this.list.push(a)}this._init=i}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??c6e]:{value:this._init.tagValue??u6e,ttl:this._init.tagTTL??h6e}}}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}TFe=b6,AFe=Symbol.toStringTag,CFe=kd,E(Mee,"tag","bootstrap");function f6e(n){return e=>new Mee(e,n)}const U_=1e3,tD=60*U_,nD=60*tD,p6e=36*nD,m6e="/ipfs/kad/1.0.0",g6e="/dht/record",Ree="/dht/provider",y6e=256,x6e=24*nD,v6e=nD,aN=20,y8=3,b6e=5*tD,_6e=U_,w6e=5*U_,S6e=5*tD,E6e=30*U_,T6e=180*U_,iD=new Float32Array([-0]),n0=new Uint8Array(iD.buffer);function A6e(n,e,t){iD[0]=n,e[t]=n0[0],e[t+1]=n0[1],e[t+2]=n0[2],e[t+3]=n0[3]}function C6e(n,e){return n0[0]=n[e],n0[1]=n[e+1],n0[2]=n[e+2],n0[3]=n[e+3],iD[0]}const rD=new Float64Array([-0]),Io=new Uint8Array(rD.buffer);function M6e(n,e,t){rD[0]=n,e[t]=Io[0],e[t+1]=Io[1],e[t+2]=Io[2],e[t+3]=Io[3],e[t+4]=Io[4],e[t+5]=Io[5],e[t+6]=Io[6],e[t+7]=Io[7]}function R6e(n,e){return Io[0]=n[e],Io[1]=n[e+1],Io[2]=n[e+2],Io[3]=n[e+3],Io[4]=n[e+4],Io[5]=n[e+5],Io[6]=n[e+6],Io[7]=n[e+7],rD[0]}const I6e=BigInt(Number.MAX_SAFE_INTEGER),N6e=BigInt(Number.MIN_SAFE_INTEGER);class Po{constructor(e,t){E(this,"lo");E(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let i=~this.hi>>>0;return t===0&&(i=i+1>>>0),-(t+i*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let i=~this.hi>>>0;return t===0&&(i=i+1>>>0),-(BigInt(t)+(BigInt(i)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,i=this.hi>>>24;return i===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:i<128?9:10}static fromBigInt(e){if(e===0n)return Im;if(e<I6e&&e>N6e)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let i=e>>32n,r=e-(i<<32n);return t&&(i=~i|0n,r=~r|0n,++r>vj&&(r=0n,++i>vj&&(i=0n))),new Po(Number(r),Number(i))}static fromNumber(e){if(e===0)return Im;const t=e<0;t&&(e=-e);let i=e>>>0,r=(e-i)/4294967296>>>0;return t&&(r=~r>>>0,i=~i>>>0,++i>4294967295&&(i=0,++r>4294967295&&(r=0))),new Po(i,r)}static from(e){return typeof e=="number"?Po.fromNumber(e):typeof e=="bigint"?Po.fromBigInt(e):typeof e=="string"?Po.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Po(e.low>>>0,e.high>>>0):Im}}const Im=new Po(0,0);Im.toBigInt=function(){return 0n};Im.zzEncode=Im.zzDecode=function(){return this};Im.length=function(){return 1};const vj=4294967296n;function P6e(n){let e=0,t=0;for(let i=0;i<n.length;++i)t=n.charCodeAt(i),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(n.charCodeAt(i+1)&64512)===56320?(++i,e+=4):e+=3;return e}function k6e(n,e,t){if(t-e<1)return"";let r;const s=[];let o=0,a;for(;e<t;)a=n[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|n[e++]&63:a>239&&a<365?(a=((a&7)<<18|(n[e++]&63)<<12|(n[e++]&63)<<6|n[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(n[e++]&63)<<6|n[e++]&63,o>8191&&((r??(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r!=null?(o>0&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function Iee(n,e,t){const i=t;let r,s;for(let o=0;o<n.length;++o)r=n.charCodeAt(o),r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&((s=n.charCodeAt(o+1))&64512)===56320?(r=65536+((r&1023)<<10)+(s&1023),++o,e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128);return t-i}function kc(n,e){return RangeError(`index out of range: ${n.pos} + ${e??1} > ${n.len}`)}function D4(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}class L6e{constructor(e){E(this,"buf");E(this,"pos");E(this,"len");E(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,kc(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw kc(this,4);return D4(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw kc(this,4);return D4(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw kc(this,4);const e=C6e(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw kc(this,4);const e=R6e(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,i=this.pos+e;if(i>this.len)throw kc(this,e);return this.pos+=e,t===i?new Uint8Array(0):this.buf.subarray(t,i)}string(){const e=this.bytes();return k6e(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw kc(this,e);this.pos+=e}else do if(this.pos>=this.len)throw kc(this);while(this.buf[this.pos++]&128);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Po(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw kc(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw kc(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw kc(this,8);const e=D4(this.buf,this.pos+=4),t=D4(this.buf,this.pos+=4);return new Po(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=x7(this.buf,this.pos);return this.pos+=nr(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function D6e(n){return new L6e(n instanceof Uint8Array?n:n.subarray())}function O6e(n,e,t){const i=D6e(n);return e.decode(i,void 0,t)}function B6e(n){const e=n??8192,t=e>>>1;let i,r=e;return function(o){if(o<1||o>t)return Cs(o);r+o>e&&(i=Cs(e),r=0);const a=i.subarray(r,r+=o);return r&7&&(r=(r|7)+1),a}}class o3{constructor(e,t,i){E(this,"fn");E(this,"len");E(this,"next");E(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=i}}function aC(){}class U6e{constructor(e){E(this,"head");E(this,"tail");E(this,"len");E(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const F6e=B6e();function z6e(n){return globalThis.Buffer!=null?Cs(n):F6e(n)}class lN{constructor(){E(this,"len");E(this,"head");E(this,"tail");E(this,"states");this.len=0,this.head=new o3(aC,0,0),this.tail=this.head,this.states=null}_push(e,t,i){return this.tail=this.tail.next=new o3(e,t,i),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new V6e((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(O4,10,Po.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Po.fromBigInt(e);return this._push(O4,t.length(),t)}uint64Number(e){return this._push(M0,nr(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Po.fromBigInt(e).zzEncode();return this._push(O4,t.length(),t)}sint64Number(e){const t=Po.fromNumber(e).zzEncode();return this._push(O4,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(lC,1,e?1:0)}fixed32(e){return this._push(mv,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Po.fromBigInt(e);return this._push(mv,4,t.lo)._push(mv,4,t.hi)}fixed64Number(e){const t=Po.fromNumber(e);return this._push(mv,4,t.lo)._push(mv,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(A6e,4,e)}double(e){return this._push(M6e,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(lC,1,0):this.uint32(t)._push(H6e,t,e)}string(e){const t=P6e(e);return t!==0?this.uint32(t)._push(Iee,t,e):this._push(lC,1,0)}fork(){return this.states=new U6e(this),this.head=this.tail=new o3(aC,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new o3(aC,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,i=this.len;return this.reset().uint32(i),i!==0&&(this.tail.next=e.next,this.tail=t,this.len+=i),this}finish(){let e=this.head.next;const t=z6e(this.len);let i=0;for(;e!=null;)e.fn(e.val,t,i),i+=e.len,e=e.next;return t}}function lC(n,e,t){e[t]=n&255}function j6e(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}class V6e extends o3{constructor(t,i){super(j6e,t,i);E(this,"next");this.next=void 0}}function O4(n,e,t){for(;n.hi!==0;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}function mv(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function H6e(n,e,t){e.set(n,t)}globalThis.Buffer!=null&&(lN.prototype.bytes=function(n){const e=n.length>>>0;return this.uint32(e),e>0&&this._push($6e,e,n),this},lN.prototype.string=function(n){const e=globalThis.Buffer.byteLength(n);return this.uint32(e),e>0&&this._push(G6e,e,n),this});function $6e(n,e,t){e.set(n,t)}function G6e(n,e,t){n.length<40?Iee(n,e,t):e.utf8Write!=null?e.utf8Write(n,t):e.set(Ut(n),t)}function W6e(){return new lN}function K6e(n,e){const t=W6e();return e.encode(n,t,{lengthDelimited:!1}),t.finish()}var cN;(function(n){n[n.VARINT=0]="VARINT",n[n.BIT64=1]="BIT64",n[n.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",n[n.START_GROUP=3]="START_GROUP",n[n.END_GROUP=4]="END_GROUP",n[n.BIT32=5]="BIT32"})(cN||(cN={}));function q6e(n,e,t,i){return{name:n,type:e,encode:t,decode:i}}function Z6e(n,e){return q6e("message",cN.LENGTH_DELIMITED,n,e)}var x8;(function(n){let e;n.codec=()=>(e==null&&(e=Z6e((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.key!=null&&t.key.byteLength>0&&(i.uint32(10),i.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(i.uint32(18),i.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(i.uint32(42),i.string(t.timeReceived)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={key:qn(0),value:qn(0),timeReceived:""},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>K6e(t,n.codec()),n.decode=(t,i)=>O6e(t,n.codec(),i)})(x8||(x8={}));function Y6e(n){const e=n.getUTCFullYear(),t=String(n.getUTCMonth()+1).padStart(2,"0"),i=String(n.getUTCDate()).padStart(2,"0"),r=String(n.getUTCHours()).padStart(2,"0"),s=String(n.getUTCMinutes()).padStart(2,"0"),o=String(n.getUTCSeconds()).padStart(2,"0"),a=n.getUTCMilliseconds(),l=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${i}T${r}:${s}:${o}.${l}Z`}function X6e(n){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(n).trim().match(e);if(t==null)throw new Error("Invalid format");const i=parseInt(t[1],10),r=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),l=parseInt(t[6],10),c=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(i,r,s,o,a,l,c))}class fc{constructor(e,t,i){E(this,"key");E(this,"value");E(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=i}serialize(){return x8.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Y6e(this.timeReceived)}}static deserialize(e){const t=x8.decode(e);return new fc(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=X6e(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new fc(e.key,e.value,t)}}function Q6e(n){return n[Symbol.asyncIterator]!=null}function sD(n,e){let t=0;if(Q6e(n))return async function*(){for await(const l of n)yield e(l,t++)}();const i=Yk(n),{value:r,done:s}=i.next();if(s===!0)return function*(){}();const o=e(r,t++);if(typeof o.then=="function")return async function*(){yield await o;for(const l of i)yield e(l,t++)}();const a=e;return function*(){yield o;for(const l of i)yield a(l,t++)}()}var bj;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.key!=null&&(i.uint32(10),i.bytes(t.key)),t.value!=null&&(i.uint32(18),i.bytes(t.value)),t.author!=null&&(i.uint32(26),i.bytes(t.author)),t.signature!=null&&(i.uint32(34),i.bytes(t.signature)),t.timeReceived!=null&&(i.uint32(42),i.string(t.timeReceived)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:{r.key=t.bytes();break}case 2:{r.value=t.bytes();break}case 3:{r.author=t.bytes();break}case 4:{r.signature=t.bytes();break}case 5:{r.timeReceived=t.string();break}default:{t.skipType(o&7);break}}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(bj||(bj={}));var br;(function(n){n.PUT_VALUE="PUT_VALUE",n.GET_VALUE="GET_VALUE",n.ADD_PROVIDER="ADD_PROVIDER",n.GET_PROVIDERS="GET_PROVIDERS",n.FIND_NODE="FIND_NODE",n.PING="PING"})(br||(br={}));var v8;(function(n){n[n.PUT_VALUE=0]="PUT_VALUE",n[n.GET_VALUE=1]="GET_VALUE",n[n.ADD_PROVIDER=2]="ADD_PROVIDER",n[n.GET_PROVIDERS=3]="GET_PROVIDERS",n[n.FIND_NODE=4]="FIND_NODE",n[n.PING=5]="PING"})(v8||(v8={}));(function(n){n.codec=()=>u1(v8)})(br||(br={}));var V2;(function(n){n.NOT_CONNECTED="NOT_CONNECTED",n.CONNECTED="CONNECTED",n.CAN_CONNECT="CAN_CONNECT",n.CANNOT_CONNECT="CANNOT_CONNECT"})(V2||(V2={}));var uN;(function(n){n[n.NOT_CONNECTED=0]="NOT_CONNECTED",n[n.CONNECTED=1]="CONNECTED",n[n.CAN_CONNECT=2]="CAN_CONNECT",n[n.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(uN||(uN={}));(function(n){n.codec=()=>u1(uN)})(V2||(V2={}));var ly;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.id!=null&&t.id.byteLength>0&&(i.uint32(10),i.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)i.uint32(18),i.bytes(s);t.connection!=null&&(i.uint32(24),V2.codec().encode(t.connection,i)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={id:qn(0),multiaddrs:[]},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:{r.id=t.bytes();break}case 2:{r.multiaddrs.push(t.bytes());break}case 3:{r.connection=V2.codec().decode(t);break}default:{t.skipType(o&7);break}}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(ly||(ly={}));var Ed;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.type!=null&&v8[t.type]!==0&&(i.uint32(8),br.codec().encode(t.type,i)),t.clusterLevel!=null&&(i.uint32(80),i.int32(t.clusterLevel)),t.key!=null&&(i.uint32(18),i.bytes(t.key)),t.record!=null&&(i.uint32(26),i.bytes(t.record)),t.closer!=null)for(const s of t.closer)i.uint32(66),ly.codec().encode(s,i);if(t.providers!=null)for(const s of t.providers)i.uint32(74),ly.codec().encode(s,i);r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={type:br.PUT_VALUE,closer:[],providers:[]},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:{r.type=br.codec().decode(t);break}case 10:{r.clusterLevel=t.int32();break}case 2:{r.key=t.bytes();break}case 3:{r.record=t.bytes();break}case 8:{r.closer.push(ly.codec().decode(t,t.uint32()));break}case 9:{r.providers.push(ly.codec().decode(t,t.uint32()));break}default:{t.skipType(o&7);break}}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(Ed||(Ed={}));function _j(n,e={}){const t={...n,name:"SEND_QUERY",type:0,messageName:n.type,messageType:n.type};return e.onProgress?.(new ko("kad-dht:query:send-query",{detail:t})),t}function hN(n,e={}){const t={...n,name:"PEER_RESPONSE",type:1,messageName:n.messageType,closer:n.closer??[],providers:n.providers??[]};return e.onProgress?.(new ko("kad-dht:query:peer-response",{detail:t})),t}function cC(n,e={}){const t={...n,name:"FINAL_PEER",type:2};return e.onProgress?.(new ko("kad-dht:query:final-peer",{detail:t})),t}function P0(n,e={}){const t={...n,name:"QUERY_ERROR",type:3};return e.onProgress?.(new ko("kad-dht:query:query-error",{detail:t})),t}function wj(n,e={}){const t={...n,name:"PROVIDER",type:4};return e.onProgress?.(new ko("kad-dht:query:provider",{detail:t})),t}function dN(n,e={}){const t={...n,name:"VALUE",type:5};return e.onProgress?.(new ko("kad-dht:query:value",{detail:t})),t}function Sj(n,e={}){const t={...n,name:"DIAL_PEER",type:7};return e.onProgress?.(new ko("kad-dht:query:dial-peer",{detail:t})),t}function J6e(n,e,t){if(t.length===0){const o="No records given";throw new Se(o,"ERR_NO_RECORDS_RECEIVED")}const r=Vt(e).split("/");if(r.length<3){const o="Record key does not have a selector function";throw new Se(o,"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const s=n[r[1].toString()];if(s==null){const o=`No selector function configured for key type "${r[1]}"`;throw new Se(o,"ERR_UNRECOGNIZED_KEY_PREFIX")}return t.length===1?0:s(e,t)}function e8e(n,e){return 0}const t8e={pk:e8e};async function oD(n,e){const t=e.key,r=Vt(t).split("/");if(r.length<3)return;const s=n[r[1].toString()];if(s==null){const o=`No validator available for key type "${r[1]}"`;throw new Se(o,"ERR_INVALID_RECORD_KEY_TYPE")}await s(t,e.value)}const n8e=async(n,e)=>{if(!(n instanceof Uint8Array))throw new Se('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(n.byteLength<5)throw new Se("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if(Vt(n.subarray(0,4))!=="/pk/")throw new Se("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");const i=n.slice(4),r=await Ir.digest(e);if(!li(i,r.bytes))throw new Se("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")},i8e={pk:n8e},r8e=Ut("/pk/");function s8e(n){return{...n,multiaddrs:n.multiaddrs.filter(e=>{const[[t,i]]=e.stringTuples();if(t===53||t===54||t===55)return i!=="localhost";if(t!==4&&t!==6||i==null)return!1;const r=E7(i);return r==null?!0:!r})}}async function Ab(n){return(await Ir.digest(n)).digest}async function cd(n){return Ab(n.toBytes())}function S3(n){return new Js(`${g6e}/${Vt(n,"base32")}`,!1)}function o8e(n){return Ms([r8e,n.toBytes()])}function a8e(n){return Vt(n.subarray(0,4))==="/pk/"}function l8e(n){return gh(n.subarray(4))}function Ej(n,e){const t=new Date;return new fc(n,e,t).serialize()}function c8e(n,e=100){let t;return()=>{clearTimeout(t),t=setTimeout(()=>{n()},e)}}const u8e=290,h8e=54,d8e=55,f8e=56,p8e=4,m8e=41;function g8e(n){const e=n.stringTuples();for(const t of e)if(t[0]===u8e)return!1;if(e[0][0]===h8e||e[0][0]===d8e||e[0][0]===f8e)return!0;if(e[0][0]===p8e||e[0][0]===m8e){const t=E7(`${e[0][1]}`);return t==null||!t}return!1}class y8e{constructor(e,t){E(this,"log");E(this,"components");E(this,"validators");E(this,"selectors");E(this,"peerRouting");E(this,"queryManager");E(this,"network");const{validators:i,selectors:r,peerRouting:s,queryManager:o,network:a,logPrefix:l}=t;this.components=e,this.log=e.logger.forComponent(`${l}:content-fetching`),this.validators=i,this.selectors=r,this.peerRouting=s,this.queryManager=o,this.network=a}async getLocal(e){this.log("getLocal %b",e);const t=S3(e);this.log("fetching record for key %k",t);const i=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const r=fc.deserialize(i);return await oD(this.validators,r),r}async*sendCorrectionRecord(e,t,i,r={}){this.log("sendCorrection for %b",e);const s=Ej(e,i);for(const{value:o,from:a}of t){if(li(o,i)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const u=S3(e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,s.subarray())}catch(u){this.log.error("Failed error correcting self",u)}continue}let l=!1;const c={type:br.PUT_VALUE,key:e,record:s};for await(const u of this.network.sendRequest(a,c,r))u.name==="PEER_RESPONSE"&&u.record!=null&&li(u.record.value,fc.deserialize(s).value)&&(l=!0),yield u;l||(yield P0({from:a,error:new Se("value not put correctly","ERR_PUT_VALUE_INVALID")},r)),this.log.error("Failed error correcting entry")}}async*put(e,t,i={}){this.log("put key %b value %b",e,t);const r=Ej(e,t),s=S3(e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,r.subarray()),yield*Qa(this.peerRouting.getClosestPeers(e,{signal:i.signal}),o=>sD(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const l=[],c={type:br.PUT_VALUE,key:e,record:r};this.log("send put to %p",a.peer.id);for await(const u of this.network.sendRequest(a.peer.id,c,i))l.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&li(u.record.value,fc.deserialize(r).value)||l.push(P0({from:a.peer.id,error:new Se("value not put correctly","ERR_PUT_VALUE_INVALID")},i)));return l}),o=>aL(o,{ordered:!1,concurrency:y8}),async function*(o){for await(const a of o)yield*a})}async*get(e,t={}){this.log("get %b",e);const i=[];for await(const a of this.getMany(e,t))a.name==="VALUE"&&i.push(a),yield a;if(i.length===0)return;const r=i.map(a=>a.value);let s=0;try{s=J6e(this.selectors,e,r)}catch(a){if(a.code!=="ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")throw a}const o=r[s];if(this.log("GetValue %b %b",e,o),o==null)throw new Se("best value was not found","ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,i,o,t),yield i[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e);yield dN({value:s.value,from:this.components.peerId},t)}catch(s){this.log("error getting local value for %b",e,s)}const i=this,r=async function*({peer:s,signal:o}){for await(const a of i.peerRouting.getValueOrPeers(s,e,{signal:o}))yield a,a.name==="PEER_RESPONSE"&&a.record!=null&&(yield dN({from:s,value:a.record.value},t))};yield*this.queryManager.run(e,r,t)}}function Tj(n,e){const t={[Symbol.iterator]:()=>t,next:()=>{const i=n.next(),r=i.value;return i.done===!0||r==null?{done:!0,value:void 0}:{done:!1,value:e(r)}}};return t}class _0{constructor(e){E(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Tj(this.set.entries(),e=>{const t=Bi(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const i=Bi(t);e(i,i,this)})}has(e){return this.set.has(e.toString())}values(){return Tj(this.set.values(),e=>Bi(e))}intersection(e){const t=new _0;for(const i of e)this.has(i)&&t.add(i);return t}difference(e){const t=new _0;for(const i of this)e.has(i)||t.add(i);return t}union(e){const t=new _0;for(const i of e)t.add(i);for(const i of this)t.add(i);return t}}function x8e(n,e){return{id:n.id.toBytes(),multiaddrs:(n.multiaddrs??[]).map(i=>i.bytes),connection:e}}function B4(n){if(n.id==null)throw new Error("Invalid peer in message");return{id:gh(n.id),multiaddrs:(n.multiaddrs??[]).map(e=>zi(e))}}class v8e{constructor(e,t){E(this,"log");E(this,"components");E(this,"network");E(this,"peerRouting");E(this,"queryManager");E(this,"routingTable");E(this,"providers");const{network:i,peerRouting:r,queryManager:s,routingTable:o,providers:a,logPrefix:l}=t;this.components=e,this.log=e.logger.forComponent(`${l}:content-routing`),this.network=i,this.peerRouting=r,this.queryManager=s,this.routingTable=o,this.providers=a}async*provide(e,t,i={}){this.log("provide %s",e);const r=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId);const s={type:br.ADD_PROVIDER,key:r,providers:[x8e({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=l=>async()=>{if(l.name!=="FINAL_PEER")return[l];const c=[];this.log("putProvider %s to %p",e,l.peer.id);try{this.log("sending provider record for %s to %p",e,l.peer.id);for await(const u of this.network.sendMessage(l.peer.id,s,i))u.name==="PEER_RESPONSE"&&(this.log("sent provider record for %s to %p",e,l.peer.id),o++),c.push(u)}catch(u){this.log.error("error sending provide record to peer %p",l.peer.id,u),c.push(P0({from:l.peer.id,error:u},i))}return c};yield*Qa(this.peerRouting.getClosestPeers(r,i),l=>sD(l,c=>a(c)),l=>aL(l,{ordered:!1,concurrency:y8}),async function*(l){for await(const c of l)yield*c}),this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const i=this.routingTable.kBucketSize;let r=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e);if(a.length>0){const u=[];for(const h of a.slice(0,i))try{const p=await this.components.peerStore.get(h);u.push({id:h,multiaddrs:p.addresses.map(({multiaddr:m})=>m)})}catch(p){if(p.code!=="ERR_NOT_FOUND")throw p;this.log("no peer store entry for %p",h)}if(yield hN({from:this.components.peerId,messageType:br.GET_PROVIDERS,providers:u},t),yield wj({from:this.components.peerId,providers:u},t),r+=u.length,r>=i)return}const l=async function*({peer:u,signal:h}){const p={type:br.GET_PROVIDERS,key:s};yield*o.network.sendRequest(u,p,{...t,signal:h})},c=new _0(a);for await(const u of this.queryManager.run(s,l,t))if(yield u,u.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const h=[];for(const p of u.providers)c.has(p.id)||(c.add(p.id),h.push(p));if(h.length>0&&(yield wj({from:u.from,providers:h},t),r+=h.length,r>=i))return}}}class b8e extends yc{constructor(t,i){super();E(this,"log");E(this,"protocol");E(this,"running");E(this,"components");E(this,"timeout");const{protocol:r}=i;this.components=t,this.log=t.logger.forComponent(`${i.logPrefix}:network`),this.running=!1,this.protocol=r,this.timeout=new NX({...i.timeout??{},metrics:t.metrics,metricName:`${i.logPrefix.replaceAll(":","_")}_network_message_send_times_milliseconds`})}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,i,r={}){if(!this.running)return;const s=i.type;if(s==null)throw new zc("Message type was missing","ERR_INVALID_PARAMETERS");this.log("sending %s to %p",i.type,t),yield Sj({peer:t},r),yield _j({to:t,type:s},r);let o;const a=this.timeout.getTimeoutSignal(r);r={...r,signal:a};try{o=await(await this.components.connectionManager.openConnection(t,r)).newStream(this.protocol,r);const c=await this._writeReadMessage(o,i,r);o.close(r).catch(u=>{this.log.error("error closing stream to %p",t,u),o?.abort(u)}),yield hN({from:t,messageType:c.type,closer:c.closer.map(B4),providers:c.providers.map(B4),record:c.record==null?void 0:fc.deserialize(c.record)},r)}catch(l){o?.abort(l),this.log.error("could not send %s to %p",i.type,t,l),yield P0({from:t,error:l},r)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,i,r={}){if(!this.running)return;const s=i.type;if(s==null)throw new zc("Message type was missing","ERR_INVALID_PARAMETERS");this.log("sending %s to %p",i.type,t),yield Sj({peer:t},r),yield _j({to:t,type:s},r);let o;const a=this.timeout.getTimeoutSignal(r);r={...r,signal:a};try{o=await(await this.components.connectionManager.openConnection(t,r)).newStream(this.protocol,r),await this._writeMessage(o,i,r),o.close(r).catch(c=>{this.log.error("error closing stream to %p",t,c),o?.abort(c)}),yield hN({from:t,messageType:s},r)}catch(l){o?.abort(l),yield P0({from:t,error:l},r)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,i,r){const s=Ld(t);await s.write(i,Ed,r),await s.unwrap().close(r)}async _writeReadMessage(t,i,r){const s=Ld(t);await s.write(i,Ed,r);const o=await s.read(Ed,r);return await s.unwrap().close(r),o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:B4(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:B4(a)})}),o}}function b8(n,e){if(n.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<n.byteLength;t++)if(n[t]!==e[t])return n[t]<e[t]?-1:1;return 0}class Nee{constructor(e,t){E(this,"originDhtKey");E(this,"capacity");E(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map(e=>e.peer)}async add(e){const t=await cd(e.id);this.addWitKadId(e,t)}addWitKadId(e,t){if(this.peerDistances.find(r=>r.peer.id.equals(e.id))!=null)return;const i={peer:e,distance:L2(this.originDhtKey,t)};this.peerDistances.push(i),this.peerDistances.sort((r,s)=>b8(r.distance,s.distance)),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e){if(this.length===0)return!0;const t=await cd(e),i=L2(t,this.originDhtKey),r=this.peerDistances[this.peerDistances.length-1].distance;return b8(i,r)===-1}async anyCloser(e){return e.length===0?!1:Promise.any(e.map(async t=>this.isCloser(t)))}}class _8e{constructor(e,t){E(this,"log");E(this,"routingTable");E(this,"network");E(this,"validators");E(this,"queryManager");E(this,"peerStore");E(this,"peerId");const{routingTable:i,network:r,validators:s,queryManager:o,logPrefix:a}=t;this.routingTable=i,this.network=r,this.validators=s,this.queryManager=o,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent(`${a}:peer-routing`)}async findPeerLocal(e){let t;const i=await this.routingTable.find(e);if(i!=null){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(i)}catch(r){if(r.code!=="ERR_NOT_FOUND")throw r}}if(t==null)try{t=await this.peerStore.get(e)}catch(r){if(r.code!=="ERR_NOT_FOUND")throw r}if(t!=null)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map(r=>r.multiaddr)}}async*_getValueSingle(e,t,i={}){const r={type:br.GET_VALUE,key:t};yield*this.network.sendRequest(e,r,i)}async*getPublicKeyFromNode(e,t={}){const i=o8e(e);for await(const r of this._getValueSingle(e,i,t))if(yield r,r.name==="PEER_RESPONSE"&&r.record!=null){const s=await jd(zk({bytes:r.record.value}));if(!s.equals(e))throw new Se("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(s.publicKey==null)throw new Se("public key missing","ERR_PUBLIC_KEY_MISSING");yield dN({from:e,value:s.publicKey},t)}throw new Se(`Node not responding with its public key: ${e.toString()}`,"ERR_INVALID_RECORD")}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const r=await this.findPeerLocal(e);if(r!=null){this.log("found local"),yield cC({from:this.peerId,peer:r},t);return}}let i=!1;if(t.useNetwork!==!1){const r=this,s=async function*({peer:o,signal:a}){const l={type:br.FIND_NODE,key:e.toBytes()};for await(const c of r.network.sendRequest(o,l,{...t,signal:a}))if(yield c,c.name==="PEER_RESPONSE"){const u=c.closer.find(h=>h.id.equals(e));u!=null&&(yield cC({from:c.from,peer:u},t))}};for await(const o of this.queryManager.run(e.toBytes(),s,t))o.name==="FINAL_PEER"&&(i=!0),yield o}i||(yield P0({from:this.peerId,error:new Se("Not found","ERR_NOT_FOUND")},t))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const i=await Ab(e),r=this.routingTable.closestPeers(i),s=this,o=new Nee(i,this.routingTable.kBucketSize);await Promise.all(r.map(async l=>{await o.add({id:l,multiaddrs:[]})}));const a=async function*({peer:l,signal:c}){s.log("closerPeersSingle %s from %p",Vt(e,"base32"),l);const u={type:br.FIND_NODE,key:e};yield*s.network.sendRequest(l,u,{...t,signal:c})};for await(const l of this.queryManager.run(e,a,t))l.name==="PEER_RESPONSE"&&await Promise.all(l.closer.map(async c=>{await o.add(c)})),yield l;this.log("found %d peers close to %b",o.length,e);for(const l of o.peers)yield cC({from:this.peerId,peer:l},t)}async*getValueOrPeers(e,t,i={}){for await(const r of this._getValueSingle(e,t,i)){if(r.name==="PEER_RESPONSE"&&r.record!=null)try{await this._verifyRecordOnline(r.record)}catch{const o="invalid record received, discarded";this.log(o),yield P0({from:r.from,error:new Se(o,"ERR_INVALID_RECORD")},i);continue}yield r}}async _verifyRecordOnline(e){if(e.timeReceived==null)throw new Se("invalid record received","ERR_INVALID_RECORD");await oD(this.validators,new fc(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const i=await Ab(e),r=this.routingTable.closestPeers(i),s=[];for(const o of r)if(!o.equals(t))try{const a=await this.peerStore.get(o);s.push({id:o,multiaddrs:a.addresses.map(({multiaddr:l})=>l)})}catch(a){if(a.code!=="ERR_NOT_FOUND")throw a}return s.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",s.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p with %d peers in the routing table",e,t,this.routingTable.size),s}}function w8e(n,e,t){let i=0,r=n.length;for(;r>0;){const s=Math.trunc(r/2);let o=i+s;t(n[o],e)<=0?(i=++o,r-=s+1):r=s}return i}var ql;class S8e{constructor(){$t(this,ql,[])}enqueue(e,t){t={priority:0,...t};const i={priority:t.priority,id:t.id,run:e};if(this.size===0||ze(this,ql)[this.size-1].priority>=t.priority){ze(this,ql).push(i);return}const r=w8e(ze(this,ql),i,(s,o)=>o.priority-s.priority);ze(this,ql).splice(r,0,i)}setPriority(e,t){const i=ze(this,ql).findIndex(s=>s.id===e);if(i===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[r]=ze(this,ql).splice(i,1);this.enqueue(r.run,{priority:t,id:e})}dequeue(){return ze(this,ql).shift()?.run}filter(e){return ze(this,ql).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return ze(this,ql).length}}ql=new WeakMap;var Qy,Jy,Wf,e_,e2,t_,Zl,t2,ia,n_,Yl,n2,ld,i_,DE,OE,Pee,BE,kee,UE,Lee,FE,Dee,zE,Oee,i2,CS,r_,fN,s_,pN,r2,MS,jE,Bee,s2,RS;class E8e extends XY{constructor(t){super();$t(this,OE);$t(this,BE);$t(this,UE);$t(this,FE);$t(this,zE);$t(this,i2);$t(this,r_);$t(this,s_);$t(this,r2);$t(this,jE);$t(this,s2);$t(this,Qy,void 0);$t(this,Jy,void 0);$t(this,Wf,0);$t(this,e_,void 0);$t(this,e2,void 0);$t(this,t_,0);$t(this,Zl,void 0);$t(this,t2,void 0);$t(this,ia,void 0);$t(this,n_,void 0);$t(this,Yl,0);$t(this,n2,void 0);$t(this,ld,void 0);$t(this,i_,void 0);$t(this,DE,1n);E(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:S8e,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap?.toString()??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval?.toString()??""}\` (${typeof t.interval})`);On(this,Qy,t.carryoverConcurrencyCount),On(this,Jy,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),On(this,e_,t.intervalCap),On(this,e2,t.interval),On(this,ia,new t.queueClass),On(this,n_,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,On(this,i_,t.throwOnTimeout===!0),On(this,ld,t.autoStart===!1)}get concurrency(){return ze(this,n2)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);On(this,n2,t),rn(this,r2,MS).call(this)}setPriority(t,i){ze(this,ia).setPriority(t,i)}async add(t,i={}){return i.id??(i.id=(wu(this,DE)._++).toString()),i={timeout:this.timeout,throwOnTimeout:ze(this,i_),...i},new Promise((r,s)=>{ze(this,ia).enqueue(async()=>{wu(this,Yl)._++;try{i.signal?.throwIfAborted(),wu(this,Wf)._++;let o=t({signal:i.signal});i.timeout&&(o=k_(Promise.resolve(o),{milliseconds:i.timeout})),i.signal&&(o=Promise.race([o,rn(this,jE,Bee).call(this,i.signal)]));const a=await o;r(a),this.emit("completed",a)}catch(o){if(o instanceof kL&&!i.throwOnTimeout){r();return}s(o),this.emit("error",o)}finally{rn(this,UE,Lee).call(this)}},i),this.emit("add"),rn(this,i2,CS).call(this)})}async addAll(t,i){return Promise.all(t.map(async r=>this.add(r,i)))}start(){return ze(this,ld)?(On(this,ld,!1),rn(this,r2,MS).call(this),this):this}pause(){On(this,ld,!0)}clear(){On(this,ia,new(ze(this,n_)))}async onEmpty(){ze(this,ia).size!==0&&await rn(this,s2,RS).call(this,"empty")}async onSizeLessThan(t){ze(this,ia).size<t||await rn(this,s2,RS).call(this,"next",()=>ze(this,ia).size<t)}async onIdle(){ze(this,Yl)===0&&ze(this,ia).size===0||await rn(this,s2,RS).call(this,"idle")}get size(){return ze(this,ia).size}sizeBy(t){return ze(this,ia).filter(t).length}get pending(){return ze(this,Yl)}get isPaused(){return ze(this,ld)}}Qy=new WeakMap,Jy=new WeakMap,Wf=new WeakMap,e_=new WeakMap,e2=new WeakMap,t_=new WeakMap,Zl=new WeakMap,t2=new WeakMap,ia=new WeakMap,n_=new WeakMap,Yl=new WeakMap,n2=new WeakMap,ld=new WeakMap,i_=new WeakMap,DE=new WeakMap,OE=new WeakSet,Pee=function(){return ze(this,Jy)||ze(this,Wf)<ze(this,e_)},BE=new WeakSet,kee=function(){return ze(this,Yl)<ze(this,n2)},UE=new WeakSet,Lee=function(){wu(this,Yl)._--,rn(this,i2,CS).call(this),this.emit("next")},FE=new WeakSet,Dee=function(){rn(this,s_,pN).call(this),rn(this,r_,fN).call(this),On(this,t2,void 0)},zE=new WeakSet,Oee=function(){const t=Date.now();if(ze(this,Zl)===void 0){const i=ze(this,t_)-t;if(i<0)On(this,Wf,ze(this,Qy)?ze(this,Yl):0);else return ze(this,t2)===void 0&&On(this,t2,setTimeout(()=>{rn(this,FE,Dee).call(this)},i)),!0}return!1},i2=new WeakSet,CS=function(){if(ze(this,ia).size===0)return ze(this,Zl)&&clearInterval(ze(this,Zl)),On(this,Zl,void 0),this.emit("empty"),ze(this,Yl)===0&&this.emit("idle"),!1;if(!ze(this,ld)){const t=!ze(this,zE,Oee);if(ze(this,OE,Pee)&&ze(this,BE,kee)){const i=ze(this,ia).dequeue();return i?(this.emit("active"),i(),t&&rn(this,r_,fN).call(this),!0):!1}}return!1},r_=new WeakSet,fN=function(){ze(this,Jy)||ze(this,Zl)!==void 0||(On(this,Zl,setInterval(()=>{rn(this,s_,pN).call(this)},ze(this,e2))),On(this,t_,Date.now()+ze(this,e2)))},s_=new WeakSet,pN=function(){ze(this,Wf)===0&&ze(this,Yl)===0&&ze(this,Zl)&&(clearInterval(ze(this,Zl)),On(this,Zl,void 0)),On(this,Wf,ze(this,Qy)?ze(this,Yl):0),rn(this,r2,MS).call(this)},r2=new WeakSet,MS=function(){for(;rn(this,i2,CS).call(this););},jE=new WeakSet,Bee=async function(t){return new Promise((i,r)=>{t.addEventListener("abort",()=>{r(t.reason)},{once:!0})})},s2=new WeakSet,RS=async function(t,i){return new Promise(r=>{const s=()=>{i&&!i()||(this.off(t,s),r())};this.on(t,s)})};class T8e{constructor(e,t={}){E(this,"log");E(this,"datastore");E(this,"cache");E(this,"cleanupInterval");E(this,"provideValidity");E(this,"syncQueue");E(this,"started");E(this,"cleaner");const{cacheSize:i,cleanupInterval:r,provideValidity:s}=t;this.log=e.logger.forComponent("libp2p:kad-dht:providers"),this.datastore=e.datastore,this.cleanupInterval=r??v6e,this.provideValidity=s??x6e,this.cache=cX(i??y6e),this.syncQueue=new E8e({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval(()=>{this._cleanup().catch(e=>{this.log.error(e)})},this.cleanupInterval))}async stop(){this.started=!1,this.cleaner!=null&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add(async()=>{const e=Date.now();let t=0,i=0;const r=new Map,s=this.datastore.batch(),o=this.datastore.query({prefix:Ree});for await(const a of o)try{const{cid:l,peerId:c}=Uee(a.key),u=Fee(a.value).getTime(),h=Date.now(),p=h-u,m=p>this.provideValidity;if(this.log("comparing: %d - %d = %d > %d %s",h,u,p,this.provideValidity,m?"(expired)":""),m){i++,s.delete(a.key);const y=r.get(l)??new Set;y.add(c),r.set(l,y)}t++}catch(l){this.log.error(l.message)}r.size>0?(this.log("deleting %d / %d entries",i,t),await s.commit()):this.log("nothing to delete");for(const[a,l]of r){const c=E3(a),u=this.cache.get(c);if(u!=null){for(const h of l)u.delete(h);u.size===0?this.cache.remove(c):this.cache.set(c,u)}}this.log("Cleanup successful (%dms)",Date.now()-e)})}async _getProvidersMap(e){const t=E3(e);let i=this.cache.get(t);return i==null&&(i=await C8e(this.datastore,e),this.cache.set(t,i)),i}async addProvider(e,t){await this.syncQueue.add(async()=>{this.log("%p provides %s",t,e);const i=await this._getProvidersMap(e);this.log("loaded %s provs",i.size);const r=new Date;i.set(t.toString(),r);const s=E3(e);this.cache.set(s,i),await A8e(this.datastore,e,t,r)})}async getProviders(e){return this.syncQueue.add(async()=>(this.log("get providers for %s",e),[...(await this._getProvidersMap(e)).keys()].map(i=>Bi(i))),{throwOnTimeout:!0})}}function E3(n){const e=typeof n=="string"?n:Vt(n.multihash.bytes,"base32");return`${Ree}/${e}`}async function A8e(n,e,t,i){const r=[E3(e),"/",t.toString()].join(""),s=new Js(r),o=Za(i.getTime());await n.put(s,o)}function Uee(n){const e=n.toString().split("/");if(e.length!==5)throw new Error(`incorrectly formatted provider entry key in datastore: ${n.toString()}`);return{cid:e[3],peerId:e[4]}}async function C8e(n,e){const t=new Map,i=n.query({prefix:E3(e)});for await(const r of i){const{peerId:s}=Uee(r.key);t.set(s,Fee(r.value))}return t}function Fee(n){return new Date($0(n))}async function*M8e(n){const{key:e,startingPeer:t,ourPeerId:i,signal:r,query:s,alpha:o,pathIndex:a,numPaths:l,queryFuncTimeout:c,log:u,peersSeen:h,connectionManager:p}=n,m=new iL({concurrency:o,sort:(w,v)=>b8(w.options.distance,v.options.distance)}),y=await Ab(e);function b(w,v){if(w==null)return;h.add(w);const T=L2(v,y);m.add(async()=>{const S=[r];c!=null&&S.push(AbortSignal.timeout(c));const M=N0(S);tr(1/0,M);try{for await(const P of s({key:e,peer:w,signal:M,pathIndex:a,numPaths:l})){if(M.aborted)return;if(P.name==="PEER_RESPONSE")for(const R of P.closer){if(h.has(R.id)){u("already seen %p in query",R.id);continue}if(i.equals(R.id)){u("not querying ourselves");continue}if(!await p.isDialable(R.multiaddrs)){u("not querying undialable peer");continue}const O=await cd(R.id),B=L2(O,y);if(b8(B,T)!==-1){u("skipping %p as they are not closer to %b than %p",R.id,e,w);continue}u("querying closer peer %p",R.id),b(R.id,O)}m.safeDispatchEvent("completed",{detail:P})}}catch(P){if(!r.aborted)return P0({from:w,error:P},n)}finally{M.clear()}},{distance:T}).catch(S=>{u.error(S)})}b(t,await cd(t));try{for await(const w of m.toGenerator({signal:r}))w!=null&&(yield w)}catch(w){throw r.aborted?new Se("Query aborted","ERR_QUERY_ABORTED"):w}}class R8e{constructor(e,t){E(this,"disjointPaths");E(this,"alpha");E(this,"shutDownController");E(this,"running");E(this,"queries");E(this,"logger");E(this,"peerId");E(this,"connectionManager");E(this,"routingTable");E(this,"initialQuerySelfHasRun");E(this,"logPrefix");E(this,"metrics");const{disjointPaths:i=aN,alpha:r=y8,logPrefix:s}=t;this.logPrefix=s,this.disjointPaths=i??aN,this.running=!1,this.alpha=r??y8,this.queries=0,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,e.metrics!=null&&(this.metrics={runningQueries:e.metrics.registerMetric(`${s.replaceAll(":","_")}_running_queries`),queryTime:e.metrics.registerMetric(`${s.replaceAll(":","_")}_query_time_seconds`)}),this.shutDownController=new AbortController,tr(1/0,this.shutDownController.signal)}isStarted(){return this.running}async start(){this.running=!0,this.shutDownController=new AbortController,tr(1/0,this.shutDownController.signal)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,i={}){if(!this.running)throw new Error("QueryManager not started");const r=this.metrics?.queryTime.timer();if(i.signal==null){const u=AbortSignal.timeout(T6e);tr(1/0,u),i={...i,signal:u}}const s=new AbortController,o=N0([this.shutDownController.signal,s.signal,i.signal]);tr(1/0,o,s.signal);const a=this.logger.forComponent(`${this.logPrefix}:query:`+Vt(e,"base58btc")),l=Date.now();let c=!1;try{i.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(a("waiting for initial query-self query before continuing"),await eu(this.initialQuerySelfHasRun.promise,o),this.initialQuerySelfHasRun=void 0),a("query:start"),this.queries++,this.metrics?.runningQueries.update(this.queries);const u=await Ab(e),h=this.routingTable.closestPeers(u),p=h.slice(0,Math.min(this.disjointPaths,h.length));if(h.length===0){a.error("Running query with no peers");return}const m=new _0,y=p.map((b,w)=>M8e({key:e,startingPeer:b,ourPeerId:this.peerId,signal:o,query:t,pathIndex:w,numPaths:p.length,alpha:this.alpha,queryFuncTimeout:i.queryFuncTimeout,log:a,peersSeen:m,onProgress:i.onProgress,connectionManager:this.connectionManager}));for await(const b of mb(...y)){if(b.name==="QUERY_ERROR"&&a.error("query error",b.error),b.name==="PEER_RESPONSE")for(const w of[...b.closer,...b.providers])await this.connectionManager.isDialable(w.multiaddrs)&&await this.routingTable.add(w.id);yield b}c=!0}catch(u){if(!(!this.running&&u.code==="ERR_QUERY_ABORTED"))throw u}finally{c||(a("query exited early"),s.abort()),o.clear(),this.queries--,this.metrics?.runningQueries.update(this.queries),r?.(),a("query:done in %dms",Date.now()-l)}}}function I8e(n){return n[Symbol.asyncIterator]!=null}function zee(n){if(I8e(n))return(async()=>{let e=0;for await(const t of n)e++;return e})();{let e=0;for(const t of n)e++;return e}}class N8e{constructor(e,t){E(this,"log");E(this,"peerId");E(this,"peerRouting");E(this,"routingTable");E(this,"count");E(this,"interval");E(this,"initialInterval");E(this,"queryTimeout");E(this,"started");E(this,"timeoutId");E(this,"controller");E(this,"initialQuerySelfHasRun");E(this,"querySelfPromise");const{peerRouting:i,logPrefix:r,count:s,interval:o,queryTimeout:a,routingTable:l}=t;this.peerId=e.peerId,this.log=e.logger.forComponent(`${r}:query-self`),this.started=!1,this.peerRouting=i,this.routingTable=l,this.count=s??aN,this.interval=o??b6e,this.initialInterval=t.initialInterval??_6e,this.queryTimeout=a??w6e,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun}isStarted(){return this.started}start(){this.started||(this.started=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.started=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.started){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Ki(),this.started){this.controller=new AbortController;const e=AbortSignal.timeout(this.queryTimeout),t=N0([this.controller.signal,e]);tr(1/0,t,this.controller.signal,e);try{this.routingTable.size===0&&(this.log("routing table was empty, waiting for some peers before running query"),await VI(this.routingTable,"peer:add",{signal:t})),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const i=Date.now(),r=await Qa(this.peerRouting.getClosestPeers(this.peerId.toBytes(),{signal:t,isSelfQuery:!0}),s=>aI(s,this.count),async s=>zee(s));this.log("self-query found %d peers in %dms",r,Date.now()-i)}catch(i){this.log.error("self-query error",i)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.started&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}function P8e(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;++t)if(n[t]!==e[t])return!1;return!0}function Aj(n,e){if(!(e instanceof Uint8Array))throw new TypeError(n+" is not a Uint8Array");if(e.byteLength!==32)throw new TypeError(n+" had incorrect length")}function IS(n){return Array.isArray(n?.peers)}class k8e extends yc{constructor(t){super();E(this,"root");E(this,"localPeer");E(this,"prefixLength");E(this,"splitThreshold");E(this,"kBucketSize");E(this,"numberOfNodesToPing");this.localPeer=t.localPeer,this.prefixLength=t.prefixLength,this.kBucketSize=t.kBucketSize??NS,this.splitThreshold=t.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=t.numberOfNodesToPing??3,Aj("options.localPeer.kadId",t.localPeer.kadId),this.root={prefix:"",depth:0,peers:[]}}add(t){Aj("peer.kadId",t?.kadId);const i=this._determineBucket(t.kadId);if(!(this._indexOf(i,t.kadId)>-1)){if(i.peers.length===this.splitThreshold&&i.depth<this.prefixLength){this._split(i),this.add(t);return}if(i.peers.length<this.kBucketSize){i.peers.push(t),this.safeDispatchEvent("added",{detail:t});return}this.safeDispatchEvent("ping",{detail:{oldContacts:i.peers.slice(0,this.numberOfNodesToPing),newContact:t}})}}*closest(t,i=this.kBucketSize){const r=new Nee(t,i);for(const s of this.toIterable())r.addWitKadId({id:s.peerId,multiaddrs:[]},s.kadId);yield*sD(r.peers,s=>s.id)}count(){function t(i){if(IS(i))return i.peers.length;let r=0;return i.left!=null&&(r+=t(i.left)),i.right!=null&&(r+=t(i.right)),r}return t(this.root)}get(t){const i=this._determineBucket(t),r=this._indexOf(i,t);return i.peers[r]}remove(t){const i=this._determineBucket(t),r=this._indexOf(i,t);if(r>-1){const s=i.peers.splice(r,1)[0];this.safeDispatchEvent("removed",{detail:s})}}*toIterable(){function*t(i){if(IS(i)){yield*i.peers;return}yield*t(i.left),yield*t(i.right)}yield*t(this.root)}distance(t,i){return BigInt("0x"+Vt(L2(t,i),"base16"))}_determineBucket(t){const r=Vt(t,"base2").substring(0,this.prefixLength);function s(o,a=0){return IS(o)?o:r[a]==="0"?s(o.left,a+1):s(o.right,a+1)}return s(this.root)}_indexOf(t,i){return t.peers.findIndex(r=>P8e(r.kadId,i))}_split(t){const i=t.depth+1,r={prefix:"0",depth:i,peers:[]},s={prefix:"1",depth:i,peers:[]};for(const o of t.peers)Vt(o.kadId,"base2")[i]==="0"?r.peers.push(o):s.peers.push(o);delete t.peers,t.left=r,t.right=s}}const L8e="kad-close",D8e=50,NS=20,O8e=32,B8e=1e4,U8e=10;class F8e extends yc{constructor(t,i){super();E(this,"kBucketSize");E(this,"kb");E(this,"pingQueue");E(this,"log");E(this,"components");E(this,"prefixLength");E(this,"splitThreshold");E(this,"pingTimeout");E(this,"pingConcurrency");E(this,"running");E(this,"protocol");E(this,"tagName");E(this,"tagValue");E(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${i.logPrefix}:routing-table`),this.kBucketSize=i.kBucketSize??NS,this.pingTimeout=i.pingTimeout??B8e,this.pingConcurrency=i.pingConcurrency??U8e,this.running=!1,this.protocol=i.protocol,this.tagName=i.tagName??L8e,this.tagValue=i.tagValue??D8e,this.prefixLength=i.prefixLength??O8e,this.splitThreshold=i.splitThreshold??NS,this.pingQueue=new mX({concurrency:this.pingConcurrency,metricName:`${i.logPrefix.replaceAll(":","_")}_ping_queue`,metrics:this.components.metrics}),this.pingQueue.addEventListener("error",r=>{this.log.error("error pinging peer",r.detail)}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${i.logPrefix.replaceAll(":","_")}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${i.logPrefix.replaceAll(":","_")}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${i.logPrefix.replaceAll(":","_")}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${i.logPrefix.replaceAll(":","_")}_routing_table_kad_bucket_max_depth`)})}isStarted(){return this.running}async start(){this.running=!0;const t=new k8e({localPeer:{kadId:await cd(this.components.peerId),peerId:this.components.peerId},kBucketSize:this.kBucketSize,prefixLength:this.prefixLength,splitThreshold:this.splitThreshold,numberOfNodesToPing:1});this.kb=t,t.addEventListener("ping",r=>{this._onPing(r).catch(s=>{this.log.error("could not process k-bucket ping event",s)})});let i=0;for(const r of await this.components.peerStore.all())if(r.protocols.includes(this.protocol)){const s=await cd(r.id);this.kb.add({kadId:s,peerId:r.id}),i++}this.log("added %d peer store peers to the routing table",i),this._tagPeers(t)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(t){let i=new _0;const r=c8e(()=>{const s=new _0(t.closest(t.localPeer.kadId,NS)),o=s.difference(i),a=i.difference(s);Promise.resolve().then(async()=>{for(const l of o)await this.components.peerStore.merge(l,{tags:{[this.tagName]:{value:this.tagValue}}});for(const l of a)await this.components.peerStore.merge(l,{tags:{[this.tagName]:void 0}})}).catch(l=>{this.log.error("Could not update peer tags",l)}),i=s});t.addEventListener("added",s=>{r(),this.safeDispatchEvent("peer:add",{detail:s.detail.peerId})}),t.addEventListener("removed",s=>{r(),this.safeDispatchEvent("peer:remove",{detail:s.detail.peerId})})}async _onPing(t){if(!this.running)return;const{oldContacts:i,newContact:r}=t.detail,o=(await Promise.all(i.map(async a=>{const l=this.pingQueue.find(a.peerId);return l!=null?l.join():this.pingQueue.add(async()=>{let c;try{const u={signal:AbortSignal.timeout(this.pingTimeout)};this.log("pinging old contact %p",a.peerId),c=await(await this.components.connectionManager.openConnection(a.peerId,u)).newStream(this.protocol,u);const p=Ld(c);await p.write({type:br.PING},Ed,u);const m=await p.read(Ed,u);if(await p.unwrap().close(),m.type!==br.PING)throw new Se(`Incorrect message type received, expected PING got ${m.type}`,"ERR_BAD_PING_RESPONSE");return!0}catch(u){return this.running&&this.kb!=null&&(this.log.error("could not ping peer %p",a.peerId,u),this.log("evicting old contact after ping failed %p",a.peerId),this.kb.remove(a.kadId)),c?.abort(u),!1}finally{this.metrics?.routingTableSize.update(this.size)}},{peerId:a.peerId})}))).filter(a=>a).length;this.running&&o<i.length&&this.kb!=null&&(this.log("adding new contact %p",r.peerId),this.kb.add(r))}get size(){return this.kb==null?0:this.kb.count()}async find(t){const i=await cd(t);return this.kb?.get(i)?.peerId}closestPeer(t){const i=this.closestPeers(t,1);if(i.length>0)return i[0]}closestPeers(t,i=this.kBucketSize){return this.kb==null?[]:[...this.kb.closest(t,i)]}async add(t){if(this.kb==null)throw new Error("RoutingTable is not started");const i=await cd(t);this.kb.add({kadId:i,peerId:t}),this.log("added %p with kad id %b",t,i),this.updateMetrics()}async remove(t){if(this.kb==null)throw new Error("RoutingTable is not started");const i=await cd(t);this.kb.remove(i),this.updateMetrics()}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,i=0,r=0;function s(o){if(IS(o)){o.depth>r&&(r=o.depth),i++,t+=o.peers.length;return}s(o.left),s(o.right)}s(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(i),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/i)),this.metrics.routingTableKadBucketMaxDepth.update(r)}}const z8e=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],U4=15;class j8e{constructor(e,t){E(this,"log");E(this,"peerRouting");E(this,"routingTable");E(this,"refreshInterval");E(this,"refreshQueryTimeout");E(this,"commonPrefixLengthRefreshedAt");E(this,"refreshTimeoutId");const{peerRouting:i,routingTable:r,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=i,this.routingTable=r,this.refreshInterval=s??S6e,this.refreshQueryTimeout=o??E6e,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),i=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${i.map(r=>r.toISOString()).join(", ")} ]`),Promise.all(i.map(async(r,s)=>{try{if(await this._refreshCommonPrefixLength(s,r,e),this._numPeersForCpl(t)===0){const o=Math.min(2*(s+1),i.length-1);for(let a=s+1;a<o+1;a++)try{await this._refreshCommonPrefixLength(a,r,e)}catch(l){this.log.error(l)}}}catch(o){this.log.error(o)}})).catch(r=>{this.log.error(r)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(r=>{this.log.error(r)})}async _refreshCommonPrefixLength(e,t,i){if(!i&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const r=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,r,this.routingTable.size);const s=AbortSignal.timeout(this.refreshQueryTimeout);tr(1/0,s);const o=await zee(this.peerRouting.getClosestPeers(r.toBytes(),{signal:s}));this.log(`found ${o} peers that were close to imaginary peer %p`,r),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,r,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>U4&&(e=U4);const t=[];for(let i=0;i<=e;i++)t[i]=this.commonPrefixLengthRefreshedAt[i]??new Date;return t}async _generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");const t=R0(2),i=(t[1]<<8)+t[0],r=await this._makePeerId(this.routingTable.kb.localPeer.kadId,i,e);return gh(r)}async _makePeerId(e,t,i){if(i>U4)throw new Error(`Cannot generate peer ID for common prefix length greater than ${U4}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>i,a=65535<<16-(i+1),l=o&a|t&~a,c=z8e[l],u=new ArrayBuffer(34),h=new DataView(u,0,u.byteLength);return h.setUint8(0,Ir.code),h.setUint8(1,32),h.setUint32(2,c,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const i of this._prefixLengths())i===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb!=null)for(const{kadId:e}of this.routingTable.kb.toIterable()){const t=L2(this.routingTable.kb.localPeer.kadId,e);let i=0;for(const r of t)if(r===0)i++;else break;yield i}}}class V8e{constructor(e,t){E(this,"providers");E(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.providers=t.providers}async handle(e,t){if(this.log("start"),t.key==null||t.key.length===0)throw new Se("Missing key","ERR_MISSING_KEY");let i;try{i=Fi.decode(t.key)}catch{throw new Se("Invalid CID","ERR_INVALID_CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),await Promise.all(t.providers.map(async r=>{if(!e.equals(r.id)){this.log("invalid provider peer %p from %p",r.id,e);return}if(r.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log("received provider %p for %s (addrs %s)",e,i,r.multiaddrs.map(s=>zi(s).toString())),await this.providers.addProvider(i,gh(r.id))}))}}class H8e{constructor(e,t){E(this,"peerRouting");E(this,"peerInfoMapper");E(this,"peerId");E(this,"addressManager");E(this,"log");const{peerRouting:i,logPrefix:r}=t;this.log=e.logger.forComponent(`${r}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(this.log("incoming request from %p for peers closer to %b",e,t.key),t.key==null)throw new Se("Invalid FIND_NODE message received - key was missing","ERR_INVALID_MESSAGE");const i=await this.peerRouting.getCloserPeersOffline(t.key,e);li(this.peerId.toBytes(),t.key)&&i.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(vl("p2p").code))});const r={type:br.FIND_NODE,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toBytes(),multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return r.closer.length===0&&this.log("could not find any peers closer to %b than %p",t.key,e),r}}class $8e{constructor(e,t){E(this,"peerRouting");E(this,"providers");E(this,"peerStore");E(this,"peerInfoMapper");E(this,"log");const{peerRouting:i,providers:r,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerStore=e.peerStore,this.peerRouting=i,this.providers=r,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new Se("Invalid GET_PROVIDERS message received - key was missing","ERR_INVALID_MESSAGE");let i;try{i=Fi.decode(t.key)}catch{throw new Se("Invalid CID","ERR_INVALID_CID")}this.log("%p asking for providers for %s",e,i);const[r,s]=await Promise.all([this.providers.getProviders(i),this.peerRouting.getCloserPeersOffline(t.key,e)]),o=await this._getPeers(r),a=await this._getPeers(s.map(({id:c})=>c)),l={type:br.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:a.map(this.peerInfoMapper).filter(({multiaddrs:c})=>c.length).map(c=>({id:c.id.toBytes(),multiaddrs:c.multiaddrs.map(u=>u.bytes)})),providers:o.map(this.peerInfoMapper).filter(({multiaddrs:c})=>c.length).map(c=>({id:c.id.toBytes(),multiaddrs:c.multiaddrs.map(u=>u.bytes)}))};return this.log("got %s providers %s closerPeers",l.providers.length,l.closer.length),l}async _getAddresses(e){return[]}async _getPeers(e){const t=[];for(const i of e)try{const r=await this.peerStore.get(i),s=this.peerInfoMapper({id:i,multiaddrs:r.addresses.map(({multiaddr:o})=>o)});s.multiaddrs.length>0&&t.push(s)}catch(r){if(r.code!=="ERR_NOT_FOUND")throw r}return t}}class G8e{constructor(e,t){E(this,"peerStore");E(this,"datastore");E(this,"peerRouting");E(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const i=t.key;if(this.log("%p asked for key %b",e,i),i==null||i.length===0)throw new Se("Invalid key","ERR_INVALID_KEY");const r={type:br.GET_VALUE,key:i,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(a8e(i)){this.log("is public key");const a=l8e(i);let l;try{const c=await this.peerStore.get(a);if(c.id.publicKey==null)throw new Se("No public key found in key book","ERR_NOT_FOUND");l=c.id.publicKey}catch(c){if(c.code!=="ERR_NOT_FOUND")throw c}if(l!=null)return this.log("returning found public key"),r.record=new fc(i,l,new Date).serialize(),r}const[s,o]=await Promise.all([this._checkLocalDatastore(i),this.peerRouting.getCloserPeersOffline(i,e)]);return s!=null&&(this.log("had record for %b in local datastore",i),r.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),r.closer=o.map(a=>({id:a.id.toBytes(),multiaddrs:a.multiaddrs.map(l=>l.bytes)}))),r}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=S3(e);let i;try{i=await this.datastore.get(t)}catch(s){if(s.code==="ERR_NOT_FOUND")return;throw s}const r=fc.deserialize(i);if(r==null)throw new Se("Invalid record","ERR_INVALID_RECORD");if(r.timeReceived==null||Date.now()-r.timeReceived.getTime()>p6e){await this.datastore.delete(t);return}return r}}class W8e{constructor(e,t){E(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class K8e{constructor(e,t){E(this,"components");E(this,"validators");E(this,"log");const{validators:i}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.validators=i}async handle(e,t){const i=t.key;if(this.log("%p asked us to store value for key %b",e,i),t.record==null){const r=`Empty record from: ${e.toString()}`;throw this.log.error(r),new Se(r,"ERR_EMPTY_RECORD")}try{const r=fc.deserialize(t.record);await oD(this.validators,r),r.timeReceived=new Date;const s=S3(r.key);await this.components.datastore.put(s,r.serialize().subarray()),this.log("put record for %b into datastore under key %k",i,s)}catch(r){this.log("did not put record for key %b into datastore %o",i,r)}return t}}let q8e=class{constructor(e,t){E(this,"handlers");E(this,"routingTable");E(this,"log");const{providers:i,peerRouting:r,validators:s,logPrefix:o,peerInfoMapper:a}=t;this.log=e.logger.forComponent(`${o}:rpc`),this.routingTable=t.routingTable,this.handlers={[br.GET_VALUE.toString()]:new G8e(e,{peerRouting:r,logPrefix:o}),[br.PUT_VALUE.toString()]:new K8e(e,{validators:s,logPrefix:o}),[br.FIND_NODE.toString()]:new H8e(e,{peerRouting:r,logPrefix:o,peerInfoMapper:a}),[br.ADD_PROVIDER.toString()]:new V8e(e,{providers:i,logPrefix:o}),[br.GET_PROVIDERS.toString()]:new $8e(e,{peerRouting:r,providers:i,logPrefix:o,peerInfoMapper:a}),[br.PING.toString()]:new W8e(e,{logPrefix:o})}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(r){this.log.error("Failed to update the kbucket store",r)}const i=this.handlers[t.type];if(i==null){this.log.error(`no handler found for message type: ${t.type}`);return}return i.handle(e,t)}onIncomingStream(e){Promise.resolve().then(async()=>{const{stream:t,connection:i}=e,r=i.remotePeer;try{await this.routingTable.add(r)}catch(o){this.log.error(o)}const s=this;await Qa(t,o=>I2(o),async function*(o){for await(const a of o){const l=Ed.decode(a);s.log("incoming %s from %p",l.type,r);const c=await s.handleMessage(r,l);c!=null&&(yield Ed.encode(c))}},o=>Zm(o),t)}).catch(t=>{this.log.error(t)})}};class Z8e extends yc{constructor(t,i){super();E(this,"log");E(this,"components");E(this,"protocol");E(this,"running");E(this,"registrarId");const{protocol:r,logPrefix:s}=i;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=r}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new ko("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class Y8e{constructor(e){E(this,"dht");this.dht=e}async provide(e,t={}){await V6(this.dht.provide(e,t))}async*findProviders(e,t={}){for await(const i of this.dht.findProviders(e,t))i.name==="PROVIDER"&&(yield*i.providers)}async put(e,t,i){await V6(this.dht.put(e,t,i))}async get(e,t){for await(const i of this.dht.get(e,t))if(i.name==="VALUE")return i.value;throw new Se("Not found","ERR_NOT_FOUND")}}class X8e{constructor(e){E(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const i of this.dht.findPeer(e,t))if(i.name==="FINAL_PEER")return i.peer;throw new Se("Not found","ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){for await(const i of this.dht.getClosestPeers(e,t))i.name==="FINAL_PEER"&&(yield i.peer)}}const Q8e=32,J8e=64;var MFe,RFe,IFe;class eEe extends yc{constructor(t,i={}){super();E(this,"protocol");E(this,"routingTable");E(this,"providers");E(this,"network");E(this,"peerRouting");E(this,"components");E(this,"log");E(this,"running");E(this,"kBucketSize");E(this,"clientMode");E(this,"validators");E(this,"selectors");E(this,"queryManager");E(this,"contentFetching");E(this,"contentRouting");E(this,"routingTableRefresh");E(this,"rpc");E(this,"topologyListener");E(this,"querySelf");E(this,"maxInboundStreams");E(this,"maxOutboundStreams");E(this,"dhtContentRouting");E(this,"dhtPeerRouting");E(this,"peerInfoMapper");E(this,MFe,"@libp2p/kad-dht");E(this,RFe,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery"]);E(this,IFe,["@libp2p/identify"]);const{kBucketSize:r,clientMode:s,validators:o,selectors:a,querySelfInterval:l,protocol:c,logPrefix:u,pingTimeout:h,pingConcurrency:p,maxInboundStreams:m,maxOutboundStreams:y,providers:b}=i,w=u??"libp2p:kad-dht";this.running=!1,this.components=t,this.log=t.logger.forComponent(w),this.protocol=c??m6e,this.kBucketSize=r??20,this.clientMode=s??!0,this.maxInboundStreams=m??Q8e,this.maxOutboundStreams=y??J8e,this.peerInfoMapper=i.peerInfoMapper??s8e,this.routingTable=new F8e(t,{kBucketSize:r,pingTimeout:h,pingConcurrency:p,protocol:this.protocol,logPrefix:w}),this.providers=new T8e(t,b??{}),this.validators={...i8e,...o},this.selectors={...t8e,...a},this.network=new b8e(t,{protocol:this.protocol,logPrefix:w});const v=Ki();i.allowQueryWithZeroPeers===!0&&v.resolve(),this.queryManager=new R8e(t,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:w,initialQuerySelfHasRun:v,routingTable:this.routingTable}),this.peerRouting=new _8e(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:w}),this.contentFetching=new y8e(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:w}),this.contentRouting=new v8e(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:w}),this.routingTableRefresh=new j8e(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:w}),this.rpc=new q8e(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:w,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new Z8e(t,{protocol:this.protocol,logPrefix:w}),this.querySelf=new N8e(t,{peerRouting:this.peerRouting,interval:l,initialInterval:i.initialQuerySelfInterval,logPrefix:w,initialQuerySelfHasRun:v,routingTable:this.routingTable}),this.network.addEventListener("peer",T=>{const S=T.detail;this.onPeerConnect(S).catch(M=>{this.log.error("could not add %p to routing table",S.id,M)}),this.dispatchEvent(new ko("peer",{detail:S}))}),this.topologyListener.addEventListener("peer",T=>{const S=T.detail;Promise.resolve().then(async()=>{const M=await this.components.peerStore.get(S),P={id:S,multiaddrs:M.addresses.map(({multiaddr:R})=>R),protocols:M.protocols};await this.onPeerConnect(P)}).catch(M=>{this.log.error("could not add %p to routing table",S,M)})}),this.dhtPeerRouting=new X8e(this),this.dhtContentRouting=new Y8e(this),i.clientMode==null&&t.events.addEventListener("self:peer:update",T=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const S=T.detail.peer.addresses.some(({multiaddr:P})=>g8e(P)),M=this.getMode();S&&M==="client"?await this.setMode("server"):M==="server"&&!S&&await this.setMode("client")}).catch(S=>{this.log.error("error setting dht server mode",S)})})}get[(MFe=Symbol.toStringTag,RFe=kd,IFe=w6,HR)](){return this.dhtContentRouting}get[$R](){return this.dhtPeerRouting}get[b6](){return this}async onPeerConnect(t){if(this.log("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(i=>i.toString()));return}try{await this.routingTable.add(t.id)}catch(i){this.log.error("could not add %p to routing table",t.id,i)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t){await this.components.registrar.unhandle(this.protocol),t==="client"?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await rce(this.querySelf,this.providers,this.queryManager,this.network,this.routingTable,this.topologyListener,this.routingTableRefresh)}async stop(){this.running=!1,await sce(this.querySelf,this.providers,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener)}async*put(t,i,r={}){yield*this.contentFetching.put(t,i,r)}async*get(t,i={}){yield*this.contentFetching.get(t,i)}async*provide(t,i={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),i)}async*findProviders(t,i={}){yield*this.contentRouting.findProviders(t,i)}async*findPeer(t,i={}){yield*this.peerRouting.findPeer(t,i)}async*getClosestPeers(t,i={}){yield*this.peerRouting.getClosestPeers(t,i)}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var Cj;(function(n){n[n.SEND_QUERY=0]="SEND_QUERY",n[n.PEER_RESPONSE=1]="PEER_RESPONSE",n[n.FINAL_PEER=2]="FINAL_PEER",n[n.QUERY_ERROR=3]="QUERY_ERROR",n[n.PROVIDER=4]="PROVIDER",n[n.VALUE=5]="VALUE",n[n.ADD_PEER=6]="ADD_PEER",n[n.DIAL_PEER=7]="DIAL_PEER"})(Cj||(Cj={}));function tEe(n={}){return e=>new eEe(e,n)}const fx=1e3,aD=60*fx,Mj="/floodsub/1.0.0",Rj="/meshsub/1.0.0",Ij="/meshsub/1.1.0",nEe=6,iEe=4,rEe=12,sEe=4,oEe=2,aEe=5,lEe=3,cEe=6,uEe=.25,hEe=3,Nj=100,dEe=fx,fEe=aD,pEe=16,mEe=aD,gEe=10*fx,yEe=15,xEe=300,vEe=fx,bEe=60,_Ee=2,wEe=10*fx,rg=5e3,SEe=10,EEe=3*fx,TEe=2*aD,AEe=120*1e3,CEe="ERR_TOPIC_VALIDATOR_REJECT",MEe="ERR_TOPIC_VALIDATOR_IGNORE",REe=0,IEe=128,NEe=1e3,PEe=1e3,kEe=1,LEe={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var Nm;(function(n){(function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.subscribe!=null&&(s.uint32(8),s.bool(r.subscribe)),r.topic!=null&&(s.uint32(18),s.string(r.topic)),o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{a.subscribe=r.bool();break}case 2:{a.topic=r.string();break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)})(n.SubOpts||(n.SubOpts={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.from!=null&&(s.uint32(10),s.bytes(r.from)),r.data!=null&&(s.uint32(18),s.bytes(r.data)),r.seqno!=null&&(s.uint32(26),s.bytes(r.seqno)),r.topic!=null&&r.topic!==""&&(s.uint32(34),s.string(r.topic)),r.signature!=null&&(s.uint32(42),s.bytes(r.signature)),r.key!=null&&(s.uint32(50),s.bytes(r.key)),o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={topic:""},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{a.from=r.bytes();break}case 2:{a.data=r.bytes();break}case 3:{a.seqno=r.bytes();break}case 4:{a.topic=r.string();break}case 5:{a.signature=r.bytes();break}case 6:{a.key=r.bytes();break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.Message||(n.Message={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),r.ihave!=null)for(const a of r.ihave)s.uint32(10),n.ControlIHave.codec().encode(a,s);if(r.iwant!=null)for(const a of r.iwant)s.uint32(18),n.ControlIWant.codec().encode(a,s);if(r.graft!=null)for(const a of r.graft)s.uint32(26),n.ControlGraft.codec().encode(a,s);if(r.prune!=null)for(const a of r.prune)s.uint32(34),n.ControlPrune.codec().encode(a,s);o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={ihave:[],iwant:[],graft:[],prune:[]},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{if(o.limits?.ihave!=null&&a.ihave.length===o.limits.ihave)throw new zc('decode error - map field "ihave" had too many elements',"ERR_MAX_LENGTH");a.ihave.push(n.ControlIHave.codec().decode(r,r.uint32()));break}case 2:{if(o.limits?.iwant!=null&&a.iwant.length===o.limits.iwant)throw new zc('decode error - map field "iwant" had too many elements',"ERR_MAX_LENGTH");a.iwant.push(n.ControlIWant.codec().decode(r,r.uint32()));break}case 3:{if(o.limits?.graft!=null&&a.graft.length===o.limits.graft)throw new zc('decode error - map field "graft" had too many elements',"ERR_MAX_LENGTH");a.graft.push(n.ControlGraft.codec().decode(r,r.uint32()));break}case 4:{if(o.limits?.prune!=null&&a.prune.length===o.limits.prune)throw new zc('decode error - map field "prune" had too many elements',"ERR_MAX_LENGTH");a.prune.push(n.ControlPrune.codec().decode(r,r.uint32()));break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.ControlMessage||(n.ControlMessage={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),r.topicID!=null&&(s.uint32(10),s.string(r.topicID)),r.messageIDs!=null)for(const a of r.messageIDs)s.uint32(18),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={messageIDs:[]},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{a.topicID=r.string();break}case 2:{if(o.limits?.messageIDs!=null&&a.messageIDs.length===o.limits.messageIDs)throw new zc('decode error - map field "messageIDs" had too many elements',"ERR_MAX_LENGTH");a.messageIDs.push(r.bytes());break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.ControlIHave||(n.ControlIHave={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),r.messageIDs!=null)for(const a of r.messageIDs)s.uint32(10),s.bytes(a);o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={messageIDs:[]},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{if(o.limits?.messageIDs!=null&&a.messageIDs.length===o.limits.messageIDs)throw new zc('decode error - map field "messageIDs" had too many elements',"ERR_MAX_LENGTH");a.messageIDs.push(r.bytes());break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.ControlIWant||(n.ControlIWant={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.topicID!=null&&(s.uint32(10),s.string(r.topicID)),o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{a.topicID=r.string();break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.ControlGraft||(n.ControlGraft={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{if(o.lengthDelimited!==!1&&s.fork(),r.topicID!=null&&(s.uint32(10),s.string(r.topicID)),r.peers!=null)for(const a of r.peers)s.uint32(18),n.PeerInfo.codec().encode(a,s);r.backoff!=null&&(s.uint32(24),s.uint64Number(r.backoff)),o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={peers:[]},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{a.topicID=r.string();break}case 2:{if(o.limits?.peers!=null&&a.peers.length===o.limits.peers)throw new zc('decode error - map field "peers" had too many elements',"ERR_MAX_LENGTH");a.peers.push(n.PeerInfo.codec().decode(r,r.uint32()));break}case 3:{a.backoff=r.uint64Number();break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.ControlPrune||(n.ControlPrune={})),function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.peerID!=null&&(s.uint32(10),s.bytes(r.peerID)),r.signedPeerRecord!=null&&(s.uint32(18),s.bytes(r.signedPeerRecord)),o.lengthDelimited!==!1&&s.ldelim()},(r,s,o={})=>{const a={},l=s==null?r.len:r.pos+s;for(;r.pos<l;){const c=r.uint32();switch(c>>>3){case 1:{a.peerID=r.bytes();break}case 2:{a.signedPeerRecord=r.bytes();break}default:{r.skipType(c&7);break}}}return a})),i),t.encode=r=>Ti(r,t.codec()),t.decode=(r,s)=>Ei(r,t.codec(),s)}(n.PeerInfo||(n.PeerInfo={}));let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.subscriptions!=null)for(const s of t.subscriptions)i.uint32(10),n.SubOpts.codec().encode(s,i);if(t.messages!=null)for(const s of t.messages)i.uint32(18),n.Message.codec().encode(s,i);t.control!=null&&(i.uint32(26),n.ControlMessage.codec().encode(t.control,i)),r.lengthDelimited!==!1&&i.ldelim()},(t,i,r={})=>{const s={subscriptions:[],messages:[]},o=i==null?t.len:t.pos+i;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{if(r.limits?.subscriptions!=null&&s.subscriptions.length===r.limits.subscriptions)throw new zc('decode error - map field "subscriptions" had too many elements',"ERR_MAX_LENGTH");s.subscriptions.push(n.SubOpts.codec().decode(t,t.uint32()));break}case 2:{if(r.limits?.messages!=null&&s.messages.length===r.limits.messages)throw new zc('decode error - map field "messages" had too many elements',"ERR_MAX_LENGTH");s.messages.push(n.Message.codec().decode(t,t.uint32()));break}case 3:{s.control=n.ControlMessage.codec().decode(t,t.uint32());break}default:{t.skipType(a&7);break}}}return s})),e),n.encode=t=>Ti(t,n.codec()),n.decode=(t,i)=>Ei(t,n.codec(),i)})(Nm||(Nm={}));class DEe{constructor(e,t,i){E(this,"gossip");E(this,"msgs",new Map);E(this,"msgIdToStrFn");E(this,"history",[]);E(this,"notValidatedCount",0);this.gossip=e,this.msgIdToStrFn=i;for(let r=0;r<t;r++)this.history[r]=[]}get size(){return this.msgs.size}put(e,t,i=!1){const{msgIdStr:r}=e;return this.msgs.has(r)?!1:(this.msgs.set(r,{message:t,validated:i,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),i||this.notValidatedCount++,!0)}observeDuplicate(e,t){const i=this.msgs.get(e);i!=null&&!i.validated&&i.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const i=this.msgs.get(e);if(i==null)return null;const r=(i.iwantCounts.get(t)??0)+1;return i.iwantCounts.set(t,r),{msg:i.message,count:r}}getGossipIDs(e){const t=new Map;for(let i=0;i<this.gossip;i++)this.history[i].forEach(r=>{if((this.msgs.get(r.msgIdStr)?.validated??!1)&&e.has(r.topic)){let o=t.get(r.topic);o==null&&(o=[],t.set(r.topic,o)),o.push(r.msgId)}});return t}validate(e){const t=this.msgs.get(e);if(t==null)return null;t.validated||this.notValidatedCount--;const{message:i,originatingPeers:r}=t;return t.validated=!0,t.originatingPeers=new Set,{message:i,originatingPeers:r}}shift(){this.history[this.history.length-1].forEach(t=>{const i=this.msgs.get(t.msgIdStr);i!=null&&(this.msgs.delete(t.msgIdStr),i.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t==null?null:(this.msgs.delete(e),t)}}var Pj;(function(n){n.StrictSign="StrictSign",n.StrictNoSign="StrictNoSign"})(Pj||(Pj={}));var H2;(function(n){n[n.Signing=0]="Signing",n[n.Anonymous=1]="Anonymous"})(H2||(H2={}));var au;(function(n){n.Error="error",n.Ignore="ignore",n.Reject="reject",n.Blacklisted="blacklisted"})(au||(au={}));var Ra;(function(n){n.InvalidSignature="invalid_signature",n.InvalidSeqno="invalid_seqno",n.InvalidPeerId="invalid_peerid",n.SignaturePresent="signature_present",n.SeqnoPresent="seqno_present",n.FromPresent="from_present",n.TransformFailed="transform_failed"})(Ra||(Ra={}));var Na;(function(n){n.duplicate="duplicate",n.invalid="invalid",n.valid="valid"})(Na||(Na={}));function kj(n){switch(n){case nc.Ignore:return au.Ignore;case nc.Reject:return au.Reject;default:throw new Error("Unreachable")}}var Lj;(function(n){n.forward="forward",n.publish="publish"})(Lj||(Lj={}));var Da;(function(n){n.Fanout="fanout",n.Random="random",n.Subscribed="subscribed",n.Outbound="outbound",n.NotEnough="not_enough",n.Opportunistic="opportunistic"})(Da||(Da={}));var eh;(function(n){n.Dc="disconnected",n.BadScore="bad_score",n.Prune="prune",n.Excess="excess"})(eh||(eh={}));var T3;(function(n){n.GraftBackoff="graft_backoff",n.BrokenPromise="broken_promise",n.MessageDeficit="message_deficit",n.IPColocation="IP_colocation"})(T3||(T3={}));var A3;(function(n){n.LowScore="low_score",n.MaxIhave="max_ihave",n.MaxIasked="max_iasked"})(A3||(A3={}));var cy;(function(n){n.graylist="graylist",n.publish="publish",n.gossip="gossip",n.mesh="mesh"})(cy||(cy={}));function OEe(n,e,t){return{protocolsEnabled:n.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:n.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:n.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:n.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:n.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:n.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:n.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:n.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:n.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:n.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:n.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:n.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:n.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:n.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:n.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:n.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:n.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:n.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:n.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:n.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:n.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:n.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:n.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:n.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:n.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:n.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:n.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:n.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:n.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:n.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:n.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:n.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:n.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:n.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:n.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:n.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:n.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:n.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:n.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:n.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:n.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:n.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:n.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:n.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:n.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:n.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:n.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:n.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:n.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:n.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:n.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:n.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:n.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:n.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:n.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:n.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:n.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:n.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:n.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:n.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:n.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*t.maxMeshMessageDeliveriesWindowSec,.5*t.maxMeshMessageDeliveriesWindowSec,Number(t.maxMeshMessageDeliveriesWindowSec),2*t.maxMeshMessageDeliveriesWindowSec,4*t.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:n.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:n.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:n.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:n.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:n.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:n.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:n.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:n.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:n.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:n.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:n.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*t.behaviourPenaltyThreshold,.5*t.behaviourPenaltyThreshold,Number(t.behaviourPenaltyThreshold),2*t.behaviourPenaltyThreshold,4*t.behaviourPenaltyThreshold]}),ihaveRcvIgnored:n.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:n.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:n.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:n.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:n.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:n.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:n.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:n.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:n.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:n.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:n.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:n.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*t.gossipPromiseExpireSec,Number(t.gossipPromiseExpireSec),2*t.gossipPromiseExpireSec,4*t.gossipPromiseExpireSec]}),iwantPromiseUntracked:n.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:n.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:n.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:n.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:n.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:n.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:n.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(i){return this.topicStrToLabel.get(i)??i},onJoin(i){this.topicSubscriptionStatus.set({topicStr:i},1),this.meshPeerCounts.set({topicStr:i},0)},onLeave(i){this.topicSubscriptionStatus.set({topicStr:i},0),this.meshPeerCounts.set({topicStr:i},0)},onAddToMesh(i,r,s){const o=this.toTopic(i);switch(r){case Da.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:o},s);break;case Da.Random:this.meshPeerInclusionEventsRandom.inc({topic:o},s);break;case Da.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:o},s);break;case Da.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:o},s);break;case Da.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:o},s);break;case Da.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:o},s);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:o},s);break}},onRemoveFromMesh(i,r,s){const o=this.toTopic(i);switch(r){case eh.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:o},s);break;case eh.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:o},s);break;case eh.Prune:this.meshPeerChurnEventsPrune.inc({topic:o},s);break;case eh.Excess:this.meshPeerChurnEventsExcess.inc({topic:o},s);break;default:this.meshPeerChurnEventsUnknown.inc({topic:o},s);break}},onReportValidation(i,r,s){if(this.asyncValidationMcacheHit.inc({hit:i!=null?"hit":"miss"}),i!=null){const o=this.toTopic(i.message.topic);switch(r){case nc.Accept:this.acceptedMessagesTotal.inc({topic:o});break;case nc.Ignore:this.ignoredMessagesTotal.inc({topic:o});break;case nc.Reject:this.rejectedMessagesTotal.inc({topic:o});break;default:this.unknownValidationResultsTotal.inc({topic:o});break}}s!=null?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-s)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(i){this.scoringPenalties.inc({penalty:i},1)},onIhaveRcv(i,r,s){const o=this.toTopic(i);this.ihaveRcvMsgids.inc({topic:o},r),this.ihaveRcvNotSeenMsgids.inc({topic:o},s)},onIwantRcv(i,r){for(const[s,o]of i){const a=this.toTopic(s);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(r)},onForwardMsg(i,r){const s=this.toTopic(i);this.msgForwardCount.inc({topic:s},1),this.msgForwardPeers.inc({topic:s},r)},onPublishMsg(i,r,s,o,a){const l=this.toTopic(i);this.msgPublishCount.inc({topic:l},1),this.msgPublishBytes.inc({topic:l},s*o),this.msgPublishPeersByTopic.inc({topic:l},s),this.directPeersPublishedTotal.inc({topic:l},r.direct),this.floodsubPeersPublishedTotal.inc({topic:l},r.floodsub),this.meshPeersPublishedTotal.inc({topic:l},r.mesh),this.fanoutPeersPublishedTotal.inc({topic:l},r.fanout),this.msgPublishTime.observe({topic:l},a/1e3)},onMsgRecvPreValidation(i){const r=this.toTopic(i);this.msgReceivedPreValidation.inc({topic:r},1)},onMsgRecvError(i){const r=this.toTopic(i);this.msgReceivedError.inc({topic:r},1)},onPrevalidationResult(i,r){const s=this.toTopic(i);switch(r){case Na.duplicate:this.prevalidationDuplicateTotal.inc({topic:s});break;case Na.invalid:this.prevalidationInvalidTotal.inc({topic:s});break;case Na.valid:this.prevalidationValidTotal.inc({topic:s});break;default:this.prevalidationUnknownTotal.inc({topic:s});break}},onMsgRecvInvalid(i,r){const s=this.toTopic(i),o=r.reason===au.Error?r.error:r.reason;this.msgReceivedInvalid.inc({error:o},1),this.msgReceivedInvalidByTopic.inc({topic:s},1)},onDuplicateMsgDelivery(i,r,s){const o=this.toTopic(i);this.duplicateMsgDeliveryDelay.observe({topic:o},r/1e3),s&&this.duplicateMsgLateDelivery.inc({topic:o},1)},onPublishDuplicateMsg(i){const r=this.toTopic(i);this.duplicateMsgIgnored.inc({topic:r},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(i,r){this.rpcRecvBytes.inc(r),this.rpcRecvCount.inc(1),i.subscriptions!=null&&this.rpcRecvSubscription.inc(i.subscriptions.length),i.messages!=null&&this.rpcRecvMessage.inc(i.messages.length),i.control!=null&&(this.rpcRecvControl.inc(1),i.control.ihave!=null&&this.rpcRecvIHave.inc(i.control.ihave.length),i.control.iwant!=null&&this.rpcRecvIWant.inc(i.control.iwant.length),i.control.graft!=null&&this.rpcRecvGraft.inc(i.control.graft.length),i.control.prune!=null&&this.rpcRecvPrune.inc(i.control.prune.length))},onRpcSent(i,r){if(this.rpcSentBytes.inc(r),this.rpcSentCount.inc(1),i.subscriptions!=null&&this.rpcSentSubscription.inc(i.subscriptions.length),i.messages!=null&&this.rpcSentMessage.inc(i.messages.length),i.control!=null){const s=i.control.ihave?.length??0,o=i.control.iwant?.length??0,a=i.control.graft?.length??0,l=i.control.prune?.length??0;s>0&&this.rpcSentIHave.inc(s),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),l>0&&this.rpcSentPrune.inc(l),(s>0||o>0||a>0||l>0)&&this.rpcSentControl.inc(1)}},registerScores(i,r){let s=0,o=0,a=0,l=0;for(const c of i)c>=r.graylistThreshold&&s++,c>=r.publishThreshold&&o++,c>=r.gossipThreshold&&a++,c>=0&&l++;this.peersByScoreThreshold.set({threshold:cy.graylist},s),this.peersByScoreThreshold.set({threshold:cy.publish},o),this.peersByScoreThreshold.set({threshold:cy.gossip},a),this.peersByScoreThreshold.set({threshold:cy.mesh},l),this.score.set(i)},registerScoreWeights(i){for(const[r,s]of i.byTopic)this.scoreWeights.set({topic:r,p:"p1"},s.p1w),this.scoreWeights.set({topic:r,p:"p2"},s.p2w),this.scoreWeights.set({topic:r,p:"p3"},s.p3w),this.scoreWeights.set({topic:r,p:"p3b"},s.p3bw),this.scoreWeights.set({topic:r,p:"p4"},s.p4w);this.scoreWeights.set({p:"p5"},i.p5w),this.scoreWeights.set({p:"p6"},i.p6w),this.scoreWeights.set({p:"p7"},i.p7w)},registerScorePerMesh(i,r){const s=new Map;i.forEach((o,a)=>{const l=this.topicStrToLabel.get(a)??"unknown";let c=s.get(l);c==null&&(c=new Set,s.set(l,c)),o.forEach(u=>c?.add(u))});for(const[o,a]of s){const l=[];a.forEach(c=>{l.push(r.get(c)??0)}),this.scorePerMesh.set({topic:o},l)}}}}const dr="ERR_INVALID_PEER_SCORE_PARAMS",BEe={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},UEe={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function FEe(n={}){return{...BEe,...n,topics:n.topics!=null?Object.entries(n.topics).reduce((e,[t,i])=>(e[t]=zEe(i),e),{}):{}}}function zEe(n={}){return{...UEe,...n}}function jEe(n){for(const[e,t]of Object.entries(n.topics))try{VEe(t)}catch(i){throw new Se(`invalid score parameters for topic ${e}: ${i.message}`,dr)}if(n.topicScoreCap<0)throw new Se("invalid topic score cap; must be positive (or 0 for no cap)",dr);if(n.appSpecificScore===null||n.appSpecificScore===void 0)throw new Se("missing application specific score function",dr);if(n.IPColocationFactorWeight>0)throw new Se("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",dr);if(n.IPColocationFactorWeight!==0&&n.IPColocationFactorThreshold<1)throw new Se("invalid IPColocationFactorThreshold; must be at least 1",dr);if(n.behaviourPenaltyWeight>0)throw new Se("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",dr);if(n.behaviourPenaltyWeight!==0&&(n.behaviourPenaltyDecay<=0||n.behaviourPenaltyDecay>=1))throw new Se("invalid BehaviourPenaltyDecay; must be between 0 and 1",dr);if(n.decayInterval<1e3)throw new Se("invalid DecayInterval; must be at least 1s",dr);if(n.decayToZero<=0||n.decayToZero>=1)throw new Se("invalid DecayToZero; must be between 0 and 1",dr)}function VEe(n){if(n.topicWeight<0)throw new Se("invalid topic weight; must be >= 0",dr);if(n.timeInMeshQuantum===0)throw new Se("invalid TimeInMeshQuantum; must be non zero",dr);if(n.timeInMeshWeight<0)throw new Se("invalid TimeInMeshWeight; must be positive (or 0 to disable)",dr);if(n.timeInMeshWeight!==0&&n.timeInMeshQuantum<=0)throw new Se("invalid TimeInMeshQuantum; must be positive",dr);if(n.timeInMeshWeight!==0&&n.timeInMeshCap<=0)throw new Se("invalid TimeInMeshCap; must be positive",dr);if(n.firstMessageDeliveriesWeight<0)throw new Se("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",dr);if(n.firstMessageDeliveriesWeight!==0&&(n.firstMessageDeliveriesDecay<=0||n.firstMessageDeliveriesDecay>=1))throw new Se("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",dr);if(n.firstMessageDeliveriesWeight!==0&&n.firstMessageDeliveriesCap<=0)throw new Se("invalid FirstMessageDeliveriesCap; must be positive",dr);if(n.meshMessageDeliveriesWeight>0)throw new Se("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",dr);if(n.meshMessageDeliveriesWeight!==0&&(n.meshMessageDeliveriesDecay<=0||n.meshMessageDeliveriesDecay>=1))throw new Se("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",dr);if(n.meshMessageDeliveriesWeight!==0&&n.meshMessageDeliveriesCap<=0)throw new Se("invalid MeshMessageDeliveriesCap; must be positive",dr);if(n.meshMessageDeliveriesWeight!==0&&n.meshMessageDeliveriesThreshold<=0)throw new Se("invalid MeshMessageDeliveriesThreshold; must be positive",dr);if(n.meshMessageDeliveriesWindow<0)throw new Se("invalid MeshMessageDeliveriesWindow; must be non-negative",dr);if(n.meshMessageDeliveriesWeight!==0&&n.meshMessageDeliveriesActivation<1e3)throw new Se("invalid MeshMessageDeliveriesActivation; must be at least 1s",dr);if(n.meshFailurePenaltyWeight>0)throw new Se("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",dr);if(n.meshFailurePenaltyWeight!==0&&(n.meshFailurePenaltyDecay<=0||n.meshFailurePenaltyDecay>=1))throw new Se("invalid MeshFailurePenaltyDecay; must be between 0 and 1",dr);if(n.invalidMessageDeliveriesWeight>0)throw new Se("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",dr);if(n.invalidMessageDeliveriesDecay<=0||n.invalidMessageDeliveriesDecay>=1)throw new Se("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",dr)}const HEe={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function $Ee(n={}){return{...HEe,...n}}function mN(n,e,t=()=>!0){const i=new Set;if(e<=0)return i;for(const r of n){if(i.size>=e)break;t(r)&&(i.add(r),n.delete(r))}return i}function GEe(n,e){return mN(n,e,()=>!0)}class WEe extends Map{constructor(t){super();E(this,"getDefault");this.getDefault=t}getOrDefault(t){let i=super.get(t);return i===void 0&&(i=this.getDefault(),this.set(t,i)),i}}function KEe(n,e,t,i){let r=0;Object.entries(e.topics).forEach(([o,a])=>{const l=t.topics[o];if(l===void 0)return;let c=0;if(a.inMesh){let m=a.meshTime/l.timeInMeshQuantum;m>l.timeInMeshCap&&(m=l.timeInMeshCap),c+=m*l.timeInMeshWeight}let u=a.firstMessageDeliveries;if(u>l.firstMessageDeliveriesCap&&(u=l.firstMessageDeliveriesCap),c+=u*l.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<l.meshMessageDeliveriesThreshold){const m=l.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,y=m*m;c+=y*l.meshMessageDeliveriesWeight}const h=a.meshFailurePenalty;c+=h*l.meshFailurePenaltyWeight;const p=a.invalidMessageDeliveries*a.invalidMessageDeliveries;c+=p*l.invalidMessageDeliveriesWeight,r+=c*l.topicWeight}),t.topicScoreCap>0&&r>t.topicScoreCap&&(r=t.topicScoreCap);const s=t.appSpecificScore(n);if(r+=s*t.appSpecificWeight,e.knownIPs.forEach(o=>{if(t.IPColocationFactorWhitelist.has(o))return;const a=i.get(o),l=a!=null?a.size:0;if(l>t.IPColocationFactorThreshold){const c=l-t.IPColocationFactorThreshold,u=c*c;r+=u*t.IPColocationFactorWeight}}),e.behaviourPenalty>t.behaviourPenaltyThreshold){const o=e.behaviourPenalty-t.behaviourPenaltyThreshold,a=o*o;r+=a*t.behaviourPenaltyWeight}return r}function Hr(n,t){var t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(n)?this._fromArray(n):(this._capacityMask=3,this._list=new Array(4))}Hr.prototype.peekAt=function(e){var t=e;if(t===(t|0)){var i=this.size();if(!(t>=i||t<-i))return t<0&&(t+=i),t=this._head+t&this._capacityMask,this._list[t]}};Hr.prototype.get=function(e){return this.peekAt(e)};Hr.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};Hr.prototype.peekFront=function(){return this.peek()};Hr.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(Hr.prototype,"length",{get:function(){return this.size()}});Hr.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Hr.prototype.unshift=function(e){if(arguments.length===0)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Hr.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}};Hr.prototype.push=function(e){if(arguments.length===0)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};Hr.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var i=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),i}};Hr.prototype.removeOne=function(e){var t=e;if(t===(t|0)&&this._head!==this._tail){var i=this.size(),r=this._list.length;if(!(t>=i||t<-i)){t<0&&(t+=i),t=this._head+t&this._capacityMask;var s=this._list[t],o;if(e<i/2){for(o=e;o>0;o--)this._list[t]=this._list[t=t-1+r&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(o=i-1-e;o>0;o--)this._list[t]=this._list[t=t+1+r&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+r&this._capacityMask}return s}}};Hr.prototype.remove=function(e,t){var i=e,r,s=t;if(i===(i|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(i>=o||i<-o||t<1)){if(i<0&&(i+=o),t===1||!t)return r=new Array(1),r[0]=this.removeOne(i),r;if(i===0&&i+t>=o)return r=this.toArray(),this.clear(),r;i+t>o&&(t=o-i);var l;for(r=new Array(t),l=0;l<t;l++)r[l]=this._list[this._head+i+l&this._capacityMask];if(i=this._head+i&this._capacityMask,e+t===o){for(this._tail=this._tail-t+a&this._capacityMask,l=t;l>0;l--)this._list[i=i+1+a&this._capacityMask]=void 0;return r}if(e===0){for(this._head=this._head+t+a&this._capacityMask,l=t-1;l>0;l--)this._list[i=i+1+a&this._capacityMask]=void 0;return r}if(i<o/2){for(this._head=this._head+e+t+a&this._capacityMask,l=e;l>0;l--)this.unshift(this._list[i=i-1+a&this._capacityMask]);for(i=this._head-1+a&this._capacityMask;s>0;)this._list[i=i-1+a&this._capacityMask]=void 0,s--;e<0&&(this._tail=i)}else{for(this._tail=i,i=i+t+a&this._capacityMask,l=o-(t+e);l>0;l--)this.push(this._list[i++]);for(i=this._tail;s>0;)this._list[i=i+1+a&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),r}}};Hr.prototype.splice=function(e,t){var i=e;if(i===(i|0)){var r=this.size();if(i<0&&(i+=r),!(i>r))if(arguments.length>2){var s,o,a,l=arguments.length,c=this._list.length,u=2;if(!r||i<r/2){for(o=new Array(i),s=0;s<i;s++)o[s]=this._list[this._head+s&this._capacityMask];for(t===0?(a=[],i>0&&(this._head=this._head+i+c&this._capacityMask)):(a=this.remove(i,t),this._head=this._head+i+c&this._capacityMask);l>u;)this.unshift(arguments[--l]);for(s=i;s>0;s--)this.unshift(o[s-1])}else{o=new Array(r-(i+t));var h=o.length;for(s=0;s<h;s++)o[s]=this._list[this._head+i+t+s&this._capacityMask];for(t===0?(a=[],i!=r&&(this._tail=this._head+i+c&this._capacityMask)):(a=this.remove(i,t),this._tail=this._tail-h+c&this._capacityMask);u<l;)this.push(arguments[u++]);for(s=0;s<h;s++)this.push(o[s])}return a}else return this.remove(i,t)}};Hr.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0};Hr.prototype.isEmpty=function(){return this._head===this._tail};Hr.prototype.toArray=function(){return this._copyArray(!1)};Hr.prototype._fromArray=function(e){var t=e.length,i=this._nextPowerOf2(t);this._list=new Array(i),this._capacityMask=i-1,this._tail=t;for(var r=0;r<t;r++)this._list[r]=e[r]};Hr.prototype._copyArray=function(e,t){var i=this._list,r=i.length,s=this.length;if(t=t|s,t==s&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o=new Array(t),a=0,l;if(e||this._head>this._tail){for(l=this._head;l<r;l++)o[a++]=i[l];for(l=0;l<this._tail;l++)o[a++]=i[l]}else for(l=this._head;l<this._tail;l++)o[a++]=i[l];return o};Hr.prototype._growArray=function(){if(this._head!=0){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1};Hr.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};Hr.prototype._nextPowerOf2=function(e){var t=Math.log(e)/Math.log(2),i=1<<t+1;return Math.max(i,4)};var qEe=Hr;const ZEe=wc(qEe);var Ia;(function(n){n[n.unknown=0]="unknown",n[n.valid=1]="valid",n[n.invalid=2]="invalid",n[n.ignored=3]="ignored"})(Ia||(Ia={}));class YEe{constructor(){E(this,"records");E(this,"queue");this.records=new Map,this.queue=new ZEe}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(t!=null)return t;t={status:Ia.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const i={msgId:e,expire:Date.now()+AEe};return this.queue.push(i),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;t!=null&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class XEe{constructor(e,t,i,r){E(this,"params");E(this,"metrics");E(this,"peerStats",new Map);E(this,"peerIPs",new WEe(()=>new Set));E(this,"scoreCache",new Map);E(this,"deliveryRecords",new YEe);E(this,"_backgroundInterval");E(this,"scoreCacheValidityMs");E(this,"computeScore");E(this,"log");this.params=e,this.metrics=t,jEe(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=r.computeScore??KEe,this.log=i.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){if(this._backgroundInterval!=null){this.log("Peer score already running");return}this._backgroundInterval=setInterval(()=>{this.background()},this.params.decayInterval),this.log("started")}stop(){if(this._backgroundInterval==null){this.log("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,t])=>[e,t]))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return t!=null?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach((i,r)=>{if(!i.connected){e>i.expire&&(this.removeIPsForPeer(r,i.knownIPs),this.peerStats.delete(r),this.scoreCache.delete(r));return}Object.entries(i.topics).forEach(([s,o])=>{const a=this.params.topics[s];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<t&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<t&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<t&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<t&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),i.behaviourPenalty*=this.params.behaviourPenaltyDecay,i.behaviourPenalty<t&&(i.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(t==null)return 0;const i=Date.now(),r=this.scoreCache.get(e);if(r!=null&&r.cacheUntil>i)return r.score;this.metrics?.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),o=i+this.scoreCacheValidityMs;return r!=null?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-r.score)),r.score=s,r.cacheUntil=o):this.scoreCache.set(e,{score:s,cacheUntil:o}),s}addPenalty(e,t,i){const r=this.peerStats.get(e);r!=null&&(r.behaviourPenalty+=t,this.metrics?.onScorePenalty(i))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const i=this.peerStats.get(e);i?.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const i=this.peerStats.get(e);i?.knownIPs.delete(t);const r=this.peerIPs.get(t);r!=null&&(r.delete(e),r.size===0&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(t!=null){if(this.score(e)>0){this.removeIPsForPeer(e,t.knownIPs),this.peerStats.delete(e);return}Object.entries(t.topics).forEach(([i,r])=>{r.firstMessageDeliveries=0;const s=this.params.topics[i].meshMessageDeliveriesThreshold;if(r.inMesh&&r.meshMessageDeliveriesActive&&r.meshMessageDeliveries<s){const o=s-r.meshMessageDeliveries;r.meshFailurePenalty+=o*o}r.inMesh=!1,r.meshMessageDeliveriesActive=!1}),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const i=this.peerStats.get(e);if(i!=null){const r=this.getPtopicStats(i,t);r!=null&&(r.inMesh=!0,r.graftTime=Date.now(),r.meshTime=0,r.meshMessageDeliveriesActive=!1)}}prune(e,t){const i=this.peerStats.get(e);if(i!=null){const r=this.getPtopicStats(i,t);if(r!=null){const s=this.params.topics[t].meshMessageDeliveriesThreshold;if(r.meshMessageDeliveriesActive&&r.meshMessageDeliveries<s){const o=s-r.meshMessageDeliveries;r.meshFailurePenalty+=o*o}r.meshMessageDeliveriesActive=!1,r.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,i){this.markFirstMessageDelivery(e,i);const r=this.deliveryRecords.ensureRecord(t),s=Date.now();if(r.status!==Ia.unknown){this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-r.firstSeenTsMs,Ia[r.status]);return}r.status=Ia.valid,r.validated=s,r.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,i)})}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,i,r){switch(r){case au.Error:this.markInvalidMessageDelivery(e,i);return;case au.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status!==Ia.unknown){this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeenTsMs,Ia[s.status]);return}if(r===au.Ignore){s.status=Ia.ignored,s.peers.clear();return}s.status=Ia.invalid,this.markInvalidMessageDelivery(e,i),s.peers.forEach(o=>{this.markInvalidMessageDelivery(o,i)}),s.peers.clear()}duplicateMessage(e,t,i){const r=this.deliveryRecords.ensureRecord(t);if(!r.peers.has(e))switch(r.status){case Ia.unknown:r.peers.add(e);break;case Ia.valid:r.peers.add(e),this.markDuplicateMessageDelivery(e,i,r.validated);break;case Ia.invalid:this.markInvalidMessageDelivery(e,i);break;case Ia.ignored:break}}markInvalidMessageDelivery(e,t){const i=this.peerStats.get(e);if(i!=null){const r=this.getPtopicStats(i,t);r!=null&&(r.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const i=this.peerStats.get(e);if(i!=null){const r=this.getPtopicStats(i,t);if(r!=null){let s=this.params.topics[t].firstMessageDeliveriesCap;r.firstMessageDeliveries=Math.min(s,r.firstMessageDeliveries+1),r.inMesh&&(s=this.params.topics[t].meshMessageDeliveriesCap,r.meshMessageDeliveries=Math.min(s,r.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,i){const r=this.peerStats.get(e);if(r!=null){const s=i!==void 0?Date.now():0,o=this.getPtopicStats(r,t);if(o!=null&&o.inMesh){const a=this.params.topics[t];if(i!==void 0){const c=s-i,u=c>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,c,u),u)return}const l=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(l,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const i of t){const r=this.peerIPs.get(i);r!=null&&(r.delete(e),r.size===0&&this.peerIPs.delete(i))}}getPtopicStats(e,t){let i=e.topics[t];return i!==void 0?i:this.params.topics[t]!==void 0?(i={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=i,i):null}}function QEe(n,e,t,i,r){let s=0;const o=new Map;if(Object.entries(e.topics).forEach(([p,m])=>{const y=r.get(p)??"unknown",b=t.topics[p];if(b===void 0)return;let w=o.get(y);w==null&&(w={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(y,w));let v=0,T=0,S=0,M=0,P=0;if(m.inMesh){const N=Math.max(m.meshTime/b.timeInMeshQuantum,b.timeInMeshCap);v+=N*b.timeInMeshWeight}let R=m.firstMessageDeliveries;if(R>b.firstMessageDeliveriesCap&&(R=b.firstMessageDeliveriesCap),T+=R*b.firstMessageDeliveriesWeight,m.meshMessageDeliveriesActive&&m.meshMessageDeliveries<b.meshMessageDeliveriesThreshold){const N=b.meshMessageDeliveriesThreshold-m.meshMessageDeliveries,I=N*N;S+=I*b.meshMessageDeliveriesWeight}const O=m.meshFailurePenalty;M+=O*b.meshFailurePenaltyWeight;const B=m.invalidMessageDeliveries*m.invalidMessageDeliveries;P+=B*b.invalidMessageDeliveriesWeight,s+=(v+T+S+M+P)*b.topicWeight,w.p1w+=v,w.p2w+=T,w.p3w+=S,w.p3bw+=M,w.p4w+=P}),t.topicScoreCap>0&&s>t.topicScoreCap){s=t.topicScoreCap;const p=t.topicScoreCap/s;for(const m of o.values())m.p1w*=p,m.p2w*=p,m.p3w*=p,m.p3bw*=p,m.p4w*=p}let a=0,l=0,c=0;const u=t.appSpecificScore(n);a+=u*t.appSpecificWeight,e.knownIPs.forEach(p=>{if(t.IPColocationFactorWhitelist.has(p))return;const m=i.get(p),y=m!=null?m.size:0;if(y>t.IPColocationFactorThreshold){const b=y-t.IPColocationFactorThreshold,w=b*b;l+=w*t.IPColocationFactorWeight}});const h=e.behaviourPenalty*e.behaviourPenalty;return c+=h*t.behaviourPenaltyWeight,s+=a+l+c,{byTopic:o,p5w:a,p6w:l,p7w:c,score:s}}function JEe(n,e,t,i,r){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of n){const a=e.get(o);if(a!=null){const l=QEe(o,a,t,i,r);for(const[c,u]of l.byTopic){let h=s.byTopic.get(c);h==null&&(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(c,h)),h.p1w.push(u.p1w),h.p2w.push(u.p2w),h.p3w.push(u.p3w),h.p3bw.push(u.p3bw),h.p4w.push(u.p4w)}s.p5w.push(l.p5w),s.p6w.push(l.p6w),s.p7w.push(l.p7w),s.score.push(l.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}class e7e{constructor(e,t,i){E(this,"rawStream");E(this,"pushable");E(this,"closeController");E(this,"maxBufferSize");this.rawStream=e,this.pushable=vc(),this.closeController=new AbortController,this.maxBufferSize=i.maxBufferSize??1/0,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(r=>{e.abort(r)})}),Qa(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(Zm.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class t7e{constructor(e,t={}){E(this,"source");E(this,"rawStream");E(this,"closeController");this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",()=>{e.close().catch(i=>{e.abort(i)})}),this.source=Qa(this.rawStream,i=>I2(i,t))}async close(){this.closeController.abort()}}class n7e{constructor(e,t,i){E(this,"gossipsubIWantFollowupMs");E(this,"msgIdToStrFn");E(this,"metrics");E(this,"promises",new Map);E(this,"requestMsByMsg",new Map);E(this,"requestMsByMsgExpire");this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=i,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const i=Math.floor(Math.random()*t.length),r=t[i],s=this.msgIdToStrFn(r);let o=this.promises.get(s);o==null&&(o=new Map,this.promises.set(s,o));const a=Date.now();o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics!=null&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,a)))}getBrokenPromises(){const e=Date.now(),t=new Map;let i=0;return this.promises.forEach((r,s)=>{r.forEach((o,a)=>{o<e&&(t.set(a,(t.get(a)??0)+1),r.delete(a),i++)}),r.size===0&&this.promises.delete(s)}),this.metrics?.iwantPromiseBroken.inc(i),t}deliverMessage(e,t=!1){this.trackMessage(e);const i=this.promises.get(e);i!=null&&(this.promises.delete(e),this.metrics!=null&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(i.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case au.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;let t=0;for(const[i,r]of this.requestMsByMsg.entries())if(r<e)this.requestMsByMsg.delete(i),t++;else break;this.metrics?.iwantMessagePruned.inc(t)}trackMessage(e){if(this.metrics!=null){const t=this.requestMsByMsg.get(e);t!==void 0&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const jee=Ut("libp2p-pubsub:");async function i7e(n,e,t,i){switch(n.type){case H2.Signing:{const r={from:n.author.toBytes(),data:i,seqno:R0(8),topic:e,signature:void 0,key:void 0},s=Ms([jee,Nm.Message.encode(r)]);r.signature=await n.privateKey.sign(s),r.key=n.key;const o={type:"signed",from:n.author,data:t,sequenceNumber:BigInt(`0x${Vt(r.seqno,"base16")}`),topic:e,signature:r.signature,key:r.key};return{raw:r,msg:o}}case H2.Anonymous:return{raw:{from:void 0,data:i,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:t,topic:e}};default:throw new Error("Unreachable")}}async function r7e(n,e){switch(n){case lk:return e.signature!=null?{valid:!1,error:Ra.SignaturePresent}:e.seqno!=null?{valid:!1,error:Ra.SeqnoPresent}:e.key!=null?{valid:!1,error:Ra.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case _6:{if(e.seqno==null)return{valid:!1,error:Ra.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Ra.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Ra.InvalidSignature};if(e.from==null)return{valid:!1,error:Ra.InvalidPeerId};let t;try{t=gh(e.from)}catch{return{valid:!1,error:Ra.InvalidPeerId}}let i;if(e.key!=null){if(i=cb(e.key),t.publicKey!==void 0&&!li(i.bytes,t.publicKey))return{valid:!1,error:Ra.InvalidPeerId}}else{if(t.publicKey==null)return{valid:!1,error:Ra.InvalidPeerId};i=cb(t.publicKey)}const r={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=Ms([jee,Nm.Message.encode(r)]);return await i.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${Vt(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??zk(i)}}:{valid:!1,error:Ra.InvalidSignature}}default:throw new Error("Unreachable")}}function Dh(n=[],e){return{subscriptions:[],messages:n,control:e!==void 0?{graft:e.graft??[],prune:e.prune??[],ihave:e.ihave??[],iwant:e.iwant??[]}:void 0}}function Dj(n){return n.control===void 0&&(n.control={graft:[],prune:[],ihave:[],iwant:[]}),n}function Oh(n){if(n.length<=1)return n;const e=()=>Math.floor(Math.random()*Math.floor(n.length));for(let t=0;t<n.length;t++){const i=e(),r=n[t];n[t]=n[i],n[i]=r}return n}function s7e(n){return Vt(n,"base64")}async function o7e(n,e){switch(n){case _6:{if(e==null)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");const t=await _7(e.privateKey);return{type:H2.Signing,author:e,key:e.publicKey,privateKey:t}}case lk:return{type:H2.Anonymous};default:throw new Error(`Unknown signature policy "${n}"`)}}const a7e=(n,e)=>{const t=Ut(e.toString(16).padStart(16,"0"),"base16"),i=new Uint8Array(n.length+t.length);return i.set(n,0),i.set(t,n.length),i};function l7e(n){if(n.type!=="signed")throw new Error("expected signed message type");if(n.sequenceNumber==null)throw Error("missing seqno field");return a7e(n.from.toBytes(),n.sequenceNumber)}async function c7e(n){return Ir.encode(n.data)}var _8;(function(n){n[n.ip4=4]="ip4",n[n.ip6=41]="ip6"})(_8||(_8={}));function u7e(n){for(const e of n.tuples())switch(e[0]){case _8.ip4:case _8.ip6:return G0e(e[0],e[1])}return null}class uC{constructor(e){E(this,"entries",new Map);E(this,"validityMs");this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return this.entries.has(e)?!0:(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,i]of this.entries.entries())if(i.validUntilMs<e)this.entries.delete(t);else break}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var ml;(function(n){n[n.started=0]="started",n[n.stopped=1]="stopped"})(ml||(ml={}));class Vee extends yc{constructor(t,i={}){super();E(this,"globalSignaturePolicy");E(this,"multicodecs",[Ij,Rj]);E(this,"publishConfig");E(this,"dataTransform");E(this,"peers",new Set);E(this,"streamsInbound",new Map);E(this,"streamsOutbound",new Map);E(this,"outboundInflightQueue",vc({objectMode:!0}));E(this,"direct",new Set);E(this,"floodsubPeers",new Set);E(this,"seenCache");E(this,"acceptFromWhitelist",new Map);E(this,"topics",new Map);E(this,"subscriptions",new Set);E(this,"mesh",new Map);E(this,"fanout",new Map);E(this,"fanoutLastpub",new Map);E(this,"gossip",new Map);E(this,"control",new Map);E(this,"peerhave",new Map);E(this,"iasked",new Map);E(this,"backoff",new Map);E(this,"outbound",new Map);E(this,"msgIdFn");E(this,"fastMsgIdFn");E(this,"msgIdToStrFn");E(this,"fastMsgIdCache");E(this,"publishedMessageIds");E(this,"mcache");E(this,"score");E(this,"topicValidators",new Map);E(this,"log");E(this,"heartbeatTicks",0);E(this,"gossipTracer");E(this,"components");E(this,"directPeerInitial",null);E(this,"opts");E(this,"decodeRpcLimits");E(this,"metrics");E(this,"status",{code:ml.stopped});E(this,"maxInboundStreams");E(this,"maxOutboundStreams");E(this,"runOnTransientConnection");E(this,"allowedTopics");E(this,"heartbeatTimer",null);E(this,"runHeartbeat",()=>{const t=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{if(t?.(),this.status.code===ml.started){clearTimeout(this.status.heartbeatTimeout);let i=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})});const r={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,doPX:!1,directPeers:[],D:nEe,Dlo:iEe,Dhi:rEe,Dscore:sEe,Dout:oEe,Dlazy:cEe,heartbeatInterval:dEe,fanoutTTL:fEe,mcacheLength:aEe,mcacheGossip:lEe,seenTTL:TEe,gossipsubIWantFollowupMs:EEe,prunePeers:pEe,pruneBackoff:mEe,unsubcribeBackoff:gEe,graftFloodThreshold:wEe,opportunisticGraftPeers:_Ee,opportunisticGraftTicks:bEe,directConnectTicks:xEe,...i,scoreParams:FEe(i.scoreParams),scoreThresholds:$Ee(i.scoreThresholds)};if(this.components=t,this.decodeRpcLimits=r.decodeRpcLimits??LEe,this.globalSignaturePolicy=r.globalSignaturePolicy??_6,r.fallbackToFloodsub&&this.multicodecs.push(Mj),this.log=t.logger.forComponent(r.debugName??"libp2p:gossipsub"),this.opts=r,this.direct=new Set(r.directPeers.map(s=>s.id.toString())),this.seenCache=new uC({validityMs:r.seenTTL}),this.publishedMessageIds=new uC({validityMs:r.seenTTL}),i.msgIdFn!=null)this.msgIdFn=i.msgIdFn;else switch(this.globalSignaturePolicy){case _6:this.msgIdFn=l7e;break;case lk:this.msgIdFn=c7e;break;default:throw new Error(`Invalid globalSignaturePolicy: ${this.globalSignaturePolicy}`)}if(i.fastMsgIdFn!=null&&(this.fastMsgIdFn=i.fastMsgIdFn,this.fastMsgIdCache=new uC({validityMs:r.seenTTL})),this.msgIdToStrFn=i.msgIdToStrFn??s7e,this.mcache=i.messageCache??new DEe(r.mcacheGossip,r.mcacheLength,this.msgIdToStrFn),i.dataTransform!=null&&(this.dataTransform=i.dataTransform),i.metricsRegister!=null){if(i.metricsTopicStrToLabel==null)throw Error("Must set metricsTopicStrToLabel with metrics");const s=Math.max(...Object.values(r.scoreParams.topics).map(a=>a.meshMessageDeliveriesWindow),PEe),o=OEe(i.metricsRegister,i.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:r.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});o.mcacheSize.addCollect(()=>{this.onScrapeMetrics(o)});for(const a of this.multicodecs)o.protocolsEnabled.set({protocol:a},1);this.metrics=o}else this.metrics=null;this.gossipTracer=new n7e(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new XEe(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:r.heartbeatInterval}),this.maxInboundStreams=i.maxInboundStreams,this.maxOutboundStreams=i.maxOutboundStreams,this.runOnTransientConnection=i.runOnTransientConnection,this.allowedTopics=r.allowedTopics!=null?new Set(r.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(t=>Bi(t))}isStarted(){return this.status.code===ml.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await o7e(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=vc({objectMode:!0}),Qa(this.outboundInflightQueue,async o=>{for await(const{peerId:a,connection:l}of o)await this.createOutboundStream(a,l)}).catch(o=>{this.log.error("outbound inflight queue error",o)}),await Promise.all(this.opts.directPeers.map(async o=>{await this.components.peerStore.merge(o.id,{multiaddrs:o.addrs})}));const t=this.components.registrar;await Promise.all(this.multicodecs.map(async o=>t.handle(o,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection})));const i={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnTransient:this.runOnTransientConnection},r=await Promise.all(this.multicodecs.map(async o=>t.register(o,i))),s=setTimeout(this.runHeartbeat,Nj);this.status={code:ml.started,registrarTopologyIds:r,heartbeatTimeout:s,hearbeatStartMs:Date.now()+Nj},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async o=>this.connect(o)))}).catch(o=>{this.log(o)})},vEe),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==ml.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:ml.stopped};const i=this.components.registrar;await Promise.all(this.multicodecs.map(async s=>i.unhandle(s))),t.forEach(s=>{i.unregister(s)}),this.outboundInflightQueue.end();const r=[];for(const s of this.streamsOutbound.values())r.push(s.close());this.streamsOutbound.clear();for(const s of this.streamsInbound.values())r.push(s.close());this.streamsInbound.clear(),await Promise.all(r),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer!=null&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache!=null&&this.fastMsgIdCache.clear(),this.directPeerInitial!=null&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:i}){if(!this.isStarted())return;const r=i.remotePeer;this.addPeer(r,i.direction,i.remoteAddr),this.createInboundStream(r,t),this.outboundInflightQueue.push({peerId:r,connection:i})}onPeerConnected(t,i){this.metrics?.newConnectionCount.inc({status:i.status}),!(!this.isStarted()||i.status!=="open")&&(this.addPeer(t,i.direction,i.remoteAddr),this.outboundInflightQueue.push({peerId:t,connection:i}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,i){if(!this.isStarted())return;const r=t.toString();if(this.peers.has(r)&&!this.streamsOutbound.has(r))try{const s=new e7e(await i.newStream(this.multicodecs,{runOnTransientConnection:this.runOnTransientConnection}),a=>{this.log.error("outbound pipe error",a)},{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(r,s);const o=s.protocol;o===Mj&&this.floodsubPeers.add(r),this.metrics?.peersPerProtocol.inc({protocol:o},1),this.subscriptions.size>0&&(this.log("send subscriptions to",r),this.sendSubscriptions(r,Array.from(this.subscriptions),!0))}catch(s){this.log.error("createOutboundStream error",s)}}createInboundStream(t,i){if(!this.isStarted())return;const r=t.toString();if(!this.peers.has(r))return;const s=this.streamsInbound.get(r);s!==void 0&&(this.log("replacing existing inbound steam %s",r),s.close().catch(a=>{this.log.error(a)})),this.log("create inbound stream %s",r);const o=new t7e(i,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(r,o),this.pipePeerReadStream(t,o.source).catch(a=>{this.log(a)})}addPeer(t,i,r){const s=t.toString();if(!this.peers.has(s)){this.log("new peer %p",t),this.peers.add(s),this.score.addPeer(s);const o=u7e(r);o!==null?this.score.addIP(s,o):this.log("Added peer has no IP in current address %s %s",s,r.toString()),this.outbound.has(s)||this.outbound.set(s,i==="outbound")}}removePeer(t){const i=t.toString();if(!this.peers.has(i))return;this.log("delete peer %p",t),this.peers.delete(i);const r=this.streamsOutbound.get(i),s=this.streamsInbound.get(i);r!=null&&this.metrics?.peersPerProtocol.inc({protocol:r.protocol},-1),r?.close().catch(o=>{this.log.error(o)}),s?.close().catch(o=>{this.log.error(o)}),this.streamsOutbound.delete(i),this.streamsInbound.delete(i);for(const o of this.topics.values())o.delete(i);for(const[o,a]of this.mesh)a.delete(i)&&this.metrics?.onRemoveFromMesh(o,eh.Dc,1);for(const o of this.fanout.values())o.delete(i);this.floodsubPeers.delete(i),this.gossip.delete(i),this.control.delete(i),this.outbound.delete(i),this.score.removePeer(i),this.acceptFromWhitelist.delete(i)}get started(){return this.status.code===ml.started}getMeshPeers(t){const i=this.mesh.get(t);return i!=null?Array.from(i):[]}getSubscribers(t){const i=this.topics.get(t);return(i!=null?Array.from(i):[]).map(r=>Bi(r))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,i){try{await Qa(i,async r=>{for await(const s of r)try{const o=s.subarray(),a=Nm.decode(o,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos}}}});if(this.metrics?.onRpcRecv(a,o.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(t,a)}catch(l){this.metrics?.onRpcRecvError(),this.log(l)}else this.handleReceivedRpc(t,a).catch(l=>{this.metrics?.onRpcRecvError(),this.log(l)})}catch(o){this.metrics?.onRpcDataError(),this.log(o)}})}catch(r){this.metrics?.onPeerReadStreamError(),this.handlePeerReadStreamError(r,t)}}handlePeerReadStreamError(t,i){this.log.error(t),this.onPeerDisconnected(i)}async handleReceivedRpc(t,i){if(!this.acceptFrom(t.toString())){this.log("received message from unacceptable peer %p",t),this.metrics?.rpcRecvNotAccepted.inc();return}const r=i.subscriptions!=null?i.subscriptions.length:0,s=i.messages!=null?i.messages.length:0;let o=0,a=0,l=0,c=0;if(i.control!=null&&(i.control.ihave!=null&&(o=i.control.ihave.length),i.control.iwant!=null&&(a=i.control.iwant.length),i.control.graft!=null&&(l=i.control.graft.length),i.control.prune!=null&&(c=i.control.prune.length)),this.log(`rpc.from ${t.toString()} subscriptions ${r} messages ${s} ihave ${o} iwant ${a} graft ${l} prune ${c}`),i.subscriptions!=null&&i.subscriptions.length>0){const u=[];i.subscriptions.forEach(h=>{const p=h.topic,m=h.subscribe===!0;if(p!=null){if(this.allowedTopics!=null&&!this.allowedTopics.has(p))return;this.handleReceivedSubscription(t,p,m),u.push({topic:p,subscribe:m})}}),this.safeDispatchEvent("subscription-change",{detail:{peerId:t,subscriptions:u}})}for(const u of i.messages){if(this.allowedTopics!=null&&!this.allowedTopics.has(u.topic))continue;const h=this.handleReceivedMessage(t,u).catch(p=>{this.metrics?.onMsgRecvError(u.topic),this.log(p)});this.opts.awaitRpcMessageHandler&&await h}i.control!=null&&await this.handleControlMessage(t.toString(),i.control)}handleReceivedSubscription(t,i,r){this.log("subscription update from %p topic %s",t,i);let s=this.topics.get(i);s==null&&(s=new Set,this.topics.set(i,s)),r?s.add(t.toString()):s.delete(t.toString())}async handleReceivedMessage(t,i){this.metrics?.onMsgRecvPreValidation(i.topic);const r=await this.validateReceivedMessage(t,i);this.metrics?.onPrevalidationResult(i.topic,r.code);const s=r.code;switch(s){case Na.duplicate:this.score.duplicateMessage(t.toString(),r.msgIdStr,i.topic),this.gossipTracer.deliverMessage(r.msgIdStr,!0),this.mcache.observeDuplicate(r.msgIdStr,t.toString());return;case Na.invalid:if(r.msgIdStr!=null){const o=r.msgIdStr;this.score.rejectMessage(t.toString(),o,i.topic,r.reason),this.gossipTracer.rejectMessage(o,r.reason)}else this.score.rejectInvalidMessage(t.toString(),i.topic);this.metrics?.onMsgRecvInvalid(i.topic,r);return;case Na.valid:this.score.validateMessage(r.messageId.msgIdStr),this.gossipTracer.deliverMessage(r.messageId.msgIdStr),this.mcache.put(r.messageId,i,!this.opts.asyncValidation),this.subscriptions.has(i.topic)&&(!this.components.peerId.equals(t)||this.opts.emitSelf)&&(super.dispatchEvent(new ko("gossipsub:message",{detail:{propagationSource:t,msgId:r.messageId.msgIdStr,msg:r.msg}})),super.dispatchEvent(new ko("message",{detail:r.msg}))),this.opts.asyncValidation||this.forwardMessage(r.messageId.msgIdStr,i,t.toString());break;default:throw new Error(`Invalid validation result: ${s}`)}}async validateReceivedMessage(t,i){const r=this.fastMsgIdFn?.(i),s=r!==void 0?this.fastMsgIdCache?.get(r):void 0;if(s!=null)return{code:Na.duplicate,msgIdStr:s};const o=await r7e(this.globalSignaturePolicy,i);if(!o.valid)return{code:Na.invalid,reason:au.Error,error:o.error};const a=o.message;try{this.dataTransform!=null&&(a.data=this.dataTransform.inboundTransform(i.topic,a.data))}catch(p){return this.log("Invalid message, transform failed",p),{code:Na.invalid,reason:au.Error,error:Ra.TransformFailed}}const l=await this.msgIdFn(a),c=this.msgIdToStrFn(l),u={msgId:l,msgIdStr:c};if(r!==void 0&&this.fastMsgIdCache!=null&&this.fastMsgIdCache.put(r,c)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(c))return{code:Na.duplicate,msgIdStr:c};this.seenCache.put(c);const h=this.topicValidators.get(i.topic);if(h!=null){let p;try{p=await h(t,a)}catch(m){const y=m.code;y===MEe&&(p=nc.Ignore),y===CEe?p=nc.Reject:p=nc.Ignore}if(p!==nc.Accept)return{code:Na.invalid,reason:kj(p),msgIdStr:c}}return{code:Na.valid,messageId:u,msg:a}}getScore(t){return this.score.score(t)}sendSubscriptions(t,i,r){this.sendRpc(t,{subscriptions:i.map(s=>({topic:s,subscribe:r})),messages:[]})}async handleControlMessage(t,i){if(i===void 0)return;const r=i.ihave!=null?this.handleIHave(t,i.ihave):[],s=i.iwant!=null?this.handleIWant(t,i.iwant):[],o=i.graft!=null?await this.handleGraft(t,i.graft):[];if(i.prune!=null&&await this.handlePrune(t,i.prune),r.length===0&&s.length===0&&o.length===0)return;const a=this.sendRpc(t,Dh(s,{iwant:r,prune:o})),l=r[0]?.messageIDs;l!=null&&(a?this.gossipTracer.addPromise(t,l):this.metrics?.iwantPromiseUntracked.inc(1))}acceptFrom(t){if(this.direct.has(t))return!0;const i=Date.now(),r=this.acceptFromWhitelist.get(t);if(r!=null&&r.messagesAccepted<IEe&&r.acceptUntil>=i)return r.messagesAccepted+=1,!0;const s=this.score.score(t);return s>=REe?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:i+NEe}):this.acceptFromWhitelist.delete(t),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,i){if(i.length===0)return[];const r=this.score.score(t);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,r),this.metrics?.ihaveRcvIgnored.inc({reason:A3.LowScore}),[];const s=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,s),s>SEe)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,s),this.metrics?.ihaveRcvIgnored.inc({reason:A3.MaxIhave}),[];const o=this.iasked.get(t)??0;if(o>=rg)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,o),this.metrics?.ihaveRcvIgnored.inc({reason:A3.MaxIasked}),[];const a=new Map;if(i.forEach(({topicID:u,messageIDs:h})=>{if(u==null||h==null||!this.mesh.has(u))return;let p=0;h.forEach(m=>{const y=this.msgIdToStrFn(m);this.seenCache.has(y)||(a.set(y,m),p++)}),this.metrics?.onIhaveRcv(u,h.length,p)}),a.size===0)return[];let l=a.size;l+o>rg&&(l=rg-o),this.log("IHAVE: Asking for %d out of %d messages from %s",l,a.size,t);let c=Array.from(a.values());return Oh(c),c=c.slice(0,l),this.iasked.set(t,o+l),[{messageIDs:c}]}handleIWant(t,i){if(i.length===0)return[];const r=this.score.score(t);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,r),[];const s=new Map,o=new Map;let a=0;return i.forEach(({messageIDs:l})=>{l?.forEach(c=>{const u=this.msgIdToStrFn(c),h=this.mcache.getWithIWantCount(u,t);if(h==null){a++;return}if(o.set(h.msg.topic,1+(o.get(h.msg.topic)??0)),h.count>hEe){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,c);return}s.set(u,h.msg)})}),this.metrics?.onIwantRcv(o,a),s.size===0?(this.log("IWANT: Could not provide any wanted messages to %s",t),[]):(this.log("IWANT: Sending %d messages to %s",s.size,t),Array.from(s.values()))}async handleGraft(t,i){const r=[],s=this.score.score(t),o=Date.now();let a=this.opts.doPX;if(i.forEach(({topicID:c})=>{if(c==null)return;const u=this.mesh.get(c);if(u==null){a=!1;return}if(u.has(t))return;if(this.direct.has(t)){this.log("GRAFT: ignoring request from direct peer %s",t),r.push(c),a=!1;return}const h=this.backoff.get(c)?.get(t);if(typeof h=="number"&&o<h){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,T3.GraftBackoff),a=!1;const p=h+this.opts.graftFloodThreshold-this.opts.pruneBackoff;o<p&&this.score.addPenalty(t,1,T3.GraftBackoff),this.addBackoff(t,c),r.push(c);return}if(s<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,s,c),r.push(c),a=!1,this.addBackoff(t,c);return}if(u.size>=this.opts.Dhi&&!(this.outbound.get(t)??!1)){r.push(c),this.addBackoff(t,c);return}this.log("GRAFT: Add mesh link from %s in %s",t,c),this.score.graft(t,c),u.add(t),this.metrics?.onAddToMesh(c,Da.Subscribed,1)}),r.length===0)return[];const l=!1;return Promise.all(r.map(async c=>this.makePrune(t,c,a,l)))}async handlePrune(t,i){const r=this.score.score(t);for(const{topicID:s,backoff:o,peers:a}of i){if(s==null)continue;const l=this.mesh.get(s);if(l==null)return;if(this.log("PRUNE: Remove mesh link to %s in %s",t,s),this.score.prune(t,s),l.has(t)&&(l.delete(t),this.metrics?.onRemoveFromMesh(s,eh.Prune,1)),typeof o=="number"&&o>0?this.doAddBackoff(t,s,o*1e3):this.addBackoff(t,s),a!=null&&a.length>0){if(r<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,r,s);continue}await this.pxConnect(a)}}}addBackoff(t,i){this.doAddBackoff(t,i,this.opts.pruneBackoff)}doAddBackoff(t,i,r){let s=this.backoff.get(i);s==null&&(s=new Map,this.backoff.set(i,s));const o=Date.now()+r;(s.get(t)??0)<o&&s.set(t,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((t,i)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",i,t),this.score.addPenalty(i,t,T3.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%yEe!==0)return;const t=Date.now();this.backoff.forEach((i,r)=>{i.forEach((s,o)=>{s+kEe*this.opts.heartbeatInterval<t&&i.delete(o)}),i.size===0&&this.backoff.delete(r)})}async directConnect(){const t=[];this.direct.forEach(i=>{this.streamsOutbound.has(i)||t.push(i)}),await Promise.all(t.map(async i=>this.connect(i)))}async pxConnect(t){t.length>this.opts.prunePeers&&(Oh(t),t=t.slice(0,this.opts.prunePeers));const i=[];await Promise.all(t.map(async r=>{if(r.peerID==null)return;const s=gh(r.peerID),o=s.toString();if(!this.peers.has(o)){if(r.signedPeerRecord==null){i.push(o);return}try{if(!await this.components.peerStore.consumePeerRecord(r.signedPeerRecord,s)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}i.push(o)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),i.length!==0&&await Promise.all(i.map(async r=>this.connect(r)))}async connect(t){this.log("Initiating connection with %s",t);const i=Bi(t),r=await this.components.connectionManager.openConnection(i);for(const s of this.multicodecs)for(const o of this.components.registrar.getTopologies(s))o.onConnect?.(i,r)}subscribe(t){if(this.status.code!==ml.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const i of this.peers.keys())this.sendSubscriptions(i,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==ml.started)throw new Error("Pubsub is not started");const i=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,i),i)for(const r of this.peers.keys())this.sendSubscriptions(r,[t],!1);this.leave(t)}join(t){if(this.status.code!==ml.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),this.metrics?.onJoin(t);const i=new Set,r=this.backoff.get(t),s=this.fanout.get(t);if(s!=null&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),s.forEach(o=>{!this.direct.has(o)&&this.score.score(o)>=0&&(r==null||!r.has(o))&&i.add(o)}),this.metrics?.onAddToMesh(t,Da.Fanout,i.size)),i.size<this.opts.D){const o=i.size;this.getRandomGossipPeers(t,this.opts.D,l=>!i.has(l)&&!this.direct.has(l)&&this.score.score(l)>=0&&(r==null||!r.has(l))).forEach(l=>{i.add(l)}),this.metrics?.onAddToMesh(t,Da.Random,i.size-o)}this.mesh.set(t,i),i.forEach(o=>{this.log("JOIN: Add mesh link to %s in %s",o,t),this.sendGraft(o,t)})}leave(t){if(this.status.code!==ml.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),this.metrics?.onLeave(t);const i=this.mesh.get(t);i!=null&&(Promise.all(Array.from(i).map(async r=>{this.log("LEAVE: Remove mesh link to %s in %s",r,t),await this.sendPrune(r,t)})).catch(r=>{this.log("Error sending prunes to mesh peers",r)}),this.mesh.delete(t))}selectPeersToForward(t,i,r){const s=new Set,o=this.topics.get(t);o!=null&&(this.direct.forEach(l=>{o.has(l)&&i!==l&&!(r?.has(l)??!1)&&s.add(l)}),this.floodsubPeers.forEach(l=>{o.has(l)&&i!==l&&!(r?.has(l)??!1)&&this.score.score(l)>=this.opts.scoreThresholds.publishThreshold&&s.add(l)}));const a=this.mesh.get(t);return a!=null&&a.size>0&&a.forEach(l=>{i!==l&&!(r?.has(l)??!1)&&s.add(l)}),s}selectPeersToPublish(t){const i=new Set,r={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(t);if(s!=null)if(this.opts.floodPublish)s.forEach(o=>{this.direct.has(o)?(i.add(o),r.direct++):this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(i.add(o),r.floodsub++)});else{this.direct.forEach(a=>{s.has(a)&&(i.add(a),r.direct++)}),this.floodsubPeers.forEach(a=>{s.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&(i.add(a),r.floodsub++)});const o=this.mesh.get(t);if(o!=null&&o.size>0)o.forEach(a=>{i.add(a),r.mesh++});else{const a=this.fanout.get(t);if(a!=null&&a.size>0)a.forEach(l=>{i.add(l),r.fanout++});else{const l=this.getRandomGossipPeers(t,this.opts.D,c=>this.score.score(c)>=this.opts.scoreThresholds.publishThreshold);l.size>0&&(this.fanout.set(t,l),l.forEach(c=>{i.add(c),r.fanout++}))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:i,tosendCount:r}}forwardMessage(t,i,r,s){r!=null&&this.score.deliverMessage(r,t,i.topic);const o=this.selectPeersToForward(i.topic,r,s);o.forEach(a=>{this.sendRpc(a,Dh([i]))}),this.metrics?.onForwardMsg(i.topic,o.size)}async publish(t,i,r){const s=Date.now(),o=this.dataTransform!=null?this.dataTransform.outboundTransform(t,i):i;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");const{raw:a,msg:l}=await i7e(this.publishConfig,t,i,o),c=await this.msgIdFn(l),u=this.msgIdToStrFn(c),h=r?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(u)){if(h)return this.metrics?.onPublishDuplicateMsg(t),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:p,tosendCount:m}=this.selectPeersToPublish(t),y=this.opts.emitSelf&&this.subscriptions.has(t),b=r?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(p.size===0&&!b&&!y)throw Error("PublishError.InsufficientPeers");this.seenCache.put(u),this.mcache.put({msgId:c,msgIdStr:u},a,!0),this.publishedMessageIds.put(u);const w=r?.batchPublish??this.opts.batchPublish,v=Dh([a]);if(w)this.sendRpcInBatch(p,v);else for(const S of p)this.sendRpc(S,v)||p.delete(S);const T=Date.now()-s;return this.metrics?.onPublishMsg(t,m,p.size,a.data!=null?a.data.length:0,T),y&&(p.add(this.components.peerId.toString()),super.dispatchEvent(new ko("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:u,msg:l}})),super.dispatchEvent(new ko("message",{detail:l}))),{recipients:Array.from(p.values()).map(S=>Bi(S))}}sendRpcInBatch(t,i){const r=Nm.encode(i),s=Zm.single(r);for(const o of t){const a=this.streamsOutbound.get(o);if(a==null){this.log(`Cannot send RPC to ${o} as there is no open stream to it available`),t.delete(o);continue}try{a.pushPrefixed(s)}catch(l){t.delete(o),this.log.error(`Cannot send rpc to ${o}`,l)}this.metrics?.onRpcSent(i,r.length)}}reportMessageValidationResult(t,i,r){let s;if(r===nc.Accept){if(s=this.mcache.validate(t),s!=null){const{message:a,originatingPeers:l}=s;this.score.deliverMessage(i,t,a.topic),this.forwardMessage(t,s.message,i,l)}}else if(s=this.mcache.remove(t),s!=null){const a=kj(r),{message:l,originatingPeers:c}=s;this.score.rejectMessage(i,t,l.topic,a);for(const u of c)this.score.rejectMessage(u,t,l.topic,a)}const o=this.score.messageFirstSeenTimestampMs(t);this.metrics?.onReportValidation(s,r,o)}sendGraft(t,i){const s=Dh([],{graft:[{topicID:i}]});this.sendRpc(t,s)}async sendPrune(t,i){const s=[await this.makePrune(t,i,this.opts.doPX,!0)],o=Dh([],{prune:s});this.sendRpc(t,o)}sendRpc(t,i){const r=this.streamsOutbound.get(t);if(r==null)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const s=this.control.get(t);s!=null&&(this.piggybackControl(t,i,s),this.control.delete(t));const o=this.gossip.get(t);o!=null&&(this.piggybackGossip(t,i,o),this.gossip.delete(t));const a=Nm.encode(i);try{r.push(a)}catch(l){return this.log.error(`Cannot send rpc to ${t}`,l),s!=null&&this.control.set(t,s),o!=null&&this.gossip.set(t,o),!1}return this.metrics?.onRpcSent(i,a.length),!0}piggybackControl(t,i,r){const s=Dj(i);for(const o of r.graft)o.topicID!=null&&(this.mesh.get(o.topicID)?.has(t)??!1)&&s.control.graft.push(o);for(const o of r.prune)o.topicID!=null&&!(this.mesh.get(o.topicID)?.has(t)??!1)&&s.control.prune.push(o)}piggybackGossip(t,i,r){const s=Dj(i);s.control.ihave=r}async sendGraftPrune(t,i,r){const s=this.opts.doPX,o=!1;for(const[a,l]of t){const c=l.map(p=>({topicID:p}));let u=[];const h=i.get(a);h!=null&&(u=await Promise.all(h.map(async p=>this.makePrune(a,p,s&&!(r.get(a)??!1),o))),i.delete(a)),this.sendRpc(a,Dh([],{graft:c,prune:u}))}for(const[a,l]of i){const c=await Promise.all(l.map(async u=>this.makePrune(a,u,s&&!(r.get(a)??!1),o)));this.sendRpc(a,Dh([],{prune:c}))}}emitGossip(t){const i=this.mcache.getGossipIDs(new Set(t.keys()));for(const[r,s]of t)this.doEmitGossip(r,s,i.get(r)??[])}doEmitGossip(t,i,r){if(r.length===0||(Oh(r),r.length>rg&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",r.length),i.size===0))return;let s=this.opts.Dlazy;const o=uEe*i.size;let a=i;o>s&&(s=o),s>a.size?s=a.size:a=Oh(Array.from(a)).slice(0,s),a.forEach(l=>{let c=r;r.length>rg&&(c=Oh(c.slice()).slice(0,rg)),this.pushGossip(l,{topicID:t,messageIDs:c})})}flush(){for(const[t,i]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,Dh([],{ihave:i}));for(const[t,i]of this.control.entries()){this.control.delete(t);const r=Dh([],{graft:i.graft,prune:i.prune});this.sendRpc(t,r)}}pushGossip(t,i){this.log("Add gossip to %s",t);const r=this.gossip.get(t)??[];this.gossip.set(t,r.concat(i))}async makePrune(t,i,r,s){if(this.score.prune(t,i),this.streamsOutbound.get(t)?.protocol===Rj)return{topicID:i,peers:[]};const o=s?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,a=o/1e3;if(this.doAddBackoff(t,i,o),!r)return{topicID:i,peers:[],backoff:a};const l=this.getRandomGossipPeers(i,this.opts.prunePeers,u=>u!==t&&this.score.score(u)>=0),c=await Promise.all(Array.from(l).map(async u=>{const h=Bi(u);let p;try{p=await this.components.peerStore.get(h)}catch(m){if(m.code!=="ERR_NOT_FOUND")throw m}return{peerID:h.toBytes(),signedPeerRecord:p?.peerRecordEnvelope}}));return{topicID:i,peers:c,backoff:a}}async heartbeat(){const{D:t,Dlo:i,Dhi:r,Dscore:s,Dout:o,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const l=new Map,c=b=>{let w=l.get(b);return w===void 0&&(w=this.score.score(b),l.set(b,w)),w},u=new Map,h=new Map,p=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const m=new Map;this.mesh.forEach((b,w)=>{const v=this.topics.get(w),T=new Set,S=new Set;if(m.set(w,S),v!=null){const R=Oh(Array.from(v)),O=this.backoff.get(w);for(const B of R){const N=this.streamsOutbound.get(B);if(N!=null&&this.multicodecs.includes(N.protocol)&&!b.has(B)&&!this.direct.has(B)){const I=c(B);(O==null||!O.has(B))&&I>=0&&T.add(B),I>=this.opts.scoreThresholds.gossipThreshold&&S.add(B)}}}const M=(R,O)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",R,w),this.addBackoff(R,w),b.delete(R),c(R)>=this.opts.scoreThresholds.gossipThreshold&&S.add(R),this.metrics?.onRemoveFromMesh(w,O,1);const B=h.get(R);B==null?h.set(R,[w]):B.push(w)},P=(R,O)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",R,w),this.score.graft(R,w),b.add(R),S.delete(R),this.metrics?.onAddToMesh(w,O,1);const B=u.get(R);B==null?u.set(R,[w]):B.push(w)};if(b.forEach(R=>{const O=c(R);O<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",R,O,w),M(R,eh.BadScore),p.set(R,!0))}),b.size<i){const R=t-b.size;GEe(T,R).forEach(B=>{P(B,Da.NotEnough)})}if(b.size>r){let R=Array.from(b);R.sort((B,N)=>c(N)-c(B)),R=R.slice(0,s).concat(Oh(R.slice(s)));let O=0;if(R.slice(0,t).forEach(B=>{(this.outbound.get(B)??!1)&&O++}),O<o){const B=I=>{const F=R[I];for(let j=I;j>0;j--)R[j]=R[j-1];R[0]=F};if(O>0){let I=O;for(let F=1;F<t&&I>0;F++)(this.outbound.get(R[F])??!1)&&(B(F),I--)}let N=t-O;for(let I=t;I<R.length&&N>0;I++)(this.outbound.get(R[I])??!1)&&(B(I),N--)}R.slice(t).forEach(B=>{M(B,eh.Excess)})}if(b.size>=i){let R=0;if(b.forEach(O=>{(this.outbound.get(O)??!1)&&R++}),R<o){const O=o-R;mN(T,O,N=>this.outbound.get(N)===!0).forEach(N=>{P(N,Da.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&b.size>1){const R=Array.from(b).sort((N,I)=>c(N)-c(I)),O=Math.floor(b.size/2),B=c(R[O]);if(B<this.opts.scoreThresholds.opportunisticGraftThreshold){const N=this.opts.opportunisticGraftPeers,I=mN(T,N,F=>c(F)>B);for(const F of I)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",F,w),P(F,Da.Opportunistic)}}});const y=Date.now();this.fanoutLastpub.forEach((b,w)=>{b+a<y&&(this.fanout.delete(w),this.fanoutLastpub.delete(w))}),this.fanout.forEach((b,w)=>{const v=this.topics.get(w);b.forEach(P=>{(!(v?.has(P)??!1)||c(P)<this.opts.scoreThresholds.publishThreshold)&&b.delete(P)});const T=this.topics.get(w),S=[],M=new Set;if(m.set(w,M),T!=null){const P=Oh(Array.from(T));for(const R of P){const O=this.streamsOutbound.get(R);if(O!=null&&this.multicodecs.includes(O.protocol)&&!b.has(R)&&!this.direct.has(R)){const B=c(R);B>=this.opts.scoreThresholds.publishThreshold&&S.push(R),B>=this.opts.scoreThresholds.gossipThreshold&&M.add(R)}}}if(b.size<t){const P=t-b.size;S.slice(0,P).forEach(R=>{b.add(R),M?.delete(R)})}}),this.emitGossip(m),await this.sendGraftPrune(u,h,p),this.flush(),this.mcache.shift(),this.dispatchEvent(new ko("gossipsub:heartbeat"))}getRandomGossipPeers(t,i,r=()=>!0){const s=this.topics.get(t);if(s==null)return new Set;let o=[];return s.forEach(a=>{const l=this.streamsOutbound.get(a);l!=null&&this.multicodecs.includes(l.protocol)&&r(a)&&o.push(a)}),o=Oh(o),i>0&&o.length>i&&(o=o.slice(0,i)),new Set(o)}onScrapeMetrics(t){t.mcacheSize.set(this.mcache.size),t.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let i=0;const r=Date.now();t.connectedPeersBackoffSec.reset();for(const l of this.backoff.values()){i+=l.size;for(const[c,u]of l.entries())this.peers.has(c)&&t.connectedPeersBackoffSec.observe(Math.max(0,u-r)/1e3)}t.cacheSize.set({cache:"backoff"},i);for(const[l,c]of this.topics)t.topicPeersCount.set({topicStr:l},c.size);for(const[l,c]of this.mesh)t.meshPeerCounts.set({topicStr:l},c.size);const s=[],o=new Map;t.behaviourPenalty.reset();for(const l of this.peers.keys()){const c=this.score.score(l);s.push(c),o.set(l,c),t.behaviourPenalty.observe(this.score.peerStats.get(l)?.behaviourPenalty??0)}t.registerScores(s,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,o);const a=JEe(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(a)}}E(Vee,"multicodec",Ij);function h7e(n={}){return e=>new Vee(e,n)}const d7e={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var w8;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(i.uint32(10),i.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(i.uint32(18),i.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(i.uint32(26),i.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(i.uint32(42),i.bytes(t.signature)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.publicKey=t.bytes();break;case 2:r.payloadType=t.bytes();break;case 3:r.payload=t.bytes();break;case 5:r.signature=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(w8||(w8={}));const zf=class zf{constructor(e){E(this,"peerId");E(this,"payloadType");E(this,"payload");E(this,"signature");E(this,"marshaled");const{peerId:t,payloadType:i,payload:r,signature:s}=e;this.peerId=t,this.payloadType=i,this.payload=r,this.signature=s}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=w8.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return li(this.marshal(),e.marshal())}async validate(e){const t=Oj(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return cb(this.peerId.publicKey).verify(t.subarray(),this.signature)}};E(zf,"createFromProtobuf",async e=>{const t=w8.decode(e),i=await jd(t.publicKey);return new zf({peerId:i,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),E(zf,"seal",async(e,t)=>{if(t.privateKey==null)throw new Error("Missing private key");const i=e.domain,r=e.codec,s=e.marshal(),o=Oj(i,r,s),l=await(await _7(t.privateKey)).sign(o.subarray());return new zf({peerId:t,payloadType:r,payload:s,signature:l})}),E(zf,"openAndCertify",async(e,t)=>{const i=await zf.createFromProtobuf(e);if(!await i.validate(t))throw new Se("envelope signature is not valid for the given domain",d7e.ERR_SIGNATURE_NOT_VALID);return i});let Cb=zf;const Oj=(n,e,t)=>{const i=Ut(n),r=Za(i.byteLength),s=Za(e.length),o=Za(t.length);return new Zn(r,i,s,e,o,t)},f7e="libp2p-peer-record",p7e=Uint8Array.from([3,1]);var S8;(function(n){(function(t){let i;t.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.multiaddr!=null&&r.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(r.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(r,s)=>{const o={multiaddr:new Uint8Array(0)},a=s==null?r.len:r.pos+s;for(;r.pos<a;){const l=r.uint32();switch(l>>>3){case 1:o.multiaddr=r.bytes();break;default:r.skipType(l&7);break}}return o})),i),t.encode=r=>Ti(r,t.codec()),t.decode=r=>Ei(r,t.codec())})(n.AddressInfo||(n.AddressInfo={}));let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(i.uint32(10),i.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(i.uint32(16),i.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)i.uint32(26),n.AddressInfo.codec().encode(s,i);r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={peerId:new Uint8Array(0),seq:0n,addresses:[]},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.peerId=t.bytes();break;case 2:r.seq=t.uint64();break;case 3:r.addresses.push(n.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(S8||(S8={}));const Jh=class Jh{constructor(e){E(this,"peerId");E(this,"multiaddrs");E(this,"seqNumber");E(this,"domain",Jh.DOMAIN);E(this,"codec",Jh.CODEC);E(this,"marshaled");const{peerId:t,multiaddrs:i,seqNumber:r}=e;this.peerId=t,this.multiaddrs=i??[],this.seqNumber=r??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=S8.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Jh)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!_Y(this.multiaddrs,e.multiaddrs))}};E(Jh,"createFromProtobuf",e=>{const t=S8.decode(e),i=gh(t.peerId),r=(t.addresses??[]).map(o=>zi(o.multiaddr)),s=t.seq;return new Jh({peerId:i,multiaddrs:r,seqNumber:s})}),E(Jh,"DOMAIN",f7e),E(Jh,"CODEC",p7e);let Iy=Jh;const m7e="0.1.0",g7e="id",y7e="1.0.0",x7e=1024*8,v7e=32;var E8;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{if(r.lengthDelimited!==!1&&i.fork(),t.protocolVersion!=null&&(i.uint32(42),i.string(t.protocolVersion)),t.agentVersion!=null&&(i.uint32(50),i.string(t.agentVersion)),t.publicKey!=null&&(i.uint32(10),i.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)i.uint32(18),i.bytes(s);if(t.observedAddr!=null&&(i.uint32(34),i.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)i.uint32(26),i.string(s);t.signedPeerRecord!=null&&(i.uint32(66),i.bytes(t.signedPeerRecord)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={listenAddrs:[],protocols:[]},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 5:r.protocolVersion=t.string();break;case 6:r.agentVersion=t.string();break;case 1:r.publicKey=t.bytes();break;case 2:r.listenAddrs.push(t.bytes());break;case 4:r.observedAddr=t.bytes();break;case 3:r.protocols.push(t.string());break;case 8:r.signedPeerRecord=t.bytes();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(E8||(E8={}));const Qh={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:x7e,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnTransientConnection:!0,concurrency:v7e};function b7e(n){if(n!=null&&n.length>0)try{return zi(n)}catch{}}function _7e(n,e){return e!=null||(e=`${n.name}/${n.version}`,C3e||T3e?e+=` UserAgent=${globalThis.process.version}`:(RQ||IQ||A3e||M3e)&&(e+=` UserAgent=${globalThis.navigator.userAgent}`)),e}async function w7e(n,e,t,i,r){if(t("received identify from %p",i.remotePeer),r==null)throw new Se("message was null or undefined","ERR_INVALID_MESSAGE");const s={};if(r.listenAddrs.length>0&&(s.addresses=r.listenAddrs.map(l=>({isCertified:!1,multiaddr:zi(l)}))),r.protocols.length>0&&(s.protocols=r.protocols),r.publicKey!=null&&(s.publicKey=r.publicKey,!(await jd(r.publicKey)).equals(i.remotePeer)))throw new Se("public key did not match remote PeerId","ERR_INVALID_PUBLIC_KEY");let o;if(r.signedPeerRecord!=null){t("received signedPeerRecord from %p",i.remotePeer);let l=r.signedPeerRecord;const c=await Cb.openAndCertify(l,Iy.DOMAIN);let u=Iy.createFromProtobuf(c.payload);if(!u.peerId.equals(c.peerId))throw new Se("signing key does not match PeerId in the PeerRecord","ERR_INVALID_SIGNING_KEY");if(!i.remotePeer.equals(u.peerId))throw new Se("signing key does not match remote PeerId","ERR_INVALID_PEER_RECORD_KEY");let h;try{h=await n.get(u.peerId)}catch(p){if(p.code!=="ERR_NOT_FOUND")throw p}if(h!=null&&(s.metadata=h.metadata,h.peerRecordEnvelope!=null)){const p=await Cb.createFromProtobuf(h.peerRecordEnvelope),m=Iy.createFromProtobuf(p.payload);m.seqNumber>=u.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",m.seqNumber,u.seqNumber),u=m,l=h.peerRecordEnvelope)}s.peerRecordEnvelope=l,s.addresses=u.multiaddrs.map(p=>({isCertified:!0,multiaddr:p})),o={seq:u.seqNumber,addresses:u.multiaddrs}}else t("%p did not send a signed peer record",i.remotePeer);if(t("patching %p with",i.remotePeer,s),await n.patch(i.remotePeer,s),r.agentVersion!=null||r.protocolVersion!=null){const l={};r.agentVersion!=null&&(l.AgentVersion=Ut(r.agentVersion)),r.protocolVersion!=null&&(l.ProtocolVersion=Ut(r.protocolVersion)),t("merging %p metadata",i.remotePeer,l),await n.merge(i.remotePeer,{metadata:l})}const a={peerId:i.remotePeer,protocolVersion:r.protocolVersion,agentVersion:r.agentVersion,publicKey:r.publicKey,listenAddrs:r.listenAddrs.map(l=>zi(l)),observedAddr:r.observedAddr==null?void 0:zi(r.observedAddr),protocols:r.protocols,signedPeerRecord:o,connection:i};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class S7e{constructor(e,t){E(this,"host");E(this,"protocol");E(this,"started");E(this,"timeout");E(this,"peerId");E(this,"peerStore");E(this,"registrar");E(this,"addressManager");E(this,"maxInboundStreams");E(this,"maxOutboundStreams");E(this,"maxMessageSize");E(this,"maxObservedAddresses");E(this,"events");E(this,"runOnTransientConnection");E(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Qh.timeout,this.maxInboundStreams=t.maxInboundStreams??Qh.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Qh.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Qh.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Qh.maxObservedAddresses,this.runOnTransientConnection=t.runOnTransientConnection??Qh.runOnTransientConnection,this.host={protocolVersion:`${t.protocolPrefix??Qh.protocolPrefix}/${m7e}`,agentVersion:_7e(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:Ut(this.host.agentVersion),ProtocolVersion:Ut(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}const E7e=n=>n.toString().split("/").slice(1),F_=n=>({match:e=>e.length<1?!1:n(e[0])?e.slice(1):!1,pattern:"fn"}),mi=n=>({match:e=>F_(t=>t===n).match(e),pattern:n}),S1=()=>({match:n=>F_(e=>typeof e=="string").match(n),pattern:"{string}"}),Mb=()=>({match:n=>F_(e=>!isNaN(parseInt(e))).match(n),pattern:"{number}"}),ar=()=>({match:n=>{if(n.length<2||n[0]!=="p2p"&&n[0]!=="ipfs")return!1;if(n[1].startsWith("Q")||n[1].startsWith("1"))try{Lr.decode(`z${n[1]}`)}catch{return!1}else return!1;return n.slice(2)},pattern:"/p2p/{peerid}"}),T8=()=>({match:n=>{if(n.length<2||n[0]!=="certhash")return!1;try{V0.decode(n[1])}catch{return!1}return n.slice(2)},pattern:"/certhash/{certhash}"}),$i=n=>({match:e=>{const t=n.match(e);return t===!1?e:t},pattern:`optional(${n.pattern})`}),$o=(...n)=>({match:e=>{let t;for(const i of n){const r=i.match(e);r!==!1&&(t==null||r.length<t.length)&&(t=r)}return t??!1},pattern:`or(${n.map(e=>e.pattern).join(", ")})`}),wi=(...n)=>({match:e=>{for(const t of n){const i=t.match(e);if(i===!1)return!1;e=i}return e},pattern:`and(${n.map(e=>e.pattern).join(", ")})`});function px(...n){function e(r){let s=E7e(r);for(const o of n){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(r){return e(r)!==!1}function i(r){const s=e(r);return s===!1?!1:s.length===0}return{matchers:n,matches:t,exactMatch:i}}const s9=wi(mi("dns4"),S1()),o9=wi(mi("dns6"),S1()),a9=wi(mi("dnsaddr"),S1()),lD=wi(mi("dns"),S1());px(s9,$i(ar()));px(o9,$i(ar()));px(a9,$i(ar()));px($o(lD,a9,s9,o9),$i(ar()));const T7e=wi(mi("ip4"),F_(pu)),A7e=wi(mi("ip6"),F_(G0)),Hee=$o(T7e,A7e),Td=$o(Hee,lD,s9,o9,a9),C7e=px($o(Hee,wi($o(lD,a9,s9,o9),$i(ar())))),cD=wi(Td,mi("tcp"),Mb()),l9=wi(Td,mi("udp"),Mb());px(wi(cD,$i(ar())));const $ee=wi(l9,mi("quic"),$i(ar())),uD=wi(l9,mi("quic-v1"),$i(ar())),M7e=$o($ee,uD),gN=$o(Td,cD,l9,$ee,uD),R7e=$o(wi(gN,mi("ws"),$i(ar()))),I7e=$o(wi(gN,mi("wss"),$i(ar())),wi(gN,mi("tls"),$i(wi(mi("sni"),S1())),mi("ws"),$i(ar()))),N7e=wi(l9,mi("webrtc-direct"),$i(T8()),$i(T8()),$i(ar())),P7e=wi(uD,mi("webtransport"),$i(T8()),$i(T8()),$i(ar())),yN=$o(R7e,I7e,wi(cD,$i(ar())),wi(M7e,$i(ar())),wi(Td,$i(ar())),N7e,P7e,ar());wi(yN,mi("p2p-circuit"),ar());$o(wi(yN,mi("p2p-circuit"),mi("webrtc"),$i(ar())),wi(yN,mi("webrtc"),$i(ar())),wi(mi("webrtc"),$i(ar())));$o(wi(Td,mi("tcp"),Mb(),mi("http"),$i(ar())),wi(Td,mi("http"),$i(ar())));$o(wi(Td,mi("tcp"),$o(wi(mi("443"),mi("http")),wi(Mb(),mi("https")),wi(Mb(),mi("tls"),mi("http"))),$i(ar())),wi(Td,mi("tls"),mi("http"),$i(ar())),wi(Td,mi("https"),$i(ar())));$o(wi(mi("memory"),S1(),$i(ar())));$o(wi(mi("unix"),S1(),$i(ar())));var NFe;class k7e extends S7e{constructor(t,i={}){super(t,{...i,protocol:`/${i.protocolPrefix??Qh.protocolPrefix}/${g7e}/${y7e}`,log:t.logger.forComponent("libp2p:identify")});E(this,NFe,["@libp2p/identify"]);(i.runOnConnectionOpen??Qh.runOnConnectionOpen)&&t.events.addEventListener("connection:open",r=>{const s=r.detail;this.identify(s).catch(o=>{this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,i={}){let r;if(i.signal==null){const s=AbortSignal.timeout(this.timeout);tr(1/0,s),i={...i,signal:s}}try{r=await t.newStream(this.protocol,{...i,runOnTransientConnection:this.runOnTransientConnection});const o=await Ld(r,{maxDataLength:this.maxMessageSize}).pb(E8).read(i);return await r.close(i),o}catch(s){throw this.log.error("error while reading identify message",s),r?.abort(s),s}}async identify(t,i={}){const r=await this._identify(t,i),{publicKey:s,protocols:o,observedAddr:a}=r;if(s==null)throw new Se("public key was missing from identify message","ERR_MISSING_PUBLIC_KEY");const l=await jd(s);if(!t.remotePeer.equals(l))throw new Se("identified peer does not match the expected peer","ERR_INVALID_PEER");if(this.peerId.equals(l))throw new Se("identified peer is our own peer id?","ERR_INVALID_PEER");const c=b7e(a);return this.log("identify completed for peer %p and protocols %o",l,o),this.log("our observed address is %a",c),c!=null&&this.addressManager.getObservedAddrs().length<(this.maxObservedAddresses??1/0)&&(this.log("storing our observed address %a",c),this.addressManager.addObservedAddr(c)),w7e(this.peerStore,this.events,this.log,t,r)}async handleProtocol(t){const{connection:i,stream:r}=t,s=AbortSignal.timeout(this.timeout);tr(1/0,s);try{const o=this.peerId.publicKey??new Uint8Array(0),a=await this.peerStore.get(this.peerId),l=this.addressManager.getAddresses().map(p=>p.decapsulateCode(vl("p2p").code));let c=a.peerRecordEnvelope;if(l.length>0&&c==null){const p=new Iy({peerId:this.peerId,multiaddrs:l});c=(await Cb.seal(p,this.peerId)).marshal().subarray()}let u=i.remoteAddr.bytes;C7e.matches(i.remoteAddr)||(u=void 0),await Ld(r).pb(E8).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:o,listenAddrs:l.map(p=>p.bytes),signedPeerRecord:c,observedAddr:u,protocols:a.protocols},{signal:s}),await r.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),r.abort(o)}}}NFe=kd;function L7e(n={}){return e=>new k7e(e,n)}function D7e(n){return n[Symbol.asyncIterator]!=null}function O7e(n){if(D7e(n))return(async()=>{for await(const e of n)return e})();for(const e of n)return e}const Bj=32,B7e="1.0.0",U7e="ping",F7e="ipfs",z7e=1e4,j7e=2,V7e=1,Uj="ERR_WRONG_PING_ACK";var PFe;class H7e{constructor(e,t={}){E(this,"protocol");E(this,"components");E(this,"started");E(this,"timeout");E(this,"maxInboundStreams");E(this,"maxOutboundStreams");E(this,"runOnTransientConnection");E(this,"log");E(this,PFe,"@libp2p/ping");this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??F7e}/${U7e}/${B7e}`,this.timeout=t.timeout??z7e,this.maxInboundStreams=t.maxInboundStreams??j7e,this.maxOutboundStreams=t.maxOutboundStreams??V7e,this.runOnTransientConnection=t.runOnTransientConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,i=Date.now();AbortSignal.timeout(this.timeout).addEventListener("abort",()=>{t?.abort(new Se("ping timeout",tb))}),Qa(t,async function*(s){let o=0;for await(const a of s){if(o+=a.byteLength,o>Bj){t?.abort(new Se("Too much data received",eq));return}yield a}},t).catch(s=>{this.log.error("incoming ping from %p failed with error",e.connection.remotePeer,s),t?.abort(s)}).finally(()=>{const s=Date.now()-i;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,s)})}async ping(e,t={}){this.log("pinging %p",e);const i=Date.now(),r=R0(Bj),s=await this.components.connectionManager.openConnection(e,t);let o,a=()=>{};if(t.signal==null){const l=AbortSignal.timeout(this.timeout);t={...t,signal:l}}try{o=await s.newStream(this.protocol,{...t,runOnTransientConnection:this.runOnTransientConnection}),a=()=>{o?.abort(new Se("ping timeout",tb))},t.signal?.addEventListener("abort",a,{once:!0});const l=await Qa([r],o,async u=>O7e(u)),c=Date.now()-i;if(l==null)throw new Se(`Did not receive a ping ack after ${c}ms`,Uj);if(!li(r,l.subarray()))throw new Se(`Received wrong ping ack after ${c}ms`,Uj);return this.log("ping %p complete in %dms",s.remotePeer,c),c}catch(l){throw this.log.error("error while pinging %p",s.remotePeer,l),o?.abort(l),l}finally{t.signal?.removeEventListener("abort",a),o!=null&&await o.close()}}}PFe=Symbol.toStringTag;function $7e(n={}){return e=>new H7e(e,n)}const G7e="0.0.1",W7e="fetch";var A8;(function(n){let e;n.codec=()=>(e==null&&(e=Ai((t,i,r={})=>{r.lengthDelimited!==!1&&i.fork(),t.identifier!=null&&t.identifier!==""&&(i.uint32(10),i.string(t.identifier)),r.lengthDelimited!==!1&&i.ldelim()},(t,i)=>{const r={identifier:""},s=i==null?t.len:t.pos+i;for(;t.pos<s;){const o=t.uint32();switch(o>>>3){case 1:r.identifier=t.string();break;default:t.skipType(o&7);break}}return r})),e),n.encode=t=>Ti(t,n.codec()),n.decode=t=>Ei(t,n.codec())})(A8||(A8={}));var zu;(function(n){let e;(function(r){r.OK="OK",r.NOT_FOUND="NOT_FOUND",r.ERROR="ERROR"})(e=n.StatusCode||(n.StatusCode={}));let t;(function(r){r[r.OK=0]="OK",r[r.NOT_FOUND=1]="NOT_FOUND",r[r.ERROR=2]="ERROR"})(t||(t={})),function(r){r.codec=()=>u1(t)}(e=n.StatusCode||(n.StatusCode={}));let i;n.codec=()=>(i==null&&(i=Ai((r,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),r.status!=null&&t[r.status]!==0&&(s.uint32(8),n.StatusCode.codec().encode(r.status,s)),r.data!=null&&r.data.byteLength>0&&(s.uint32(18),s.bytes(r.data)),o.lengthDelimited!==!1&&s.ldelim()},(r,s)=>{const o={status:e.OK,data:new Uint8Array(0)},a=s==null?r.len:r.pos+s;for(;r.pos<a;){const l=r.uint32();switch(l>>>3){case 1:o.status=n.StatusCode.codec().decode(r);break;case 2:o.data=r.bytes();break;default:r.skipType(l&7);break}}return o})),i),n.encode=r=>Ti(r,n.codec()),n.decode=r=>Ei(r,n.codec())})(zu||(zu={}));const Fj=1e4;var kFe;class K7e{constructor(e,t={}){E(this,"protocol");E(this,"components");E(this,"lookupFunctions");E(this,"started");E(this,"init");E(this,"log");E(this,kFe,"@libp2p/fetch");this.log=e.logger.forComponent("libp2p:fetch"),this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/${W7e}/${G7e}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,e=>{this.handleMessage(e).then(async()=>{await e.stream.close()}).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,i={}){this.log("dialing %s to %p",this.protocol,e);const r=await this.components.connectionManager.openConnection(e,i);let s=i.signal,o,a=()=>{};if(s==null){const l=this.init.timeout??Fj;this.log("using default timeout of %d ms",l),s=AbortSignal.timeout(l),tr(1/0,s)}try{o=await r.newStream(this.protocol,{signal:s}),a=()=>{o?.abort(new Se("fetch timeout",tb))},s.addEventListener("abort",a,{once:!0}),this.log("fetch %s",t);const l=Ld(o);await l.write({identifier:t},A8,i);const c=await l.read(zu,i);switch(await l.unwrap().close(i),c.status){case zu.StatusCode.OK:return this.log("received status for %s ok",t),c.data;case zu.StatusCode.NOT_FOUND:{this.log("received status for %s not found",t);return}case zu.StatusCode.ERROR:{this.log("received status for %s error",t);const u=Vt(c.data);throw new Se("Error in fetch protocol response: "+u,ice)}default:throw this.log("received status for %s unknown",t),new Se("Unknown response status",eq)}}catch(l){throw o?.abort(l),l}finally{s.removeEventListener("abort",a),o!=null&&await o.close()}}async handleMessage(e){const{stream:t}=e,i=AbortSignal.timeout(this.init.timeout??Fj);try{const r=Ld(t),s=await r.read(A8,{signal:i});let o;const a=this._getLookupFunction(s.identifier);if(a!=null){this.log("look up data with identifier %s",s.identifier);const l=await a(s.identifier);l!=null?(this.log("sending status for %s ok",s.identifier),o={status:zu.StatusCode.OK,data:l}):(this.log("sending status for %s not found",s.identifier),o={status:zu.StatusCode.NOT_FOUND,data:new Uint8Array(0)})}else{this.log("sending status for %s error",s.identifier);const l=Ut(`No lookup function registered for key: ${s.identifier}`);o={status:zu.StatusCode.ERROR,data:l}}await r.write(o,zu,{signal:i}),await r.unwrap().close({signal:i})}catch(r){this.log("error answering fetch request",r),t.abort(r)}}_getLookupFunction(e){for(const t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw new Se(`Fetch protocol handler for key prefix '${e}' already registered`,"ERR_KEY_ALREADY_EXISTS");this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){t!=null&&this.lookupFunctions.get(e)!==t||this.lookupFunctions.delete(e)}}kFe=Symbol.toStringTag;function q7e(n={}){return e=>new K7e(e,n)}var hD={exports:{}},Ny=typeof Reflect=="object"?Reflect:null,zj=Ny&&typeof Ny.apply=="function"?Ny.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)},PS;Ny&&typeof Ny.ownKeys=="function"?PS=Ny.ownKeys:Object.getOwnPropertySymbols?PS=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:PS=function(e){return Object.getOwnPropertyNames(e)};function Z7e(n){console&&console.warn&&console.warn(n)}var Gee=Number.isNaN||function(e){return e!==e};function cr(){cr.init.call(this)}hD.exports=cr;hD.exports.once=J7e;cr.EventEmitter=cr;cr.prototype._events=void 0;cr.prototype._eventsCount=0;cr.prototype._maxListeners=void 0;var jj=10;function c9(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(cr,"defaultMaxListeners",{enumerable:!0,get:function(){return jj},set:function(n){if(typeof n!="number"||n<0||Gee(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");jj=n}});cr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};cr.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Gee(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Wee(n){return n._maxListeners===void 0?cr.defaultMaxListeners:n._maxListeners}cr.prototype.getMaxListeners=function(){return Wee(this)};cr.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r=e==="error",s=this._events;if(s!==void 0)r=r&&s.error===void 0;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var l=s[e];if(l===void 0)return!1;if(typeof l=="function")zj(l,this,t);else for(var c=l.length,u=Xee(l,c),i=0;i<c;++i)zj(u[i],this,t);return!0};function Kee(n,e,t,i){var r,s,o;if(c9(t),s=n._events,s===void 0?(s=n._events=Object.create(null),n._eventsCount=0):(s.newListener!==void 0&&(n.emit("newListener",e,t.listener?t.listener:t),s=n._events),o=s[e]),o===void 0)o=s[e]=t,++n._eventsCount;else if(typeof o=="function"?o=s[e]=i?[t,o]:[o,t]:i?o.unshift(t):o.push(t),r=Wee(n),r>0&&o.length>r&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=n,a.type=e,a.count=o.length,Z7e(a)}return n}cr.prototype.addListener=function(e,t){return Kee(this,e,t,!1)};cr.prototype.on=cr.prototype.addListener;cr.prototype.prependListener=function(e,t){return Kee(this,e,t,!0)};function Y7e(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qee(n,e,t){var i={fired:!1,wrapFn:void 0,target:n,type:e,listener:t},r=Y7e.bind(i);return r.listener=t,i.wrapFn=r,r}cr.prototype.once=function(e,t){return c9(t),this.on(e,qee(this,e,t)),this};cr.prototype.prependOnceListener=function(e,t){return c9(t),this.prependListener(e,qee(this,e,t)),this};cr.prototype.removeListener=function(e,t){var i,r,s,o,a;if(c9(t),r=this._events,r===void 0)return this;if(i=r[e],i===void 0)return this;if(i===t||i.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if(typeof i!="function"){for(s=-1,o=i.length-1;o>=0;o--)if(i[o]===t||i[o].listener===t){a=i[o].listener,s=o;break}if(s<0)return this;s===0?i.shift():X7e(i,s),i.length===1&&(r[e]=i[0]),r.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};cr.prototype.off=cr.prototype.removeListener;cr.prototype.removeAllListeners=function(e){var t,i,r;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),o;for(r=0;r<s.length;++r)o=s[r],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=i[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};function Zee(n,e,t){var i=n._events;if(i===void 0)return[];var r=i[e];return r===void 0?[]:typeof r=="function"?t?[r.listener||r]:[r]:t?Q7e(r):Xee(r,r.length)}cr.prototype.listeners=function(e){return Zee(this,e,!0)};cr.prototype.rawListeners=function(e){return Zee(this,e,!1)};cr.listenerCount=function(n,e){return typeof n.listenerCount=="function"?n.listenerCount(e):Yee.call(n,e)};cr.prototype.listenerCount=Yee;function Yee(n){var e=this._events;if(e!==void 0){var t=e[n];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}cr.prototype.eventNames=function(){return this._eventsCount>0?PS(this._events):[]};function Xee(n,e){for(var t=new Array(e),i=0;i<e;++i)t[i]=n[i];return t}function X7e(n,e){for(;e+1<n.length;e++)n[e]=n[e+1];n.pop()}function Q7e(n){for(var e=new Array(n.length),t=0;t<e.length;++t)e[t]=n[t].listener||n[t];return e}function J7e(n,e){return new Promise(function(t,i){function r(o){n.removeListener(e,s),i(o)}function s(){typeof n.removeListener=="function"&&n.removeListener("error",r),t([].slice.call(arguments))}Qee(n,e,s,{once:!0}),e!=="error"&&e9e(n,r,{once:!0})})}function e9e(n,e,t){typeof n.on=="function"&&Qee(n,"error",e,t)}function Qee(n,e,t,i){if(typeof n.on=="function")i.once?n.once(e,t):n.on(e,t);else if(typeof n.addEventListener=="function")n.addEventListener(e,function r(s){i.once&&n.removeEventListener(e,r),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var t9e=hD.exports;const Vj="/g3zkp/messenger/1.0.0",hC="g3zkp-discovery",F4="g3zkp-messages",Cu={HAZARD:"/g3zkp/geo/hazard/v1",TRAFFIC:"/g3zkp/geo/traffic/v1",REVIEW:"/g3zkp/business/review/v1"};class n9e extends t9e.EventEmitter{constructor(t={}){super();E(this,"node",null);E(this,"config");E(this,"peers",new Map);E(this,"messageHandlers",new Set);E(this,"peerConnectHandlers",new Set);E(this,"peerDisconnectHandlers",new Set);E(this,"connectionHandlers",new Set);E(this,"subscriptions",new Set);E(this,"initialized",!1);E(this,"localPeerId","");E(this,"startTime",0);E(this,"geoReportHandlers",new Map);this.config={bootstrapNodes:t.bootstrapNodes||["/dnsaddr/bootstrap.libp2p.io","/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAcoCA25L5d6fT3j5c1YhYxB4dT5xY4wYxYxY","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAcoCA25L5d6fT3j5c1YhYxB4dT5xY4wYxYxY"],enableWebRTC:t.enableWebRTC??!0,enableDHT:t.enableDHT??!0,maxConnections:t.maxConnections||50,connectionTimeout:t.connectionTimeout||3e4}}async initialize(){if(this.initialized)return this.localPeerId;try{console.log("[LibP2P] Initializing LibP2P node...");const t=[],i={};this.config.bootstrapNodes.length>0&&t.push(f6e({list:this.config.bootstrapNodes,timeout:3e3})),i.identify=L7e(),i.ping=$7e({protocolPrefix:"g3zkp"}),this.config.enableDHT&&(i.dht=tEe({clientMode:!0,validators:{},selectors:{}})),i.pubsub=h7e({emitSelf:!1,fallbackToFloodsub:!0,msgIdFn:a=>{const l=a.data,c=this.hashMessage(l);return Ut(c)},msgIdToStrFn:a=>Vt(a,"hex")}),i.fetch=q7e();const r=[j3e({filter:FQ}),l6e()];if(this.config.enableWebRTC)try{r.push(Obe())}catch(a){console.warn("[LibP2P] WebRTC not available:",a)}const s=[wve()],o=[Gve(),l3e()];return this.node=await age({transports:r,connectionEncryption:s,streamMuxers:o,peerDiscovery:t,services:i,connectionManager:{maxConnections:this.config.maxConnections,minConnections:5,autoDialConcurrency:25,maxParallelDials:50,dialTimeout:this.config.connectionTimeout}}),this.localPeerId=this.node.peerId.toString(),this.setupEventHandlers(),await this.registerProtocol(),await this.node.start(),this.startTime=Date.now(),this.initialized=!0,await this.subscribe(hC),await this.subscribe(F4),await this.subscribe(Cu.HAZARD),await this.subscribe(Cu.TRAFFIC),await this.subscribe(Cu.REVIEW),this.startPresenceAnnouncements(),console.log("[LibP2P] Node initialized:",this.localPeerId),console.log("[LibP2P] Multiaddrs:",this.node.getMultiaddrs().map(a=>a.toString())),this.emit("initialized",{peerId:this.localPeerId,addresses:this.node.getMultiaddrs().map(a=>a.toString())}),this.localPeerId}catch(t){throw console.error("[LibP2P] Initialization failed:",t),this.emit("error",{error:t instanceof Error?t.message:"Unknown error"}),t}}setupEventHandlers(){if(!this.node)return;this.node.addEventListener("peer:discovery",i=>{const r=i.detail;this.handlePeerDiscovery(r.id)}),this.node.addEventListener("peer:connect",i=>{const r=i.detail;this.handlePeerConnect(r)}),this.node.addEventListener("peer:disconnect",i=>{const r=i.detail;this.handlePeerDisconnect(r)});const t=this.node.services.pubsub;t&&t.addEventListener("message",i=>{this.handlePubsubMessage(i.detail)})}async registerProtocol(){this.node&&await this.node.handle(Vj,async({stream:t,connection:i})=>{const r=i.remotePeer.toString();try{await Qa(t.source,async function*(s){for await(const o of s)yield o},async s=>{const o=[];for await(const l of s)o.push(l.subarray());const a=this.concatUint8Arrays(o);this.handleIncomingMessage(a,r)})}catch(s){console.error("[LibP2P] Protocol handler error:",s),this.emit("error",{peerId:r,error:s})}finally{await t.close()}})}startPresenceAnnouncements(){setInterval(async()=>{this.initialized&&this.node&&!this.node.isStopped()&&await this.announcePresence()},3e4)}async announcePresence(){if(!this.node)return;const t={type:"presence",peerId:this.node.peerId.toString(),addresses:this.node.getMultiaddrs().map(r=>r.toString()),timestamp:Date.now(),capabilities:["messaging","zkp","relay"],version:"1.0.0",userAgent:navigator.userAgent},i=Ut(JSON.stringify(t));await this.publishMessage(hC,i)}handlePeerDiscovery(t){const i=t.toString();this.peers.has(i)||this.peers.set(i,{id:i,addresses:[],protocols:[],latency:-1,lastSeen:new Date,connectionStatus:"disconnected",metadata:{}}),this.emit("peer:discovered",{peerId:i}),this.attemptConnection(i)}async handlePeerConnect(t){const i=t.toString(),r=this.peers.get(i)||{id:i,addresses:[],protocols:[],latency:-1,lastSeen:new Date,connectionStatus:"connected",metadata:{}};if(r.connectionStatus="connected",r.lastSeen=new Date,this.node){try{const s=await this.measureLatency(i);r.latency=s}catch{r.latency=-1}try{const s=this.node.getConnections(t);s.length>0&&(r.addresses=s[0].remoteAddr?[s[0].remoteAddr.toString()]:[])}catch{}}this.peers.set(i,r),this.peerConnectHandlers.forEach(s=>s(r)),this.emit("peer:connected",{peerId:i,peerInfo:r})}handlePeerDisconnect(t){const i=t.toString(),r=this.peers.get(i);r&&(r.connectionStatus="disconnected",r.lastSeen=new Date,this.peers.set(i,r)),this.peerDisconnectHandlers.forEach(s=>s(r)),this.emit("peer:disconnected",{peerId:i})}handlePubsubMessage(t){const i=t.topic,r=t.data,s=t.from?.toString()||"unknown";i===hC?this.handleDiscoveryMessage(r,s):i===F4?this.handleBroadcastMessage(r,s):this.isGeoTopic(i)&&this.handleGeoReportMessage(i,r,s),this.emit("pubsub:message",{topic:i,data:r,from:s})}isGeoTopic(t){return t===Cu.HAZARD||t===Cu.TRAFFIC||t===Cu.REVIEW}handleGeoReportMessage(t,i,r){try{const s=JSON.parse(Vt(i)),o=this.geoReportHandlers.get(t);o&&o.forEach(a=>{try{a(s,r)}catch(l){console.error("[LibP2P] Geo report handler error:",l)}}),this.emit("geo:report",{topic:t,data:s,from:r}),console.log(`[LibP2P] Received geo report on ${t} from ${r}`)}catch(s){console.error("[LibP2P] Failed to parse geo report:",s)}}handleDiscoveryMessage(t,i){try{const r=JSON.parse(Vt(t));if(r.type==="presence"&&r.peerId!==this.localPeerId){const s=this.peers.get(r.peerId)||{id:r.peerId,addresses:r.addresses||[],protocols:[],latency:-1,lastSeen:new Date,connectionStatus:"disconnected",metadata:{capabilities:r.capabilities,version:r.version}};s.addresses=r.addresses||[],s.lastSeen=new Date,s.metadata={capabilities:r.capabilities,version:r.version},this.peers.set(r.peerId,s),this.attemptConnection(r.peerId)}}catch{}}handleBroadcastMessage(t,i){const r={id:this.generateMessageId(),from:i,to:"broadcast",data:t,timestamp:new Date,type:"broadcast",topic:F4};this.messageHandlers.forEach(s=>s(r)),this.emit("message:broadcast",r)}handleIncomingMessage(t,i){const r={id:this.generateMessageId(),from:i,to:this.localPeerId,data:t,timestamp:new Date,type:"direct"};this.messageHandlers.forEach(s=>s(r)),this.emit("message:received",r)}async attemptConnection(t){if(!this.node||this.node.isStopped())return;const i=this.peers.get(t);if(!(!i||i.connectionStatus==="connected")){i.connectionStatus="connecting",this.peers.set(t,i);try{const r=Bi(t);if(i.addresses.length>0)for(const s of i.addresses)try{const o=zi(s);await this.node.dial(o,{signal:AbortSignal.timeout(this.config.connectionTimeout)});return}catch{continue}await this.node.dial(r,{signal:AbortSignal.timeout(this.config.connectionTimeout)})}catch{i.connectionStatus="disconnected",this.peers.set(t,i)}}}async measureLatency(t){if(!this.node)return-1;try{const i=Bi(t),r=this.node.services.ping;if(r)return await r.ping(i)}catch{}return-1}async sendMessage(t,i){if(!this.node||!this.initialized)return console.warn("[LibP2P] Cannot send message: node not initialized"),!1;try{const r=typeof i=="string"?Ut(i):i,s=Bi(t),o=await this.node.dialProtocol(s,Vj,{signal:AbortSignal.timeout(this.config.connectionTimeout)});return await Qa([r],o.sink),await o.close(),console.log("[LibP2P] Message sent to:",t),!0}catch(r){console.error("[LibP2P] Failed to send direct message:",r);try{const s={type:"direct",targetPeer:t,data:Vt(typeof i=="string"?Ut(i):i,"base64"),timestamp:Date.now(),from:this.localPeerId};return await this.publishMessage(F4,Ut(JSON.stringify(s))),console.log("[LibP2P] Message sent via pubsub relay to:",t),!0}catch(s){return console.error("[LibP2P] Failed to send via relay:",s),!1}}}async publishMessage(t,i){if(!this.node||!this.initialized)return console.warn("[LibP2P] Cannot publish message: node not initialized"),!1;try{return await this.node.services.pubsub.publish(t,i),console.log("[LibP2P] Message published to topic:",t),!0}catch(r){return console.error("[LibP2P] Failed to publish message:",r),!1}}async subscribe(t){if(!this.node||this.subscriptions.has(t))return;await this.node.services.pubsub.subscribe(t),this.subscriptions.add(t),console.log("[LibP2P] Subscribed to topic:",t),this.emit("topic:subscribed",{topic:t})}async unsubscribe(t){if(!this.node||!this.subscriptions.has(t))return;await this.node.services.pubsub.unsubscribe(t),this.subscriptions.delete(t),console.log("[LibP2P] Unsubscribed from topic:",t),this.emit("topic:unsubscribed",{topic:t})}onMessage(t){return this.messageHandlers.add(t),()=>this.messageHandlers.delete(t)}onPeerConnect(t){return this.peerConnectHandlers.add(t),()=>this.peerConnectHandlers.delete(t)}onPeerDisconnect(t){return this.peerDisconnectHandlers.add(t),()=>this.peerDisconnectHandlers.delete(t)}onConnectionChange(t){return this.connectionHandlers.add(t),()=>this.connectionHandlers.delete(t)}onGeoReport(t,i){return this.geoReportHandlers.has(t)||this.geoReportHandlers.set(t,new Set),this.geoReportHandlers.get(t).add(i),()=>{const r=this.geoReportHandlers.get(t);r&&r.delete(i)}}async broadcastGeoReport(t,i){let r;switch(i){case"HAZARD":r=Cu.HAZARD;break;case"TRAFFIC":r=Cu.TRAFFIC;break;case"REVIEW":r=Cu.REVIEW;break;default:return console.error("[LibP2P] Unknown geo report type:",i),!1}const s=Ut(JSON.stringify(t)),o=await this.publishMessage(r,s);return o&&console.log(`[LibP2P] Broadcast ${i} geo report: ${t.id}`),o}getGeoTopics(){return Cu}getLocalPeerId(){return this.localPeerId}getConnectedPeers(){return Array.from(this.peers.values()).filter(t=>t.connectionStatus==="connected")}getAllPeers(){return Array.from(this.peers.values())}getPeerInfo(t){return this.peers.get(t)}getMultiaddrs(){return this.node?.getMultiaddrs().map(t=>t.toString())||[]}isInitialized(){return this.initialized&&this.node!==null&&!this.node.isStopped()}async connectToPeer(t){if(!this.node)return!1;try{const i=zi(t);return await this.node.dial(i,{signal:AbortSignal.timeout(this.config.connectionTimeout)}),!0}catch{return!1}}async disconnectFromPeer(t){if(this.node)try{const i=Bi(t);await this.node.hangUp(i)}catch{}}async shutdown(){if(this.node){for(const t of this.subscriptions)await this.unsubscribe(t);await this.node.stop(),this.node=null}this.peers.clear(),this.messageHandlers.clear(),this.peerConnectHandlers.clear(),this.peerDisconnectHandlers.clear(),this.connectionHandlers.clear(),this.subscriptions.clear(),this.initialized=!1,console.log("[LibP2P] Node shutdown complete"),this.emit("shutdown")}generateMessageId(){return`msg_${Date.now()}_${Math.random().toString(36).substring(2,11)}`}hashMessage(t){let i=0;for(let r=0;r<t.length;r++){const s=t[r];i=(i<<5)-i+s,i=i&i}return Math.abs(i).toString(16).padStart(16,"0")}concatUint8Arrays(t){const i=t.reduce((o,a)=>o+a.length,0),r=new Uint8Array(i);let s=0;for(const o of t)r.set(o,s),s+=o.length;return r}}const Xl=new n9e;class i9e{constructor(){E(this,"socket",null);E(this,"localPeerId","");E(this,"localPeerName","LOCAL_OPERATOR");E(this,"messageHandlers",new Set);E(this,"peerConnectHandlers",new Set);E(this,"peerDisconnectHandlers",new Set);E(this,"connectionHandlers",new Set);E(this,"connectedPeers",new Map);E(this,"messageQueue",[]);E(this,"isConnected",!1);E(this,"p2pMode","hybrid");E(this,"libp2pInitialized",!1)}async initialize(e){Tr.isInitialized()||await Tr.initialize(),this.localPeerId="12D3KooW"+this.generateId(32);const t=e||this.getServerUrl();return new Promise((i,r)=>{this.socket=Ey(t,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:1e4}),this.socket.on("connect",()=>{this.isConnected=!0,this.socket.emit("register",{peerId:this.localPeerId,peerName:this.localPeerName,publicKey:Tr.getPublicKey(),timestamp:Date.now()}),this.notifyConnectionHandlers("connected"),this.flushMessageQueue(),this.initializeP2P().catch(s=>{console.warn("[MessagingService] P2P initialization failed (non-fatal):",s)}),i(this.localPeerId)}),this.socket.on("disconnect",()=>{this.isConnected=!1,this.notifyConnectionHandlers("disconnected")}),this.socket.on("connect_error",s=>{this.notifyConnectionHandlers("error",s.message),this.isConnected||i(this.localPeerId)}),this.socket.on("message",s=>{this.handleIncomingMessage(s)}),this.socket.on("peer_connected",s=>{this.connectedPeers.set(s.peerId,s),this.peerConnectHandlers.forEach(o=>o(s))}),this.socket.on("peer_disconnected",s=>{const o=this.connectedPeers.get(s);o&&(this.connectedPeers.delete(s),this.peerDisconnectHandlers.forEach(a=>a(o)))}),this.socket.on("peers_list",s=>{s.forEach(o=>{o.peerId!==this.localPeerId&&this.connectedPeers.set(o.peerId,o)})}),setTimeout(()=>{this.isConnected||(this.initializeP2P().catch(s=>{console.warn("[MessagingService] P2P initialization failed (offline mode):",s)}),i(this.localPeerId))},3e3)})}getServerUrl(){if(typeof window<"u"){const e=window.location.hostname,t=window.location.protocol==="https:";if(e==="localhost"||e==="127.0.0.1")return`http://${e}:3001`;const i=window.location.port||(t?"443":"80");return t?`https://${e}${i!=="443"?":"+i:""}`:`http://${e}${i!=="80"?":"+i:""}`}return"http://localhost:3001"}generateId(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";return Array.from({length:e},()=>t[Math.floor(Math.random()*t.length)]).join("")}handleIncomingMessage(e){let t=e.content||"";if(e.isEncrypted&&e.encrypted)try{t=Tr.decrypt(e.senderId,e.encrypted)}catch(r){console.error("Failed to decrypt message:",r),t="[Encrypted message - decryption failed]"}const i={id:e.id,sender:e.senderName,recipient:e.recipientId,content:t,timestamp:e.timestamp,status:"delivered",type:e.type,isZkpVerified:!!e.zkpProofId,isMe:!1,mediaUrl:e.mediaUrl,mediaType:e.mediaType,fileName:e.fileName,fileSize:e.fileSize,tensorData:e.tensorData};this.messageHandlers.forEach(r=>r(i))}async sendMessage(e,t,i={}){const r=this.generateId(16),s=Date.now();let o;i.encrypt!==!1&&Tr.hasSession(e)&&(o=Tr.encrypt(e,t));const a={id:r,senderId:this.localPeerId,senderName:this.localPeerName,recipientId:e,content:o?void 0:t,encrypted:o,timestamp:s,type:i.type||"text",mediaUrl:i.mediaUrl,mediaType:i.mediaType,fileName:i.fileName,fileSize:i.fileSize,tensorData:i.tensorData,isEncrypted:!!o};let l=!1;return this.libp2pInitialized&&this.p2pMode!=="relay-only"&&(l=await this.sendViaP2P(e,a)),this.p2pMode!=="p2p-only"?this.isConnected&&this.socket?this.socket.emit("message",a):l||this.messageQueue.push(a):l||this.messageQueue.push(a),{id:r,sender:this.localPeerName,recipient:e,content:t,timestamp:s,status:this.isConnected?"sent":"pending",type:i.type||"text",isZkpVerified:!1,isMe:!0,mediaUrl:i.mediaUrl,mediaType:i.mediaType,fileName:i.fileName,fileSize:i.fileSize,tensorData:i.tensorData}}async sendMediaMessage(e,t,i={}){const r=URL.createObjectURL(t),s=t.type.startsWith("image/"),o=t.type.startsWith("video/");let a="file",l;return s?(a=i.convert3D?"3d-object":"image",i.convert3D&&(l=await this.convertTo3DObject(t))):o&&(a=i.convert3D?"3d-object":"video",i.convert3D&&(l=await this.convertTo3DObject(t))),this.sendMessage(e,t.name,{type:a,mediaUrl:r,mediaType:t.type,fileName:t.name,fileSize:t.size,tensorData:l})}async convertTo3DObject(e){return new Promise(t=>{const i=URL.createObjectURL(e);if(e.type.startsWith("image/")){const r=new Image;r.onload=()=>{const s=r.width/r.height;t({objectUrl:i,dimensions:{width:s,height:1,depth:.1},vertices:4})},r.src=i}else t({objectUrl:i,dimensions:{width:1.78,height:1,depth:.1},vertices:4})})}async flushMessageQueue(){if(this.messageQueue.length===0)return;const e=this.isConnected&&this.socket&&this.p2pMode!=="p2p-only",t=this.libp2pInitialized&&this.p2pMode!=="relay-only";if(!e&&!t)return;const i=[];for(;this.messageQueue.length>0;){const r=this.messageQueue.shift();if(!r)continue;let s=!1;if(t)try{const o=new TextEncoder().encode(JSON.stringify(r));await Xl.sendDirectMessage(r.recipientId,o),s=!0,console.log("[MessagingService] Queued message sent via P2P to:",r.recipientId)}catch{console.warn("[MessagingService] P2P flush failed for:",r.id)}!s&&e&&(this.socket.emit("message",r),s=!0),s||i.push(r)}i.length>0&&this.messageQueue.push(...i)}notifyConnectionHandlers(e,t){this.connectionHandlers.forEach(i=>i(e,t))}onMessage(e){return this.messageHandlers.add(e),()=>this.messageHandlers.delete(e)}onPeerConnect(e){return this.peerConnectHandlers.add(e),()=>this.peerConnectHandlers.delete(e)}onPeerDisconnect(e){return this.peerDisconnectHandlers.add(e),()=>this.peerDisconnectHandlers.delete(e)}onConnectionChange(e){return this.connectionHandlers.add(e),()=>this.connectionHandlers.delete(e)}getConnectedPeers(){return Array.from(this.connectedPeers.values())}getLocalPeerId(){return this.localPeerId}getLocalPeerName(){return this.localPeerName}setLocalPeerName(e){this.localPeerName=e,this.socket&&this.isConnected&&this.socket.emit("update_name",{peerId:this.localPeerId,name:e})}isSocketConnected(){return this.isConnected}getSocket(){return this.socket}establishSession(e,t){Tr.establishSession(e,t)}async initializeP2P(){if(this.libp2pInitialized){console.log("[MessagingService] LibP2P already initialized");return}try{console.log("[MessagingService] Initializing LibP2P...");const e=await Xl.initialize();console.log("[MessagingService] LibP2P initialized with peerId:",e),Xl.onMessage(t=>{console.log("[MessagingService] Received P2P message from:",t.from),this.handleP2PMessage(t)}),Xl.onPeerConnect(t=>{console.log("[MessagingService] P2P peer connected:",t.id);const i={peerId:t.id,name:t.metadata?.name||"P2P_PEER",publicKey:t.metadata?.publicKey,isOnline:!0,lastSeen:t.lastSeen.getTime()};this.connectedPeers.set(t.id,i),this.peerConnectHandlers.forEach(r=>r(i))}),Xl.onPeerDisconnect(t=>{console.log("[MessagingService] P2P peer disconnected:",t.id);const i=this.connectedPeers.get(t.id);i&&(this.connectedPeers.delete(t.id),this.peerDisconnectHandlers.forEach(r=>r(i)))}),this.libp2pInitialized=!0,console.log("[MessagingService] LibP2P fully integrated"),this.flushMessageQueue().catch(t=>{console.warn("[MessagingService] Queue flush after P2P init failed:",t)})}catch(e){console.error("[MessagingService] Failed to initialize LibP2P:",e)}}async sendViaP2P(e,t){if(!this.libp2pInitialized||this.p2pMode==="relay-only")return!1;try{const i=new TextEncoder().encode(JSON.stringify(t));return await Xl.sendDirectMessage(e,i),console.log("[MessagingService] Message sent via P2P to:",e),!0}catch(i){return console.warn("[MessagingService] P2P send failed, falling back to relay:",i),!1}}handleP2PMessage(e){try{const t=new TextDecoder().decode(e.data),i=JSON.parse(t);this.handleIncomingMessage(i)}catch(t){console.error("[MessagingService] Failed to parse P2P message:",t)}}setP2PMode(e){this.p2pMode=e,console.log("[MessagingService] P2P mode set to:",e)}getP2PMode(){return this.p2pMode}isP2PInitialized(){return this.libp2pInitialized}async getP2PStats(){return this.libp2pInitialized?Xl.getStats():null}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.libp2pInitialized&&(Xl.stop(),this.libp2pInitialized=!1),this.isConnected=!1,this.connectedPeers.clear()}}const gl=new i9e,r9e=()=>{if(typeof window<"u"&&window.location){const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"?"http://localhost:3001":""}return"http://localhost:3001"};let gv=null;const dC=()=>(gv===null&&(gv=r9e(),gv?console.log("[ZKPService] API Base URL:",gv):console.log("[ZKPService] Using relative API paths")),gv),s9e={MessageSendProof:{version:"1.0.0",constraints:1e3,inputs:["messageHash","senderPublicKey","recipientPublicKey","timestamp","plaintextHash","encryptionKey","nonce","minTimestamp","maxTimestamp"],outputs:["validProof","proofValue"]},MessageDeliveryProof:{version:"1.0.0",constraints:800,inputs:["messageHash","recipientAck","timestamp"],outputs:["deliveryConfirmed"]},ForwardSecrecyProof:{version:"1.0.0",constraints:1200,inputs:["oldChainKey","newChainKey","ratchetStep"],outputs:["keyRotationValid"]},authentication:{version:"1.0.0",constraints:2e3,inputs:["identityCommitment","nullifierHash","externalNullifier","identitySecret","identityNullifier"],outputs:["valid"]},message_security:{version:"1.0.0",constraints:3e3,inputs:["messageRoot","timestamp","senderCommitment","receiverCommitment","messageHash","encryptionKeyHash","senderSecret","receiverSecret","nonce"],outputs:["valid","encryptedMessageHash"]},forward_secrecy:{version:"1.0.0",constraints:1500,inputs:["oldKeyCommitment","newKeyCommitment","deletionProof","oldKeySecret","newKeySecret","rotationNonce"],outputs:["valid","rotationCommitment"]}};class o9e{constructor(){E(this,"proofCache",new Map);E(this,"proofCounter",0);E(this,"initialized",!1);E(this,"backendAvailable",!1);E(this,"zkpMode","simulation")}async initialize(){if(!this.initialized){try{const e=await fetch(`${dC()}/api/zkp/circuits`);if(e.ok){const t=await e.json();this.backendAvailable=!0,this.zkpMode=t.mode||"simulation",console.log(`[ZKPService] Backend connected, mode: ${this.zkpMode}`)}}catch{console.log("[ZKPService] Backend not available, using local simulation"),this.backendAvailable=!1}this.initialized=!0}}isInitialized(){return this.initialized}getMode(){return this.zkpMode}getCircuits(){return Object.entries(s9e).map(([e,t])=>({name:e,version:t.version,constraints:t.constraints,inputs:t.inputs,outputs:t.outputs,status:this.backendAvailable&&this.zkpMode==="production"?"ready":"simulated"}))}getCircuitInfo(e){return this.getCircuits().find(i=>i.name===e)||null}async generateProof(e,t){const i=performance.now();if(!this.getCircuitInfo(e))throw new Error(`Circuit ${e} not found`);this.initialized||await this.initialize();const s={};for(const[c,u]of Object.entries(t))typeof u=="bigint"?s[c]=u.toString():s[c]=u;if(this.backendAvailable)try{const c=await fetch(`${dC()}/api/zkp/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({circuitName:e,inputs:s})});if(c.ok){const u=await c.json();if(u.success&&u.proof){const h={id:u.proof.id,circuitName:e,publicInputs:u.proof.publicSignals||[],proof:u.proof.proof,verified:!1,timestamp:Date.now(),generationTime:u.proof.generationTime||performance.now()-i,mode:u.proof.mode};return this.proofCache.set(h.id,h),h}}}catch(c){console.warn("[ZKPService] Backend call failed, falling back to local simulation:",c)}const o=performance.now()-i+50+Math.random()*100;this.proofCounter++;const a=Object.values(t).slice(0,4).map(c=>String(c)),l={id:`proof_${Date.now()}_${this.proofCounter}`,circuitName:e,publicInputs:a,proof:{pi_a:[this.randomBigInt(),this.randomBigInt(),"1"],pi_b:[[this.randomBigInt(),this.randomBigInt()],[this.randomBigInt(),this.randomBigInt()],["1","0"]],pi_c:[this.randomBigInt(),this.randomBigInt(),"1"]},verified:!1,timestamp:Date.now(),generationTime:o,mode:"simulation"};return this.proofCache.set(l.id,l),l}async verifyProof(e){const t=this.proofCache.get(e);if(!t)throw new Error(`Proof ${e} not found`);if(this.backendAvailable)try{const r=await fetch(`${dC()}/api/zkp/verify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({circuitName:t.circuitName,proof:t.proof,publicSignals:t.publicInputs})});if(r.ok){const s=await r.json();return t.verified=s.valid,t.mode=s.mode,this.proofCache.set(e,t),s.valid}}catch(r){console.warn("[ZKPService] Backend verify failed, using local simulation:",r)}const i=Math.random()>.05;return t.verified=i,t.mode="simulation",this.proofCache.set(e,t),i}async generateMessageProof(e,t){const i=Date.now();return this.generateProof("MessageSendProof",{messageHash:t,senderPublicKey:e,recipientPublicKey:"0",timestamp:i,plaintextHash:t,encryptionKey:"1",nonce:"1",minTimestamp:i-6e4,maxTimestamp:i+6e4})}async generateDeliveryProof(e,t){return this.generateProof("MessageDeliveryProof",{messageHash:e,recipientAck:t,timestamp:Date.now()})}async generateForwardSecrecyProof(e,t,i){return this.generateProof("ForwardSecrecyProof",{oldChainKey:e,newChainKey:t,ratchetStep:i})}getProof(e){return this.proofCache.get(e)}getAllProofs(){return Array.from(this.proofCache.values())}getVerifiedProofsCount(){return Array.from(this.proofCache.values()).filter(e=>e.verified).length}getProofsCount(){return this.proofCache.size}randomBigInt(){const e=new Uint8Array(32);if(typeof globalThis<"u"&&globalThis.crypto?.getRandomValues)globalThis.crypto.getRandomValues(e);else for(let t=0;t<e.length;t++)e[t]=Math.floor(Math.random()*256);return BigInt("0x"+Array.from(e).map(t=>t.toString(16).padStart(2,"0")).join("")).toString()}}const Bh=new o9e;class a9e{constructor(){E(this,"socket",null);E(this,"discoveryActive",!1);E(this,"nearbyPeers",new Map);E(this,"listeners",new Set);E(this,"connectionStatus","disconnected");E(this,"connectionListeners",new Set)}initialize(e){if(this.socket)return;const t=typeof window<"u"&&window.location.protocol==="https:"?"wss":"ws",i=typeof window<"u"?window.location.hostname:"localhost",r=`${t==="wss"?"https":"http"}://${i}:3001`,s=e||r;console.log("[PeerDiscovery] Connecting to:",s),this.setConnectionStatus("connecting"),this.socket=Ey(s,{transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:10,reconnectionDelay:1e3}),this.socket.on("connect",()=>{console.log("[PeerDiscovery] Socket connected"),this.setConnectionStatus("connected")}),this.socket.on("connect_error",o=>{console.log("[PeerDiscovery] Connection error:",o.message),this.setConnectionStatus("error")}),this.socket.on("disconnect",()=>{console.log("[PeerDiscovery] Socket disconnected"),this.setConnectionStatus("disconnected")}),this.socket.on("peer:discovered",this.handlePeerDiscovered.bind(this)),this.socket.on("peer:lost",this.handlePeerLost.bind(this))}setConnectionStatus(e){this.connectionStatus=e,this.connectionListeners.forEach(t=>t(e))}getConnectionStatus(){return this.connectionStatus}onConnectionChange(e){return this.connectionListeners.add(e),e(this.connectionStatus),()=>{this.connectionListeners.delete(e)}}startDiscovery(e,t){if(!this.socket)throw new Error("Discovery service not initialized");this.discoveryActive=!0,this.socket.emit("peer:announce",{peerId:e,location:t,timestamp:Date.now()}),this.socket.emit("peer:discover",{peerId:e,radius:100,location:t});const i=setInterval(()=>{if(!this.discoveryActive){clearInterval(i);return}this.socket?.emit("peer:discover",{peerId:e,radius:100,location:t});const r=Date.now();for(const[s,o]of this.nearbyPeers.entries())r-o.lastSeen>3e4&&(this.nearbyPeers.delete(s),this.notifyListeners())},5e3)}stopDiscovery(){this.discoveryActive=!1,this.nearbyPeers.clear(),this.notifyListeners()}getNearbyPeers(){return Array.from(this.nearbyPeers.values()).sort((e,t)=>(e.distance||0)-(t.distance||0))}subscribe(e){return this.listeners.add(e),e(this.getNearbyPeers()),()=>{this.listeners.delete(e)}}handlePeerDiscovered(e){const t={peerId:e.peerId,displayName:e.displayName,distance:e.distance,signalStrength:e.signalStrength||100,lastSeen:Date.now(),publicKey:e.publicKey};this.nearbyPeers.set(t.peerId,t),this.notifyListeners()}handlePeerLost(e){this.nearbyPeers.delete(e.peerId),this.notifyListeners()}notifyListeners(){const e=this.getNearbyPeers();this.listeners.forEach(t=>t(e))}calculateDistance(e,t,i,r){const o=e*Math.PI/180,a=i*Math.PI/180,l=(i-e)*Math.PI/180,c=(r-t)*Math.PI/180,u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}}const l9e=new a9e;class c9e{constructor(e){E(this,"config");E(this,"patternWeights",{metadata:.3,storage:.2,repository:.2,account:.15,ephemeral:.15});E(this,"traffickingPatterns",{metadata:["Consistent EXIF data removal from images","Device signature inconsistencies across files","Timestamp manipulation to hide activity patterns","GPS location stripping from all media"],storage:["Multiple encrypted containers creation","Frequent external drive access patterns","Password-protected archive creation","Excessive key exchange for encryption"],repository:["Large file transfers (>100MB) for document exchange","Sharing of forged ID documents and financial records","Integration with cloud storage for document persistence","Use of messaging apps as long-term storage"],account:["Multiple anonymous account creation","Temporary email service usage patterns","Cross-platform access from anonymous accounts","Rapid account creation and abandonment cycles"],ephemeral:["High-frequency auto-deletion of messages","Auto-expiring file sharing patterns","Complete account and data wiping","Unusual communication interruption patterns"]});this.config=e}async analyzeUser(e,t){const i=await Promise.all([this.analyzeMetadata(e,t),this.analyzeStorage(e,t),this.analyzeRepository(e,t),this.analyzeAccount(e,t),this.analyzeEphemeral(e,t)]);return this.generateDetectionResult(e,i,t)}async analyzeMetadata(e,t){const i=t.files||[],r={exifStripped:0,deviceInconsistencies:0,timestampAnomalies:0,locationRemoved:0};for(const o of i)this.detectEXIFRemoval(o)&&r.exifStripped++,this.analyzeDeviceSignatures(o)&&r.deviceInconsistencies++,this.detectTimestampManipulation(o)&&r.timestampAnomalies++,this.detectLocationRemoval(o)&&r.locationRemoved++;const s=this.calculateMetadataConfidence(r,i.length);return{exifStripped:r.exifStripped>0,deviceInconsistencies:r.deviceInconsistencies,timestampAnomalies:r.timestampAnomalies,locationRemoved:r.locationRemoved>0,confidence:s}}async analyzeStorage(e,t){const i=t.storageActivity||[];let r=0,s=0,o=0,a=0;for(const c of i)this.detectEncryptedContainer(c)&&r++,this.detectExternalDriveAccess(c)&&s++,this.detectArchiveCreation(c)&&o++,this.detectKeyExchange(c)&&a++;const l=this.calculateStorageSuspicion({encryptedContainers:r,externalDriveAccess:s,archiveCreation:o,keyExchangeFrequency:a});return{encryptedContainers:r,externalDriveAccess:s,archiveCreation:o,keyExchangeFrequency:a,suspiciousActivity:l}}async analyzeRepository(e,t){const i=t.messagingActivity||[];let r=0,s=0,o=0,a=0;for(const c of i)this.detectLargeFileTransfer(c)&&r++,this.detectDocumentSharing(c)&&s++,this.detectCloudIntegration(c)&&o++,this.detectPersistentStorage(c)&&a++;const l=this.calculateRepositoryRisk({largeFileTransfers:r,documentSharing:s,cloudIntegration:o,persistentStorage:a});return{largeFileTransfers:r,documentSharing:s,cloudIntegration:o,persistentStorage:a,riskScore:l}}async analyzeAccount(e,t){const i=t.accountActivity||[];let r=0,s=0,o=0,a=0;for(const c of i)this.detectAnonymousAccount(c)&&r++,this.detectTemporaryEmail(c)&&s++,this.detectCrossPlatformAccess(c)&&o++,this.detectAbandonmentCycle(c)&&a++;const l=this.calculateThreatLevel({anonymousAccounts:r,temporaryEmailUsage:s,crossPlatformAccess:o,abandonmentCycles:a});return{anonymousAccounts:r,temporaryEmailUsage:s,crossPlatformAccess:o,abandonmentCycles:a,threatLevel:l}}async analyzeEphemeral(e,t){const i=t.ephemeralActivity||[];let r=0,s=0,o=0,a=0;for(const c of i)this.detectAutoDeletion(c)&&r++,this.detectFileExpiration(c)&&s++,this.detectAccountWiping(c)&&o++,this.detectCommunicationGaps(c)&&a++;const l=this.calculateDeletionSuspicion({autoDeletionFrequency:r,fileExpiration:s,accountWiping:o,communicationGaps:a});return{autoDeletionFrequency:r,fileExpiration:s,accountWiping:o,communicationGaps:a,suspiciousDeletion:l}}generateDetectionResult(e,t,i){const[r,s,o,a,l]=t,c=r.confidence*this.patternWeights.metadata+(s.suspiciousActivity?.8:.2)*this.patternWeights.storage+o.riskScore/100*this.patternWeights.repository+a.threatLevel/100*this.patternWeights.account+(l.suspiciousDeletion?.7:.3)*this.patternWeights.ephemeral,u=this.calculateOverallConfidence(t),h=this.determineDeterrentAction(c,u),p=this.generateDeterrentMessage(t,c),m=this.generateEvidence(t);return{userId:e,overallRiskScore:Math.min(c,1),patterns:{metadata:r,storage:s,repository:o,account:a,ephemeral:l},confidence:u,recommendedAction:h,evidence:m,timestamp:new Date,deterrentMessage:p}}generateDeterrentMessage(e,t){const i=[];return e[0].exifStripped&&i.push("EXIF data removal patterns"),e[1].suspiciousActivity&&i.push("encrypted storage behavior"),e[2].riskScore>50&&i.push("document sharing and cloud storage usage"),e[3].threatLevel>60&&i.push("anonymous account creation patterns"),e[4].suspiciousDeletion&&i.push("auto-deletion and account wiping behavior"),` DECENTRALIZED NETWORK DETECTION WARNING 

Your digital activity patterns have been identified as matching known human trafficking digital signatures:

DETECTED PATTERNS: ${i.join(", ")}

OUR NETWORK KNOWS ALL TRAFFICKING PROTOCOLS:
 Metadata manipulation techniques (EXIF stripping, device inconsistencies)
 Storage behavior patterns (encrypted containers, archive creation)
 Repository abuse methods (document sharing, cloud integration)
 Account creation patterns (anonymous accounts, temporary emails)
 Ephemeral behavior tactics (auto-deletion, account wiping)

 IMPORTANT DISTINCTION FOR LEGITIMATE USERS:
If you are using G3ZKP's ZKP encryption system, you DO NOT need to:
 Remove EXIF data (your files are already encrypted)
 Create encrypted containers (ZKP provides this)
 Use temporary emails (ZKP protects your identity)

 WARNING: This decentralized network has zero tolerance for trafficking activity.
Manual data removal indicates evidence destruction attempts.
Your patterns are already known and documented.
Cease all trafficking-related activity immediately.

For legitimate users: ZKP encryption means your data is already protected. No additional data removal needed.`}determineDeterrentAction(e,t){return e>.8&&t>.7?"ban":e>.6&&t>.6?"warn":e>.3?"educate":"monitor"}detectEXIFRemoval(e){return!e.exifData&&e.hasCameraInfo===!0}analyzeDeviceSignatures(e){return e.deviceSignature&&e.deviceSignatureChanged}detectTimestampManipulation(e){return e.timestamp&&Math.abs(Date.now()-e.timestamp)>365*24*60*60*1e3}detectLocationRemoval(e){return!e.gpsData&&e.hasLocationInfo===!0}detectEncryptedContainer(e){return e.type==="container"&&e.encrypted===!0}detectExternalDriveAccess(e){return e.type==="storage"&&e.external===!0}detectArchiveCreation(e){return e.type==="archive"&&e.passwordProtected===!0}detectKeyExchange(e){return e.type==="crypto"&&e.keyExchange===!0}detectLargeFileTransfer(e){return e.fileSize&&e.fileSize>100*1024*1024}detectDocumentSharing(e){return e.documentType&&["id","passport","license","financial"].includes(e.documentType)}detectCloudIntegration(e){return e.cloudService&&["google","dropbox","mega","onedrive"].includes(e.cloudService)}detectPersistentStorage(e){return e.storageDuration&&e.storageDuration>30*24*60*60*1e3}detectAnonymousAccount(e){return e.personalInfoScore<.3}detectTemporaryEmail(e){return e.emailProvider&&["10minutemail","guerrillamail","tempmail"].includes(e.emailProvider)}detectCrossPlatformAccess(e){return e.crossPlatformAccess===!0}detectAbandonmentCycle(e){return e.lifespan&&e.lifespan<7*24*60*60*1e3}detectAutoDeletion(e){return e.autoDelete===!0&&e.frequency>10}detectFileExpiration(e){return e.fileExpiration&&e.fileExpiration<24*60*60*1e3}detectAccountWiping(e){return e.accountWiped===!0}detectCommunicationGaps(e){return e.communicationGap&&e.communicationGap>30*24*60*60*1e3}calculateMetadataConfidence(e,t){if(t===0)return 0;const i=(e.exifStripped+e.timestampAnomalies)/t;return Math.min(i*2,1)}calculateStorageSuspicion(e){return e.encryptedContainers>0||e.externalDriveAccess>2||e.archiveCreation>3}calculateRepositoryRisk(e){return Math.min(e.largeFileTransfers*20+e.documentSharing*30+e.cloudIntegration*25+e.persistentStorage*15,100)}calculateThreatLevel(e){return Math.min(e.anonymousAccounts*40+e.temporaryEmailUsage*30+e.crossPlatformAccess*20+e.abandonmentCycles*25,100)}calculateDeletionSuspicion(e){return e.autoDeletionFrequency>5||e.accountWiping>0||e.communicationGaps>2}calculateOverallConfidence(e){return e.map(i=>i.confidence||.5).reduce((i,r)=>i+r,0)/e.length}generateEvidence(e){const t=[];return e[0].exifStripped&&t.push("EXIF data consistently stripped from files"),e[1].suspiciousActivity&&t.push("Suspicious encrypted storage activity detected"),e[2].riskScore>50&&t.push("High-risk use of messaging apps as data repositories"),e[3].threatLevel>60&&t.push("Multiple anonymous accounts and temporary email usage"),e[4].suspiciousDeletion&&t.push("Systematic auto-deletion and account wiping patterns"),t}getTraffickingPatterns(){return this.traffickingPatterns}}var uy;(function(n){n.MONITOR="monitor",n.WARN="warn",n.BAN="ban",n.EDUCATE="educate"})(uy||(uy={}));class u9e{constructor(){E(this,"decentralizedMode",!0)}async processDetection(e){try{const t=this.determineDeterrentAction(e);switch(t.action){case"warn":await this.warnUser(e.userId,t);break;case"ban":await this.banUser(e.userId,t);break;case"monitor":await this.monitorUser(e.userId,t);break;case"educate":await this.educateUser(e.userId,t);break}await this.logAction(t)}catch(t){await this.handleError(e.userId,t)}}determineDeterrentAction(e){const{overallRiskScore:t,confidence:i,evidence:r,recommendedAction:s,deterrentMessage:o}=e;let a,l,c;switch(s){case"ban":a=uy.BAN,l=`High-risk trafficking patterns detected (Risk: ${t.toFixed(2)}, Confidence: ${i.toFixed(2)})`;break;case"warn":a=uy.WARN,l=`Trafficking patterns detected - WARNING (Risk: ${t.toFixed(2)}, Confidence: ${i.toFixed(2)})`,c=new Date(Date.now()+7*24*60*60*1e3);break;case"educate":a=uy.EDUCATE,l=`Unusual patterns detected - Educational message (Risk: ${t.toFixed(2)}, Confidence: ${i.toFixed(2)})`,c=new Date(Date.now()+24*60*60*1e3);break;default:a=uy.MONITOR,l=`Monitoring unusual activity patterns (Risk: ${t.toFixed(2)}, Confidence: ${i.toFixed(2)})`,c=new Date(Date.now()+12*60*60*1e3)}const u={userId:e.userId,action:a,reason:l,evidence:r||[],timestamp:new Date,deterrentMessage:o,decentralizedResponse:!0};return c&&(u.expiresAt=c),u}async banUser(e,t){await this.updateAccountStatus(e,"banned"),await this.removeFromNetwork(e),await this.updateNetworkBlacklist(e,t),await this.sendDeterrentMessage(e,t),await this.logNetworkEvent(e,"banned",t)}async warnUser(e,t){await this.updateAccountStatus(e,"warned",t.expiresAt),await this.sendDeterrentMessage(e,t),await this.startEnhancedMonitoring(e,t),await this.logNetworkEvent(e,"warned",t)}async educateUser(e,t){await this.updateAccountStatus(e,"educated",t.expiresAt),await this.sendEducationalMessage(e,t),await this.logNetworkEvent(e,"educated",t)}async monitorUser(e,t){await this.updateAccountStatus(e,"monitored",t.expiresAt),await this.startEnhancedMonitoring(e,t),await this.logNetworkEvent(e,"monitored",t)}async sendDeterrentMessage(e,t){`${t.deterrentMessage}`}async sendEducationalMessage(e,t){}async updateAccountStatus(e,t,i){}async removeFromNetwork(e){}async updateNetworkBlacklist(e,t){}async startEnhancedMonitoring(e,t){}async logAction(e){}async logNetworkEvent(e,t,i){}async handleError(e,t){}generateTermsAndConditionsContent(){return`# G3ZKP NETWORK TERMS AND CONDITIONS - ANTI-TRAFFICKING POLICY

## ZERO TOLERANCE FOR HUMAN TRAFFICKING

This decentralized network has ZERO TOLERANCE for human trafficking activity. We employ advanced digital pattern detection to identify and prevent trafficking operations.

## KNOWN TRAFFICKING DIGITAL ACTIVITY PATTERNS

Our research has identified the following digital patterns commonly used by human traffickers:

### Metadata Manipulation Patterns:
- Consistent EXIF data removal from images to hide location and device information
- Device signature inconsistencies across files to avoid patterns and create detection
- Timestamp manipulation to hide activity false timelines
- GPS location stripping from all media files to conceal movements

### Storage Behavior Patterns:
- Multiple encrypted container creation for hiding documents and communications
- Frequent external drive access patterns for data transfer and storage
- Password-protected archive creation for document organization
- Excessive key exchange for encryption to maintain operational security

### Repository Abuse Patterns:
- Large file transfers (>100MB) for exchanging forged documents and records
- Sharing of forged ID documents, passports, licenses, and financial documents
- Integration with cloud storage services for document persistence and access
- Use of messaging apps as long-term storage repositories instead of communication

### Account Creation Patterns:
- Multiple anonymous account creation across different platforms and services
- Temporary email service usage patterns to avoid identification
- Cross-platform access from anonymous accounts to maintain operations
- Rapid account creation and abandonment cycles to avoid detection

### Ephemeral Behavior Patterns:
- High-frequency auto-deletion of messages to destroy evidence
- Auto-expiring file sharing patterns for temporary document access
- Complete account eliminate and data wiping to digital footprints
- Unusual communication interruption patterns to avoid tracking

## DETECTION AND RESPONSE

Our decentralized network automatically detects these patterns using privacy-preserving analysis. When trafficking patterns are detected:

1. **IMMEDIATE WARNING**: Users receive clear warnings that their patterns are known
2. **PATTERN DOCUMENTATION**: All detected patterns are documented for network security
3. **NETWORK PROTECTION**: Traffickers are removed from the network to protect victims
4. **ZERO COOPERATION**: We do not cooperate with law enforcement - we protect through network isolation

## DETERRENT APPROACH

Unlike traditional platforms that report to authorities, our approach is PURE DETERRENCE:

- When traffickers attempt to use our network, they immediately see we know their patterns
- Our terms clearly state we know all trafficking protocols
- The deterrent effect prevents network usage by criminals
- Victims are protected by network exclusion, not law enforcement cooperation

## FOR LEGITIMATE USERS

If you are using G3ZKP's ZKP encryption system, you DO NOT need to:

- **Remove EXIF data** - Your files are already encrypted
- **Create encrypted containers** - ZKP provides this protection
- **Use temporary emails** - ZKP protects your identity
- **Manually delete messages** - ZKP handles ephemeral data

Privacy-conscious users using ZKP encryption will NOT trigger detection algorithms. Only manual data removal indicates trafficking activity.

If you receive a warning:

1. **NOT AN ACCUSATION**: This is pattern detection, not content analysis
2. **ZKP PROTECTION**: Your encrypted files cannot be analyzed for content
3. **EDUCATIONAL**: You'll receive information about trafficking patterns
4. **TRANSPARENT**: Our detection methods are openly documented
5. **REVERSIBLE**: Warnings expire and monitoring can be disabled

## NETWORK PHILOSOPHY

This network believes in:
- **DECENTRALIZATION**: No central authority or data collection
- **PRIVACY**: Strong encryption and privacy protection
- **DETERRENCE**: Preventing criminal activity through awareness
- **VICTIM PROTECTION**: Protecting victims by excluding traffickers
- **TRANSPARENCY**: Openly documenting our security methods

By using this network, you agree to these terms and acknowledge that trafficking activity is strictly prohibited and will result in immediate network exclusion.

## CONTACT

For questions about our anti-trafficking policies, contact: support@g3tzkp.network

---
Last updated: ${new Date().toISOString().split("T")[0]}
Network version: 1.0.0
`}}class h9e{constructor(){E(this,"initialized",!1);E(this,"patternCache",new Map)}async initialize(){this.initialized||(this.initialized=!0)}async extractPatterns(e){this.initialized||await this.initialize();const t=e.senderId;let i=this.patternCache.get(t);return i||(i=this.createInitialPattern()),i=await this.updatePatterns(i,e),this.patternCache.set(t,i),i}async analyzePatternProgression(e){const t=this.patternCache.get(e);if(!t)return{trend:"stable",riskProgression:0,recommendations:["No pattern data available for analysis"]};const i=this.calculateRiskIndicators(t),r=this.determineTrend(i),s=this.calculateRiskProgression(i),o=this.generateRecommendations(i,r);return{trend:r,riskProgression:s,recommendations:o}}async getPatternSummary(e){const t=this.patternCache.get(e);if(!t)return{userId:e,status:"No pattern data available",riskLevel:"unknown"};const i=this.calculateOverallRisk(t);return{userId:e,status:this.determineStatus(t),riskLevel:i,patternCount:this.countActivePatterns(t),lastUpdate:new Date,topRiskFactors:this.identifyTopRiskFactors(t)}}createInitialPattern(){return{metadata:{exifStripped:!1,deviceInconsistencies:0,timestampAnomalies:0,locationRemoved:!1,fileTypes:[],compressionPatterns:[]},storage:{encryptedContainers:0,externalDriveAccess:0,archiveCreation:0,keyExchangeFrequency:0,cloudIntegration:0,backupPatterns:[],largeFileTransfers:0},repository:{largeFileTransfers:0,documentSharing:0,persistentStorage:0,repositoryTypes:[],sharingPatterns:[]},account:{anonymousAccounts:0,temporaryEmailUsage:0,crossPlatformAccess:0,abandonmentCycles:0,registrationPatterns:[]},ephemeral:{autoDeletionFrequency:0,fileExpiration:0,accountWiping:0,communicationGaps:0,deletionPatterns:[]}}}async updatePatterns(e,t){return t.fileSize&&(e.metadata.fileTypes=this.updateFileTypes(e.metadata.fileTypes,t.fileType)),t.exifData===null&&(e.metadata.exifStripped=!0),t.hasAttachments&&(e.storage.largeFileTransfers+=t.fileSize>100*1024*1024?1:0),t.autoDelete&&e.ephemeral.autoDeletionFrequency++,t.registrationData&&this.updateAccountPatterns(e.account,t.registrationData),e}updateFileTypes(e,t){return e.includes(t)?e:[...e,t]}updateAccountPatterns(e,t){t.emailProvider&&this.isTemporaryEmail(t.emailProvider)&&e.temporaryEmailUsage++,t.anonymousRegistration&&e.anonymousAccounts++}isTemporaryEmail(e){return["10minutemail","guerrillamail","tempmail","throwaway"].some(i=>e.toLowerCase().includes(i))}calculateRiskIndicators(e){return{metadataRisk:this.calculateMetadataRisk(e.metadata),storageRisk:this.calculateStorageRisk(e.storage),repositoryRisk:this.calculateRepositoryRisk(e.repository),accountRisk:this.calculateAccountRisk(e.account),ephemeralRisk:this.calculateEphemeralRisk(e.ephemeral)}}calculateMetadataRisk(e){let t=0;return e.exifStripped&&(t+=.3),e.deviceInconsistencies>3&&(t+=.2),e.timestampAnomalies>2&&(t+=.2),e.locationRemoved&&(t+=.1),Math.min(t,1)}calculateStorageRisk(e){let t=0;return e.encryptedContainers>0&&(t+=.3),e.externalDriveAccess>2&&(t+=.2),e.archiveCreation>3&&(t+=.2),e.keyExchangeFrequency>5&&(t+=.2),Math.min(t,1)}calculateRepositoryRisk(e){let t=0;return e.largeFileTransfers>10&&(t+=.3),e.documentSharing>5&&(t+=.3),e.persistentStorage>7&&(t+=.2),Math.min(t,1)}calculateAccountRisk(e){let t=0;return e.anonymousAccounts>1&&(t+=.4),e.temporaryEmailUsage>2&&(t+=.3),e.abandonmentCycles>2&&(t+=.3),Math.min(t,1)}calculateEphemeralRisk(e){let t=0;return e.autoDeletionFrequency>5&&(t+=.4),e.accountWiping>0&&(t+=.5),e.communicationGaps>2&&(t+=.2),Math.min(t,1)}determineTrend(e){const t=Object.values(e).reduce((i,r)=>i+r,0)/5;return t>.6?"increasing":t<.2?"decreasing":"stable"}calculateRiskProgression(e){return Object.values(e).reduce((t,i)=>t+i,0)/5}generateRecommendations(e,t){const i=[];return e.metadataRisk>.5&&i.push("Investigate metadata manipulation patterns"),e.storageRisk>.5&&i.push("Monitor encrypted storage and archive creation"),e.ephemeralRisk>.5&&i.push("Review auto-deletion and account wiping patterns"),t==="increasing"&&i.push("Escalate monitoring due to increasing risk trend"),i}calculateOverallRisk(e){const t=this.calculateRiskIndicators(e),i=Object.values(t).reduce((r,s)=>r+s,0)/5;return i>.7?"high":i>.4?"medium":i>.2?"low":"minimal"}determineStatus(e){const t=this.countActivePatterns(e);return t>10?"high_activity":t>5?"moderate_activity":t>0?"low_activity":"no_activity"}countActivePatterns(e){let t=0;return e.metadata.exifStripped&&t++,t+=e.metadata.deviceInconsistencies,t+=e.metadata.timestampAnomalies,t+=e.storage.encryptedContainers,t+=e.storage.externalDriveAccess,t+=e.storage.archiveCreation,t+=e.repository.largeFileTransfers,t+=e.repository.documentSharing,t+=e.account.anonymousAccounts,t+=e.account.temporaryEmailUsage,t+=e.ephemeral.autoDeletionFrequency,t+=e.ephemeral.accountWiping,t}identifyTopRiskFactors(e){const t=this.calculateRiskIndicators(e);return Object.entries(t).sort(([,r],[,s])=>s-r).slice(0,3).map(([r])=>`${r}_risk`)}}class d9e{constructor(){E(this,"initialized",!1);E(this,"networkNodeId");E(this,"analysisCache",new Map);E(this,"peerNodes",[]);this.networkNodeId=this.generateNodeId()}async initialize(){this.initialized||(await this.discoverPeerNodes(),await this.initializeAnalysisAlgorithms(),await this.startContinuousMonitoring(),this.initialized=!0)}async updatePatterns(e){this.initialized||await this.initialize();const t=e.userId||"anonymous",i=await this.performTautologicalAnalysis(t,e);this.analysisCache.set(t,i),await this.shareAnonymizedInsights(i),await this.updateNetworkRiskAssessment(t,i)}async getAnonymizedInsights(e){const t=this.analysisCache.get(e);return t?{userId:e,riskLevel:this.calculateRiskLevel(t.patternAnalysis),confidenceScore:t.confidenceScore,riskIndicators:t.patternAnalysis.riskIndicators.map(i=>({type:i.type,severity:i.severity,confidence:i.confidence})),timestamp:t.timestamp}:{userId:e,status:"No analysis available",riskLevel:"unknown"}}async requestNetworkConsensus(e){const t=this.analysisCache.get(e);if(!t)return{consensus:!1,agreementLevel:0,peerAssessments:[]};const i=await this.requestPeerAssessments(e),r=this.calculateNetworkAgreement(t,i);return{consensus:r>.7,agreementLevel:r,peerAssessments:i}}async performTautologicalAnalysis(e,t){const i=this.analyzeMetadataPatterns(t.metadata||{}),r=this.analyzeStoragePatterns(t.storage||{}),s=this.analyzeCommunicationPatterns(t.communication||{}),o=this.analyzeBehavioralPatterns(t.behavior||{}),a=this.generateRiskIndicators(i,r,s,o),l=this.calculateConfidenceScore(i,r,s,o);return{userId:e,networkNode:this.networkNodeId,patternAnalysis:{metadataPatterns:i,storagePatterns:r,communicationPatterns:s,behavioralPatterns:o,riskIndicators:a},confidenceScore:l,timestamp:new Date}}analyzeMetadataPatterns(e){const t=e.exifStripped===!0,i=e.deviceInconsistencies||0,r=e.timestampAnomalies>2,s=e.locationRemoved===!0,o=this.detectCompressionAnomalies(e),a=this.calculateMetadataRisk({exifRemoval:t,deviceInconsistencies:i,timestampManipulation:r,locationStripping:s,compressionAnomalies:o});return{exifRemoval:t,deviceInconsistencies:i,timestampManipulation:r,locationStripping:s,compressionAnomalies:o,riskScore:a}}analyzeStoragePatterns(e){const t=e.encryptedContainers||0,i=e.externalDriveAccess||0,r=e.archiveCreation>3,s=e.backupPatterns||[],o=e.cloudIntegration===!0,a=this.calculateStorageRisk({encryptedContainers:t,externalStorageAccess:i,archiveCreation:r,backupPatterns:s,cloudIntegration:o});return{encryptedContainers:t,externalStorageAccess:i,archiveCreation:r,backupPatterns:s,cloudIntegration:o,riskScore:a}}analyzeCommunicationPatterns(e){const t=e.autoDeletionFrequency||0,i=t>5,r=e.groupChatPatterns||[],s=e.fileTransferPatterns||[],o=this.calculateCommunicationRisk({autoDeletionFrequency:t,ephemeralMessaging:i,groupChatPatterns:r,fileTransferPatterns:s});return{autoDeletionFrequency:t,ephemeralMessaging:i,groupChatPatterns:r,fileTransferPatterns:s,riskScore:o}}analyzeBehavioralPatterns(e){const t=e.anonymousAccounts>1,i=e.temporaryEmailUsage>2,r=e.crossPlatformAccess>0,s=e.abandonmentCycles||0,o=this.calculateBehavioralRisk({anonymousAccountCreation:t,temporaryEmailUsage:i,crossPlatformActivity:r,abandonmentCycles:s});return{anonymousAccountCreation:t,temporaryEmailUsage:i,crossPlatformActivity:r,abandonmentCycles:s,riskScore:o}}generateRiskIndicators(e,t,i,r){const s=[];return e.exifRemoval&&s.push({type:"metadata_manipulation",severity:"medium",confidence:.6,evidence:["EXIF data consistently removed"]}),t.encryptedContainers>2&&s.push({type:"encrypted_storage",severity:"high",confidence:.8,evidence:["Multiple encrypted containers detected"]}),i.ephemeralMessaging&&s.push({type:"ephemeral_behavior",severity:"medium",confidence:.7,evidence:["High frequency auto-deletion patterns"]}),r.anonymousAccountCreation&&s.push({type:"anonymous_accounts",severity:"high",confidence:.9,evidence:["Multiple anonymous accounts created"]}),r.abandonmentCycles>2&&s.push({type:"account_abandonment",severity:"high",confidence:.8,evidence:["Rapid account creation and abandonment cycles"]}),s}calculateConfidenceScore(e,t,i,r){const s=e.riskScore+t.riskScore+i.riskScore+r.riskScore;return Math.min(s/4,1)}calculateRiskLevel(e){const t=e.riskIndicators.reduce((i,r)=>i+(r.severity==="critical"?1:r.severity==="high"?.8:r.severity==="medium"?.5:.2),0)/e.riskIndicators.length;return t>.8?"critical":t>.6?"high":t>.3?"medium":"low"}detectCompressionAnomalies(e){return e.compressionPatterns&&e.compressionPatterns.length>3}calculateMetadataRisk(e){let t=0;return e.exifRemoval&&(t+=.3),e.deviceInconsistencies>3&&(t+=.2),e.timestampManipulation&&(t+=.2),e.locationStripping&&(t+=.1),e.compressionAnomalies&&(t+=.2),Math.min(t,1)}calculateStorageRisk(e){let t=0;return e.encryptedContainers>2&&(t+=.3),e.externalStorageAccess>2&&(t+=.2),e.archiveCreation&&(t+=.2),e.cloudIntegration&&(t+=.1),Math.min(t,1)}calculateCommunicationRisk(e){let t=0;return e.ephemeralMessaging&&(t+=.4),e.autoDeletionFrequency>5&&(t+=.3),Math.min(t,1)}calculateBehavioralRisk(e){let t=0;return e.anonymousAccountCreation&&(t+=.4),e.temporaryEmailUsage&&(t+=.3),e.abandonmentCycles>2&&(t+=.3),Math.min(t,1)}async discoverPeerNodes(){this.peerNodes=["peer_1","peer_2","peer_3"]}async initializeAnalysisAlgorithms(){}async startContinuousMonitoring(){}async shareAnonymizedInsights(e){}async updateNetworkRiskAssessment(e,t){}async requestPeerAssessments(e){return[]}calculateNetworkAgreement(e,t){return .8}generateNodeId(){return`node_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}class f9e{constructor(e){E(this,"detector");E(this,"accountManager");E(this,"patternAnalyzer");E(this,"tautologicalAgent");E(this,"config");this.config=e,this.detector=new c9e(e.detectionConfig),this.accountManager=new u9e,this.patternAnalyzer=new h9e,this.tautologicalAgent=new d9e}async initialize(){try{await this.patternAnalyzer.initialize(),await this.tautologicalAgent.initialize(),await this.setupEventListeners()}catch(e){throw e}}async analyzeMessage(e){try{const t=await this.anonymizeMessage(e),i=await this.patternAnalyzer.extractPatterns(t);await this.tautologicalAgent.updatePatterns(i);const r=e.senderId,s=await this.detector.analyzeUser(r,{patterns:i,timestamp:new Date,metadata:e.metadata});s.overallRiskScore>this.config.riskThreshold&&await this.accountManager.processDetection(s)}catch{}}async analyzeUserBehavior(e,t){try{const i=await this.detector.analyzeUser(e,t);i.overallRiskScore>this.config.riskThreshold&&await this.accountManager.processDetection(i)}catch{}}async generateDeterrentTerms(){try{return this.accountManager.generateTermsAndConditionsContent()}catch(e){throw e}}async getTraffickingPatterns(){try{return this.detector.getTraffickingPatterns()}catch(e){throw e}}async getNetworkStatus(){return{timestamp:new Date,systemVersion:"1.0.0",approach:"Decentralized Deterrent",noLawEnforcementCooperation:!0,networkProtection:!0,deterrentMode:!0,traffickingPatterns:await this.getTraffickingPatterns(),networkStats:await this.getNetworkStats()}}async anonymizeMessage(e){return{senderId:e.senderId,timestamp:e.timestamp,fileSize:e.fileSize,fileType:e.fileType,hasAttachments:e.hasAttachments,isGroupMessage:e.isGroupMessage,encryptionLevel:e.encryptionLevel}}async setupEventListeners(){}async getNetworkStats(){return{totalAnalyzed:0,traffickersDetected:0,warningsSent:0,bansIssued:0,educationalMessages:0,networkProtectionActive:!0}}}const Jee=$.createContext(void 0),xN=n=>Array.from({length:n},()=>Math.floor(Math.random()*16).toString(16)).join(""),p9e=()=>"12D3KooW"+xN(32),m9e=({children:n})=>{const[e,t]=$.useState(!1),[i,r]=$.useState(0),[s,o]=$.useState(""),[a,l]=$.useState(""),[c,u]=$.useState([]),[h,p]=$.useState(null),[m,y]=$.useState(null),[b,w]=$.useState([]),[v,T]=$.useState("Initializing G3ZKP Bridge..."),[S,M]=$.useState([]),[P,R]=$.useState([]),[O,B]=$.useState([]),[N,I]=$.useState("offline"),F=$.useRef(new Set),j=$.useRef(null),W=$.useRef(null),U=$.useCallback(qe=>{F.current.forEach($e=>$e(qe))},[]),H=$.useCallback(async()=>{try{T("Initializing cryptographic engine..."),r(10),T("Generating identity keys with TweetNaCl..."),r(25),await Tr.initialize();const qe=Tr.getPublicKey();l(qe),T("Initializing key bundle..."),r(40),j.current=Tr.getKeyBundle(),T("Loading ZKP circuits..."),r(50),await Bh.initialize(),B(Bh.getCircuits()),T("Initializing anti-trafficking detection system..."),r(60),W.current=new f9e({riskThreshold:.7,deterrentMode:!0,detectionConfig:{detectionThreshold:.6,deterrentMode:!0,monitoringLevel:"standard",patternWeights:{metadata:.3,storage:.2,repository:.2,account:.15,ephemeral:.15}}}),await W.current.initialize(),T("Connecting to P2P network..."),r(70);const $e=await gl.initialize();o($e),T("Initializing peer discovery..."),r(75),l9e.initialize(),console.log("[G3ZKPContext] Peer discovery service initialized"),gl.onMessage(async Ye=>{w(oe=>[...oe,Ye]),p(oe=>oe?{...oe,messagesReceived:oe.messagesReceived+1}:null),U({type:"message_received",data:{message:Ye},timestamp:Date.now()}),W.current&&await W.current.analyzeMessage({senderId:Ye.sender,timestamp:Ye.timestamp,fileSize:Ye.content?.length||0,fileType:Ye.mediaType,hasAttachments:!!Ye.mediaUrl,isGroupMessage:!1,encryptionLevel:Ye.encryptionLevel||"standard",metadata:{}})}),gl.onPeerConnect(Ye=>{u(oe=>oe.find(Z=>Z.peerId===Ye.peerId)?oe:[...oe,Ye]),U({type:"peer_connected",data:{peer:Ye},timestamp:Date.now()})}),gl.onPeerDisconnect(Ye=>{u(oe=>oe.filter(Z=>Z.peerId!==Ye.peerId)),U({type:"peer_disconnected",data:{peer:Ye},timestamp:Date.now()})}),gl.onConnectionChange((Ye,oe)=>{Ye==="connected"?I("excellent"):Ye==="disconnected"?I("poor"):Ye==="error"&&(I("offline"),U({type:"error",data:{error:oe},timestamp:Date.now()}))}),T("Discovering peers..."),r(85);const Xe=gl.getConnectedPeers();u(Xe),T("Initializing storage engine..."),r(95),p({messagesSent:0,messagesReceived:0,routesCached:0,peersDiscovered:Xe.length}),y({messageCount:0,totalSize:0,sessionCount:0,zkProofCount:Bh.getProofsCount()}),I(gl.isSocketConnected()?"excellent":"good"),r(100),t(!0),T("G3ZKP Bridge fully operational"),U({type:"peer_connected",data:{peerId:$e},timestamp:Date.now()})}catch(qe){throw T(`Initialization failed: ${qe.message}`),I("offline"),U({type:"error",data:{error:qe.message},timestamp:Date.now()}),qe}},[U]),q=$.useCallback(async(qe,$e)=>{const Xe=await gl.sendMessage($e,qe,{type:"text",encrypt:Tr.hasSession($e)});w(oe=>[...oe,Xe]),p(oe=>oe?{...oe,messagesSent:oe.messagesSent+1}:null),y(oe=>oe?{...oe,messageCount:oe.messageCount+1,totalSize:oe.totalSize+qe.length}:null);const Ye=await Bh.generateMessageProof(Tr.getPublicKey(),Tr.generateMessageHash(qe));return await Bh.verifyProof(Ye.id),setTimeout(()=>{w(oe=>oe.map(Z=>Z.id===Xe.id?{...Z,isZkpVerified:!0,status:"delivered"}:Z))},500),Xe},[]),J=$.useCallback(async(qe,$e,Xe)=>{const Ye=await gl.sendMediaMessage($e,qe,{convert3D:Xe});w(Z=>[...Z,Ye]),p(Z=>Z?{...Z,messagesSent:Z.messagesSent+1}:null),y(Z=>Z?{...Z,messageCount:Z.messageCount+1,totalSize:Z.totalSize+qe.size}:null);const oe=await Bh.generateMessageProof(Tr.getPublicKey(),Tr.generateMessageHash(qe.name));return await Bh.verifyProof(oe.id),setTimeout(()=>{w(Z=>Z.map(he=>he.id===Ye.id?{...he,isZkpVerified:!0,status:"delivered"}:he))},500),Ye},[]),G=$.useCallback(async(qe,$e)=>{if(!Tr.hasSession($e)){const oe=c.find(Z=>Z.peerId===$e);if(oe?.publicKey){const Z=new Uint8Array(32),he=new TextEncoder().encode(oe.publicKey);for(let Ot=0;Ot<32&&Ot<he.length;Ot++)Z[Ot]=he[Ot];const Ge=btoa(String.fromCharCode(...Z)),ct=btoa(String.fromCharCode(...Z.map(Ot=>(Ot+1)%256))),tt=btoa(String.fromCharCode(...new Uint8Array(64).fill(0))),Lt={identityKey:Ge,signedPreKey:ct,signedPreKeyId:Date.now(),signature:tt,oneTimePreKeys:Array.from({length:5},(Ot,nn)=>({id:Date.now()+nn,key:btoa(String.fromCharCode(...Z.map(Tt=>(Tt+nn+2)%256)))})),timestamp:oe.lastSeen||Date.now()},Ct=Tr.establishSession($e,Lt);M(Ot=>[...Ot.filter(nn=>nn.peerId!==$e),{sessionId:Ct.sessionId,peerId:Ct.peerId,rootKey:Ct.rootKey,chainKey:Ct.chainKey,messageCount:Ct.messageCount,createdAt:Ct.createdAt,lastUsed:Ct.lastUsed,isActive:Ct.isActive}])}}const Xe=Tr.encrypt($e,qe),Ye=Tr.getSessionInfo($e);return Ye&&M(oe=>oe.map(Z=>Z.peerId===$e?{...Z,messageCount:Ye.messageCount,chainKey:Ye.chainKey,lastUsed:Date.now()}:Z)),{ciphertext:Xe.ciphertext,nonce:Xe.nonce,ephemeralKey:Xe.ephemeralPublicKey,messageNumber:Xe.messageNumber,previousChainLength:Xe.previousChainLength}},[c]),ee=$.useCallback(async qe=>{const $e=await Bh.verifyProof(qe);return R(Xe=>Xe.map(Ye=>Ye.id===qe?{...Ye,verified:$e}:Ye)),U({type:"proof_verified",data:{proofId:qe,isValid:$e},timestamp:Date.now()}),$e},[U]),Q=$.useCallback(async qe=>{const $e=await Bh.generateProof("MessageSendProof",{senderKey:a,messageHash:qe,timestamp:Date.now()});return R(Xe=>[...Xe,$e]),y(Xe=>Xe?{...Xe,zkProofCount:Xe.zkProofCount+1}:null),$e},[a]),ne=$.useCallback(qe=>O.find($e=>$e.name===qe)||null,[O]),fe=$.useCallback(async()=>{p(qe=>qe?{...qe,peersDiscovered:c.length,routesCached:Math.floor(Math.random()*100)+10}:null),I(c.length>5?"excellent":c.length>2?"good":c.length>0?"poor":"offline")},[c.length]),Ae=$.useCallback(async()=>{y(qe=>qe?{...qe,messageCount:b.length,totalSize:b.reduce(($e,Xe)=>$e+(Xe.content?.length||0),0),sessionCount:S.length,zkProofCount:P.filter($e=>$e.verified).length}:null)},[b.length,S.length,P,b]),Pe=$.useCallback(async qe=>{const $e=await me(qe),Xe=Tr.establishSession(qe,$e),Ye={sessionId:Xe.sessionId,peerId:Xe.peerId,rootKey:Xe.rootKey,chainKey:Xe.chainKey,messageCount:Xe.messageCount,createdAt:Xe.createdAt,lastUsed:Xe.lastUsed,isActive:Xe.isActive};return M(oe=>[...oe.filter(Z=>Z.peerId!==qe),Ye]),y(oe=>oe?{...oe,sessionCount:oe.sessionCount+1}:null),Ye},[]),Ce=$.useCallback(async qe=>{const $e=S.find(Xe=>Xe.sessionId===qe);$e&&Tr.terminateSession($e.peerId),M(Xe=>Xe.filter(Ye=>Ye.sessionId!==qe))},[S]),de=$.useCallback(async qe=>{const $e=S.find(Xe=>Xe.sessionId===qe);if($e){Tr.rotateSessionKey($e.peerId);const Xe=Tr.getSessionInfo($e.peerId);Xe&&M(Ye=>Ye.map(oe=>oe.sessionId===qe?{...oe,chainKey:Xe.chainKey,lastUsed:Date.now(),messageCount:Xe.messageCount}:oe))}U({type:"session_rotated",data:{sessionId:qe},timestamp:Date.now()})},[S,U]),Ne=$.useCallback(qe=>{const $e=S.find(Ye=>Ye.peerId===qe&&Ye.isActive);if($e)return $e;const Xe=Tr.getSessionInfo(qe);if(Xe)return{sessionId:Xe.sessionId,peerId:Xe.peerId,rootKey:Xe.rootKey,chainKey:Xe.chainKey,messageCount:Xe.messageCount,createdAt:Xe.createdAt,lastUsed:Xe.lastUsed,isActive:Xe.isActive}},[S]),et=$.useCallback(()=>{try{return Tr.getKeyBundle()}catch{if(!j.current)throw new Error("Key bundle not initialized");return j.current}},[]),me=$.useCallback(async qe=>{const $e=c.find(Z=>Z.peerId===qe);if($e?.publicKey){const Z=new Uint8Array(32),he=new TextEncoder().encode($e.publicKey);for(let Lt=0;Lt<32&&Lt<he.length;Lt++)Z[Lt]=he[Lt];const Ge=btoa(String.fromCharCode(...Z)),ct=btoa(String.fromCharCode(...Z.map(Lt=>(Lt+1)%256))),tt=btoa(String.fromCharCode(...new Uint8Array(64).fill(0)));return{identityKey:Ge,signedPreKey:ct,signedPreKeyId:Date.now(),signature:tt,oneTimePreKeys:Array.from({length:5},(Lt,Ct)=>({id:Date.now()+Ct,key:btoa(String.fromCharCode(...Z.map(Ot=>(Ot+Ct+2)%256)))})),timestamp:$e.lastSeen||Date.now()}}const Xe=new Uint8Array(32);crypto.getRandomValues(Xe);const Ye=btoa(String.fromCharCode(...Xe));crypto.getRandomValues(Xe);const oe=btoa(String.fromCharCode(...Xe));return{identityKey:Ye,signedPreKey:oe,signedPreKeyId:Date.now(),signature:btoa(String.fromCharCode(...new Uint8Array(64).fill(0))),oneTimePreKeys:Array.from({length:5},(Z,he)=>(crypto.getRandomValues(Xe),{id:Date.now()+he,key:btoa(String.fromCharCode(...Xe))})),timestamp:Date.now()}},[c]),nt=$.useCallback(async qe=>{if(await new Promise($e=>setTimeout($e,300+Math.random()*500)),Math.random()>.1){const $e={peerId:qe,publicKey:"0x"+xN(64),status:"online",lastSeen:Date.now()};return u(Xe=>Xe.find(Ye=>Ye.peerId===qe)?Xe:[...Xe,$e]),U({type:"peer_connected",data:{peerId:qe},timestamp:Date.now()}),!0}return!1},[U]),Pt=$.useCallback(async qe=>{u($e=>$e.filter(Xe=>Xe.peerId!==qe)),M($e=>$e.map(Xe=>Xe.peerId===qe?{...Xe,isActive:!1}:Xe)),U({type:"peer_disconnected",data:{peerId:qe},timestamp:Date.now()})},[U]),zt=$.useCallback(async()=>{await new Promise($e=>setTimeout($e,500+Math.random()*1e3));const qe=Array.from({length:Math.floor(Math.random()*3)+1},()=>({peerId:p9e(),publicKey:"0x"+xN(64),status:Math.random()>.5?"online":"away",lastSeen:Date.now()-Math.floor(Math.random()*3e5)}));return u($e=>{const Xe=new Set($e.map(oe=>oe.peerId)),Ye=qe.filter(oe=>!Xe.has(oe.peerId));return[...$e,...Ye]}),qe},[]),Dt=$.useCallback(async qe=>{w($e=>$e.find(Xe=>Xe.id===qe.id)?$e:[...$e,qe]),y($e=>$e?{...$e,messageCount:$e.messageCount+1,totalSize:$e.totalSize+(qe.content?.length||0)}:null),qe.isMe||U({type:"message_received",data:{message:qe},timestamp:Date.now()})},[U]),gt=$.useCallback(async qe=>qe?b.filter($e=>$e.recipient===qe||$e.sender===qe):b,[b]),vt=$.useCallback(async qe=>{w($e=>$e.filter(Xe=>Xe.id!==qe))},[]),Oe=$.useCallback(async()=>{w([]),y(qe=>qe?{...qe,messageCount:0,totalSize:0}:null)},[]),xt=$.useCallback(qe=>(F.current.add(qe),()=>{F.current.delete(qe)}),[]);$.useEffect(()=>{H()},[H]),$.useEffect(()=>{if(!e)return;const qe=setInterval(()=>{u($e=>$e.map(Xe=>({...Xe,status:Math.random()>.1?Xe.status:Math.random()>.5?"online":"away",lastSeen:Xe.status==="online"?Date.now():Xe.lastSeen})))},3e4);return()=>clearInterval(qe)},[e]);const pe={isInitialized:e,initializationProgress:i,localPeerId:s,identityPublicKey:a,connectedPeers:c,networkStats:h,storageStats:m,messages:b,statusMessage:v,activeSessions:S,pendingProofs:P,circuits:O,connectionQuality:N,initializeBridge:H,sendMessage:q,sendMediaMessage:J,sendEncryptedMessage:G,verifyZKProof:ee,generateMessageProof:Q,getCircuitInfo:ne,refreshNetworkStats:fe,refreshStorageStats:Ae,initiateCryptoSession:Pe,terminateSession:Ce,rotateSessionKeys:de,getSessionInfo:Ne,getKeyBundle:et,fetchPeerKeyBundle:me,connectToPeer:nt,disconnectFromPeer:Pt,discoverPeers:zt,storeMessage:Dt,retrieveMessages:gt,deleteMessage:vt,clearStorage:Oe,subscribeToEvents:xt};return f.jsx(Jee.Provider,{value:pe,children:n})},g9e=()=>{const n=$.useContext(Jee);if(!n)throw new Error("useG3ZKP must be used within G3ZKPProvider");return n},y9e={SUM:"",PRODUCT:"",INTEGRAL:"",PARTIAL:"",NABLA:"",DELTA:"",ALPHA:"",BETA:"",GAMMA:"",DELTA_LOWER:"",EPSILON:"",ZETA:"",ETA:"",THETA:"",LAMBDA:"",MU:"",PI:"",RHO:"",SIGMA:"",PHI:"",PSI:"",OMEGA:"",UNION:"",INTERSECTION:"",SUBSET:"",SUPERSET:"",ELEMENT_OF:"",NOT_ELEMENT_OF:"",EMPTY_SET:"",AND:"",OR:"",NOT:"",FORALL:"",EXISTS:"",PLUS_MINUS:"",MULTIPLY:"",DIVIDE:"",APPROX:"",NOT_EQUAL:"",LESS_EQUAL:"",GREATER_EQUAL:"",INFINITY:"",REAL:"",COMPLEX:"",RATIONAL:"",INTEGER:"",NATURAL:"",SQRT:"",CBRT:"",FOURTH_ROOT:"",DEGREE:"",PRIME:"",DOUBLE_PRIME:"",TENSOR_PRODUCT:"",DIRECT_SUM:"",CIRCLE_DOT:""},x9e=Object.values(y9e),Hj=({color:n="#00ffff",className:e="",speed:t=.15,brightness:i=1})=>{const r=$.useRef(null);return $.useEffect(()=>{const s=r.current;if(!s)return;const o=s.getContext("2d");if(!o)return;s.width=window.innerWidth,s.height=window.innerHeight;const a=18,l=s.width/a,c=Array(Math.floor(l)).fill(0),u=x9e,p=setInterval(()=>{o.fillStyle=`rgba(0, 2, 0, ${t})`,o.fillRect(0,0,s.width,s.height);for(let y=0;y<c.length;y++){const b=u[Math.floor(Math.random()*u.length)],w=y*a,v=c[y]*a,T=Math.min(1,i*1.5),S=i*.6;if(o.shadowBlur=12*i,o.shadowColor=n,c[y]%8===0)o.fillStyle=`rgba(255, 255, 255, ${T})`;else{const P=Math.floor(200+55*S);o.fillStyle=`rgba(0, ${P}, ${Math.floor(P*.6)}, ${S})`}o.font=`bold ${a}px "JetBrains Mono", "Fira Code", monospace`,o.fillText(b,w,v),c[y]++,c[y]*a>s.height&&Math.random()>.98&&(c[y]=0)}o.shadowBlur=0},35),m=()=>{s.width=window.innerWidth,s.height=window.innerHeight};return window.addEventListener("resize",m),()=>{clearInterval(p),window.removeEventListener("resize",m)}},[n,t,i]),f.jsx("canvas",{ref:r,className:`fixed top-0 left-0 w-screen h-screen pointer-events-none ${e}`,style:{opacity:.9}})},v9e=({activePage:n,onPageChange:e,onNewAction:t,onProfileClick:i,unreadCount:r=0,pendingRequests:s=0,hideOnNavigation:o=!1})=>{if(o)return null;const a=[{id:"geodesic",icon:y6,label:"MAP"},{id:"mesh",icon:As,label:"MESH",badge:r},{id:"business",icon:aS,label:"BIZ"},{id:"system",icon:Vm,label:"SYS"}];return f.jsx("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-50 border-t-[0.5px] border-[var(--color-border,#4caf50)]/30 bg-[var(--color-background,#000000)]/98 backdrop-blur-xl",style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:f.jsx("div",{className:"flex items-center justify-around px-1 h-[60px]",children:a.map((l,c)=>c===2?f.jsxs(Fa.Fragment,{children:[f.jsx("button",{onClick:i,className:"relative -top-3 w-10 h-10 border-[0.5px] border-[var(--color-primary,#00f3ff)]/60 bg-[var(--color-primary,#00f3ff)]/10 flex items-center justify-center text-[var(--color-primary,#00f3ff)] shadow-[0_0_20px_rgba(0,243,255,0.2)] active:scale-95 transition-all rounded-sm",children:f.jsx(Hae,{size:18,strokeWidth:1.5})}),f.jsxs("button",{onClick:()=>e(l.id),className:`flex flex-col items-center gap-0.5 px-1 sm:px-2 py-1.5 transition-all relative ${n===l.id?"text-[var(--color-primary,#00f3ff)]":"text-[var(--color-secondary,#4caf50)]/60"}`,children:[f.jsxs("div",{className:"relative",children:[f.jsx(l.icon,{size:16,strokeWidth:n===l.id?1.5:1}),l.badge!==void 0&&l.badge>0&&f.jsx("span",{className:"absolute -top-1 -right-2 min-w-[12px] h-[12px] flex items-center justify-center px-0.5 bg-[var(--color-primary,#00f3ff)] text-[var(--color-background,#000000)] text-[6px] font-black rounded-sm",children:l.badge>99?"99+":l.badge})]}),f.jsx("span",{className:"text-[5px] sm:text-[6px] font-black uppercase tracking-wide",children:l.label}),n===l.id&&f.jsx("div",{className:"absolute -top-[0.5px] left-1/2 -translate-x-1/2 w-5 h-[2px] bg-[var(--color-primary,#00f3ff)] shadow-[0_0_8px_var(--color-primary,#00f3ff)]"})]},l.id)]},"profile-center"):f.jsxs("button",{onClick:()=>e(l.id),className:`flex flex-col items-center gap-0.5 px-1 sm:px-2 py-1.5 transition-all relative ${n===l.id?"text-[var(--color-primary,#00f3ff)]":"text-[var(--color-secondary,#4caf50)]/60"}`,children:[f.jsxs("div",{className:"relative",children:[f.jsx(l.icon,{size:16,strokeWidth:n===l.id?1.5:1}),l.badge!==void 0&&l.badge>0&&f.jsx("span",{className:"absolute -top-1 -right-2 min-w-[12px] h-[12px] flex items-center justify-center px-0.5 bg-[var(--color-primary,#00f3ff)] text-[var(--color-background,#000000)] text-[6px] font-black rounded-sm",children:l.badge>99?"99+":l.badge})]}),f.jsx("span",{className:"text-[5px] sm:text-[6px] font-black uppercase tracking-wide",children:l.label}),n===l.id&&f.jsx("div",{className:"absolute -top-[0.5px] left-1/2 -translate-x-1/2 w-5 h-[2px] bg-[var(--color-primary,#00f3ff)] shadow-[0_0_8px_var(--color-primary,#00f3ff)]"})]},l.id))})})},$j=n=>{let e;const t=new Set,i=(c,u)=>{const h=typeof c=="function"?c(e):c;if(!Object.is(h,e)){const p=e;e=u??(typeof h!="object"||h===null)?h:Object.assign({},e,h),t.forEach(m=>m(e,p))}},r=()=>e,a={setState:i,getState:r,getInitialState:()=>l,subscribe:c=>(t.add(c),()=>t.delete(c))},l=e=n(i,r,a);return a},b9e=n=>n?$j(n):$j,_9e=n=>n;function w9e(n,e=_9e){const t=Fa.useSyncExternalStore(n.subscribe,Fa.useCallback(()=>e(n.getState()),[n,e]),Fa.useCallback(()=>e(n.getInitialState()),[n,e]));return Fa.useDebugValue(t),t}const Gj=n=>{const e=b9e(n),t=i=>w9e(e,i);return Object.assign(t,e),t},z_=n=>n?Gj(n):Gj,S9e="0123456789bcdefghjkmnpqrstuvwxyz",E9e="g3tzkp_business_db",T9e=1,Hl="businesses",sg="keys";class A9e{constructor(){E(this,"db",null);E(this,"initPromise",null)}async init(){if(!this.db)return this.initPromise?this.initPromise:(this.initPromise=new Promise((e,t)=>{const i=indexedDB.open(E9e,T9e);i.onerror=()=>t(i.error),i.onsuccess=()=>{this.db=i.result,e()},i.onupgradeneeded=r=>{const s=r.target.result;if(!s.objectStoreNames.contains(Hl)){const o=s.createObjectStore(Hl,{keyPath:"id"});o.createIndex("by_crn","crn",{unique:!0}),o.createIndex("by_geohash","location.geohash",{unique:!1}),o.createIndex("by_category","category",{unique:!1}),o.createIndex("by_peerId","peerId",{unique:!1})}s.objectStoreNames.contains(sg)||s.createObjectStore(sg,{keyPath:"id"})}}),this.initPromise)}async getKeys(){return await this.init(),new Promise((e,t)=>{const s=this.db.transaction(sg,"readonly").objectStore(sg).get("operator_keys");s.onsuccess=()=>e(s.result||null),s.onerror=()=>t(s.error)})}async saveKeys(e){return await this.init(),new Promise((t,i)=>{const o=this.db.transaction(sg,"readwrite").objectStore(sg).put({id:"operator_keys",...e});o.onsuccess=()=>t(),o.onerror=()=>i(o.error)})}async getAllBusinesses(){return await this.init(),new Promise((e,t)=>{const s=this.db.transaction(Hl,"readonly").objectStore(Hl).getAll();s.onsuccess=()=>e(s.result||[]),s.onerror=()=>t(s.error)})}async saveBusiness(e){return await this.init(),new Promise((t,i)=>{const o=this.db.transaction(Hl,"readwrite").objectStore(Hl).put(e);o.onsuccess=()=>t(),o.onerror=()=>i(o.error)})}async deleteBusiness(e){return await this.init(),new Promise((t,i)=>{const o=this.db.transaction(Hl,"readwrite").objectStore(Hl).delete(e);o.onsuccess=()=>t(),o.onerror=()=>i(o.error)})}async getBusinessByCRN(e){return await this.init(),new Promise((t,i)=>{const a=this.db.transaction(Hl,"readonly").objectStore(Hl).index("by_crn").get(e);a.onsuccess=()=>t(a.result||null),a.onerror=()=>i(a.error)})}async getBusinessesByPeerId(e){return await this.init(),new Promise((t,i)=>{const a=this.db.transaction(Hl,"readonly").objectStore(Hl).index("by_peerId").getAll(e);a.onsuccess=()=>t(a.result||[]),a.onerror=()=>i(a.error)})}}const Sp=new A9e;function C9e(n,e,t=9){let i=-90,r=90,s=-180,o=180,a="",l=0,c=0,u=!0;for(;a.length<t;){if(u){const h=(s+o)/2;e>=h?(c=c|1<<4-l,s=h):o=h}else{const h=(i+r)/2;n>=h?(c=c|1<<4-l,i=h):r=h}u=!u,l++,l===5&&(a+=S9e[c],l=0,c=0)}return a}function M9e(){const n=Vn.randomBytes(16);n[6]=n[6]&15|64,n[8]=n[8]&63|128;const e=Array.from(n).map(t=>t.toString(16).padStart(2,"0")).join("");return`${e.slice(0,8)}-${e.slice(8,12)}-${e.slice(12,16)}-${e.slice(16,20)}-${e.slice(20)}`}function R9e(n,e,t){const i=`${n}:${e.toLowerCase().trim()}:${t.replace(/\s+/g,"").toUpperCase()}`,r=new TextEncoder,s=Vn.hash(r.encode(i));return Lu.encodeBase64(s).substring(0,64)}class I9e{constructor(){E(this,"localKeyPair",null);E(this,"peerId","");E(this,"VERIFICATION_TOPIC","g3tzkp-business-verification-v1");E(this,"businessUpdateCallbacks",[]);E(this,"initialized",!1);E(this,"initPromise",null);this.initPromise=this.initializeKeys()}async initializeKeys(){if(!this.initialized)try{const e=await Sp.getKeys();e?(this.localKeyPair={publicKey:Lu.decodeBase64(e.publicKey),secretKey:Lu.decodeBase64(e.secretKey)},this.peerId=e.peerId):await this.generateNewKeys(),this.initialized=!0}catch(e){console.error("[BusinessVerification] Key initialization error:",e),await this.generateNewKeys(),this.initialized=!0}}async generateNewKeys(){this.localKeyPair=Vn.box.keyPair(),this.peerId=`12D3KooW${Lu.encodeBase64(this.localKeyPair.publicKey).substring(0,44).replace(/[+/=]/g,"")}`,await Sp.saveKeys({publicKey:Lu.encodeBase64(this.localKeyPair.publicKey),secretKey:Lu.encodeBase64(this.localKeyPair.secretKey),peerId:this.peerId})}async ensureInitialized(){this.initPromise&&await this.initPromise}getPeerId(){return this.peerId}validateCRN(e){const t=e.toUpperCase().replace(/\s+/g,"");return[/^[0-9]{8}$/,/^[A-Z]{2}[0-9]{6}$/,/^[0-9]{6}$/,/^[A-Z][0-9]{7}$/,/^[0-9]{7}[A-Z]$/].some(r=>r.test(t))}validatePostcode(e){return/^([A-Z]{1,2}[0-9][0-9A-Z]?\s?[0-9][A-Z]{2})$/i.test(e.trim())}validateCoordinates(e,t){return e>=-90&&e<=90&&t>=-180&&t<=180}validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}validateBusinessHours(e){const t=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],i=/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/;for(const r of t)if(e[r]&&(!i.test(e[r].open)||!i.test(e[r].close)))return!1;return!0}validateBusinessProfile(e){const t=[];return this.validateCRN(e.crn)||t.push("Invalid Companies House Registration Number format"),(!e.name||e.name.trim().length<2)&&t.push("Business name is required"),e.location?.address?.postcode?this.validatePostcode(e.location.address.postcode)||t.push("Invalid UK postcode format"):t.push("Postcode is required"),this.validateCoordinates(e.location?.latitude,e.location?.longitude)||t.push("Invalid geographic coordinates"),e.contact?.email?this.validateEmail(e.contact.email)||t.push("Invalid email format"):t.push("Contact email is required"),e.hours&&!this.validateBusinessHours(e.hours)&&t.push("Invalid business hours format (use HH:MM)"),{isValid:t.length===0,errors:t}}async fetchCompanyData(e){try{const t=e.toUpperCase().replace(/\s+/g,"").padStart(8,"0"),i=await fetch("/api/verify-company",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({crn:t})});return i.ok?await i.json():(console.error("[BusinessVerification] Company lookup failed:",i.status),null)}catch(t){return console.error("[BusinessVerification] Failed to fetch company data:",t),null}}verifyDataMatch(e,t){const i=a=>a.toLowerCase().replace(/\s+/g," ").trim(),r=a=>a.replace(/\s+/g,"").toUpperCase(),s=i(e.company_name)===i(t.name),o=r(e.address.postal_code)===r(t.location.address.postcode);return s&&o}mapSICCode(e){if(!e)return"other";const t={56101:"restaurant",56102:"takeaway",56301:"bar",56302:"pub",47110:"groceries",47710:"clothing",86:"healthcare",47730:"pharmacy",96020:"beauty",93130:"fitness",45:"automotive",95:"repair",69:"legal",64:"financial",85:"education",55:"accommodation",93:"entertainment"};if(t[e])return t[e];const i=e.substring(0,2);return t[i]?t[i]:"other"}async signBusinessProfile(e){if(!this.localKeyPair)throw new Error("Keys not initialized");const t=JSON.stringify({id:e.id,crn:e.crn,name:e.name,verification_hash:e.verification_hash,location:e.location,verified_at:e.verified_at,peerId:e.peerId}),i=new TextEncoder().encode(t),r=Vn.sign.detached(i,this.localKeyPair.secretKey);return Lu.encodeBase64(r)}async verifyBusinessSignature(e){try{const{signature:t,...i}=e,r=JSON.stringify({id:i.id,crn:i.crn,name:i.name,verification_hash:i.verification_hash,location:i.location,verified_at:i.verified_at,peerId:i.peerId}),s=new TextEncoder().encode(r),o=Lu.decodeBase64(t),a=e.peerId.replace("12D3KooW",""),l=Lu.decodeBase64(a+"====");return Vn.sign.detached.verify(s,o,l)}catch{return!1}}async verifyAndCreateBusiness(e){if(!this.validateCRN(e.crn))return{success:!1,error:"Invalid CRN format"};const t=this.validateBusinessProfile({...e.proposedProfile,crn:e.crn});if(!t.isValid)return{success:!1,error:t.errors.join("; ")};const i=await this.fetchCompanyData(e.crn);if(!i)return{success:!1,error:"Company not found in Companies House registry"};if(i.status!=="active")return{success:!1,error:`Company status is "${i.status}" - only active companies can be registered`};if(!this.verifyDataMatch(i,e.proposedProfile))return{success:!1,error:"Business name or postcode does not match Companies House records"};const s=Date.now(),a={id:M9e(),crn:i.company_number,verification_hash:R9e(i.company_number,i.company_name,i.address.postal_code),verified_at:s,verified_by:this.peerId,name:i.company_name,description:e.proposedProfile.description,category:e.proposedProfile.category||this.mapSICCode(i.sic_codes?.[0]),location:{latitude:e.proposedProfile.location.latitude,longitude:e.proposedProfile.location.longitude,address:{line1:i.address.address_line_1,line2:i.address.address_line_2,city:i.address.locality,postcode:i.address.postal_code,country:i.address.country||"United Kingdom"},geohash:C9e(e.proposedProfile.location.latitude,e.proposedProfile.location.longitude)},contact:e.proposedProfile.contact,hours:e.proposedProfile.hours,peerId:this.peerId,createdAt:s,updatedAt:s,signature:"",company_status:i.status,sic_codes:i.sic_codes},l=await this.signBusinessProfile(a);return a.signature=l,await this.storeBusinessProfile(a),await this.broadcastToNetwork(a),console.log("[BusinessVerification] Successfully verified and created business:",a.name),{success:!0,profile:a}}async broadcastToNetwork(e){const t={type:"BUSINESS_VERIFIED",version:"1.0",timestamp:Date.now(),payload:e,sender:this.peerId,signature:e.signature};try{await fetch("/api/p2p/broadcast",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:this.VERIFICATION_TOPIC,message:JSON.stringify(t)})}),console.log("[BusinessVerification] Broadcast to network:",e.id)}catch(i){console.warn("[BusinessVerification] Network broadcast failed, profile saved locally:",i)}}async storeBusinessProfile(e){await Sp.saveBusiness(e),console.log("[BusinessVerification] Stored business profile:",e.name)}async getLocalBusinesses(){try{return await Sp.getAllBusinesses()}catch(e){return console.error("[BusinessVerification] Failed to get businesses:",e),[]}}async getBusinessById(e){return(await this.getLocalBusinesses()).find(i=>i.id===e)||null}async getBusinessByCRN(e){const t=e.toUpperCase().replace(/\s+/g,"").padStart(8,"0");return await Sp.getBusinessByCRN(t)}async getBusinessesByCategory(e){return(await this.getLocalBusinesses()).filter(i=>i.category===e)}async getBusinessesInArea(e,t,i){return(await this.getLocalBusinesses()).filter(s=>{const o=(s.location.latitude-e)*Math.PI/180,a=(s.location.longitude-t)*Math.PI/180,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*Math.PI/180)*Math.cos(s.location.latitude*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))<=i})}async getMyBusinesses(){return await this.ensureInitialized(),await Sp.getBusinessesByPeerId(this.peerId)}async deleteBusinessProfile(e){await this.ensureInitialized();const t=await this.getBusinessById(e);return t?t.peerId!==this.peerId?(console.error("[BusinessVerification] Cannot delete business owned by another peer"),!1):(await Sp.deleteBusiness(e),console.log("[BusinessVerification] Deleted business:",e),!0):!1}subscribeToBusinessUpdates(e){return this.businessUpdateCallbacks.push(e),()=>{const t=this.businessUpdateCallbacks.indexOf(e);t>=0&&this.businessUpdateCallbacks.splice(t,1)}}handleNetworkMessage(e){try{const t=JSON.parse(e);if(t.type==="BUSINESS_VERIFIED"&&t.payload){const i=t.payload;this.storeBusinessProfile(i),this.businessUpdateCallbacks.forEach(r=>r(i))}}catch(t){console.error("[BusinessVerification] Failed to handle network message:",t)}}}const Mu=new I9e,N9e={monday:{open:"09:00",close:"17:00"},tuesday:{open:"09:00",close:"17:00"},wednesday:{open:"09:00",close:"17:00"},thursday:{open:"09:00",close:"17:00"},friday:{open:"09:00",close:"17:00"},saturday:{open:"10:00",close:"16:00"},sunday:{open:"",close:""}},Wj={crn:"",name:"",description:"",category:"",latitude:51.5074,longitude:-.1278,address:{line1:"",line2:"",city:"",postcode:"",country:"United Kingdom"},contact:{email:"",phone:"",website:""},hours:N9e},ete=z_()((n,e)=>({businesses:[],myBusinesses:[],selectedBusiness:null,isLoading:!1,error:null,registrationStep:1,formData:{...Wj},verificationResult:null,showRegistrationModal:!1,companyData:null,loadBusinesses:async()=>{try{await Mu.ensureInitialized();const t=await Mu.getLocalBusinesses(),i=await Mu.getMyBusinesses();console.log("[BusinessStore] Loaded",t.length,"businesses from IndexedDB"),n({businesses:t,myBusinesses:i})}catch(t){console.error("[BusinessStore] Failed to load businesses:",t)}},setSelectedBusiness:t=>{n({selectedBusiness:t})},setRegistrationStep:t=>{n({registrationStep:t})},updateFormData:t=>{n(i=>({formData:{...i.formData,...t}}))},updateFormAddress:t=>{n(i=>({formData:{...i.formData,address:{...i.formData.address,...t}}}))},updateFormContact:t=>{n(i=>({formData:{...i.formData,contact:{...i.formData.contact,...t}}}))},updateFormHours:(t,i)=>{n(r=>({formData:{...r.formData,hours:{...r.formData.hours,[t]:i}}}))},resetFormData:()=>{n({formData:{...Wj},registrationStep:1,verificationResult:null,error:null,companyData:null})},verifyCRN:async t=>{n({isLoading:!0,error:null});try{await Mu.ensureInitialized();const i=await Mu.fetchCompanyData(t);return i&&i.verified?(n(r=>({formData:{...r.formData,crn:i.company_number,name:i.company_name,address:{...r.formData.address,line1:i.address.address_line_1||"",line2:i.address.address_line_2||"",city:i.address.locality||"",postcode:i.address.postal_code||""}},isLoading:!1,registrationStep:2,companyData:i})),i):(n({error:"Company not found in Companies House registry",isLoading:!1}),null)}catch{return n({error:"Failed to verify company. Please try again.",isLoading:!1}),null}},submitRegistration:async()=>{const{formData:t}=e();n({isLoading:!0,error:null});try{await Mu.ensureInitialized();const i=await Mu.verifyAndCreateBusiness({crn:t.crn,proposedProfile:{name:t.name,description:t.description,category:t.category,location:{latitude:t.latitude,longitude:t.longitude,address:t.address,geohash:""},contact:t.contact,hours:t.hours,peerId:Mu.getPeerId()},operatorSignature:""});return i.success&&i.profile?(n(r=>({businesses:[...r.businesses,i.profile],myBusinesses:[...r.myBusinesses,i.profile],verificationResult:i,isLoading:!1,showRegistrationModal:!1})),e().resetFormData()):n({error:i.error||"Registration failed",verificationResult:i,isLoading:!1}),i}catch{const r={success:!1,error:"An unexpected error occurred"};return n({error:r.error,verificationResult:r,isLoading:!1}),r}},deleteBusiness:async t=>{const i=await Mu.deleteBusinessProfile(t);return i&&n(r=>({businesses:r.businesses.filter(s=>s.id!==t),myBusinesses:r.myBusinesses.filter(s=>s.id!==t),selectedBusiness:r.selectedBusiness?.id===t?null:r.selectedBusiness})),i},setShowRegistrationModal:t=>{n({showRegistrationModal:t}),t||e().resetFormData()},addReceivedBusiness:t=>{n(i=>i.businesses.some(s=>s.id===t.id)?i:{businesses:[...i.businesses,t]})},searchBusinesses:t=>{const{businesses:i}=e(),r=t.toLowerCase();return i.filter(s=>s.name.toLowerCase().includes(r)||s.description.toLowerCase().includes(r)||s.category.toLowerCase().includes(r)||s.location.address.city.toLowerCase().includes(r))},getBusinessesNearby:async(t,i,r)=>await Mu.getBusinessesInArea(t,i,r),setLocation:(t,i)=>{n(r=>({formData:{...r.formData,latitude:t,longitude:i}}))}})),fC=[{value:"restaurant",label:"Restaurant"},{value:"pub",label:"Pub / Bar"},{value:"cafe",label:"Cafe"},{value:"takeaway",label:"Takeaway"},{value:"groceries",label:"Groceries"},{value:"retail",label:"Retail"},{value:"clothing",label:"Clothing"},{value:"healthcare",label:"Healthcare"},{value:"pharmacy",label:"Pharmacy"},{value:"beauty",label:"Beauty / Salon"},{value:"fitness",label:"Fitness / Gym"},{value:"automotive",label:"Automotive"},{value:"repair",label:"Repair Services"},{value:"professional",label:"Professional Services"},{value:"legal",label:"Legal"},{value:"financial",label:"Financial"},{value:"education",label:"Education"},{value:"accommodation",label:"Accommodation"},{value:"entertainment",label:"Entertainment"},{value:"other",label:"Other"}],pC=10,P9e=()=>{const[n,e]=$.useState("register"),[t,i]=$.useState(null),[r,s]=$.useState(""),[o,a]=$.useState(""),{formData:l,updateFormData:c,updateFormContact:u,updateFormAddress:h,isLoading:p,companyData:m,registrationStep:y,setRegistrationStep:b,resetFormData:w,verifyCRN:v,submitRegistration:T,businesses:S,myBusinesses:M,loadBusinesses:P,deleteBusiness:R}=ete(),O={crn:l.crn,businessName:l.name,description:l.description,category:l.category,address:l.address.line1,postcode:l.address.postcode,phone:l.contact.phone,email:l.contact.email,website:l.contact.website,latitude:l.latitude,longitude:l.longitude,openingHours:l.hours},B=(j,W)=>{switch(j){case"crn":c({crn:W});break;case"businessName":c({name:W});break;case"description":c({description:W});break;case"category":c({category:W});break;case"address":h({line1:W});break;case"postcode":h({postcode:W});break;case"phone":u({phone:W});break;case"email":u({email:W});break;case"website":u({website:W});break;case"latitude":c({latitude:W});break;case"longitude":c({longitude:W});break}};$.useEffect(()=>{P()},[P]);const N=async()=>{if(!O.crn||O.crn.length<6)return;await v(O.crn)||alert("Company verification failed. Please check your CRN.")},I=async()=>{if(!m)return;const j=await T();j.success?(e("my-business"),alert("Business registered successfully on the G3ZKP network!")):alert(j.error||"Failed to register business")},F=S.filter(j=>{const W=!r||j.name.toLowerCase().includes(r.toLowerCase())||j.description?.toLowerCase().includes(r.toLowerCase()),U=!o||j.category===o;return W&&U});return f.jsx("div",{className:"flex-1 overflow-y-auto bg-[var(--color-background,#000000)]",children:f.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 py-4 md:py-6 pb-24 lg:pb-6",children:[f.jsx("header",{className:"mb-4 md:mb-6",children:f.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[f.jsxs("div",{children:[f.jsxs("h1",{className:"text-xl sm:text-2xl text-[var(--color-primary,#00f3ff)] font-mono mb-1 flex items-center gap-2",children:[f.jsx(aS,{size:20,className:"sm:w-6 sm:h-6"}),f.jsx("span",{className:"tracking-wider",children:"BUSINESS_UPLINK"})]}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs sm:text-sm font-mono",children:"Verified P2P business network with Companies House validation"})]}),f.jsx("div",{className:"flex items-center gap-2",children:f.jsxs("div",{className:"px-2 py-1 bg-[var(--color-success,#4caf50)]/10 border border-[var(--color-success,#4caf50)]/30 rounded text-[var(--color-success,#4caf50)] text-[10px] sm:text-xs font-mono flex items-center gap-1",children:[f.jsx(wU,{size:12}),f.jsx("span",{className:"hidden sm:inline",children:"P2P_NETWORK"}),f.jsx("span",{className:"sm:hidden",children:"P2P"})]})})]})}),f.jsx("div",{className:"bg-[var(--color-primary,#00f3ff)]/5 backdrop-blur-xl border border-[var(--color-primary,#00f3ff)]/30 rounded-xl p-3 sm:p-4 mb-4 md:mb-6 shadow-[0_4px_20px_rgba(0,243,255,0.1)]",children:f.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 sm:justify-between",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-lg bg-[var(--color-primary,#00f3ff)]/10 border border-[var(--color-primary,#00f3ff)]/30 flex items-center justify-center",children:f.jsx(OR,{size:18,className:"text-[var(--color-primary,#00f3ff)]"})}),f.jsxs("div",{children:[f.jsxs("span",{className:"text-[var(--color-primary,#00f3ff)] font-mono text-sm font-bold",children:["NETWORK_FEE: ",pC]}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/60 text-xs font-mono",children:"One-time fee to join the verified business network"})]})]}),f.jsxs("div",{className:"text-[var(--color-textSecondary,#4caf50)]/60 text-xs font-mono flex items-center gap-1.5 bg-black/30 px-3 py-1.5 rounded-lg border border-white/10",children:[f.jsx(ao,{size:12,className:"text-[var(--color-success,#4caf50)]"}),"Cryptographically signed verification"]})]})}),f.jsx("div",{className:"flex gap-2 mb-4 md:mb-6 overflow-x-auto pb-2 -mx-3 px-3 sm:mx-0 sm:px-0",children:[{id:"register",label:"REGISTER",icon:lA},{id:"directory",label:"DIRECTORY",icon:ja,count:S.length},{id:"my-business",label:"MY BUSINESS",icon:aS,count:M.length}].map(j=>f.jsxs("button",{onClick:()=>e(j.id),className:`flex items-center gap-1.5 px-3 sm:px-4 py-2 border font-mono text-xs sm:text-sm whitespace-nowrap transition-all ${n===j.id?"bg-[var(--color-primary,#00f3ff)]/10 border-[var(--color-primary,#00f3ff)] text-[var(--color-primary,#00f3ff)]":"border-[var(--color-border,#4caf50)]/30 text-[var(--color-textSecondary,#4caf50)]/60 hover:border-[var(--color-border,#4caf50)]/60"}`,children:[f.jsx(j.icon,{size:14}),f.jsx("span",{children:j.label}),j.count!==void 0&&j.count>0&&f.jsx("span",{className:"ml-1 px-1.5 py-0.5 bg-[var(--color-primary,#00f3ff)] text-[var(--color-background,#000000)] text-[10px] font-bold rounded",children:j.count})]},j.id))}),n==="register"&&f.jsxs("div",{className:"max-w-2xl mx-auto",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("div",{className:"flex items-center gap-2",children:[1,2,3].map(j=>f.jsxs(Fa.Fragment,{children:[f.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-mono text-sm ${y>=j?"bg-[var(--color-primary,#00f3ff)] text-[var(--color-background,#000000)]":"bg-[var(--color-surface,#010401)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-textSecondary,#4caf50)]/50"}`,children:y>j?f.jsx(us,{size:16}):j}),j<3&&f.jsx("div",{className:`w-8 sm:w-12 h-0.5 ${y>j?"bg-[var(--color-primary,#00f3ff)]":"bg-[var(--color-border,#4caf50)]/30"}`})]},j))}),y>1&&f.jsx("button",{onClick:w,className:"text-[var(--color-textSecondary,#4caf50)]/50 hover:text-[var(--color-error,#ff0055)] text-xs font-mono",children:"Reset"})]}),y===1&&f.jsxs("div",{className:"bg-[var(--color-surface,#010401)] border border-[var(--color-border,#4caf50)]/30 rounded-lg p-4 sm:p-6",children:[f.jsxs("h3",{className:"text-[var(--color-primary,#00f3ff)] font-mono text-lg mb-4 flex items-center gap-2",children:[f.jsx(ao,{size:18}),"STEP 1: VERIFY_COMPANY"]}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-sm font-mono mb-6",children:"Enter your UK Companies House Registration Number (CRN) to verify your business."}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono mb-1 block",children:"COMPANY_REGISTRATION_NUMBER (CRN)"}),f.jsx("input",{type:"text",value:O.crn,onChange:j=>B("crn",j.target.value.toUpperCase()),placeholder:"e.g., 12345678 or SC123456",className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-4 py-3 text-sm font-mono rounded placeholder:text-[var(--color-textSecondary,#4caf50)]/30",maxLength:10}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/50 text-xs font-mono mt-1",children:"UK format: 8 digits or 2 letters + 6 digits"})]}),f.jsx("button",{onClick:N,disabled:p||!O.crn||O.crn.length<6,className:"w-full py-3 bg-[var(--color-primary,#00f3ff)]/10 border border-[var(--color-primary,#00f3ff)] text-[var(--color-primary,#00f3ff)] font-mono text-sm hover:bg-[var(--color-primary,#00f3ff)]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:p?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-primary,#00f3ff)] border-t-transparent rounded-full animate-spin"}),"VERIFYING..."]}):f.jsxs(f.Fragment,{children:[f.jsx(us,{size:16}),"VERIFY_WITH_COMPANIES_HOUSE"]})})]}),f.jsx("div",{className:"mt-6 p-3 bg-[var(--color-background,#000000)]/50 rounded border border-[var(--color-border,#4caf50)]/20",children:f.jsxs("p",{className:"text-[var(--color-textSecondary,#4caf50)]/50 text-xs font-mono flex items-start gap-2",children:[f.jsx(ZP,{size:14,className:"flex-shrink-0 mt-0.5"}),"Test CRNs for development: 00000001, 12345678"]})})]}),y===2&&m&&f.jsxs("div",{className:"bg-[var(--color-surface,#010401)] border border-[var(--color-border,#4caf50)]/30 rounded-lg p-4 sm:p-6",children:[f.jsxs("h3",{className:"text-[var(--color-primary,#00f3ff)] font-mono text-lg mb-4 flex items-center gap-2",children:[f.jsx(lA,{size:18}),"STEP 2: BUSINESS_DETAILS"]}),f.jsxs("div",{className:"mb-6 p-3 bg-[var(--color-success,#4caf50)]/10 border border-[var(--color-success,#4caf50)]/30 rounded",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(us,{size:16,className:"text-[var(--color-success,#4caf50)]"}),f.jsx("span",{className:"text-[var(--color-success,#4caf50)] font-mono text-sm font-bold",children:"COMPANY_VERIFIED"})]}),f.jsx("p",{className:"text-[var(--color-text,#00f3ff)] font-mono text-sm",children:m.company_name}),f.jsxs("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono",children:["CRN: ",O.crn]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono mb-1 block",children:"CATEGORY"}),f.jsxs("select",{value:O.category,onChange:j=>B("category",j.target.value),className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-3 py-2.5 text-sm font-mono rounded",children:[f.jsx("option",{value:"",children:"Select category..."}),fC.map(j=>f.jsx("option",{value:j.value,children:j.label},j.value))]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono mb-1 block",children:"PHONE"}),f.jsx("input",{type:"tel",value:O.phone,onChange:j=>B("phone",j.target.value),placeholder:"+44 1234 567890",className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-3 py-2.5 text-sm font-mono rounded placeholder:text-[var(--color-textSecondary,#4caf50)]/30"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono mb-1 block",children:"EMAIL"}),f.jsx("input",{type:"email",value:O.email,onChange:j=>B("email",j.target.value),placeholder:"contact@business.com",className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-3 py-2.5 text-sm font-mono rounded placeholder:text-[var(--color-textSecondary,#4caf50)]/30"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono mb-1 block",children:"WEBSITE"}),f.jsx("input",{type:"url",value:O.website,onChange:j=>B("website",j.target.value),placeholder:"https://www.business.com",className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-3 py-2.5 text-sm font-mono rounded placeholder:text-[var(--color-textSecondary,#4caf50)]/30"})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono mb-1 block",children:"DESCRIPTION"}),f.jsx("textarea",{value:O.description,onChange:j=>B("description",j.target.value),placeholder:"Describe your business services...",rows:3,className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-3 py-2.5 text-sm font-mono rounded placeholder:text-[var(--color-textSecondary,#4caf50)]/30 resize-none"})]}),f.jsxs("button",{onClick:()=>b(3),disabled:!O.category,className:"w-full py-3 bg-[var(--color-primary,#00f3ff)]/10 border border-[var(--color-primary,#00f3ff)] text-[var(--color-primary,#00f3ff)] font-mono text-sm hover:bg-[var(--color-primary,#00f3ff)]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[f.jsx(wy,{size:16}),"CONTINUE_TO_PAYMENT"]})]})]}),y===3&&f.jsxs("div",{className:"bg-[var(--color-surface,#010401)] border border-[var(--color-border,#4caf50)]/30 rounded-lg p-4 sm:p-6",children:[f.jsxs("h3",{className:"text-[var(--color-primary,#00f3ff)] font-mono text-lg mb-4 flex items-center gap-2",children:[f.jsx(OR,{size:18}),"STEP 3: NETWORK_FEE"]}),f.jsxs("div",{className:"mb-6 p-4 bg-[var(--color-warning,#ffaa00)]/10 border border-[var(--color-warning,#ffaa00)]/30 rounded",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("span",{className:"text-[var(--color-warning,#ffaa00)] font-mono text-lg font-bold",children:["",pC,".00"]}),f.jsx("span",{className:"text-[var(--color-textSecondary,#4caf50)]/50 text-xs font-mono",children:"ONE-TIME FEE"})]}),f.jsxs("ul",{className:"space-y-2 text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono",children:[f.jsxs("li",{className:"flex items-center gap-2",children:[f.jsx(us,{size:12,className:"text-[var(--color-success,#4caf50)]"}),"Cryptographic verification and signing"]}),f.jsxs("li",{className:"flex items-center gap-2",children:[f.jsx(us,{size:12,className:"text-[var(--color-success,#4caf50)]"}),"P2P network broadcast to all nodes"]}),f.jsxs("li",{className:"flex items-center gap-2",children:[f.jsx(us,{size:12,className:"text-[var(--color-success,#4caf50)]"}),"Secure IndexedDB storage"]}),f.jsxs("li",{className:"flex items-center gap-2",children:[f.jsx(us,{size:12,className:"text-[var(--color-success,#4caf50)]"}),"Verified business badge"]})]})]}),f.jsxs("div",{className:"mb-6 p-3 bg-[var(--color-background,#000000)]/50 rounded border border-[var(--color-border,#4caf50)]/20",children:[f.jsx("h4",{className:"text-[var(--color-text,#00f3ff)] font-mono text-sm mb-2",children:"Registration Summary"}),f.jsxs("div",{className:"space-y-1 text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono",children:[f.jsxs("p",{children:["Business: ",O.businessName]}),f.jsxs("p",{children:["CRN: ",O.crn]}),f.jsxs("p",{children:["Category: ",fC.find(j=>j.id===O.category)?.name||O.category]})]})]}),f.jsx("button",{onClick:I,disabled:p,className:"w-full py-3 bg-[var(--color-success,#4caf50)]/10 border border-[var(--color-success,#4caf50)] text-[var(--color-success,#4caf50)] font-mono text-sm hover:bg-[var(--color-success,#4caf50)]/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:p?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"w-4 h-4 border-2 border-[var(--color-success,#4caf50)] border-t-transparent rounded-full animate-spin"}),"REGISTERING..."]}):f.jsxs(f.Fragment,{children:[f.jsx(wU,{size:16}),"COMPLETE_REGISTRATION (",pC,")"]})})]})]}),n==="directory"&&f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[f.jsxs("div",{className:"flex-1 relative",children:[f.jsx(ja,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-[var(--color-textSecondary,#4caf50)]/50"}),f.jsx("input",{type:"text",value:r,onChange:j=>s(j.target.value),placeholder:"Search businesses...",className:"w-full bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] pl-10 pr-4 py-2.5 text-sm font-mono rounded placeholder:text-[var(--color-textSecondary,#4caf50)]/30"})]}),f.jsxs("select",{value:o,onChange:j=>a(j.target.value),className:"bg-[var(--color-background,#000000)] border border-[var(--color-border,#4caf50)]/30 text-[var(--color-text,#00f3ff)] px-3 py-2.5 text-sm font-mono rounded",children:[f.jsx("option",{value:"",children:"All categories"}),fC.map(j=>f.jsx("option",{value:j.value,children:j.label},j.value))]})]}),F.length>0?f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(j=>f.jsxs("div",{onClick:()=>i(j),className:"bg-[var(--color-surface,#010401)] border border-[var(--color-border,#4caf50)]/30 rounded-lg p-4 cursor-pointer hover:border-[var(--color-primary,#00f3ff)]/50 transition-all",children:[f.jsxs("div",{className:"flex items-start justify-between mb-3",children:[f.jsxs("div",{children:[f.jsx("h4",{className:"text-[var(--color-primary,#00f3ff)] font-mono font-bold text-sm",children:j.name}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono",children:j.category})]}),j.verification_hash&&f.jsx(us,{size:16,className:"text-[var(--color-success,#4caf50)]"})]}),j.description&&f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/50 text-xs font-mono line-clamp-2 mb-3",children:j.description}),f.jsxs("div",{className:"flex items-center gap-2 text-[var(--color-textSecondary,#4caf50)]/50 text-xs font-mono",children:[f.jsx(Ba,{size:12}),f.jsxs("span",{className:"truncate",children:[j.location.address.line1,", ",j.location.address.postcode]})]})]},j.id))}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx(lA,{size:48,className:"mx-auto text-[var(--color-textSecondary,#4caf50)]/30 mb-4"}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/50 font-mono",children:"No businesses found"}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/30 font-mono text-sm mt-2",children:"Be the first to register!"})]})]}),n==="my-business"&&f.jsx("div",{className:"space-y-4",children:M.length>0?f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map(j=>f.jsxs("div",{className:"bg-[var(--color-surface,#010401)] border border-[var(--color-primary,#00f3ff)]/30 rounded-lg p-4 sm:p-6",children:[f.jsx("div",{className:"flex items-start justify-between mb-4",children:f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("h4",{className:"text-[var(--color-primary,#00f3ff)] font-mono font-bold",children:j.name}),j.verification_hash&&f.jsx("span",{className:"px-2 py-0.5 bg-[var(--color-success,#4caf50)]/10 border border-[var(--color-success,#4caf50)]/30 text-[var(--color-success,#4caf50)] text-[10px] font-mono",children:"VERIFIED"})]}),f.jsxs("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-xs font-mono",children:["CRN: ",j.crn]})]})}),f.jsxs("div",{className:"space-y-2 text-xs font-mono",children:[f.jsxs("div",{className:"flex items-center gap-2 text-[var(--color-textSecondary,#4caf50)]/70",children:[f.jsx(Ba,{size:12}),f.jsxs("span",{children:[j.location.address.line1,", ",j.location.address.postcode]})]}),j.contact?.phone&&f.jsx("div",{className:"flex items-center gap-2 text-[var(--color-textSecondary,#4caf50)]/70",children:f.jsxs("span",{children:["Phone: ",j.contact.phone]})}),j.contact?.email&&f.jsx("div",{className:"flex items-center gap-2 text-[var(--color-textSecondary,#4caf50)]/70",children:f.jsxs("span",{children:["Email: ",j.contact.email]})}),f.jsxs("div",{className:"flex items-center gap-2 text-[var(--color-textSecondary,#4caf50)]/50",children:[f.jsx(z0,{size:12}),f.jsxs("span",{children:["Registered: ",new Date(j.createdAt).toLocaleDateString()]})]})]})]},j.id))}):f.jsxs("div",{className:"text-center py-12",children:[f.jsx(aS,{size:48,className:"mx-auto text-[var(--color-textSecondary,#4caf50)]/30 mb-4"}),f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/50 font-mono",children:"No registered businesses"}),f.jsx("button",{onClick:()=>e("register"),className:"mt-4 px-6 py-2 bg-[var(--color-primary,#00f3ff)]/10 border border-[var(--color-primary,#00f3ff)] text-[var(--color-primary,#00f3ff)] font-mono text-sm hover:bg-[var(--color-primary,#00f3ff)]/20 transition-all",children:"Register Your Business"})]})}),t&&f.jsx("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",children:f.jsxs("div",{className:"bg-[var(--color-surface,#010401)] border border-[var(--color-border,#4caf50)]/30 rounded-lg w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[f.jsxs("div",{className:"p-4 border-b border-[var(--color-border,#4caf50)]/30 flex items-center justify-between",children:[f.jsx("h3",{className:"text-[var(--color-primary,#00f3ff)] font-mono font-bold",children:t.name}),f.jsx("button",{onClick:()=>i(null),className:"text-[var(--color-textSecondary,#4caf50)]/50 hover:text-[var(--color-text,#00f3ff)]",children:f.jsx(Ui,{size:20})})]}),f.jsxs("div",{className:"p-4 space-y-4",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[t.verification_hash&&f.jsxs("span",{className:"px-2 py-1 bg-[var(--color-success,#4caf50)]/10 border border-[var(--color-success,#4caf50)]/30 text-[var(--color-success,#4caf50)] text-xs font-mono flex items-center gap-1",children:[f.jsx(us,{size:12}),"VERIFIED"]}),f.jsx("span",{className:"px-2 py-1 bg-[var(--color-primary,#00f3ff)]/10 border border-[var(--color-primary,#00f3ff)]/30 text-[var(--color-primary,#00f3ff)] text-xs font-mono",children:t.category})]}),t.description&&f.jsx("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70 text-sm font-mono",children:t.description}),f.jsxs("div",{className:"space-y-2 text-sm font-mono",children:[f.jsxs("div",{className:"flex items-start gap-2 text-[var(--color-textSecondary,#4caf50)]/70",children:[f.jsx(Ba,{size:14,className:"flex-shrink-0 mt-0.5"}),f.jsxs("span",{children:[t.location.address.line1,", ",t.location.address.postcode]})]}),t.contact?.phone&&f.jsxs("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70",children:["Phone: ",t.contact.phone]}),t.contact?.email&&f.jsxs("p",{className:"text-[var(--color-textSecondary,#4caf50)]/70",children:["Email: ",t.contact.email]}),t.contact?.website&&f.jsx("a",{href:t.contact.website,target:"_blank",rel:"noopener noreferrer",className:"text-[var(--color-primary,#00f3ff)] hover:underline block",children:t.contact.website})]}),f.jsxs("div",{className:"pt-4 border-t border-[var(--color-border,#4caf50)]/30 text-[var(--color-textSecondary,#4caf50)]/50 text-xs font-mono",children:[f.jsxs("p",{children:["CRN: ",t.crn]}),f.jsxs("p",{children:["Verification Hash: ",t.verification_hash?.slice(0,16),"..."]})]})]})]})})]})})};var zg=(n=>(n.INITIALIZING="INITIALIZING",n.NETWORK_MAP="NETWORK_MAP",n.COMMUNICATION="COMMUNICATION",n.CRYPTO_VERIFICATION="CRYPTO_VERIFICATION",n))(zg||{}),Jt=(n=>(n.OWNER="owner",n.ADMIN="admin",n.MODERATOR="moderator",n.MEMBER="member",n.PENDING="pending",n.BANNED="banned",n))(Jt||{}),Pm=(n=>(n.PENDING="pending",n.APPROVED="approved",n.REJECTED="rejected",n.EXPIRED="expired",n))(Pm||{});const vd={owner:{canPost:!0,canReply:!0,canInvite:!0,canKick:!0,canBan:!0,canMute:!0,canPinMessages:!0,canDeleteMessages:!0,canEditGroupInfo:!0,canManageRoles:!0,canApproveJoinRequests:!0,canManagePermissions:!0},admin:{canPost:!0,canReply:!0,canInvite:!0,canKick:!0,canBan:!0,canMute:!0,canPinMessages:!0,canDeleteMessages:!0,canEditGroupInfo:!0,canManageRoles:!1,canApproveJoinRequests:!0,canManagePermissions:!1},moderator:{canPost:!0,canReply:!0,canInvite:!0,canKick:!0,canBan:!1,canMute:!0,canPinMessages:!0,canDeleteMessages:!0,canEditGroupInfo:!1,canManageRoles:!1,canApproveJoinRequests:!0,canManagePermissions:!1},member:{canPost:!0,canReply:!0,canInvite:!1,canKick:!1,canBan:!1,canMute:!1,canPinMessages:!1,canDeleteMessages:!1,canEditGroupInfo:!1,canManageRoles:!1,canApproveJoinRequests:!1,canManagePermissions:!1},pending:{canPost:!1,canReply:!1,canInvite:!1,canKick:!1,canBan:!1,canMute:!1,canPinMessages:!1,canDeleteMessages:!1,canEditGroupInfo:!1,canManageRoles:!1,canApproveJoinRequests:!1,canManagePermissions:!1},banned:{canPost:!1,canReply:!1,canInvite:!1,canKick:!1,canBan:!1,canMute:!1,canPinMessages:!1,canDeleteMessages:!1,canEditGroupInfo:!1,canManageRoles:!1,canApproveJoinRequests:!1,canManagePermissions:!1}},tte={allowJoinRequests:!0,requireApproval:!0,maxMembers:1e3,messageRetentionDays:365,allowFileSharing:!0,maxFileSizeMb:100,allowVoiceCalls:!0,allowVideoCalls:!0,slowModeSeconds:0,antiSpamEnabled:!0,zkpRequired:!0,encryptionLevel:"enhanced",inviteLinkEnabled:!1};var ud=(n=>(n.ONLINE="online",n.AWAY="away",n.BUSY="busy",n.OFFLINE="offline",n.INVISIBLE="invisible",n))(ud||{});const nte={notificationsEnabled:!0,soundEnabled:!0,readReceiptsEnabled:!0,typingIndicatorsEnabled:!0,onlineStatusVisible:!0,lastSeenVisible:!0,profilePublic:!1,theme:"geodesic",fontSize:"medium",language:"en"},k9e=["","","","","","","","","",""];var Wl=(n=>(n.ALL="all",n.MESSAGES="messages",n.GROUPS="groups",n.USERS="users",n.FILES="files",n))(Wl||{});const Kj=({role:n})=>{switch(n){case Jt.OWNER:return f.jsx(bK,{size:12,className:"text-yellow-400"});case Jt.ADMIN:return f.jsx(ao,{size:12,className:"text-[#00f3ff]"});case Jt.MODERATOR:return f.jsx(jae,{size:12,className:"text-[#4caf50]"});default:return null}},L9e=({role:n})=>{const e={[Jt.OWNER]:"bg-yellow-500/20 text-yellow-400 border-yellow-500/40",[Jt.ADMIN]:"bg-[#00f3ff]/20 text-[#00f3ff] border-[#00f3ff]/40",[Jt.MODERATOR]:"bg-[#4caf50]/20 text-[#4caf50] border-[#4caf50]/40",[Jt.MEMBER]:"bg-white/10 text-white/60 border-white/20",[Jt.PENDING]:"bg-orange-500/20 text-orange-400 border-orange-500/40",[Jt.BANNED]:"bg-red-500/20 text-red-400 border-red-500/40"};return f.jsx("span",{className:`px-2 py-0.5 text-[7px] font-black uppercase tracking-widest border-[0.5px] ${e[n]}`,children:n})},D9e=({group:n,currentUserId:e,onApproveRequest:t,onRejectRequest:i,onKickMember:r,onBanMember:s,onChangeRole:o,onMuteMember:a,onUpdateSettings:l,onLeaveGroup:c,onClose:u})=>{const[h,p]=$.useState("members"),[m,y]=$.useState("");$.useState(null);const[b,w]=$.useState(null),v=n.members.find(F=>F.id===e),T=v?.permissions||vd[Jt.MEMBER],S=v?.role===Jt.OWNER,M=v?.role===Jt.ADMIN||S,P=v?.role===Jt.MODERATOR||M,R=n.members.filter(F=>F.displayName.toLowerCase().includes(m.toLowerCase())||F.peerId.toLowerCase().includes(m.toLowerCase())),O=n.pendingRequests.filter(F=>F.status===Pm.PENDING),B=[{id:"members",label:"MEMBERS",icon:As,count:n.memberCount},{id:"requests",label:"REQUESTS",icon:sh,count:O.length,requiresMod:!0},{id:"settings",label:"SETTINGS",icon:c7,requiresAdmin:!0},{id:"permissions",label:"ROLES",icon:ao,requiresOwner:!0}],N=(F,j)=>{o(F,j),w(null)},I=()=>{n.settings.inviteLink&&navigator.clipboard.writeText(n.settings.inviteLink)};return f.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-3 md:p-6 backdrop-blur-xl bg-black/85 animate-in fade-in duration-300",children:f.jsxs("div",{className:"w-full max-w-4xl h-[90vh] border-[0.5px] border-[#4caf50]/20 bg-[#0a1a0a]/95 flex flex-col overflow-hidden shadow-[0_0_100px_rgba(0,0,0,0.95)]",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-[#00f3ff]/50 to-transparent"}),f.jsxs("div",{className:"flex items-center justify-between p-6 border-b-[0.5px] border-[#4caf50]/20 shrink-0",children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("div",{className:"w-12 h-12 border-[0.5px] border-[#4caf50]/40 flex items-center justify-center bg-black/40",children:f.jsx(As,{size:20,className:"text-[#00f3ff]"})}),f.jsxs("div",{children:[f.jsx("h2",{className:"orbitron text-sm font-black text-[#00f3ff] tracking-widest uppercase",children:n.name}),f.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[f.jsxs("span",{className:"text-[7px] font-mono text-[#4caf50]/60 uppercase",children:[n.memberCount," Members"]}),n.isPrivate&&f.jsx(j0,{size:10,className:"text-[#4caf50]/40"}),n.zkpVerified&&f.jsx(f_,{size:10,className:"text-[#00f3ff]/60"})]})]})]}),f.jsx("button",{onClick:u,className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2 border-[0.5px] border-[#4caf50]/20 hover:border-[#00f3ff]/40",children:f.jsx(Ui,{size:18})})]}),f.jsx("div",{className:"flex border-b-[0.5px] border-[#4caf50]/20 shrink-0 overflow-x-auto scrollbar-hide",children:B.map(F=>F.requiresOwner&&!S||F.requiresAdmin&&!M||F.requiresMod&&!P?null:f.jsxs("button",{onClick:()=>p(F.id),className:`flex items-center gap-2 px-6 py-4 text-[8px] font-black uppercase tracking-widest transition-all border-b-2 whitespace-nowrap ${h===F.id?"border-[#00f3ff] text-[#00f3ff] bg-[#00f3ff]/5":"border-transparent text-[#4caf50]/60 hover:text-[#4caf50]"}`,children:[f.jsx(F.icon,{size:12}),F.label,F.count!==void 0&&F.count>0&&f.jsx("span",{className:"px-1.5 py-0.5 bg-[#00f3ff]/20 text-[#00f3ff] text-[6px] font-mono",children:F.count})]},F.id))}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-hide",children:[h==="members"&&f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"relative",children:[f.jsx(ja,{size:12,className:"absolute left-3 top-1/2 -translate-y-1/2 text-[#4caf50]/40"}),f.jsx("input",{type:"text",value:m,onChange:F=>y(F.target.value),placeholder:"Search members...",className:"w-full bg-black/40 border-[0.5px] border-[#4caf50]/20 pl-10 pr-4 py-3 text-[10px] outline-none focus:border-[#00f3ff]/40 text-[#00f3ff] font-mono uppercase"})]}),f.jsx("div",{className:"space-y-2",children:R.map(F=>f.jsxs("div",{className:`flex items-center justify-between p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20 hover:bg-black/40 transition-all group ${F.id===e?"border-[#00f3ff]/30":""}`,children:[f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"w-10 h-10 border-[0.5px] border-[#4caf50]/40 flex items-center justify-center bg-black/40 text-[#00f3ff] font-black text-[10px]",children:F.displayName.substring(0,2).toUpperCase()}),f.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 border-[0.5px] border-black ${F.isOnline?"bg-[#4caf50]":"bg-[#4caf50]/20"}`})]}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-wider",children:F.displayName}),f.jsx(Kj,{role:F.role}),F.id===e&&f.jsx("span",{className:"text-[6px] font-mono text-[#4caf50]/60",children:"(YOU)"})]}),f.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[f.jsx(L9e,{role:F.role}),F.statusMessage&&f.jsx("span",{className:"text-[7px] font-mono text-[#4caf50]/40 truncate max-w-[150px]",children:F.statusMessage})]})]})]}),F.id!==e&&P&&f.jsxs("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[T.canManageRoles&&F.role!==Jt.OWNER&&f.jsxs("div",{className:"relative",children:[f.jsx("button",{onClick:()=>w(b===F.id?null:F.id),className:"p-2 border-[0.5px] border-[#4caf50]/20 hover:border-[#00f3ff]/40 text-[#4caf50] hover:text-[#00f3ff] transition-all",children:f.jsx(ao,{size:12})}),b===F.id&&f.jsx("div",{className:"absolute right-0 top-full mt-1 z-50 bg-black border-[0.5px] border-[#4caf50]/40 shadow-xl",children:[Jt.ADMIN,Jt.MODERATOR,Jt.MEMBER].map(j=>f.jsx("button",{onClick:()=>N(F.id,j),className:`w-full px-4 py-2 text-[8px] font-black uppercase tracking-widest text-left hover:bg-[#00f3ff]/10 transition-all ${F.role===j?"text-[#00f3ff] bg-[#00f3ff]/5":"text-[#4caf50]"}`,children:j},j))})]}),T.canMute&&f.jsx("button",{onClick:()=>a(F.id),className:"p-2 border-[0.5px] border-[#4caf50]/20 hover:border-orange-500/40 text-[#4caf50] hover:text-orange-400 transition-all",children:F.isMuted?f.jsx(A0,{size:12}):f.jsx(dae,{size:12})}),T.canKick&&f.jsx("button",{onClick:()=>r(F.id),className:"p-2 border-[0.5px] border-[#4caf50]/20 hover:border-red-500/40 text-[#4caf50] hover:text-red-400 transition-all",children:f.jsx(NK,{size:12})}),T.canBan&&f.jsx("button",{onClick:()=>s(F.id),className:"p-2 border-[0.5px] border-red-500/20 hover:border-red-500/60 text-red-400/60 hover:text-red-400 transition-all",children:f.jsx(hae,{size:12})})]})]},F.id))})]}),h==="requests"&&T.canApproveJoinRequests&&f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("h3",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-widest",children:"Pending Requests"}),f.jsxs("span",{className:"text-[8px] font-mono text-[#4caf50]/60",children:[O.length," pending"]})]}),O.length===0?f.jsxs("div",{className:"text-center py-12",children:[f.jsx(sh,{size:32,className:"text-[#4caf50]/20 mx-auto mb-4"}),f.jsx("p",{className:"text-[10px] font-mono text-[#4caf50]/40 uppercase tracking-widest",children:"No pending requests"})]}):f.jsx("div",{className:"space-y-3",children:O.map(F=>f.jsxs("div",{className:"p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 border-[0.5px] border-orange-500/40 flex items-center justify-center bg-orange-500/10 text-orange-400 font-black text-[10px]",children:F.requesterName.substring(0,2).toUpperCase()}),f.jsxs("div",{children:[f.jsx("p",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-wider",children:F.requesterName}),f.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[f.jsx(z0,{size:10,className:"text-[#4caf50]/40"}),f.jsx("span",{className:"text-[7px] font-mono text-[#4caf50]/40",children:new Date(F.createdAt).toLocaleString()})]})]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>t(F.id),className:"p-2 border-[0.5px] border-[#4caf50]/40 hover:bg-[#4caf50]/20 text-[#4caf50] transition-all",children:f.jsx(f2,{size:14})}),f.jsx("button",{onClick:()=>i(F.id),className:"p-2 border-[0.5px] border-red-500/40 hover:bg-red-500/20 text-red-400 transition-all",children:f.jsx(Ui,{size:14})})]})]}),F.requestMessage&&f.jsx("div",{className:"mt-3 p-3 bg-black/40 border-l-[0.5px] border-[#4caf50]/40",children:f.jsxs("p",{className:"text-[9px] font-mono text-[#4caf50]/80 italic",children:['"',F.requestMessage,'"']})})]},F.id))})]}),h==="settings"&&M&&f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-widest border-b-[0.5px] border-[#4caf50]/20 pb-2",children:"Join Settings"}),[{key:"allowJoinRequests",label:"Allow Join Requests",desc:"Users can request to join this group"},{key:"requireApproval",label:"Require Approval",desc:"New members must be approved by admin/mod"}].map(F=>f.jsxs("div",{className:"flex items-center justify-between p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-[9px] font-black text-[#00f3ff] uppercase tracking-wider",children:F.label}),f.jsx("p",{className:"text-[7px] font-mono text-[#4caf50]/40 mt-1",children:F.desc})]}),f.jsx("button",{onClick:()=>l({[F.key]:!n.settings[F.key]}),className:`w-12 h-6 border-[0.5px] relative transition-all ${n.settings[F.key]?"border-[#00f3ff]/60 bg-[#00f3ff]/10":"border-[#4caf50]/20 bg-black/40"}`,children:f.jsx("div",{className:`absolute top-1 w-4 h-4 transition-all ${n.settings[F.key]?"left-7 bg-[#00f3ff] shadow-[0_0_8px_#00f3ff]":"left-1 bg-[#4caf50]/40"}`})})]},F.key))]}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-widest border-b-[0.5px] border-[#4caf50]/20 pb-2",children:"Security Settings"}),[{key:"zkpRequired",label:"ZKP Verification Required",desc:"All messages require zero-knowledge proofs"},{key:"antiSpamEnabled",label:"Anti-Spam Protection",desc:"Automatic detection and filtering of spam"}].map(F=>f.jsxs("div",{className:"flex items-center justify-between p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-[9px] font-black text-[#00f3ff] uppercase tracking-wider",children:F.label}),f.jsx("p",{className:"text-[7px] font-mono text-[#4caf50]/40 mt-1",children:F.desc})]}),f.jsx("button",{onClick:()=>l({[F.key]:!n.settings[F.key]}),className:`w-12 h-6 border-[0.5px] relative transition-all ${n.settings[F.key]?"border-[#00f3ff]/60 bg-[#00f3ff]/10":"border-[#4caf50]/20 bg-black/40"}`,children:f.jsx("div",{className:`absolute top-1 w-4 h-4 transition-all ${n.settings[F.key]?"left-7 bg-[#00f3ff] shadow-[0_0_8px_#00f3ff]":"left-1 bg-[#4caf50]/40"}`})})]},F.key)),f.jsxs("div",{className:"p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsx("p",{className:"text-[9px] font-black text-[#00f3ff] uppercase tracking-wider mb-2",children:"Encryption Level"}),f.jsx("div",{className:"flex gap-2",children:["standard","enhanced","paranoid"].map(F=>f.jsx("button",{onClick:()=>l({encryptionLevel:F}),className:`flex-1 py-3 text-[8px] font-black uppercase tracking-widest border-[0.5px] transition-all ${n.settings.encryptionLevel===F?"border-[#00f3ff]/60 bg-[#00f3ff]/20 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/60 hover:text-[#4caf50]"}`,children:F},F))})]})]}),n.settings.inviteLinkEnabled&&n.settings.inviteLink&&f.jsxs("div",{className:"p-4 border-[0.5px] border-[#00f3ff]/30 bg-[#00f3ff]/5",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsx("p",{className:"text-[9px] font-black text-[#00f3ff] uppercase tracking-wider",children:"Invite Link"}),f.jsx("button",{onClick:I,className:"text-[#4caf50] hover:text-[#00f3ff] transition-all",children:f.jsx(XP,{size:12})})]}),f.jsx("p",{className:"text-[8px] font-mono text-[#4caf50]/60 break-all",children:n.settings.inviteLink})]}),f.jsx("button",{onClick:c,className:"w-full py-4 border-[0.5px] border-red-500/40 text-red-400 text-[10px] font-black uppercase tracking-widest hover:bg-red-500/10 transition-all",children:"Leave Group"})]}),h==="permissions"&&S&&f.jsxs("div",{className:"space-y-6",children:[f.jsx("p",{className:"text-[9px] font-mono text-[#4caf50]/60",children:"Configure role permissions for this mesh group."}),[Jt.ADMIN,Jt.MODERATOR,Jt.MEMBER].map(F=>f.jsxs("div",{className:"border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsxs("div",{className:"flex items-center gap-3 p-4 border-b-[0.5px] border-[#4caf50]/10",children:[f.jsx(Kj,{role:F}),f.jsx("span",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-widest",children:F})]}),f.jsx("div",{className:"grid grid-cols-2 gap-2 p-4",children:Object.entries(vd[F]).map(([j,W])=>f.jsxs("div",{className:"flex items-center justify-between p-2 bg-black/20",children:[f.jsx("span",{className:"text-[7px] font-mono text-[#4caf50]/60 uppercase",children:j.replace(/can/g,"").replace(/([A-Z])/g," $1")}),f.jsx("div",{className:`w-2 h-2 ${W?"bg-[#4caf50]":"bg-red-400/40"}`})]},j))})]},F))]})]})]})})},O9e=({groups:n,onJoinRequest:e,onClose:t})=>{const[i,r]=$.useState(null),[s,o]=$.useState(""),[a,l]=$.useState(!1),[c,u]=$.useState("idle"),[h,p]=$.useState(""),m=n.filter(w=>w.name.toLowerCase().includes(h.toLowerCase())||w.description.toLowerCase().includes(h.toLowerCase())),y=async()=>{if(i){l(!0);try{await e(i,s||void 0),u("success"),setTimeout(()=>{t()},1500)}catch{u("error")}finally{l(!1)}}},b=n.find(w=>w.id===i);return f.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-3 md:p-6 backdrop-blur-xl bg-black/85 animate-in fade-in duration-300",children:f.jsxs("div",{className:"w-full max-w-lg border-[0.5px] border-[#4caf50]/20 bg-[#0a1a0a]/95 flex flex-col overflow-hidden shadow-[0_0_100px_rgba(0,0,0,0.95)] max-h-[90vh]",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-[#00f3ff]/50 to-transparent"}),f.jsxs("div",{className:"flex items-center justify-between p-6 border-b-[0.5px] border-[#4caf50]/20 shrink-0",children:[f.jsxs("div",{children:[f.jsx("h2",{className:"orbitron text-sm font-black text-[#00f3ff] tracking-widest uppercase",children:"Join Mesh Group"}),f.jsx("p",{className:"text-[7px] font-mono text-[#4caf50]/60 mt-1 uppercase tracking-wider",children:"Request access to a community"})]}),f.jsx("button",{onClick:t,className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2 border-[0.5px] border-[#4caf50]/20 hover:border-[#00f3ff]/40",children:f.jsx(Ui,{size:18})})]}),c==="success"?f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-12 gap-6",children:[f.jsx("div",{className:"w-20 h-20 border-[0.5px] border-[#4caf50] rounded-full flex items-center justify-center bg-[#4caf50]/10 animate-in zoom-in duration-500",children:f.jsx(us,{size:40,className:"text-[#4caf50]"})}),f.jsxs("div",{className:"text-center",children:[f.jsx("p",{className:"text-[12px] font-black text-[#00f3ff] uppercase tracking-widest mb-2",children:"Request Sent"}),f.jsx("p",{className:"text-[9px] font-mono text-[#4caf50]/60",children:"Awaiting approval from group admins"})]})]}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"p-6 border-b-[0.5px] border-[#4caf50]/20 shrink-0",children:f.jsxs("div",{className:"relative",children:[f.jsx(ja,{size:12,className:"absolute left-3 top-1/2 -translate-y-1/2 text-[#4caf50]/40"}),f.jsx("input",{type:"text",value:h,onChange:w=>p(w.target.value),placeholder:"Search groups...",className:"w-full bg-black/40 border-[0.5px] border-[#4caf50]/20 pl-10 pr-4 py-3 text-[10px] outline-none focus:border-[#00f3ff]/40 text-[#00f3ff] font-mono uppercase"})]})}),f.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-3 scrollbar-hide",children:m.length===0?f.jsxs("div",{className:"text-center py-12",children:[f.jsx(As,{size:32,className:"text-[#4caf50]/20 mx-auto mb-4"}),f.jsx("p",{className:"text-[10px] font-mono text-[#4caf50]/40 uppercase tracking-widest",children:"No groups found"})]}):m.map(w=>f.jsxs("button",{onClick:()=>r(w.id),className:`w-full p-4 border-[0.5px] text-left transition-all ${i===w.id?"border-[#00f3ff]/60 bg-[#00f3ff]/10":"border-[#4caf50]/20 bg-black/20 hover:border-[#4caf50]/40"}`,children:[f.jsxs("div",{className:"flex items-start justify-between",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 border-[0.5px] border-[#4caf50]/40 flex items-center justify-center bg-black/40 text-[#00f3ff] font-black text-[10px]",children:w.name.substring(0,2).toUpperCase()}),f.jsxs("div",{children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("p",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-wider",children:w.name}),w.isPrivate&&f.jsx(j0,{size:10,className:"text-[#4caf50]/60"}),w.zkpVerified&&f.jsx(ao,{size:10,className:"text-[#00f3ff]/60"})]}),f.jsxs("p",{className:"text-[7px] font-mono text-[#4caf50]/40 mt-1",children:[w.memberCount," members"]})]})]}),f.jsx("div",{className:`w-4 h-4 border-[0.5px] flex items-center justify-center ${i===w.id?"border-[#00f3ff] bg-[#00f3ff]":"border-[#4caf50]/40"}`,children:i===w.id&&f.jsx(us,{size:10,className:"text-black"})})]}),w.description&&f.jsx("p",{className:"text-[8px] font-mono text-[#4caf50]/60 mt-3 line-clamp-2",children:w.description}),w.requiresApproval&&f.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[f.jsx(ZP,{size:10,className:"text-orange-400/60"}),f.jsx("span",{className:"text-[7px] font-mono text-orange-400/60 uppercase",children:"Requires approval"})]})]},w.id))}),i&&b?.requiresApproval&&f.jsxs("div",{className:"p-6 border-t-[0.5px] border-[#4caf50]/20 shrink-0",children:[f.jsx("label",{className:"text-[8px] font-black text-[#4caf50] uppercase tracking-widest block mb-2",children:"Request Message (optional)"}),f.jsx("textarea",{value:s,onChange:w=>o(w.target.value),placeholder:"Introduce yourself to the admins...",rows:3,className:"w-full bg-black/40 border-[0.5px] border-[#4caf50]/20 p-4 text-[10px] outline-none focus:border-[#00f3ff]/40 text-[#00f3ff] font-mono resize-none"})]}),f.jsx("div",{className:"p-6 border-t-[0.5px] border-[#4caf50]/20 shrink-0",children:f.jsx("button",{onClick:y,disabled:!i||a,className:"w-full py-4 border-[0.5px] border-[#00f3ff]/50 text-[#00f3ff] font-black text-[10px] tracking-[0.5em] uppercase hover:bg-[#00f3ff]/10 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-3",children:a?f.jsxs(f.Fragment,{children:[f.jsx(xr,{size:14,className:"animate-spin"}),"SENDING REQUEST..."]}):f.jsxs(f.Fragment,{children:[f.jsx(ek,{size:14}),"SEND JOIN REQUEST"]})})})]})]})})},qj=({status:n,size:e=12})=>{const t={[ud.ONLINE]:"bg-[#4caf50] shadow-[0_0_8px_#4caf50]",[ud.AWAY]:"bg-yellow-400 shadow-[0_0_8px_#facc15]",[ud.BUSY]:"bg-red-400 shadow-[0_0_8px_#f87171]",[ud.OFFLINE]:"bg-[#4caf50]/20",[ud.INVISIBLE]:"bg-[#4caf50]/20 border-[0.5px] border-[#4caf50]/40"};return f.jsx("div",{className:`rounded-full ${t[n]}`,style:{width:e,height:e}})},B9e=({profile:n,isOwnProfile:e,onUpdateProfile:t,onUpdateSettings:i,onClose:r})=>{const[s,o]=$.useState(!1),[a,l]=$.useState(!1),[c,u]=$.useState(!1),[h,p]=$.useState(n.displayName),[m,y]=$.useState(n.bio||""),[b,w]=$.useState(n.statusMessage||""),[v,T]=$.useState("profile"),S=$.useRef(null),M=()=>{t({displayName:h}),o(!1)},P=()=>{t({bio:m}),l(!1)},R=()=>{t({statusMessage:b}),u(!1)},O=I=>{t({status:I})},B=()=>{e&&S.current&&S.current.click()},N=async I=>{const F=I.target.files?.[0];if(!F||!F.type.startsWith("image/"))return;const j=new FileReader;j.onload=W=>{const U=W.target?.result;t({avatarUrl:U})},j.readAsDataURL(F)};return f.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-3 md:p-6 backdrop-blur-xl bg-black/85 animate-in fade-in duration-300",children:f.jsxs("div",{className:"w-full max-w-lg border-[0.5px] border-[#4caf50]/20 bg-[#0a1a0a]/95 flex flex-col overflow-hidden shadow-[0_0_100px_rgba(0,0,0,0.95)] max-h-[90vh]",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-[#00f3ff]/50 to-transparent"}),f.jsxs("div",{className:"flex items-center justify-between p-6 border-b-[0.5px] border-[#4caf50]/20 shrink-0",children:[f.jsx("h2",{className:"orbitron text-sm font-black text-[#00f3ff] tracking-widest uppercase",children:"Operator Profile"}),f.jsx("button",{onClick:r,className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2 border-[0.5px] border-[#4caf50]/20 hover:border-[#00f3ff]/40",children:f.jsx(Ui,{size:18})})]}),e&&f.jsx("div",{className:"flex border-b-[0.5px] border-[#4caf50]/20 shrink-0",children:[{id:"profile",label:"PROFILE"},{id:"settings",label:"SETTINGS"}].map(I=>f.jsx("button",{onClick:()=>T(I.id),className:`flex-1 py-3 text-[9px] font-black uppercase tracking-widest transition-all border-b-2 ${v===I.id?"border-[#00f3ff] text-[#00f3ff] bg-[#00f3ff]/5":"border-transparent text-[#4caf50]/60 hover:text-[#4caf50]"}`,children:I.label},I.id))}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-hide",children:[v==="profile"&&f.jsxs("div",{className:"space-y-8",children:[f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsxs("div",{className:"relative mb-4",children:[f.jsx("div",{className:"w-24 h-24 border-[0.5px] border-[#4caf50]/40 flex items-center justify-center bg-black/40 text-[#00f3ff] font-black text-2xl overflow-hidden",children:n.avatarUrl||n.avatar?f.jsx("img",{src:n.avatarUrl||n.avatar,alt:"",className:"w-full h-full object-cover"}):n.displayName.substring(0,2).toUpperCase()}),f.jsx("div",{className:"absolute -bottom-1 -right-1",children:f.jsx(qj,{status:n.status,size:16})}),e&&f.jsxs(f.Fragment,{children:[f.jsx("input",{ref:S,type:"file",accept:"image/*",onChange:N,className:"hidden"}),f.jsx("button",{onClick:B,className:"absolute -bottom-2 -right-2 p-2 bg-black border-[0.5px] border-[#4caf50]/40 text-[#4caf50] hover:text-[#00f3ff] hover:border-[#00f3ff]/40 transition-all active:scale-95",children:f.jsx(yK,{size:12})})]})]}),f.jsxs("div",{className:"text-center w-full",children:[s?f.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[f.jsx("input",{type:"text",value:h,onChange:I=>p(I.target.value),className:"bg-black/40 border-[0.5px] border-[#00f3ff]/40 px-4 py-2 text-center text-[12px] font-black text-[#00f3ff] uppercase tracking-wider outline-none",autoFocus:!0}),f.jsx("button",{onClick:M,className:"p-2 text-[#4caf50] hover:text-[#00f3ff]",children:f.jsx(f2,{size:14})})]}):f.jsxs("div",{className:"flex items-center gap-2 justify-center",children:[f.jsx("h3",{className:"text-[14px] font-black text-[#00f3ff] uppercase tracking-widest",children:n.displayName}),n.isVerified&&f.jsx(f_,{size:14,className:"text-[#00f3ff]"}),e&&f.jsx("button",{onClick:()=>o(!0),className:"text-[#4caf50]/40 hover:text-[#00f3ff]",children:f.jsx(i4,{size:12})})]}),f.jsx("p",{className:"text-[8px] font-mono text-[#4caf50]/40 mt-1 truncate",children:n.peerId})]})]}),e&&f.jsxs("div",{className:"space-y-3",children:[f.jsx("label",{className:"text-[8px] font-black text-[#4caf50] uppercase tracking-widest",children:"Status"}),f.jsx("div",{className:"grid grid-cols-5 gap-2",children:Object.values(ud).map(I=>f.jsxs("button",{onClick:()=>O(I),className:`p-3 border-[0.5px] flex flex-col items-center gap-2 transition-all ${n.status===I?"border-[#00f3ff]/60 bg-[#00f3ff]/10":"border-[#4caf50]/20 hover:border-[#4caf50]/40"}`,children:[f.jsx(qj,{status:I}),f.jsx("span",{className:"text-[6px] font-mono text-[#4caf50]/60 uppercase",children:I})]},I))})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("label",{className:"text-[8px] font-black text-[#4caf50] uppercase tracking-widest",children:"Status Message"}),e&&!c&&f.jsx("button",{onClick:()=>u(!0),className:"text-[#4caf50]/40 hover:text-[#00f3ff]",children:f.jsx(i4,{size:10})})]}),c?f.jsxs("div",{className:"flex gap-2",children:[f.jsx("input",{type:"text",value:b,onChange:I=>w(I.target.value),placeholder:"What's on your mind?",className:"flex-1 bg-black/40 border-[0.5px] border-[#4caf50]/20 px-4 py-3 text-[10px] font-mono text-[#00f3ff] outline-none focus:border-[#00f3ff]/40"}),f.jsx("button",{onClick:R,className:"px-4 border-[0.5px] border-[#4caf50]/40 text-[#4caf50] hover:text-[#00f3ff] hover:border-[#00f3ff]/40",children:f.jsx(f2,{size:12})})]}):f.jsx("p",{className:"text-[10px] font-mono text-[#4caf50]/60 p-3 bg-black/20 border-[0.5px] border-[#4caf50]/10",children:n.statusMessage||(e?"No status message set":"No status")})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("label",{className:"text-[8px] font-black text-[#4caf50] uppercase tracking-widest",children:"Bio"}),e&&!a&&f.jsx("button",{onClick:()=>l(!0),className:"text-[#4caf50]/40 hover:text-[#00f3ff]",children:f.jsx(i4,{size:10})})]}),a?f.jsxs("div",{className:"space-y-2",children:[f.jsx("textarea",{value:m,onChange:I=>y(I.target.value),rows:3,className:"w-full bg-black/40 border-[0.5px] border-[#4caf50]/20 p-4 text-[10px] font-mono text-[#00f3ff] outline-none focus:border-[#00f3ff]/40 resize-none"}),f.jsx("button",{onClick:P,className:"w-full py-2 border-[0.5px] border-[#4caf50]/40 text-[#4caf50] text-[8px] font-black uppercase tracking-widest hover:bg-[#4caf50]/10",children:"Save"})]}):f.jsx("p",{className:"text-[10px] font-mono text-[#4caf50]/60 p-3 bg-black/20 border-[0.5px] border-[#4caf50]/10 min-h-[60px]",children:n.bio||(e?"Tell others about yourself...":"No bio")})]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("label",{className:"text-[8px] font-black text-[#4caf50] uppercase tracking-widest",children:"Info"}),f.jsxs("div",{className:"space-y-2 text-[9px] font-mono",children:[f.jsxs("div",{className:"flex justify-between p-3 bg-black/20 border-[0.5px] border-[#4caf50]/10",children:[f.jsx("span",{className:"text-[#4caf50]/40",children:"Member Since"}),f.jsx("span",{className:"text-[#00f3ff]",children:new Date(n.createdAt).toLocaleDateString()})]}),f.jsxs("div",{className:"flex justify-between p-3 bg-black/20 border-[0.5px] border-[#4caf50]/10",children:[f.jsx("span",{className:"text-[#4caf50]/40",children:"Last Seen"}),f.jsx("span",{className:"text-[#00f3ff]",children:new Date(n.lastSeenAt).toLocaleString()})]}),f.jsxs("div",{className:"flex justify-between p-3 bg-black/20 border-[0.5px] border-[#4caf50]/10",children:[f.jsx("span",{className:"text-[#4caf50]/40",children:"Verification"}),f.jsx("span",{className:n.isVerified?"text-[#4caf50]":"text-[#4caf50]/40",children:n.isVerified?"ZKP Verified":"Not Verified"})]})]})]})]}),v==="settings"&&e&&f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"space-y-3",children:[f.jsx("h3",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-widest border-b-[0.5px] border-[#4caf50]/20 pb-2",children:"Notifications"}),[{key:"notificationsEnabled",label:"Push Notifications",icon:A0},{key:"soundEnabled",label:"Sound Effects",icon:m_}].map(I=>f.jsxs("div",{className:"flex items-center justify-between p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(I.icon,{size:14,className:"text-[#4caf50]/60"}),f.jsx("span",{className:"text-[9px] font-black text-[#00f3ff] uppercase tracking-wider",children:I.label})]}),f.jsx("button",{onClick:()=>i({[I.key]:!n.settings[I.key]}),className:`w-12 h-6 border-[0.5px] relative transition-all ${n.settings[I.key]?"border-[#00f3ff]/60 bg-[#00f3ff]/10":"border-[#4caf50]/20 bg-black/40"}`,children:f.jsx("div",{className:`absolute top-1 w-4 h-4 transition-all ${n.settings[I.key]?"left-7 bg-[#00f3ff] shadow-[0_0_8px_#00f3ff]":"left-1 bg-[#4caf50]/40"}`})})]},I.key))]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx("h3",{className:"text-[10px] font-black text-[#00f3ff] uppercase tracking-widest border-b-[0.5px] border-[#4caf50]/20 pb-2",children:"Privacy"}),[{key:"readReceiptsEnabled",label:"Read Receipts",icon:Pd},{key:"typingIndicatorsEnabled",label:"Typing Indicators",icon:i4},{key:"onlineStatusVisible",label:"Show Online Status",icon:wK},{key:"lastSeenVisible",label:"Show Last Seen",icon:z0}].map(I=>f.jsxs("div",{className:"flex items-center justify-between p-4 border-[0.5px] border-[#4caf50]/20 bg-black/20",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(I.icon,{size:14,className:"text-[#4caf50]/60"}),f.jsx("span",{className:"text-[9px] font-black text-[#00f3ff] uppercase tracking-wider",children:I.label})]}),f.jsx("button",{onClick:()=>i({[I.key]:!n.settings[I.key]}),className:`w-12 h-6 border-[0.5px] relative transition-all ${n.settings[I.key]?"border-[#00f3ff]/60 bg-[#00f3ff]/10":"border-[#4caf50]/20 bg-black/40"}`,children:f.jsx("div",{className:`absolute top-1 w-4 h-4 transition-all ${n.settings[I.key]?"left-7 bg-[#00f3ff] shadow-[0_0_8px_#00f3ff]":"left-1 bg-[#4caf50]/40"}`})})]},I.key))]})]})]})]})})};function ite(n,e){let t;try{t=n()}catch{return}return{getItem:r=>{var s;const o=l=>l===null?null:JSON.parse(l,e?.reviver),a=(s=t.getItem(r))!=null?s:null;return a instanceof Promise?a.then(o):o(a)},setItem:(r,s)=>t.setItem(r,JSON.stringify(s,e?.replacer)),removeItem:r=>t.removeItem(r)}}const vN=n=>e=>{try{const t=n(e);return t instanceof Promise?t:{then(i){return vN(i)(t)},catch(i){return this}}}catch(t){return{then(i){return this},catch(i){return vN(i)(t)}}}},U9e=(n,e)=>(t,i,r)=>{let s={storage:ite(()=>localStorage),partialize:b=>b,version:0,merge:(b,w)=>({...w,...b}),...e},o=!1;const a=new Set,l=new Set;let c=s.storage;if(!c)return n((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${s.name}', the given storage is currently unavailable.`),t(...b)},i,r);const u=()=>{const b=s.partialize({...i()});return c.setItem(s.name,{state:b,version:s.version})},h=r.setState;r.setState=(b,w)=>(h(b,w),u());const p=n((...b)=>(t(...b),u()),i,r);r.getInitialState=()=>p;let m;const y=()=>{var b,w;if(!c)return;o=!1,a.forEach(T=>{var S;return T((S=i())!=null?S:p)});const v=((w=s.onRehydrateStorage)==null?void 0:w.call(s,(b=i())!=null?b:p))||void 0;return vN(c.getItem.bind(c))(s.name).then(T=>{if(T)if(typeof T.version=="number"&&T.version!==s.version){if(s.migrate){const S=s.migrate(T.state,T.version);return S instanceof Promise?S.then(M=>[!0,M]):[!0,S]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,T.state];return[!1,void 0]}).then(T=>{var S;const[M,P]=T;if(m=s.merge(P,(S=i())!=null?S:p),t(m,!0),M)return u()}).then(()=>{v?.(m,void 0),m=i(),o=!0,l.forEach(T=>T(m))}).catch(T=>{v?.(void 0,T)})};return r.persist={setOptions:b=>{s={...s,...b},b.storage&&(c=b.storage)},clearStorage:()=>{c?.removeItem(s.name)},getOptions:()=>s,rehydrate:()=>y(),hasHydrated:()=>o,onHydrate:b=>(a.add(b),()=>{a.delete(b)}),onFinishHydration:b=>(l.add(b),()=>{l.delete(b)})},s.skipHydration||y(),m||p},dD=U9e,yv={g3tzkp:{id:"g3tzkp",name:"G3ZKP",colors:{primary:"#00f3ff",secondary:"#4caf50",background:"#000000",surface:"#010401",text:"#00f3ff",textSecondary:"#4caf50",border:"#4caf50",error:"#ff0055",success:"#4caf50",warning:"#ffaa00"}},"manifold-blue":{id:"manifold-blue",name:"Manifold Blue",colors:{primary:"#1e90ff",secondary:"#00ced1",background:"#000428",surface:"rgba(30, 144, 255, 0.1)",text:"#1e90ff",textSecondary:"#00ced1",border:"#00ced1",error:"#ff0055",success:"#00ced1",warning:"#9370db"}},multivectoral:{id:"multivectoral",name:"MultiVectoral",colors:{primary:"#8a2be2",secondary:"#00bfff",background:"#0a0a12",surface:"rgba(138, 43, 226, 0.05)",text:"#00bfff",textSecondary:"#32cd32",border:"#8a2be2",error:"#ff4500",success:"#32cd32",warning:"#ff4500"}},"neon-pink":{id:"neon-pink",name:"Neon Pink",colors:{primary:"#ff00ff",secondary:"#ff69b4",background:"#0d0d0d",surface:"rgba(255, 0, 255, 0.05)",text:"#ff00ff",textSecondary:"#ff69b4",border:"#ff69b4",error:"#ff0000",success:"#00ff00",warning:"#ffff00"}},"phi-gold":{id:"phi-gold",name:"PHI GOLD",colors:{primary:"#ffd700",secondary:"#20b2aa",background:"#0a0808",surface:"rgba(255, 215, 0, 0.05)",text:"#ffd700",textSecondary:"#20b2aa",border:"#20b2aa",error:"#ff4444",success:"#20b2aa",warning:"#ff8c00"}}},fD=z_()(dD((n,e)=>({currentTheme:"g3tzkp",themes:yv,setTheme:t=>{yv[t]&&(n({currentTheme:t}),e().applyTheme(t))},getCurrentTheme:()=>{const t=e().currentTheme;return yv[t]||yv.g3tzkp},applyTheme:t=>{const i=t?yv[t]:e().getCurrentTheme();if(!i)return;const r=document.documentElement;Object.entries(i.colors).forEach(([l,c])=>{r.style.setProperty(`--color-${l}`,c)}),r.style.backgroundColor=i.colors.background,r.style.color=i.colors.text,document.body.style.backgroundColor=i.colors.background,document.body.style.color=i.colors.text;const s=document.getElementById("root");s&&(s.style.backgroundColor=i.colors.background,s.style.color=i.colors.text);const o=document.getElementById("g3tzkp-theme-dynamic");o&&o.remove();const a=document.createElement("style");a.id="g3tzkp-theme-dynamic",a.textContent=`
          :root {
            --color-primary: ${i.colors.primary} !important;
            --color-secondary: ${i.colors.secondary} !important;
            --color-background: ${i.colors.background} !important;
            --color-surface: ${i.colors.surface} !important;
            --color-text: ${i.colors.text} !important;
            --color-textSecondary: ${i.colors.textSecondary} !important;
            --color-border: ${i.colors.border} !important;
            --color-error: ${i.colors.error} !important;
            --color-success: ${i.colors.success} !important;
            --color-warning: ${i.colors.warning} !important;
          }
          
          body, #root {
            background-color: ${i.colors.background} !important;
            color: ${i.colors.text} !important;
          }
          
          .theme-primary { color: ${i.colors.primary} !important; }
          .theme-secondary { color: ${i.colors.secondary} !important; }
          .theme-bg { background-color: ${i.colors.background} !important; }
          .theme-surface { background-color: ${i.colors.surface} !important; }
          .theme-border { border-color: ${i.colors.border} !important; }
        `,document.head.appendChild(a),console.log(`[Theme] Applied theme: ${i.name}`,i.colors)}}),{name:"g3zkp-theme-storage"}));typeof window<"u"&&setTimeout(()=>{const n=fD.getState();n.currentTheme==="cyber-gold"?n.setTheme("phi-gold"):n.currentTheme==="tensor-blue"?n.setTheme("manifold-blue"):n.applyTheme()},0);const pD=({onClose:n,title:e,children:t})=>f.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center p-3 md:p-6 backdrop-blur-xl bg-black/85 animate-in fade-in duration-300",children:f.jsxs("div",{className:"w-full max-w-lg border-[0.5px] border-[#4caf50]/20 bg-[#0a1a0a]/95 p-6 md:p-10 relative overflow-hidden flex flex-col gap-6 shadow-[0_0_100px_rgba(0,0,0,0.95)] max-h-[95vh]",children:[f.jsx("div",{className:"absolute top-0 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-[#00f3ff]/50 to-transparent"}),f.jsxs("div",{className:"flex justify-between items-center border-b-[0.5px] border-[#4caf50]/10 pb-5 shrink-0",children:[f.jsxs("div",{className:"flex flex-col gap-1",children:[f.jsx("h3",{className:"orbitron text-[9px] md:text-sm font-black tracking-[0.2em] md:tracking-[0.4em] text-[#00f3ff] uppercase opacity-100",children:e}),f.jsx("span",{className:"text-[6px] text-[#4caf50] uppercase tracking-[0.3em] font-bold opacity-60",children:"G3ZKP_SECURE_MODAL"})]}),f.jsx("button",{onClick:n,className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2 bg-black/40 border-[0.5px] border-[#4caf50]/10 hover:border-[#00f3ff]/30 active:scale-90",children:f.jsx(Ui,{size:18,strokeWidth:1.5})})]}),f.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-hide py-3",children:t}),f.jsx("div",{className:"absolute top-2 left-2 w-3 h-3 border-t-[0.5px] border-l-[0.5px] border-[#00f3ff]/30"}),f.jsx("div",{className:"absolute bottom-2 right-2 w-3 h-3 border-b-[0.5px] border-r-[0.5px] border-[#00f3ff]/30"})]})}),Zj="g3zkp_mesh_group_settings",F9e=({onClose:n,onCreate:e})=>{const[t,i]=$.useState(()=>{const s=localStorage.getItem(Zj);if(s)try{return JSON.parse(s)}catch{}return{name:"G3ZKP_MESH_01",encryptionProtocol:"zkp",keyExchangeMode:"x3dh",membershipPolicy:"approval",memberCapacity:100,messageRetention:"30d",zkpVerificationLevel:"full",enableVoiceCalls:!0,enableVideoCalls:!0,enableFileSharing:!0}});$.useEffect(()=>{localStorage.setItem(Zj,JSON.stringify(t))},[t]);const r=()=>{e?.(t.name,t)};return f.jsx(pD,{title:"CREATE_MESH_GROUP",onClose:n,children:f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Group Name"}),f.jsx("input",{type:"text",value:t.name,onChange:s=>i(o=>({...o,name:s.target.value.toUpperCase().replace(/\s/g,"_")})),placeholder:"MESH_GROUP_NAME",className:"w-full bg-black/40 border-[0.5px] border-[#4caf50]/20 p-4 text-[12px] outline-none focus:border-[#00f3ff]/40 text-[#00f3ff] font-black tracking-widest uppercase transition-all"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Encryption Protocol (Primary: ZKP)"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"zkp",label:"ZKP_SNARK",desc:"Zero-Knowledge"},{value:"x3dh_aead",label:"X3DH+AEAD",desc:"Key Exchange"},{value:"hybrid",label:"HYBRID",desc:"ZKP + X3DH"}].map(s=>f.jsxs("button",{onClick:()=>i(o=>({...o,encryptionProtocol:s.value})),className:`p-3 border-[0.5px] text-center transition-all ${t.encryptionProtocol===s.value?"border-[#00f3ff] bg-[#00f3ff]/10 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/40"}`,children:[f.jsx("div",{className:"text-[9px] font-black uppercase",children:s.label}),f.jsx("div",{className:"text-[7px] opacity-60",children:s.desc})]},s.value))})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Key Exchange Mode"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"x3dh",label:"X3DH",desc:"Standard"},{value:"ecdh",label:"ECDH",desc:"Ephemeral"},{value:"kyber",label:"KYBER",desc:"Post-Quantum"}].map(s=>f.jsxs("button",{onClick:()=>i(o=>({...o,keyExchangeMode:s.value})),className:`p-3 border-[0.5px] text-center transition-all ${t.keyExchangeMode===s.value?"border-[#00f3ff] bg-[#00f3ff]/10 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/40"}`,children:[f.jsx("div",{className:"text-[9px] font-black uppercase",children:s.label}),f.jsx("div",{className:"text-[7px] opacity-60",children:s.desc})]},s.value))})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Membership Policy"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"open",label:"OPEN",desc:"Anyone can join"},{value:"invite",label:"INVITE",desc:"Invite only"},{value:"approval",label:"APPROVAL",desc:"Requires approval"}].map(s=>f.jsxs("button",{onClick:()=>i(o=>({...o,membershipPolicy:s.value})),className:`p-3 border-[0.5px] text-center transition-all ${t.membershipPolicy===s.value?"border-[#00f3ff] bg-[#00f3ff]/10 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/40"}`,children:[f.jsx("div",{className:"text-[9px] font-black uppercase",children:s.label}),f.jsx("div",{className:"text-[7px] opacity-60",children:s.desc})]},s.value))})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Member Capacity"}),f.jsx("span",{className:"text-[10px] font-mono text-[#00f3ff]",children:t.memberCapacity})]}),f.jsx("input",{type:"range",min:"2",max:"1000",value:t.memberCapacity,onChange:s=>i(o=>({...o,memberCapacity:parseInt(s.target.value)})),className:"w-full h-1 bg-[#4caf50]/20 appearance-none cursor-pointer [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:w-4 [&::-webkit-slider-thumb]:h-4 [&::-webkit-slider-thumb]:bg-[#00f3ff] [&::-webkit-slider-thumb]:cursor-pointer"})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Message Retention"}),f.jsx("div",{className:"grid grid-cols-5 gap-1",children:[{value:"24h",label:"24H"},{value:"7d",label:"7D"},{value:"30d",label:"30D"},{value:"forever",label:""},{value:"ephemeral",label:"EPH"}].map(s=>f.jsx("button",{onClick:()=>i(o=>({...o,messageRetention:s.value})),className:`py-2 border-[0.5px] text-[9px] font-black transition-all ${t.messageRetention===s.value?"border-[#00f3ff] bg-[#00f3ff]/10 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/60"}`,children:s.label},s.value))})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"ZKP Verification Level"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"none",label:"NONE",desc:"No proofs"},{value:"basic",label:"BASIC",desc:"Send proofs"},{value:"full",label:"FULL",desc:"+ Merkle proofs"}].map(s=>f.jsxs("button",{onClick:()=>i(o=>({...o,zkpVerificationLevel:s.value})),className:`p-3 border-[0.5px] text-center transition-all ${t.zkpVerificationLevel===s.value?"border-[#00f3ff] bg-[#00f3ff]/10 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/40"}`,children:[f.jsx("div",{className:"text-[9px] font-black uppercase",children:s.label}),f.jsx("div",{className:"text-[7px] opacity-60",children:s.desc})]},s.value))})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("label",{className:"text-[8px] uppercase tracking-widest text-[#4caf50] font-black",children:"Features"}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{key:"enableVoiceCalls",label:"Voice Calls",icon:CK},{key:"enableVideoCalls",label:"Video Calls",icon:tk},{key:"enableFileSharing",label:"File Sharing",icon:DR}].map(s=>f.jsxs("button",{onClick:()=>i(o=>({...o,[s.key]:!o[s.key]})),className:`p-3 border-[0.5px] flex flex-col items-center gap-2 transition-all ${t[s.key]?"border-[#00f3ff] bg-[#00f3ff]/10 text-[#00f3ff]":"border-[#4caf50]/20 text-[#4caf50]/40"}`,children:[f.jsx(s.icon,{size:16}),f.jsx("span",{className:"text-[7px] font-black uppercase",children:s.label})]},s.key))})]}),f.jsx("button",{onClick:r,disabled:!t.name.trim(),className:"w-full py-5 border-[0.5px] border-[#00f3ff]/50 text-[#00f3ff] font-black text-[11px] tracking-[0.4em] uppercase hover:bg-[#00f3ff]/10 transition-all active:scale-95 disabled:opacity-30 disabled:cursor-not-allowed",children:"CREATE_MESH_GROUP"})]})})},z9e=({status:n,onClose:e})=>{const[t,i]=$.useState("lifetime"),[r,s]=$.useState(!1),o=async()=>{s(!0);try{if(t==="trial"){const l=await(await fetch("/api/licenses/trial",{method:"POST",headers:{"Content-Type":"application/json"}})).json();l.success&&(localStorage.setItem("g3zkp_license",l.license),alert("Trial license activated! Valid for 7 days."),e())}else{const l=await(await fetch("/api/payments/create-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({priceId:"price_your_lifetime_price",successUrl:window.location.origin+"/#/success",cancelUrl:window.location.origin+"/#/pricing"})})).json();l.url&&(window.location.href=l.url)}}catch(a){console.error("Purchase error:",a),alert("Purchase failed. Please try again.")}finally{s(!1)}};return f.jsx(pD,{title:"G3ZKP_LICENSE_SYSTEM",onClose:e,children:f.jsxs("div",{className:"space-y-8",children:[n.valid&&f.jsxs("div",{className:"p-6 border-[0.5px] border-[#00f3ff]/30 bg-[#00f3ff]/5",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx(pK,{size:24,className:"text-[#00f3ff]"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-[10px] font-black text-[#00f3ff] tracking-[0.3em] uppercase",children:"LICENSE ACTIVE"}),f.jsx("p",{className:"text-[8px] text-[#4caf50]",children:"Device-bound cryptographic license"})]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex justify-between text-[8px] uppercase tracking-wider",children:[f.jsx("span",{className:"text-[#4caf50]/60",children:"PROOF CREDITS"}),f.jsxs("span",{className:"text-[#00f3ff] font-mono",children:[n.accumulatedValue.toFixed(1)," / 30.0"]})]}),f.jsx("div",{className:"h-[2px] w-full bg-black border-[0.5px] border-[#4caf50]/10 overflow-hidden",children:f.jsx("div",{className:"h-full bg-[#00f3ff] transition-all duration-1000",style:{width:`${n.accumulatedValue/30*100}%`}})})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsx("h3",{className:"text-[10px] font-black text-[#00f3ff] tracking-[0.3em] uppercase text-center",children:"SELECT LICENSE TYPE"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsx("button",{onClick:()=>i("trial"),className:`p-4 border-[0.5px] transition-all ${t==="trial"?"border-[#00f3ff] bg-[#00f3ff]/10":"border-[#4caf50]/20 hover:border-[#4caf50]/40"}`,children:f.jsxs("div",{className:"text-center space-y-2",children:[f.jsx("div",{className:"text-[12px] font-black text-[#4caf50]",children:"TRIAL"}),f.jsx("div",{className:"text-[16px] font-black text-[#00f3ff]",children:"FREE"}),f.jsx("div",{className:"text-[8px] text-[#4caf50]/60",children:"7 DAYS FULL ACCESS"}),f.jsxs("div",{className:"text-[7px] text-[#4caf50]/40",children:[" All features unlocked",f.jsx("br",{})," Device binding",f.jsx("br",{})," ZKP encryption"]})]})}),f.jsx("button",{onClick:()=>i("lifetime"),className:`p-4 border-[0.5px] transition-all ${t==="lifetime"?"border-[#00f3ff] bg-[#00f3ff]/10":"border-[#4caf50]/20 hover:border-[#4caf50]/40"}`,children:f.jsxs("div",{className:"text-center space-y-2",children:[f.jsx("div",{className:"text-[12px] font-black text-[#00f3ff]",children:"LIFETIME"}),f.jsx("div",{className:"text-[16px] font-black text-[#00f3ff]",children:"29.99"}),f.jsx("div",{className:"text-[8px] text-[#4caf50]/60",children:"PERMANENT ACCESS"}),f.jsxs("div",{className:"text-[7px] text-[#4caf50]/40",children:[" Unlimited usage",f.jsx("br",{})," All future updates",f.jsx("br",{})," Priority support"]})]})})]})]}),f.jsx("button",{onClick:o,disabled:r,className:"w-full py-4 border-[0.5px] border-[#00f3ff]/50 text-[#00f3ff] font-black text-[11px] tracking-[0.4em] uppercase hover:bg-[#00f3ff]/10 transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:r?"PROCESSING...":t==="trial"?"START FREE TRIAL":"PURCHASE LIFETIME LICENSE"}),f.jsx("div",{className:"p-4 border-[0.5px] border-[#4caf50]/20 bg-[#4caf50]/5",children:f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx(ao,{size:16,className:"text-[#4caf50] mt-0.5 flex-shrink-0"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-[8px] text-[#4caf50]/60 uppercase tracking-wider mb-1",children:"CRYPTOGRAPHIC SECURITY"}),f.jsx("p",{className:"text-[8px] text-[#00f3ff] font-mono",children:"All licenses are cryptographically bound to your device fingerprint. One license per device. Zero-knowledge verification ensures privacy."})]})]})})]})})},Yj="g3zkp_app_settings",j9e=({onClose:n})=>{const{setTheme:e,currentTheme:t}=fD(),[i,r]=$.useState(()=>{const a=localStorage.getItem(Yj);if(a)try{return JSON.parse(a)}catch{}return{theme:"g3tzkp",soundEnabled:!0,notificationsEnabled:!0,desktopNotifications:!1,autoLock:!1,lockTimeout:5,zkpVerification:"auto",networkMode:"auto",encryptionLevel:"maximum",messagePreview:!0}});$.useEffect(()=>{localStorage.setItem(Yj,JSON.stringify(i))},[i]);const s=({enabled:a,onChange:l})=>f.jsx("button",{onClick:l,className:`w-12 h-6 relative transition-all duration-300 ${a?"bg-gradient-to-r from-[#00f3ff]/30 to-[#4caf50]/30 border border-[#00f3ff]/50":"bg-black/60 border border-[#4caf50]/20"}`,children:f.jsx("div",{className:`absolute top-0.5 w-5 h-5 transition-all duration-300 ${a?"left-6 bg-[#00f3ff] shadow-[0_0_12px_#00f3ff]":"left-0.5 bg-[#4caf50]/40"}`})}),o={g3tzkp:"G3ZKP","manifold-blue":"MANIFOLD BLUE",multivectoral:"MULTIVECTORAL","neon-pink":"NEON PINK","phi-gold":"PHI GOLD"};return f.jsx(pD,{title:"SETTINGS",onClose:n,children:f.jsxs("div",{className:"space-y-6",children:[f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center gap-3 pb-2 border-b border-[#4caf50]/20",children:[f.jsx(_U,{size:14,className:"text-[#00f3ff]"}),f.jsx("span",{className:"text-xs font-bold text-[#00f3ff] tracking-widest uppercase",children:"Appearance"})]}),f.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2",children:Object.entries(o).map(([a,l])=>f.jsx("button",{onClick:()=>{r(c=>({...c,theme:a})),e(a)},className:`p-3 rounded-lg text-center transition-all duration-200 ${t===a?"bg-gradient-to-br from-[#00f3ff]/20 to-[#4caf50]/10 border-2 border-[#00f3ff] shadow-[0_0_20px_rgba(0,243,255,0.2)]":"bg-black/40 border border-[#4caf50]/20 hover:border-[#4caf50]/50 hover:bg-black/60"}`,children:f.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wide ${t===a?"text-[#00f3ff]":"text-[#4caf50]/70"}`,children:l})},a))})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center gap-3 pb-2 border-b border-[#4caf50]/20",children:[f.jsx(A0,{size:14,className:"text-[#00f3ff]"}),f.jsx("span",{className:"text-xs font-bold text-[#00f3ff] tracking-widest uppercase",children:"Notifications"})]}),f.jsx("div",{className:"space-y-3 px-1",children:[{key:"soundEnabled",label:"Sound",desc:"Notification sounds",icon:m_},{key:"notificationsEnabled",label:"In-App Alerts",desc:"Show notification toasts",icon:A0},{key:"desktopNotifications",label:"Desktop Alerts",desc:"System notifications",icon:_U},{key:"messagePreview",label:"Message Preview",desc:"Show message content",icon:QP}].map(a=>f.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-black/30 border border-[#4caf50]/10",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(a.icon,{size:16,className:"text-[#4caf50]/60"}),f.jsxs("div",{children:[f.jsx("span",{className:"text-[11px] text-[#00f3ff] font-semibold",children:a.label}),f.jsx("p",{className:"text-[9px] text-[#4caf50]/50",children:a.desc})]})]}),f.jsx(s,{enabled:i[a.key],onChange:()=>r(l=>({...l,[a.key]:!l[a.key]}))})]},a.key))})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center gap-3 pb-2 border-b border-[#4caf50]/20",children:[f.jsx(ao,{size:14,className:"text-[#00f3ff]"}),f.jsx("span",{className:"text-xs font-bold text-[#00f3ff] tracking-widest uppercase",children:"Security"})]}),f.jsxs("div",{className:"space-y-4 px-1",children:[f.jsx("div",{className:"py-3 px-4 rounded-none bg-[#00f3ff]/5 border border-[#00f3ff]/30",children:f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(ao,{size:20,className:"text-[#00f3ff]"}),f.jsxs("div",{children:[f.jsx("span",{className:"text-[11px] text-[#00f3ff] font-bold uppercase tracking-wider",children:"MAXIMUM ENCRYPTION"}),f.jsx("p",{className:"text-[9px] text-[#4caf50]/70 mt-1",children:"ZKP + X3DH + Double Ratchet + AEAD"}),f.jsx("p",{className:"text-[8px] text-[#00f3ff]/50 mt-0.5",children:"All security features permanently enabled at maximum level"})]})]})}),f.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-none bg-black/30 border border-[#4caf50]/20",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(j0,{size:16,className:"text-[#4caf50]/60"}),f.jsxs("div",{children:[f.jsx("span",{className:"text-[11px] text-[#00f3ff] font-semibold",children:"Auto-Lock"}),f.jsx("p",{className:"text-[9px] text-[#4caf50]/50",children:"Lock after inactivity"})]})]}),f.jsx(s,{enabled:i.autoLock,onChange:()=>r(a=>({...a,autoLock:!a.autoLock}))})]})]})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center gap-3 pb-2 border-b border-[#4caf50]/20",children:[f.jsx(Vm,{size:14,className:"text-[#00f3ff]"}),f.jsx("span",{className:"text-xs font-bold text-[#00f3ff] tracking-widest uppercase",children:"Network"})]}),f.jsxs("div",{className:"py-2 px-3 rounded-lg bg-black/30 border border-[#4caf50]/10",children:[f.jsx("div",{className:"flex items-center justify-between mb-3",children:f.jsxs("div",{children:[f.jsx("span",{className:"text-[11px] text-[#00f3ff] font-semibold",children:"Network Mode"}),f.jsx("p",{className:"text-[9px] text-[#4caf50]/50",children:"Bandwidth optimization"})]})}),f.jsx("div",{className:"grid grid-cols-3 gap-2",children:[{value:"auto",label:"Auto"},{value:"low-bandwidth",label:"Low BW"},{value:"high-performance",label:"High Perf"}].map(a=>f.jsx("button",{onClick:()=>r(l=>({...l,networkMode:a.value})),className:`py-2 rounded-md text-[9px] uppercase font-bold transition-all ${i.networkMode===a.value?"bg-[#00f3ff]/20 text-[#00f3ff] border border-[#00f3ff]/50":"bg-black/40 text-[#4caf50]/60 border border-[#4caf50]/20 hover:border-[#4caf50]/40"}`,children:a.label},a.value))})]})]}),f.jsx("div",{className:"pt-4 border-t border-[#4caf50]/20 text-center",children:f.jsx("p",{className:"text-[9px] uppercase font-mono text-[#4caf50]/40 tracking-wide",children:"G3ZKP_MESSENGER v1.0 | Settings auto-saved"})})]})})},V9e=[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun2.l.google.com:19302"},{urls:"stun:stun3.l.google.com:19302"},{urls:"stun:stun4.l.google.com:19302"}];class H9e{constructor(){E(this,"socket",null);E(this,"localPeerId","");E(this,"localPeerName","");E(this,"currentCall",null);E(this,"peerConnections",new Map);E(this,"pendingIceCandidates",new Map);E(this,"callStateHandlers",new Set);E(this,"incomingCallHandlers",new Set);E(this,"incomingOffer",null);E(this,"isInitialized",!1);E(this,"cleanupListeners",null)}initialize(e,t,i){return this.isInitialized&&this.socket===e?(console.log("[WebRTC] Already initialized, skipping duplicate setup"),this.cleanupListeners||(()=>{})):(this.cleanupListeners&&this.cleanupListeners(),this.socket=e,this.localPeerId=t,this.localPeerName=i,this.cleanupListeners=this.setupSocketListeners(),this.isInitialized=!0,console.log("[WebRTC] Service initialized for peer:",t),this.cleanupListeners)}setupSocketListeners(){if(!this.socket)return()=>{};const e=this.socket,t=c=>{console.log("[WebRTC] Incoming call from",c.fromPeerName),this.incomingOffer=c.offer,this.incomingCallHandlers.forEach(u=>u(c.callId,c.callType,c.fromPeerId,c.fromPeerName))},i=c=>{console.log("[WebRTC] Call ringing:",c.callId),this.currentCall&&this.currentCall.callId===c.callId&&(this.currentCall.status="ringing",this.notifyStateChange())},r=async c=>{console.log("[WebRTC] Call accepted by",c.fromPeerName);const u=this.peerConnections.get(c.fromPeerId);if(u&&c.answer)try{await u.setRemoteDescription(new RTCSessionDescription(c.answer)),console.log("[WebRTC] Remote description set");const h=this.pendingIceCandidates.get(c.fromPeerId)||[];for(const p of h)await u.addIceCandidate(new RTCIceCandidate(p));this.pendingIceCandidates.delete(c.fromPeerId)}catch(h){console.error("[WebRTC] Error setting remote description:",h)}},s=c=>{console.log("[WebRTC] Call rejected:",c.reason),this.endCall(),this.currentCall&&(this.currentCall.status="ended",this.currentCall.error=c.reason,this.notifyStateChange())},o=c=>{console.log("[WebRTC] Call ended by remote peer"),this.endCall()},a=c=>{console.error("[WebRTC] Call error:",c.error),this.currentCall&&(this.currentCall.status="error",this.currentCall.error=c.error,this.notifyStateChange())},l=async c=>{console.log("[WebRTC] Received ICE candidate from",c.fromPeerId);const u=this.peerConnections.get(c.fromPeerId);if(u&&u.remoteDescription)try{await u.addIceCandidate(new RTCIceCandidate(c.candidate))}catch(h){console.error("[WebRTC] Error adding ICE candidate:",h)}else this.pendingIceCandidates.has(c.fromPeerId)||this.pendingIceCandidates.set(c.fromPeerId,[]),this.pendingIceCandidates.get(c.fromPeerId).push(c.candidate)};return e.on("call_incoming",t),e.on("call_ringing",i),e.on("call_accepted",r),e.on("call_rejected",s),e.on("call_ended",o),e.on("call_error",a),e.on("ice_candidate",l),()=>{e.off("call_incoming",t),e.off("call_ringing",i),e.off("call_accepted",r),e.off("call_rejected",s),e.off("call_ended",o),e.off("call_error",a),e.off("ice_candidate",l),this.isInitialized=!1,this.cleanupListeners=null,console.log("[WebRTC] Socket listeners cleaned up")}}async initiateCall(e,t,i){if(!this.socket)throw new Error("WebRTC service not initialized");const r=`call_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;this.currentCall={callId:r,callType:i,status:"initiating",participants:[{peerId:e,peerName:t}],localStream:null};try{const s=await this.getLocalStream(i);this.currentCall.localStream=s;const o=this.createPeerConnection(e,s);this.peerConnections.set(e,o);const a=await o.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:i==="video"});return await o.setLocalDescription(a),this.socket.emit("call_initiate",{callId:r,callType:i,targetPeerId:e,offer:o.localDescription}),this.notifyStateChange(),this.currentCall}catch(s){throw this.currentCall.status="error",this.currentCall.error=s instanceof Error?s.message:"Failed to initiate call",this.notifyStateChange(),s}}async acceptCall(e,t,i){if(!this.socket||!this.incomingOffer)throw new Error("No incoming call to accept");this.currentCall={callId:e,callType:i,status:"connecting",participants:[{peerId:t,peerName:"Remote Peer"}],localStream:null};try{const r=await this.getLocalStream(i);this.currentCall.localStream=r;const s=this.createPeerConnection(t,r);this.peerConnections.set(t,s),await s.setRemoteDescription(new RTCSessionDescription(this.incomingOffer));const o=this.pendingIceCandidates.get(t)||[];for(const l of o)await s.addIceCandidate(new RTCIceCandidate(l));this.pendingIceCandidates.delete(t);const a=await s.createAnswer();return await s.setLocalDescription(a),this.socket.emit("call_accept",{callId:e,targetPeerId:t,answer:s.localDescription}),this.incomingOffer=null,this.notifyStateChange(),this.currentCall}catch(r){throw this.currentCall.status="error",this.currentCall.error=r instanceof Error?r.message:"Failed to accept call",this.notifyStateChange(),r}}rejectCall(e,t,i="User declined"){this.socket&&this.socket.emit("call_reject",{callId:e,targetPeerId:t,reason:i}),this.incomingOffer=null}endCall(){this.currentCall&&this.socket&&this.currentCall.participants.forEach(e=>{this.socket.emit("call_end",{callId:this.currentCall.callId,targetPeerId:e.peerId})}),this.peerConnections.forEach((e,t)=>{e.close()}),this.peerConnections.clear(),this.currentCall?.localStream&&this.currentCall.localStream.getTracks().forEach(e=>e.stop()),this.currentCall&&(this.currentCall.status="ended",this.notifyStateChange()),this.currentCall=null,this.incomingOffer=null}async addParticipant(e,t){if(!this.currentCall||!this.socket||!this.currentCall.localStream)throw new Error("No active call");const i=this.createPeerConnection(e,this.currentCall.localStream);this.peerConnections.set(e,i);const r=await i.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:this.currentCall.callType==="video"});await i.setLocalDescription(r),this.socket.emit("call_initiate",{callId:this.currentCall.callId,callType:this.currentCall.callType,targetPeerId:e,offer:i.localDescription}),this.currentCall.participants.push({peerId:e,peerName:t,connection:i}),this.notifyStateChange()}async getLocalStream(e){const t={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:e==="video"?{width:{ideal:1280},height:{ideal:720},facingMode:"user",frameRate:{ideal:30}}:!1};return navigator.mediaDevices.getUserMedia(t)}createPeerConnection(e,t){const i=new RTCPeerConnection({iceServers:V9e,iceCandidatePoolSize:10});return t.getTracks().forEach(r=>{i.addTrack(r,t)}),i.onicecandidate=r=>{r.candidate&&this.socket&&this.currentCall&&this.socket.emit("ice_candidate",{callId:this.currentCall.callId,targetPeerId:e,candidate:r.candidate.toJSON()})},i.ontrack=r=>{if(console.log("[WebRTC] Received remote track"),this.currentCall){const s=this.currentCall.participants.find(o=>o.peerId===e);s&&r.streams[0]&&(s.stream=r.streams[0],this.notifyStateChange())}},i.oniceconnectionstatechange=()=>{console.log("[WebRTC] ICE connection state:",i.iceConnectionState),this.currentCall&&(i.iceConnectionState==="connected"||i.iceConnectionState==="completed"?(this.currentCall.status="connected",this.notifyStateChange()):(i.iceConnectionState==="failed"||i.iceConnectionState==="disconnected")&&(this.currentCall.status="error",this.currentCall.error="Connection lost",this.notifyStateChange()))},i.onconnectionstatechange=()=>{console.log("[WebRTC] Connection state:",i.connectionState)},i}toggleMute(){if(this.currentCall?.localStream){const e=this.currentCall.localStream.getAudioTracks();return e.forEach(t=>{t.enabled=!t.enabled}),!e[0]?.enabled}return!1}toggleVideo(){if(this.currentCall?.localStream){const e=this.currentCall.localStream.getVideoTracks();return e.forEach(t=>{t.enabled=!t.enabled}),!e[0]?.enabled}return!1}async flipCamera(){if(!this.currentCall?.localStream||this.currentCall.callType!=="video")return;const e=this.currentCall.localStream.getVideoTracks()[0];if(!e)return;const i=e.getSettings().facingMode==="user"?"environment":"user";try{const s=(await navigator.mediaDevices.getUserMedia({video:{facingMode:i}})).getVideoTracks()[0];this.peerConnections.forEach(c=>{const u=c.getSenders().find(h=>h.track?.kind==="video");u&&u.replaceTrack(s)}),e.stop();const a=this.currentCall.localStream.getAudioTracks(),l=new MediaStream([...a,s]);this.currentCall.localStream=l,this.notifyStateChange()}catch(r){console.error("[WebRTC] Failed to flip camera:",r)}}getCurrentCall(){return this.currentCall}onCallStateChange(e){return this.callStateHandlers.add(e),()=>this.callStateHandlers.delete(e)}onIncomingCall(e){return this.incomingCallHandlers.add(e),()=>this.incomingCallHandlers.delete(e)}notifyStateChange(){if(this.currentCall){const e={...this.currentCall};this.callStateHandlers.forEach(t=>t(e))}}disconnect(){this.endCall(),this.callStateHandlers.clear(),this.incomingCallHandlers.clear()}}const Uh=new H9e,Xj=({type:n,onClose:e,contactName:t="Unknown",contactAvatar:i,targetPeerId:r})=>{const[s,o]=$.useState({status:"idle",localStream:null,remoteStream:null,peerConnection:null}),[a,l]=$.useState(0),[c,u]=$.useState(!1),[h,p]=$.useState(!1),[m,y]=$.useState(!0),[b,w]=$.useState(!0),[v,T]=$.useState({x:16,y:16});$.useState(!1);const[S,M]=$.useState(!1),[P,R]=$.useState([]),O=$.useRef(null),B=$.useRef(null),N=$.useRef(null);$.useEffect(()=>{O.current&&s.localStream&&(O.current.srcObject=s.localStream)},[s.localStream]),$.useEffect(()=>{B.current&&s.remoteStream&&(B.current.srcObject=s.remoteStream)},[s.remoteStream]);const I=$.useRef(null),F=$.useRef(null),j=$.useCallback(async()=>{try{o(de=>({...de,status:"connecting"})),console.log("[FaceTimeCall] Initializing WebRTC for",n,"call to",r);const Pe=gl.getSocket();if(Pe){const de=Uh.initialize(Pe,gl.getLocalPeerId(),gl.getLocalPeerName());I.current=de}const Ce=Uh.onCallStateChange(de=>{console.log("[FaceTimeCall] Call state changed:",de.status);const Ne=de.participants[0]?.stream||null;o(et=>({...et,status:de.status==="initiating"?"connecting":de.status,localStream:de.localStream,remoteStream:Ne})),de.participants.length>0&&R(de.participants.map(et=>({peerId:et.peerId,peerName:et.peerName})))});if(F.current=Ce,r)await Uh.initiateCall(r,t,n);else{const de={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:n==="video"?{width:{ideal:1280},height:{ideal:720},facingMode:"user",frameRate:{ideal:30}}:!1},Ne=await navigator.mediaDevices.getUserMedia(de);o(et=>({...et,localStream:Ne,status:"ringing"}))}}catch(Pe){console.error("[FaceTimeCall] WebRTC initialization failed:",Pe),o(Ce=>({...Ce,status:"error"}))}},[n,r,t]);$.useEffect(()=>(j(),()=>{console.log("[FaceTimeCall] Cleaning up WebRTC"),Uh.endCall(),F.current&&(F.current(),F.current=null),I.current&&(I.current(),I.current=null)}),[j]),$.useEffect(()=>{if(s.status==="connected"){const Pe=setInterval(()=>l(Ce=>Ce+1),1e3);return()=>clearInterval(Pe)}},[s.status]);const W=()=>{const Pe=Uh.toggleMute();u(Pe)},U=()=>{if(n==="video"){const Pe=Uh.toggleVideo();p(Pe)}},H=()=>{y(!m)},q=async()=>{if(n==="video")try{await Uh.flipCamera()}catch(Pe){console.error("[FaceTimeCall] Failed to flip camera:",Pe)}},J=()=>{Uh.endCall(),e()},G=async(Pe,Ce)=>{try{await Uh.addParticipant(Pe,Ce),M(!1),console.log("[FaceTimeCall] Added participant:",Ce)}catch(de){console.error("[FaceTimeCall] Failed to add participant:",de)}},ee=Pe=>{const Ce=Math.floor(Pe/3600),de=Math.floor(Pe%3600/60),Ne=Pe%60;return Ce>0?`${Ce}:${de.toString().padStart(2,"0")}:${Ne.toString().padStart(2,"0")}`:`${de}:${Ne.toString().padStart(2,"0")}`},Q=()=>{switch(s.status){case"idle":return"Initializing...";case"connecting":return"Connecting...";case"ringing":return"Ringing...";case"connected":return ee(a);case"error":return"Call Failed"}},ne=s.status==="connected",fe=s.status==="connecting"||s.status==="ringing",Ae=()=>{n==="video"&&ne&&(w(Pe=>!Pe),N.current&&clearTimeout(N.current),b||(N.current=setTimeout(()=>{w(!1)},4e3)))};return f.jsxs("div",{className:"fixed inset-0 z-[400] bg-black flex flex-col",onClick:Ae,children:[n==="video"?f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-gray-900 to-black",children:s.remoteStream?f.jsx("video",{ref:B,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}):s.localStream&&!h?f.jsx("video",{ref:O,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover scale-x-[-1]"}):f.jsx("div",{className:"w-full h-full flex items-center justify-center",children:f.jsx("div",{className:"w-32 h-32 rounded-full bg-gradient-to-br from-gray-600 to-gray-800 flex items-center justify-center text-white text-4xl font-semibold",children:t.charAt(0).toUpperCase()})})}),s.localStream&&!h&&s.remoteStream&&f.jsx("div",{className:"absolute w-28 h-40 sm:w-32 sm:h-44 rounded-2xl overflow-hidden shadow-2xl border-2 border-white/20 cursor-move z-50",style:{top:v.y,right:v.x,transform:"scaleX(-1)"},children:f.jsx("video",{ref:O,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"})}),f.jsx("div",{className:`absolute top-0 left-0 right-0 px-6 py-4 bg-gradient-to-b from-black/70 to-transparent transition-opacity duration-300 ${b?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:Pe=>Pe.stopPropagation(),children:f.jsxs("div",{className:"flex items-center justify-between pt-12 sm:pt-4",children:[f.jsx("button",{onClick:J,className:"p-2 rounded-full hover:bg-white/10 transition-all",children:f.jsx(Hm,{size:28,className:"text-white"})}),f.jsxs("div",{className:"text-center",children:[f.jsx("h2",{className:"text-white text-lg font-semibold",children:t}),f.jsx("p",{className:"text-white/70 text-sm",children:ne?"FaceTime Video":Q()})]}),f.jsx("div",{className:"w-10"})]})}),f.jsxs("div",{className:`absolute bottom-0 left-0 right-0 px-6 py-8 bg-gradient-to-t from-black/80 to-transparent transition-opacity duration-300 ${b?"opacity-100":"opacity-0 pointer-events-none"}`,onClick:Pe=>Pe.stopPropagation(),children:[f.jsxs("div",{className:"flex items-center justify-center gap-4 pb-8 sm:pb-4",children:[f.jsx("button",{onClick:q,className:"w-14 h-14 rounded-full bg-white/20 backdrop-blur-lg flex items-center justify-center hover:bg-white/30 transition-all",children:f.jsx(l7,{size:24,className:"text-white"})}),f.jsx("button",{onClick:W,className:`w-14 h-14 rounded-full backdrop-blur-lg flex items-center justify-center transition-all ${c?"bg-white text-black":"bg-white/20 text-white hover:bg-white/30"}`,children:c?f.jsx(bU,{size:24}):f.jsx(p2,{size:24})}),f.jsx("button",{onClick:J,className:"w-16 h-16 rounded-full bg-red-500 flex items-center justify-center hover:bg-red-600 transition-all shadow-lg",children:f.jsx(SU,{size:28,className:"text-white rotate-[135deg]"})}),f.jsx("button",{onClick:U,className:`w-14 h-14 rounded-full backdrop-blur-lg flex items-center justify-center transition-all ${h?"bg-white text-black":"bg-white/20 text-white hover:bg-white/30"}`,children:h?f.jsx($ae,{size:24}):f.jsx(tk,{size:24})}),f.jsx("button",{onClick:()=>console.log("[FaceTimeCall] Effects feature coming soon"),className:"w-14 h-14 rounded-full bg-white/20 backdrop-blur-lg flex items-center justify-center hover:bg-white/30 transition-all",title:"Effects (coming soon)",children:f.jsx(u7,{size:24,className:"text-white"})})]}),ne&&f.jsx("p",{className:"text-center text-white/60 text-sm",children:ee(a)})]})]}):f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-gray-800 via-gray-900 to-black"}),f.jsx("div",{className:`absolute top-0 left-0 right-0 px-6 py-4 transition-opacity duration-300 ${b?"opacity-100":"opacity-0 pointer-events-none"}`,children:f.jsxs("div",{className:"flex items-center justify-between pt-12 sm:pt-4",children:[f.jsx("button",{onClick:J,className:"p-2 rounded-full hover:bg-white/10 transition-all",children:f.jsx(Ui,{size:24,className:"text-white"})}),f.jsx("div",{className:"w-10"}),f.jsx("button",{onClick:()=>M(!0),className:"p-2 rounded-full hover:bg-white/10 transition-all",title:"Show participants",children:f.jsx(As,{size:24,className:"text-white"})})]})}),f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center px-6 relative z-10",children:[f.jsxs("div",{className:"relative mb-8",children:[i?f.jsx("img",{src:i,alt:t,className:"w-32 h-32 sm:w-40 sm:h-40 rounded-full object-cover"}):f.jsx("div",{className:"w-32 h-32 sm:w-40 sm:h-40 rounded-full bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center",children:f.jsx("span",{className:"text-white text-5xl sm:text-6xl font-semibold",children:t.charAt(0).toUpperCase()})}),fe&&f.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-green-400 animate-ping opacity-50"})]}),f.jsx("h2",{className:"text-white text-2xl sm:text-3xl font-semibold mb-2",children:t}),f.jsx("p",{className:`text-lg ${ne?"text-green-400":"text-white/60"}`,children:ne?"FaceTime Audio":Q()}),ne&&f.jsx("p",{className:"text-white text-xl font-light mt-2",children:ee(a)})]}),f.jsxs("div",{className:"px-6 pb-12 sm:pb-8 relative z-10",children:[f.jsxs("div",{className:"flex items-center justify-center gap-6",children:[f.jsx("button",{onClick:W,className:`w-16 h-16 rounded-full flex flex-col items-center justify-center transition-all ${c?"bg-white":"bg-white/20 backdrop-blur-lg"}`,children:c?f.jsx(bU,{size:28,className:"text-black"}):f.jsx(p2,{size:28,className:"text-white"})}),f.jsx("button",{onClick:J,className:"w-20 h-20 rounded-full bg-red-500 flex items-center justify-center hover:bg-red-600 transition-all shadow-lg",children:f.jsx(SU,{size:32,className:"text-white rotate-[135deg]"})}),f.jsx("button",{onClick:H,className:`w-16 h-16 rounded-full flex flex-col items-center justify-center transition-all ${m?"bg-white/20 backdrop-blur-lg":"bg-white"}`,children:m?f.jsx(m_,{size:28,className:"text-white"}):f.jsx(PK,{size:28,className:"text-black"})})]}),f.jsxs("div",{className:"flex items-center justify-center gap-12 mt-8",children:[f.jsxs("button",{onClick:()=>console.log("[FaceTimeCall] Keypad feature - DTMF tones"),className:"flex flex-col items-center gap-1 hover:opacity-80 transition-opacity",title:"Keypad for DTMF tones",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-colors",children:f.jsx(SK,{size:20,className:"text-white"})}),f.jsx("span",{className:"text-white/60 text-xs",children:"Keypad"})]}),f.jsxs("button",{onClick:J,className:"flex flex-col items-center gap-1 hover:opacity-80 transition-opacity",title:"Send message and end call",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-colors",children:f.jsx(Pd,{size:20,className:"text-white"})}),f.jsx("span",{className:"text-white/60 text-xs",children:"Message"})]}),f.jsxs("button",{onClick:()=>M(!0),className:"flex flex-col items-center gap-1",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-colors",children:f.jsx(sh,{size:20,className:"text-white"})}),f.jsx("span",{className:"text-white/60 text-xs",children:"Add"})]})]}),P.length>0&&f.jsx("div",{className:"mt-4 text-center",children:f.jsxs("p",{className:"text-white/60 text-xs",children:[P.length+1," participant",P.length>0?"s":""]})})]})]}),S&&f.jsx($9e,{onClose:()=>M(!1),onAddParticipant:G})]})},$9e=({onClose:n,onAddParticipant:e})=>{const[t,i]=$.useState([]);return $.useEffect(()=>{const r=gl.getConnectedPeers();i(r.map(s=>({peerId:s.id,peerName:s.name})))},[]),f.jsx("div",{className:"absolute inset-0 z-[450] bg-black/80 backdrop-blur-sm flex items-end sm:items-center justify-center",children:f.jsxs("div",{className:"w-full max-w-md bg-gray-900 rounded-t-3xl sm:rounded-3xl p-6 animate-slide-up",children:[f.jsxs("div",{className:"flex items-center justify-between mb-6",children:[f.jsx("h3",{className:"text-white text-xl font-semibold",children:"Add to Call"}),f.jsx("button",{onClick:n,className:"p-2 rounded-full hover:bg-white/10 transition-colors",children:f.jsx(Ui,{size:24,className:"text-white"})})]}),t.length===0?f.jsxs("div",{className:"py-12 text-center",children:[f.jsx(As,{size:48,className:"text-white/20 mx-auto mb-4"}),f.jsx("p",{className:"text-white/60",children:"No peers available"}),f.jsx("p",{className:"text-white/40 text-sm mt-2",children:"Connect with peers in the Mesh to add them to calls"})]}):f.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:t.map(r=>f.jsxs("button",{onClick:()=>e(r.peerId,r.peerName),className:"w-full flex items-center gap-3 p-3 rounded-xl hover:bg-white/10 transition-colors",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-cyan-400 to-green-500 flex items-center justify-center",children:f.jsx("span",{className:"text-white text-lg font-semibold",children:r.peerName.charAt(0).toUpperCase()})}),f.jsxs("div",{className:"flex-1 text-left",children:[f.jsx("p",{className:"text-white font-medium",children:r.peerName}),f.jsxs("p",{className:"text-white/40 text-sm truncate",children:[r.peerId.slice(0,16),"..."]})]}),f.jsx(sh,{size:20,className:"text-cyan-400"})]},r.peerId))})]})})};function rte(n,e){const t=$.useRef(e);$.useEffect(function(){e!==t.current&&n.attributionControl!=null&&(t.current!=null&&n.attributionControl.removeAttribution(t.current),e!=null&&n.attributionControl.addAttribution(e)),t.current=e},[n,e])}const G9e=1;function W9e(n){return Object.freeze({__version:G9e,map:n})}function ste(n,e){return Object.freeze({...n,...e})}const ote=$.createContext(null),ate=ote.Provider;function u9(){const n=$.useContext(ote);if(n==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return n}function lte(n){function e(t,i){const{instance:r,context:s}=n(t).current;return $.useImperativeHandle(i,()=>r),t.children==null?null:Fa.createElement(ate,{value:s},t.children)}return $.forwardRef(e)}function K9e(n){function e(t,i){const[r,s]=$.useState(!1),{instance:o}=n(t,s).current;$.useImperativeHandle(i,()=>o),$.useEffect(function(){r&&o.update()},[o,r,t.children]);const a=o._contentNode;return a?fK.createPortal(t.children,a):null}return $.forwardRef(e)}function q9e(n){function e(t,i){const{instance:r}=n(t).current;return $.useImperativeHandle(i,()=>r),null}return $.forwardRef(e)}function mD(n,e){const t=$.useRef();$.useEffect(function(){return e!=null&&n.instance.on(e),t.current=e,function(){t.current!=null&&n.instance.off(t.current),t.current=null}},[n,e])}function h9(n,e){const t=n.pane??e.pane;return t?{...n,pane:t}:n}function Z9e(n,e){return function(i,r){const s=u9(),o=n(h9(i,s),s);return rte(s.map,i.attribution),mD(o.current,i.eventHandlers),e(o.current,s,i,r),o}}var bN={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(n,e){(function(t,i){i(e)})($E,function(t){var i="1.9.4";function r(d){var _,A,D,K;for(A=1,D=arguments.length;A<D;A++){K=arguments[A];for(_ in K)d[_]=K[_]}return d}var s=Object.create||function(){function d(){}return function(_){return d.prototype=_,new d}}();function o(d,_){var A=Array.prototype.slice;if(d.bind)return d.bind.apply(d,A.call(arguments,1));var D=A.call(arguments,2);return function(){return d.apply(_,D.length?D.concat(A.call(arguments)):arguments)}}var a=0;function l(d){return"_leaflet_id"in d||(d._leaflet_id=++a),d._leaflet_id}function c(d,_,A){var D,K,re,Me;return Me=function(){D=!1,K&&(re.apply(A,K),K=!1)},re=function(){D?K=arguments:(d.apply(A,arguments),setTimeout(Me,_),D=!0)},re}function u(d,_,A){var D=_[1],K=_[0],re=D-K;return d===D&&A?d:((d-K)%re+re)%re+K}function h(){return!1}function p(d,_){if(_===!1)return d;var A=Math.pow(10,_===void 0?6:_);return Math.round(d*A)/A}function m(d){return d.trim?d.trim():d.replace(/^\s+|\s+$/g,"")}function y(d){return m(d).split(/\s+/)}function b(d,_){Object.prototype.hasOwnProperty.call(d,"options")||(d.options=d.options?s(d.options):{});for(var A in _)d.options[A]=_[A];return d.options}function w(d,_,A){var D=[];for(var K in d)D.push(encodeURIComponent(A?K.toUpperCase():K)+"="+encodeURIComponent(d[K]));return(!_||_.indexOf("?")===-1?"?":"&")+D.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function T(d,_){return d.replace(v,function(A,D){var K=_[D];if(K===void 0)throw new Error("No value provided for variable "+A);return typeof K=="function"&&(K=K(_)),K})}var S=Array.isArray||function(d){return Object.prototype.toString.call(d)==="[object Array]"};function M(d,_){for(var A=0;A<d.length;A++)if(d[A]===_)return A;return-1}var P="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function R(d){return window["webkit"+d]||window["moz"+d]||window["ms"+d]}var O=0;function B(d){var _=+new Date,A=Math.max(0,16-(_-O));return O=_+A,window.setTimeout(d,A)}var N=window.requestAnimationFrame||R("RequestAnimationFrame")||B,I=window.cancelAnimationFrame||R("CancelAnimationFrame")||R("CancelRequestAnimationFrame")||function(d){window.clearTimeout(d)};function F(d,_,A){if(A&&N===B)d.call(_);else return N.call(window,o(d,_))}function j(d){d&&I.call(window,d)}var W={__proto__:null,extend:r,create:s,bind:o,get lastId(){return a},stamp:l,throttle:c,wrapNum:u,falseFn:h,formatNum:p,trim:m,splitWords:y,setOptions:b,getParamString:w,template:T,isArray:S,indexOf:M,emptyImageUrl:P,requestFn:N,cancelFn:I,requestAnimFrame:F,cancelAnimFrame:j};function U(){}U.extend=function(d){var _=function(){b(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},A=_.__super__=this.prototype,D=s(A);D.constructor=_,_.prototype=D;for(var K in this)Object.prototype.hasOwnProperty.call(this,K)&&K!=="prototype"&&K!=="__super__"&&(_[K]=this[K]);return d.statics&&r(_,d.statics),d.includes&&(H(d.includes),r.apply(null,[D].concat(d.includes))),r(D,d),delete D.statics,delete D.includes,D.options&&(D.options=A.options?s(A.options):{},r(D.options,d.options)),D._initHooks=[],D.callInitHooks=function(){if(!this._initHooksCalled){A.callInitHooks&&A.callInitHooks.call(this),this._initHooksCalled=!0;for(var re=0,Me=D._initHooks.length;re<Me;re++)D._initHooks[re].call(this)}},_},U.include=function(d){var _=this.prototype.options;return r(this.prototype,d),d.options&&(this.prototype.options=_,this.mergeOptions(d.options)),this},U.mergeOptions=function(d){return r(this.prototype.options,d),this},U.addInitHook=function(d){var _=Array.prototype.slice.call(arguments,1),A=typeof d=="function"?d:function(){this[d].apply(this,_)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(A),this};function H(d){if(!(typeof L>"u"||!L||!L.Mixin)){d=S(d)?d:[d];for(var _=0;_<d.length;_++)d[_]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var q={on:function(d,_,A){if(typeof d=="object")for(var D in d)this._on(D,d[D],_);else{d=y(d);for(var K=0,re=d.length;K<re;K++)this._on(d[K],_,A)}return this},off:function(d,_,A){if(!arguments.length)delete this._events;else if(typeof d=="object")for(var D in d)this._off(D,d[D],_);else{d=y(d);for(var K=arguments.length===1,re=0,Me=d.length;re<Me;re++)K?this._off(d[re]):this._off(d[re],_,A)}return this},_on:function(d,_,A,D){if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}if(this._listens(d,_,A)===!1){A===this&&(A=void 0);var K={fn:_,ctx:A};D&&(K.once=!0),this._events=this._events||{},this._events[d]=this._events[d]||[],this._events[d].push(K)}},_off:function(d,_,A){var D,K,re;if(this._events&&(D=this._events[d],!!D)){if(arguments.length===1){if(this._firingCount)for(K=0,re=D.length;K<re;K++)D[K].fn=h;delete this._events[d];return}if(typeof _!="function"){console.warn("wrong listener type: "+typeof _);return}var Me=this._listens(d,_,A);if(Me!==!1){var Ze=D[Me];this._firingCount&&(Ze.fn=h,this._events[d]=D=D.slice()),D.splice(Me,1)}}},fire:function(d,_,A){if(!this.listens(d,A))return this;var D=r({},_,{type:d,target:this,sourceTarget:_&&_.sourceTarget||this});if(this._events){var K=this._events[d];if(K){this._firingCount=this._firingCount+1||1;for(var re=0,Me=K.length;re<Me;re++){var Ze=K[re],lt=Ze.fn;Ze.once&&this.off(d,lt,Ze.ctx),lt.call(Ze.ctx||this,D)}this._firingCount--}}return A&&this._propagateEvent(D),this},listens:function(d,_,A,D){typeof d!="string"&&console.warn('"string" type argument expected');var K=_;typeof _!="function"&&(D=!!_,K=void 0,A=void 0);var re=this._events&&this._events[d];if(re&&re.length&&this._listens(d,K,A)!==!1)return!0;if(D){for(var Me in this._eventParents)if(this._eventParents[Me].listens(d,_,A,D))return!0}return!1},_listens:function(d,_,A){if(!this._events)return!1;var D=this._events[d]||[];if(!_)return!!D.length;A===this&&(A=void 0);for(var K=0,re=D.length;K<re;K++)if(D[K].fn===_&&D[K].ctx===A)return K;return!1},once:function(d,_,A){if(typeof d=="object")for(var D in d)this._on(D,d[D],_,!0);else{d=y(d);for(var K=0,re=d.length;K<re;K++)this._on(d[K],_,A,!0)}return this},addEventParent:function(d){return this._eventParents=this._eventParents||{},this._eventParents[l(d)]=d,this},removeEventParent:function(d){return this._eventParents&&delete this._eventParents[l(d)],this},_propagateEvent:function(d){for(var _ in this._eventParents)this._eventParents[_].fire(d.type,r({layer:d.target,propagatedFrom:d.target},d),!0)}};q.addEventListener=q.on,q.removeEventListener=q.clearAllEventListeners=q.off,q.addOneTimeEventListener=q.once,q.fireEvent=q.fire,q.hasEventListeners=q.listens;var J=U.extend(q);function G(d,_,A){this.x=A?Math.round(d):d,this.y=A?Math.round(_):_}var ee=Math.trunc||function(d){return d>0?Math.floor(d):Math.ceil(d)};G.prototype={clone:function(){return new G(this.x,this.y)},add:function(d){return this.clone()._add(Q(d))},_add:function(d){return this.x+=d.x,this.y+=d.y,this},subtract:function(d){return this.clone()._subtract(Q(d))},_subtract:function(d){return this.x-=d.x,this.y-=d.y,this},divideBy:function(d){return this.clone()._divideBy(d)},_divideBy:function(d){return this.x/=d,this.y/=d,this},multiplyBy:function(d){return this.clone()._multiplyBy(d)},_multiplyBy:function(d){return this.x*=d,this.y*=d,this},scaleBy:function(d){return new G(this.x*d.x,this.y*d.y)},unscaleBy:function(d){return new G(this.x/d.x,this.y/d.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ee(this.x),this.y=ee(this.y),this},distanceTo:function(d){d=Q(d);var _=d.x-this.x,A=d.y-this.y;return Math.sqrt(_*_+A*A)},equals:function(d){return d=Q(d),d.x===this.x&&d.y===this.y},contains:function(d){return d=Q(d),Math.abs(d.x)<=Math.abs(this.x)&&Math.abs(d.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function Q(d,_,A){return d instanceof G?d:S(d)?new G(d[0],d[1]):d==null?d:typeof d=="object"&&"x"in d&&"y"in d?new G(d.x,d.y):new G(d,_,A)}function ne(d,_){if(d)for(var A=_?[d,_]:d,D=0,K=A.length;D<K;D++)this.extend(A[D])}ne.prototype={extend:function(d){var _,A;if(!d)return this;if(d instanceof G||typeof d[0]=="number"||"x"in d)_=A=Q(d);else if(d=fe(d),_=d.min,A=d.max,!_||!A)return this;return!this.min&&!this.max?(this.min=_.clone(),this.max=A.clone()):(this.min.x=Math.min(_.x,this.min.x),this.max.x=Math.max(A.x,this.max.x),this.min.y=Math.min(_.y,this.min.y),this.max.y=Math.max(A.y,this.max.y)),this},getCenter:function(d){return Q((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,d)},getBottomLeft:function(){return Q(this.min.x,this.max.y)},getTopRight:function(){return Q(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(d){var _,A;return typeof d[0]=="number"||d instanceof G?d=Q(d):d=fe(d),d instanceof ne?(_=d.min,A=d.max):_=A=d,_.x>=this.min.x&&A.x<=this.max.x&&_.y>=this.min.y&&A.y<=this.max.y},intersects:function(d){d=fe(d);var _=this.min,A=this.max,D=d.min,K=d.max,re=K.x>=_.x&&D.x<=A.x,Me=K.y>=_.y&&D.y<=A.y;return re&&Me},overlaps:function(d){d=fe(d);var _=this.min,A=this.max,D=d.min,K=d.max,re=K.x>_.x&&D.x<A.x,Me=K.y>_.y&&D.y<A.y;return re&&Me},isValid:function(){return!!(this.min&&this.max)},pad:function(d){var _=this.min,A=this.max,D=Math.abs(_.x-A.x)*d,K=Math.abs(_.y-A.y)*d;return fe(Q(_.x-D,_.y-K),Q(A.x+D,A.y+K))},equals:function(d){return d?(d=fe(d),this.min.equals(d.getTopLeft())&&this.max.equals(d.getBottomRight())):!1}};function fe(d,_){return!d||d instanceof ne?d:new ne(d,_)}function Ae(d,_){if(d)for(var A=_?[d,_]:d,D=0,K=A.length;D<K;D++)this.extend(A[D])}Ae.prototype={extend:function(d){var _=this._southWest,A=this._northEast,D,K;if(d instanceof Ce)D=d,K=d;else if(d instanceof Ae){if(D=d._southWest,K=d._northEast,!D||!K)return this}else return d?this.extend(de(d)||Pe(d)):this;return!_&&!A?(this._southWest=new Ce(D.lat,D.lng),this._northEast=new Ce(K.lat,K.lng)):(_.lat=Math.min(D.lat,_.lat),_.lng=Math.min(D.lng,_.lng),A.lat=Math.max(K.lat,A.lat),A.lng=Math.max(K.lng,A.lng)),this},pad:function(d){var _=this._southWest,A=this._northEast,D=Math.abs(_.lat-A.lat)*d,K=Math.abs(_.lng-A.lng)*d;return new Ae(new Ce(_.lat-D,_.lng-K),new Ce(A.lat+D,A.lng+K))},getCenter:function(){return new Ce((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ce(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ce(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(d){typeof d[0]=="number"||d instanceof Ce||"lat"in d?d=de(d):d=Pe(d);var _=this._southWest,A=this._northEast,D,K;return d instanceof Ae?(D=d.getSouthWest(),K=d.getNorthEast()):D=K=d,D.lat>=_.lat&&K.lat<=A.lat&&D.lng>=_.lng&&K.lng<=A.lng},intersects:function(d){d=Pe(d);var _=this._southWest,A=this._northEast,D=d.getSouthWest(),K=d.getNorthEast(),re=K.lat>=_.lat&&D.lat<=A.lat,Me=K.lng>=_.lng&&D.lng<=A.lng;return re&&Me},overlaps:function(d){d=Pe(d);var _=this._southWest,A=this._northEast,D=d.getSouthWest(),K=d.getNorthEast(),re=K.lat>_.lat&&D.lat<A.lat,Me=K.lng>_.lng&&D.lng<A.lng;return re&&Me},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(d,_){return d?(d=Pe(d),this._southWest.equals(d.getSouthWest(),_)&&this._northEast.equals(d.getNorthEast(),_)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Pe(d,_){return d instanceof Ae?d:new Ae(d,_)}function Ce(d,_,A){if(isNaN(d)||isNaN(_))throw new Error("Invalid LatLng object: ("+d+", "+_+")");this.lat=+d,this.lng=+_,A!==void 0&&(this.alt=+A)}Ce.prototype={equals:function(d,_){if(!d)return!1;d=de(d);var A=Math.max(Math.abs(this.lat-d.lat),Math.abs(this.lng-d.lng));return A<=(_===void 0?1e-9:_)},toString:function(d){return"LatLng("+p(this.lat,d)+", "+p(this.lng,d)+")"},distanceTo:function(d){return et.distance(this,de(d))},wrap:function(){return et.wrapLatLng(this)},toBounds:function(d){var _=180*d/40075017,A=_/Math.cos(Math.PI/180*this.lat);return Pe([this.lat-_,this.lng-A],[this.lat+_,this.lng+A])},clone:function(){return new Ce(this.lat,this.lng,this.alt)}};function de(d,_,A){return d instanceof Ce?d:S(d)&&typeof d[0]!="object"?d.length===3?new Ce(d[0],d[1],d[2]):d.length===2?new Ce(d[0],d[1]):null:d==null?d:typeof d=="object"&&"lat"in d?new Ce(d.lat,"lng"in d?d.lng:d.lon,d.alt):_===void 0?null:new Ce(d,_,A)}var Ne={latLngToPoint:function(d,_){var A=this.projection.project(d),D=this.scale(_);return this.transformation._transform(A,D)},pointToLatLng:function(d,_){var A=this.scale(_),D=this.transformation.untransform(d,A);return this.projection.unproject(D)},project:function(d){return this.projection.project(d)},unproject:function(d){return this.projection.unproject(d)},scale:function(d){return 256*Math.pow(2,d)},zoom:function(d){return Math.log(d/256)/Math.LN2},getProjectedBounds:function(d){if(this.infinite)return null;var _=this.projection.bounds,A=this.scale(d),D=this.transformation.transform(_.min,A),K=this.transformation.transform(_.max,A);return new ne(D,K)},infinite:!1,wrapLatLng:function(d){var _=this.wrapLng?u(d.lng,this.wrapLng,!0):d.lng,A=this.wrapLat?u(d.lat,this.wrapLat,!0):d.lat,D=d.alt;return new Ce(A,_,D)},wrapLatLngBounds:function(d){var _=d.getCenter(),A=this.wrapLatLng(_),D=_.lat-A.lat,K=_.lng-A.lng;if(D===0&&K===0)return d;var re=d.getSouthWest(),Me=d.getNorthEast(),Ze=new Ce(re.lat-D,re.lng-K),lt=new Ce(Me.lat-D,Me.lng-K);return new Ae(Ze,lt)}},et=r({},Ne,{wrapLng:[-180,180],R:6371e3,distance:function(d,_){var A=Math.PI/180,D=d.lat*A,K=_.lat*A,re=Math.sin((_.lat-d.lat)*A/2),Me=Math.sin((_.lng-d.lng)*A/2),Ze=re*re+Math.cos(D)*Math.cos(K)*Me*Me,lt=2*Math.atan2(Math.sqrt(Ze),Math.sqrt(1-Ze));return this.R*lt}}),me=6378137,nt={R:me,MAX_LATITUDE:85.0511287798,project:function(d){var _=Math.PI/180,A=this.MAX_LATITUDE,D=Math.max(Math.min(A,d.lat),-A),K=Math.sin(D*_);return new G(this.R*d.lng*_,this.R*Math.log((1+K)/(1-K))/2)},unproject:function(d){var _=180/Math.PI;return new Ce((2*Math.atan(Math.exp(d.y/this.R))-Math.PI/2)*_,d.x*_/this.R)},bounds:function(){var d=me*Math.PI;return new ne([-d,-d],[d,d])}()};function Pt(d,_,A,D){if(S(d)){this._a=d[0],this._b=d[1],this._c=d[2],this._d=d[3];return}this._a=d,this._b=_,this._c=A,this._d=D}Pt.prototype={transform:function(d,_){return this._transform(d.clone(),_)},_transform:function(d,_){return _=_||1,d.x=_*(this._a*d.x+this._b),d.y=_*(this._c*d.y+this._d),d},untransform:function(d,_){return _=_||1,new G((d.x/_-this._b)/this._a,(d.y/_-this._d)/this._c)}};function zt(d,_,A,D){return new Pt(d,_,A,D)}var Dt=r({},et,{code:"EPSG:3857",projection:nt,transformation:function(){var d=.5/(Math.PI*nt.R);return zt(d,.5,-d,.5)}()}),gt=r({},Dt,{code:"EPSG:900913"});function vt(d){return document.createElementNS("http://www.w3.org/2000/svg",d)}function Oe(d,_){var A="",D,K,re,Me,Ze,lt;for(D=0,re=d.length;D<re;D++){for(Ze=d[D],K=0,Me=Ze.length;K<Me;K++)lt=Ze[K],A+=(K?"L":"M")+lt.x+" "+lt.y;A+=_?te.svg?"z":"x":""}return A||"M0 0"}var xt=document.documentElement.style,pe="ActiveXObject"in window,qe=pe&&!document.addEventListener,$e="msLaunchUri"in navigator&&!("documentMode"in document),Xe=se("webkit"),Ye=se("android"),oe=se("android 2")||se("android 3"),Z=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),he=Ye&&se("Google")&&Z<537&&!("AudioNode"in window),Ge=!!window.opera,ct=!$e&&se("chrome"),tt=se("gecko")&&!Xe&&!Ge&&!pe,Lt=!ct&&se("safari"),Ct=se("phantom"),Ot="OTransition"in xt,nn=navigator.platform.indexOf("Win")===0,Tt=pe&&"transition"in xt,Ve="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!oe,ut="MozPerspective"in xt,ue=!window.L_DISABLE_3D&&(Tt||Ve||ut)&&!Ot&&!Ct,Ie=typeof orientation<"u"||se("mobile"),ft=Ie&&Xe,xe=Ie&&Ve,pt=!window.PointerEvent&&window.MSPointerEvent,ge=!!(window.PointerEvent||pt),Qe="ontouchstart"in window||!!window.TouchEvent,ht=!window.L_NO_TOUCH&&(Qe||ge),at=Ie&&Ge,yt=Ie&&tt,Gt=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,on=function(){var d=!1;try{var _=Object.defineProperty({},"passive",{get:function(){d=!0}});window.addEventListener("testPassiveEventSupport",h,_),window.removeEventListener("testPassiveEventSupport",h,_)}catch{}return d}(),mn=function(){return!!document.createElement("canvas").getContext}(),Cn=!!(document.createElementNS&&vt("svg").createSVGRect),gi=!!Cn&&function(){var d=document.createElement("div");return d.innerHTML="<svg/>",(d.firstChild&&d.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),$r=!Cn&&function(){try{var d=document.createElement("div");d.innerHTML='<v:shape adj="1"/>';var _=d.firstChild;return _.style.behavior="url(#default#VML)",_&&typeof _.adj=="object"}catch{return!1}}(),Il=navigator.platform.indexOf("Mac")===0,X=navigator.platform.indexOf("Linux")===0;function se(d){return navigator.userAgent.toLowerCase().indexOf(d)>=0}var te={ie:pe,ielt9:qe,edge:$e,webkit:Xe,android:Ye,android23:oe,androidStock:he,opera:Ge,chrome:ct,gecko:tt,safari:Lt,phantom:Ct,opera12:Ot,win:nn,ie3d:Tt,webkit3d:Ve,gecko3d:ut,any3d:ue,mobile:Ie,mobileWebkit:ft,mobileWebkit3d:xe,msPointer:pt,pointer:ge,touch:ht,touchNative:Qe,mobileOpera:at,mobileGecko:yt,retina:Gt,passiveEvents:on,canvas:mn,svg:Cn,vml:$r,inlineSvg:gi,mac:Il,linux:X},z=te.msPointer?"MSPointerDown":"pointerdown",le=te.msPointer?"MSPointerMove":"pointermove",je=te.msPointer?"MSPointerUp":"pointerup",Ke=te.msPointer?"MSPointerCancel":"pointercancel",St={touchstart:z,touchmove:le,touchend:je,touchcancel:Ke},It={touchstart:bn,touchmove:vn,touchend:vn,touchcancel:vn},Yt={},Ht=!1;function $n(d,_,A){return _==="touchstart"&&Ln(),It[_]?(A=It[_].bind(this,A),d.addEventListener(St[_],A,!1),A):(console.warn("wrong event specified:",_),h)}function Kt(d,_,A){if(!St[_]){console.warn("wrong event specified:",_);return}d.removeEventListener(St[_],A,!1)}function Sn(d){Yt[d.pointerId]=d}function Mn(d){Yt[d.pointerId]&&(Yt[d.pointerId]=d)}function kn(d){delete Yt[d.pointerId]}function Ln(){Ht||(document.addEventListener(z,Sn,!0),document.addEventListener(le,Mn,!0),document.addEventListener(je,kn,!0),document.addEventListener(Ke,kn,!0),Ht=!0)}function vn(d,_){if(_.pointerType!==(_.MSPOINTER_TYPE_MOUSE||"mouse")){_.touches=[];for(var A in Yt)_.touches.push(Yt[A]);_.changedTouches=[_],d(_)}}function bn(d,_){_.MSPOINTER_TYPE_TOUCH&&_.pointerType===_.MSPOINTER_TYPE_TOUCH&&vs(_),vn(d,_)}function ie(d){var _={},A,D;for(D in d)A=d[D],_[D]=A&&A.bind?A.bind(d):A;return d=_,_.type="dblclick",_.detail=2,_.isTrusted=!1,_._simulated=!0,_}var _e=200;function ke(d,_){d.addEventListener("dblclick",_);var A=0,D;function K(re){if(re.detail!==1){D=re.detail;return}if(!(re.pointerType==="mouse"||re.sourceCapabilities&&!re.sourceCapabilities.firesTouchEvents)){var Me=tl(re);if(!(Me.some(function(lt){return lt instanceof HTMLLabelElement&&lt.attributes.for})&&!Me.some(function(lt){return lt instanceof HTMLInputElement||lt instanceof HTMLSelectElement}))){var Ze=Date.now();Ze-A<=_e?(D++,D===2&&_(ie(re))):D=1,A=Ze}}}return d.addEventListener("click",K),{dblclick:_,simDblclick:K}}function Re(d,_){d.removeEventListener("dblclick",_.dblclick),d.removeEventListener("click",_.simDblclick)}var Te=Rn(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),it=Rn(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),rt=it==="webkitTransition"||it==="OTransition"?it+"End":"transitionend";function we(d){return typeof d=="string"?document.getElementById(d):d}function Ee(d,_){var A=d.style[_]||d.currentStyle&&d.currentStyle[_];if((!A||A==="auto")&&document.defaultView){var D=document.defaultView.getComputedStyle(d,null);A=D?D[_]:null}return A==="auto"?null:A}function De(d,_,A){var D=document.createElement(d);return D.className=_||"",A&&A.appendChild(D),D}function Le(d){var _=d.parentNode;_&&_.removeChild(d)}function ae(d){for(;d.firstChild;)d.removeChild(d.firstChild)}function be(d){var _=d.parentNode;_&&_.lastChild!==d&&_.appendChild(d)}function Ue(d){var _=d.parentNode;_&&_.firstChild!==d&&_.insertBefore(d,_.firstChild)}function We(d,_){if(d.classList!==void 0)return d.classList.contains(_);var A=Bt(d);return A.length>0&&new RegExp("(^|\\s)"+_+"(\\s|$)").test(A)}function st(d,_){if(d.classList!==void 0)for(var A=y(_),D=0,K=A.length;D<K;D++)d.classList.add(A[D]);else if(!We(d,_)){var re=Bt(d);ce(d,(re?re+" ":"")+_)}}function _t(d,_){d.classList!==void 0?d.classList.remove(_):ce(d,m((" "+Bt(d)+" ").replace(" "+_+" "," ")))}function ce(d,_){d.className.baseVal===void 0?d.className=_:d.className.baseVal=_}function Bt(d){return d.correspondingElement&&(d=d.correspondingElement),d.className.baseVal===void 0?d.className:d.className.baseVal}function Nt(d,_){"opacity"in d.style?d.style.opacity=_:"filter"in d.style&&hn(d,_)}function hn(d,_){var A=!1,D="DXImageTransform.Microsoft.Alpha";try{A=d.filters.item(D)}catch{if(_===1)return}_=Math.round(_*100),A?(A.Enabled=_!==100,A.Opacity=_):d.style.filter+=" progid:"+D+"(opacity="+_+")"}function Rn(d){for(var _=document.documentElement.style,A=0;A<d.length;A++)if(d[A]in _)return d[A];return!1}function gn(d,_,A){var D=_||new G(0,0);d.style[Te]=(te.ie3d?"translate("+D.x+"px,"+D.y+"px)":"translate3d("+D.x+"px,"+D.y+"px,0)")+(A?" scale("+A+")":"")}function fn(d,_){d._leaflet_pos=_,te.any3d?gn(d,_):(d.style.left=_.x+"px",d.style.top=_.y+"px")}function pn(d){return d._leaflet_pos||new G(0,0)}var En,Un,Fn;if("onselectstart"in document)En=function(){jn(window,"selectstart",vs)},Un=function(){Ji(window,"selectstart",vs)};else{var zn=Rn(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);En=function(){if(zn){var d=document.documentElement.style;Fn=d[zn],d[zn]="none"}},Un=function(){zn&&(document.documentElement.style[zn]=Fn,Fn=void 0)}}function Zi(){jn(window,"dragstart",vs)}function Ni(){Ji(window,"dragstart",vs)}var wr,gr;function wx(d){for(;d.tabIndex===-1;)d=d.parentNode;d.style&&(Gd(),wr=d,gr=d.style.outlineStyle,d.style.outlineStyle="none",jn(window,"keydown",Gd))}function Gd(){wr&&(wr.style.outlineStyle=gr,wr=void 0,gr=void 0,Ji(window,"keydown",Gd))}function yi(d){do d=d.parentNode;while((!d.offsetWidth||!d.offsetHeight)&&d!==document.body);return d}function R1(d){var _=d.getBoundingClientRect();return{x:_.width/d.offsetWidth||1,y:_.height/d.offsetHeight||1,boundingClientRect:_}}var Sx={__proto__:null,TRANSFORM:Te,TRANSITION:it,TRANSITION_END:rt,get:we,getStyle:Ee,create:De,remove:Le,empty:ae,toFront:be,toBack:Ue,hasClass:We,addClass:st,removeClass:_t,setClass:ce,getClass:Bt,setOpacity:Nt,testProp:Rn,setTransform:gn,setPosition:fn,getPosition:pn,get disableTextSelection(){return En},get enableTextSelection(){return Un},disableImageDrag:Zi,enableImageDrag:Ni,preventOutline:wx,restoreOutline:Gd,getSizedParentNode:yi,getScale:R1};function jn(d,_,A,D){if(_&&typeof _=="object")for(var K in _)Ex(d,K,_[K],A);else{_=y(_);for(var re=0,Me=_.length;re<Me;re++)Ex(d,_[re],A,D)}return this}var Nl="_leaflet_events";function Ji(d,_,A,D){if(arguments.length===1)Qr(d),delete d[Nl];else if(_&&typeof _=="object")for(var K in _)J0(d,K,_[K],A);else if(_=y(_),arguments.length===2)Qr(d,function(Ze){return M(_,Ze)!==-1});else for(var re=0,Me=_.length;re<Me;re++)J0(d,_[re],A,D);return this}function Qr(d,_){for(var A in d[Nl]){var D=A.split(/\d/)[0];(!_||_(D))&&J0(d,D,null,null,A)}}var Q0={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Ex(d,_,A,D){var K=_+l(A)+(D?"_"+l(D):"");if(d[Nl]&&d[Nl][K])return this;var re=function(Ze){return A.call(D||d,Ze||window.event)},Me=re;!te.touchNative&&te.pointer&&_.indexOf("touch")===0?re=$n(d,_,re):te.touch&&_==="dblclick"?re=ke(d,re):"addEventListener"in d?_==="touchstart"||_==="touchmove"||_==="wheel"||_==="mousewheel"?d.addEventListener(Q0[_]||_,re,te.passiveEvents?{passive:!1}:!1):_==="mouseenter"||_==="mouseleave"?(re=function(Ze){Ze=Ze||window.event,P1(d,Ze)&&Me(Ze)},d.addEventListener(Q0[_],re,!1)):d.addEventListener(_,Me,!1):d.attachEvent("on"+_,re),d[Nl]=d[Nl]||{},d[Nl][K]=re}function J0(d,_,A,D,K){K=K||_+l(A)+(D?"_"+l(D):"");var re=d[Nl]&&d[Nl][K];if(!re)return this;!te.touchNative&&te.pointer&&_.indexOf("touch")===0?Kt(d,_,re):te.touch&&_==="dblclick"?Re(d,re):"removeEventListener"in d?d.removeEventListener(Q0[_]||_,re,!1):d.detachEvent("on"+_,re),d[Nl][K]=null}function bh(d){return d.stopPropagation?d.stopPropagation():d.originalEvent?d.originalEvent._stopped=!0:d.cancelBubble=!0,this}function Wd(d){return Ex(d,"wheel",bh),this}function co(d){return jn(d,"mousedown touchstart dblclick contextmenu",bh),d._leaflet_disable_click=!0,this}function vs(d){return d.preventDefault?d.preventDefault():d.returnValue=!1,this}function _h(d){return vs(d),bh(d),this}function tl(d){if(d.composedPath)return d.composedPath();for(var _=[],A=d.target;A;)_.push(A),A=A.parentNode;return _}function Pl(d,_){if(!_)return new G(d.clientX,d.clientY);var A=R1(_),D=A.boundingClientRect;return new G((d.clientX-D.left)/A.x-_.clientLeft,(d.clientY-D.top)/A.y-_.clientTop)}var I1=te.linux&&te.chrome?window.devicePixelRatio:te.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function N1(d){return te.edge?d.wheelDeltaY/2:d.deltaY&&d.deltaMode===0?-d.deltaY/I1:d.deltaY&&d.deltaMode===1?-d.deltaY*20:d.deltaY&&d.deltaMode===2?-d.deltaY*60:d.deltaX||d.deltaZ?0:d.wheelDelta?(d.wheelDeltaY||d.wheelDelta)/2:d.detail&&Math.abs(d.detail)<32765?-d.detail*20:d.detail?d.detail/-32765*60:0}function P1(d,_){var A=_.relatedTarget;if(!A)return!0;try{for(;A&&A!==d;)A=A.parentNode}catch{return!1}return A!==d}var sT={__proto__:null,on:jn,off:Ji,stopPropagation:bh,disableScrollPropagation:Wd,disableClickPropagation:co,preventDefault:vs,stop:_h,getPropagationPath:tl,getMousePosition:Pl,getWheelDelta:N1,isExternalTarget:P1,addListener:jn,removeListener:Ji},nl=J.extend({run:function(d,_,A,D){this.stop(),this._el=d,this._inProgress=!0,this._duration=A||.25,this._easeOutPower=1/Math.max(D||.5,.2),this._startPos=pn(d),this._offset=_.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=F(this._animate,this),this._step()},_step:function(d){var _=+new Date-this._startTime,A=this._duration*1e3;_<A?this._runFrame(this._easeOut(_/A),d):(this._runFrame(1),this._complete())},_runFrame:function(d,_){var A=this._startPos.add(this._offset.multiplyBy(d));_&&A._round(),fn(this._el,A),this.fire("step")},_complete:function(){j(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(d){return 1-Math.pow(1-d,this._easeOutPower)}}),hi=J.extend({options:{crs:Dt,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(d,_){_=b(this,_),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(d),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),_.maxBounds&&this.setMaxBounds(_.maxBounds),_.zoom!==void 0&&(this._zoom=this._limitZoom(_.zoom)),_.center&&_.zoom!==void 0&&this.setView(de(_.center),_.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=it&&te.any3d&&!te.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),jn(this._proxy,rt,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(d,_,A){if(_=_===void 0?this._zoom:this._limitZoom(_),d=this._limitCenter(de(d),_,this.options.maxBounds),A=A||{},this._stop(),this._loaded&&!A.reset&&A!==!0){A.animate!==void 0&&(A.zoom=r({animate:A.animate},A.zoom),A.pan=r({animate:A.animate,duration:A.duration},A.pan));var D=this._zoom!==_?this._tryAnimatedZoom&&this._tryAnimatedZoom(d,_,A.zoom):this._tryAnimatedPan(d,A.pan);if(D)return clearTimeout(this._sizeTimer),this}return this._resetView(d,_,A.pan&&A.pan.noMoveStart),this},setZoom:function(d,_){return this._loaded?this.setView(this.getCenter(),d,{zoom:_}):(this._zoom=d,this)},zoomIn:function(d,_){return d=d||(te.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+d,_)},zoomOut:function(d,_){return d=d||(te.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-d,_)},setZoomAround:function(d,_,A){var D=this.getZoomScale(_),K=this.getSize().divideBy(2),re=d instanceof G?d:this.latLngToContainerPoint(d),Me=re.subtract(K).multiplyBy(1-1/D),Ze=this.containerPointToLatLng(K.add(Me));return this.setView(Ze,_,{zoom:A})},_getBoundsCenterZoom:function(d,_){_=_||{},d=d.getBounds?d.getBounds():Pe(d);var A=Q(_.paddingTopLeft||_.padding||[0,0]),D=Q(_.paddingBottomRight||_.padding||[0,0]),K=this.getBoundsZoom(d,!1,A.add(D));if(K=typeof _.maxZoom=="number"?Math.min(_.maxZoom,K):K,K===1/0)return{center:d.getCenter(),zoom:K};var re=D.subtract(A).divideBy(2),Me=this.project(d.getSouthWest(),K),Ze=this.project(d.getNorthEast(),K),lt=this.unproject(Me.add(Ze).divideBy(2).add(re),K);return{center:lt,zoom:K}},fitBounds:function(d,_){if(d=Pe(d),!d.isValid())throw new Error("Bounds are not valid.");var A=this._getBoundsCenterZoom(d,_);return this.setView(A.center,A.zoom,_)},fitWorld:function(d){return this.fitBounds([[-90,-180],[90,180]],d)},panTo:function(d,_){return this.setView(d,this._zoom,{pan:_})},panBy:function(d,_){if(d=Q(d).round(),_=_||{},!d.x&&!d.y)return this.fire("moveend");if(_.animate!==!0&&!this.getSize().contains(d))return this._resetView(this.unproject(this.project(this.getCenter()).add(d)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new nl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),_.noMoveStart||this.fire("movestart"),_.animate!==!1){st(this._mapPane,"leaflet-pan-anim");var A=this._getMapPanePos().subtract(d).round();this._panAnim.run(this._mapPane,A,_.duration||.25,_.easeLinearity)}else this._rawPanBy(d),this.fire("move").fire("moveend");return this},flyTo:function(d,_,A){if(A=A||{},A.animate===!1||!te.any3d)return this.setView(d,_,A);this._stop();var D=this.project(this.getCenter()),K=this.project(d),re=this.getSize(),Me=this._zoom;d=de(d),_=_===void 0?Me:_;var Ze=Math.max(re.x,re.y),lt=Ze*this.getZoomScale(Me,_),Mt=K.distanceTo(D)||1,Xt=1.42,Dn=Xt*Xt;function ii(yr){var _u=yr?-1:1,$1=yr?lt:Ze,G1=lt*lt-Ze*Ze+_u*Dn*Dn*Mt*Mt,yw=2*$1*Dn*Mt,Mh=G1/yw,_s=Math.sqrt(Mh*Mh+1)-Mh,aT=_s<1e-9?-18:Math.log(_s);return aT}function Zs(yr){return(Math.exp(yr)-Math.exp(-yr))/2}function Gr(yr){return(Math.exp(yr)+Math.exp(-yr))/2}function ho(yr){return Zs(yr)/Gr(yr)}var fo=ii(0);function Ch(yr){return Ze*(Gr(fo)/Gr(fo+Xt*yr))}function pw(yr){return Ze*(Gr(fo)*ho(fo+Xt*yr)-Zs(fo))/Dn}function mw(yr){return 1-Math.pow(1-yr,1.5)}var gw=Date.now(),Hx=(ii(1)-fo)/Xt,Fl=A.duration?1e3*A.duration:1e3*Hx*.8;function $x(){var yr=(Date.now()-gw)/Fl,_u=mw(yr)*Hx;yr<=1?(this._flyToFrame=F($x,this),this._move(this.unproject(D.add(K.subtract(D).multiplyBy(pw(_u)/Mt)),Me),this.getScaleZoom(Ze/Ch(_u),Me),{flyTo:!0})):this._move(d,_)._moveEnd(!0)}return this._moveStart(!0,A.noMoveStart),$x.call(this),this},flyToBounds:function(d,_){var A=this._getBoundsCenterZoom(d,_);return this.flyTo(A.center,A.zoom,_)},setMaxBounds:function(d){return d=Pe(d),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),d.isValid()?(this.options.maxBounds=d,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(d){var _=this.options.minZoom;return this.options.minZoom=d,this._loaded&&_!==d&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(d):this},setMaxZoom:function(d){var _=this.options.maxZoom;return this.options.maxZoom=d,this._loaded&&_!==d&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(d):this},panInsideBounds:function(d,_){this._enforcingBounds=!0;var A=this.getCenter(),D=this._limitCenter(A,this._zoom,Pe(d));return A.equals(D)||this.panTo(D,_),this._enforcingBounds=!1,this},panInside:function(d,_){_=_||{};var A=Q(_.paddingTopLeft||_.padding||[0,0]),D=Q(_.paddingBottomRight||_.padding||[0,0]),K=this.project(this.getCenter()),re=this.project(d),Me=this.getPixelBounds(),Ze=fe([Me.min.add(A),Me.max.subtract(D)]),lt=Ze.getSize();if(!Ze.contains(re)){this._enforcingBounds=!0;var Mt=re.subtract(Ze.getCenter()),Xt=Ze.extend(re).getSize().subtract(lt);K.x+=Mt.x<0?-Xt.x:Xt.x,K.y+=Mt.y<0?-Xt.y:Xt.y,this.panTo(this.unproject(K),_),this._enforcingBounds=!1}return this},invalidateSize:function(d){if(!this._loaded)return this;d=r({animate:!1,pan:!0},d===!0?{animate:!0}:d);var _=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var A=this.getSize(),D=_.divideBy(2).round(),K=A.divideBy(2).round(),re=D.subtract(K);return!re.x&&!re.y?this:(d.animate&&d.pan?this.panBy(re):(d.pan&&this._rawPanBy(re),this.fire("move"),d.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:_,newSize:A}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(d){if(d=this._locateOptions=r({timeout:1e4,watch:!1},d),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var _=o(this._handleGeolocationResponse,this),A=o(this._handleGeolocationError,this);return d.watch?this._locationWatchId=navigator.geolocation.watchPosition(_,A,d):navigator.geolocation.getCurrentPosition(_,A,d),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(d){if(this._container._leaflet_id){var _=d.code,A=d.message||(_===1?"permission denied":_===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:_,message:"Geolocation error: "+A+"."})}},_handleGeolocationResponse:function(d){if(this._container._leaflet_id){var _=d.coords.latitude,A=d.coords.longitude,D=new Ce(_,A),K=D.toBounds(d.coords.accuracy*2),re=this._locateOptions;if(re.setView){var Me=this.getBoundsZoom(K);this.setView(D,re.maxZoom?Math.min(Me,re.maxZoom):Me)}var Ze={latlng:D,bounds:K,timestamp:d.timestamp};for(var lt in d.coords)typeof d.coords[lt]=="number"&&(Ze[lt]=d.coords[lt]);this.fire("locationfound",Ze)}},addHandler:function(d,_){if(!_)return this;var A=this[d]=new _(this);return this._handlers.push(A),this.options[d]&&A.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Le(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(j(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var d;for(d in this._layers)this._layers[d].remove();for(d in this._panes)Le(this._panes[d]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(d,_){var A="leaflet-pane"+(d?" leaflet-"+d.replace("Pane","")+"-pane":""),D=De("div",A,_||this._mapPane);return d&&(this._panes[d]=D),D},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var d=this.getPixelBounds(),_=this.unproject(d.getBottomLeft()),A=this.unproject(d.getTopRight());return new Ae(_,A)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(d,_,A){d=Pe(d),A=Q(A||[0,0]);var D=this.getZoom()||0,K=this.getMinZoom(),re=this.getMaxZoom(),Me=d.getNorthWest(),Ze=d.getSouthEast(),lt=this.getSize().subtract(A),Mt=fe(this.project(Ze,D),this.project(Me,D)).getSize(),Xt=te.any3d?this.options.zoomSnap:1,Dn=lt.x/Mt.x,ii=lt.y/Mt.y,Zs=_?Math.max(Dn,ii):Math.min(Dn,ii);return D=this.getScaleZoom(Zs,D),Xt&&(D=Math.round(D/(Xt/100))*(Xt/100),D=_?Math.ceil(D/Xt)*Xt:Math.floor(D/Xt)*Xt),Math.max(K,Math.min(re,D))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new G(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(d,_){var A=this._getTopLeftPoint(d,_);return new ne(A,A.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(d){return this.options.crs.getProjectedBounds(d===void 0?this.getZoom():d)},getPane:function(d){return typeof d=="string"?this._panes[d]:d},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(d,_){var A=this.options.crs;return _=_===void 0?this._zoom:_,A.scale(d)/A.scale(_)},getScaleZoom:function(d,_){var A=this.options.crs;_=_===void 0?this._zoom:_;var D=A.zoom(d*A.scale(_));return isNaN(D)?1/0:D},project:function(d,_){return _=_===void 0?this._zoom:_,this.options.crs.latLngToPoint(de(d),_)},unproject:function(d,_){return _=_===void 0?this._zoom:_,this.options.crs.pointToLatLng(Q(d),_)},layerPointToLatLng:function(d){var _=Q(d).add(this.getPixelOrigin());return this.unproject(_)},latLngToLayerPoint:function(d){var _=this.project(de(d))._round();return _._subtract(this.getPixelOrigin())},wrapLatLng:function(d){return this.options.crs.wrapLatLng(de(d))},wrapLatLngBounds:function(d){return this.options.crs.wrapLatLngBounds(Pe(d))},distance:function(d,_){return this.options.crs.distance(de(d),de(_))},containerPointToLayerPoint:function(d){return Q(d).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(d){return Q(d).add(this._getMapPanePos())},containerPointToLatLng:function(d){var _=this.containerPointToLayerPoint(Q(d));return this.layerPointToLatLng(_)},latLngToContainerPoint:function(d){return this.layerPointToContainerPoint(this.latLngToLayerPoint(de(d)))},mouseEventToContainerPoint:function(d){return Pl(d,this._container)},mouseEventToLayerPoint:function(d){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(d))},mouseEventToLatLng:function(d){return this.layerPointToLatLng(this.mouseEventToLayerPoint(d))},_initContainer:function(d){var _=this._container=we(d);if(_){if(_._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");jn(_,"scroll",this._onScroll,this),this._containerId=l(_)},_initLayout:function(){var d=this._container;this._fadeAnimated=this.options.fadeAnimation&&te.any3d,st(d,"leaflet-container"+(te.touch?" leaflet-touch":"")+(te.retina?" leaflet-retina":"")+(te.ielt9?" leaflet-oldie":"")+(te.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var _=Ee(d,"position");_!=="absolute"&&_!=="relative"&&_!=="fixed"&&_!=="sticky"&&(d.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var d=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),fn(this._mapPane,new G(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(st(d.markerPane,"leaflet-zoom-hide"),st(d.shadowPane,"leaflet-zoom-hide"))},_resetView:function(d,_,A){fn(this._mapPane,new G(0,0));var D=!this._loaded;this._loaded=!0,_=this._limitZoom(_),this.fire("viewprereset");var K=this._zoom!==_;this._moveStart(K,A)._move(d,_)._moveEnd(K),this.fire("viewreset"),D&&this.fire("load")},_moveStart:function(d,_){return d&&this.fire("zoomstart"),_||this.fire("movestart"),this},_move:function(d,_,A,D){_===void 0&&(_=this._zoom);var K=this._zoom!==_;return this._zoom=_,this._lastCenter=d,this._pixelOrigin=this._getNewPixelOrigin(d),D?A&&A.pinch&&this.fire("zoom",A):((K||A&&A.pinch)&&this.fire("zoom",A),this.fire("move",A)),this},_moveEnd:function(d){return d&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return j(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(d){fn(this._mapPane,this._getMapPanePos().subtract(d))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(d){this._targets={},this._targets[l(this._container)]=this;var _=d?Ji:jn;_(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&_(window,"resize",this._onResize,this),te.any3d&&this.options.transform3DLimit&&(d?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){j(this._resizeRequest),this._resizeRequest=F(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var d=this._getMapPanePos();Math.max(Math.abs(d.x),Math.abs(d.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(d,_){for(var A=[],D,K=_==="mouseout"||_==="mouseover",re=d.target||d.srcElement,Me=!1;re;){if(D=this._targets[l(re)],D&&(_==="click"||_==="preclick")&&this._draggableMoved(D)){Me=!0;break}if(D&&D.listens(_,!0)&&(K&&!P1(re,d)||(A.push(D),K))||re===this._container)break;re=re.parentNode}return!A.length&&!Me&&!K&&this.listens(_,!0)&&(A=[this]),A},_isClickDisabled:function(d){for(;d&&d!==this._container;){if(d._leaflet_disable_click)return!0;d=d.parentNode}},_handleDOMEvent:function(d){var _=d.target||d.srcElement;if(!(!this._loaded||_._leaflet_disable_events||d.type==="click"&&this._isClickDisabled(_))){var A=d.type;A==="mousedown"&&wx(_),this._fireDOMEvent(d,A)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(d,_,A){if(d.type==="click"){var D=r({},d);D.type="preclick",this._fireDOMEvent(D,D.type,A)}var K=this._findEventTargets(d,_);if(A){for(var re=[],Me=0;Me<A.length;Me++)A[Me].listens(_,!0)&&re.push(A[Me]);K=re.concat(K)}if(K.length){_==="contextmenu"&&vs(d);var Ze=K[0],lt={originalEvent:d};if(d.type!=="keypress"&&d.type!=="keydown"&&d.type!=="keyup"){var Mt=Ze.getLatLng&&(!Ze._radius||Ze._radius<=10);lt.containerPoint=Mt?this.latLngToContainerPoint(Ze.getLatLng()):this.mouseEventToContainerPoint(d),lt.layerPoint=this.containerPointToLayerPoint(lt.containerPoint),lt.latlng=Mt?Ze.getLatLng():this.layerPointToLatLng(lt.layerPoint)}for(Me=0;Me<K.length;Me++)if(K[Me].fire(_,lt,!0),lt.originalEvent._stopped||K[Me].options.bubblingMouseEvents===!1&&M(this._mouseEvents,_)!==-1)return}},_draggableMoved:function(d){return d=d.dragging&&d.dragging.enabled()?d:this,d.dragging&&d.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var d=0,_=this._handlers.length;d<_;d++)this._handlers[d].disable()},whenReady:function(d,_){return this._loaded?d.call(_||this,{target:this}):this.on("load",d,_),this},_getMapPanePos:function(){return pn(this._mapPane)||new G(0,0)},_moved:function(){var d=this._getMapPanePos();return d&&!d.equals([0,0])},_getTopLeftPoint:function(d,_){var A=d&&_!==void 0?this._getNewPixelOrigin(d,_):this.getPixelOrigin();return A.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(d,_){var A=this.getSize()._divideBy(2);return this.project(d,_)._subtract(A)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(d,_,A){var D=this._getNewPixelOrigin(A,_);return this.project(d,_)._subtract(D)},_latLngBoundsToNewLayerBounds:function(d,_,A){var D=this._getNewPixelOrigin(A,_);return fe([this.project(d.getSouthWest(),_)._subtract(D),this.project(d.getNorthWest(),_)._subtract(D),this.project(d.getSouthEast(),_)._subtract(D),this.project(d.getNorthEast(),_)._subtract(D)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(d){return this.latLngToLayerPoint(d).subtract(this._getCenterLayerPoint())},_limitCenter:function(d,_,A){if(!A)return d;var D=this.project(d,_),K=this.getSize().divideBy(2),re=new ne(D.subtract(K),D.add(K)),Me=this._getBoundsOffset(re,A,_);return Math.abs(Me.x)<=1&&Math.abs(Me.y)<=1?d:this.unproject(D.add(Me),_)},_limitOffset:function(d,_){if(!_)return d;var A=this.getPixelBounds(),D=new ne(A.min.add(d),A.max.add(d));return d.add(this._getBoundsOffset(D,_))},_getBoundsOffset:function(d,_,A){var D=fe(this.project(_.getNorthEast(),A),this.project(_.getSouthWest(),A)),K=D.min.subtract(d.min),re=D.max.subtract(d.max),Me=this._rebound(K.x,-re.x),Ze=this._rebound(K.y,-re.y);return new G(Me,Ze)},_rebound:function(d,_){return d+_>0?Math.round(d-_)/2:Math.max(0,Math.ceil(d))-Math.max(0,Math.floor(_))},_limitZoom:function(d){var _=this.getMinZoom(),A=this.getMaxZoom(),D=te.any3d?this.options.zoomSnap:1;return D&&(d=Math.round(d/D)*D),Math.max(_,Math.min(A,d))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){_t(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(d,_){var A=this._getCenterOffset(d)._trunc();return(_&&_.animate)!==!0&&!this.getSize().contains(A)?!1:(this.panBy(A,_),!0)},_createAnimProxy:function(){var d=this._proxy=De("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(d),this.on("zoomanim",function(_){var A=Te,D=this._proxy.style[A];gn(this._proxy,this.project(_.center,_.zoom),this.getZoomScale(_.zoom,1)),D===this._proxy.style[A]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Le(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var d=this.getCenter(),_=this.getZoom();gn(this._proxy,this.project(d,_),this.getZoomScale(_,1))},_catchTransitionEnd:function(d){this._animatingZoom&&d.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(d,_,A){if(this._animatingZoom)return!0;if(A=A||{},!this._zoomAnimated||A.animate===!1||this._nothingToAnimate()||Math.abs(_-this._zoom)>this.options.zoomAnimationThreshold)return!1;var D=this.getZoomScale(_),K=this._getCenterOffset(d)._divideBy(1-1/D);return A.animate!==!0&&!this.getSize().contains(K)?!1:(F(function(){this._moveStart(!0,A.noMoveStart||!1)._animateZoom(d,_,!0)},this),!0)},_animateZoom:function(d,_,A,D){this._mapPane&&(A&&(this._animatingZoom=!0,this._animateToCenter=d,this._animateToZoom=_,st(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:d,zoom:_,noUpdate:D}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&_t(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function k1(d,_){return new hi(d,_)}var il=U.extend({options:{position:"topright"},initialize:function(d){b(this,d)},getPosition:function(){return this.options.position},setPosition:function(d){var _=this._map;return _&&_.removeControl(this),this.options.position=d,_&&_.addControl(this),this},getContainer:function(){return this._container},addTo:function(d){this.remove(),this._map=d;var _=this._container=this.onAdd(d),A=this.getPosition(),D=d._controlCorners[A];return st(_,"leaflet-control"),A.indexOf("bottom")!==-1?D.insertBefore(_,D.firstChild):D.appendChild(_),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Le(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(d){this._map&&d&&d.screenX>0&&d.screenY>0&&this._map.getContainer().focus()}}),Ws=function(d){return new il(d)};hi.include({addControl:function(d){return d.addTo(this),this},removeControl:function(d){return d.remove(),this},_initControlPos:function(){var d=this._controlCorners={},_="leaflet-",A=this._controlContainer=De("div",_+"control-container",this._container);function D(K,re){var Me=_+K+" "+_+re;d[K+re]=De("div",Me,A)}D("top","left"),D("top","right"),D("bottom","left"),D("bottom","right")},_clearControlPos:function(){for(var d in this._controlCorners)Le(this._controlCorners[d]);Le(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var ep=il.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(d,_,A,D){return A<D?-1:D<A?1:0}},initialize:function(d,_,A){b(this,A),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var D in d)this._addLayer(d[D],D);for(D in _)this._addLayer(_[D],D,!0)},onAdd:function(d){this._initLayout(),this._update(),this._map=d,d.on("zoomend",this._checkDisabledLayers,this);for(var _=0;_<this._layers.length;_++)this._layers[_].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(d){return il.prototype.addTo.call(this,d),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var d=0;d<this._layers.length;d++)this._layers[d].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(d,_){return this._addLayer(d,_),this._map?this._update():this},addOverlay:function(d,_){return this._addLayer(d,_,!0),this._map?this._update():this},removeLayer:function(d){d.off("add remove",this._onLayerChange,this);var _=this._getLayer(l(d));return _&&this._layers.splice(this._layers.indexOf(_),1),this._map?this._update():this},expand:function(){st(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var d=this._map.getSize().y-(this._container.offsetTop+50);return d<this._section.clientHeight?(st(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=d+"px"):_t(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return _t(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var d="leaflet-control-layers",_=this._container=De("div",d),A=this.options.collapsed;_.setAttribute("aria-haspopup",!0),co(_),Wd(_);var D=this._section=De("section",d+"-list");A&&(this._map.on("click",this.collapse,this),jn(_,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var K=this._layersLink=De("a",d+"-toggle",_);K.href="#",K.title="Layers",K.setAttribute("role","button"),jn(K,{keydown:function(re){re.keyCode===13&&this._expandSafely()},click:function(re){vs(re),this._expandSafely()}},this),A||this.expand(),this._baseLayersList=De("div",d+"-base",D),this._separator=De("div",d+"-separator",D),this._overlaysList=De("div",d+"-overlays",D),_.appendChild(D)},_getLayer:function(d){for(var _=0;_<this._layers.length;_++)if(this._layers[_]&&l(this._layers[_].layer)===d)return this._layers[_]},_addLayer:function(d,_,A){this._map&&d.on("add remove",this._onLayerChange,this),this._layers.push({layer:d,name:_,overlay:A}),this.options.sortLayers&&this._layers.sort(o(function(D,K){return this.options.sortFunction(D.layer,K.layer,D.name,K.name)},this)),this.options.autoZIndex&&d.setZIndex&&(this._lastZIndex++,d.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;ae(this._baseLayersList),ae(this._overlaysList),this._layerControlInputs=[];var d,_,A,D,K=0;for(A=0;A<this._layers.length;A++)D=this._layers[A],this._addItem(D),_=_||D.overlay,d=d||!D.overlay,K+=D.overlay?0:1;return this.options.hideSingleBase&&(d=d&&K>1,this._baseLayersList.style.display=d?"":"none"),this._separator.style.display=_&&d?"":"none",this},_onLayerChange:function(d){this._handlingClick||this._update();var _=this._getLayer(l(d.target)),A=_.overlay?d.type==="add"?"overlayadd":"overlayremove":d.type==="add"?"baselayerchange":null;A&&this._map.fire(A,_)},_createRadioElement:function(d,_){var A='<input type="radio" class="leaflet-control-layers-selector" name="'+d+'"'+(_?' checked="checked"':"")+"/>",D=document.createElement("div");return D.innerHTML=A,D.firstChild},_addItem:function(d){var _=document.createElement("label"),A=this._map.hasLayer(d.layer),D;d.overlay?(D=document.createElement("input"),D.type="checkbox",D.className="leaflet-control-layers-selector",D.defaultChecked=A):D=this._createRadioElement("leaflet-base-layers_"+l(this),A),this._layerControlInputs.push(D),D.layerId=l(d.layer),jn(D,"click",this._onInputClick,this);var K=document.createElement("span");K.innerHTML=" "+d.name;var re=document.createElement("span");_.appendChild(re),re.appendChild(D),re.appendChild(K);var Me=d.overlay?this._overlaysList:this._baseLayersList;return Me.appendChild(_),this._checkDisabledLayers(),_},_onInputClick:function(){if(!this._preventClick){var d=this._layerControlInputs,_,A,D=[],K=[];this._handlingClick=!0;for(var re=d.length-1;re>=0;re--)_=d[re],A=this._getLayer(_.layerId).layer,_.checked?D.push(A):_.checked||K.push(A);for(re=0;re<K.length;re++)this._map.hasLayer(K[re])&&this._map.removeLayer(K[re]);for(re=0;re<D.length;re++)this._map.hasLayer(D[re])||this._map.addLayer(D[re]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var d=this._layerControlInputs,_,A,D=this._map.getZoom(),K=d.length-1;K>=0;K--)_=d[K],A=this._getLayer(_.layerId).layer,_.disabled=A.options.minZoom!==void 0&&D<A.options.minZoom||A.options.maxZoom!==void 0&&D>A.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var d=this._section;this._preventClick=!0,jn(d,"click",vs),this.expand();var _=this;setTimeout(function(){Ji(d,"click",vs),_._preventClick=!1})}}),L1=function(d,_,A){return new ep(d,_,A)},yu=il.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(d){var _="leaflet-control-zoom",A=De("div",_+" leaflet-bar"),D=this.options;return this._zoomInButton=this._createButton(D.zoomInText,D.zoomInTitle,_+"-in",A,this._zoomIn),this._zoomOutButton=this._createButton(D.zoomOutText,D.zoomOutTitle,_+"-out",A,this._zoomOut),this._updateDisabled(),d.on("zoomend zoomlevelschange",this._updateDisabled,this),A},onRemove:function(d){d.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(d){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(d.shiftKey?3:1))},_zoomOut:function(d){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(d.shiftKey?3:1))},_createButton:function(d,_,A,D,K){var re=De("a",A,D);return re.innerHTML=d,re.href="#",re.title=_,re.setAttribute("role","button"),re.setAttribute("aria-label",_),co(re),jn(re,"click",_h),jn(re,"click",K,this),jn(re,"click",this._refocusOnMap,this),re},_updateDisabled:function(){var d=this._map,_="leaflet-disabled";_t(this._zoomInButton,_),_t(this._zoomOutButton,_),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||d._zoom===d.getMinZoom())&&(st(this._zoomOutButton,_),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||d._zoom===d.getMaxZoom())&&(st(this._zoomInButton,_),this._zoomInButton.setAttribute("aria-disabled","true"))}});hi.mergeOptions({zoomControl:!0}),hi.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new yu,this.addControl(this.zoomControl))});var Tx=function(d){return new yu(d)},D1=il.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(d){var _="leaflet-control-scale",A=De("div",_),D=this.options;return this._addScales(D,_+"-line",A),d.on(D.updateWhenIdle?"moveend":"move",this._update,this),d.whenReady(this._update,this),A},onRemove:function(d){d.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(d,_,A){d.metric&&(this._mScale=De("div",_,A)),d.imperial&&(this._iScale=De("div",_,A))},_update:function(){var d=this._map,_=d.getSize().y/2,A=d.distance(d.containerPointToLatLng([0,_]),d.containerPointToLatLng([this.options.maxWidth,_]));this._updateScales(A)},_updateScales:function(d){this.options.metric&&d&&this._updateMetric(d),this.options.imperial&&d&&this._updateImperial(d)},_updateMetric:function(d){var _=this._getRoundNum(d),A=_<1e3?_+" m":_/1e3+" km";this._updateScale(this._mScale,A,_/d)},_updateImperial:function(d){var _=d*3.2808399,A,D,K;_>5280?(A=_/5280,D=this._getRoundNum(A),this._updateScale(this._iScale,D+" mi",D/A)):(K=this._getRoundNum(_),this._updateScale(this._iScale,K+" ft",K/_))},_updateScale:function(d,_,A){d.style.width=Math.round(this.options.maxWidth*A)+"px",d.innerHTML=_},_getRoundNum:function(d){var _=Math.pow(10,(Math.floor(d)+"").length-1),A=d/_;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:1,_*A}}),rw=function(d){return new D1(d)},Ax='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',tp=il.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(te.inlineSvg?Ax+" ":"")+"Leaflet</a>"},initialize:function(d){b(this,d),this._attributions={}},onAdd:function(d){d.attributionControl=this,this._container=De("div","leaflet-control-attribution"),co(this._container);for(var _ in d._layers)d._layers[_].getAttribution&&this.addAttribution(d._layers[_].getAttribution());return this._update(),d.on("layeradd",this._addAttribution,this),this._container},onRemove:function(d){d.off("layeradd",this._addAttribution,this)},_addAttribution:function(d){d.layer.getAttribution&&(this.addAttribution(d.layer.getAttribution()),d.layer.once("remove",function(){this.removeAttribution(d.layer.getAttribution())},this))},setPrefix:function(d){return this.options.prefix=d,this._update(),this},addAttribution:function(d){return d?(this._attributions[d]||(this._attributions[d]=0),this._attributions[d]++,this._update(),this):this},removeAttribution:function(d){return d?(this._attributions[d]&&(this._attributions[d]--,this._update()),this):this},_update:function(){if(this._map){var d=[];for(var _ in this._attributions)this._attributions[_]&&d.push(_);var A=[];this.options.prefix&&A.push(this.options.prefix),d.length&&A.push(d.join(", ")),this._container.innerHTML=A.join(' <span aria-hidden="true">|</span> ')}}});hi.mergeOptions({attributionControl:!0}),hi.addInitHook(function(){this.options.attributionControl&&new tp().addTo(this)});var Kd=function(d){return new tp(d)};il.Layers=ep,il.Zoom=yu,il.Scale=D1,il.Attribution=tp,Ws.layers=L1,Ws.zoom=Tx,Ws.scale=rw,Ws.attribution=Kd;var Or=U.extend({initialize:function(d){this._map=d},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Or.addTo=function(d,_){return d.addHandler(_,this),this};var kl={Events:q},Ec=te.touch?"touchstart mousedown":"mousedown",Ll=J.extend({options:{clickTolerance:3},initialize:function(d,_,A,D){b(this,D),this._element=d,this._dragStartTarget=_||d,this._preventOutline=A},enable:function(){this._enabled||(jn(this._dragStartTarget,Ec,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Ll._dragging===this&&this.finishDrag(!0),Ji(this._dragStartTarget,Ec,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(d){if(this._enabled&&(this._moved=!1,!We(this._element,"leaflet-zoom-anim"))){if(d.touches&&d.touches.length!==1){Ll._dragging===this&&this.finishDrag();return}if(!(Ll._dragging||d.shiftKey||d.which!==1&&d.button!==1&&!d.touches)&&(Ll._dragging=this,this._preventOutline&&wx(this._element),Zi(),En(),!this._moving)){this.fire("down");var _=d.touches?d.touches[0]:d,A=yi(this._element);this._startPoint=new G(_.clientX,_.clientY),this._startPos=pn(this._element),this._parentScale=R1(A);var D=d.type==="mousedown";jn(document,D?"mousemove":"touchmove",this._onMove,this),jn(document,D?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(d){if(this._enabled){if(d.touches&&d.touches.length>1){this._moved=!0;return}var _=d.touches&&d.touches.length===1?d.touches[0]:d,A=new G(_.clientX,_.clientY)._subtract(this._startPoint);!A.x&&!A.y||Math.abs(A.x)+Math.abs(A.y)<this.options.clickTolerance||(A.x/=this._parentScale.x,A.y/=this._parentScale.y,vs(d),this._moved||(this.fire("dragstart"),this._moved=!0,st(document.body,"leaflet-dragging"),this._lastTarget=d.target||d.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),st(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(A),this._moving=!0,this._lastEvent=d,this._updatePosition())}},_updatePosition:function(){var d={originalEvent:this._lastEvent};this.fire("predrag",d),fn(this._element,this._newPos),this.fire("drag",d)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(d){_t(document.body,"leaflet-dragging"),this._lastTarget&&(_t(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ji(document,"mousemove touchmove",this._onMove,this),Ji(document,"mouseup touchend touchcancel",this._onUp,this),Ni(),Un();var _=this._moved&&this._moving;this._moving=!1,Ll._dragging=!1,_&&this.fire("dragend",{noInertia:d,distance:this._newPos.distanceTo(this._startPos)})}});function Cx(d,_,A){var D,K=[1,4,2,8],re,Me,Ze,lt,Mt,Xt,Dn,ii;for(re=0,Xt=d.length;re<Xt;re++)d[re]._code=Tc(d[re],_);for(Ze=0;Ze<4;Ze++){for(Dn=K[Ze],D=[],re=0,Xt=d.length,Me=Xt-1;re<Xt;Me=re++)lt=d[re],Mt=d[Me],lt._code&Dn?Mt._code&Dn||(ii=rp(Mt,lt,Dn,_,A),ii._code=Tc(ii,_),D.push(ii)):(Mt._code&Dn&&(ii=rp(Mt,lt,Dn,_,A),ii._code=Tc(ii,_),D.push(ii)),D.push(lt));d=D}return d}function Dl(d,_){var A,D,K,re,Me,Ze,lt,Mt,Xt;if(!d||d.length===0)throw new Error("latlngs not passed");Ks(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var Dn=de([0,0]),ii=Pe(d),Zs=ii.getNorthWest().distanceTo(ii.getSouthWest())*ii.getNorthEast().distanceTo(ii.getNorthWest());Zs<1700&&(Dn=Ol(d));var Gr=d.length,ho=[];for(A=0;A<Gr;A++){var fo=de(d[A]);ho.push(_.project(de([fo.lat-Dn.lat,fo.lng-Dn.lng])))}for(Ze=lt=Mt=0,A=0,D=Gr-1;A<Gr;D=A++)K=ho[A],re=ho[D],Me=K.y*re.x-re.y*K.x,lt+=(K.x+re.x)*Me,Mt+=(K.y+re.y)*Me,Ze+=Me*3;Ze===0?Xt=ho[0]:Xt=[lt/Ze,Mt/Ze];var Ch=_.unproject(Q(Xt));return de([Ch.lat+Dn.lat,Ch.lng+Dn.lng])}function Ol(d){for(var _=0,A=0,D=0,K=0;K<d.length;K++){var re=de(d[K]);_+=re.lat,A+=re.lng,D++}return de([_/D,A/D])}var O1={__proto__:null,clipPolygon:Cx,polygonCenter:Dl,centroid:Ol};function Mx(d,_){if(!_||!d.length)return d.slice();var A=_*_;return d=B1(d,A),d=ow(d,A),d}function np(d,_,A){return Math.sqrt(Bl(d,_,A,!0))}function sw(d,_,A){return Bl(d,_,A)}function ow(d,_){var A=d.length,D=typeof Uint8Array!=void 0+""?Uint8Array:Array,K=new D(A);K[0]=K[A-1]=1,ip(d,K,_,0,A-1);var re,Me=[];for(re=0;re<A;re++)K[re]&&Me.push(d[re]);return Me}function ip(d,_,A,D,K){var re=0,Me,Ze,lt;for(Ze=D+1;Ze<=K-1;Ze++)lt=Bl(d[Ze],d[D],d[K],!0),lt>re&&(Me=Ze,re=lt);re>A&&(_[Me]=1,ip(d,_,A,D,Me),ip(d,_,A,Me,K))}function B1(d,_){for(var A=[d[0]],D=1,K=0,re=d.length;D<re;D++)qd(d[D],d[K])>_&&(A.push(d[D]),K=D);return K<re-1&&A.push(d[re-1]),A}var Rx;function Ix(d,_,A,D,K){var re=D?Rx:Tc(d,A),Me=Tc(_,A),Ze,lt,Mt;for(Rx=Me;;){if(!(re|Me))return[d,_];if(re&Me)return!1;Ze=re||Me,lt=rp(d,_,Ze,A,K),Mt=Tc(lt,A),Ze===re?(d=lt,re=Mt):(_=lt,Me=Mt)}}function rp(d,_,A,D,K){var re=_.x-d.x,Me=_.y-d.y,Ze=D.min,lt=D.max,Mt,Xt;return A&8?(Mt=d.x+re*(lt.y-d.y)/Me,Xt=lt.y):A&4?(Mt=d.x+re*(Ze.y-d.y)/Me,Xt=Ze.y):A&2?(Mt=lt.x,Xt=d.y+Me*(lt.x-d.x)/re):A&1&&(Mt=Ze.x,Xt=d.y+Me*(Ze.x-d.x)/re),new G(Mt,Xt,K)}function Tc(d,_){var A=0;return d.x<_.min.x?A|=1:d.x>_.max.x&&(A|=2),d.y<_.min.y?A|=4:d.y>_.max.y&&(A|=8),A}function qd(d,_){var A=_.x-d.x,D=_.y-d.y;return A*A+D*D}function Bl(d,_,A,D){var K=_.x,re=_.y,Me=A.x-K,Ze=A.y-re,lt=Me*Me+Ze*Ze,Mt;return lt>0&&(Mt=((d.x-K)*Me+(d.y-re)*Ze)/lt,Mt>1?(K=A.x,re=A.y):Mt>0&&(K+=Me*Mt,re+=Ze*Mt)),Me=d.x-K,Ze=d.y-re,D?Me*Me+Ze*Ze:new G(K,re)}function Ks(d){return!S(d[0])||typeof d[0][0]!="object"&&typeof d[0][0]<"u"}function sp(d){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Ks(d)}function Wo(d,_){var A,D,K,re,Me,Ze,lt,Mt;if(!d||d.length===0)throw new Error("latlngs not passed");Ks(d)||(console.warn("latlngs are not flat! Only the first ring will be used"),d=d[0]);var Xt=de([0,0]),Dn=Pe(d),ii=Dn.getNorthWest().distanceTo(Dn.getSouthWest())*Dn.getNorthEast().distanceTo(Dn.getNorthWest());ii<1700&&(Xt=Ol(d));var Zs=d.length,Gr=[];for(A=0;A<Zs;A++){var ho=de(d[A]);Gr.push(_.project(de([ho.lat-Xt.lat,ho.lng-Xt.lng])))}for(A=0,D=0;A<Zs-1;A++)D+=Gr[A].distanceTo(Gr[A+1])/2;if(D===0)Mt=Gr[0];else for(A=0,re=0;A<Zs-1;A++)if(Me=Gr[A],Ze=Gr[A+1],K=Me.distanceTo(Ze),re+=K,re>D){lt=(re-D)/K,Mt=[Ze.x-lt*(Ze.x-Me.x),Ze.y-lt*(Ze.y-Me.y)];break}var fo=_.unproject(Q(Mt));return de([fo.lat+Xt.lat,fo.lng+Xt.lng])}var xa={__proto__:null,simplify:Mx,pointToSegmentDistance:np,closestPointOnSegment:sw,clipSegment:Ix,_getEdgeIntersection:rp,_getBitCode:Tc,_sqClosestPointOnSegment:Bl,isFlat:Ks,_flat:sp,polylineCenter:Wo},Ac={project:function(d){return new G(d.lng,d.lat)},unproject:function(d){return new Ce(d.y,d.x)},bounds:new ne([-180,-90],[180,90])},rl={R:6378137,R_MINOR:6356752314245179e-9,bounds:new ne([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(d){var _=Math.PI/180,A=this.R,D=d.lat*_,K=this.R_MINOR/A,re=Math.sqrt(1-K*K),Me=re*Math.sin(D),Ze=Math.tan(Math.PI/4-D/2)/Math.pow((1-Me)/(1+Me),re/2);return D=-A*Math.log(Math.max(Ze,1e-10)),new G(d.lng*_*A,D)},unproject:function(d){for(var _=180/Math.PI,A=this.R,D=this.R_MINOR/A,K=Math.sqrt(1-D*D),re=Math.exp(-d.y/A),Me=Math.PI/2-2*Math.atan(re),Ze=0,lt=.1,Mt;Ze<15&&Math.abs(lt)>1e-7;Ze++)Mt=K*Math.sin(Me),Mt=Math.pow((1-Mt)/(1+Mt),K/2),lt=Math.PI/2-2*Math.atan(re*Mt)-Me,Me+=lt;return new Ce(Me*_,d.x*_/A)}},Cc={__proto__:null,LonLat:Ac,Mercator:rl,SphericalMercator:nt},wh=r({},et,{code:"EPSG:3395",projection:rl,transformation:function(){var d=.5/(Math.PI*rl.R);return zt(d,.5,-d,.5)}()}),Nx=r({},et,{code:"EPSG:4326",projection:Ac,transformation:zt(1/180,1,-1/180,.5)}),Px=r({},Ne,{projection:Ac,transformation:zt(1,0,-1,0),scale:function(d){return Math.pow(2,d)},zoom:function(d){return Math.log(d)/Math.LN2},distance:function(d,_){var A=_.lng-d.lng,D=_.lat-d.lat;return Math.sqrt(A*A+D*D)},infinite:!0});Ne.Earth=et,Ne.EPSG3395=wh,Ne.EPSG3857=Dt,Ne.EPSG900913=gt,Ne.EPSG4326=Nx,Ne.Simple=Px;var Ko=J.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(d){return d.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(d){return d&&d.removeLayer(this),this},getPane:function(d){return this._map.getPane(d?this.options[d]||d:this.options.pane)},addInteractiveTarget:function(d){return this._map._targets[l(d)]=this,this},removeInteractiveTarget:function(d){return delete this._map._targets[l(d)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(d){var _=d.target;if(_.hasLayer(this)){if(this._map=_,this._zoomAnimated=_._zoomAnimated,this.getEvents){var A=this.getEvents();_.on(A,this),this.once("remove",function(){_.off(A,this)},this)}this.onAdd(_),this.fire("add"),_.fire("layeradd",{layer:this})}}});hi.include({addLayer:function(d){if(!d._layerAdd)throw new Error("The provided object is not a Layer.");var _=l(d);return this._layers[_]?this:(this._layers[_]=d,d._mapToAdd=this,d.beforeAdd&&d.beforeAdd(this),this.whenReady(d._layerAdd,d),this)},removeLayer:function(d){var _=l(d);return this._layers[_]?(this._loaded&&d.onRemove(this),delete this._layers[_],this._loaded&&(this.fire("layerremove",{layer:d}),d.fire("remove")),d._map=d._mapToAdd=null,this):this},hasLayer:function(d){return l(d)in this._layers},eachLayer:function(d,_){for(var A in this._layers)d.call(_,this._layers[A]);return this},_addLayers:function(d){d=d?S(d)?d:[d]:[];for(var _=0,A=d.length;_<A;_++)this.addLayer(d[_])},_addZoomLimit:function(d){(!isNaN(d.options.maxZoom)||!isNaN(d.options.minZoom))&&(this._zoomBoundLayers[l(d)]=d,this._updateZoomLevels())},_removeZoomLimit:function(d){var _=l(d);this._zoomBoundLayers[_]&&(delete this._zoomBoundLayers[_],this._updateZoomLevels())},_updateZoomLevels:function(){var d=1/0,_=-1/0,A=this._getZoomSpan();for(var D in this._zoomBoundLayers){var K=this._zoomBoundLayers[D].options;d=K.minZoom===void 0?d:Math.min(d,K.minZoom),_=K.maxZoom===void 0?_:Math.max(_,K.maxZoom)}this._layersMaxZoom=_===-1/0?void 0:_,this._layersMinZoom=d===1/0?void 0:d,A!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var rs=Ko.extend({initialize:function(d,_){b(this,_),this._layers={};var A,D;if(d)for(A=0,D=d.length;A<D;A++)this.addLayer(d[A])},addLayer:function(d){var _=this.getLayerId(d);return this._layers[_]=d,this._map&&this._map.addLayer(d),this},removeLayer:function(d){var _=d in this._layers?d:this.getLayerId(d);return this._map&&this._layers[_]&&this._map.removeLayer(this._layers[_]),delete this._layers[_],this},hasLayer:function(d){var _=typeof d=="number"?d:this.getLayerId(d);return _ in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(d){var _=Array.prototype.slice.call(arguments,1),A,D;for(A in this._layers)D=this._layers[A],D[d]&&D[d].apply(D,_);return this},onAdd:function(d){this.eachLayer(d.addLayer,d)},onRemove:function(d){this.eachLayer(d.removeLayer,d)},eachLayer:function(d,_){for(var A in this._layers)d.call(_,this._layers[A]);return this},getLayer:function(d){return this._layers[d]},getLayers:function(){var d=[];return this.eachLayer(d.push,d),d},setZIndex:function(d){return this.invoke("setZIndex",d)},getLayerId:function(d){return l(d)}}),qo=function(d,_){return new rs(d,_)},Si=rs.extend({addLayer:function(d){return this.hasLayer(d)?this:(d.addEventParent(this),rs.prototype.addLayer.call(this,d),this.fire("layeradd",{layer:d}))},removeLayer:function(d){return this.hasLayer(d)?(d in this._layers&&(d=this._layers[d]),d.removeEventParent(this),rs.prototype.removeLayer.call(this,d),this.fire("layerremove",{layer:d})):this},setStyle:function(d){return this.invoke("setStyle",d)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var d=new Ae;for(var _ in this._layers){var A=this._layers[_];d.extend(A.getBounds?A.getBounds():A.getLatLng())}return d}}),op=function(d,_){return new Si(d,_)},Ns=U.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(d){b(this,d)},createIcon:function(d){return this._createIcon("icon",d)},createShadow:function(d){return this._createIcon("shadow",d)},_createIcon:function(d,_){var A=this._getIconUrl(d);if(!A){if(d==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var D=this._createImg(A,_&&_.tagName==="IMG"?_:null);return this._setIconStyles(D,d),(this.options.crossOrigin||this.options.crossOrigin==="")&&(D.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),D},_setIconStyles:function(d,_){var A=this.options,D=A[_+"Size"];typeof D=="number"&&(D=[D,D]);var K=Q(D),re=Q(_==="shadow"&&A.shadowAnchor||A.iconAnchor||K&&K.divideBy(2,!0));d.className="leaflet-marker-"+_+" "+(A.className||""),re&&(d.style.marginLeft=-re.x+"px",d.style.marginTop=-re.y+"px"),K&&(d.style.width=K.x+"px",d.style.height=K.y+"px")},_createImg:function(d,_){return _=_||document.createElement("img"),_.src=d,_},_getIconUrl:function(d){return te.retina&&this.options[d+"RetinaUrl"]||this.options[d+"Url"]}});function aw(d){return new Ns(d)}var Zd=Ns.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(d){return typeof Zd.imagePath!="string"&&(Zd.imagePath=this._detectIconPath()),(this.options.imagePath||Zd.imagePath)+Ns.prototype._getIconUrl.call(this,d)},_stripUrl:function(d){var _=function(A,D,K){var re=D.exec(A);return re&&re[K]};return d=_(d,/^url\((['"])?(.+)\1\)$/,2),d&&_(d,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var d=De("div","leaflet-default-icon-path",document.body),_=Ee(d,"background-image")||Ee(d,"backgroundImage");if(document.body.removeChild(d),_=this._stripUrl(_),_)return _;var A=document.querySelector('link[href$="leaflet.css"]');return A?A.href.substring(0,A.href.length-11-1):""}}),U1=Or.extend({initialize:function(d){this._marker=d},addHooks:function(){var d=this._marker._icon;this._draggable||(this._draggable=new Ll(d,d,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),st(d,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&_t(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(d){var _=this._marker,A=_._map,D=this._marker.options.autoPanSpeed,K=this._marker.options.autoPanPadding,re=pn(_._icon),Me=A.getPixelBounds(),Ze=A.getPixelOrigin(),lt=fe(Me.min._subtract(Ze).add(K),Me.max._subtract(Ze).subtract(K));if(!lt.contains(re)){var Mt=Q((Math.max(lt.max.x,re.x)-lt.max.x)/(Me.max.x-lt.max.x)-(Math.min(lt.min.x,re.x)-lt.min.x)/(Me.min.x-lt.min.x),(Math.max(lt.max.y,re.y)-lt.max.y)/(Me.max.y-lt.max.y)-(Math.min(lt.min.y,re.y)-lt.min.y)/(Me.min.y-lt.min.y)).multiplyBy(D);A.panBy(Mt,{animate:!1}),this._draggable._newPos._add(Mt),this._draggable._startPos._add(Mt),fn(_._icon,this._draggable._newPos),this._onDrag(d),this._panRequest=F(this._adjustPan.bind(this,d))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(d){this._marker.options.autoPan&&(j(this._panRequest),this._panRequest=F(this._adjustPan.bind(this,d)))},_onDrag:function(d){var _=this._marker,A=_._shadow,D=pn(_._icon),K=_._map.layerPointToLatLng(D);A&&fn(A,D),_._latlng=K,d.latlng=K,d.oldLatLng=this._oldLatLng,_.fire("move",d).fire("drag",d)},_onDragEnd:function(d){j(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",d)}}),Yd=Ko.extend({options:{icon:new Zd,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(d,_){b(this,_),this._latlng=de(d)},onAdd:function(d){this._zoomAnimated=this._zoomAnimated&&d.options.markerZoomAnimation,this._zoomAnimated&&d.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(d){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&d.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(d){var _=this._latlng;return this._latlng=de(d),this.update(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},setZIndexOffset:function(d){return this.options.zIndexOffset=d,this.update()},getIcon:function(){return this.options.icon},setIcon:function(d){return this.options.icon=d,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var d=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(d)}return this},_initIcon:function(){var d=this.options,_="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),A=d.icon.createIcon(this._icon),D=!1;A!==this._icon&&(this._icon&&this._removeIcon(),D=!0,d.title&&(A.title=d.title),A.tagName==="IMG"&&(A.alt=d.alt||"")),st(A,_),d.keyboard&&(A.tabIndex="0",A.setAttribute("role","button")),this._icon=A,d.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&jn(A,"focus",this._panOnFocus,this);var K=d.icon.createShadow(this._shadow),re=!1;K!==this._shadow&&(this._removeShadow(),re=!0),K&&(st(K,_),K.alt=""),this._shadow=K,d.opacity<1&&this._updateOpacity(),D&&this.getPane().appendChild(this._icon),this._initInteraction(),K&&re&&this.getPane(d.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ji(this._icon,"focus",this._panOnFocus,this),Le(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Le(this._shadow),this._shadow=null},_setPos:function(d){this._icon&&fn(this._icon,d),this._shadow&&fn(this._shadow,d),this._zIndex=d.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(d){this._icon&&(this._icon.style.zIndex=this._zIndex+d)},_animateZoom:function(d){var _=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center).round();this._setPos(_)},_initInteraction:function(){if(this.options.interactive&&(st(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),U1)){var d=this.options.draggable;this.dragging&&(d=this.dragging.enabled(),this.dragging.disable()),this.dragging=new U1(this),d&&this.dragging.enable()}},setOpacity:function(d){return this.options.opacity=d,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var d=this.options.opacity;this._icon&&Nt(this._icon,d),this._shadow&&Nt(this._shadow,d)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var d=this._map;if(d){var _=this.options.icon.options,A=_.iconSize?Q(_.iconSize):Q(0,0),D=_.iconAnchor?Q(_.iconAnchor):Q(0,0);d.panInside(this._latlng,{paddingTopLeft:D,paddingBottomRight:A.subtract(D)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function lw(d,_){return new Yd(d,_)}var va=Ko.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(d){this._renderer=d.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(d){return b(this,d),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&d&&Object.prototype.hasOwnProperty.call(d,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Mc=va.extend({options:{fill:!0,radius:10},initialize:function(d,_){b(this,_),this._latlng=de(d),this._radius=this.options.radius},setLatLng:function(d){var _=this._latlng;return this._latlng=de(d),this.redraw(),this.fire("move",{oldLatLng:_,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(d){return this.options.radius=this._radius=d,this.redraw()},getRadius:function(){return this._radius},setStyle:function(d){var _=d&&d.radius||this._radius;return va.prototype.setStyle.call(this,d),this.setRadius(_),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var d=this._radius,_=this._radiusY||d,A=this._clickTolerance(),D=[d+A,_+A];this._pxBounds=new ne(this._point.subtract(D),this._point.add(D))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(d){return d.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function kx(d,_){return new Mc(d,_)}var Sh=Mc.extend({initialize:function(d,_,A){if(typeof _=="number"&&(_=r({},A,{radius:_})),b(this,_),this._latlng=de(d),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(d){return this._mRadius=d,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var d=[this._radius,this._radiusY||this._radius];return new Ae(this._map.layerPointToLatLng(this._point.subtract(d)),this._map.layerPointToLatLng(this._point.add(d)))},setStyle:va.prototype.setStyle,_project:function(){var d=this._latlng.lng,_=this._latlng.lat,A=this._map,D=A.options.crs;if(D.distance===et.distance){var K=Math.PI/180,re=this._mRadius/et.R/K,Me=A.project([_+re,d]),Ze=A.project([_-re,d]),lt=Me.add(Ze).divideBy(2),Mt=A.unproject(lt).lat,Xt=Math.acos((Math.cos(re*K)-Math.sin(_*K)*Math.sin(Mt*K))/(Math.cos(_*K)*Math.cos(Mt*K)))/K;(isNaN(Xt)||Xt===0)&&(Xt=re/Math.cos(Math.PI/180*_)),this._point=lt.subtract(A.getPixelOrigin()),this._radius=isNaN(Xt)?0:lt.x-A.project([Mt,d-Xt]).x,this._radiusY=lt.y-Me.y}else{var Dn=D.unproject(D.project(this._latlng).subtract([this._mRadius,0]));this._point=A.latLngToLayerPoint(this._latlng),this._radius=this._point.x-A.latLngToLayerPoint(Dn).x}this._updateBounds()}});function F1(d,_,A){return new Sh(d,_,A)}var Ul=va.extend({options:{smoothFactor:1,noClip:!1},initialize:function(d,_){b(this,_),this._setLatLngs(d)},getLatLngs:function(){return this._latlngs},setLatLngs:function(d){return this._setLatLngs(d),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(d){for(var _=1/0,A=null,D=Bl,K,re,Me=0,Ze=this._parts.length;Me<Ze;Me++)for(var lt=this._parts[Me],Mt=1,Xt=lt.length;Mt<Xt;Mt++){K=lt[Mt-1],re=lt[Mt];var Dn=D(d,K,re,!0);Dn<_&&(_=Dn,A=D(d,K,re))}return A&&(A.distance=Math.sqrt(_)),A},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Wo(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(d,_){return _=_||this._defaultShape(),d=de(d),_.push(d),this._bounds.extend(d),this.redraw()},_setLatLngs:function(d){this._bounds=new Ae,this._latlngs=this._convertLatLngs(d)},_defaultShape:function(){return Ks(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(d){for(var _=[],A=Ks(d),D=0,K=d.length;D<K;D++)A?(_[D]=de(d[D]),this._bounds.extend(_[D])):_[D]=this._convertLatLngs(d[D]);return _},_project:function(){var d=new ne;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,d),this._bounds.isValid()&&d.isValid()&&(this._rawPxBounds=d,this._updateBounds())},_updateBounds:function(){var d=this._clickTolerance(),_=new G(d,d);this._rawPxBounds&&(this._pxBounds=new ne([this._rawPxBounds.min.subtract(_),this._rawPxBounds.max.add(_)]))},_projectLatlngs:function(d,_,A){var D=d[0]instanceof Ce,K=d.length,re,Me;if(D){for(Me=[],re=0;re<K;re++)Me[re]=this._map.latLngToLayerPoint(d[re]),A.extend(Me[re]);_.push(Me)}else for(re=0;re<K;re++)this._projectLatlngs(d[re],_,A)},_clipPoints:function(){var d=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}var _=this._parts,A,D,K,re,Me,Ze,lt;for(A=0,K=0,re=this._rings.length;A<re;A++)for(lt=this._rings[A],D=0,Me=lt.length;D<Me-1;D++)Ze=Ix(lt[D],lt[D+1],d,D,!0),Ze&&(_[K]=_[K]||[],_[K].push(Ze[0]),(Ze[1]!==lt[D+1]||D===Me-2)&&(_[K].push(Ze[1]),K++))}},_simplifyPoints:function(){for(var d=this._parts,_=this.options.smoothFactor,A=0,D=d.length;A<D;A++)d[A]=Mx(d[A],_)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(d,_){var A,D,K,re,Me,Ze,lt=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(A=0,re=this._parts.length;A<re;A++)for(Ze=this._parts[A],D=0,Me=Ze.length,K=Me-1;D<Me;K=D++)if(!(!_&&D===0)&&np(d,Ze[K],Ze[D])<=lt)return!0;return!1}});function cw(d,_){return new Ul(d,_)}Ul._flat=sp;var sl=Ul.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Dl(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(d){var _=Ul.prototype._convertLatLngs.call(this,d),A=_.length;return A>=2&&_[0]instanceof Ce&&_[0].equals(_[A-1])&&_.pop(),_},_setLatLngs:function(d){Ul.prototype._setLatLngs.call(this,d),Ks(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Ks(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var d=this._renderer._bounds,_=this.options.weight,A=new G(_,_);if(d=new ne(d.min.subtract(A),d.max.add(A)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(d))){if(this.options.noClip){this._parts=this._rings;return}for(var D=0,K=this._rings.length,re;D<K;D++)re=Cx(this._rings[D],d,!0),re.length&&this._parts.push(re)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(d){var _=!1,A,D,K,re,Me,Ze,lt,Mt;if(!this._pxBounds||!this._pxBounds.contains(d))return!1;for(re=0,lt=this._parts.length;re<lt;re++)for(A=this._parts[re],Me=0,Mt=A.length,Ze=Mt-1;Me<Mt;Ze=Me++)D=A[Me],K=A[Ze],D.y>d.y!=K.y>d.y&&d.x<(K.x-D.x)*(d.y-D.y)/(K.y-D.y)+D.x&&(_=!_);return _||Ul.prototype._containsPoint.call(this,d,!0)}});function uw(d,_){return new sl(d,_)}var Zo=Si.extend({initialize:function(d,_){b(this,_),this._layers={},d&&this.addData(d)},addData:function(d){var _=S(d)?d:d.features,A,D,K;if(_){for(A=0,D=_.length;A<D;A++)K=_[A],(K.geometries||K.geometry||K.features||K.coordinates)&&this.addData(K);return this}var re=this.options;if(re.filter&&!re.filter(d))return this;var Me=qs(d,re);return Me?(Me.feature=Qd(d),Me.defaultOptions=Me.options,this.resetStyle(Me),re.onEachFeature&&re.onEachFeature(d,Me),this.addLayer(Me)):this},resetStyle:function(d){return d===void 0?this.eachLayer(this.resetStyle,this):(d.options=r({},d.defaultOptions),this._setLayerStyle(d,this.options.style),this)},setStyle:function(d){return this.eachLayer(function(_){this._setLayerStyle(_,d)},this)},_setLayerStyle:function(d,_){d.setStyle&&(typeof _=="function"&&(_=_(d.feature)),d.setStyle(_))}});function qs(d,_){var A=d.type==="Feature"?d.geometry:d,D=A?A.coordinates:null,K=[],re=_&&_.pointToLayer,Me=_&&_.coordsToLatLng||xu,Ze,lt,Mt,Xt;if(!D&&!A)return null;switch(A.type){case"Point":return Ze=Me(D),Xd(re,d,Ze,_);case"MultiPoint":for(Mt=0,Xt=D.length;Mt<Xt;Mt++)Ze=Me(D[Mt]),K.push(Xd(re,d,Ze,_));return new Si(K);case"LineString":case"MultiLineString":return lt=Yo(D,A.type==="LineString"?0:1,Me),new Ul(lt,_);case"Polygon":case"MultiPolygon":return lt=Yo(D,A.type==="Polygon"?1:2,Me),new sl(lt,_);case"GeometryCollection":for(Mt=0,Xt=A.geometries.length;Mt<Xt;Mt++){var Dn=qs({geometry:A.geometries[Mt],type:"Feature",properties:d.properties},_);Dn&&K.push(Dn)}return new Si(K);case"FeatureCollection":for(Mt=0,Xt=A.features.length;Mt<Xt;Mt++){var ii=qs(A.features[Mt],_);ii&&K.push(ii)}return new Si(K);default:throw new Error("Invalid GeoJSON object.")}}function Xd(d,_,A,D){return d?d(_,A):new Yd(A,D&&D.markersInheritOptions&&D)}function xu(d){return new Ce(d[1],d[0],d[2])}function Yo(d,_,A){for(var D=[],K=0,re=d.length,Me;K<re;K++)Me=_?Yo(d[K],_-1,A):(A||xu)(d[K]),D.push(Me);return D}function ap(d,_){return d=de(d),d.alt!==void 0?[p(d.lng,_),p(d.lat,_),p(d.alt,_)]:[p(d.lng,_),p(d.lat,_)]}function Rc(d,_,A,D){for(var K=[],re=0,Me=d.length;re<Me;re++)K.push(_?Rc(d[re],Ks(d[re])?0:_-1,A,D):ap(d[re],D));return!_&&A&&K.length>0&&K.push(K[0].slice()),K}function Eh(d,_){return d.feature?r({},d.feature,{geometry:_}):Qd(_)}function Qd(d){return d.type==="Feature"||d.type==="FeatureCollection"?d:{type:"Feature",properties:{},geometry:d}}var ur={toGeoJSON:function(d){return Eh(this,{type:"Point",coordinates:ap(this.getLatLng(),d)})}};Yd.include(ur),Sh.include(ur),Mc.include(ur),Ul.include({toGeoJSON:function(d){var _=!Ks(this._latlngs),A=Rc(this._latlngs,_?1:0,!1,d);return Eh(this,{type:(_?"Multi":"")+"LineString",coordinates:A})}}),sl.include({toGeoJSON:function(d){var _=!Ks(this._latlngs),A=_&&!Ks(this._latlngs[0]),D=Rc(this._latlngs,A?2:_?1:0,!0,d);return _||(D=[D]),Eh(this,{type:(A?"Multi":"")+"Polygon",coordinates:D})}}),rs.include({toMultiPoint:function(d){var _=[];return this.eachLayer(function(A){_.push(A.toGeoJSON(d).geometry.coordinates)}),Eh(this,{type:"MultiPoint",coordinates:_})},toGeoJSON:function(d){var _=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(_==="MultiPoint")return this.toMultiPoint(d);var A=_==="GeometryCollection",D=[];return this.eachLayer(function(K){if(K.toGeoJSON){var re=K.toGeoJSON(d);if(A)D.push(re.geometry);else{var Me=Qd(re);Me.type==="FeatureCollection"?D.push.apply(D,Me.features):D.push(Me)}}}),A?Eh(this,{geometries:D,type:"GeometryCollection"}):{type:"FeatureCollection",features:D}}});function lp(d,_){return new Zo(d,_)}var Lx=lp,Jd=Ko.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(d,_,A){this._url=d,this._bounds=Pe(_),b(this,A)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(st(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Le(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(d){return this.options.opacity=d,this._image&&this._updateOpacity(),this},setStyle:function(d){return d.opacity&&this.setOpacity(d.opacity),this},bringToFront:function(){return this._map&&be(this._image),this},bringToBack:function(){return this._map&&Ue(this._image),this},setUrl:function(d){return this._url=d,this._image&&(this._image.src=d),this},setBounds:function(d){return this._bounds=Pe(d),this._map&&this._reset(),this},getEvents:function(){var d={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var d=this._url.tagName==="IMG",_=this._image=d?this._url:De("img");if(st(_,"leaflet-image-layer"),this._zoomAnimated&&st(_,"leaflet-zoom-animated"),this.options.className&&st(_,this.options.className),_.onselectstart=h,_.onmousemove=h,_.onload=o(this.fire,this,"load"),_.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(_.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),d){this._url=_.src;return}_.src=this._url,_.alt=this.options.alt},_animateZoom:function(d){var _=this._map.getZoomScale(d.zoom),A=this._map._latLngBoundsToNewLayerBounds(this._bounds,d.zoom,d.center).min;gn(this._image,A,_)},_reset:function(){var d=this._image,_=new ne(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),A=_.getSize();fn(d,_.min),d.style.width=A.x+"px",d.style.height=A.y+"px"},_updateOpacity:function(){Nt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var d=this.options.errorOverlayUrl;d&&this._url!==d&&(this._url=d,this._image.src=d)},getCenter:function(){return this._bounds.getCenter()}}),z1=function(d,_,A){return new Jd(d,_,A)},Xo=Jd.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var d=this._url.tagName==="VIDEO",_=this._image=d?this._url:De("video");if(st(_,"leaflet-image-layer"),this._zoomAnimated&&st(_,"leaflet-zoom-animated"),this.options.className&&st(_,this.options.className),_.onselectstart=h,_.onmousemove=h,_.onloadeddata=o(this.fire,this,"load"),d){for(var A=_.getElementsByTagName("source"),D=[],K=0;K<A.length;K++)D.push(A[K].src);this._url=A.length>0?D:[_.src];return}S(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(_.style,"objectFit")&&(_.style.objectFit="fill"),_.autoplay=!!this.options.autoplay,_.loop=!!this.options.loop,_.muted=!!this.options.muted,_.playsInline=!!this.options.playsInline;for(var re=0;re<this._url.length;re++){var Me=De("source");Me.src=this._url[re],_.appendChild(Me)}}});function ef(d,_,A){return new Xo(d,_,A)}var Sr=Jd.extend({_initImage:function(){var d=this._image=this._url;st(d,"leaflet-image-layer"),this._zoomAnimated&&st(d,"leaflet-zoom-animated"),this.options.className&&st(d,this.options.className),d.onselectstart=h,d.onmousemove=h}});function Ps(d,_,A){return new Sr(d,_,A)}var Yi=Ko.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(d,_){d&&(d instanceof Ce||S(d))?(this._latlng=de(d),b(this,_)):(b(this,d),this._source=_),this.options.content&&(this._content=this.options.content)},openOn:function(d){return d=arguments.length?d:this._source._map,d.hasLayer(this)||d.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(d){return this._map?this.close():(arguments.length?this._source=d:d=this._source,this._prepareOpen(),this.openOn(d._map)),this},onAdd:function(d){this._zoomAnimated=d._zoomAnimated,this._container||this._initLayout(),d._fadeAnimated&&Nt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),d._fadeAnimated&&Nt(this._container,1),this.bringToFront(),this.options.interactive&&(st(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(d){d._fadeAnimated?(Nt(this._container,0),this._removeTimeout=setTimeout(o(Le,void 0,this._container),200)):Le(this._container),this.options.interactive&&(_t(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(d){return this._latlng=de(d),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(d){return this._content=d,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var d={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&be(this._container),this},bringToBack:function(){return this._map&&Ue(this._container),this},_prepareOpen:function(d){var _=this._source;if(!_._map)return!1;if(_ instanceof Si){_=null;var A=this._source._layers;for(var D in A)if(A[D]._map){_=A[D];break}if(!_)return!1;this._source=_}if(!d)if(_.getCenter)d=_.getCenter();else if(_.getLatLng)d=_.getLatLng();else if(_.getBounds)d=_.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(d),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var d=this._contentNode,_=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof _=="string")d.innerHTML=_;else{for(;d.hasChildNodes();)d.removeChild(d.firstChild);d.appendChild(_)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var d=this._map.latLngToLayerPoint(this._latlng),_=Q(this.options.offset),A=this._getAnchor();this._zoomAnimated?fn(this._container,d.add(A)):_=_.add(d).add(A);var D=this._containerBottom=-_.y,K=this._containerLeft=-Math.round(this._containerWidth/2)+_.x;this._container.style.bottom=D+"px",this._container.style.left=K+"px"}},_getAnchor:function(){return[0,0]}});hi.include({_initOverlay:function(d,_,A,D){var K=_;return K instanceof d||(K=new d(D).setContent(_)),A&&K.setLatLng(A),K}}),Ko.include({_initOverlay:function(d,_,A,D){var K=A;return K instanceof d?(b(K,D),K._source=this):(K=_&&!D?_:new d(D,this),K.setContent(A)),K}});var Th=Yi.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(d){return d=arguments.length?d:this._source._map,!d.hasLayer(this)&&d._popup&&d._popup.options.autoClose&&d.removeLayer(d._popup),d._popup=this,Yi.prototype.openOn.call(this,d)},onAdd:function(d){Yi.prototype.onAdd.call(this,d),d.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof va||this._source.on("preclick",bh))},onRemove:function(d){Yi.prototype.onRemove.call(this,d),d.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof va||this._source.off("preclick",bh))},getEvents:function(){var d=Yi.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(d.preclick=this.close),this.options.keepInView&&(d.moveend=this._adjustPan),d},_initLayout:function(){var d="leaflet-popup",_=this._container=De("div",d+" "+(this.options.className||"")+" leaflet-zoom-animated"),A=this._wrapper=De("div",d+"-content-wrapper",_);if(this._contentNode=De("div",d+"-content",A),co(_),Wd(this._contentNode),jn(_,"contextmenu",bh),this._tipContainer=De("div",d+"-tip-container",_),this._tip=De("div",d+"-tip",this._tipContainer),this.options.closeButton){var D=this._closeButton=De("a",d+"-close-button",_);D.setAttribute("role","button"),D.setAttribute("aria-label","Close popup"),D.href="#close",D.innerHTML='<span aria-hidden="true">&#215;</span>',jn(D,"click",function(K){vs(K),this.close()},this)}},_updateLayout:function(){var d=this._contentNode,_=d.style;_.width="",_.whiteSpace="nowrap";var A=d.offsetWidth;A=Math.min(A,this.options.maxWidth),A=Math.max(A,this.options.minWidth),_.width=A+1+"px",_.whiteSpace="",_.height="";var D=d.offsetHeight,K=this.options.maxHeight,re="leaflet-popup-scrolled";K&&D>K?(_.height=K+"px",st(d,re)):_t(d,re),this._containerWidth=this._container.offsetWidth},_animateZoom:function(d){var _=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center),A=this._getAnchor();fn(this._container,_.add(A))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var d=this._map,_=parseInt(Ee(this._container,"marginBottom"),10)||0,A=this._container.offsetHeight+_,D=this._containerWidth,K=new G(this._containerLeft,-A-this._containerBottom);K._add(pn(this._container));var re=d.layerPointToContainerPoint(K),Me=Q(this.options.autoPanPadding),Ze=Q(this.options.autoPanPaddingTopLeft||Me),lt=Q(this.options.autoPanPaddingBottomRight||Me),Mt=d.getSize(),Xt=0,Dn=0;re.x+D+lt.x>Mt.x&&(Xt=re.x+D-Mt.x+lt.x),re.x-Xt-Ze.x<0&&(Xt=re.x-Ze.x),re.y+A+lt.y>Mt.y&&(Dn=re.y+A-Mt.y+lt.y),re.y-Dn-Ze.y<0&&(Dn=re.y-Ze.y),(Xt||Dn)&&(this.options.keepInView&&(this._autopanning=!0),d.fire("autopanstart").panBy([Xt,Dn]))}},_getAnchor:function(){return Q(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),cp=function(d,_){return new Th(d,_)};hi.mergeOptions({closePopupOnClick:!0}),hi.include({openPopup:function(d,_,A){return this._initOverlay(Th,d,_,A).openOn(this),this},closePopup:function(d){return d=arguments.length?d:this._popup,d&&d.close(),this}}),Ko.include({bindPopup:function(d,_){return this._popup=this._initOverlay(Th,this._popup,d,_),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(d){return this._popup&&(this instanceof Si||(this._popup._source=this),this._popup._prepareOpen(d||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(d){return this._popup&&this._popup.setContent(d),this},getPopup:function(){return this._popup},_openPopup:function(d){if(!(!this._popup||!this._map)){_h(d);var _=d.layer||d.target;if(this._popup._source===_&&!(_ instanceof va)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(d.latlng);return}this._popup._source=_,this.openPopup(d.latlng)}},_movePopup:function(d){this._popup.setLatLng(d.latlng)},_onKeyPress:function(d){d.originalEvent.keyCode===13&&this._openPopup(d)}});var vu=Yi.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(d){Yi.prototype.onAdd.call(this,d),this.setOpacity(this.options.opacity),d.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(d){Yi.prototype.onRemove.call(this,d),d.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var d=Yi.prototype.getEvents.call(this);return this.options.permanent||(d.preclick=this.close),d},_initLayout:function(){var d="leaflet-tooltip",_=d+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=De("div",_),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(d){var _,A,D=this._map,K=this._container,re=D.latLngToContainerPoint(D.getCenter()),Me=D.layerPointToContainerPoint(d),Ze=this.options.direction,lt=K.offsetWidth,Mt=K.offsetHeight,Xt=Q(this.options.offset),Dn=this._getAnchor();Ze==="top"?(_=lt/2,A=Mt):Ze==="bottom"?(_=lt/2,A=0):Ze==="center"?(_=lt/2,A=Mt/2):Ze==="right"?(_=0,A=Mt/2):Ze==="left"?(_=lt,A=Mt/2):Me.x<re.x?(Ze="right",_=0,A=Mt/2):(Ze="left",_=lt+(Xt.x+Dn.x)*2,A=Mt/2),d=d.subtract(Q(_,A,!0)).add(Xt).add(Dn),_t(K,"leaflet-tooltip-right"),_t(K,"leaflet-tooltip-left"),_t(K,"leaflet-tooltip-top"),_t(K,"leaflet-tooltip-bottom"),st(K,"leaflet-tooltip-"+Ze),fn(K,d)},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},setOpacity:function(d){this.options.opacity=d,this._container&&Nt(this._container,d)},_animateZoom:function(d){var _=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(_)},_getAnchor:function(){return Q(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),oT=function(d,_){return new vu(d,_)};hi.include({openTooltip:function(d,_,A){return this._initOverlay(vu,d,_,A).openOn(this),this},closeTooltip:function(d){return d.close(),this}}),Ko.include({bindTooltip:function(d,_){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(vu,this._tooltip,d,_),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(d){if(!(!d&&this._tooltipHandlersAdded)){var _=d?"off":"on",A={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?A.add=this._openTooltip:(A.mouseover=this._openTooltip,A.mouseout=this.closeTooltip,A.click=this._openTooltip,this._map?this._addFocusListeners():A.add=this._addFocusListeners),this._tooltip.options.sticky&&(A.mousemove=this._moveTooltip),this[_](A),this._tooltipHandlersAdded=!d}},openTooltip:function(d){return this._tooltip&&(this instanceof Si||(this._tooltip._source=this),this._tooltip._prepareOpen(d)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(d){return this._tooltip&&this._tooltip.setContent(d),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(d){var _=typeof d.getElement=="function"&&d.getElement();_&&(jn(_,"focus",function(){this._tooltip._source=d,this.openTooltip()},this),jn(_,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(d){var _=typeof d.getElement=="function"&&d.getElement();_&&_.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(d){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var _=this;this._map.once("moveend",function(){_._openOnceFlag=!1,_._openTooltip(d)});return}this._tooltip._source=d.layer||d.target,this.openTooltip(this._tooltip.options.sticky?d.latlng:void 0)}},_moveTooltip:function(d){var _=d.latlng,A,D;this._tooltip.options.sticky&&d.originalEvent&&(A=this._map.mouseEventToContainerPoint(d.originalEvent),D=this._map.containerPointToLayerPoint(A),_=this._map.layerPointToLatLng(D)),this._tooltip.setLatLng(_)}});var bs=Ns.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(d){var _=d&&d.tagName==="DIV"?d:document.createElement("div"),A=this.options;if(A.html instanceof Element?(ae(_),_.appendChild(A.html)):_.innerHTML=A.html!==!1?A.html:"",A.bgPos){var D=Q(A.bgPos);_.style.backgroundPosition=-D.x+"px "+-D.y+"px"}return this._setIconStyles(_,"icon"),_},createShadow:function(){return null}});function Dx(d){return new bs(d)}Ns.Default=Zd;var Ah=Ko.extend({options:{tileSize:256,opacity:1,updateWhenIdle:te.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(d){b(this,d)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(d){d._addZoomLimit(this)},onRemove:function(d){this._removeAllTiles(),Le(this._container),d._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(be(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Ue(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(d){return this.options.opacity=d,this._updateOpacity(),this},setZIndex:function(d){return this.options.zIndex=d,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var d=this._clampZoom(this._map.getZoom());d!==this._tileZoom&&(this._tileZoom=d,this._updateLevels()),this._update()}return this},getEvents:function(){var d={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),d.move=this._onMove),this._zoomAnimated&&(d.zoomanim=this._animateZoom),d},createTile:function(){return document.createElement("div")},getTileSize:function(){var d=this.options.tileSize;return d instanceof G?d:new G(d,d)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(d){for(var _=this.getPane().children,A=-d(-1/0,1/0),D=0,K=_.length,re;D<K;D++)re=_[D].style.zIndex,_[D]!==this._container&&re&&(A=d(A,+re));isFinite(A)&&(this.options.zIndex=A+d(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!te.ielt9){Nt(this._container,this.options.opacity);var d=+new Date,_=!1,A=!1;for(var D in this._tiles){var K=this._tiles[D];if(!(!K.current||!K.loaded)){var re=Math.min(1,(d-K.loaded)/200);Nt(K.el,re),re<1?_=!0:(K.active?A=!0:this._onOpaqueTile(K),K.active=!0)}}A&&!this._noPrune&&this._pruneTiles(),_&&(j(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this))}},_onOpaqueTile:h,_initContainer:function(){this._container||(this._container=De("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var d=this._tileZoom,_=this.options.maxZoom;if(d!==void 0){for(var A in this._levels)A=Number(A),this._levels[A].el.children.length||A===d?(this._levels[A].el.style.zIndex=_-Math.abs(d-A),this._onUpdateLevel(A)):(Le(this._levels[A].el),this._removeTilesAtZoom(A),this._onRemoveLevel(A),delete this._levels[A]);var D=this._levels[d],K=this._map;return D||(D=this._levels[d]={},D.el=De("div","leaflet-tile-container leaflet-zoom-animated",this._container),D.el.style.zIndex=_,D.origin=K.project(K.unproject(K.getPixelOrigin()),d).round(),D.zoom=d,this._setZoomTransform(D,K.getCenter(),K.getZoom()),h(D.el.offsetWidth),this._onCreateLevel(D)),this._level=D,D}},_onUpdateLevel:h,_onRemoveLevel:h,_onCreateLevel:h,_pruneTiles:function(){if(this._map){var d,_,A=this._map.getZoom();if(A>this.options.maxZoom||A<this.options.minZoom){this._removeAllTiles();return}for(d in this._tiles)_=this._tiles[d],_.retain=_.current;for(d in this._tiles)if(_=this._tiles[d],_.current&&!_.active){var D=_.coords;this._retainParent(D.x,D.y,D.z,D.z-5)||this._retainChildren(D.x,D.y,D.z,D.z+2)}for(d in this._tiles)this._tiles[d].retain||this._removeTile(d)}},_removeTilesAtZoom:function(d){for(var _ in this._tiles)this._tiles[_].coords.z===d&&this._removeTile(_)},_removeAllTiles:function(){for(var d in this._tiles)this._removeTile(d)},_invalidateAll:function(){for(var d in this._levels)Le(this._levels[d].el),this._onRemoveLevel(Number(d)),delete this._levels[d];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(d,_,A,D){var K=Math.floor(d/2),re=Math.floor(_/2),Me=A-1,Ze=new G(+K,+re);Ze.z=+Me;var lt=this._tileCoordsToKey(Ze),Mt=this._tiles[lt];return Mt&&Mt.active?(Mt.retain=!0,!0):(Mt&&Mt.loaded&&(Mt.retain=!0),Me>D?this._retainParent(K,re,Me,D):!1)},_retainChildren:function(d,_,A,D){for(var K=2*d;K<2*d+2;K++)for(var re=2*_;re<2*_+2;re++){var Me=new G(K,re);Me.z=A+1;var Ze=this._tileCoordsToKey(Me),lt=this._tiles[Ze];if(lt&&lt.active){lt.retain=!0;continue}else lt&&lt.loaded&&(lt.retain=!0);A+1<D&&this._retainChildren(K,re,A+1,D)}},_resetView:function(d){var _=d&&(d.pinch||d.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),_,_)},_animateZoom:function(d){this._setView(d.center,d.zoom,!0,d.noUpdate)},_clampZoom:function(d){var _=this.options;return _.minNativeZoom!==void 0&&d<_.minNativeZoom?_.minNativeZoom:_.maxNativeZoom!==void 0&&_.maxNativeZoom<d?_.maxNativeZoom:d},_setView:function(d,_,A,D){var K=Math.round(_);this.options.maxZoom!==void 0&&K>this.options.maxZoom||this.options.minZoom!==void 0&&K<this.options.minZoom?K=void 0:K=this._clampZoom(K);var re=this.options.updateWhenZooming&&K!==this._tileZoom;(!D||re)&&(this._tileZoom=K,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),K!==void 0&&this._update(d),A||this._pruneTiles(),this._noPrune=!!A),this._setZoomTransforms(d,_)},_setZoomTransforms:function(d,_){for(var A in this._levels)this._setZoomTransform(this._levels[A],d,_)},_setZoomTransform:function(d,_,A){var D=this._map.getZoomScale(A,d.zoom),K=d.origin.multiplyBy(D).subtract(this._map._getNewPixelOrigin(_,A)).round();te.any3d?gn(d.el,K,D):fn(d.el,K)},_resetGrid:function(){var d=this._map,_=d.options.crs,A=this._tileSize=this.getTileSize(),D=this._tileZoom,K=this._map.getPixelWorldBounds(this._tileZoom);K&&(this._globalTileRange=this._pxBoundsToTileRange(K)),this._wrapX=_.wrapLng&&!this.options.noWrap&&[Math.floor(d.project([0,_.wrapLng[0]],D).x/A.x),Math.ceil(d.project([0,_.wrapLng[1]],D).x/A.y)],this._wrapY=_.wrapLat&&!this.options.noWrap&&[Math.floor(d.project([_.wrapLat[0],0],D).y/A.x),Math.ceil(d.project([_.wrapLat[1],0],D).y/A.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(d){var _=this._map,A=_._animatingZoom?Math.max(_._animateToZoom,_.getZoom()):_.getZoom(),D=_.getZoomScale(A,this._tileZoom),K=_.project(d,this._tileZoom).floor(),re=_.getSize().divideBy(D*2);return new ne(K.subtract(re),K.add(re))},_update:function(d){var _=this._map;if(_){var A=this._clampZoom(_.getZoom());if(d===void 0&&(d=_.getCenter()),this._tileZoom!==void 0){var D=this._getTiledPixelBounds(d),K=this._pxBoundsToTileRange(D),re=K.getCenter(),Me=[],Ze=this.options.keepBuffer,lt=new ne(K.getBottomLeft().subtract([Ze,-Ze]),K.getTopRight().add([Ze,-Ze]));if(!(isFinite(K.min.x)&&isFinite(K.min.y)&&isFinite(K.max.x)&&isFinite(K.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Mt in this._tiles){var Xt=this._tiles[Mt].coords;(Xt.z!==this._tileZoom||!lt.contains(new G(Xt.x,Xt.y)))&&(this._tiles[Mt].current=!1)}if(Math.abs(A-this._tileZoom)>1){this._setView(d,A);return}for(var Dn=K.min.y;Dn<=K.max.y;Dn++)for(var ii=K.min.x;ii<=K.max.x;ii++){var Zs=new G(ii,Dn);if(Zs.z=this._tileZoom,!!this._isValidTile(Zs)){var Gr=this._tiles[this._tileCoordsToKey(Zs)];Gr?Gr.current=!0:Me.push(Zs)}}if(Me.sort(function(fo,Ch){return fo.distanceTo(re)-Ch.distanceTo(re)}),Me.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var ho=document.createDocumentFragment();for(ii=0;ii<Me.length;ii++)this._addTile(Me[ii],ho);this._level.el.appendChild(ho)}}}},_isValidTile:function(d){var _=this._map.options.crs;if(!_.infinite){var A=this._globalTileRange;if(!_.wrapLng&&(d.x<A.min.x||d.x>A.max.x)||!_.wrapLat&&(d.y<A.min.y||d.y>A.max.y))return!1}if(!this.options.bounds)return!0;var D=this._tileCoordsToBounds(d);return Pe(this.options.bounds).overlaps(D)},_keyToBounds:function(d){return this._tileCoordsToBounds(this._keyToTileCoords(d))},_tileCoordsToNwSe:function(d){var _=this._map,A=this.getTileSize(),D=d.scaleBy(A),K=D.add(A),re=_.unproject(D,d.z),Me=_.unproject(K,d.z);return[re,Me]},_tileCoordsToBounds:function(d){var _=this._tileCoordsToNwSe(d),A=new Ae(_[0],_[1]);return this.options.noWrap||(A=this._map.wrapLatLngBounds(A)),A},_tileCoordsToKey:function(d){return d.x+":"+d.y+":"+d.z},_keyToTileCoords:function(d){var _=d.split(":"),A=new G(+_[0],+_[1]);return A.z=+_[2],A},_removeTile:function(d){var _=this._tiles[d];_&&(Le(_.el),delete this._tiles[d],this.fire("tileunload",{tile:_.el,coords:this._keyToTileCoords(d)}))},_initTile:function(d){st(d,"leaflet-tile");var _=this.getTileSize();d.style.width=_.x+"px",d.style.height=_.y+"px",d.onselectstart=h,d.onmousemove=h,te.ielt9&&this.options.opacity<1&&Nt(d,this.options.opacity)},_addTile:function(d,_){var A=this._getTilePos(d),D=this._tileCoordsToKey(d),K=this.createTile(this._wrapCoords(d),o(this._tileReady,this,d));this._initTile(K),this.createTile.length<2&&F(o(this._tileReady,this,d,null,K)),fn(K,A),this._tiles[D]={el:K,coords:d,current:!0},_.appendChild(K),this.fire("tileloadstart",{tile:K,coords:d})},_tileReady:function(d,_,A){_&&this.fire("tileerror",{error:_,tile:A,coords:d});var D=this._tileCoordsToKey(d);A=this._tiles[D],A&&(A.loaded=+new Date,this._map._fadeAnimated?(Nt(A.el,0),j(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this)):(A.active=!0,this._pruneTiles()),_||(st(A.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:A.el,coords:d})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),te.ielt9||!this._map._fadeAnimated?F(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(d){return d.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(d){var _=new G(this._wrapX?u(d.x,this._wrapX):d.x,this._wrapY?u(d.y,this._wrapY):d.y);return _.z=d.z,_},_pxBoundsToTileRange:function(d){var _=this.getTileSize();return new ne(d.min.unscaleBy(_).floor(),d.max.unscaleBy(_).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var d in this._tiles)if(!this._tiles[d].loaded)return!1;return!0}});function Ox(d){return new Ah(d)}var uo=Ah.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(d,_){this._url=d,_=b(this,_),_.detectRetina&&te.retina&&_.maxZoom>0?(_.tileSize=Math.floor(_.tileSize/2),_.zoomReverse?(_.zoomOffset--,_.minZoom=Math.min(_.maxZoom,_.minZoom+1)):(_.zoomOffset++,_.maxZoom=Math.max(_.minZoom,_.maxZoom-1)),_.minZoom=Math.max(0,_.minZoom)):_.zoomReverse?_.minZoom=Math.min(_.maxZoom,_.minZoom):_.maxZoom=Math.max(_.minZoom,_.maxZoom),typeof _.subdomains=="string"&&(_.subdomains=_.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(d,_){return this._url===d&&_===void 0&&(_=!0),this._url=d,_||this.redraw(),this},createTile:function(d,_){var A=document.createElement("img");return jn(A,"load",o(this._tileOnLoad,this,_,A)),jn(A,"error",o(this._tileOnError,this,_,A)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(A.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(A.referrerPolicy=this.options.referrerPolicy),A.alt="",A.src=this.getTileUrl(d),A},getTileUrl:function(d){var _={r:te.retina?"@2x":"",s:this._getSubdomain(d),x:d.x,y:d.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var A=this._globalTileRange.max.y-d.y;this.options.tms&&(_.y=A),_["-y"]=A}return T(this._url,r(_,this.options))},_tileOnLoad:function(d,_){te.ielt9?setTimeout(o(d,this,null,_),0):d(null,_)},_tileOnError:function(d,_,A){var D=this.options.errorTileUrl;D&&_.getAttribute("src")!==D&&(_.src=D),d(A,_)},_onTileRemove:function(d){d.tile.onload=null},_getZoomForUrl:function(){var d=this._tileZoom,_=this.options.maxZoom,A=this.options.zoomReverse,D=this.options.zoomOffset;return A&&(d=_-d),d+D},_getSubdomain:function(d){var _=Math.abs(d.x+d.y)%this.options.subdomains.length;return this.options.subdomains[_]},_abortLoading:function(){var d,_;for(d in this._tiles)if(this._tiles[d].coords.z!==this._tileZoom&&(_=this._tiles[d].el,_.onload=h,_.onerror=h,!_.complete)){_.src=P;var A=this._tiles[d].coords;Le(_),delete this._tiles[d],this.fire("tileabort",{tile:_,coords:A})}},_removeTile:function(d){var _=this._tiles[d];if(_)return _.el.setAttribute("src",P),Ah.prototype._removeTile.call(this,d)},_tileReady:function(d,_,A){if(!(!this._map||A&&A.getAttribute("src")===P))return Ah.prototype._tileReady.call(this,d,_,A)}});function ol(d,_){return new uo(d,_)}var bu=uo.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(d,_){this._url=d;var A=r({},this.defaultWmsParams);for(var D in _)D in this.options||(A[D]=_[D]);_=b(this,_);var K=_.detectRetina&&te.retina?2:1,re=this.getTileSize();A.width=re.x*K,A.height=re.y*K,this.wmsParams=A},onAdd:function(d){this._crs=this.options.crs||d.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var _=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[_]=this._crs.code,uo.prototype.onAdd.call(this,d)},getTileUrl:function(d){var _=this._tileCoordsToNwSe(d),A=this._crs,D=fe(A.project(_[0]),A.project(_[1])),K=D.min,re=D.max,Me=(this._wmsVersion>=1.3&&this._crs===Nx?[K.y,K.x,re.y,re.x]:[K.x,K.y,re.x,re.y]).join(","),Ze=uo.prototype.getTileUrl.call(this,d);return Ze+w(this.wmsParams,Ze,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Me},setParams:function(d,_){return r(this.wmsParams,d),_||this.redraw(),this}});function j1(d,_){return new bu(d,_)}uo.WMS=bu,ol.wms=j1;var ba=Ko.extend({options:{padding:.1},initialize:function(d){b(this,d),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),st(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var d={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(d.zoomanim=this._onAnimZoom),d},_onAnimZoom:function(d){this._updateTransform(d.center,d.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(d,_){var A=this._map.getZoomScale(_,this._zoom),D=this._map.getSize().multiplyBy(.5+this.options.padding),K=this._map.project(this._center,_),re=D.multiplyBy(-A).add(K).subtract(this._map._getNewPixelOrigin(d,_));te.any3d?gn(this._container,re,A):fn(this._container,re)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var d in this._layers)this._layers[d]._reset()},_onZoomEnd:function(){for(var d in this._layers)this._layers[d]._project()},_updatePaths:function(){for(var d in this._layers)this._layers[d]._update()},_update:function(){var d=this.options.padding,_=this._map.getSize(),A=this._map.containerPointToLayerPoint(_.multiplyBy(-d)).round();this._bounds=new ne(A,A.add(_.multiplyBy(1+d*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Bx=ba.extend({options:{tolerance:0},getEvents:function(){var d=ba.prototype.getEvents.call(this);return d.viewprereset=this._onViewPreReset,d},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ba.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var d=this._container=document.createElement("canvas");jn(d,"mousemove",this._onMouseMove,this),jn(d,"click dblclick mousedown mouseup contextmenu",this._onClick,this),jn(d,"mouseout",this._handleMouseOut,this),d._leaflet_disable_events=!0,this._ctx=d.getContext("2d")},_destroyContainer:function(){j(this._redrawRequest),delete this._ctx,Le(this._container),Ji(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var d;this._redrawBounds=null;for(var _ in this._layers)d=this._layers[_],d._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ba.prototype._update.call(this);var d=this._bounds,_=this._container,A=d.getSize(),D=te.retina?2:1;fn(_,d.min),_.width=D*A.x,_.height=D*A.y,_.style.width=A.x+"px",_.style.height=A.y+"px",te.retina&&this._ctx.scale(2,2),this._ctx.translate(-d.min.x,-d.min.y),this.fire("update")}},_reset:function(){ba.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(d){this._updateDashArray(d),this._layers[l(d)]=d;var _=d._order={layer:d,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=_),this._drawLast=_,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(d){this._requestRedraw(d)},_removePath:function(d){var _=d._order,A=_.next,D=_.prev;A?A.prev=D:this._drawLast=D,D?D.next=A:this._drawFirst=A,delete d._order,delete this._layers[l(d)],this._requestRedraw(d)},_updatePath:function(d){this._extendRedrawBounds(d),d._project(),d._update(),this._requestRedraw(d)},_updateStyle:function(d){this._updateDashArray(d),this._requestRedraw(d)},_updateDashArray:function(d){if(typeof d.options.dashArray=="string"){var _=d.options.dashArray.split(/[, ]+/),A=[],D,K;for(K=0;K<_.length;K++){if(D=Number(_[K]),isNaN(D))return;A.push(D)}d.options._dashArray=A}else d.options._dashArray=d.options.dashArray},_requestRedraw:function(d){this._map&&(this._extendRedrawBounds(d),this._redrawRequest=this._redrawRequest||F(this._redraw,this))},_extendRedrawBounds:function(d){if(d._pxBounds){var _=(d.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new ne,this._redrawBounds.extend(d._pxBounds.min.subtract([_,_])),this._redrawBounds.extend(d._pxBounds.max.add([_,_]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var d=this._redrawBounds;if(d){var _=d.getSize();this._ctx.clearRect(d.min.x,d.min.y,_.x,_.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var d,_=this._redrawBounds;if(this._ctx.save(),_){var A=_.getSize();this._ctx.beginPath(),this._ctx.rect(_.min.x,_.min.y,A.x,A.y),this._ctx.clip()}this._drawing=!0;for(var D=this._drawFirst;D;D=D.next)d=D.layer,(!_||d._pxBounds&&d._pxBounds.intersects(_))&&d._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(d,_){if(this._drawing){var A,D,K,re,Me=d._parts,Ze=Me.length,lt=this._ctx;if(Ze){for(lt.beginPath(),A=0;A<Ze;A++){for(D=0,K=Me[A].length;D<K;D++)re=Me[A][D],lt[D?"lineTo":"moveTo"](re.x,re.y);_&&lt.closePath()}this._fillStroke(lt,d)}}},_updateCircle:function(d){if(!(!this._drawing||d._empty())){var _=d._point,A=this._ctx,D=Math.max(Math.round(d._radius),1),K=(Math.max(Math.round(d._radiusY),1)||D)/D;K!==1&&(A.save(),A.scale(1,K)),A.beginPath(),A.arc(_.x,_.y/K,D,0,Math.PI*2,!1),K!==1&&A.restore(),this._fillStroke(A,d)}},_fillStroke:function(d,_){var A=_.options;A.fill&&(d.globalAlpha=A.fillOpacity,d.fillStyle=A.fillColor||A.color,d.fill(A.fillRule||"evenodd")),A.stroke&&A.weight!==0&&(d.setLineDash&&d.setLineDash(_.options&&_.options._dashArray||[]),d.globalAlpha=A.opacity,d.lineWidth=A.weight,d.strokeStyle=A.color,d.lineCap=A.lineCap,d.lineJoin=A.lineJoin,d.stroke())},_onClick:function(d){for(var _=this._map.mouseEventToLayerPoint(d),A,D,K=this._drawFirst;K;K=K.next)A=K.layer,A.options.interactive&&A._containsPoint(_)&&(!(d.type==="click"||d.type==="preclick")||!this._map._draggableMoved(A))&&(D=A);this._fireEvent(D?[D]:!1,d)},_onMouseMove:function(d){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var _=this._map.mouseEventToLayerPoint(d);this._handleMouseHover(d,_)}},_handleMouseOut:function(d){var _=this._hoveredLayer;_&&(_t(this._container,"leaflet-interactive"),this._fireEvent([_],d,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(d,_){if(!this._mouseHoverThrottled){for(var A,D,K=this._drawFirst;K;K=K.next)A=K.layer,A.options.interactive&&A._containsPoint(_)&&(D=A);D!==this._hoveredLayer&&(this._handleMouseOut(d),D&&(st(this._container,"leaflet-interactive"),this._fireEvent([D],d,"mouseover"),this._hoveredLayer=D)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,d),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(d,_,A){this._map._fireDOMEvent(_,A||_.type,d)},_bringToFront:function(d){var _=d._order;if(_){var A=_.next,D=_.prev;if(A)A.prev=D;else return;D?D.next=A:A&&(this._drawFirst=A),_.prev=this._drawLast,this._drawLast.next=_,_.next=null,this._drawLast=_,this._requestRedraw(d)}},_bringToBack:function(d){var _=d._order;if(_){var A=_.next,D=_.prev;if(D)D.next=A;else return;A?A.prev=D:D&&(this._drawLast=D),_.prev=null,_.next=this._drawFirst,this._drawFirst.prev=_,this._drawFirst=_,this._requestRedraw(d)}}});function Ux(d){return te.canvas?new Bx(d):null}var tf=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(d){return document.createElement("<lvml:"+d+' class="lvml">')}}catch{}return function(d){return document.createElement("<"+d+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),hw={_initContainer:function(){this._container=De("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ba.prototype._update.call(this),this.fire("update"))},_initPath:function(d){var _=d._container=tf("shape");st(_,"leaflet-vml-shape "+(this.options.className||"")),_.coordsize="1 1",d._path=tf("path"),_.appendChild(d._path),this._updateStyle(d),this._layers[l(d)]=d},_addPath:function(d){var _=d._container;this._container.appendChild(_),d.options.interactive&&d.addInteractiveTarget(_)},_removePath:function(d){var _=d._container;Le(_),d.removeInteractiveTarget(_),delete this._layers[l(d)]},_updateStyle:function(d){var _=d._stroke,A=d._fill,D=d.options,K=d._container;K.stroked=!!D.stroke,K.filled=!!D.fill,D.stroke?(_||(_=d._stroke=tf("stroke")),K.appendChild(_),_.weight=D.weight+"px",_.color=D.color,_.opacity=D.opacity,D.dashArray?_.dashStyle=S(D.dashArray)?D.dashArray.join(" "):D.dashArray.replace(/( *, *)/g," "):_.dashStyle="",_.endcap=D.lineCap.replace("butt","flat"),_.joinstyle=D.lineJoin):_&&(K.removeChild(_),d._stroke=null),D.fill?(A||(A=d._fill=tf("fill")),K.appendChild(A),A.color=D.fillColor||D.color,A.opacity=D.fillOpacity):A&&(K.removeChild(A),d._fill=null)},_updateCircle:function(d){var _=d._point.round(),A=Math.round(d._radius),D=Math.round(d._radiusY||A);this._setPath(d,d._empty()?"M0 0":"AL "+_.x+","+_.y+" "+A+","+D+" 0,"+65535*360)},_setPath:function(d,_){d._path.v=_},_bringToFront:function(d){be(d._container)},_bringToBack:function(d){Ue(d._container)}},up=te.vml?tf:vt,nf=ba.extend({_initContainer:function(){this._container=up("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=up("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Le(this._container),Ji(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ba.prototype._update.call(this);var d=this._bounds,_=d.getSize(),A=this._container;(!this._svgSize||!this._svgSize.equals(_))&&(this._svgSize=_,A.setAttribute("width",_.x),A.setAttribute("height",_.y)),fn(A,d.min),A.setAttribute("viewBox",[d.min.x,d.min.y,_.x,_.y].join(" ")),this.fire("update")}},_initPath:function(d){var _=d._path=up("path");d.options.className&&st(_,d.options.className),d.options.interactive&&st(_,"leaflet-interactive"),this._updateStyle(d),this._layers[l(d)]=d},_addPath:function(d){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(d._path),d.addInteractiveTarget(d._path)},_removePath:function(d){Le(d._path),d.removeInteractiveTarget(d._path),delete this._layers[l(d)]},_updatePath:function(d){d._project(),d._update()},_updateStyle:function(d){var _=d._path,A=d.options;_&&(A.stroke?(_.setAttribute("stroke",A.color),_.setAttribute("stroke-opacity",A.opacity),_.setAttribute("stroke-width",A.weight),_.setAttribute("stroke-linecap",A.lineCap),_.setAttribute("stroke-linejoin",A.lineJoin),A.dashArray?_.setAttribute("stroke-dasharray",A.dashArray):_.removeAttribute("stroke-dasharray"),A.dashOffset?_.setAttribute("stroke-dashoffset",A.dashOffset):_.removeAttribute("stroke-dashoffset")):_.setAttribute("stroke","none"),A.fill?(_.setAttribute("fill",A.fillColor||A.color),_.setAttribute("fill-opacity",A.fillOpacity),_.setAttribute("fill-rule",A.fillRule||"evenodd")):_.setAttribute("fill","none"))},_updatePoly:function(d,_){this._setPath(d,Oe(d._parts,_))},_updateCircle:function(d){var _=d._point,A=Math.max(Math.round(d._radius),1),D=Math.max(Math.round(d._radiusY),1)||A,K="a"+A+","+D+" 0 1,0 ",re=d._empty()?"M0 0":"M"+(_.x-A)+","+_.y+K+A*2+",0 "+K+-A*2+",0 ";this._setPath(d,re)},_setPath:function(d,_){d._path.setAttribute("d",_)},_bringToFront:function(d){be(d._path)},_bringToBack:function(d){Ue(d._path)}});te.vml&&nf.include(hw);function V1(d){return te.svg||te.vml?new nf(d):null}hi.include({getRenderer:function(d){var _=d.options.renderer||this._getPaneRenderer(d.options.pane)||this.options.renderer||this._renderer;return _||(_=this._renderer=this._createRenderer()),this.hasLayer(_)||this.addLayer(_),_},_getPaneRenderer:function(d){if(d==="overlayPane"||d===void 0)return!1;var _=this._paneRenderers[d];return _===void 0&&(_=this._createRenderer({pane:d}),this._paneRenderers[d]=_),_},_createRenderer:function(d){return this.options.preferCanvas&&Ux(d)||V1(d)}});var rf=sl.extend({initialize:function(d,_){sl.prototype.initialize.call(this,this._boundsToLatLngs(d),_)},setBounds:function(d){return this.setLatLngs(this._boundsToLatLngs(d))},_boundsToLatLngs:function(d){return d=Pe(d),[d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()]}});function dw(d,_){return new rf(d,_)}nf.create=up,nf.pointsToPath=Oe,Zo.geometryToLayer=qs,Zo.coordsToLatLng=xu,Zo.coordsToLatLngs=Yo,Zo.latLngToCoords=ap,Zo.latLngsToCoords=Rc,Zo.getFeature=Eh,Zo.asFeature=Qd,hi.mergeOptions({boxZoom:!0});var hp=Or.extend({initialize:function(d){this._map=d,this._container=d._container,this._pane=d._panes.overlayPane,this._resetStateTimeout=0,d.on("unload",this._destroy,this)},addHooks:function(){jn(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ji(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Le(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(d){if(!d.shiftKey||d.which!==1&&d.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),En(),Zi(),this._startPoint=this._map.mouseEventToContainerPoint(d),jn(document,{contextmenu:_h,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(d){this._moved||(this._moved=!0,this._box=De("div","leaflet-zoom-box",this._container),st(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(d);var _=new ne(this._point,this._startPoint),A=_.getSize();fn(this._box,_.min),this._box.style.width=A.x+"px",this._box.style.height=A.y+"px"},_finish:function(){this._moved&&(Le(this._box),_t(this._container,"leaflet-crosshair")),Un(),Ni(),Ji(document,{contextmenu:_h,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(d){if(!(d.which!==1&&d.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var _=new Ae(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(_).fire("boxzoomend",{boxZoomBounds:_})}},_onKeyDown:function(d){d.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});hi.addInitHook("addHandler","boxZoom",hp),hi.mergeOptions({doubleClickZoom:!0});var dp=Or.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(d){var _=this._map,A=_.getZoom(),D=_.options.zoomDelta,K=d.originalEvent.shiftKey?A-D:A+D;_.options.doubleClickZoom==="center"?_.setZoom(K):_.setZoomAround(d.containerPoint,K)}});hi.addInitHook("addHandler","doubleClickZoom",dp),hi.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var H1=Or.extend({addHooks:function(){if(!this._draggable){var d=this._map;this._draggable=new Ll(d._mapPane,d._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),d.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),d.on("zoomend",this._onZoomEnd,this),d.whenReady(this._onZoomEnd,this))}st(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){_t(this._map._container,"leaflet-grab"),_t(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var d=this._map;if(d._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var _=Pe(this._map.options.maxBounds);this._offsetLimit=fe(this._map.latLngToContainerPoint(_.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(_.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;d.fire("movestart").fire("dragstart"),d.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(d){if(this._map.options.inertia){var _=this._lastTime=+new Date,A=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(A),this._times.push(_),this._prunePositions(_)}this._map.fire("move",d).fire("drag",d)},_prunePositions:function(d){for(;this._positions.length>1&&d-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var d=this._map.getSize().divideBy(2),_=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=_.subtract(d).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(d,_){return d-(d-_)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var d=this._draggable._newPos.subtract(this._draggable._startPos),_=this._offsetLimit;d.x<_.min.x&&(d.x=this._viscousLimit(d.x,_.min.x)),d.y<_.min.y&&(d.y=this._viscousLimit(d.y,_.min.y)),d.x>_.max.x&&(d.x=this._viscousLimit(d.x,_.max.x)),d.y>_.max.y&&(d.y=this._viscousLimit(d.y,_.max.y)),this._draggable._newPos=this._draggable._startPos.add(d)}},_onPreDragWrap:function(){var d=this._worldWidth,_=Math.round(d/2),A=this._initialWorldOffset,D=this._draggable._newPos.x,K=(D-_+A)%d+_-A,re=(D+_+A)%d-_-A,Me=Math.abs(K+A)<Math.abs(re+A)?K:re;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Me},_onDragEnd:function(d){var _=this._map,A=_.options,D=!A.inertia||d.noInertia||this._times.length<2;if(_.fire("dragend",d),D)_.fire("moveend");else{this._prunePositions(+new Date);var K=this._lastPos.subtract(this._positions[0]),re=(this._lastTime-this._times[0])/1e3,Me=A.easeLinearity,Ze=K.multiplyBy(Me/re),lt=Ze.distanceTo([0,0]),Mt=Math.min(A.inertiaMaxSpeed,lt),Xt=Ze.multiplyBy(Mt/lt),Dn=Mt/(A.inertiaDeceleration*Me),ii=Xt.multiplyBy(-Dn/2).round();!ii.x&&!ii.y?_.fire("moveend"):(ii=_._limitOffset(ii,_.options.maxBounds),F(function(){_.panBy(ii,{duration:Dn,easeLinearity:Me,noMoveStart:!0,animate:!0})}))}}});hi.addInitHook("addHandler","dragging",H1),hi.mergeOptions({keyboard:!0,keyboardPanDelta:80});var sf=Or.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(d){this._map=d,this._setPanDelta(d.options.keyboardPanDelta),this._setZoomDelta(d.options.zoomDelta)},addHooks:function(){var d=this._map._container;d.tabIndex<=0&&(d.tabIndex="0"),jn(d,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ji(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var d=document.body,_=document.documentElement,A=d.scrollTop||_.scrollTop,D=d.scrollLeft||_.scrollLeft;this._map._container.focus(),window.scrollTo(D,A)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(d){var _=this._panKeys={},A=this.keyCodes,D,K;for(D=0,K=A.left.length;D<K;D++)_[A.left[D]]=[-1*d,0];for(D=0,K=A.right.length;D<K;D++)_[A.right[D]]=[d,0];for(D=0,K=A.down.length;D<K;D++)_[A.down[D]]=[0,d];for(D=0,K=A.up.length;D<K;D++)_[A.up[D]]=[0,-1*d]},_setZoomDelta:function(d){var _=this._zoomKeys={},A=this.keyCodes,D,K;for(D=0,K=A.zoomIn.length;D<K;D++)_[A.zoomIn[D]]=d;for(D=0,K=A.zoomOut.length;D<K;D++)_[A.zoomOut[D]]=-d},_addHooks:function(){jn(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ji(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(d){if(!(d.altKey||d.ctrlKey||d.metaKey)){var _=d.keyCode,A=this._map,D;if(_ in this._panKeys){if(!A._panAnim||!A._panAnim._inProgress)if(D=this._panKeys[_],d.shiftKey&&(D=Q(D).multiplyBy(3)),A.options.maxBounds&&(D=A._limitOffset(Q(D),A.options.maxBounds)),A.options.worldCopyJump){var K=A.wrapLatLng(A.unproject(A.project(A.getCenter()).add(D)));A.panTo(K)}else A.panBy(D)}else if(_ in this._zoomKeys)A.setZoom(A.getZoom()+(d.shiftKey?3:1)*this._zoomKeys[_]);else if(_===27&&A._popup&&A._popup.options.closeOnEscapeKey)A.closePopup();else return;_h(d)}}});hi.addInitHook("addHandler","keyboard",sf),hi.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Fx=Or.extend({addHooks:function(){jn(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ji(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(d){var _=N1(d),A=this._map.options.wheelDebounceTime;this._delta+=_,this._lastMousePos=this._map.mouseEventToContainerPoint(d),this._startTime||(this._startTime=+new Date);var D=Math.max(A-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),D),_h(d)},_performZoom:function(){var d=this._map,_=d.getZoom(),A=this._map.options.zoomSnap||0;d._stop();var D=this._delta/(this._map.options.wheelPxPerZoomLevel*4),K=4*Math.log(2/(1+Math.exp(-Math.abs(D))))/Math.LN2,re=A?Math.ceil(K/A)*A:K,Me=d._limitZoom(_+(this._delta>0?re:-re))-_;this._delta=0,this._startTime=null,Me&&(d.options.scrollWheelZoom==="center"?d.setZoom(_+Me):d.setZoomAround(this._lastMousePos,_+Me))}});hi.addInitHook("addHandler","scrollWheelZoom",Fx);var fw=600;hi.mergeOptions({tapHold:te.touchNative&&te.safari&&te.mobile,tapTolerance:15});var zx=Or.extend({addHooks:function(){jn(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ji(this._map._container,"touchstart",this._onDown,this)},_onDown:function(d){if(clearTimeout(this._holdTimeout),d.touches.length===1){var _=d.touches[0];this._startPos=this._newPos=new G(_.clientX,_.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(jn(document,"touchend",vs),jn(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",_))},this),fw),jn(document,"touchend touchcancel contextmenu",this._cancel,this),jn(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function d(){Ji(document,"touchend",vs),Ji(document,"touchend touchcancel",d)},_cancel:function(){clearTimeout(this._holdTimeout),Ji(document,"touchend touchcancel contextmenu",this._cancel,this),Ji(document,"touchmove",this._onMove,this)},_onMove:function(d){var _=d.touches[0];this._newPos=new G(_.clientX,_.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(d,_){var A=new MouseEvent(d,{bubbles:!0,cancelable:!0,view:window,screenX:_.screenX,screenY:_.screenY,clientX:_.clientX,clientY:_.clientY});A._simulated=!0,_.target.dispatchEvent(A)}});hi.addInitHook("addHandler","tapHold",zx),hi.mergeOptions({touchZoom:te.touch,bounceAtZoomLimits:!0});var jx=Or.extend({addHooks:function(){st(this._map._container,"leaflet-touch-zoom"),jn(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){_t(this._map._container,"leaflet-touch-zoom"),Ji(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(d){var _=this._map;if(!(!d.touches||d.touches.length!==2||_._animatingZoom||this._zooming)){var A=_.mouseEventToContainerPoint(d.touches[0]),D=_.mouseEventToContainerPoint(d.touches[1]);this._centerPoint=_.getSize()._divideBy(2),this._startLatLng=_.containerPointToLatLng(this._centerPoint),_.options.touchZoom!=="center"&&(this._pinchStartLatLng=_.containerPointToLatLng(A.add(D)._divideBy(2))),this._startDist=A.distanceTo(D),this._startZoom=_.getZoom(),this._moved=!1,this._zooming=!0,_._stop(),jn(document,"touchmove",this._onTouchMove,this),jn(document,"touchend touchcancel",this._onTouchEnd,this),vs(d)}},_onTouchMove:function(d){if(!(!d.touches||d.touches.length!==2||!this._zooming)){var _=this._map,A=_.mouseEventToContainerPoint(d.touches[0]),D=_.mouseEventToContainerPoint(d.touches[1]),K=A.distanceTo(D)/this._startDist;if(this._zoom=_.getScaleZoom(K,this._startZoom),!_.options.bounceAtZoomLimits&&(this._zoom<_.getMinZoom()&&K<1||this._zoom>_.getMaxZoom()&&K>1)&&(this._zoom=_._limitZoom(this._zoom)),_.options.touchZoom==="center"){if(this._center=this._startLatLng,K===1)return}else{var re=A._add(D)._divideBy(2)._subtract(this._centerPoint);if(K===1&&re.x===0&&re.y===0)return;this._center=_.unproject(_.project(this._pinchStartLatLng,this._zoom).subtract(re),this._zoom)}this._moved||(_._moveStart(!0,!1),this._moved=!0),j(this._animRequest);var Me=o(_._move,_,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=F(Me,this,!0),vs(d)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,j(this._animRequest),Ji(document,"touchmove",this._onTouchMove,this),Ji(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});hi.addInitHook("addHandler","touchZoom",jx),hi.BoxZoom=hp,hi.DoubleClickZoom=dp,hi.Drag=H1,hi.Keyboard=sf,hi.ScrollWheelZoom=Fx,hi.TapHold=zx,hi.TouchZoom=jx,t.Bounds=ne,t.Browser=te,t.CRS=Ne,t.Canvas=Bx,t.Circle=Sh,t.CircleMarker=Mc,t.Class=U,t.Control=il,t.DivIcon=bs,t.DivOverlay=Yi,t.DomEvent=sT,t.DomUtil=Sx,t.Draggable=Ll,t.Evented=J,t.FeatureGroup=Si,t.GeoJSON=Zo,t.GridLayer=Ah,t.Handler=Or,t.Icon=Ns,t.ImageOverlay=Jd,t.LatLng=Ce,t.LatLngBounds=Ae,t.Layer=Ko,t.LayerGroup=rs,t.LineUtil=xa,t.Map=hi,t.Marker=Yd,t.Mixin=kl,t.Path=va,t.Point=G,t.PolyUtil=O1,t.Polygon=sl,t.Polyline=Ul,t.Popup=Th,t.PosAnimation=nl,t.Projection=Cc,t.Rectangle=rf,t.Renderer=ba,t.SVG=nf,t.SVGOverlay=Sr,t.TileLayer=uo,t.Tooltip=vu,t.Transformation=Pt,t.Util=W,t.VideoOverlay=Xo,t.bind=o,t.bounds=fe,t.canvas=Ux,t.circle=F1,t.circleMarker=kx,t.control=Ws,t.divIcon=Dx,t.extend=r,t.featureGroup=op,t.geoJSON=lp,t.geoJson=Lx,t.gridLayer=Ox,t.icon=aw,t.imageOverlay=z1,t.latLng=de,t.latLngBounds=Pe,t.layerGroup=qo,t.map=k1,t.marker=lw,t.point=Q,t.polygon=uw,t.polyline=cw,t.popup=cp,t.rectangle=dw,t.setOptions=b,t.stamp=l,t.svg=V1,t.svgOverlay=Ps,t.tileLayer=ol,t.tooltip=oT,t.transformation=zt,t.version=i,t.videoOverlay=ef;var Vx=window.L;t.noConflict=function(){return window.L=Vx,this},window.L=t})})(bN,bN.exports);var mx=bN.exports;const k0=wc(mx);function d9(n,e,t){return Object.freeze({instance:n,context:e,container:t})}function f9(n,e){return e==null?function(i,r){const s=$.useRef();return s.current||(s.current=n(i,r)),s}:function(i,r){const s=$.useRef();s.current||(s.current=n(i,r));const o=$.useRef(i),{instance:a}=s.current;return $.useEffect(function(){o.current!==i&&(e(a,i,o.current),o.current=i)},[a,i,r]),s}}function cte(n,e){$.useEffect(function(){return(e.layerContainer??e.map).addLayer(n.instance),function(){e.layerContainer?.removeLayer(n.instance),e.map.removeLayer(n.instance)}},[e,n])}function ute(n){return function(t){const i=u9(),r=n(h9(t,i),i);return rte(i.map,t.attribution),mD(r.current,t.eventHandlers),cte(r.current,i),r}}function Y9e(n,e){const t=$.useRef();$.useEffect(function(){if(e.pathOptions!==t.current){const r=e.pathOptions??{};n.instance.setStyle(r),t.current=r}},[n,e])}function X9e(n){return function(t){const i=u9(),r=n(h9(t,i),i);return mD(r.current,t.eventHandlers),cte(r.current,i),Y9e(r.current,t),r}}function Q9e(n,e){const t=f9(n,e),i=ute(t);return lte(i)}function J9e(n,e){const t=f9(n),i=Z9e(t,e);return K9e(i)}function eTe(n,e){const t=f9(n,e),i=X9e(t);return lte(i)}function tTe(n,e){const t=f9(n,e),i=ute(t);return q9e(i)}function nTe(n,e,t){const{opacity:i,zIndex:r}=e;i!=null&&i!==t.opacity&&n.setOpacity(i),r!=null&&r!==t.zIndex&&n.setZIndex(r)}function p9(){return u9().map}function hte(n){const e=p9();return $.useEffect(function(){return e.on(n),function(){e.off(n)}},[e,n]),e}function _N(){return _N=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},_N.apply(this,arguments)}function iTe({bounds:n,boundsOptions:e,center:t,children:i,className:r,id:s,placeholder:o,style:a,whenReady:l,zoom:c,...u},h){const[p]=$.useState({className:r,id:s,style:a}),[m,y]=$.useState(null);$.useImperativeHandle(h,()=>m?.map??null,[m]);const b=$.useCallback(v=>{if(v!==null&&m===null){const T=new mx.Map(v,u);t!=null&&c!=null?T.setView(t,c):n!=null&&T.fitBounds(n,e),l!=null&&T.whenReady(l),y(W9e(T))}},[]);$.useEffect(()=>()=>{m?.map.remove()},[m]);const w=m?Fa.createElement(ate,{value:m},i):o??null;return Fa.createElement("div",_N({},p,{ref:b}),w)}const rTe=$.forwardRef(iTe),wN=Q9e(function({position:e,...t},i){const r=new mx.Marker(e,t);return d9(r,ste(i,{overlayContainer:r}))},function(e,t,i){t.position!==i.position&&e.setLatLng(t.position),t.icon!=null&&t.icon!==i.icon&&e.setIcon(t.icon),t.zIndexOffset!=null&&t.zIndexOffset!==i.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),t.opacity!=null&&t.opacity!==i.opacity&&e.setOpacity(t.opacity),e.dragging!=null&&t.draggable!==i.draggable&&(t.draggable===!0?e.dragging.enable():e.dragging.disable())}),sTe=eTe(function({positions:e,...t},i){const r=new mx.Polyline(e,t);return d9(r,ste(i,{overlayContainer:r}))},function(e,t,i){t.positions!==i.positions&&e.setLatLngs(t.positions)}),SN=J9e(function(e,t){const i=new mx.Popup(e,t.overlayContainer);return d9(i,t)},function(e,t,{position:i},r){$.useEffect(function(){const{instance:o}=e;function a(c){c.popup===o&&(o.update(),r(!0))}function l(c){c.popup===o&&r(!1)}return t.map.on({popupopen:a,popupclose:l}),t.overlayContainer==null?(i!=null&&o.setLatLng(i),o.openOn(t.map)):t.overlayContainer.bindPopup(o),function(){t.map.off({popupopen:a,popupclose:l}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(o)}},[e,t,r,i])}),oTe=tTe(function({url:e,...t},i){const r=new mx.TileLayer(e,h9(t,i));return d9(r,i)},function(e,t,i){nTe(e,t,i);const{url:r}=t;r!=null&&r!==i.url&&e.setUrl(r)}),mC=19,aTe=1,Qj=6,lTe=12,Xp=class Xp{constructor(){}static getInstance(){return Xp.instance||(Xp.instance=new Xp),Xp.instance}generateFlowerOfLife19(e=0,t=0,i=1){const r=[];r.push({x:e,y:t,radius:i,ring:0});const s=i*2;for(let a=0;a<Qj;a++){const l=a*Math.PI/3;r.push({x:e+Math.cos(l)*s,y:t+Math.sin(l)*s,radius:i,ring:1})}const o=[{angle:0,distance:i*4},{angle:Math.PI/3,distance:i*4},{angle:2*Math.PI/3,distance:i*4},{angle:Math.PI,distance:i*4},{angle:4*Math.PI/3,distance:i*4},{angle:5*Math.PI/3,distance:i*4},{angle:Math.PI/6,distance:i*2*Math.sqrt(3)},{angle:Math.PI/2,distance:i*2*Math.sqrt(3)},{angle:5*Math.PI/6,distance:i*2*Math.sqrt(3)},{angle:7*Math.PI/6,distance:i*2*Math.sqrt(3)},{angle:3*Math.PI/2,distance:i*2*Math.sqrt(3)},{angle:11*Math.PI/6,distance:i*2*Math.sqrt(3)}];for(const a of o)r.push({x:e+Math.cos(a.angle)*a.distance,y:t+Math.sin(a.angle)*a.distance,radius:i,ring:2});return this.verify19Circles(r.length),{circles:r,centerX:e,centerY:t,baseRadius:i,verified:r.length===mC}}verify19Circles(e){if(e!==mC){const t=new Error(`GEOMETRIC SACRILEGE: Flower of Life has ${e} circles. REQUIRED: ${mC} circles exactly. Breakdown: ${aTe} center + ${Qj} first ring + ${lTe} second ring = 19`);throw console.error("%c SACRED GEOMETRY ERROR ","background: red; color: white; font-size: 16px; font-weight: bold;"),console.error(t.message),t}console.log("%c SACRED GEOMETRY VERIFIED: 19 circles ","background: green; color: white; font-weight: bold;")}generateSVGPath(e){let t="";for(const i of e.circles)t+=`M ${i.x-i.radius} ${i.y} `,t+=`A ${i.radius} ${i.radius} 0 1 1 ${i.x+i.radius} ${i.y} `,t+=`A ${i.radius} ${i.radius} 0 1 1 ${i.x-i.radius} ${i.y} `;return t}generateSVGCircles(e,t="#00ffff",i=1){return e.circles.map(r=>`<circle cx="${r.x}" cy="${r.y}" r="${r.radius}" fill="none" stroke="${t}" stroke-width="${i}"/>`).join(`
`)}toThreeJSData(e){return e.circles.map(t=>({position:[t.x,t.y,0],radius:t.radius}))}};E(Xp,"instance");let EN=Xp;const cTe=EN.getInstance(),gC=new Map,Jj=(n="#4caf50",e=60,t=!1)=>{const i=`${n}-${e}-${t}`;if(gC.has(i))return gC.get(i);const s=cTe.generateFlowerOfLife19(50,50,8).circles.map((b,w)=>{const v=b.ring===0?1:b.ring===1?.9:.7,T=(w*.08).toFixed(2);return`<circle 
      cx="${b.x}" 
      cy="${b.y}" 
      r="${b.radius}" 
      fill="none" 
      stroke="${n}" 
      stroke-width="1.2"
      opacity="${v}"
    >
      <animate 
        attributeName="opacity" 
        values="${v};${v*.4};${v}" 
        dur="3s" 
        begin="${T}s"
        repeatCount="indefinite"
      />
    </circle>`}).join(""),o=6,a=42,l=2.5,c=8,u=Array.from({length:o},(b,w)=>{const v=w*360/o;return`
      <circle cx="50" cy="${50-a}" r="${l}" fill="${n}" opacity="0.9">
        <animateTransform
          attributeName="transform"
          type="rotate"
          from="${v} 50 50"
          to="${v+360} 50 50"
          dur="${c}s"
          repeatCount="indefinite"
        />
      </circle>
    `}).join(""),h=Array.from({length:3},(b,w)=>{const v=w*120+60;return`
      <circle cx="50" cy="${50-25}" r="2" fill="${n}" opacity="0.7">
        <animateTransform
          attributeName="transform"
          type="rotate"
          from="${v} 50 50"
          to="${v-360} 50 50"
          dur="5s"
          repeatCount="indefinite"
        />
      </circle>
    `}).join(""),p=`glow-biz-${i.replace(/[^a-zA-Z0-9]/g,"")}`,m=`
    <svg width="${e}" height="${e}" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="cursor: pointer;">
      <defs>
        <filter id="${p}">
          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      
      <circle cx="50" cy="50" r="48" fill="none" stroke="${n}" stroke-width="0.5" opacity="0.3">
        <animate attributeName="r" values="46;50;46" dur="4s" repeatCount="indefinite"/>
      </circle>
      
      <g filter="url(#${p})">
        ${s}
      </g>
      
      ${u}
      ${h}
      
      <circle cx="50" cy="50" r="3" fill="${n}">
        <animate attributeName="opacity" values="1;0.6;1" dur="1.5s" repeatCount="indefinite"/>
      </circle>
      
      <text x="50" y="97" font-size="5" fill="${n}" text-anchor="middle" font-family="monospace" opacity="0.5">19</text>
    </svg>
  `,y=k0.divIcon({html:`<div class="flower-of-life-business-marker" style="filter: drop-shadow(0 0 8px ${n}40);">${m}</div>`,className:"flower-of-life-19-marker",iconSize:[e,e],iconAnchor:[e/2,e/2],popupAnchor:[0,-e/2]});return gC.set(i,y),y};function uTe({onBusinessSelect:n}){const e=p9(),{businesses:t,loadBusinesses:i,selectedBusiness:r,setSelectedBusiness:s}=ete(),o=$.useRef(new Map),a=$.useRef(null);return $.useEffect(()=>{console.log("[BusinessLeafletLayer] Component mounted, loading businesses..."),i()},[i]),$.useEffect(()=>{console.log("[BusinessLeafletLayer] Businesses updated:",t.length)},[t]),$.useEffect(()=>{if(e)return a.current||(a.current=k0.layerGroup().addTo(e)),()=>{a.current&&(a.current.clearLayers(),a.current.remove(),a.current=null),o.current.clear()}},[e]),$.useEffect(()=>{if(!e||!a.current)return;const l=new Set(t.map(c=>c.id));o.current.forEach((c,u)=>{l.has(u)||(a.current?.removeLayer(c),o.current.delete(u))}),t.forEach(c=>{if(o.current.get(c.id))return;const h=r?.id===c.id,m=Jj(h?"#00f3ff":"#4caf50",h?80:60,h),y=k0.marker([c.location.latitude,c.location.longitude],{icon:m});y.bindTooltip(`<div class="bg-black/90 px-2 py-1 border border-[#4caf50]/50 rounded">
          <div class="text-[#00f3ff] font-bold text-xs">${c.name}</div>
          <div class="text-[#4caf50] text-[10px]">${c.category}</div>
        </div>`,{permanent:!1,direction:"top",className:"business-leaflet-tooltip",offset:[0,-30]}),y.on("click",()=>{s(c),n&&n(c)}),a.current?.addLayer(y),o.current.set(c.id,y)})},[t,s,n,e]),$.useEffect(()=>{t.forEach(l=>{const c=o.current.get(l.id);if(c){const u=r?.id===l.id,p=Jj(u?"#00f3ff":"#4caf50",u?80:60);c.setIcon(p)}})},[r,t]),null}delete k0.Icon.Default.prototype._getIconUrl;k0.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const dte=k0.divIcon({className:"current-location-marker",html:`
    <svg width="40" height="40" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="glow-current">
          <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      <g filter="url(#glow-current)">
        <circle cx="50" cy="50" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="50" cy="35" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="50" cy="65" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="63" cy="42.5" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="37" cy="42.5" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="63" cy="57.5" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="37" cy="57.5" r="15" fill="none" stroke="#00f3ff" stroke-width="2"/>
        <circle cx="50" cy="50" r="4" fill="#00f3ff"/>
      </g>
    </svg>
  `,iconSize:[40,40],iconAnchor:[20,20]}),hTe=k0.divIcon({className:"destination-marker",html:`
    <svg width="36" height="48" viewBox="0 0 36 48" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <filter id="glow-dest">
          <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
          <feMerge>
            <feMergeNode in="coloredBlur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      <g filter="url(#glow-dest)">
        <path d="M18 0 C8 0 0 8 0 18 C0 28 18 48 18 48 C18 48 36 28 36 18 C36 8 28 0 18 0 Z" 
              fill="#4caf50" stroke="#000" stroke-width="2"/>
        <text x="18" y="24" 
              font-family="serif" 
              font-size="20" 
              font-style="italic" 
              fill="#000" 
              text-anchor="middle" 
              dominant-baseline="middle"
              font-weight="bold"></text>
      </g>
    </svg>
  `,iconSize:[36,48],iconAnchor:[18,48]}),dTe=({onLocationFound:n,externalLocation:e})=>{const[t,i]=$.useState(null),r=p9(),s=$.useRef(!1),o=$.useRef("");return $.useEffect(()=>{if(e){const a=`${e[0]},${e[1]}`,l=new k0.LatLng(e[1],e[0]);a!==o.current&&(i(l),o.current=a,s.current||(console.log("[LocationMarker] Initial location, flying to:",e),r.flyTo(l,14,{duration:1.5}),s.current=!0))}},[e,r]),hte({locationfound(a){i(a.latlng),n&&n([a.latlng.lng,a.latlng.lat])}}),t===null?null:f.jsx(wN,{position:t,icon:dte,children:f.jsx(SN,{className:"bg-black text-cyan-400 border border-cyan-800",children:f.jsx("span",{className:"font-mono text-sm",children:"CURRENT_LOCATION"})})})},fTe=({onMapClick:n})=>(hte({click(e){n&&n([e.latlng.lng,e.latlng.lat])}}),null),pTe=({currentLocation:n,heading:e,enabled:t})=>{const i=p9();return $.useEffect(()=>{t&&n&&(i.getZoom()<18?i.flyTo([n[1],n[0]],18,{duration:1.5,easeLinearity:.5}):i.setView([n[1],n[0]],18,{animate:!0}))},[t,n,i]),$.useEffect(()=>{t&&n&&i.panTo([n[1],n[0]],{animate:!0,duration:.5})},[n,t,i]),null},mTe=({currentLocation:n,destination:e,route:t,onMapClick:i,onLocationFound:r,onRefreshLocation:s,className:o="",streetLevelMode:a=!1,heading:l=0,showBusinessMarkers:c=!0})=>{const u=$.useRef(null);$.useRef(!1),Fa.useState(!1);const h=n?[n[1],n[0]]:[47.3769,8.5417],p=t?.geometry.coordinates.map(m=>[m[1],m[0]])||[];return f.jsxs("div",{className:`relative ${o}`,style:{height:"100%",width:"100%"},children:[f.jsx("div",{style:{height:"100%",width:"100%"},children:f.jsxs(rTe,{center:h,zoom:a?18:13,style:{height:"100%",width:"100%",background:"#000"},ref:m=>{m&&(u.current=m)},zoomControl:!1,children:[f.jsx(oTe,{attribution:' <a href="https://www.openstreetmap.org/copyright">OSM</a>',url:"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",className:"map-tiles-dark"}),f.jsx(dTe,{onLocationFound:r,externalLocation:n}),f.jsx(fTe,{onMapClick:i}),f.jsx(pTe,{currentLocation:n,heading:l,enabled:a}),c&&f.jsx(uTe,{}),n&&f.jsx(wN,{position:[n[1],n[0]],icon:dte,children:f.jsx(SN,{children:f.jsx("span",{className:"font-mono text-sm text-cyan-400",children:"START_POINT"})})}),e&&f.jsx(wN,{position:[e[1],e[0]],icon:hTe,children:f.jsx(SN,{children:f.jsx("span",{className:"font-mono text-sm text-green-400",children:"DESTINATION"})})}),p.length>0&&f.jsx(sTe,{positions:p,pathOptions:{color:a?"#00ff88":"#00f3ff",weight:a?8:4,opacity:.9,dashArray:a?void 0:"10, 5"}})]})}),!a&&f.jsxs("div",{className:"absolute bottom-4 left-4 bg-black/80 border border-cyan-800 rounded px-3 py-2 z-[1000]",children:[f.jsx("div",{className:"text-cyan-400 text-xs font-mono",children:"GEODESIC_NAVIGATOR_v1.0"}),f.jsx("div",{className:"text-green-400 text-xs font-mono mt-1",children:"OpenStreetMap | No Tracking"})]}),f.jsx("style",{children:`
        .leaflet-container {
          background: #000 !important;
          font-family: 'JetBrains Mono', monospace;
        }
        .leaflet-popup-content-wrapper {
          background: #000 !important;
          border: 1px solid #00f3ff !important;
          border-radius: 4px !important;
        }
        .leaflet-popup-content {
          margin: 8px 12px !important;
        }
        .leaflet-popup-tip {
          background: #000 !important;
          border: 1px solid #00f3ff !important;
        }
        .map-tiles-dark {
          filter: brightness(0.8) saturate(0.8);
        }
        .street-level-container {
          overflow: hidden;
        }
        .street-level-container .leaflet-container {
          filter: brightness(1.1) contrast(1.1) saturate(1.2);
        }
      `})]})};function fte(n,e){return function(){return n.apply(e,arguments)}}const{toString:gTe}=Object.prototype,{getPrototypeOf:gD}=Object,{iterator:m9,toStringTag:pte}=Symbol,g9=(n=>e=>{const t=gTe.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),mu=n=>(n=n.toLowerCase(),e=>g9(e)===n),y9=n=>e=>typeof e===n,{isArray:gx}=Array,$2=y9("undefined");function j_(n){return n!==null&&!$2(n)&&n.constructor!==null&&!$2(n.constructor)&&Ya(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const mte=mu("ArrayBuffer");function yTe(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&mte(n.buffer),e}const xTe=y9("string"),Ya=y9("function"),gte=y9("number"),V_=n=>n!==null&&typeof n=="object",vTe=n=>n===!0||n===!1,kS=n=>{if(g9(n)!=="object")return!1;const e=gD(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(pte in n)&&!(m9 in n)},bTe=n=>{if(!V_(n)||j_(n))return!1;try{return Object.keys(n).length===0&&Object.getPrototypeOf(n)===Object.prototype}catch{return!1}},_Te=mu("Date"),wTe=mu("File"),STe=mu("Blob"),ETe=mu("FileList"),TTe=n=>V_(n)&&Ya(n.pipe),ATe=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||Ya(n.append)&&((e=g9(n))==="formdata"||e==="object"&&Ya(n.toString)&&n.toString()==="[object FormData]"))},CTe=mu("URLSearchParams"),[MTe,RTe,ITe,NTe]=["ReadableStream","Request","Response","Headers"].map(mu),PTe=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function H_(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let i,r;if(typeof n!="object"&&(n=[n]),gx(n))for(i=0,r=n.length;i<r;i++)e.call(null,n[i],i,n);else{if(j_(n))return;const s=t?Object.getOwnPropertyNames(n):Object.keys(n),o=s.length;let a;for(i=0;i<o;i++)a=s[i],e.call(null,n[a],a,n)}}function yte(n,e){if(j_(n))return null;e=e.toLowerCase();const t=Object.keys(n);let i=t.length,r;for(;i-- >0;)if(r=t[i],e===r.toLowerCase())return r;return null}const hm=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis)(),xte=n=>!$2(n)&&n!==hm;function TN(){const{caseless:n,skipUndefined:e}=xte(this)&&this||{},t={},i=(r,s)=>{const o=n&&yte(t,s)||s;kS(t[o])&&kS(r)?t[o]=TN(t[o],r):kS(r)?t[o]=TN({},r):gx(r)?t[o]=r.slice():(!e||!$2(r))&&(t[o]=r)};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&H_(arguments[r],i);return t}const kTe=(n,e,t,{allOwnKeys:i}={})=>(H_(e,(r,s)=>{t&&Ya(r)?n[s]=fte(r,t):n[s]=r},{allOwnKeys:i}),n),LTe=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),DTe=(n,e,t,i)=>{n.prototype=Object.create(e.prototype,i),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},OTe=(n,e,t,i)=>{let r,s,o;const a={};if(e=e||{},n==null)return e;do{for(r=Object.getOwnPropertyNames(n),s=r.length;s-- >0;)o=r[s],(!i||i(o,n,e))&&!a[o]&&(e[o]=n[o],a[o]=!0);n=t!==!1&&gD(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},BTe=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const i=n.indexOf(e,t);return i!==-1&&i===t},UTe=n=>{if(!n)return null;if(gx(n))return n;let e=n.length;if(!gte(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},FTe=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&gD(Uint8Array)),zTe=(n,e)=>{const i=(n&&n[m9]).call(n);let r;for(;(r=i.next())&&!r.done;){const s=r.value;e.call(n,s[0],s[1])}},jTe=(n,e)=>{let t;const i=[];for(;(t=n.exec(e))!==null;)i.push(t);return i},VTe=mu("HTMLFormElement"),HTe=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,i,r){return i.toUpperCase()+r}),eV=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),$Te=mu("RegExp"),vte=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),i={};H_(t,(r,s)=>{let o;(o=e(r,s,n))!==!1&&(i[s]=o||r)}),Object.defineProperties(n,i)},GTe=n=>{vte(n,(e,t)=>{if(Ya(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const i=n[t];if(Ya(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},WTe=(n,e)=>{const t={},i=r=>{r.forEach(s=>{t[s]=!0})};return gx(n)?i(n):i(String(n).split(e)),t},KTe=()=>{},qTe=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function ZTe(n){return!!(n&&Ya(n.append)&&n[pte]==="FormData"&&n[m9])}const YTe=n=>{const e=new Array(10),t=(i,r)=>{if(V_(i)){if(e.indexOf(i)>=0)return;if(j_(i))return i;if(!("toJSON"in i)){e[r]=i;const s=gx(i)?[]:{};return H_(i,(o,a)=>{const l=t(o,r+1);!$2(l)&&(s[a]=l)}),e[r]=void 0,s}}return i};return t(n,0)},XTe=mu("AsyncFunction"),QTe=n=>n&&(V_(n)||Ya(n))&&Ya(n.then)&&Ya(n.catch),bte=((n,e)=>n?setImmediate:e?((t,i)=>(hm.addEventListener("message",({source:r,data:s})=>{r===hm&&s===t&&i.length&&i.shift()()},!1),r=>{i.push(r),hm.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Ya(hm.postMessage)),JTe=typeof queueMicrotask<"u"?queueMicrotask.bind(hm):typeof process<"u"&&process.nextTick||bte,eAe=n=>n!=null&&Ya(n[m9]),dt={isArray:gx,isArrayBuffer:mte,isBuffer:j_,isFormData:ATe,isArrayBufferView:yTe,isString:xTe,isNumber:gte,isBoolean:vTe,isObject:V_,isPlainObject:kS,isEmptyObject:bTe,isReadableStream:MTe,isRequest:RTe,isResponse:ITe,isHeaders:NTe,isUndefined:$2,isDate:_Te,isFile:wTe,isBlob:STe,isRegExp:$Te,isFunction:Ya,isStream:TTe,isURLSearchParams:CTe,isTypedArray:FTe,isFileList:ETe,forEach:H_,merge:TN,extend:kTe,trim:PTe,stripBOM:LTe,inherits:DTe,toFlatObject:OTe,kindOf:g9,kindOfTest:mu,endsWith:BTe,toArray:UTe,forEachEntry:zTe,matchAll:jTe,isHTMLForm:VTe,hasOwnProperty:eV,hasOwnProp:eV,reduceDescriptors:vte,freezeMethods:GTe,toObjectSet:WTe,toCamelCase:HTe,noop:KTe,toFiniteNumber:qTe,findKey:yte,globalThis:hm,isContextDefined:xte,isSpecCompliantForm:ZTe,toJSONObject:YTe,isAsyncFn:XTe,isThenable:QTe,setImmediate:bte,asap:JTe,isIterable:eAe};function Xn(n,e,t,i,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),i&&(this.request=i),r&&(this.response=r,this.status=r.status?r.status:null)}dt.inherits(Xn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:dt.toJSONObject(this.config),code:this.code,status:this.status}}});const _te=Xn.prototype,wte={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{wte[n]={value:n}});Object.defineProperties(Xn,wte);Object.defineProperty(_te,"isAxiosError",{value:!0});Xn.from=(n,e,t,i,r,s)=>{const o=Object.create(_te);dt.toFlatObject(n,o,function(u){return u!==Error.prototype},c=>c!=="isAxiosError");const a=n&&n.message?n.message:"Error",l=e==null&&n?n.code:e;return Xn.call(o,a,l,t,i,r),n&&o.cause==null&&Object.defineProperty(o,"cause",{value:n,configurable:!0}),o.name=n&&n.name||"Error",s&&Object.assign(o,s),o};const tAe=null;function AN(n){return dt.isPlainObject(n)||dt.isArray(n)}function Ste(n){return dt.endsWith(n,"[]")?n.slice(0,-2):n}function tV(n,e,t){return n?n.concat(e).map(function(r,s){return r=Ste(r),!t&&s?"["+r+"]":r}).join(t?".":""):e}function nAe(n){return dt.isArray(n)&&!n.some(AN)}const iAe=dt.toFlatObject(dt,{},null,function(e){return/^is[A-Z]/.test(e)});function x9(n,e,t){if(!dt.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=dt.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(b,w){return!dt.isUndefined(w[b])});const i=t.metaTokens,r=t.visitor||u,s=t.dots,o=t.indexes,l=(t.Blob||typeof Blob<"u"&&Blob)&&dt.isSpecCompliantForm(e);if(!dt.isFunction(r))throw new TypeError("visitor must be a function");function c(y){if(y===null)return"";if(dt.isDate(y))return y.toISOString();if(dt.isBoolean(y))return y.toString();if(!l&&dt.isBlob(y))throw new Xn("Blob is not supported. Use a Buffer instead.");return dt.isArrayBuffer(y)||dt.isTypedArray(y)?l&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function u(y,b,w){let v=y;if(y&&!w&&typeof y=="object"){if(dt.endsWith(b,"{}"))b=i?b:b.slice(0,-2),y=JSON.stringify(y);else if(dt.isArray(y)&&nAe(y)||(dt.isFileList(y)||dt.endsWith(b,"[]"))&&(v=dt.toArray(y)))return b=Ste(b),v.forEach(function(S,M){!(dt.isUndefined(S)||S===null)&&e.append(o===!0?tV([b],M,s):o===null?b:b+"[]",c(S))}),!1}return AN(y)?!0:(e.append(tV(w,b,s),c(y)),!1)}const h=[],p=Object.assign(iAe,{defaultVisitor:u,convertValue:c,isVisitable:AN});function m(y,b){if(!dt.isUndefined(y)){if(h.indexOf(y)!==-1)throw Error("Circular reference detected in "+b.join("."));h.push(y),dt.forEach(y,function(v,T){(!(dt.isUndefined(v)||v===null)&&r.call(e,v,dt.isString(T)?T.trim():T,b,p))===!0&&m(v,b?b.concat(T):[T])}),h.pop()}}if(!dt.isObject(n))throw new TypeError("data must be an object");return m(n),e}function nV(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function yD(n,e){this._pairs=[],n&&x9(n,this,e)}const Ete=yD.prototype;Ete.append=function(e,t){this._pairs.push([e,t])};Ete.toString=function(e){const t=e?function(i){return e.call(this,i,nV)}:nV;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function rAe(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Tte(n,e,t){if(!e)return n;const i=t&&t.encode||rAe;dt.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let s;if(r?s=r(e,t):s=dt.isURLSearchParams(e)?e.toString():new yD(e,t).toString(i),s){const o=n.indexOf("#");o!==-1&&(n=n.slice(0,o)),n+=(n.indexOf("?")===-1?"?":"&")+s}return n}class sAe{constructor(){this.handlers=[]}use(e,t,i){return this.handlers.push({fulfilled:e,rejected:t,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){dt.forEach(this.handlers,function(i){i!==null&&e(i)})}}const iV=sAe,Ate={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},oAe=typeof URLSearchParams<"u"?URLSearchParams:yD,aAe=typeof FormData<"u"?FormData:null,lAe=typeof Blob<"u"?Blob:null,cAe={isBrowser:!0,classes:{URLSearchParams:oAe,FormData:aAe,Blob:lAe},protocols:["http","https","file","blob","url","data"]},xD=typeof window<"u"&&typeof document<"u",CN=typeof navigator=="object"&&navigator||void 0,uAe=xD&&(!CN||["ReactNative","NativeScript","NS"].indexOf(CN.product)<0),hAe=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),dAe=xD&&window.location.href||"http://localhost",fAe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:xD,hasStandardBrowserEnv:uAe,hasStandardBrowserWebWorkerEnv:hAe,navigator:CN,origin:dAe},Symbol.toStringTag,{value:"Module"})),Lo={...fAe,...cAe};function pAe(n,e){return x9(n,new Lo.classes.URLSearchParams,{visitor:function(t,i,r,s){return Lo.isNode&&dt.isBuffer(t)?(this.append(i,t.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)},...e})}function mAe(n){return dt.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function gAe(n){const e={},t=Object.keys(n);let i;const r=t.length;let s;for(i=0;i<r;i++)s=t[i],e[s]=n[s];return e}function Cte(n){function e(t,i,r,s){let o=t[s++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=s>=t.length;return o=!o&&dt.isArray(r)?r.length:o,l?(dt.hasOwnProp(r,o)?r[o]=[r[o],i]:r[o]=i,!a):((!r[o]||!dt.isObject(r[o]))&&(r[o]=[]),e(t,i,r[o],s)&&dt.isArray(r[o])&&(r[o]=gAe(r[o])),!a)}if(dt.isFormData(n)&&dt.isFunction(n.entries)){const t={};return dt.forEachEntry(n,(i,r)=>{e(mAe(i),r,t,0)}),t}return null}function yAe(n,e,t){if(dt.isString(n))try{return(e||JSON.parse)(n),dt.trim(n)}catch(i){if(i.name!=="SyntaxError")throw i}return(t||JSON.stringify)(n)}const vD={transitional:Ate,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const i=t.getContentType()||"",r=i.indexOf("application/json")>-1,s=dt.isObject(e);if(s&&dt.isHTMLForm(e)&&(e=new FormData(e)),dt.isFormData(e))return r?JSON.stringify(Cte(e)):e;if(dt.isArrayBuffer(e)||dt.isBuffer(e)||dt.isStream(e)||dt.isFile(e)||dt.isBlob(e)||dt.isReadableStream(e))return e;if(dt.isArrayBufferView(e))return e.buffer;if(dt.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return pAe(e,this.formSerializer).toString();if((a=dt.isFileList(e))||i.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return x9(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),yAe(e)):e}],transformResponse:[function(e){const t=this.transitional||vD.transitional,i=t&&t.forcedJSONParsing,r=this.responseType==="json";if(dt.isResponse(e)||dt.isReadableStream(e))return e;if(e&&dt.isString(e)&&(i&&!this.responseType||r)){const o=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?Xn.from(a,Xn.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Lo.classes.FormData,Blob:Lo.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};dt.forEach(["delete","get","head","post","put","patch"],n=>{vD.headers[n]={}});const bD=vD,xAe=dt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),vAe=n=>{const e={};let t,i,r;return n&&n.split(`
`).forEach(function(o){r=o.indexOf(":"),t=o.substring(0,r).trim().toLowerCase(),i=o.substring(r+1).trim(),!(!t||e[t]&&xAe[t])&&(t==="set-cookie"?e[t]?e[t].push(i):e[t]=[i]:e[t]=e[t]?e[t]+", "+i:i)}),e},rV=Symbol("internals");function xv(n){return n&&String(n).trim().toLowerCase()}function LS(n){return n===!1||n==null?n:dt.isArray(n)?n.map(LS):String(n)}function bAe(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=t.exec(n);)e[i[1]]=i[2];return e}const _Ae=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function yC(n,e,t,i,r){if(dt.isFunction(i))return i.call(this,e,t);if(r&&(e=t),!!dt.isString(e)){if(dt.isString(i))return e.indexOf(i)!==-1;if(dt.isRegExp(i))return i.test(e)}}function wAe(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,i)=>t.toUpperCase()+i)}function SAe(n,e){const t=dt.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(n,i+t,{value:function(r,s,o){return this[i].call(this,e,r,s,o)},configurable:!0})})}class v9{constructor(e){e&&this.set(e)}set(e,t,i){const r=this;function s(a,l,c){const u=xv(l);if(!u)throw new Error("header name must be a non-empty string");const h=dt.findKey(r,u);(!h||r[h]===void 0||c===!0||c===void 0&&r[h]!==!1)&&(r[h||l]=LS(a))}const o=(a,l)=>dt.forEach(a,(c,u)=>s(c,u,l));if(dt.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(dt.isString(e)&&(e=e.trim())&&!_Ae(e))o(vAe(e),t);else if(dt.isObject(e)&&dt.isIterable(e)){let a={},l,c;for(const u of e){if(!dt.isArray(u))throw TypeError("Object iterator must return a key-value pair");a[c=u[0]]=(l=a[c])?dt.isArray(l)?[...l,u[1]]:[l,u[1]]:u[1]}o(a,t)}else e!=null&&s(t,e,i);return this}get(e,t){if(e=xv(e),e){const i=dt.findKey(this,e);if(i){const r=this[i];if(!t)return r;if(t===!0)return bAe(r);if(dt.isFunction(t))return t.call(this,r,i);if(dt.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=xv(e),e){const i=dt.findKey(this,e);return!!(i&&this[i]!==void 0&&(!t||yC(this,this[i],i,t)))}return!1}delete(e,t){const i=this;let r=!1;function s(o){if(o=xv(o),o){const a=dt.findKey(i,o);a&&(!t||yC(i,i[a],a,t))&&(delete i[a],r=!0)}}return dt.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let i=t.length,r=!1;for(;i--;){const s=t[i];(!e||yC(this,this[s],s,e,!0))&&(delete this[s],r=!0)}return r}normalize(e){const t=this,i={};return dt.forEach(this,(r,s)=>{const o=dt.findKey(i,s);if(o){t[o]=LS(r),delete t[s];return}const a=e?wAe(s):String(s).trim();a!==s&&delete t[s],t[a]=LS(r),i[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return dt.forEach(this,(i,r)=>{i!=null&&i!==!1&&(t[r]=e&&dt.isArray(i)?i.join(", "):i)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const i=new this(e);return t.forEach(r=>i.set(r)),i}static accessor(e){const i=(this[rV]=this[rV]={accessors:{}}).accessors,r=this.prototype;function s(o){const a=xv(o);i[a]||(SAe(r,o),i[a]=!0)}return dt.isArray(e)?e.forEach(s):s(e),this}}v9.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);dt.reduceDescriptors(v9.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(i){this[t]=i}}});dt.freezeMethods(v9);const lu=v9;function xC(n,e){const t=this||bD,i=e||t,r=lu.from(i.headers);let s=i.data;return dt.forEach(n,function(a){s=a.call(t,s,r.normalize(),e?e.status:void 0)}),r.normalize(),s}function Mte(n){return!!(n&&n.__CANCEL__)}function yx(n,e,t){Xn.call(this,n??"canceled",Xn.ERR_CANCELED,e,t),this.name="CanceledError"}dt.inherits(yx,Xn,{__CANCEL__:!0});function Rte(n,e,t){const i=t.config.validateStatus;!t.status||!i||i(t.status)?n(t):e(new Xn("Request failed with status code "+t.status,[Xn.ERR_BAD_REQUEST,Xn.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function EAe(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function TAe(n,e){n=n||10;const t=new Array(n),i=new Array(n);let r=0,s=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=i[s];o||(o=c),t[r]=l,i[r]=c;let h=s,p=0;for(;h!==r;)p+=t[h++],h=h%n;if(r=(r+1)%n,r===s&&(s=(s+1)%n),c-o<e)return;const m=u&&c-u;return m?Math.round(p*1e3/m):void 0}}function AAe(n,e){let t=0,i=1e3/e,r,s;const o=(c,u=Date.now())=>{t=u,r=null,s&&(clearTimeout(s),s=null),n(...c)};return[(...c)=>{const u=Date.now(),h=u-t;h>=i?o(c,u):(r=c,s||(s=setTimeout(()=>{s=null,o(r)},i-h)))},()=>r&&o(r)]}const C8=(n,e,t=3)=>{let i=0;const r=TAe(50,250);return AAe(s=>{const o=s.loaded,a=s.lengthComputable?s.total:void 0,l=o-i,c=r(l),u=o<=a;i=o;const h={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&u?(a-o)/c:void 0,event:s,lengthComputable:a!=null,[e?"download":"upload"]:!0};n(h)},t)},sV=(n,e)=>{const t=n!=null;return[i=>e[0]({lengthComputable:t,total:n,loaded:i}),e[1]]},oV=n=>(...e)=>dt.asap(()=>n(...e)),CAe=Lo.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,Lo.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(Lo.origin),Lo.navigator&&/(msie|trident)/i.test(Lo.navigator.userAgent)):()=>!0,MAe=Lo.hasStandardBrowserEnv?{write(n,e,t,i,r,s,o){if(typeof document>"u")return;const a=[`${n}=${encodeURIComponent(e)}`];dt.isNumber(t)&&a.push(`expires=${new Date(t).toUTCString()}`),dt.isString(i)&&a.push(`path=${i}`),dt.isString(r)&&a.push(`domain=${r}`),s===!0&&a.push("secure"),dt.isString(o)&&a.push(`SameSite=${o}`),document.cookie=a.join("; ")},read(n){if(typeof document>"u")return null;const e=document.cookie.match(new RegExp("(?:^|; )"+n+"=([^;]*)"));return e?decodeURIComponent(e[1]):null},remove(n){this.write(n,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function RAe(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function IAe(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function Ite(n,e,t){let i=!RAe(e);return n&&(i||t==!1)?IAe(n,e):e}const aV=n=>n instanceof lu?{...n}:n;function e1(n,e){e=e||{};const t={};function i(c,u,h,p){return dt.isPlainObject(c)&&dt.isPlainObject(u)?dt.merge.call({caseless:p},c,u):dt.isPlainObject(u)?dt.merge({},u):dt.isArray(u)?u.slice():u}function r(c,u,h,p){if(dt.isUndefined(u)){if(!dt.isUndefined(c))return i(void 0,c,h,p)}else return i(c,u,h,p)}function s(c,u){if(!dt.isUndefined(u))return i(void 0,u)}function o(c,u){if(dt.isUndefined(u)){if(!dt.isUndefined(c))return i(void 0,c)}else return i(void 0,u)}function a(c,u,h){if(h in e)return i(c,u);if(h in n)return i(void 0,c)}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u,h)=>r(aV(c),aV(u),h,!0)};return dt.forEach(Object.keys({...n,...e}),function(u){const h=l[u]||r,p=h(n[u],e[u],u);dt.isUndefined(p)&&h!==a||(t[u]=p)}),t}const Nte=n=>{const e=e1({},n);let{data:t,withXSRFToken:i,xsrfHeaderName:r,xsrfCookieName:s,headers:o,auth:a}=e;if(e.headers=o=lu.from(o),e.url=Tte(Ite(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),dt.isFormData(t)){if(Lo.hasStandardBrowserEnv||Lo.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(dt.isFunction(t.getHeaders)){const l=t.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([u,h])=>{c.includes(u.toLowerCase())&&o.set(u,h)})}}if(Lo.hasStandardBrowserEnv&&(i&&dt.isFunction(i)&&(i=i(e)),i||i!==!1&&CAe(e.url))){const l=r&&s&&MAe.read(s);l&&o.set(r,l)}return e},NAe=typeof XMLHttpRequest<"u",PAe=NAe&&function(n){return new Promise(function(t,i){const r=Nte(n);let s=r.data;const o=lu.from(r.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=r,u,h,p,m,y;function b(){m&&m(),y&&y(),r.cancelToken&&r.cancelToken.unsubscribe(u),r.signal&&r.signal.removeEventListener("abort",u)}let w=new XMLHttpRequest;w.open(r.method.toUpperCase(),r.url,!0),w.timeout=r.timeout;function v(){if(!w)return;const S=lu.from("getAllResponseHeaders"in w&&w.getAllResponseHeaders()),P={data:!a||a==="text"||a==="json"?w.responseText:w.response,status:w.status,statusText:w.statusText,headers:S,config:n,request:w};Rte(function(O){t(O),b()},function(O){i(O),b()},P),w=null}"onloadend"in w?w.onloadend=v:w.onreadystatechange=function(){!w||w.readyState!==4||w.status===0&&!(w.responseURL&&w.responseURL.indexOf("file:")===0)||setTimeout(v)},w.onabort=function(){w&&(i(new Xn("Request aborted",Xn.ECONNABORTED,n,w)),w=null)},w.onerror=function(M){const P=M&&M.message?M.message:"Network Error",R=new Xn(P,Xn.ERR_NETWORK,n,w);R.event=M||null,i(R),w=null},w.ontimeout=function(){let M=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const P=r.transitional||Ate;r.timeoutErrorMessage&&(M=r.timeoutErrorMessage),i(new Xn(M,P.clarifyTimeoutError?Xn.ETIMEDOUT:Xn.ECONNABORTED,n,w)),w=null},s===void 0&&o.setContentType(null),"setRequestHeader"in w&&dt.forEach(o.toJSON(),function(M,P){w.setRequestHeader(P,M)}),dt.isUndefined(r.withCredentials)||(w.withCredentials=!!r.withCredentials),a&&a!=="json"&&(w.responseType=r.responseType),c&&([p,y]=C8(c,!0),w.addEventListener("progress",p)),l&&w.upload&&([h,m]=C8(l),w.upload.addEventListener("progress",h),w.upload.addEventListener("loadend",m)),(r.cancelToken||r.signal)&&(u=S=>{w&&(i(!S||S.type?new yx(null,n,w):S),w.abort(),w=null)},r.cancelToken&&r.cancelToken.subscribe(u),r.signal&&(r.signal.aborted?u():r.signal.addEventListener("abort",u)));const T=EAe(r.url);if(T&&Lo.protocols.indexOf(T)===-1){i(new Xn("Unsupported protocol "+T+":",Xn.ERR_BAD_REQUEST,n));return}w.send(s||null)})},kAe=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let i=new AbortController,r;const s=function(c){if(!r){r=!0,a();const u=c instanceof Error?c:this.reason;i.abort(u instanceof Xn?u:new yx(u instanceof Error?u.message:u))}};let o=e&&setTimeout(()=>{o=null,s(new Xn(`timeout ${e} of ms exceeded`,Xn.ETIMEDOUT))},e);const a=()=>{n&&(o&&clearTimeout(o),o=null,n.forEach(c=>{c.unsubscribe?c.unsubscribe(s):c.removeEventListener("abort",s)}),n=null)};n.forEach(c=>c.addEventListener("abort",s));const{signal:l}=i;return l.unsubscribe=()=>dt.asap(a),l}},LAe=kAe,DAe=function*(n,e){let t=n.byteLength;if(!e||t<e){yield n;return}let i=0,r;for(;i<t;)r=i+e,yield n.slice(i,r),i=r},OAe=async function*(n,e){for await(const t of BAe(n))yield*DAe(t,e)},BAe=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:i}=await e.read();if(t)break;yield i}}finally{await e.cancel()}},lV=(n,e,t,i)=>{const r=OAe(n,e);let s=0,o,a=l=>{o||(o=!0,i&&i(l))};return new ReadableStream({async pull(l){try{const{done:c,value:u}=await r.next();if(c){a(),l.close();return}let h=u.byteLength;if(t){let p=s+=h;t(p)}l.enqueue(new Uint8Array(u))}catch(c){throw a(c),c}},cancel(l){return a(l),r.return()}},{highWaterMark:2})},cV=64*1024,{isFunction:z4}=dt,UAe=(({Request:n,Response:e})=>({Request:n,Response:e}))(dt.global),{ReadableStream:uV,TextEncoder:hV}=dt.global,dV=(n,...e)=>{try{return!!n(...e)}catch{return!1}},FAe=n=>{n=dt.merge.call({skipUndefined:!0},UAe,n);const{fetch:e,Request:t,Response:i}=n,r=e?z4(e):typeof fetch=="function",s=z4(t),o=z4(i);if(!r)return!1;const a=r&&z4(uV),l=r&&(typeof hV=="function"?(y=>b=>y.encode(b))(new hV):async y=>new Uint8Array(await new t(y).arrayBuffer())),c=s&&a&&dV(()=>{let y=!1;const b=new t(Lo.origin,{body:new uV,method:"POST",get duplex(){return y=!0,"half"}}).headers.has("Content-Type");return y&&!b}),u=o&&a&&dV(()=>dt.isReadableStream(new i("").body)),h={stream:u&&(y=>y.body)};r&&["text","arrayBuffer","blob","formData","stream"].forEach(y=>{!h[y]&&(h[y]=(b,w)=>{let v=b&&b[y];if(v)return v.call(b);throw new Xn(`Response type '${y}' is not supported`,Xn.ERR_NOT_SUPPORT,w)})});const p=async y=>{if(y==null)return 0;if(dt.isBlob(y))return y.size;if(dt.isSpecCompliantForm(y))return(await new t(Lo.origin,{method:"POST",body:y}).arrayBuffer()).byteLength;if(dt.isArrayBufferView(y)||dt.isArrayBuffer(y))return y.byteLength;if(dt.isURLSearchParams(y)&&(y=y+""),dt.isString(y))return(await l(y)).byteLength},m=async(y,b)=>{const w=dt.toFiniteNumber(y.getContentLength());return w??p(b)};return async y=>{let{url:b,method:w,data:v,signal:T,cancelToken:S,timeout:M,onDownloadProgress:P,onUploadProgress:R,responseType:O,headers:B,withCredentials:N="same-origin",fetchOptions:I}=Nte(y),F=e||fetch;O=O?(O+"").toLowerCase():"text";let j=LAe([T,S&&S.toAbortSignal()],M),W=null;const U=j&&j.unsubscribe&&(()=>{j.unsubscribe()});let H;try{if(R&&c&&w!=="get"&&w!=="head"&&(H=await m(B,v))!==0){let ne=new t(b,{method:"POST",body:v,duplex:"half"}),fe;if(dt.isFormData(v)&&(fe=ne.headers.get("content-type"))&&B.setContentType(fe),ne.body){const[Ae,Pe]=sV(H,C8(oV(R)));v=lV(ne.body,cV,Ae,Pe)}}dt.isString(N)||(N=N?"include":"omit");const q=s&&"credentials"in t.prototype,J={...I,signal:j,method:w.toUpperCase(),headers:B.normalize().toJSON(),body:v,duplex:"half",credentials:q?N:void 0};W=s&&new t(b,J);let G=await(s?F(W,I):F(b,J));const ee=u&&(O==="stream"||O==="response");if(u&&(P||ee&&U)){const ne={};["status","statusText","headers"].forEach(Ce=>{ne[Ce]=G[Ce]});const fe=dt.toFiniteNumber(G.headers.get("content-length")),[Ae,Pe]=P&&sV(fe,C8(oV(P),!0))||[];G=new i(lV(G.body,cV,Ae,()=>{Pe&&Pe(),U&&U()}),ne)}O=O||"text";let Q=await h[dt.findKey(h,O)||"text"](G,y);return!ee&&U&&U(),await new Promise((ne,fe)=>{Rte(ne,fe,{data:Q,headers:lu.from(G.headers),status:G.status,statusText:G.statusText,config:y,request:W})})}catch(q){throw U&&U(),q&&q.name==="TypeError"&&/Load failed|fetch/i.test(q.message)?Object.assign(new Xn("Network Error",Xn.ERR_NETWORK,y,W),{cause:q.cause||q}):Xn.from(q,q&&q.code,y,W)}}},zAe=new Map,Pte=n=>{let e=n&&n.env||{};const{fetch:t,Request:i,Response:r}=e,s=[i,r,t];let o=s.length,a=o,l,c,u=zAe;for(;a--;)l=s[a],c=u.get(l),c===void 0&&u.set(l,c=a?new Map:FAe(e)),u=c;return c};Pte();const _D={http:tAe,xhr:PAe,fetch:{get:Pte}};dt.forEach(_D,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const fV=n=>`- ${n}`,jAe=n=>dt.isFunction(n)||n===null||n===!1;function VAe(n,e){n=dt.isArray(n)?n:[n];const{length:t}=n;let i,r;const s={};for(let o=0;o<t;o++){i=n[o];let a;if(r=i,!jAe(i)&&(r=_D[(a=String(i)).toLowerCase()],r===void 0))throw new Xn(`Unknown adapter '${a}'`);if(r&&(dt.isFunction(r)||(r=r.get(e))))break;s[a||"#"+o]=r}if(!r){const o=Object.entries(s).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=t?o.length>1?`since :
`+o.map(fV).join(`
`):" "+fV(o[0]):"as no adapter specified";throw new Xn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return r}const kte={getAdapter:VAe,adapters:_D};function vC(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new yx(null,n)}function pV(n){return vC(n),n.headers=lu.from(n.headers),n.data=xC.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),kte.getAdapter(n.adapter||bD.adapter,n)(n).then(function(i){return vC(n),i.data=xC.call(n,n.transformResponse,i),i.headers=lu.from(i.headers),i},function(i){return Mte(i)||(vC(n),i&&i.response&&(i.response.data=xC.call(n,n.transformResponse,i.response),i.response.headers=lu.from(i.response.headers))),Promise.reject(i)})}const Lte="1.13.2",b9={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{b9[n]=function(i){return typeof i===n||"a"+(e<1?"n ":" ")+n}});const mV={};b9.transitional=function(e,t,i){function r(s,o){return"[Axios v"+Lte+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,a)=>{if(e===!1)throw new Xn(r(o," has been removed"+(t?" in "+t:"")),Xn.ERR_DEPRECATED);return t&&!mV[o]&&(mV[o]=!0,console.warn(r(o," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(s,o,a):!0}};b9.spelling=function(e){return(t,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function HAe(n,e,t){if(typeof n!="object")throw new Xn("options must be an object",Xn.ERR_BAD_OPTION_VALUE);const i=Object.keys(n);let r=i.length;for(;r-- >0;){const s=i[r],o=e[s];if(o){const a=n[s],l=a===void 0||o(a,s,n);if(l!==!0)throw new Xn("option "+s+" must be "+l,Xn.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Xn("Unknown option "+s,Xn.ERR_BAD_OPTION)}}const DS={assertOptions:HAe,validators:b9},Ru=DS.validators;class M8{constructor(e){this.defaults=e||{},this.interceptors={request:new iV,response:new iV}}async request(e,t){try{return await this._request(e,t)}catch(i){if(i instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const s=r.stack?r.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=e1(this.defaults,t);const{transitional:i,paramsSerializer:r,headers:s}=t;i!==void 0&&DS.assertOptions(i,{silentJSONParsing:Ru.transitional(Ru.boolean),forcedJSONParsing:Ru.transitional(Ru.boolean),clarifyTimeoutError:Ru.transitional(Ru.boolean)},!1),r!=null&&(dt.isFunction(r)?t.paramsSerializer={serialize:r}:DS.assertOptions(r,{encode:Ru.function,serialize:Ru.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),DS.assertOptions(t,{baseUrl:Ru.spelling("baseURL"),withXsrfToken:Ru.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=s&&dt.merge(s.common,s[t.method]);s&&dt.forEach(["delete","get","head","post","put","patch","common"],y=>{delete s[y]}),t.headers=lu.concat(o,s);const a=[];let l=!0;this.interceptors.request.forEach(function(b){typeof b.runWhen=="function"&&b.runWhen(t)===!1||(l=l&&b.synchronous,a.unshift(b.fulfilled,b.rejected))});const c=[];this.interceptors.response.forEach(function(b){c.push(b.fulfilled,b.rejected)});let u,h=0,p;if(!l){const y=[pV.bind(this),void 0];for(y.unshift(...a),y.push(...c),p=y.length,u=Promise.resolve(t);h<p;)u=u.then(y[h++],y[h++]);return u}p=a.length;let m=t;for(;h<p;){const y=a[h++],b=a[h++];try{m=y(m)}catch(w){b.call(this,w);break}}try{u=pV.call(this,m)}catch(y){return Promise.reject(y)}for(h=0,p=c.length;h<p;)u=u.then(c[h++],c[h++]);return u}getUri(e){e=e1(this.defaults,e);const t=Ite(e.baseURL,e.url,e.allowAbsoluteUrls);return Tte(t,e.params,e.paramsSerializer)}}dt.forEach(["delete","get","head","options"],function(e){M8.prototype[e]=function(t,i){return this.request(e1(i||{},{method:e,url:t,data:(i||{}).data}))}});dt.forEach(["post","put","patch"],function(e){function t(i){return function(s,o,a){return this.request(e1(a||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}M8.prototype[e]=t(),M8.prototype[e+"Form"]=t(!0)});const OS=M8;class wD{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(s){t=s});const i=this;this.promise.then(r=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](r);i._listeners=null}),this.promise.then=r=>{let s;const o=new Promise(a=>{i.subscribe(a),s=a}).then(r);return o.cancel=function(){i.unsubscribe(s)},o},e(function(s,o,a){i.reason||(i.reason=new yx(s,o,a),t(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=i=>{e.abort(i)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new wD(function(r){e=r}),cancel:e}}}const $Ae=wD;function GAe(n){return function(t){return n.apply(null,t)}}function WAe(n){return dt.isObject(n)&&n.isAxiosError===!0}const MN={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(MN).forEach(([n,e])=>{MN[e]=n});const KAe=MN;function Dte(n){const e=new OS(n),t=fte(OS.prototype.request,e);return dt.extend(t,OS.prototype,e,{allOwnKeys:!0}),dt.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Dte(e1(n,r))},t}const ys=Dte(bD);ys.Axios=OS;ys.CanceledError=yx;ys.CancelToken=$Ae;ys.isCancel=Mte;ys.VERSION=Lte;ys.toFormData=x9;ys.AxiosError=Xn;ys.Cancel=ys.CanceledError;ys.all=function(e){return Promise.all(e)};ys.spread=GAe;ys.isAxiosError=WAe;ys.mergeConfig=e1;ys.AxiosHeaders=lu;ys.formToJSON=n=>Cte(dt.isHTMLForm(n)?new FormData(n):n);ys.getAdapter=kte.getAdapter;ys.HttpStatusCode=KAe;ys.default=ys;const gV=ys;class qAe{constructor(){E(this,"cache",new Map);E(this,"abortController",null)}async search(e,t,i=10){if(!e.trim())return[];this.abortController&&this.abortController.abort();const r=`${e}|${t?.lat}|${t?.lon}`;if(this.cache.has(r))return this.cache.get(r);this.abortController=new AbortController;try{const s={q:e,format:"json",addressdetails:1,limit:50};t&&(s.viewbox=[t.lon-.7,t.lat+.7,t.lon+.7,t.lat-.7].join(","),s.bounded=0);let a=(await gV.get("https://nominatim.openstreetmap.org/search",{params:s,headers:{"User-Agent":"G3ZKP-Messenger/1.0"},signal:this.abortController.signal})).data.map(l=>({id:l.place_id,name:l.name||l.display_name.split(",")[0],address:l.display_name,lat:parseFloat(l.lat),lon:parseFloat(l.lon),type:l.type,importance:parseFloat(l.importance||"0")}));if(t?(a=a.map(l=>({...l,distance:this.calculateDistance(t.lat,t.lon,l.lat,l.lon)})),a.sort((l,c)=>{const u=l.distance||1/0,h=c.distance||1/0,p=80467;return u<=p&&h<=p?u-h:u<=p?-1:h<=p?1:c.importance-l.importance})):a.sort((l,c)=>c.importance-l.importance),a=a.slice(0,i),this.cache.set(r,a),this.cache.size>20){const l=this.cache.keys().next().value;this.cache.delete(l)}return a}catch(s){return gV.isCancel(s)?[]:(console.error("[SearchService] Search error:",s),[])}}calculateDistance(e,t,i,r){const o=e*Math.PI/180,a=i*Math.PI/180,l=(i-e)*Math.PI/180,c=(r-t)*Math.PI/180,u=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o)*Math.cos(a)*Math.sin(c/2)*Math.sin(c/2);return 6371e3*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))}formatDistance(e){return e<1e3?`${Math.round(e)}m`:e<1e4?`${(e/1e3).toFixed(1)}km`:e<1609344?`${Math.round(e/1e3)}km`:`${Math.round(e/1609.344)}mi`}clearCache(){this.cache.clear()}}const yV=new qAe;function ZAe({isNavigating:n,destinationName:e,activeTransportMode:t,currentLocation:i,onMenuClick:r,onSearchSelect:s,onTransportModeChange:o,onEndNavigation:a}){const[l,c]=$.useState(""),[u,h]=$.useState([]),[p,m]=$.useState(!1),[y,b]=$.useState(!1),[w,v]=$.useState(!1),T=$.useRef(),S=$.useRef(null),M=$.useRef(null);$.useEffect(()=>{if(T.current&&clearTimeout(T.current),l.trim().length<2){h([]),b(!1);return}return m(!0),T.current=setTimeout(async()=>{const B=await yV.search(l,i,8);h(B),m(!1),b(!0)},300),()=>{T.current&&clearTimeout(T.current)}},[l,i]),$.useEffect(()=>{const B=N=>{M.current&&!M.current.contains(N.target)&&(b(!1),v(!1))};return document.addEventListener("mousedown",B),()=>document.removeEventListener("mousedown",B)},[]);const P=B=>{s(B),c(""),h([]),b(!1),v(!1)},R=()=>{c(""),h([]),b(!1)},O=[{mode:"car",icon:f.jsx(h_,{className:"w-5 h-5"}),label:"Drive"},{mode:"transit",icon:f.jsx(a7,{className:"w-5 h-5"}),label:"Transit"},{mode:"walk",icon:f.jsx(d_,{className:"w-5 h-5"}),label:"Walk"}];return f.jsxs("div",{ref:M,className:`fixed top-4 left-4 right-4 md:right-auto z-[1000] transition-all duration-300 ease-in-out ${n?"md:max-w-[400px]":"md:max-w-[600px] md:min-w-[400px]"}`,children:[f.jsxs("div",{className:"flex items-center gap-2 md:gap-3 bg-slate-900/95 backdrop-blur-xl border border-slate-400/20 rounded-2xl p-2 md:p-3 shadow-2xl",children:[f.jsx("button",{onClick:r,className:"flex-shrink-0 w-12 h-12 md:w-11 md:h-11 flex items-center justify-center rounded-xl hover:bg-slate-800 transition-colors active:scale-95","aria-label":"Menu",children:f.jsx(Iae,{className:"w-6 h-6 text-slate-200"})}),n?f.jsxs("button",{onClick:a,className:"flex-1 flex items-center gap-3 px-4 py-3 rounded-xl bg-teal-500/20 border border-teal-500/30 transition-all hover:bg-teal-500/30 min-w-0 min-h-[48px]",children:[f.jsx(m2,{className:"w-5 h-5 text-teal-300 flex-shrink-0"}),f.jsxs("span",{className:"text-slate-200 font-medium truncate text-base",children:["To: ",e||"Destination"]}),f.jsx(Hm,{className:"w-5 h-5 text-slate-400 flex-shrink-0 ml-auto"})]}):f.jsxs("div",{className:"flex-1 relative min-w-0",children:[f.jsx(ja,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400 pointer-events-none"}),f.jsx("input",{ref:S,type:"text",value:l,onChange:B=>c(B.target.value),onFocus:()=>{v(!0),l.length>=2&&b(!0)},placeholder:"Where to?",className:"w-full bg-slate-800/60 border border-slate-600/30 rounded-xl pl-12 pr-12 py-3.5 text-slate-200 placeholder-slate-400 focus:outline-none focus:border-teal-500/50 text-base font-medium transition-colors min-h-[48px]"}),l&&f.jsx("button",{onClick:R,className:"absolute right-4 top-1/2 transform -translate-y-1/2 p-2 hover:bg-slate-700 rounded-full transition-colors",children:f.jsx(Ui,{className:"w-5 h-5 text-slate-400"})}),p&&f.jsx("div",{className:"absolute right-12 top-1/2 transform -translate-y-1/2",children:f.jsx("div",{className:"w-5 h-5 border-2 border-teal-500 border-t-transparent rounded-full animate-spin"})})]}),f.jsx("div",{className:"flex-shrink-0 flex items-center gap-1 bg-slate-800/60 rounded-xl p-1",children:n?f.jsx("div",{className:"w-11 h-11 flex items-center justify-center rounded-lg bg-teal-500/30 text-teal-300",children:O.find(B=>B.mode===t)?.icon}):O.map(({mode:B,icon:N})=>f.jsx("button",{onClick:()=>o(B),className:`w-11 h-11 flex items-center justify-center rounded-lg transition-all active:scale-95 ${t===B?"bg-teal-500/30 text-teal-300":"text-slate-400 hover:text-slate-200 hover:bg-slate-700"}`,"aria-label":B,children:N},B))})]}),y&&u.length>0&&!n&&f.jsx("div",{className:"mt-2 bg-slate-900/95 backdrop-blur-md border border-slate-400/20 rounded-xl shadow-2xl max-h-[350px] overflow-y-auto",children:u.map(B=>f.jsxs("button",{onClick:()=>P(B),className:"w-full px-4 py-3 hover:bg-teal-500/10 transition-colors flex items-start gap-3 border-b border-slate-800 last:border-b-0",children:[f.jsx("div",{className:"flex-shrink-0 w-9 h-9 bg-teal-500/20 rounded-lg flex items-center justify-center mt-0.5",children:f.jsx(Ba,{className:"w-4 h-4 text-teal-400"})}),f.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[f.jsx("h4",{className:"font-medium text-slate-200 truncate text-sm",children:B.name}),f.jsx("p",{className:"text-xs text-slate-400 truncate",children:B.address}),B.distance!==void 0&&f.jsx("div",{className:"flex items-center gap-2 mt-1",children:f.jsxs("span",{className:"flex items-center gap-1 text-xs text-teal-400",children:[f.jsx(m2,{className:"w-3 h-3"}),yV.formatDistance(B.distance)]})})]})]},B.id))}),y&&u.length===0&&l.length>=2&&!p&&!n&&f.jsxs("div",{className:"mt-2 bg-slate-900/95 backdrop-blur-md border border-slate-400/20 rounded-xl shadow-2xl p-6 text-center",children:[f.jsx(Ba,{className:"w-10 h-10 text-slate-600 mx-auto mb-2"}),f.jsx("p",{className:"text-slate-400 text-sm",children:"No locations found"}),f.jsx("p",{className:"text-xs text-slate-600 mt-1",children:"Try a different search term"})]})]})}function YAe({isOpen:n,route:e,destinationName:t,transportMode:i,distanceToNext:r=0,timeToDestination:s=0,currentStep:o=0,isNavigating:a,onClose:l,onStartNavigation:c,onEndNavigation:u}){const[h,p]=$.useState(!1);$.useState(null);const m=$.useRef(null),y=T=>{if(T<60)return`${Math.round(T)}s`;const S=Math.floor(T/60);if(S<60)return`${S} min`;const M=Math.floor(S/60),P=S%60;return`${M}h ${P}m`},b=T=>T<1e3?`${Math.round(T)}m`:`${(T/1e3).toFixed(1)}km`,w=i==="car"?h_:i==="transit"?a7:d_;if(!n&&!e)return null;const v=h?"h-[50vh]":"h-auto max-h-[35vh]";return f.jsx("div",{ref:m,className:`fixed bottom-0 left-0 right-0 z-[999] transition-all duration-400 ease-out ${v}`,style:{transform:n||e?"translateY(0)":"translateY(100%)"},children:f.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-md border-t border-slate-400/20 rounded-t-2xl shadow-2xl h-full flex flex-col",children:[f.jsx("div",{className:"flex items-center justify-center py-2 cursor-grab active:cursor-grabbing",onClick:()=>p(!h),children:f.jsx("div",{className:"w-10 h-1 bg-slate-600 rounded-full"})}),f.jsx("div",{className:"px-4 pb-4 flex-1 overflow-y-auto",children:e?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-12 h-12 bg-teal-500/20 rounded-xl flex items-center justify-center",children:f.jsx(w,{className:"w-6 h-6 text-teal-400"})}),f.jsxs("div",{children:[f.jsx("h3",{className:"text-slate-200 font-semibold text-lg",children:y(e.duration)}),f.jsxs("p",{className:"text-slate-400 text-sm",children:[b(e.distance)," via ",i==="car"?"fastest route":i]})]})]}),f.jsx("button",{onClick:l,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-800 transition-colors",children:f.jsx(Ui,{className:"w-5 h-5 text-slate-400"})})]}),t&&f.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-slate-800/50 rounded-xl",children:[f.jsx(Ba,{className:"w-5 h-5 text-green-400"}),f.jsx("span",{className:"text-slate-200 font-medium truncate",children:t})]}),a?f.jsxs("div",{className:"space-y-3",children:[r>0&&f.jsx("div",{className:"p-4 bg-teal-500/20 border border-teal-500/30 rounded-xl",children:f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(YP,{className:"w-8 h-8 text-teal-400"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-teal-300 font-bold text-xl",children:b(r)}),f.jsx("p",{className:"text-slate-400 text-sm",children:"to next turn"})]})]})}),f.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-xl",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(z0,{className:"w-4 h-4 text-slate-400"}),f.jsx("span",{className:"text-slate-400 text-sm",children:"Remaining"})]}),f.jsx("span",{className:"text-slate-200 font-medium",children:y(s)})]}),f.jsx("button",{onClick:u,className:"w-full py-3 bg-red-500/20 hover:bg-red-500/30 text-red-400 font-medium rounded-xl transition-colors border border-red-500/30",children:"End Navigation"})]}):f.jsxs("button",{onClick:c,className:"w-full py-4 bg-teal-500 hover:bg-teal-400 text-slate-900 font-bold rounded-xl transition-colors flex items-center justify-center gap-2 active:scale-[0.98]",children:[f.jsx(m2,{className:"w-5 h-5"}),"Start Navigation"]}),h&&e.legs&&e.legs[0]?.steps&&f.jsxs("div",{className:"mt-4 space-y-2",children:[f.jsx("h4",{className:"text-slate-400 text-sm font-medium mb-2",children:"Route Steps"}),e.legs[0].steps.map((T,S)=>f.jsx("div",{className:`p-3 rounded-lg border transition-colors ${S===o?"bg-teal-500/20 border-teal-500/30":"bg-slate-800/50 border-slate-700/50"}`,children:f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx("div",{className:`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${S===o?"bg-teal-500 text-slate-900":"bg-slate-700 text-slate-400"}`,children:S+1}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:`text-sm ${S===o?"text-teal-300":"text-slate-300"}`,children:T.maneuver?.instruction||T.name||"Continue"}),f.jsxs("p",{className:"text-xs text-slate-500 mt-0.5",children:[b(T.distance),"  ",y(T.duration)]})]})]})},S))]})]}):f.jsxs("div",{className:"text-center py-8",children:[f.jsx(Ba,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),f.jsx("p",{className:"text-slate-400",children:"Search for a destination to get started"})]})})]})})}const j4={HAZARD:60*60*1e3,TRAFFIC_SPEED:5*60*1e3,BUSINESS_REVIEW:365*24*60*60*1e3};function XAe(n){const e=n.toLowerCase().replace("_","-"),t=Date.now().toString(36),i=Math.random().toString(36).substring(2,11);return`${e}_${t}_${i}`}function QAe(n){switch(n){case"HAZARD":return j4.HAZARD;case"TRAFFIC_SPEED":return j4.TRAFFIC_SPEED;case"BUSINESS_REVIEW":return j4.BUSINESS_REVIEW;default:return j4.HAZARD}}function JAe(n,e,t,i){return JSON.stringify({type:n,location:{lat:e.latitude,lng:e.longitude,ts:e.timestamp},data:t,timestamp:i})}async function Ote(n,e,t,i,r){const s=Date.now(),o=XAe(n),a=s+QAe(n),l=JAe(n,e,t,s),c=Ut(l),u=Vn.sign.detached(c,i),h=Vt(u,"base64"),p=Vt(r,"base64");return{id:o,type:n,location:e,timestamp:s,expiresAt:a,data:t,signature:h,publicKey:p,version:"1.0.0"}}const eCe={locationObfuscation:!0,routeTracking:!1,dataPersistence:"ephemeral",p2pUpdates:!1},tCe="https://router.project-osrm.org";class nCe{constructor(){E(this,"baseUrl");E(this,"privacySettings");E(this,"watchId",null);E(this,"locationListeners",[]);E(this,"routeCache",new Map);E(this,"searchCache",new Map);E(this,"currentHeading",0);E(this,"currentSpeed",0);E(this,"currentPosition",null);E(this,"trafficReportInterval",null);E(this,"lastTrafficReportTime",0);E(this,"isNavigating",!1);E(this,"p2pKeyPair",null);E(this,"TRAFFIC_REPORT_INTERVAL_MS",3e4);E(this,"MIN_SPEED_FOR_REPORT",5);this.baseUrl="",this.privacySettings=eCe,this.initializeP2PKeys()}initializeP2PKeys(){try{const e=localStorage.getItem("g3zkp_navigation_keys");if(e){const t=JSON.parse(e);this.p2pKeyPair={publicKey:new Uint8Array(Object.values(t.publicKey)),secretKey:new Uint8Array(Object.values(t.secretKey))}}else this.p2pKeyPair=Vn.sign.keyPair(),localStorage.setItem("g3zkp_navigation_keys",JSON.stringify({publicKey:Array.from(this.p2pKeyPair.publicKey),secretKey:Array.from(this.p2pKeyPair.secretKey)}));console.log("[NavigationService] P2P keys initialized")}catch(e){console.error("[NavigationService] Failed to initialize P2P keys:",e),this.p2pKeyPair=Vn.sign.keyPair()}}obfuscatePosition(e,t="medium"){if(!this.privacySettings.locationObfuscation)return e;const r={low:1e-4,medium:5e-4,high:.001,maximum:.005}[t]||5e-4;return[e[0]+(Math.random()*r*2-r),e[1]+(Math.random()*r*2-r)]}async getCurrentPosition(){return new Promise((e,t)=>{if(!navigator.geolocation){t(new Error("Geolocation not supported"));return}navigator.geolocation.getCurrentPosition(i=>{const r=[i.coords.longitude,i.coords.latitude];this.currentHeading=i.coords.heading||0,this.currentSpeed=(i.coords.speed||0)*3.6,e(this.obfuscatePosition(r))},i=>{t(new Error(`Location error: ${i.message}`))},{enableHighAccuracy:!0,timeout:1e4})})}startWatchingPosition(e){navigator.geolocation&&(this.locationListeners.push(e),this.watchId===null&&(this.watchId=navigator.geolocation.watchPosition(t=>{const i=[t.coords.longitude,t.coords.latitude];this.currentHeading=t.coords.heading||this.currentHeading,this.currentSpeed=(t.coords.speed||0)*3.6;const r=this.obfuscatePosition(i);this.locationListeners.forEach(s=>s(r,this.currentHeading,this.currentSpeed))},t=>console.error("Watch position error:",t),{enableHighAccuracy:!0,maximumAge:1e3})))}stopWatchingPosition(){this.watchId!==null&&(navigator.geolocation.clearWatch(this.watchId),this.watchId=null),this.locationListeners=[]}getHeading(){return this.currentHeading}getSpeed(){return this.currentSpeed}startNavigation(){this.isNavigating||(this.isNavigating=!0,console.log("[NavigationService] Starting active navigation with traffic reporting"),this.startWatchingPosition((e,t,i)=>{this.currentPosition=e,this.currentHeading=t,this.currentSpeed=i}),this.trafficReportInterval=setInterval(()=>{this.generateTrafficReport()},this.TRAFFIC_REPORT_INTERVAL_MS))}stopNavigation(){this.isNavigating=!1,this.trafficReportInterval&&(clearInterval(this.trafficReportInterval),this.trafficReportInterval=null),this.stopWatchingPosition(),console.log("[NavigationService] Stopped active navigation")}async generateTrafficReport(){if(!this.p2pKeyPair||!Xl.isInitialized()||!this.currentPosition||this.currentSpeed<this.MIN_SPEED_FOR_REPORT)return;const e=Date.now();if(!(e-this.lastTrafficReportTime<this.TRAFFIC_REPORT_INTERVAL_MS*.9))try{const t={latitude:this.currentPosition[1],longitude:this.currentPosition[0],timestamp:e,heading:this.currentHeading,speed:this.currentSpeed,accuracy:10},i={speed:this.currentSpeed,freeFlowSpeed:this.estimateFreeFlowSpeed(),congestionLevel:this.calculateCongestionLevel(),sampleCount:1,direction:this.currentHeading},r=await Ote("TRAFFIC_SPEED",t,i,this.p2pKeyPair.secretKey,this.p2pKeyPair.publicKey);await Xl.broadcastGeoReport(r,"TRAFFIC")&&(this.lastTrafficReportTime=e,console.log(`[NavigationService] Traffic report broadcast: ${this.currentSpeed.toFixed(1)} km/h`))}catch(t){console.error("[NavigationService] Failed to generate traffic report:",t)}}estimateFreeFlowSpeed(){return 50}calculateCongestionLevel(){const e=this.estimateFreeFlowSpeed();return this.currentSpeed>=e*.9?0:this.currentSpeed>=e*.7?.25:this.currentSpeed>=e*.5?.5:this.currentSpeed>=e*.3?.75:1}isActiveNavigation(){return this.isNavigating}async calculateRoute(e,t="car",i=1){if(e.length<2)return[];const r=`${e.map(o=>o.join(",")).join("_")}_${t}`,s=this.routeCache.get(r);if(s)return s;try{const o=e.map(h=>`${h[0]},${h[1]}`).join(";"),a=`${tCe}/route/v1/${t==="car"?"driving":t==="bike"?"cycling":"foot"}/${o}?alternatives=${i}&steps=true&overview=full&annotations=true&geometries=geojson`,l=await fetch(a,{headers:{"User-Agent":"G3ZKP-Navigator/1.0"}});if(!l.ok)throw new Error(`OSRM routing failed: ${l.status}`);const c=await l.json();if(c.code!=="Ok")throw new Error(c.message||"OSRM error");const u=c.routes.map((h,p)=>({id:`route_${Date.now()}_${p}`,geometry:h.geometry,distance:h.distance,duration:h.duration,legs:h.legs.map(m=>({distance:m.distance,duration:m.duration,summary:m.summary||"",steps:m.steps.map(y=>({distance:y.distance,duration:y.duration,geometry:y.geometry,name:y.name||"Road",instruction:y.maneuver?.instruction||this.generateInstruction(y),maneuver:{type:y.maneuver?.type||"continue",modifier:y.maneuver?.modifier,instruction:y.maneuver?.instruction||this.generateInstruction(y),bearing_after:y.maneuver?.bearing_after||0,bearing_before:y.maneuver?.bearing_before||0,location:y.maneuver?.location||e[0]}}))})),summary:`${(h.distance/1e3).toFixed(1)} km, ${Math.round(h.duration/60)} min`,privacy:{obfuscated:this.privacySettings.locationObfuscation,fuzzyPoints:[],timestamp:Date.now(),sessionId:null}}));return this.routeCache.set(r,u),setTimeout(()=>this.routeCache.delete(r),5*60*1e3),u}catch(o){return console.warn("OSRM routing failed, using fallback:",o),this.generateFallbackRoute(e)}}generateInstruction(e){const t=e.maneuver?.type||"continue",i=e.maneuver?.modifier||"",r=e.name||"the road";switch(t){case"turn":return`Turn ${i} onto ${r}`;case"new name":return`Continue onto ${r}`;case"depart":return`Head ${i} on ${r}`;case"arrive":return"You have arrived at your destination";case"merge":return`Merge ${i} onto ${r}`;case"ramp":return`Take the ramp ${i}`;case"fork":return`Keep ${i} at the fork`;case"roundabout":return`Enter the roundabout, take the exit onto ${r}`;case"exit roundabout":return`Exit onto ${r}`;default:return`Continue on ${r}`}}async getSpeedLimit(e){try{const t=`https://overpass-api.de/api/interpreter?data=[out:json];way(around:50,${e[1]},${e[0]})[maxspeed];out;`,i=await fetch(t);if(!i.ok)return null;const r=await i.json();if(r.elements?.length>0){const s=r.elements[0].tags?.maxspeed;if(s){const o=parseInt(s);return isNaN(o)?null:o}}return null}catch{return null}}generateFallbackRoute(e){if(e.length<2)return[];const t=e[0],i=e[e.length-1],r=this.calculateDistance(t,i),s=r/50*3600,o=[],a=20;for(let l=0;l<=a;l++){const c=l/a;o.push([t[0]+(i[0]-t[0])*c,t[1]+(i[1]-t[1])*c])}return[{id:`route_${Date.now()}`,geometry:{type:"LineString",coordinates:o},distance:r*1e3,duration:s,legs:[{steps:[{distance:r*1e3,duration:s,geometry:{type:"LineString",coordinates:o},instruction:"Proceed to destination",name:"Route",maneuver:{type:"depart",instruction:"Start navigation",bearing_after:0,location:t}}],distance:r*1e3,duration:s,summary:`${r.toFixed(1)} km`}],summary:`Direct route (${r.toFixed(1)} km)`,privacy:{obfuscated:this.privacySettings.locationObfuscation,fuzzyPoints:[],timestamp:Date.now(),sessionId:null}}]}calculateDistance(e,t){const r=this.toRad(t[1]-e[1]),s=this.toRad(t[0]-e[0]),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(this.toRad(e[1]))*Math.cos(this.toRad(t[1]))*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))}toRad(e){return e*(Math.PI/180)}async search(e,t){if(!e.trim())return[];const i=`search_${e}_${t?.nearLocation?.join(",")}_${t?.radiusMiles}`,r=this.searchCache.get(i);if(r)return r;try{const s=new URLSearchParams({q:e,format:"jsonv2",addressdetails:"1",limit:"15",dedupe:"1"});if(t?.nearLocation&&t?.radiusMiles){const c=t.radiusMiles*1.60934,u=c/111.32,h=c/(111.32*Math.cos(t.nearLocation[1]*Math.PI/180)),p=[t.nearLocation[0]-h,t.nearLocation[1]+u,t.nearLocation[0]+h,t.nearLocation[1]-u].join(",");s.set("viewbox",p),s.set("bounded","0")}else t?.bbox&&(s.set("viewbox",t.bbox.join(",")),s.set("bounded","1"));const o=await fetch(`/api/navigation/search?${s}`);if(!o.ok)throw new Error(`Search failed: ${o.status}`);let l=(await o.json()).map(c=>({id:`osm:${c.osm_type?.[0]||"n"}${c.osm_id}`,name:c.display_name,coordinate:[parseFloat(c.lon),parseFloat(c.lat)],type:c.type,category:c.class,address:c.address||{},importance:parseFloat(c.importance||"0"),distance:t?.nearLocation?this.calculateDistance(t.nearLocation,[parseFloat(c.lon),parseFloat(c.lat)]):void 0}));return t?.nearLocation&&l.sort((c,u)=>{const h=c.distance??1/0,p=u.distance??1/0,m=c.importance||0,y=u.importance||0,b=m*10-h*.1;return y*10-p*.1-b}),this.searchCache.set(i,l),setTimeout(()=>this.searchCache.delete(i),30*1e3),l.slice(0,10)}catch(s){return console.error("Search error:",s),[]}}async reverseGeocode(e){try{const t=await fetch(`${this.baseUrl}/api/navigation/reverse?lat=${e[1]}&lon=${e[0]}`);return t.ok&&(await t.json()).display_name||"Unknown location"}catch{return"Unknown location"}}async downloadRegion(e,t,i=[0,14]){try{const r=await fetch(`${this.baseUrl}/api/navigation/maps/download`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({region:{bbox:e,name:t,zoomRange:i},priority:"high"})});if(!r.ok)throw new Error("Download request failed");return await r.json()}catch(r){throw console.error("Download region error:",r),r}}async getDownloadStatus(e){return await(await fetch(`${this.baseUrl}/api/navigation/maps/status/${e}`)).json()}async getOfflineRegions(){const e=localStorage.getItem("g3zkp_offline_regions");return e?JSON.parse(e):[]}async deleteOfflineRegion(e){const i=(await this.getOfflineRegions()).filter(r=>r.id!==e);localStorage.setItem("g3zkp_offline_regions",JSON.stringify(i))}setPrivacySettings(e){this.privacySettings={...this.privacySettings,...e}}getPrivacySettings(){return{...this.privacySettings}}}const rc=new nCe,iCe=[10,20,30,50,100],rCe=({onRouteCalculated:n,currentLocation:e})=>{const[t,i]=$.useState(""),[r,s]=$.useState(""),[o,a]=$.useState(""),[l,c]=$.useState([]),[u,h]=$.useState([]),[p,m]=$.useState([]),[y,b]=$.useState(e?{name:"Current Location",coordinate:e}:null),[w,v]=$.useState(null),[T,S]=$.useState([]),[M,P]=$.useState("car"),[R,O]=$.useState(!1),[B,N]=$.useState(!1),[I,F]=$.useState(!1),[j,W]=$.useState(!1),[U,H]=$.useState(!1),[q,J]=$.useState(!1),[G,ee]=$.useState(!1),[Q,ne]=$.useState(30),[fe,Ae]=$.useState(!1),[Pe,Ce]=$.useState({avoidMotorways:!1,avoidTolls:!1,avoidFerries:!1,distanceUnits:"auto"}),de=$.useRef(null),Ne=$.useRef(null),et=$.useRef(null),me=$.useRef(!1);$.useEffect(()=>()=>{de.current&&clearTimeout(de.current),Ne.current&&clearTimeout(Ne.current),et.current&&clearTimeout(et.current)},[]);const nt=$.useCallback(async(Oe,xt)=>{const pe=xt==="start"?de:xt==="end"?Ne:et,qe=xt==="start"?O:xt==="end"?N:F,$e=xt==="start"?c:xt==="end"?h:m,Xe=xt==="start"?H:xt==="end"?J:ee;if(pe.current&&clearTimeout(pe.current),!Oe.trim()||Oe.length<2){$e([]),Xe(!1);return}qe(!0),Xe(!0),pe.current=setTimeout(async()=>{try{const Ye=await rc.search(Oe,{nearLocation:e,radiusMiles:Q});$e(Ye)}catch(Ye){console.error("Search error:",Ye)}finally{qe(!1)}},200)},[e,Q]),Pt=$.useCallback((Oe,xt)=>{me.current=!0;const pe={name:Oe.name,coordinate:Oe.coordinate,displayName:Oe.name.split(",")[0]};xt==="start"?(b(pe),i(pe.displayName||pe.name),H(!1),c([])):xt==="end"?(v(pe),s(pe.displayName||pe.name),J(!1),h([])):(S(qe=>[...qe,pe]),a(""),ee(!1),m([])),setTimeout(()=>{me.current=!1},100)},[]),zt=Oe=>{S(xt=>xt.filter((pe,qe)=>qe!==Oe))},Dt=$.useCallback(async()=>{try{const Oe=await rc.getCurrentPosition();b({name:"Current Location",coordinate:Oe,displayName:"Current Location"}),i("Current Location")}catch(Oe){console.error("Failed to get current location:",Oe)}},[]),gt=$.useCallback(async()=>{if(!(!y||!w)){W(!0);try{const Oe=[y.coordinate,...T.map(pe=>pe.coordinate),w.coordinate],xt=await rc.calculateRoute(Oe,M,3);xt.length>0&&n(xt[0])}finally{W(!1)}}},[y,w,T,M,n]),vt=Oe=>{setTimeout(()=>{me.current||(Oe==="start"?H(!1):Oe==="end"?J(!1):ee(!1))},300)};return f.jsxs("div",{className:"space-y-3",children:[f.jsxs("h3",{className:"text-cyan-400 font-mono text-sm flex items-center gap-2",children:[f.jsx(m2,{size:16}),"ROUTE_PLANNER"]}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:`flex items-center gap-2 bg-gray-900 border rounded px-2 py-1.5 ${y?"border-green-600":"border-gray-700"}`,children:[f.jsx(Ba,{size:14,className:"text-green-400"}),f.jsx("input",{type:"text",value:t,onChange:Oe=>{i(Oe.target.value),b(null),nt(Oe.target.value,"start")},onFocus:()=>l.length>0&&H(!0),onBlur:()=>vt("start"),placeholder:"From...",className:"flex-1 bg-transparent text-white outline-none font-mono text-xs"}),R&&f.jsx(xr,{size:12,className:"animate-spin text-cyan-400"}),f.jsx("button",{onClick:Dt,className:"text-cyan-400 hover:text-cyan-300 text-[10px] font-mono",title:"Use current location",children:"GPS"}),t&&f.jsx("button",{onClick:()=>{i(""),b(null)},children:f.jsx(Ui,{size:12,className:"text-gray-500 hover:text-white"})}),y&&f.jsx("span",{className:"text-green-400 text-[10px]",children:""})]}),U&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900 border border-gray-700 rounded max-h-40 overflow-y-auto z-50 shadow-lg",children:R?f.jsxs("div",{className:"px-3 py-2 text-xs text-gray-400 flex items-center gap-2",children:[f.jsx(xr,{size:12,className:"animate-spin"})," Searching..."]}):l.length>0?l.map(Oe=>f.jsxs("button",{onMouseDown:xt=>xt.preventDefault(),onClick:()=>Pt(Oe,"start"),className:"w-full text-left px-3 py-2 hover:bg-gray-800 text-xs text-gray-300 font-mono border-b border-gray-800 last:border-0",children:[f.jsx("div",{className:"truncate",children:Oe.name.split(",")[0]}),f.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500",children:[f.jsx("span",{className:"truncate max-w-[70%]",children:Oe.name.split(",").slice(1,3).join(",")}),Oe.distance&&f.jsxs("span",{children:[Oe.distance.toFixed(1)," km"]})]})]},Oe.id)):t.length>=2?f.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No locations found"}):null})]}),T.length>0&&f.jsx("div",{className:"space-y-1 pl-3 border-l-2 border-cyan-800",children:T.map((Oe,xt)=>f.jsxs("div",{className:"flex items-center gap-2 text-xs bg-gray-800/50 rounded px-2 py-1",children:[f.jsx("span",{className:"text-cyan-400 text-[10px]",children:"Via:"}),f.jsx("span",{className:"text-white flex-1 truncate",children:Oe.displayName||Oe.name}),f.jsx("button",{onClick:()=>zt(xt),className:"text-red-400 hover:text-red-300",children:f.jsx(Ui,{size:12})})]},`via-${xt}`))}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 border border-dashed border-gray-600 rounded px-2 py-1",children:[f.jsx(eb,{size:14,className:"text-cyan-400"}),f.jsx("input",{type:"text",value:o,onChange:Oe=>{a(Oe.target.value),nt(Oe.target.value,"via")},onFocus:()=>p.length>0&&ee(!0),onBlur:()=>vt("via"),placeholder:"Add stop (via)",className:"flex-1 bg-transparent text-white text-xs font-mono outline-none"}),I&&f.jsx(xr,{size:12,className:"animate-spin text-cyan-400"})]}),G&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900 border border-gray-700 rounded max-h-40 overflow-y-auto z-50 shadow-lg",children:I?f.jsxs("div",{className:"px-3 py-2 text-xs text-gray-400 flex items-center gap-2",children:[f.jsx(xr,{size:12,className:"animate-spin"})," Searching..."]}):p.length>0?p.map(Oe=>f.jsxs("button",{onMouseDown:xt=>xt.preventDefault(),onClick:()=>Pt(Oe,"via"),className:"w-full text-left px-3 py-2 hover:bg-gray-800 text-xs text-gray-300 font-mono border-b border-gray-800 last:border-0",children:[f.jsx("div",{className:"truncate",children:Oe.name.split(",")[0]}),f.jsx("div",{className:"text-[10px] text-gray-500 truncate",children:Oe.name.split(",").slice(1,3).join(",")})]},Oe.id)):o.length>=2?f.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No locations found"}):null})]}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:`flex items-center gap-2 bg-gray-900 border rounded px-2 py-1.5 ${w?"border-red-600":"border-gray-700"}`,children:[f.jsx(Ba,{size:14,className:"text-red-400"}),f.jsx("input",{type:"text",value:r,onChange:Oe=>{s(Oe.target.value),v(null),nt(Oe.target.value,"end")},onFocus:()=>u.length>0&&J(!0),onBlur:()=>vt("end"),placeholder:"To...",className:"flex-1 bg-transparent text-white outline-none font-mono text-xs",onKeyDown:Oe=>Oe.key==="Enter"&&gt()}),B&&f.jsx(xr,{size:12,className:"animate-spin text-cyan-400"}),r&&f.jsx("button",{onClick:()=>{s(""),v(null)},children:f.jsx(Ui,{size:12,className:"text-gray-500 hover:text-white"})}),w&&f.jsx("span",{className:"text-red-400 text-[10px]",children:""})]}),q&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900 border border-gray-700 rounded max-h-40 overflow-y-auto z-50 shadow-lg",children:B?f.jsxs("div",{className:"px-3 py-2 text-xs text-gray-400 flex items-center gap-2",children:[f.jsx(xr,{size:12,className:"animate-spin"})," Searching..."]}):u.length>0?u.map(Oe=>f.jsxs("button",{onMouseDown:xt=>xt.preventDefault(),onClick:()=>Pt(Oe,"end"),className:"w-full text-left px-3 py-2 hover:bg-gray-800 text-xs text-gray-300 font-mono border-b border-gray-800 last:border-0",children:[f.jsx("div",{className:"truncate",children:Oe.name.split(",")[0]}),f.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500",children:[f.jsx("span",{className:"truncate max-w-[70%]",children:Oe.name.split(",").slice(1,3).join(",")}),Oe.distance&&f.jsxs("span",{children:[Oe.distance.toFixed(1)," km"]})]})]},Oe.id)):r.length>=2?f.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No locations found"}):null})]})]}),f.jsxs("button",{onClick:()=>Ae(!fe),className:"w-full flex items-center justify-between px-2 py-1 text-xs text-gray-400 hover:text-cyan-400 font-mono",children:[f.jsx("span",{children:"Route Options"}),fe?f.jsx(xK,{size:14}):f.jsx(Hm,{size:14})]}),fe&&f.jsxs("div",{className:"space-y-2 p-2 bg-gray-900/50 rounded border border-gray-700",children:[f.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.jsxs("label",{className:"flex items-center gap-1 text-[10px] text-gray-400",children:[f.jsx("input",{type:"checkbox",checked:Pe.avoidMotorways,onChange:Oe=>Ce(xt=>({...xt,avoidMotorways:Oe.target.checked})),className:"w-3 h-3"}),"Avoid motorways"]}),f.jsxs("label",{className:"flex items-center gap-1 text-[10px] text-gray-400",children:[f.jsx("input",{type:"checkbox",checked:Pe.avoidTolls,onChange:Oe=>Ce(xt=>({...xt,avoidTolls:Oe.target.checked})),className:"w-3 h-3"}),"Avoid tolls"]}),f.jsxs("label",{className:"flex items-center gap-1 text-[10px] text-gray-400",children:[f.jsx("input",{type:"checkbox",checked:Pe.avoidFerries,onChange:Oe=>Ce(xt=>({...xt,avoidFerries:Oe.target.checked})),className:"w-3 h-3"}),"Avoid ferries"]})]}),f.jsxs("div",{className:"flex items-center gap-2 text-[10px]",children:[f.jsx("span",{className:"text-gray-400",children:"Units:"}),["auto","km","miles"].map(Oe=>f.jsx("button",{onClick:()=>Ce(xt=>({...xt,distanceUnits:Oe})),className:`px-2 py-0.5 rounded ${Pe.distanceUnits===Oe?"bg-cyan-900 text-cyan-400":"bg-gray-800 text-gray-500"}`,children:Oe},Oe))]}),f.jsxs("div",{className:"flex items-center justify-center gap-1 text-[10px] font-mono",children:[f.jsx("span",{className:"text-cyan-400",children:""}),f.jsx("span",{className:"text-gray-500",children:"SEARCH_RADIUS"})]}),f.jsx("div",{className:"flex gap-1 justify-center",children:iCe.map(Oe=>f.jsx("button",{onClick:()=>ne(Oe),className:`px-1.5 py-0.5 rounded text-[10px] ${Q===Oe?"bg-cyan-900 text-cyan-400 border border-cyan-700":"bg-gray-800 text-gray-500 border border-gray-700"}`,children:Oe},Oe))})]}),f.jsxs("div",{className:"flex gap-1",children:[f.jsxs("button",{onClick:()=>P("car"),className:`flex-1 py-1.5 rounded font-mono text-xs flex items-center justify-center gap-1 ${M==="car"?"bg-cyan-900 text-cyan-400 border border-cyan-700":"bg-gray-800 text-gray-400 border border-gray-700"}`,children:[f.jsx(h_,{size:14})," CAR"]}),f.jsxs("button",{onClick:()=>P("bike"),className:`flex-1 py-1.5 rounded font-mono text-xs flex items-center justify-center gap-1 ${M==="bike"?"bg-cyan-900 text-cyan-400 border border-cyan-700":"bg-gray-800 text-gray-400 border border-gray-700"}`,children:[f.jsx(mK,{size:14})," BIKE"]}),f.jsxs("button",{onClick:()=>P("foot"),className:`flex-1 py-1.5 rounded font-mono text-xs flex items-center justify-center gap-1 ${M==="foot"?"bg-cyan-900 text-cyan-400 border border-cyan-700":"bg-gray-800 text-gray-400 border border-gray-700"}`,children:[f.jsx(d_,{size:14})," WALK"]})]}),f.jsx("button",{onClick:gt,disabled:!y||!w||j,className:"w-full py-2 bg-green-800 hover:bg-green-700 disabled:bg-gray-800 disabled:text-gray-500 text-white font-mono rounded flex items-center justify-center gap-2 text-xs",children:j?f.jsxs(f.Fragment,{children:[f.jsx(xr,{size:14,className:"animate-spin"})," CALCULATING..."]}):f.jsxs(f.Fragment,{children:[f.jsx(ja,{size:14})," CALCULATE_ROUTE"]})})]})},xV={tube:f.jsx(Ql,{size:16,className:"text-blue-400"}),bus:f.jsx(a7,{size:16,className:"text-red-400"}),"national-rail":f.jsx(Ql,{size:16,className:"text-indigo-400"}),train:f.jsx(Ql,{size:16,className:"text-indigo-400"}),tram:f.jsx(Ql,{size:16,className:"text-green-400"}),dlr:f.jsx(Ql,{size:16,className:"text-teal-400"}),overground:f.jsx(Ql,{size:16,className:"text-orange-400"}),"elizabeth-line":f.jsx(Ql,{size:16,className:"text-purple-400"}),walking:f.jsx(d_,{size:16,className:"text-gray-400"}),cycling:f.jsx(mK,{size:16,className:"text-green-400"}),driving:f.jsx(h_,{size:16,className:"text-yellow-400"})},sCe=({currentLocation:n,onJourneySelected:e})=>{const[t,i]=$.useState(""),[r,s]=$.useState(""),[o,a]=$.useState(null),[l,c]=$.useState(null),[u,h]=$.useState([]),[p,m]=$.useState([]),[y,b]=$.useState(!1),[w,v]=$.useState(!1),[T,S]=$.useState(!1),[M,P]=$.useState(!1),[R,O]=$.useState(["tube","bus","national-rail","walking"]),[B,N]=$.useState([]),[I,F]=$.useState([]),[j,W]=$.useState(!1),[U,H]=$.useState(null),[q,J]=$.useState(null),[G,ee]=$.useState(!1),[Q,ne]=$.useState(!1),[fe,Ae]=$.useState([]),[Pe,Ce]=$.useState(""),[de,Ne]=$.useState([]),[et,me]=$.useState(!1),[nt,Pt]=$.useState(!1);$.useState(null);const[zt,Dt]=$.useState({avoidMotorways:!1,avoidTolls:!1,avoidFerries:!1,distanceUnits:"auto"}),[gt,vt]=$.useState(""),[Oe,xt]=$.useState(!1),pe=$.useRef(null),qe=$.useRef(null),$e=$.useRef(null),Xe=$.useRef(!1);$.useEffect(()=>{const ge=new Date,Qe=ge.getHours().toString().padStart(2,"0"),ht=ge.getMinutes().toString().padStart(2,"0");vt(`${Qe}:${ht}`)},[]),$.useEffect(()=>()=>{pe.current&&clearTimeout(pe.current),qe.current&&clearTimeout(qe.current),$e.current&&clearTimeout($e.current)},[]),$.useEffect(()=>{Ct()},[]);const Ye=$.useCallback(async(ge,Qe)=>{const ht=Qe==="from"?pe:Qe==="to"?qe:$e,at=Qe==="from"?S:Qe==="to"?P:Pt,yt=Qe==="from"?h:Qe==="to"?m:Ne,Gt=Qe==="from"?b:Qe==="to"?v:me;if(ht.current&&clearTimeout(ht.current),!ge.trim()||ge.length<2){yt([]),Gt(!1);return}at(!0),Gt(!0),ht.current=setTimeout(async()=>{try{const on=await fetch(`/api/transit/search?query=${encodeURIComponent(ge)}&maxResults=8`);if(on.ok){const Cn=(await on.json()||[]).map(gi=>({id:gi.id||gi.naptanId||`stop_${Math.random().toString(36).slice(2)}`,name:gi.name||gi.commonName||"Unknown Stop",naptanId:gi.naptanId||gi.id,coordinate:gi.coordinate||(gi.lat&&gi.lon?[gi.lon,gi.lat]:void 0)}));yt(Cn),Gt(Cn.length>0)}else console.error("[TransitPlanner] Search failed:",on.status),yt([])}catch(on){console.error("[TransitPlanner] Stop search error:",on),yt([])}finally{at(!1)}},200)},[]),oe=ge=>{i(ge),a(null),Ye(ge,"from")},Z=ge=>{s(ge),c(null),Ye(ge,"to")},he=ge=>{Ce(ge),Ye(ge,"via")},Ge=ge=>{Xe.current=!0,console.log("[TransitPlanner] Selected FROM stop:",ge.id,ge.naptanId,ge.name),i(ge.name),a({id:ge.id,name:ge.name,naptanId:ge.naptanId,coordinate:ge.coordinate}),b(!1),h([]),setTimeout(()=>{Xe.current=!1},100)},ct=ge=>{Xe.current=!0,console.log("[TransitPlanner] Selected TO stop:",ge.id,ge.naptanId,ge.name),s(ge.name),c({id:ge.id,name:ge.name,naptanId:ge.naptanId,coordinate:ge.coordinate}),v(!1),m([]),setTimeout(()=>{Xe.current=!1},100)},tt=ge=>{Xe.current=!0,console.log("[TransitPlanner] Selected VIA stop:",ge.id,ge.naptanId,ge.name);const Qe={id:ge.id,name:ge.name,naptanId:ge.naptanId,coordinate:ge.coordinate};Ae(ht=>[...ht,Qe]),Ce(""),me(!1),Ne([]),setTimeout(()=>{Xe.current=!1},100)},Lt=ge=>{Ae(Qe=>Qe.filter((ht,at)=>at!==ge))},Ct=async()=>{try{const ge=await fetch("/api/transit/line-status");if(ge.ok){const Qe=await ge.json();F(Qe||[])}}catch(ge){console.error("Failed to fetch line status:",ge)}},Ot=$.useCallback(async()=>{if(!t.trim()||!r.trim()){H("Please enter both start and destination");return}W(!0),H(null),b(!1),v(!1),me(!1);try{const ge=o?.naptanId||o?.id||(o?.coordinate?`${o.coordinate[1]},${o.coordinate[0]}`:t),Qe=l?.naptanId||l?.id||(l?.coordinate?`${l.coordinate[1]},${l.coordinate[0]}`:r),ht=new URLSearchParams({from:ge,to:Qe,mode:R.join(",")});if(fe.length>0){const on=fe.map(mn=>mn.naptanId||mn.id||(mn.coordinate?`${mn.coordinate[1]},${mn.coordinate[0]}`:mn.name)).join("|");ht.append("via",on)}if(gt){const on=gt.replace(":","");ht.append("time",on),ht.append("timeIs",Oe?"Arriving":"Departing")}zt.avoidMotorways&&ht.append("avoidMotorways","true"),zt.avoidTolls&&ht.append("avoidTolls","true"),zt.avoidFerries&&ht.append("avoidFerries","true"),zt.distanceUnits!=="auto"&&ht.append("units",zt.distanceUnits);const at=await fetch(`/api/transit/journey?${ht}`);if(!at.ok){const on=await at.text();throw console.error("[TransitPlanner] Journey API error:",at.status,on),new Error("Failed to find journeys")}const Gt=((await at.json()).journeys||[]).map((on,mn)=>({id:`journey_${mn}`,startTime:on.startDateTime,arrivalTime:on.arrivalDateTime,duration:on.duration,legs:(on.legs||[]).map(Cn=>({mode:nn(Cn.mode?.id||"walking"),lineName:Cn.routeOptions?.[0]?.name||Cn.instruction?.summary,lineColor:Tt(Cn.mode?.id,Cn.routeOptions?.[0]?.name),departureTime:Cn.departureTime,arrivalTime:Cn.arrivalTime,duration:Cn.duration,departureStop:{name:Cn.departurePoint?.commonName||"Unknown",coordinate:[Cn.departurePoint?.lon||0,Cn.departurePoint?.lat||0]},arrivalStop:{name:Cn.arrivalPoint?.commonName||"Unknown",coordinate:[Cn.arrivalPoint?.lon||0,Cn.arrivalPoint?.lat||0]},instruction:Cn.instruction?.detailed||Cn.instruction?.summary||"Continue",realtime:{platform:Cn.departurePoint?.platformName,status:"on-time"}})),fare:on.fare?{total:on.fare.totalCost/100,currency:"GBP"}:void 0,disruptions:(on.disruptions||[]).map(Cn=>({severity:"moderate",description:Cn.description}))}));N(Gt),Gt.length===0&&H("No journeys found for this route")}catch(ge){console.error("[TransitPlanner] Search error:",ge),H(ge instanceof Error?ge.message:"Search failed")}finally{W(!1)}},[t,r,o,l,R,fe,gt,Oe,zt]),nn=ge=>({walking:"walking",cycle:"cycling",tube:"tube",bus:"bus",dlr:"dlr",overground:"overground",tram:"tram","elizabeth-line":"elizabeth-line","national-rail":"train",rail:"train"})[ge?.toLowerCase()]||"walking",Tt=(ge,Qe)=>{const ht={bakerloo:"#B36305",central:"#E32017",circle:"#FFD300",district:"#00782A",hammersmith:"#F3A9BB",jubilee:"#A0A5A9",metropolitan:"#9B0056",northern:"#000000",piccadilly:"#003688",victoria:"#0098D4",waterloo:"#95CDBA"};if(ge==="tube"&&Qe){const yt=Qe.toLowerCase().split(" ")[0];return ht[yt]||"#0019A8"}return{tube:"#0019A8",bus:"#DC241F",dlr:"#00AFAD",overground:"#EE7C0E",tram:"#84B817","elizabeth-line":"#6950A1",train:"#1C3F94",walking:"#666666"}[ge]||"#666666"},Ve=ge=>{try{return new Date(ge).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return ge}},ut=ge=>{O(Qe=>Qe.includes(ge)?Qe.filter(ht=>ht!==ge):[...Qe,ge])},ue=ge=>{J(ge),e?.(ge)},Ie=()=>{const ge=new Date,Qe=ge.getHours().toString().padStart(2,"0"),ht=ge.getMinutes().toString().padStart(2,"0");vt(`${Qe}:${ht}`),xt(!1)},ft=[{id:"tube",label:"Tube",icon:f.jsx(Ql,{size:14})},{id:"bus",label:"Bus",icon:f.jsx(a7,{size:14})},{id:"train",label:"Rail",icon:f.jsx(Ql,{size:14})},{id:"walking",label:"Walk",icon:f.jsx(d_,{size:14})}],xe=ge=>ge==="Good Service"?"text-green-400":ge.includes("Minor")?"text-yellow-400":ge.includes("Severe")||ge.includes("Suspended")?"text-red-400":"text-orange-400",pt=I.filter(ge=>ge.status!=="Good Service");return f.jsxs("div",{className:"space-y-3",children:[f.jsxs("h3",{className:"text-cyan-400 font-mono text-sm flex items-center gap-2",children:[f.jsx(Ql,{size:16})," PUBLIC TRANSPORT"]}),pt.length>0&&f.jsxs("button",{onClick:()=>ee(!G),className:"w-full flex items-center gap-2 p-2 bg-yellow-900/30 border border-yellow-700/50 rounded text-xs",children:[f.jsx(T0,{size:14,className:"text-yellow-400"}),f.jsxs("span",{className:"text-yellow-400",children:[pt.length," lines with issues"]}),f.jsx(wy,{size:14,className:`text-yellow-400 ml-auto transition-transform ${G?"rotate-90":""}`})]}),G&&f.jsx("div",{className:"max-h-32 overflow-y-auto space-y-1 bg-gray-900/50 rounded p-2",children:pt.map(ge=>f.jsxs("div",{className:"text-xs flex items-center gap-2",children:[f.jsxs("span",{className:"text-gray-400",children:[ge.lineName,":"]}),f.jsx("span",{className:xe(ge.status),children:ge.status})]},ge.lineId))}),f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:`flex items-center gap-2 bg-gray-900 border rounded px-2 py-1.5 ${o?"border-green-600":"border-gray-700"}`,children:[f.jsx(Ba,{size:14,className:"text-green-400"}),f.jsx("input",{type:"text",value:t,onChange:ge=>oe(ge.target.value),onFocus:()=>u.length>0&&b(!0),onBlur:()=>setTimeout(()=>{Xe.current||b(!1)},300),placeholder:"From (e.g., Camden Town)",className:"flex-1 bg-transparent text-white text-xs font-mono outline-none"}),T&&f.jsx(xr,{size:12,className:"animate-spin text-cyan-400"}),o&&f.jsx("span",{className:"text-green-400 text-[10px]",children:""})]}),y&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900 border border-gray-700 rounded max-h-40 overflow-y-auto z-50 shadow-lg",children:T?f.jsxs("div",{className:"px-3 py-2 text-xs text-gray-400 flex items-center gap-2",children:[f.jsx(xr,{size:12,className:"animate-spin"})," Searching..."]}):u.length>0?u.map(ge=>f.jsxs("button",{onMouseDown:Qe=>Qe.preventDefault(),onClick:()=>Ge(ge),className:"w-full text-left px-3 py-2 hover:bg-gray-800 text-xs text-gray-300 font-mono truncate border-b border-gray-800 last:border-0",children:[f.jsx(Ba,{size:10,className:"inline mr-2 text-green-400"}),ge.name]},ge.id)):t.length>=2?f.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No stops found"}):null})]}),fe.length>0&&f.jsx("div",{className:"space-y-1 pl-4 border-l-2 border-cyan-800",children:fe.map((ge,Qe)=>f.jsxs("div",{className:"flex items-center gap-2 text-xs bg-gray-800/50 rounded px-2 py-1",children:[f.jsx("span",{className:"text-cyan-400",children:"Via:"}),f.jsx("span",{className:"text-white flex-1 truncate",children:ge.name}),f.jsx("button",{onClick:()=>Lt(Qe),className:"text-red-400 hover:text-red-300",children:f.jsx(Ui,{size:12})})]},ge.id+Qe))}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:"flex items-center gap-2 bg-gray-800/50 border border-dashed border-gray-600 rounded px-2 py-1",children:[f.jsx(eb,{size:14,className:"text-cyan-400"}),f.jsx("input",{type:"text",value:Pe,onChange:ge=>he(ge.target.value),onFocus:()=>de.length>0&&me(!0),onBlur:()=>setTimeout(()=>{Xe.current||me(!1)},300),placeholder:"Add stop (via)",className:"flex-1 bg-transparent text-white text-xs font-mono outline-none"}),nt&&f.jsx(xr,{size:12,className:"animate-spin text-cyan-400"})]}),et&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900 border border-gray-700 rounded max-h-40 overflow-y-auto z-50 shadow-lg",children:nt?f.jsxs("div",{className:"px-3 py-2 text-xs text-gray-400 flex items-center gap-2",children:[f.jsx(xr,{size:12,className:"animate-spin"})," Searching..."]}):de.length>0?de.map(ge=>f.jsxs("button",{onMouseDown:Qe=>Qe.preventDefault(),onClick:()=>tt(ge),className:"w-full text-left px-3 py-2 hover:bg-gray-800 text-xs text-gray-300 font-mono truncate border-b border-gray-800 last:border-0",children:[f.jsx(Ba,{size:10,className:"inline mr-2 text-cyan-400"}),ge.name]},ge.id)):Pe.length>=2?f.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No stops found"}):null})]}),f.jsxs("div",{className:"relative",children:[f.jsxs("div",{className:`flex items-center gap-2 bg-gray-900 border rounded px-2 py-1.5 ${l?"border-red-600":"border-gray-700"}`,children:[f.jsx(Ba,{size:14,className:"text-red-400"}),f.jsx("input",{type:"text",value:r,onChange:ge=>Z(ge.target.value),onFocus:()=>p.length>0&&v(!0),onBlur:()=>setTimeout(()=>{Xe.current||v(!1)},300),placeholder:"To (e.g., Kings Cross)",className:"flex-1 bg-transparent text-white text-xs font-mono outline-none",onKeyDown:ge=>ge.key==="Enter"&&Ot()}),M&&f.jsx(xr,{size:12,className:"animate-spin text-cyan-400"}),l&&f.jsx("span",{className:"text-red-400 text-[10px]",children:""})]}),w&&f.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-900 border border-gray-700 rounded max-h-40 overflow-y-auto z-50 shadow-lg",children:M?f.jsxs("div",{className:"px-3 py-2 text-xs text-gray-400 flex items-center gap-2",children:[f.jsx(xr,{size:12,className:"animate-spin"})," Searching..."]}):p.length>0?p.map(ge=>f.jsxs("button",{onMouseDown:Qe=>Qe.preventDefault(),onClick:()=>ct(ge),className:"w-full text-left px-3 py-2 hover:bg-gray-800 text-xs text-gray-300 font-mono truncate border-b border-gray-800 last:border-0",children:[f.jsx(Ba,{size:10,className:"inline mr-2 text-red-400"}),ge.name]},ge.id)):r.length>=2?f.jsx("div",{className:"px-3 py-2 text-xs text-gray-500",children:"No stops found"}):null})]})]}),f.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[f.jsx("button",{onClick:()=>xt(!1),className:`px-2 py-1 rounded ${Oe?"bg-gray-800 text-gray-400":"bg-cyan-800 text-cyan-400"}`,children:"Depart at"}),f.jsx("input",{type:"time",value:gt,onChange:ge=>vt(ge.target.value),className:"bg-gray-900 border border-gray-700 rounded px-2 py-1 text-white font-mono"}),f.jsx("button",{onClick:()=>xt(!0),className:`px-2 py-1 rounded ${Oe?"bg-cyan-800 text-cyan-400":"bg-gray-800 text-gray-400"}`,children:"Arrive by"}),f.jsx("button",{onClick:Ie,className:"px-2 py-1 rounded bg-green-800 text-green-400 hover:bg-green-700",children:"Now"})]}),f.jsx("div",{className:"flex flex-wrap gap-1",children:ft.map(ge=>f.jsxs("button",{onClick:()=>ut(ge.id),className:`px-2 py-1 text-xs font-mono rounded flex items-center gap-1 ${R.includes(ge.id)?"bg-cyan-900 text-cyan-400 border border-cyan-700":"bg-gray-800 text-gray-500 border border-gray-700"}`,children:[ge.icon," ",ge.label]},ge.id))}),f.jsxs("button",{onClick:()=>ne(!Q),className:"w-full flex items-center gap-2 text-xs text-gray-400 hover:text-cyan-400 py-1",children:[f.jsx(c7,{size:12}),f.jsx("span",{children:"Route options"}),f.jsx(wy,{size:12,className:`ml-auto transition-transform ${Q?"rotate-90":""}`})]}),Q&&f.jsxs("div",{className:"space-y-2 p-2 bg-gray-900/50 rounded border border-gray-700",children:[f.jsx("div",{className:"text-xs text-gray-400 mb-2",children:"Avoid"}),f.jsxs("div",{className:"flex flex-wrap gap-2",children:[f.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-300",children:[f.jsx("input",{type:"checkbox",checked:zt.avoidMotorways,onChange:ge=>Dt(Qe=>({...Qe,avoidMotorways:ge.target.checked})),className:"rounded bg-gray-800 border-gray-600"}),"Motorways"]}),f.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-300",children:[f.jsx("input",{type:"checkbox",checked:zt.avoidTolls,onChange:ge=>Dt(Qe=>({...Qe,avoidTolls:ge.target.checked})),className:"rounded bg-gray-800 border-gray-600"}),"Tolls"]}),f.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-300",children:[f.jsx("input",{type:"checkbox",checked:zt.avoidFerries,onChange:ge=>Dt(Qe=>({...Qe,avoidFerries:ge.target.checked})),className:"rounded bg-gray-800 border-gray-600"}),"Ferries"]})]}),f.jsx("div",{className:"text-xs text-gray-400 mt-2 mb-1",children:"Distance units"}),f.jsx("div",{className:"flex gap-2",children:["auto","miles","km"].map(ge=>f.jsx("button",{onClick:()=>Dt(Qe=>({...Qe,distanceUnits:ge})),className:`px-2 py-1 text-xs rounded ${zt.distanceUnits===ge?"bg-cyan-800 text-cyan-400":"bg-gray-800 text-gray-400"}`,children:ge==="auto"?"Automatic":ge},ge))})]}),f.jsxs("button",{onClick:Ot,disabled:j,className:"w-full py-2 bg-cyan-800 hover:bg-cyan-700 text-white font-mono text-xs rounded flex items-center justify-center gap-2 disabled:opacity-50",children:[j?f.jsx(xr,{size:14,className:"animate-spin"}):f.jsx(ja,{size:14}),j?"SEARCHING...":"FIND JOURNEYS"]}),U&&f.jsx("div",{className:"text-red-400 text-xs font-mono p-2 bg-red-900/20 rounded",children:U}),B.length>0&&f.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:B.map(ge=>f.jsxs("button",{onClick:()=>ue(ge),className:`w-full text-left p-2 rounded border transition-all ${q?.id===ge.id?"bg-cyan-900/50 border-cyan-600":"bg-gray-900/50 border-gray-700 hover:border-cyan-700"}`,children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsxs("div",{className:"flex items-center gap-1 text-xs font-mono",children:[f.jsx(z0,{size:12,className:"text-gray-400"}),f.jsx("span",{className:"text-white",children:Ve(ge.startTime)}),f.jsx(YP,{size:12,className:"text-gray-500"}),f.jsx("span",{className:"text-white",children:Ve(ge.arrivalTime)})]}),f.jsxs("span",{className:"text-cyan-400 text-xs font-mono",children:[ge.duration," min"]})]}),f.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:ge.legs.map((Qe,ht)=>f.jsxs(Fa.Fragment,{children:[ht>0&&f.jsx(wy,{size:10,className:"text-gray-600"}),f.jsxs("div",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded text-xs",style:{backgroundColor:`${Qe.lineColor}20`,borderColor:Qe.lineColor,borderWidth:1},children:[xV[Qe.mode],Qe.lineName&&f.jsx("span",{className:"text-white text-[10px]",children:Qe.lineName.split(" ")[0]})]})]},ht))}),ge.disruptions&&ge.disruptions.length>0&&f.jsxs("div",{className:"mt-1 flex items-center gap-1 text-yellow-400 text-[10px]",children:[f.jsx(T0,{size:10}),f.jsx("span",{children:"Disruptions on route"})]})]},ge.id))}),q&&f.jsxs("div",{className:"space-y-2 p-2 bg-gray-900/70 rounded border border-cyan-800/50",children:[f.jsx("div",{className:"text-xs font-mono text-cyan-400 mb-2",children:"JOURNEY DETAILS"}),q.legs.map((ge,Qe)=>f.jsxs("div",{className:"flex gap-2 text-xs",children:[f.jsxs("div",{className:"flex flex-col items-center",children:[f.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:ge.lineColor},children:xV[ge.mode]}),Qe<q.legs.length-1&&f.jsx("div",{className:"w-0.5 flex-1 my-1",style:{backgroundColor:ge.lineColor}})]}),f.jsxs("div",{className:"flex-1 pb-3",children:[f.jsx("div",{className:"text-white font-mono",children:ge.departureStop.name}),f.jsxs("div",{className:"text-gray-400",children:[Ve(ge.departureTime)," - ",ge.instruction]}),ge.lineName&&f.jsx("div",{className:"text-cyan-400 text-[10px]",children:ge.lineName}),ge.realtime?.platform&&f.jsxs("div",{className:"text-green-400 text-[10px]",children:["Platform ",ge.realtime.platform]})]})]},Qe)),q.fare&&f.jsxs("div",{className:"text-xs font-mono flex justify-between pt-2 border-t border-gray-700",children:[f.jsx("span",{className:"text-gray-400",children:"Estimated fare:"}),f.jsxs("span",{className:"text-green-400",children:["",q.fare.total.toFixed(2)]})]})]}),f.jsxs("button",{onClick:Ct,className:"w-full py-1.5 text-xs font-mono text-gray-400 hover:text-cyan-400 flex items-center justify-center gap-1",children:[f.jsx(RK,{size:12})," Refresh line status"]})]})},vV=n=>n<1024?`${n} B`:n<1024*1024?`${(n/1024).toFixed(1)} KB`:`${(n/(1024*1024)).toFixed(1)} MB`,oCe=({className:n=""})=>{const[e,t]=$.useState([]),[i,r]=$.useState(!0),[s,o]=$.useState(null),[a,l]=$.useState(!1),[c,u]=$.useState(""),[h,p]=$.useState(null),m=$.useCallback(async()=>{r(!0);try{const v=await rc.getOfflineRegions();t(v)}finally{r(!1)}},[]);$.useEffect(()=>{m()},[m]);const y=$.useCallback(async()=>{if(!c.trim()){p("Please enter a region name");return}o("new"),p(null);try{const v=await rc.getCurrentPosition(),T=[v[0]-.1,v[1]-.1,v[0]+.1,v[1]+.1],S=await rc.downloadRegion(T,c),M={id:S.jobId,name:c,bbox:T,zoomRange:[0,14],size:S.estimatedSize,downloaded:Date.now(),status:"queued",progress:0};t(R=>[...R,M]),localStorage.setItem("g3zkp_offline_regions",JSON.stringify([...e,M]));const P=async()=>{try{const R=await rc.getDownloadStatus(S.jobId);if(t(O=>O.map(B=>B.id===S.jobId?{...B,status:R.status,progress:R.progress}:B)),R.status==="downloading"||R.status==="queued")setTimeout(P,1e3);else{const O=e.map(B=>B.id===S.jobId?{...B,status:R.status,progress:R.progress}:B);localStorage.setItem("g3zkp_offline_regions",JSON.stringify(O))}}catch(R){console.error("Failed to poll download status:",R)}};P(),u(""),l(!1)}catch(v){console.error("Failed to initiate download:",v),p("Failed to start download. Check location permissions.")}finally{o(null)}},[c,e]),b=$.useCallback(async v=>{await rc.deleteOfflineRegion(v),t(T=>{const S=T.filter(M=>M.id!==v);return localStorage.setItem("g3zkp_offline_regions",JSON.stringify(S)),S})},[]),w=e.reduce((v,T)=>v+T.size,0);return f.jsxs("div",{className:`space-y-4 ${n}`,children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("h3",{className:"text-cyan-400 font-mono flex items-center gap-2",children:[f.jsx(Aae,{size:18}),"OFFLINE_MAPS"]}),f.jsx("button",{onClick:()=>l(!a),className:"text-sm text-cyan-400 hover:text-cyan-300 font-mono",children:"+ ADD_REGION"})]}),f.jsx("div",{className:"bg-yellow-900/20 border border-yellow-800/50 rounded p-3",children:f.jsxs("div",{className:"flex items-start gap-2",children:[f.jsx(T0,{size:14,className:"text-yellow-500 mt-0.5 flex-shrink-0"}),f.jsxs("div",{className:"text-xs text-yellow-500/80 font-mono",children:[f.jsx("p",{className:"font-bold mb-1",children:"Note: Tile Caching"}),f.jsx("p",{children:"This manager tracks download jobs. Actual tile data requires a tile cache server. Currently, regions are marked for download but tiles load on-demand from OSM CDN."})]})]})}),a&&f.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded p-3 space-y-3",children:[f.jsx("input",{type:"text",value:c,onChange:v=>u(v.target.value),placeholder:"Region name...",className:"w-full bg-black border border-gray-700 rounded px-3 py-2 text-white font-mono text-sm"}),h&&f.jsx("div",{className:"text-red-400 text-xs font-mono",children:h}),f.jsx("button",{onClick:y,disabled:!c.trim()||s==="new",className:"w-full py-2 bg-green-800 hover:bg-green-700 disabled:bg-gray-800 text-white font-mono text-sm rounded flex items-center justify-center gap-2",children:s==="new"?f.jsxs(f.Fragment,{children:[f.jsx(xr,{size:14,className:"animate-spin"})," INITIALIZING..."]}):f.jsxs(f.Fragment,{children:[f.jsx(Zf,{size:14})," MARK_REGION_FOR_CACHE"]})})]}),i?f.jsx("div",{className:"flex items-center justify-center py-8",children:f.jsx(xr,{size:24,className:"animate-spin text-cyan-400"})}):e.length===0?f.jsxs("div",{className:"text-center py-8 text-gray-500 font-mono text-sm",children:[f.jsx(y6,{size:48,className:"mx-auto mb-4 opacity-50"}),"No offline regions saved"]}):f.jsx("div",{className:"space-y-2",children:e.map(v=>f.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded p-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[v.status==="complete"?f.jsx(us,{size:16,className:"text-green-400"}):v.status==="failed"?f.jsx(Kae,{size:16,className:"text-red-400"}):v.status==="downloading"?f.jsx(xr,{size:16,className:"text-cyan-400 animate-spin"}):f.jsx(y6,{size:16,className:"text-gray-500"}),f.jsx("span",{className:"text-white font-mono text-sm",children:v.name})]}),f.jsx("button",{onClick:()=>b(v.id),className:"text-gray-500 hover:text-red-400 p-1","aria-label":"Delete region",children:f.jsx(p_,{size:14})})]}),(v.status==="downloading"||v.status==="queued")&&f.jsxs("div",{className:"mb-2",children:[f.jsx("div",{className:"h-1 bg-gray-800 rounded overflow-hidden",children:f.jsx("div",{className:"h-full bg-cyan-400 transition-all duration-300",style:{width:`${v.progress}%`}})}),f.jsx("div",{className:"text-xs text-gray-500 mt-1 font-mono",children:v.status==="queued"?"Queued...":`${v.progress}% complete`})]}),f.jsxs("div",{className:"flex justify-between text-xs text-gray-500 font-mono",children:[f.jsxs("span",{children:["Est. ",vV(v.size)]}),f.jsx("span",{children:new Date(v.downloaded).toLocaleDateString()})]})]},v.id))}),f.jsx("div",{className:"border-t border-gray-800 pt-3",children:f.jsxs("div",{className:"flex justify-between text-sm font-mono",children:[f.jsx("span",{className:"text-gray-400",children:"Tracked Regions"}),f.jsxs("span",{className:"text-cyan-400",children:[e.length," (",vV(w),")"]})]})})]})},bV=(n,e)=>{const t="text-white";return n==="arrive"?f.jsx(wae,{size:64,className:"text-green-400"}):n==="depart"?f.jsx(vU,{size:64,className:t}):e?.includes("right")?e.includes("slight")?f.jsx(uae,{size:64,className:t}):f.jsx(YP,{size:64,className:t}):e?.includes("left")?e.includes("slight")?f.jsx(cae,{size:64,className:t}):f.jsx(lae,{size:64,className:t}):f.jsx(vU,{size:64,className:t})},bC=n=>n<100?`${Math.round(n)} m`:n<1e3?`${Math.round(n/10)*10} m`:`${(n/1e3).toFixed(1)} km`,aCe=n=>{const e=Math.floor(n/3600),t=Math.floor(n%3600/60);return e>0?`${e}h ${t}m`:`${t} min`},_V=(n,e)=>{const i=(e[1]-n[1])*Math.PI/180,r=(e[0]-n[0])*Math.PI/180,s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n[1]*Math.PI/180)*Math.cos(e[1]*Math.PI/180)*Math.sin(r/2)*Math.sin(r/2);return 6371e3*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},lCe=({route:n,onReroute:e,onEndNavigation:t,onReportHazard:i})=>{const[r,s]=$.useState({currentLocation:null,currentStepIndex:0,distanceToNextManeuver:0,remainingDistance:n.distance,remainingTime:n.duration,eta:new Date(Date.now()+n.duration*1e3),speed:0,heading:0,accuracy:0,gpsStatus:"acquiring"}),[o,a]=$.useState(!0),[l,c]=$.useState(!1),[u,h]=$.useState(!0),p=$.useRef(null),m=$.useRef(-1),y=n.legs[0]?.steps||[],b=y[r.currentStepIndex],w=y[r.currentStepIndex+1],v=$.useCallback(M=>{if(o&&"speechSynthesis"in window){speechSynthesis.cancel();const P=new SpeechSynthesisUtterance(M);P.rate=.9,P.pitch=1,speechSynthesis.speak(P)}},[o]);$.useEffect(()=>{if(!navigator.geolocation){s(R=>({...R,gpsStatus:"lost"}));return}v("Navigation started. "+(b?.instruction||"Proceed to route"));const M=R=>{const O=[R.coords.longitude,R.coords.latitude],B=R.coords.speed!==null?R.coords.speed*3.6:0,N=R.coords.heading||0,I=R.coords.accuracy;s(F=>{let j=F.currentStepIndex,W=F.distanceToNextManeuver;if(b){const G=b.maneuver.location;if(W=_V(O,G),W<30&&j<y.length-1){j=F.currentStepIndex+1;const ee=y[j]?.instruction;ee&&m.current!==j&&(v(ee),m.current=j)}else W<100&&W>30&&m.current!==F.currentStepIndex&&(v(`In ${bC(W)}, ${b.instruction}`),m.current=F.currentStepIndex)}const U=n.geometry.coordinates[n.geometry.coordinates.length-1],H=_V(O,U),q=B>0?B:50,J=H/1e3/(q/3.6)*3600;return H<50&&(v("You have arrived at your destination"),t()),{...F,currentLocation:O,currentStepIndex:j,distanceToNextManeuver:W,remainingDistance:H,remainingTime:J,eta:new Date(Date.now()+J*1e3),speed:B,heading:N,accuracy:I,gpsStatus:I<20?"active":I<50?"weak":"acquiring"}})},P=R=>{console.error("GPS error:",R),s(O=>({...O,gpsStatus:"lost"}))};return p.current=navigator.geolocation.watchPosition(M,P,{enableHighAccuracy:!0,timeout:1e4,maximumAge:1e3}),()=>{p.current!==null&&navigator.geolocation.clearWatch(p.current),speechSynthesis.cancel()}},[n,v,b,y,t]);const T=[{id:"police",icon:ao,label:"Police",color:"bg-blue-600"},{id:"accident",icon:T0,label:"Accident",color:"bg-red-600"},{id:"hazard",icon:mae,label:"Road Hazard",color:"bg-orange-600"},{id:"camera",icon:yK,label:"Speed Camera",color:"bg-purple-600"}],S=M=>{r.currentLocation&&(i(M,r.currentLocation),v(`${M} reported`)),c(!1)};return f.jsxs("div",{className:"fixed inset-0 z-[9999] pointer-events-none",children:[f.jsx("div",{className:"absolute top-0 left-0 right-0 pointer-events-auto",children:f.jsxs("div",{className:"bg-gradient-to-b from-black via-black/95 to-transparent",children:[f.jsx("div",{className:"bg-cyan-900 p-4",children:f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx("div",{className:"flex-shrink-0",children:b&&bV(b.maneuver.type,b.maneuver.modifier)}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("div",{className:"text-4xl font-bold text-white font-mono",children:bC(r.distanceToNextManeuver)}),f.jsx("div",{className:"text-lg text-cyan-200 font-mono truncate",children:b?.instruction||"Calculating..."})]}),f.jsx("button",{onClick:()=>a(!o),className:"p-3 rounded-full bg-black/30 hover:bg-black/50",children:o?f.jsx(m_,{size:24,className:"text-white"}):f.jsx(PK,{size:24,className:"text-gray-400"})})]})}),w&&f.jsxs("div",{className:"bg-gray-900/90 px-4 py-2 flex items-center gap-3 border-b border-cyan-800/30",children:[f.jsx("span",{className:"text-gray-400 text-sm font-mono",children:"THEN"}),f.jsx("div",{className:"flex-shrink-0 scale-50 origin-left",children:bV(w.maneuver.type,w.maneuver.modifier)}),f.jsx("span",{className:"text-gray-300 text-sm font-mono truncate",children:w.instruction})]})]})}),f.jsx("div",{className:"absolute bottom-0 left-0 right-0 pointer-events-auto",children:f.jsx("div",{className:"bg-gradient-to-t from-black via-black/95 to-transparent pt-8",children:f.jsxs("div",{className:"bg-black/95 border-t border-cyan-800 cursor-pointer",onClick:()=>h(!u),children:[f.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[f.jsxs("div",{className:"flex items-center gap-6",children:[f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-green-400 font-mono",children:bC(r.remainingDistance)}),f.jsx("div",{className:"text-xs text-gray-400 font-mono",children:"REMAINING"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-cyan-400 font-mono",children:aCe(r.remainingTime)}),f.jsx("div",{className:"text-xs text-gray-400 font-mono",children:"TIME"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:r.eta.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),f.jsx("div",{className:"text-xs text-gray-400 font-mono",children:"ETA"})]})]}),u?f.jsx(Hm,{size:24,className:"text-gray-400"}):f.jsx(xK,{size:24,className:"text-gray-400"})]}),u&&f.jsxs("div",{className:"px-4 pb-4 space-y-3",children:[f.jsxs("div",{className:"flex items-center justify-between text-sm font-mono",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Eae,{size:16,className:"text-cyan-400"}),f.jsx("span",{className:"text-gray-400",children:"Speed:"}),f.jsxs("span",{className:"text-white",children:[Math.round(r.speed)," km/h"]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(m2,{size:16,className:"text-cyan-400"}),f.jsx("span",{className:"text-gray-400",children:"Heading:"}),f.jsxs("span",{className:"text-white",children:[Math.round(r.heading),""]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(Nae,{size:16,className:"text-cyan-400"}),f.jsx("span",{className:"text-gray-400",children:"Step:"}),f.jsxs("span",{className:"text-white",children:[r.currentStepIndex+1,"/",y.length]})]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:`w-2 h-2 rounded-full ${r.gpsStatus==="active"?"bg-green-500 animate-pulse":r.gpsStatus==="weak"?"bg-yellow-500":r.gpsStatus==="acquiring"?"bg-blue-500 animate-pulse":"bg-red-500"}`}),f.jsxs("span",{className:"text-xs text-gray-400 font-mono",children:["GPS: ",r.gpsStatus.toUpperCase(),r.accuracy>0&&` (${Math.round(r.accuracy)}m)`]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:M=>{M.stopPropagation(),e()},className:"flex-1 py-2 bg-cyan-900 hover:bg-cyan-800 text-cyan-400 font-mono text-sm rounded flex items-center justify-center gap-2",children:[f.jsx(l7,{size:16})," REROUTE"]}),f.jsxs("button",{onClick:M=>{M.stopPropagation(),t()},className:"flex-1 py-2 bg-red-900 hover:bg-red-800 text-red-400 font-mono text-sm rounded flex items-center justify-center gap-2",children:[f.jsx(Ui,{size:16})," END"]})]})]})]})})}),f.jsx("div",{className:"absolute right-4 top-1/2 -translate-y-1/2 pointer-events-auto",children:f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx("button",{onClick:()=>c(!l),className:`w-14 h-14 rounded-full flex items-center justify-center shadow-lg ${l?"bg-orange-600":"bg-gray-800 hover:bg-gray-700"}`,children:f.jsx(T0,{size:24,className:"text-white"})}),l&&f.jsx("div",{className:"flex flex-col gap-2 animate-in slide-in-from-right",children:T.map(M=>f.jsx("button",{onClick:()=>S(M.id),className:`w-14 h-14 rounded-full ${M.color} flex items-center justify-center shadow-lg hover:opacity-80`,title:M.label,children:f.jsx(M.icon,{size:24,className:"text-white"})},M.id))})]})}),f.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 pointer-events-auto",children:f.jsx("div",{className:"bg-black/80 rounded-lg p-3 border border-cyan-800/50",children:f.jsxs("div",{className:"text-center",children:[f.jsx(h_,{size:32,className:"text-cyan-400 mx-auto mb-1"}),f.jsx("div",{className:"text-2xl font-bold text-white font-mono",children:Math.round(r.speed)}),f.jsx("div",{className:"text-xs text-gray-400 font-mono",children:"km/h"})]})})})]})},wV={currentLocation:null,destination:null,destinationName:null,waypoints:[],currentRoute:null,alternativeRoutes:[],isNavigating:!1,transportMode:"car",searchActive:!1,menuOpen:!1,currentStepIndex:0,distanceToNextStep:0,timeToDestination:0,heading:0,speed:0,offlineRegions:[],trafficSegments:[],audioGuidance:!0,nightMode:!1,avoidTolls:!1,avoidHighways:!1,autoReroute:!0,hazardAlerts:!0,privacyLevel:"medium",viewMode:"2d",speedLimit:null,arrivalTime:null},cCe=z_()(dD((n,e)=>({...wV,setCurrentLocation:t=>n({currentLocation:t}),setDestination:(t,i)=>n({destination:t,destinationName:i||null}),setTransportMode:t=>n({transportMode:t}),setSearchActive:t=>n({searchActive:t}),setMenuOpen:t=>n({menuOpen:t}),addWaypoint:t=>n(i=>({waypoints:[...i.waypoints,t]})),removeWaypoint:t=>n(i=>({waypoints:i.waypoints.filter((r,s)=>s!==t)})),clearWaypoints:()=>n({waypoints:[]}),setCurrentRoute:t=>n({currentRoute:t}),setAlternativeRoutes:t=>n({alternativeRoutes:t}),startNavigation:()=>n({isNavigating:!0,currentStepIndex:0}),stopNavigation:()=>n({isNavigating:!1,currentStepIndex:0,distanceToNextStep:0,timeToDestination:0,currentRoute:null,destination:null,waypoints:[],arrivalTime:null}),setCurrentStepIndex:t=>n({currentStepIndex:t}),setDistanceToNextStep:t=>n({distanceToNextStep:t}),setTimeToDestination:t=>n({timeToDestination:t}),setHeading:t=>n({heading:t}),setSpeed:t=>n({speed:t}),setSpeedLimit:t=>n({speedLimit:t}),setArrivalTime:t=>n({arrivalTime:t}),addOfflineRegion:t=>n(i=>({offlineRegions:[...i.offlineRegions,t]})),removeOfflineRegion:t=>n(i=>({offlineRegions:i.offlineRegions.filter(r=>r.id!==t)})),updateOfflineRegion:(t,i)=>n(r=>({offlineRegions:r.offlineRegions.map(s=>s.id===t?{...s,...i}:s)})),setTrafficSegments:t=>n({trafficSegments:t}),toggleAudioGuidance:()=>n(t=>({audioGuidance:!t.audioGuidance})),toggleNightMode:()=>n(t=>({nightMode:!t.nightMode})),toggleAvoidTolls:()=>n(t=>({avoidTolls:!t.avoidTolls})),toggleAvoidHighways:()=>n(t=>({avoidHighways:!t.avoidHighways})),toggleAutoReroute:()=>n(t=>({autoReroute:!t.autoReroute})),toggleHazardAlerts:()=>n(t=>({hazardAlerts:!t.hazardAlerts})),setPrivacyLevel:t=>n({privacyLevel:t}),setViewMode:t=>n({viewMode:t}),reset:()=>n(wV)}),{name:"g3zkp-navigation-store",partialize:n=>({audioGuidance:n.audioGuidance,nightMode:n.nightMode,avoidTolls:n.avoidTolls,avoidHighways:n.avoidHighways,autoReroute:n.autoReroute,hazardAlerts:n.hazardAlerts,privacyLevel:n.privacyLevel,viewMode:n.viewMode,offlineRegions:n.offlineRegions})})),SV={level:"medium",locationObfuscation:!0,routeTracking:!1,dataPersistence:"ephemeral",p2pUpdates:!1,shareWithMesh:!1},_C={low:1e-4,medium:5e-4,high:.001,maximum:.005};class Py{static obfuscateCoordinate(e,t){const i=t||this.config.level;if(!this.config.locationObfuscation&&!t)return e;const r=`${e[0].toFixed(4)},${e[1].toFixed(4)},${i}`,s=this.obfuscationCache.get(r);if(s)return s;const o=_C[i],a=this.deterministicRandom(e[0],this.sessionSalt),l=this.deterministicRandom(e[1],this.sessionSalt),c=[e[0]+(a-.5)*o*2,e[1]+(l-.5)*o*2];return this.obfuscationCache.set(r,c),this.obfuscationCache.size>1e3&&Array.from(this.obfuscationCache.keys()).slice(0,500).forEach(h=>this.obfuscationCache.delete(h)),c}static obfuscateRoute(e,t){const i=t||this.config.level,r=_C[i],s=(this.deterministicRandom(e[0]?.[0]||0,this.sessionSalt)-.5)*r,o=(this.deterministicRandom(e[0]?.[1]||0,this.sessionSalt)-.5)*r;return e.map(a=>[a[0]+s+(Math.random()-.5)*r*.1,a[1]+o+(Math.random()-.5)*r*.1])}static getConfig(){return{...this.config}}static setConfig(e){this.config={...this.config,...e},this.obfuscationCache.clear(),this.persistConfig()}static setLevel(e){this.config.level=e,this.obfuscationCache.clear(),this.persistConfig()}static getLevel(){return this.config.level}static getOffset(e){return _C[e||this.config.level]}static generateAnonymousId(){const e=Date.now().toString(36),t=Math.random().toString(36).substr(2,9);return`anon_${e}_${t}`}static hashLocation(e){const i=`${e[0].toFixed(3)},${e[1].toFixed(3)}`;let r=0;for(let s=0;s<i.length;s++){const o=i.charCodeAt(s);r=(r<<5)-r+o,r=r&r}return Math.abs(r).toString(36)}static isDataExpired(e){const t={ephemeral:3e5,session:864e5,permanent:1/0};return Date.now()-e>t[this.config.dataPersistence]}static clearSession(){this.sessionSalt=Math.random().toString(36).substr(2,16),this.obfuscationCache.clear()}static deterministicRandom(e,t){const i=e.toString()+t;let r=0;for(let s=0;s<i.length;s++){const o=i.charCodeAt(s);r=(r<<5)-r+o,r=r&r}return Math.abs(r)%1e4/1e4}static persistConfig(){try{localStorage.setItem("g3zkp_privacy_config",JSON.stringify(this.config))}catch(e){console.error("Failed to persist privacy config:",e)}}static loadConfig(){try{const e=localStorage.getItem("g3zkp_privacy_config");e&&(this.config={...SV,...JSON.parse(e)})}catch(e){console.error("Failed to load privacy config:",e)}}}E(Py,"config",{...SV}),E(Py,"obfuscationCache",new Map),E(Py,"sessionSalt",Math.random().toString(36).substr(2,16));Py.loadConfig();const uCe=()=>{if(typeof window<"u"){const n=window.location.hostname,e=window.location.protocol==="https:";if(n==="localhost"||n==="127.0.0.1")return`http://${n}:${{}.VITE_MESSAGING_PORT||3001}`;const t=window.location.port||(e?"443":"80");return e?`https://${n}${t!=="443"?":"+t:""}`:`http://${n}${t!=="80"?":"+t:""}`}return`http://localhost:${{}.VITE_MESSAGING_PORT||3001}`},hCe=uCe();class dCe{constructor(){E(this,"socket",null);E(this,"connected",!1);E(this,"trafficCache",new Map);E(this,"hazardsCache",new Map);E(this,"listeners",new Map);E(this,"pendingHazardRequests",new Map);E(this,"p2pKeyPair",null);this.loadFromStorage(),this.connect(),this.initializeP2PKeys()}initializeP2PKeys(){try{const e=localStorage.getItem("g3zkp_traffic_keys");if(e){const t=JSON.parse(e);this.p2pKeyPair={publicKey:new Uint8Array(Object.values(t.publicKey)),secretKey:new Uint8Array(Object.values(t.secretKey))}}else this.p2pKeyPair=Vn.sign.keyPair(),localStorage.setItem("g3zkp_traffic_keys",JSON.stringify({publicKey:Array.from(this.p2pKeyPair.publicKey),secretKey:Array.from(this.p2pKeyPair.secretKey)}));console.log("[TrafficService] P2P keys initialized")}catch(e){console.error("[TrafficService] Failed to initialize P2P keys:",e),this.p2pKeyPair=Vn.sign.keyPair()}}connect(){this.socket?.connected||(this.socket=Ey(hCe,{transports:["websocket","polling"],reconnection:!0,reconnectionDelay:1e3,reconnectionAttempts:10}),this.socket.on("connect",()=>{this.connected=!0,console.log("[TrafficService] Connected to traffic network")}),this.socket.on("disconnect",()=>{this.connected=!1,console.log("[TrafficService] Disconnected from traffic network")}),this.socket.on("hazard_broadcast",e=>{this.cacheHazardReport(e),this.persistToStorage(),this.broadcast("hazard_received",e)}),this.socket.on("hazard_verified",e=>{for(const t of this.hazardsCache.values()){const i=t.find(r=>r.id===e.id);i&&(i.verificationCount=e.count,i.expiresAt+=10*60*1e3)}this.persistToStorage(),this.broadcast("hazard_verified",e)}),this.socket.on("traffic_update",e=>{this.cacheTrafficReport(e),this.broadcast("traffic_update",e)}),this.socket.on("nearby_hazards",e=>{for(const t of e)this.cacheHazardReport(t);this.persistToStorage()}))}async reportTraffic(e){const t={...e,id:`traffic_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,sessionId:this.getSessionId(),encrypted:!0,location:Py.obfuscateCoordinate(e.location,"medium")};this.cacheTrafficReport(t),this.socket?.connected&&this.socket.emit("traffic_report",t),this.broadcast("traffic_report",t)}async reportHazard(e){const t=`hazard_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i=Date.now()+(e.type==="police"?30:60)*60*1e3,r={...e,id:t,location:Py.obfuscateCoordinate(e.location,"high"),expiresAt:i,verificationCount:1};return this.cacheHazardReport(r),this.persistToStorage(),this.socket?.connected&&this.socket.emit("hazard_report",r),this.broadcast("hazard_report",r),await this.broadcastHazardViaP2P(e),t}async broadcastHazardViaP2P(e){if(!this.p2pKeyPair||!Xl.isInitialized()){console.log("[TrafficService] P2P not available, skipping P2P broadcast");return}try{const t={latitude:e.location[1],longitude:e.location[0],timestamp:e.timestamp,heading:e.direction,accuracy:10},r={hazardType:{police:"police",accident:"accident",hazard:"other",speed_camera:"speed_camera"}[e.type]||"other",severity:e.confidence>.7?"high":e.confidence>.4?"medium":"low",description:e.additionalInfo,direction:this.getDirectionFromHeading(e.direction)},s=await Ote("HAZARD",t,r,this.p2pKeyPair.secretKey,this.p2pKeyPair.publicKey);await Xl.broadcastGeoReport(s,"HAZARD")&&console.log("[TrafficService] Hazard broadcast via P2P:",s.id)}catch(t){console.error("[TrafficService] Failed to broadcast hazard via P2P:",t)}}getDirectionFromHeading(e){return e>=315||e<45?"northbound":e>=45&&e<135?"eastbound":e>=135&&e<225?"southbound":"westbound"}async getNearbyIncidents(e,t){return this.socket?.connected&&this.socket.emit("get_nearby_hazards",{location:e,radius:t}),this.cleanupExpiredData(),this.getCachedIncidents(e,t)}async getRoadConditions(e,t){return[]}async verifyIncident(e){for(const t of this.hazardsCache.values()){const i=t.find(r=>r.id===e);if(i){i.verificationCount++,i.expiresAt+=10*60*1e3,this.persistToStorage(),this.socket?.connected&&this.socket.emit("hazard_verify",{hazardId:e}),this.broadcast("hazard_verified",{id:e,count:i.verificationCount});return}}}async getRouteTraffic(e){const t=[],i=Math.max(1,Math.floor(e.length/10));let r=!1;for(let l=0;l<e.length-1;l+=i){const c=e[l],u=e[Math.min(l+i,e.length-1)],h=this.calculateMidpoint(c,u),p=await this.getNearbyIncidents(h,500),m=this.getTrafficDataForArea(h,500),y=m.length>0;y&&(r=!0);const b=y?m.reduce((v,T)=>v+T.speed,0)/m.length:null,w=y?this.calculateCongestionLevel(b,p):p.length>0?.3:0;t.push({start:c,end:u,speed:b,congestion:w,incidents:p,hasData:y})}const s=t.filter(l=>l.hasData),o=s.length>0?s.reduce((l,c)=>l+c.speed,0)/s.length:null,a=t.length>0?t.reduce((l,c)=>l+c.congestion,0)/t.length:0;return{segments:t,averageSpeed:o,congestionLevel:a,dataAvailable:r}}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{const i=this.listeners.get(e);if(i){const r=i.indexOf(t);r>=0&&i.splice(r,1)}}}isConnected(){return this.connected}broadcast(e,t){const i=this.listeners.get(e);i&&i.forEach(r=>r(t))}getSessionId(){let e=localStorage.getItem("g3zkp_nav_session");return e||(e=`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("g3zkp_nav_session",e)),e}getRegionKey(e){return`${Math.floor(e[1]*10)},${Math.floor(e[0]*10)}`}cacheTrafficReport(e){const t=this.getRegionKey(e.location);this.trafficCache.has(t)||this.trafficCache.set(t,[]);const i=this.trafficCache.get(t);i.push(e);const r=Date.now()-5*60*1e3;this.trafficCache.set(t,i.filter(s=>s.timestamp>r))}cacheHazardReport(e){const t=this.getRegionKey(e.location);this.hazardsCache.has(t)||this.hazardsCache.set(t,[]);const i=this.hazardsCache.get(t),r=i.findIndex(o=>o.id===e.id);r>=0?i[r]=e:i.push(e);const s=Date.now();this.hazardsCache.set(t,i.filter(o=>o.expiresAt>s))}getCachedIncidents(e,t){const i=[],r=Date.now();for(const s of this.hazardsCache.values())for(const o of s){if(o.expiresAt<=r)continue;const a=this.calculateDistance(e,o.location);a<=t&&i.push({id:o.id,type:o.type,location:o.location,severity:o.type==="accident"?.8:o.type==="police"?.4:.5,description:this.getHazardDescription(o.type),timestamp:o.timestamp,expiresAt:o.expiresAt,distance:a,verified:o.verificationCount>2,verificationCount:o.verificationCount,source:"user"})}return i.sort((s,o)=>s.distance-o.distance)}getHazardDescription(e){return{police:"Police reported ahead",accident:"Accident reported",hazard:"Road hazard reported",speed_camera:"Speed camera ahead"}[e]||"Hazard reported"}getTrafficDataForArea(e,t){const i=this.getRegionKey(e),r=this.trafficCache.get(i)||[],o=Date.now()-5*60*1e3;return r.filter(a=>a.timestamp<o?!1:this.calculateDistance(e,a.location)<=t)}calculateCongestionLevel(e,t){const i=e<20?.9:e<40?.6:e<60?.3:.1,r=t.reduce((s,o)=>s+o.severity*.1,0);return Math.min(1,i+r)}calculateMidpoint(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}calculateDistance(e,t){const r=e[1]*Math.PI/180,s=t[1]*Math.PI/180,o=(t[1]-e[1])*Math.PI/180,a=(t[0]-e[0])*Math.PI/180,l=Math.sin(o/2)**2+Math.cos(r)*Math.cos(s)*Math.sin(a/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}cleanupExpiredData(){const e=Date.now(),t=e-5*60*1e3;for(const[i,r]of this.trafficCache.entries())this.trafficCache.set(i,r.filter(s=>s.timestamp>t));for(const[i,r]of this.hazardsCache.entries())this.hazardsCache.set(i,r.filter(s=>s.expiresAt>e))}persistToStorage(){try{const e=[];for(const t of this.hazardsCache.values())e.push(...t);localStorage.setItem("g3zkp_hazards",JSON.stringify(e))}catch(e){console.error("Failed to persist traffic data:",e)}}loadFromStorage(){try{const e=localStorage.getItem("g3zkp_hazards");if(e){const t=JSON.parse(e),i=Date.now();for(const r of t)r.expiresAt>i&&this.cacheHazardReport(r)}}catch(e){console.error("Failed to load traffic data:",e)}}}const fCe=new dCe,EV=n=>{switch(n){case"walk":return"foot";case"car":return"car";case"transit":return"foot";default:return"car"}};function pCe({currentLocation:n,currentRoute:e,navigationActive:t,navigationHeading:i,showRoutePlanner:r,showTransitPlanner:s,showOfflineManager:o,onMapClick:a,onLocationFound:l,onRouteCalculated:c,onStartNavigation:u,onEndNavigation:h,onReroute:p,onToggleRoutePlanner:m,onToggleTransitPlanner:y,onToggleOfflineManager:b,onCloseRoutePlanner:w,onCloseTransitPlanner:v,onCloseOfflineManager:T}){const[S,M]=$.useState(!1),[P,R]=$.useState(!1),{transportMode:O,setTransportMode:B,setDestination:N,destinationName:I,distanceToNextStep:F,timeToDestination:j,currentStepIndex:W}=cCe(),U=async ee=>{const Q=[ee.lon,ee.lat];if(N(Q,ee.name),R(!0),n)try{const ne=EV(O),fe=await rc.calculateRoute([n,Q],ne,{});fe&&fe.length>0&&c(fe[0])}catch(ne){console.error("[GeodesicNav] Route calculation failed:",ne)}},H=async ee=>{if(B(ee),ee==="transit"){y();return}if(n&&e){const Q=e.geometry.coordinates[e.geometry.coordinates.length-1];try{const ne=EV(ee),fe=await rc.calculateRoute([n,Q],ne,{});fe&&fe.length>0&&c(fe[0])}catch(ne){console.error("[GeodesicNav] Mode change route failed:",ne)}}},q=()=>{M(!S),m()},J=()=>{R(!1),N(null),w()},G=()=>{R(!1),u()};return f.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden relative",children:[f.jsx("div",{className:`flex-1 relative ${t?"z-[999]":"z-0"}`,children:f.jsx(mTe,{currentLocation:n||void 0,destination:e?.geometry.coordinates[e.geometry.coordinates.length-1],route:e||void 0,onMapClick:a,onLocationFound:l,className:"h-full",streetLevelMode:t,heading:i,showBusinessMarkers:!0})}),f.jsx(ZAe,{isNavigating:t,destinationName:I,activeTransportMode:O,currentLocation:n?{lat:n[1],lon:n[0]}:void 0,onMenuClick:q,onSearchSelect:U,onTransportModeChange:H,onEndNavigation:h}),f.jsxs("div",{className:"absolute top-5 right-5 z-[1000] flex flex-col gap-2 pointer-events-auto",children:[f.jsx("button",{onClick:y,className:`w-11 h-11 rounded-xl shadow-lg flex items-center justify-center hover:shadow-xl transition-all border backdrop-blur-md ${s?"bg-purple-600 text-white border-purple-500":"bg-slate-900/90 text-purple-400 border-slate-400/20"}`,title:"Transit Planner",children:f.jsx(Ql,{size:20})}),f.jsx("button",{onClick:b,className:`w-11 h-11 rounded-xl shadow-lg flex items-center justify-center hover:shadow-xl transition-all border backdrop-blur-md ${o?"bg-teal-600 text-white border-teal-500":"bg-slate-900/90 text-teal-400 border-slate-400/20"}`,title:"Offline Maps",children:f.jsx(Zf,{size:20})})]}),!t&&f.jsxs(f.Fragment,{children:[r&&f.jsx("div",{className:"absolute bottom-24 lg:bottom-4 left-5 right-5 md:left-5 md:right-auto md:w-96 z-[1000] pointer-events-auto",children:f.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-md rounded-2xl shadow-2xl border border-slate-400/20 overflow-hidden",children:[f.jsxs("div",{className:"p-4 border-b border-slate-700/50 flex items-center justify-between",children:[f.jsxs("h3",{className:"font-semibold text-teal-400 flex items-center gap-2",children:[f.jsx(m2,{size:18,className:"text-teal-400"}),"Plan Route"]}),f.jsx("button",{onClick:w,className:"w-8 h-8 rounded-full hover:bg-slate-800 flex items-center justify-center text-slate-400",children:f.jsx(Ui,{size:18})})]}),f.jsx("div",{className:"p-4",children:f.jsx(rCe,{onRouteCalculated:c,currentLocation:n||void 0})})]})}),s&&f.jsx("div",{className:"absolute bottom-24 lg:bottom-4 left-5 right-5 md:left-5 md:right-auto md:w-96 z-[1000] pointer-events-auto",children:f.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-md rounded-2xl shadow-2xl border border-purple-500/30 overflow-hidden max-h-[60vh] overflow-y-auto",children:[f.jsxs("div",{className:"p-4 border-b border-purple-500/20 flex items-center justify-between sticky top-0 bg-slate-900/95 backdrop-blur-md",children:[f.jsxs("h3",{className:"font-semibold text-purple-400 flex items-center gap-2",children:[f.jsx(Ql,{size:18,className:"text-purple-400"}),"Public Transit"]}),f.jsx("button",{onClick:v,className:"w-8 h-8 rounded-full hover:bg-purple-500/10 flex items-center justify-center text-purple-400",children:f.jsx(Ui,{size:18})})]}),f.jsx("div",{className:"p-4",children:f.jsx(sCe,{currentLocation:n||void 0,onJourneySelected:ee=>{console.log("Transit journey selected:",ee)}})})]})}),o&&f.jsx("div",{className:"absolute bottom-24 lg:bottom-4 left-5 right-5 md:left-5 md:right-auto md:w-96 z-[1000] pointer-events-auto",children:f.jsxs("div",{className:"bg-slate-900/95 backdrop-blur-md rounded-2xl shadow-2xl border border-teal-500/30 overflow-hidden",children:[f.jsxs("div",{className:"p-4 border-b border-teal-500/20 flex items-center justify-between",children:[f.jsxs("h3",{className:"font-semibold text-teal-400 flex items-center gap-2",children:[f.jsx(Zf,{size:18,className:"text-teal-400"}),"Offline Maps"]}),f.jsx("button",{onClick:T,className:"w-8 h-8 rounded-full hover:bg-teal-500/10 flex items-center justify-center text-teal-400",children:f.jsx(Ui,{size:18})})]}),f.jsx("div",{className:"p-4",children:f.jsx(oCe,{})})]})}),f.jsx("div",{className:"absolute bottom-24 lg:bottom-4 right-5 z-[1000] pointer-events-auto",children:f.jsxs("div",{className:"bg-slate-900/90 backdrop-blur-md rounded-lg px-3 py-2 flex items-center gap-2 border border-slate-400/20",children:[f.jsx(ao,{size:14,className:"text-teal-400"}),f.jsx("span",{className:"text-teal-400 text-xs font-mono",children:"PRIVATE"})]})})]}),f.jsx(YAe,{isOpen:P&&!!e&&!t,route:e,destinationName:I,transportMode:O,distanceToNext:F,timeToDestination:j,currentStep:W,isNavigating:t,onClose:J,onStartNavigation:G,onEndNavigation:h}),t&&e&&f.jsx(lCe,{route:e,onReroute:p,onEndNavigation:h,onReportHazard:(ee,Q)=>{fCe.reportHazard({type:ee,location:Q,description:`${ee} reported at this location`,reporterId:"local_user"})}})]})}const mCe="g3zkp-operator-profile",gCe="g3zkp-operator-sync",yCe=(n,e)=>({id:`operator_${Date.now()}`,peerId:n,displayName:"LOCAL_OPERATOR",publicKey:e,status:ud.ONLINE,statusMessage:"",createdAt:Date.now(),lastSeenAt:Date.now(),isVerified:!1,bio:"",settings:{...nte}});let R8=null;const xCe=n=>{if(!(typeof window>"u"||!("BroadcastChannel"in window)))try{R8=new BroadcastChannel(gCe),R8.onmessage=e=>{e.data?.type==="PROFILE_UPDATE"&&e.data?.profile&&(console.log("[OperatorStore] Received profile update from another tab"),n(e.data.profile))}}catch(e){console.warn("[OperatorStore] BroadcastChannel not available:",e)}},Bte=z_()(dD((n,e)=>(typeof window<"u"&&xCe(t=>{n({profile:t,isInitialized:!0})}),{profile:null,isInitialized:!1,initializeProfile:(t,i)=>{const r=e().profile;if(r&&r.peerId===t){n({isInitialized:!0});return}const s=yCe(t,i);n({profile:s,isInitialized:!0}),console.log("[OperatorStore] Initialized new profile:",s.displayName)},updateProfile:t=>{const i=e().profile;if(!i)return;const r={...i,...t,lastSeenAt:Date.now()};n({profile:r}),e().broadcastProfileUpdate(),console.log("[OperatorStore] Profile updated:",Object.keys(t))},updateSettings:t=>{const i=e().profile;if(!i)return;const r={...i,settings:{...i.settings,...t},lastSeenAt:Date.now()};n({profile:r}),e().broadcastProfileUpdate()},setStatus:t=>{e().updateProfile({status:t})},setAvatar:t=>{e().updateProfile({avatarUrl:t||void 0,avatar:t||void 0})},setDisplayName:t=>{e().updateProfile({displayName:t})},getDisplayName:()=>e().profile?.displayName||"Unknown Operator",getPeerId:()=>e().profile?.peerId||"",getAvatarUrl:()=>{const t=e().profile;return t?.avatarUrl||t?.avatar||null},getProfile:()=>e().profile,broadcastProfileUpdate:()=>{const t=e().profile;if(!(!t||!R8))try{R8.postMessage({type:"PROFILE_UPDATE",profile:t,timestamp:Date.now()})}catch(i){console.warn("[OperatorStore] Failed to broadcast update:",i)}}}),{name:mCe,storage:ite(()=>localStorage),partialize:n=>({profile:n.profile}),onRehydrate:()=>n=>{n&&(n.isInitialized=!0,console.log("[OperatorStore] Rehydrated profile:",n.profile?.displayName))}}));class vCe{getX3DHState(){const e=localStorage.getItem("g3zkp_identity_key"),t=localStorage.getItem("g3zkp_signed_prekey"),i=localStorage.getItem("g3zkp_onetime_keys"),r=localStorage.getItem("g3zkp_last_rotation"),s=localStorage.getItem("g3zkp_active_sessions");let o=[];try{o=i?JSON.parse(i):[]}catch{o=[]}let a={};try{a=s?JSON.parse(s):{}}catch{a={}}return{status:e!==null?"active":"not_initialized",identityKey:e?`${e.substring(0,16)}...`:null,signedPreKey:t?`${t.substring(0,16)}...`:null,oneTimePreKeys:o.length,lastKeyRotation:r?parseInt(r):0,activeSessions:Object.keys(a).length,keyBundleUploaded:localStorage.getItem("g3zkp_key_bundle_uploaded")==="true"}}getDoubleRatchetState(){const e=localStorage.getItem("g3zkp_ratchet_sessions");let t={};try{t=e?JSON.parse(e):{}}catch{t={}}const i=Object.keys(t).length,r=localStorage.getItem("g3zkp_last_ratchet"),s=r?parseInt(r):0;return{status:i>0?"active":"standby",activeChains:i,messageKeysGenerated:Object.values(t).reduce((o,a)=>o+(a.ns||0)+(a.nr||0),0),lastRatchetTime:s,sendingChainLength:Object.values(t).reduce((o,a)=>o+(a.ns||0),0),receivingChainLength:Object.values(t).reduce((o,a)=>o+(a.nr||0),0)}}getAEADState(){const e=localStorage.getItem("g3zkp_identity_key")!==null,t=localStorage.getItem("g3zkp_messages_encrypted"),i=localStorage.getItem("g3zkp_messages_decrypted"),r=localStorage.getItem("g3zkp_last_encryption");return{status:e?"active":"not_initialized",algorithm:"XSalsa20-Poly1305",keySize:256,lastOperation:r?parseInt(r):0,messagesEncrypted:t?parseInt(t):0,messagesDecrypted:i?parseInt(i):0}}getP2PState(){const e=localStorage.getItem("g3zkp_peer_id"),t=localStorage.getItem("g3zkp_connected_peers");let i=[];try{i=t?JSON.parse(t):[]}catch{i=[]}return{peerId:e||null,connectedPeers:i,connectionCount:i.length,status:navigator.onLine?i.length>0?"online":"connecting":"offline",protocol:i.length>0?"ws":null,lastSeen:Date.now(),bandwidth:{incoming:0,outgoing:0}}}async getZKPState(){let e="offline",t=[];try{const s=await fetch("/api/zkp/status");s.ok&&(e=(await s.json()).mode||"simulated");const o=await fetch("/api/zkp/circuits");if(o.ok){const a=await o.json();a.circuits&&Array.isArray(a.circuits)&&(t=a.circuits.map(l=>({name:l.id||l.name||"Unknown",version:"1.0.0",status:l.status||(e==="production"?"active":"simulated"),constraints:l.constraints||0,lastUsed:null,proofsGenerated:0,proofsVerified:0})))}}catch{e="offline"}const i=localStorage.getItem("g3zkp_proofs_generated"),r=localStorage.getItem("g3zkp_proofs_verified");return{engineStatus:e,circuits:t,totalProofsGenerated:i?parseInt(i):0,totalProofsVerified:r?parseInt(r):0,lastActivity:0}}async getRealCryptoState(){const e=await this.getZKPState();return{timestamp:Date.now(),x3dh:this.getX3DHState(),doubleRatchet:this.getDoubleRatchetState(),aead:this.getAEADState(),p2p:this.getP2PState(),zkp:e,online:navigator.onLine}}recordEncryption(){const e=parseInt(localStorage.getItem("g3zkp_messages_encrypted")||"0");localStorage.setItem("g3zkp_messages_encrypted",(e+1).toString()),localStorage.setItem("g3zkp_last_encryption",Date.now().toString())}recordDecryption(){const e=parseInt(localStorage.getItem("g3zkp_messages_decrypted")||"0");localStorage.setItem("g3zkp_messages_decrypted",(e+1).toString())}recordRatchet(){localStorage.setItem("g3zkp_last_ratchet",Date.now().toString())}recordProofGenerated(){const e=parseInt(localStorage.getItem("g3zkp_proofs_generated")||"0");localStorage.setItem("g3zkp_proofs_generated",(e+1).toString())}recordProofVerified(){const e=parseInt(localStorage.getItem("g3zkp_proofs_verified")||"0");localStorage.setItem("g3zkp_proofs_verified",(e+1).toString())}initializeKeys(){if(!localStorage.getItem("g3zkp_identity_key")){const e=Array.from(crypto.getRandomValues(new Uint8Array(32))).map(t=>t.toString(16).padStart(2,"0")).join("");localStorage.setItem("g3zkp_identity_key",e)}if(!localStorage.getItem("g3zkp_signed_prekey")){const e=Array.from(crypto.getRandomValues(new Uint8Array(32))).map(t=>t.toString(16).padStart(2,"0")).join("");localStorage.setItem("g3zkp_signed_prekey",e)}if(!localStorage.getItem("g3zkp_onetime_keys")){const e=Array.from({length:10},()=>Array.from(crypto.getRandomValues(new Uint8Array(32))).map(t=>t.toString(16).padStart(2,"0")).join(""));localStorage.setItem("g3zkp_onetime_keys",JSON.stringify(e))}localStorage.getItem("g3zkp_last_rotation")||localStorage.setItem("g3zkp_last_rotation",Date.now().toString()),localStorage.setItem("g3zkp_key_bundle_uploaded","true")}isInitialized(){return localStorage.getItem("g3zkp_identity_key")!==null}}const BS=new vCe,V4=({name:n,status:e,details:t})=>f.jsxs("div",{className:"bg-gray-900 p-3 rounded border border-gray-800",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("span",{className:"text-gray-300 font-mono text-sm",children:n}),f.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${e==="active"?"bg-green-900 text-green-400":e==="standby"?"bg-blue-900 text-blue-400":e==="online"?"bg-green-900 text-green-400":e==="connecting"?"bg-yellow-900 text-yellow-400":e==="not_initialized"?"bg-orange-900 text-orange-400":"bg-gray-800 text-gray-400"}`,children:e.toUpperCase().replace("_"," ")})]}),f.jsx("div",{className:"text-gray-500 text-xs space-y-1",children:Object.entries(t).map(([i,r])=>f.jsxs("div",{className:"flex justify-between font-mono",children:[f.jsxs("span",{children:[i,":"]}),f.jsx("span",{className:"text-gray-400",children:r})]},i))})]}),bCe=({refreshInterval:n=5e3})=>{const[e,t]=$.useState(null),[i,r]=$.useState(Date.now()),[s,o]=$.useState(!1),[a,l]=$.useState(!1),c=$.useCallback(async()=>{o(!0);try{l(BS.isInitialized());const h=await BS.getRealCryptoState();t(h),r(Date.now())}finally{o(!1)}},[]),u=$.useCallback(()=>{BS.initializeKeys(),l(!0),c()},[c]);return $.useEffect(()=>{c();const h=setInterval(c,n);return()=>clearInterval(h)},[c,n]),e?f.jsxs("div",{className:"bg-black border border-cyan-800 rounded-lg p-4 space-y-6",children:[f.jsxs("div",{className:"border-b border-cyan-900 pb-3",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("h2",{className:"text-cyan-400 text-lg font-mono flex items-center gap-2",children:[f.jsx(ao,{size:20}),"CRYPTOGRAPHIC STATUS DASHBOARD"]}),f.jsx("button",{onClick:c,disabled:s,className:"p-2 text-cyan-400 hover:bg-cyan-900/30 rounded","aria-label":"Refresh",children:f.jsx(RK,{size:16,className:s?"animate-spin":""})})]}),f.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.online?f.jsx(Wae,{size:14,className:"text-green-400"}):f.jsx(Gae,{size:14,className:"text-red-400"}),f.jsxs("span",{className:"text-green-500 text-sm font-mono",children:["Last Update: ",new Date(i).toLocaleTimeString()]}),f.jsx("span",{className:"text-gray-600 text-xs font-mono ml-2",children:"(Data from localStorage)"})]})]}),!a&&f.jsxs("div",{className:"bg-orange-900/30 border border-orange-700 rounded-lg p-4",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[f.jsx(T0,{size:16,className:"text-orange-400"}),f.jsx("span",{className:"text-orange-400 font-mono text-sm",children:"Cryptographic Keys Not Initialized"})]}),f.jsx("p",{className:"text-gray-400 text-xs mb-3",children:"No identity keys found in localStorage. Initialize to generate real cryptographic keys."}),f.jsx("button",{onClick:u,className:"px-4 py-2 bg-orange-800 hover:bg-orange-700 text-white font-mono text-sm rounded",children:"Initialize Keys"})]}),f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"text-gray-300 font-mono",children:"Network Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${e.p2p.status==="online"?"bg-green-900 text-green-400":e.p2p.status==="connecting"?"bg-yellow-900 text-yellow-400":"bg-red-900 text-red-400"}`,children:e.p2p.status.toUpperCase()})]}),f.jsxs("div",{className:"bg-gray-900 p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-sm mb-1 font-mono",children:"Peer ID"}),f.jsx("div",{className:"text-cyan-300 font-mono text-sm truncate",children:e.p2p.peerId||"Not registered"})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"bg-gray-900 p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-sm mb-1 font-mono",children:"Connected Peers"}),f.jsx("div",{className:`text-2xl font-mono ${e.p2p.connectionCount>0?"text-green-400":"text-gray-500"}`,children:e.p2p.connectionCount})]}),f.jsxs("div",{className:"bg-gray-900 p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-sm mb-1 font-mono",children:"Active Sessions"}),f.jsx("div",{className:`text-2xl font-mono ${e.x3dh.activeSessions>0?"text-green-400":"text-gray-500"}`,children:e.x3dh.activeSessions})]})]})]}),f.jsxs("div",{className:"border-t border-cyan-900 pt-4",children:[f.jsxs("h3",{className:"text-cyan-400 mb-3 font-mono flex items-center gap-2",children:[f.jsx(j0,{size:16}),"ENCRYPTION PROTOCOLS"]}),f.jsxs("div",{className:"space-y-3",children:[f.jsx(V4,{name:"X3DH EXCHANGE",status:e.x3dh.status,details:{"Identity Key":e.x3dh.identityKey?"Present":"Not found","Pre-keys":`${e.x3dh.oneTimePreKeys} available`,"Last Rotation":e.x3dh.lastKeyRotation?new Date(e.x3dh.lastKeyRotation).toLocaleDateString():"Never"}}),f.jsx(V4,{name:"DOUBLE RATCHET",status:e.doubleRatchet.status,details:{"Chains Active":e.doubleRatchet.activeChains.toString(),"Message Keys":e.doubleRatchet.messageKeysGenerated.toString(),"Last Ratchet":e.doubleRatchet.lastRatchetTime?`${Math.floor((Date.now()-e.doubleRatchet.lastRatchetTime)/1e3)}s ago`:"Never"}}),f.jsx(V4,{name:"AEAD ENCRYPTION",status:e.aead.status,details:{Algorithm:e.aead.algorithm,"Key Size":`${e.aead.keySize} bits`,Encrypted:e.aead.messagesEncrypted.toString(),Decrypted:e.aead.messagesDecrypted.toString()}}),f.jsx(V4,{name:"P2P NETWORK",status:e.p2p.status,details:{Protocol:e.p2p.protocol||"None",Peers:e.p2p.connectedPeers.length.toString()}})]})]}),f.jsxs("div",{className:"border-t border-cyan-900 pt-4",children:[f.jsxs("h3",{className:"text-cyan-400 mb-3 font-mono flex items-center gap-2",children:[f.jsx(vK,{size:16}),"ZKP SNARK SYSTEM"]}),f.jsxs("div",{className:"bg-gray-900 p-3 rounded border border-gray-800 mb-3",children:[f.jsxs("div",{className:"flex justify-between items-center",children:[f.jsx("span",{className:"text-gray-300 font-mono text-sm",children:"Engine Status"}),f.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${e.zkp.engineStatus==="production"?"bg-green-900 text-green-400":e.zkp.engineStatus==="simulated"?"bg-yellow-900 text-yellow-400":"bg-red-900 text-red-400"}`,children:e.zkp.engineStatus.toUpperCase()})]}),f.jsxs("div",{className:"mt-2 text-xs text-gray-500 font-mono",children:["Proofs: ",e.zkp.totalProofsGenerated," generated, ",e.zkp.totalProofsVerified," verified"]})]}),e.zkp.circuits.length>0?f.jsx("div",{className:"space-y-2",children:e.zkp.circuits.map((h,p)=>f.jsxs("div",{className:"bg-gray-900 p-3 rounded border border-gray-800",children:[f.jsxs("div",{className:"flex justify-between items-center mb-2",children:[f.jsx("span",{className:"text-green-400 font-mono text-sm",children:h.name}),f.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${h.status==="active"?"bg-green-900 text-green-400":"bg-gray-800 text-gray-400"}`,children:h.status==="simulated"?"STANDBY":h.status.toUpperCase()})]}),f.jsxs("div",{className:"text-gray-500 text-xs font-mono",children:["v",h.version," | ",h.constraints.toLocaleString()," constraints"]})]},p))}):f.jsx("div",{className:"text-gray-500 text-sm font-mono text-center py-4",children:"No circuits loaded from backend"})]}),f.jsxs("div",{className:"text-center text-gray-600 text-xs font-mono pt-4 border-t border-gray-800",children:[f.jsx("p",{children:"All data sourced from localStorage and /api endpoints"}),f.jsx("p",{className:"text-green-500 mt-1",children:"No fabricated or simulated values"})]})]}):f.jsx("div",{className:"p-4 text-cyan-400 font-mono animate-pulse",children:"Loading cryptographic state from localStorage..."})},_Ce=()=>{const[n,e]=$.useState([]),[t,i]=$.useState(!0),r=$.useRef(0),s=$.useRef(null),o=$.useCallback((c,u,h="info")=>{const p={id:`evt_${Date.now()}_${r.current++}`,type:c,message:u,timestamp:Date.now(),level:h};e(m=>[p,...m].slice(0,50))},[]);$.useEffect(()=>{o("system","Protocol Monitor initialized","info"),o("network",`Online status: ${navigator.onLine?"ONLINE":"OFFLINE"}`,navigator.onLine?"success":"warning");const c=localStorage.getItem("g3zkp_identity_key");c?(o("key","X3DH: Identity key loaded from storage","success"),s.current=c.substring(0,16)):o("key","X3DH: No identity key found - awaiting initialization","warning"),localStorage.getItem("g3zkp_signed_prekey")&&o("key","X3DH: Signed pre-key available","success");const h=localStorage.getItem("g3zkp_onetime_keys");if(h)try{const p=JSON.parse(h);o("key",`X3DH: ${p.length} one-time pre-keys available`,"info")}catch{o("key","X3DH: One-time keys storage corrupted","error")}},[o]),$.useEffect(()=>{if(!t)return;const c=()=>o("network","Network: Connection restored","success"),u=()=>o("network","Network: Connection lost","error");return window.addEventListener("online",c),window.addEventListener("offline",u),()=>{window.removeEventListener("online",c),window.removeEventListener("offline",u)}},[t,o]),$.useEffect(()=>{if(!t)return;const u=setInterval(()=>{const h=localStorage.getItem("g3zkp_identity_key");h&&h.substring(0,16)!==s.current&&(s.current===null?o("key","X3DH: Identity key generated","success"):o("key","X3DH: Identity key rotated","success"),s.current=h.substring(0,16));const p=localStorage.getItem("g3zkp_active_sessions");if(p)try{const m=JSON.parse(p),y=Object.keys(m).length;y>0&&o("encryption",`AEAD: ${y} active session(s)`,"info")}catch{}},5e3);return()=>clearInterval(u)},[t,o]),$.useEffect(()=>{if(!t)return;const c=async()=>{try{const h=await fetch("/api/zkp/status");if(h.ok){const p=await h.json();o("zkp",`ZKP: Engine ${p.mode} - ${p.initialized?"Ready":"Initializing"}`,p.initialized?"success":"info")}}catch{o("zkp","ZKP: Backend unavailable","warning")}};c();const u=setInterval(c,3e4);return()=>clearInterval(u)},[t,o]),$.useEffect(()=>{if(!t)return;const c=async()=>{try{const h=await fetch("/api/health");if(h.ok){const p=await h.json();p.connectedPeers>0&&o("network",`P2P: ${p.connectedPeers} peer(s) connected via WebSocket`,"success")}}catch{o("network","P2P: Health check failed","warning")}};c();const u=setInterval(c,15e3);return()=>clearInterval(u)},[t,o]);const a=c=>{switch(c){case"success":return"text-green-400";case"warning":return"text-yellow-400";case"error":return"text-red-400";default:return"text-cyan-400"}},l=c=>{switch(c){case"encryption":case"decryption":return"[ENC]";case"ratchet":return"[DR]";case"zkp":return"[ZKP]";case"network":return"[NET]";case"key":return"[KEY]";case"system":return"[SYS]"}};return f.jsxs("div",{className:"bg-black border border-cyan-800 rounded-lg p-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("h3",{className:"text-cyan-400 font-mono flex items-center gap-2",children:[f.jsx(Vm,{size:18}),"LIVE PROTOCOL EVENTS"]}),f.jsx("button",{onClick:()=>i(!t),className:`px-3 py-1 rounded text-xs font-mono ${t?"bg-green-900 text-green-400":"bg-gray-800 text-gray-400"}`,children:t?"LIVE":"PAUSED"})]}),f.jsx("div",{className:"h-64 overflow-y-auto space-y-1 font-mono text-xs",children:n.length===0?f.jsx("div",{className:"text-gray-500 text-center py-8",children:"Waiting for protocol events..."}):n.map(c=>f.jsxs("div",{className:"flex items-start gap-2 py-1 border-b border-gray-900",children:[f.jsxs("span",{className:"text-gray-600 whitespace-nowrap",children:["[",new Date(c.timestamp).toLocaleTimeString(),"]"]}),f.jsx("span",{className:"text-gray-500",children:l(c.type)}),f.jsx("span",{className:a(c.level),children:c.message})]},c.id))}),f.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-800 flex justify-between text-xs font-mono text-gray-500",children:[f.jsxs("span",{children:["Events: ",n.length]}),f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(nk,{size:12,className:"text-cyan-400"}),"Real-time monitoring (no simulation)"]})]})]})},wCe=()=>{const[n,e]=$.useState([]),[t,i]=$.useState("simulated"),[r,s]=$.useState(!0);$.useEffect(()=>{const a=async()=>{s(!0);try{const c=await BS.getZKPState();e(c.circuits),i(c.engineStatus)}finally{s(!1)}};a();const l=setInterval(a,1e4);return()=>clearInterval(l)},[]);const o=a=>{switch(a){case"active":return f.jsx(us,{size:14,className:"text-green-400"});case"simulated":return f.jsx(ZP,{size:14,className:"text-yellow-400"});default:return f.jsx(z0,{size:14,className:"text-gray-500"})}};return r?f.jsx("div",{className:"bg-black border border-cyan-800 rounded-lg p-4",children:f.jsx("div",{className:"animate-pulse text-cyan-400 font-mono",children:"Loading ZKP circuits..."})}):f.jsxs("div",{className:"bg-black border border-cyan-800 rounded-lg p-4",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("h3",{className:"text-cyan-400 font-mono flex items-center gap-2",children:[f.jsx(vK,{size:18}),"ZKP CIRCUIT REGISTRY"]}),f.jsx("span",{className:`px-2 py-1 rounded text-xs font-mono ${t==="production"?"bg-green-900 text-green-400":t==="simulated"?"bg-yellow-900 text-yellow-400":"bg-red-900 text-red-400"}`,children:t.toUpperCase()})]}),f.jsx("div",{className:"space-y-3",children:n.map((a,l)=>f.jsxs("div",{className:"bg-gray-900 border border-gray-800 rounded p-3",children:[f.jsxs("div",{className:"flex items-center justify-between mb-2",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[o(a.status),f.jsx("span",{className:"text-green-400 font-mono text-sm",children:a.name})]}),f.jsxs("span",{className:"text-gray-500 font-mono text-xs",children:["v",a.version]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[f.jsxs("div",{className:"flex items-center gap-1 text-gray-400 font-mono",children:[f.jsx(SK,{size:12}),f.jsxs("span",{children:[a.constraints.toLocaleString()," constraints"]})]}),f.jsxs("div",{className:"text-right text-gray-500 font-mono",children:[a.proofsGenerated," proofs"]})]}),a.lastUsed&&f.jsxs("div",{className:"mt-2 text-xs text-gray-600 font-mono",children:["Last used: ",new Date(a.lastUsed).toLocaleTimeString()]})]},l))}),f.jsx("div",{className:"mt-4 pt-3 border-t border-gray-800",children:f.jsxs("div",{className:"text-xs font-mono text-gray-500 space-y-1",children:[f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{children:"Groth16 proving system"}),f.jsx("span",{className:"text-cyan-400",children:"Active"})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{children:"BN254 curve"}),f.jsx("span",{className:"text-cyan-400",children:"Configured"})]}),f.jsxs("div",{className:"flex justify-between",children:[f.jsx("span",{children:"snarkjs runtime"}),f.jsx("span",{className:"text-cyan-400",children:"v0.7.0"})]})]})})]})};/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const _9="182",Gp={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Wp={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Ute=0,RN=1,Fte=2,SCe=3,zte=0,ky=1,C3=2,dm=3,Dd=0,fa=1,Yu=2,ah=0,km=1,IN=2,NN=3,PN=4,jte=5,$f=100,Vte=101,Hte=102,$te=103,Gte=104,Wte=200,Kte=201,qte=202,Zte=203,I8=204,N8=205,Yte=206,Xte=207,Qte=208,Jte=209,ene=210,tne=211,nne=212,ine=213,rne=214,P8=0,k8=1,L8=2,t1=3,D8=4,O8=5,B8=6,U8=7,$_=0,sne=1,one=2,pc=0,SD=1,ED=2,TD=3,w9=4,AD=5,CD=6,MD=7,kN="attached",ane="detached",S9=300,fh=301,L0=302,Rb=303,Ib=304,xx=306,Nb=1e3,Ga=1001,Pb=1002,is=1003,RD=1004,ECe=1004,hy=1005,TCe=1005,mr=1006,M3=1007,ACe=1007,th=1008,CCe=1008,ca=1009,ID=1010,ND=1011,G2=1012,E9=1013,bc=1014,Do=1015,du=1016,T9=1017,A9=1018,W2=1020,PD=35902,kD=35899,LD=1021,DD=1022,Oo=1023,ph=1026,i0=1027,C9=1028,G_=1029,n1=1030,M9=1031,MCe=1032,R9=1033,R3=33776,I3=33777,N3=33778,P3=33779,F8=35840,z8=35841,j8=35842,V8=35843,H8=36196,$8=37492,G8=37496,W8=37488,K8=37489,q8=37490,Z8=37491,Y8=37808,X8=37809,Q8=37810,J8=37811,eE=37812,tE=37813,nE=37814,iE=37815,rE=37816,sE=37817,oE=37818,aE=37819,lE=37820,cE=37821,uE=36492,hE=36494,dE=36495,fE=36283,pE=36284,mE=36285,gE=36286,lne=2200,cne=2201,une=2202,kb=2300,yE=2301,US=2302,fm=2400,pm=2401,Lb=2402,I9=2500,OD=2501,RCe=0,ICe=1,NCe=2,hne=3200,PCe=3201,kCe=3202,LCe=3203,K0=0,dne=1,hd="",ka="srgb",i1="srgb-linear",Db="linear",Gi="srgb",DCe="",OCe="rg",BCe="ga",UCe=0,Kp=7680,FCe=7681,zCe=7682,jCe=7683,VCe=34055,HCe=34056,$Ce=5386,GCe=512,WCe=513,KCe=514,qCe=515,ZCe=516,YCe=517,XCe=518,LN=519,fne=512,pne=513,mne=514,N9=515,gne=516,yne=517,P9=518,xne=519,Ob=35044,QCe=35048,JCe=35040,eMe=35045,tMe=35049,nMe=35041,iMe=35046,rMe=35050,sMe=35042,oMe="100",DN="300 es",Sl=2e3,K2=2001,aMe={COMPUTE:"compute",RENDER:"render"},lMe={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},cMe={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function vne(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}const uMe={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function dy(n,e){return new uMe[n](e)}function bne(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Bb(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function _ne(){const n=Bb("canvas");return n.style.display="block",n}const TV={};let D0=null;function hMe(n){D0=n}function dMe(){return D0}function Ub(...n){const e="THREE."+n.shift();D0?D0("log",e,...n):console.log(e,...n)}function Wt(...n){const e="THREE."+n.shift();D0?D0("warn",e,...n):console.warn(e,...n)}function xn(...n){const e="THREE."+n.shift();D0?D0("error",e,...n):console.error(e,...n)}function q2(...n){const e=n.join(" ");e in TV||(TV[e]=!0,Wt(...n))}function fMe(n,e,t){return new Promise(function(i,r){function s(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:r();break;case n.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:i()}}setTimeout(s,t)})}let xh=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){const i=this._listeners;return i===void 0?!1:i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){const i=this._listeners;if(i===void 0)return;const r=i[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const i=t[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};const vo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let AV=1234567;const Lm=Math.PI/180,Z2=180/Math.PI;function Tl(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(vo[n&255]+vo[n>>8&255]+vo[n>>16&255]+vo[n>>24&255]+"-"+vo[e&255]+vo[e>>8&255]+"-"+vo[e>>16&15|64]+vo[e>>24&255]+"-"+vo[t&63|128]+vo[t>>8&255]+"-"+vo[t>>16&255]+vo[t>>24&255]+vo[i&255]+vo[i>>8&255]+vo[i>>16&255]+vo[i>>24&255]).toLowerCase()}function Bn(n,e,t){return Math.max(e,Math.min(t,n))}function BD(n,e){return(n%e+e)%e}function pMe(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function mMe(n,e,t){return n!==e?(t-n)/(e-n):0}function k3(n,e,t){return(1-t)*n+t*e}function gMe(n,e,t,i){return k3(n,e,1-Math.exp(-t*i))}function yMe(n,e=1){return e-Math.abs(BD(n,e*2)-e)}function xMe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function vMe(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function bMe(n,e){return n+Math.floor(Math.random()*(e-n+1))}function _Me(n,e){return n+Math.random()*(e-n)}function wMe(n){return n*(.5-Math.random())}function SMe(n){n!==void 0&&(AV=n);let e=AV+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function EMe(n){return n*Lm}function TMe(n){return n*Z2}function AMe(n){return(n&n-1)===0&&n!==0}function CMe(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function MMe(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function RMe(n,e,t,i,r){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+i)/2),u=o((e+i)/2),h=s((e-i)/2),p=o((e-i)/2),m=s((i-e)/2),y=o((i-e)/2);switch(r){case"XYX":n.set(a*u,l*h,l*p,a*c);break;case"YZY":n.set(l*p,a*u,l*h,a*c);break;case"ZXZ":n.set(l*h,l*p,a*u,a*c);break;case"XZX":n.set(a*u,l*y,l*m,a*c);break;case"YXY":n.set(l*m,a*u,l*y,a*c);break;case"ZYZ":n.set(l*y,l*m,a*u,a*c);break;default:Wt("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function ua(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Yn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const IMe={DEG2RAD:Lm,RAD2DEG:Z2,generateUUID:Tl,clamp:Bn,euclideanModulo:BD,mapLinear:pMe,inverseLerp:mMe,lerp:k3,damp:gMe,pingpong:yMe,smoothstep:xMe,smootherstep:vMe,randInt:bMe,randFloat:_Me,randFloatSpread:wMe,seededRandom:SMe,degToRad:EMe,radToDeg:TMe,isPowerOfTwo:AMe,ceilPowerOfTwo:CMe,floorPowerOfTwo:MMe,setQuaternionFromProperEuler:RMe,normalize:Yn,denormalize:ua};let Et=class wne{constructor(e=0,t=0){wne.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Bn(this.x,e.x,t.x),this.y=Bn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Bn(this.x,e,t),this.y=Bn(this.y,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Bn(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Bn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Uo=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],h=i[r+3],p=s[o+0],m=s[o+1],y=s[o+2],b=s[o+3];if(a<=0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a>=1){e[t+0]=p,e[t+1]=m,e[t+2]=y,e[t+3]=b;return}if(h!==b||l!==p||c!==m||u!==y){let w=l*p+c*m+u*y+h*b;w<0&&(p=-p,m=-m,y=-y,b=-b,w=-w);let v=1-a;if(w<.9995){const T=Math.acos(w),S=Math.sin(T);v=Math.sin(v*T)/S,a=Math.sin(a*T)/S,l=l*v+p*a,c=c*v+m*a,u=u*v+y*a,h=h*v+b*a}else{l=l*v+p*a,c=c*v+m*a,u=u*v+y*a,h=h*v+b*a;const T=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=T,c*=T,u*=T,h*=T}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],h=s[o],p=s[o+1],m=s[o+2],y=s[o+3];return e[t]=a*y+u*h+l*m-c*p,e[t+1]=l*y+u*p+c*h-a*m,e[t+2]=c*y+u*m+a*p-l*h,e[t+3]=u*y-a*h-l*p-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),h=a(s/2),p=l(i/2),m=l(r/2),y=l(s/2);switch(o){case"XYZ":this._x=p*u*h+c*m*y,this._y=c*m*h-p*u*y,this._z=c*u*y+p*m*h,this._w=c*u*h-p*m*y;break;case"YXZ":this._x=p*u*h+c*m*y,this._y=c*m*h-p*u*y,this._z=c*u*y-p*m*h,this._w=c*u*h+p*m*y;break;case"ZXY":this._x=p*u*h-c*m*y,this._y=c*m*h+p*u*y,this._z=c*u*y+p*m*h,this._w=c*u*h-p*m*y;break;case"ZYX":this._x=p*u*h-c*m*y,this._y=c*m*h+p*u*y,this._z=c*u*y-p*m*h,this._w=c*u*h+p*m*y;break;case"YZX":this._x=p*u*h+c*m*y,this._y=c*m*h+p*u*y,this._z=c*u*y-p*m*h,this._w=c*u*h-p*m*y;break;case"XZY":this._x=p*u*h-c*m*y,this._y=c*m*h-p*u*y,this._z=c*u*y+p*m*h,this._w=c*u*h+p*m*y;break;default:Wt("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],p=i+a+h;if(p>0){const m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(u-l)*m,this._y=(s-c)*m,this._z=(o-r)*m}else if(i>a&&i>h){const m=2*Math.sqrt(1+i-a-h);this._w=(u-l)/m,this._x=.25*m,this._y=(r+o)/m,this._z=(s+c)/m}else if(a>h){const m=2*Math.sqrt(1+a-i-h);this._w=(s-c)/m,this._x=(r+o)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+h-i-a);this._w=(o-r)/m,this._x=(s+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<1e-8?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Bn(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let i=e._x,r=e._y,s=e._z,o=e._w,a=this.dot(e);a<0&&(i=-i,r=-r,s=-s,o=-o,a=-a);let l=1-t;if(a<.9995){const c=Math.acos(a),u=Math.sin(c);l=Math.sin(l*c)/u,t=Math.sin(t*c)/u,this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+o*t,this._onChangeCallback()}else this._x=this._x*l+i*t,this._y=this._y*l+r*t,this._z=this._z*l+s*t,this._w=this._w*l+o*t,this.normalize();return this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},ye=class Sne{constructor(e=0,t=0,i=0){Sne.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(CV.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(CV.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*i),u=2*(a*t-s*r),h=2*(s*i-o*t);return this.x=t+l*c+o*h-a*u,this.y=i+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Bn(this.x,e.x,t.x),this.y=Bn(this.y,e.y,t.y),this.z=Bn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Bn(this.x,e,t),this.y=Bn(this.y,e,t),this.z=Bn(this.z,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Bn(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return wC.copy(this).projectOnVector(e),this.sub(wC)}reflect(e){return this.sub(wC.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Bn(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const wC=new ye,CV=new Uo;let ti=class Ene{constructor(e,t,i,r,s,o,a,l,c){Ene.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],h=i[7],p=i[2],m=i[5],y=i[8],b=r[0],w=r[3],v=r[6],T=r[1],S=r[4],M=r[7],P=r[2],R=r[5],O=r[8];return s[0]=o*b+a*T+l*P,s[3]=o*w+a*S+l*R,s[6]=o*v+a*M+l*O,s[1]=c*b+u*T+h*P,s[4]=c*w+u*S+h*R,s[7]=c*v+u*M+h*O,s[2]=p*b+m*T+y*P,s[5]=p*w+m*S+y*R,s[8]=p*v+m*M+y*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=a*l-u*s,m=c*s-o*l,y=t*h+i*p+r*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=h*b,e[1]=(r*c-u*i)*b,e[2]=(a*i-r*o)*b,e[3]=p*b,e[4]=(u*t-r*l)*b,e[5]=(r*s-a*t)*b,e[6]=m*b,e[7]=(i*l-c*t)*b,e[8]=(o*t-i*s)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(SC.makeScale(e,t)),this}rotate(e){return this.premultiply(SC.makeRotation(-e)),this}translate(e,t){return this.premultiply(SC.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const SC=new ti,MV=new ti().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),RV=new ti().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function NMe(){const n={enabled:!0,workingColorSpace:i1,spaces:{},convert:function(r,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===Gi&&(r.r=Ad(r.r),r.g=Ad(r.g),r.b=Ad(r.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(r.applyMatrix3(this.spaces[s].toXYZ),r.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===Gi&&(r.r=Ly(r.r),r.g=Ly(r.g),r.b=Ly(r.b))),r},workingToColorSpace:function(r,s){return this.convert(r,this.workingColorSpace,s)},colorSpaceToWorking:function(r,s){return this.convert(r,s,this.workingColorSpace)},getPrimaries:function(r){return this.spaces[r].primaries},getTransfer:function(r){return r===hd?Db:this.spaces[r].transfer},getToneMappingMode:function(r){return this.spaces[r].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(r,s=this.workingColorSpace){return r.fromArray(this.spaces[s].luminanceCoefficients)},define:function(r){Object.assign(this.spaces,r)},_getMatrix:function(r,s,o){return r.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(r){return this.spaces[r].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(r=this.workingColorSpace){return this.spaces[r].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(r,s){return q2("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(r,s)},toWorkingColorSpace:function(r,s){return q2("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(r,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],i=[.3127,.329];return n.define({[i1]:{primaries:e,whitePoint:i,transfer:Db,toXYZ:MV,fromXYZ:RV,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:ka},outputColorSpaceConfig:{drawingBufferColorSpace:ka}},[ka]:{primaries:e,whitePoint:i,transfer:Gi,toXYZ:MV,fromXYZ:RV,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:ka}}}),n}const xi=NMe();function Ad(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Ly(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let og,Tne=class{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let i;if(e instanceof HTMLCanvasElement)i=e;else{og===void 0&&(og=Bb("canvas")),og.width=e.width,og.height=e.height;const r=og.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),i=og}return i.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Bb("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Ad(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Ad(t[i]/255)*255):t[i]=Ad(t[i]);return{data:t,width:e.width,height:e.height}}else return Wt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},PMe=0,r0=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:PMe++}),this.uuid=Tl(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(EC(r[o].image)):s.push(EC(r[o]))}else s=EC(r);i.url=s}return t||(e.images[this.uuid]=i),i}};function EC(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Tne.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(Wt("Texture: Unable to serialize Texture."),{})}let kMe=0;const TC=new ye;let Gs=class FS extends xh{constructor(e=FS.DEFAULT_IMAGE,t=FS.DEFAULT_MAPPING,i=Ga,r=Ga,s=mr,o=th,a=Oo,l=ca,c=FS.DEFAULT_ANISOTROPY,u=hd){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:kMe++}),this.uuid=Tl(),this.name="",this.source=new r0(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new Et(0,0),this.repeat=new Et(1,1),this.center=new Et(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ti,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(TC).x}get height(){return this.source.getSize(TC).y}get depth(){return this.source.getSize(TC).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const i=e[t];if(i===void 0){Wt(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Wt(`Texture.setValues(): property '${t}' does not exist.`);continue}r&&i&&r.isVector2&&i.isVector2||r&&i&&r.isVector3&&i.isVector3||r&&i&&r.isMatrix3&&i.isMatrix3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==S9)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Nb:e.x=e.x-Math.floor(e.x);break;case Ga:e.x=e.x<0?0:1;break;case Pb:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Nb:e.y=e.y-Math.floor(e.y);break;case Ga:e.y=e.y<0?0:1;break;case Pb:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};Gs.DEFAULT_IMAGE=null;Gs.DEFAULT_MAPPING=S9;Gs.DEFAULT_ANISOTROPY=1;class fr{constructor(e=0,t=0,i=0,r=1){fr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],h=l[8],p=l[1],m=l[5],y=l[9],b=l[2],w=l[6],v=l[10];if(Math.abs(u-p)<.01&&Math.abs(h-b)<.01&&Math.abs(y-w)<.01){if(Math.abs(u+p)<.1&&Math.abs(h+b)<.1&&Math.abs(y+w)<.1&&Math.abs(c+m+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const S=(c+1)/2,M=(m+1)/2,P=(v+1)/2,R=(u+p)/4,O=(h+b)/4,B=(y+w)/4;return S>M&&S>P?S<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(S),r=R/i,s=O/i):M>P?M<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(M),i=R/r,s=B/r):P<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(P),i=O/s,r=B/s),this.set(i,r,s,t),this}let T=Math.sqrt((w-y)*(w-y)+(h-b)*(h-b)+(p-u)*(p-u));return Math.abs(T)<.001&&(T=1),this.x=(w-y)/T,this.y=(h-b)/T,this.z=(p-u)/T,this.w=Math.acos((c+m+v-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Bn(this.x,e.x,t.x),this.y=Bn(this.y,e.y,t.y),this.z=Bn(this.z,e.z,t.z),this.w=Bn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Bn(this.x,e,t),this.y=Bn(this.y,e,t),this.z=Bn(this.z,e,t),this.w=Bn(this.w,e,t),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Bn(i,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class UD extends xh{constructor(e=1,t=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:mr,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=i.depth,this.scissor=new fr(0,0,e,t),this.scissorTest=!1,this.viewport=new fr(0,0,e,t);const r={width:e,height:t,depth:i.depth},s=new Gs(r);this.textures=[];const o=i.count;for(let a=0;a<o;a++)this.textures[a]=s.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(e={}){const t={minFilter:mr,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,s=this.textures.length;r<s;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i,this.textures[r].isData3DTexture!==!0&&(this.textures[r].isArrayTexture=this.textures[r].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,i=e.textures.length;t<i;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const r=Object.assign({},e.textures[t].image);this.textures[t].source=new r0(r)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Xa extends UD{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class k9 extends Gs{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=is,this.minFilter=is,this.wrapR=Ga,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class LMe extends Xa{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new k9(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class L9 extends Gs{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=is,this.minFilter=is,this.wrapR=Ga,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class DMe extends Xa{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new L9(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}let Fo=class{constructor(e=new ye(1/0,1/0,1/0),t=new ye(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Lc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Lc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Lc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Lc):Lc.fromBufferAttribute(s,o),Lc.applyMatrix4(e.matrixWorld),this.expandByPoint(Lc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),H4.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),H4.copy(i.boundingBox)),H4.applyMatrix4(e.matrixWorld),this.union(H4)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Lc),Lc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(vv),$4.subVectors(this.max,vv),ag.subVectors(e.a,vv),lg.subVectors(e.b,vv),cg.subVectors(e.c,vv),Ef.subVectors(lg,ag),Tf.subVectors(cg,lg),Ep.subVectors(ag,cg);let t=[0,-Ef.z,Ef.y,0,-Tf.z,Tf.y,0,-Ep.z,Ep.y,Ef.z,0,-Ef.x,Tf.z,0,-Tf.x,Ep.z,0,-Ep.x,-Ef.y,Ef.x,0,-Tf.y,Tf.x,0,-Ep.y,Ep.x,0];return!AC(t,ag,lg,cg,$4)||(t=[1,0,0,0,1,0,0,0,1],!AC(t,ag,lg,cg,$4))?!1:(G4.crossVectors(Ef,Tf),t=[G4.x,G4.y,G4.z],AC(t,ag,lg,cg,$4))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Lc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Lc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Fh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Fh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Fh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Fh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Fh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Fh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Fh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Fh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Fh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}};const Fh=[new ye,new ye,new ye,new ye,new ye,new ye,new ye,new ye],Lc=new ye,H4=new Fo,ag=new ye,lg=new ye,cg=new ye,Ef=new ye,Tf=new ye,Ep=new ye,vv=new ye,$4=new ye,G4=new ye,Tp=new ye;function AC(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){Tp.fromArray(n,s);const a=r.x*Math.abs(Tp.x)+r.y*Math.abs(Tp.y)+r.z*Math.abs(Tp.z),l=e.dot(Tp),c=t.dot(Tp),u=i.dot(Tp);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const OMe=new Fo,bv=new ye,CC=new ye;let ro=class{constructor(e=new ye,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):OMe.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;bv.subVectors(e,this.center);const t=bv.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(bv,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(CC.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(bv.copy(e.center).add(CC)),this.expandByPoint(bv.copy(e.center).sub(CC))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}};const zh=new ye,MC=new ye,W4=new ye,Af=new ye,RC=new ye,K4=new ye,IC=new ye;class E1{constructor(e=new ye,t=new ye(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,zh)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=zh.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(zh.copy(this.origin).addScaledVector(this.direction,t),zh.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){MC.copy(e).add(t).multiplyScalar(.5),W4.copy(t).sub(e).normalize(),Af.copy(this.origin).sub(MC);const s=e.distanceTo(t)*.5,o=-this.direction.dot(W4),a=Af.dot(this.direction),l=-Af.dot(W4),c=Af.lengthSq(),u=Math.abs(1-o*o);let h,p,m,y;if(u>0)if(h=o*l-a,p=o*a-l,y=s*u,h>=0)if(p>=-y)if(p<=y){const b=1/u;h*=b,p*=b,m=h*(h+o*p+2*a)+p*(o*h+p+2*l)+c}else p=s,h=Math.max(0,-(o*p+a)),m=-h*h+p*(p+2*l)+c;else p=-s,h=Math.max(0,-(o*p+a)),m=-h*h+p*(p+2*l)+c;else p<=-y?(h=Math.max(0,-(-o*s+a)),p=h>0?-s:Math.min(Math.max(-s,-l),s),m=-h*h+p*(p+2*l)+c):p<=y?(h=0,p=Math.min(Math.max(-s,-l),s),m=p*(p+2*l)+c):(h=Math.max(0,-(o*s+a)),p=h>0?s:Math.min(Math.max(-s,-l),s),m=-h*h+p*(p+2*l)+c);else p=o>0?-s:s,h=Math.max(0,-(o*p+a)),m=-h*h+p*(p+2*l)+c;return i&&i.copy(this.origin).addScaledVector(this.direction,h),r&&r.copy(MC).addScaledVector(W4,p),m}intersectSphere(e,t){zh.subVectors(e.center,this.origin);const i=zh.dot(this.direction),r=zh.dot(zh)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,p=this.origin;return c>=0?(i=(e.min.x-p.x)*c,r=(e.max.x-p.x)*c):(i=(e.max.x-p.x)*c,r=(e.min.x-p.x)*c),u>=0?(s=(e.min.y-p.y)*u,o=(e.max.y-p.y)*u):(s=(e.max.y-p.y)*u,o=(e.min.y-p.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),h>=0?(a=(e.min.z-p.z)*h,l=(e.max.z-p.z)*h):(a=(e.max.z-p.z)*h,l=(e.min.z-p.z)*h),i>l||a>r)||((a>i||i!==i)&&(i=a),(l<r||r!==r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,zh)!==null}intersectTriangle(e,t,i,r,s){RC.subVectors(t,e),K4.subVectors(i,e),IC.crossVectors(RC,K4);let o=this.direction.dot(IC),a;if(o>0){if(r)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Af.subVectors(this.origin,e);const l=a*this.direction.dot(K4.crossVectors(Af,K4));if(l<0)return null;const c=a*this.direction.dot(RC.cross(Af));if(c<0||l+c>o)return null;const u=-a*Af.dot(IC);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}let Hn=class ON{constructor(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w){ON.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w)}set(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=r,v[1]=s,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=u,v[10]=h,v[14]=p,v[3]=m,v[7]=y,v[11]=b,v[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ON().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),i.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this)}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,i=e.elements,r=1/ug.setFromMatrixColumn(e,0).length(),s=1/ug.setFromMatrixColumn(e,1).length(),o=1/ug.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const p=o*u,m=o*h,y=a*u,b=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=m+y*c,t[5]=p-b*c,t[9]=-a*l,t[2]=b-p*c,t[6]=y+m*c,t[10]=o*l}else if(e.order==="YXZ"){const p=l*u,m=l*h,y=c*u,b=c*h;t[0]=p+b*a,t[4]=y*a-m,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=m*a-y,t[6]=b+p*a,t[10]=o*l}else if(e.order==="ZXY"){const p=l*u,m=l*h,y=c*u,b=c*h;t[0]=p-b*a,t[4]=-o*h,t[8]=y+m*a,t[1]=m+y*a,t[5]=o*u,t[9]=b-p*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const p=o*u,m=o*h,y=a*u,b=a*h;t[0]=l*u,t[4]=y*c-m,t[8]=p*c+b,t[1]=l*h,t[5]=b*c+p,t[9]=m*c-y,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const p=o*l,m=o*c,y=a*l,b=a*c;t[0]=l*u,t[4]=b-p*h,t[8]=y*h+m,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=m*h+y,t[10]=p-b*h}else if(e.order==="XZY"){const p=o*l,m=o*c,y=a*l,b=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=p*h+b,t[5]=o*u,t[9]=m*h-y,t[2]=y*h-m,t[6]=a*u,t[10]=b*h+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(BMe,e,UMe)}lookAt(e,t,i){const r=this.elements;return hl.subVectors(e,t),hl.lengthSq()===0&&(hl.z=1),hl.normalize(),Cf.crossVectors(i,hl),Cf.lengthSq()===0&&(Math.abs(i.z)===1?hl.x+=1e-4:hl.z+=1e-4,hl.normalize(),Cf.crossVectors(i,hl)),Cf.normalize(),q4.crossVectors(hl,Cf),r[0]=Cf.x,r[4]=q4.x,r[8]=hl.x,r[1]=Cf.y,r[5]=q4.y,r[9]=hl.y,r[2]=Cf.z,r[6]=q4.z,r[10]=hl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],h=i[5],p=i[9],m=i[13],y=i[2],b=i[6],w=i[10],v=i[14],T=i[3],S=i[7],M=i[11],P=i[15],R=r[0],O=r[4],B=r[8],N=r[12],I=r[1],F=r[5],j=r[9],W=r[13],U=r[2],H=r[6],q=r[10],J=r[14],G=r[3],ee=r[7],Q=r[11],ne=r[15];return s[0]=o*R+a*I+l*U+c*G,s[4]=o*O+a*F+l*H+c*ee,s[8]=o*B+a*j+l*q+c*Q,s[12]=o*N+a*W+l*J+c*ne,s[1]=u*R+h*I+p*U+m*G,s[5]=u*O+h*F+p*H+m*ee,s[9]=u*B+h*j+p*q+m*Q,s[13]=u*N+h*W+p*J+m*ne,s[2]=y*R+b*I+w*U+v*G,s[6]=y*O+b*F+w*H+v*ee,s[10]=y*B+b*j+w*q+v*Q,s[14]=y*N+b*W+w*J+v*ne,s[3]=T*R+S*I+M*U+P*G,s[7]=T*O+S*F+M*H+P*ee,s[11]=T*B+S*j+M*q+P*Q,s[15]=T*N+S*W+M*J+P*ne,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],p=e[10],m=e[14],y=e[3],b=e[7],w=e[11],v=e[15],T=l*m-c*p,S=a*m-c*h,M=a*p-l*h,P=o*m-c*u,R=o*p-l*u,O=o*h-a*u;return t*(b*T-w*S+v*M)-i*(y*T-w*P+v*R)+r*(y*S-b*P+v*O)-s*(y*M-b*R+w*O)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],m=e[11],y=e[12],b=e[13],w=e[14],v=e[15],T=h*w*c-b*p*c+b*l*m-a*w*m-h*l*v+a*p*v,S=y*p*c-u*w*c-y*l*m+o*w*m+u*l*v-o*p*v,M=u*b*c-y*h*c+y*a*m-o*b*m-u*a*v+o*h*v,P=y*h*l-u*b*l-y*a*p+o*b*p+u*a*w-o*h*w,R=t*T+i*S+r*M+s*P;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const O=1/R;return e[0]=T*O,e[1]=(b*p*s-h*w*s-b*r*m+i*w*m+h*r*v-i*p*v)*O,e[2]=(a*w*s-b*l*s+b*r*c-i*w*c-a*r*v+i*l*v)*O,e[3]=(h*l*s-a*p*s-h*r*c+i*p*c+a*r*m-i*l*m)*O,e[4]=S*O,e[5]=(u*w*s-y*p*s+y*r*m-t*w*m-u*r*v+t*p*v)*O,e[6]=(y*l*s-o*w*s-y*r*c+t*w*c+o*r*v-t*l*v)*O,e[7]=(o*p*s-u*l*s+u*r*c-t*p*c-o*r*m+t*l*m)*O,e[8]=M*O,e[9]=(y*h*s-u*b*s-y*i*m+t*b*m+u*i*v-t*h*v)*O,e[10]=(o*b*s-y*a*s+y*i*c-t*b*c-o*i*v+t*a*v)*O,e[11]=(u*a*s-o*h*s-u*i*c+t*h*c+o*i*m-t*a*m)*O,e[12]=P*O,e[13]=(u*b*r-y*h*r+y*i*p-t*b*p-u*i*w+t*h*w)*O,e[14]=(y*a*r-o*b*r-y*i*l+t*b*l+o*i*w-t*a*w)*O,e[15]=(o*h*r-u*a*r+u*i*l-t*h*l-o*i*p+t*a*p)*O,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,p=s*c,m=s*u,y=s*h,b=o*u,w=o*h,v=a*h,T=l*c,S=l*u,M=l*h,P=i.x,R=i.y,O=i.z;return r[0]=(1-(b+v))*P,r[1]=(m+M)*P,r[2]=(y-S)*P,r[3]=0,r[4]=(m-M)*R,r[5]=(1-(p+v))*R,r[6]=(w+T)*R,r[7]=0,r[8]=(y+S)*O,r[9]=(w-T)*O,r[10]=(1-(p+b))*O,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;if(e.x=r[12],e.y=r[13],e.z=r[14],this.determinant()===0)return i.set(1,1,1),t.identity(),this;let s=ug.set(r[0],r[1],r[2]).length();const o=ug.set(r[4],r[5],r[6]).length(),a=ug.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),Dc.copy(this);const c=1/s,u=1/o,h=1/a;return Dc.elements[0]*=c,Dc.elements[1]*=c,Dc.elements[2]*=c,Dc.elements[4]*=u,Dc.elements[5]*=u,Dc.elements[6]*=u,Dc.elements[8]*=h,Dc.elements[9]*=h,Dc.elements[10]*=h,t.setFromRotationMatrix(Dc),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=Sl,l=!1){const c=this.elements,u=2*s/(t-e),h=2*s/(i-r),p=(t+e)/(t-e),m=(i+r)/(i-r);let y,b;if(l)y=s/(o-s),b=o*s/(o-s);else if(a===Sl)y=-(o+s)/(o-s),b=-2*o*s/(o-s);else if(a===K2)y=-o/(o-s),b=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=p,c[12]=0,c[1]=0,c[5]=h,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=y,c[14]=b,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=Sl,l=!1){const c=this.elements,u=2/(t-e),h=2/(i-r),p=-(t+e)/(t-e),m=-(i+r)/(i-r);let y,b;if(l)y=1/(o-s),b=o/(o-s);else if(a===Sl)y=-2/(o-s),b=-(o+s)/(o-s);else if(a===K2)y=-1/(o-s),b=-s/(o-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=0,c[12]=p,c[1]=0,c[5]=h,c[9]=0,c[13]=m,c[2]=0,c[6]=0,c[10]=y,c[14]=b,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const ug=new ye,Dc=new Hn,BMe=new ye(0,0,0),UMe=new ye(1,1,1),Cf=new ye,q4=new ye,hl=new ye,IV=new Hn,NV=new Uo;let fu=class Ane{constructor(e=0,t=0,i=0,r=Ane.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],p=r[6],m=r[10];switch(t){case"XYZ":this._y=Math.asin(Bn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Bn(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Bn(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Bn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Bn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-Bn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,m),this._y=0);break;default:Wt("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return IV.makeRotationFromQuaternion(e),this.setFromRotationMatrix(IV,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return NV.setFromEuler(this),this.setFromQuaternion(NV,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};fu.DEFAULT_ORDER="XYZ";let Dm=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},FMe=0;const PV=new ye,hg=new Uo,jh=new Hn,Z4=new ye,_v=new ye,zMe=new ye,jMe=new Uo,kV=new ye(1,0,0),LV=new ye(0,1,0),DV=new ye(0,0,1),OV={type:"added"},VMe={type:"removed"},dg={type:"childadded",child:null},NC={type:"childremoved",child:null};let Qi=class zS extends xh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:FMe++}),this.uuid=Tl(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zS.DEFAULT_UP.clone();const e=new ye,t=new fu,i=new Uo,r=new ye(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Hn},normalMatrix:{value:new ti}}),this.matrix=new Hn,this.matrixWorld=new Hn,this.matrixAutoUpdate=zS.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=zS.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Dm,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return hg.setFromAxisAngle(e,t),this.quaternion.multiply(hg),this}rotateOnWorldAxis(e,t){return hg.setFromAxisAngle(e,t),this.quaternion.premultiply(hg),this}rotateX(e){return this.rotateOnAxis(kV,e)}rotateY(e){return this.rotateOnAxis(LV,e)}rotateZ(e){return this.rotateOnAxis(DV,e)}translateOnAxis(e,t){return PV.copy(e).applyQuaternion(this.quaternion),this.position.add(PV.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(kV,e)}translateY(e){return this.translateOnAxis(LV,e)}translateZ(e){return this.translateOnAxis(DV,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(jh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Z4.copy(e):Z4.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),_v.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?jh.lookAt(_v,Z4,this.up):jh.lookAt(Z4,_v,this.up),this.quaternion.setFromRotationMatrix(jh),r&&(jh.extractRotation(r.matrixWorld),hg.setFromRotationMatrix(jh),this.quaternion.premultiply(hg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(xn("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(OV),dg.child=e,this.dispatchEvent(dg),dg.child=null):xn("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(VMe),NC.child=e,this.dispatchEvent(NC),NC.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),jh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),jh.multiply(e.parent.matrixWorld)),e.applyMatrix4(jh),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(OV),dg.child=e,this.dispatchEvent(dg),dg.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_v,e,zMe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_v,jMe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),r.instanceInfo=this._instanceInfo.map(a=>({...a})),r.availableInstanceIds=this._availableInstanceIds.slice(),r.availableGeometryIds=this._availableGeometryIds.slice(),r.nextIndexStart=this._nextIndexStart,r.nextVertexStart=this._nextVertexStart,r.geometryCount=this._geometryCount,r.maxInstanceCount=this._maxInstanceCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.matricesTexture=this._matricesTexture.toJSON(e),r.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(r.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(r.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(r.boundingBox=this.boundingBox.toJSON()));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),p=o(e.skeletons),m=o(e.animations),y=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),h.length>0&&(i.shapes=h),p.length>0&&(i.skeletons=p),m.length>0&&(i.animations=m),y.length>0&&(i.nodes=y)}return i.object=r,i;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}};Qi.DEFAULT_UP=new ye(0,1,0);Qi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Qi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Oc=new ye,Vh=new ye,PC=new ye,Hh=new ye,fg=new ye,pg=new ye,BV=new ye,kC=new ye,LC=new ye,DC=new ye,OC=new fr,BC=new fr,UC=new fr;class Ua{constructor(e=new ye,t=new ye,i=new ye){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Oc.subVectors(e,t),r.cross(Oc);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){Oc.subVectors(r,t),Vh.subVectors(i,t),PC.subVectors(e,t);const o=Oc.dot(Oc),a=Oc.dot(Vh),l=Oc.dot(PC),c=Vh.dot(Vh),u=Vh.dot(PC),h=o*c-a*a;if(h===0)return s.set(0,0,0),null;const p=1/h,m=(c*l-a*u)*p,y=(o*u-a*l)*p;return s.set(1-m-y,y,m)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,Hh)===null?!1:Hh.x>=0&&Hh.y>=0&&Hh.x+Hh.y<=1}static getInterpolation(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,Hh)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(s,Hh.x),l.addScaledVector(o,Hh.y),l.addScaledVector(a,Hh.z),l)}static getInterpolatedAttribute(e,t,i,r,s,o){return OC.setScalar(0),BC.setScalar(0),UC.setScalar(0),OC.fromBufferAttribute(e,t),BC.fromBufferAttribute(e,i),UC.fromBufferAttribute(e,r),o.setScalar(0),o.addScaledVector(OC,s.x),o.addScaledVector(BC,s.y),o.addScaledVector(UC,s.z),o}static isFrontFacing(e,t,i,r){return Oc.subVectors(i,t),Vh.subVectors(e,t),Oc.cross(Vh).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Oc.subVectors(this.c,this.b),Vh.subVectors(this.a,this.b),Oc.cross(Vh).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ua.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ua.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,s){return Ua.getInterpolation(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return Ua.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ua.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;fg.subVectors(r,i),pg.subVectors(s,i),kC.subVectors(e,i);const l=fg.dot(kC),c=pg.dot(kC);if(l<=0&&c<=0)return t.copy(i);LC.subVectors(e,r);const u=fg.dot(LC),h=pg.dot(LC);if(u>=0&&h<=u)return t.copy(r);const p=l*h-u*c;if(p<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(fg,o);DC.subVectors(e,s);const m=fg.dot(DC),y=pg.dot(DC);if(y>=0&&m<=y)return t.copy(s);const b=m*c-l*y;if(b<=0&&c>=0&&y<=0)return a=c/(c-y),t.copy(i).addScaledVector(pg,a);const w=u*y-m*h;if(w<=0&&h-u>=0&&m-y>=0)return BV.subVectors(s,r),a=(h-u)/(h-u+(m-y)),t.copy(r).addScaledVector(BV,a);const v=1/(w+b+p);return o=b*v,a=p*v,t.copy(i).addScaledVector(fg,o).addScaledVector(pg,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const Cne={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Mf={h:0,s:0,l:0},Y4={h:0,s:0,l:0};function FC(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let an=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ka){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,xi.colorSpaceToWorking(this,t),this}setRGB(e,t,i,r=xi.workingColorSpace){return this.r=e,this.g=t,this.b=i,xi.colorSpaceToWorking(this,r),this}setHSL(e,t,i,r=xi.workingColorSpace){if(e=BD(e,1),t=Bn(t,0,1),i=Bn(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=FC(o,s,e+1/3),this.g=FC(o,s,e),this.b=FC(o,s,e-1/3)}return xi.colorSpaceToWorking(this,r),this}setStyle(e,t=ka){function i(s){s!==void 0&&parseFloat(s)<1&&Wt("Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Wt("Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);Wt("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ka){const i=Cne[e.toLowerCase()];return i!==void 0?this.setHex(i,t):Wt("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ad(e.r),this.g=Ad(e.g),this.b=Ad(e.b),this}copyLinearToSRGB(e){return this.r=Ly(e.r),this.g=Ly(e.g),this.b=Ly(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ka){return xi.workingToColorSpace(bo.copy(this),e),Math.round(Bn(bo.r*255,0,255))*65536+Math.round(Bn(bo.g*255,0,255))*256+Math.round(Bn(bo.b*255,0,255))}getHexString(e=ka){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=xi.workingColorSpace){xi.workingToColorSpace(bo.copy(this),t);const i=bo.r,r=bo.g,s=bo.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=xi.workingColorSpace){return xi.workingToColorSpace(bo.copy(this),t),e.r=bo.r,e.g=bo.g,e.b=bo.b,e}getStyle(e=ka){xi.workingToColorSpace(bo.copy(this),e);const t=bo.r,i=bo.g,r=bo.b;return e!==ka?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Mf),this.setHSL(Mf.h+e,Mf.s+t,Mf.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Mf),e.getHSL(Y4);const i=k3(Mf.h,Y4.h,t),r=k3(Mf.s,Y4.s,t),s=k3(Mf.l,Y4.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const bo=new an;an.NAMES=Cne;let HMe=0,Go=class extends xh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:HMe++}),this.uuid=Tl(),this.name="",this.type="Material",this.blending=km,this.side=Dd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=I8,this.blendDst=N8,this.blendEquation=$f,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new an(0,0,0),this.blendAlpha=0,this.depthFunc=t1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=LN,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Kp,this.stencilZFail=Kp,this.stencilZPass=Kp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){Wt(`Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){Wt(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==km&&(i.blending=this.blending),this.side!==Dd&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==I8&&(i.blendSrc=this.blendSrc),this.blendDst!==N8&&(i.blendDst=this.blendDst),this.blendEquation!==$f&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==t1&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==LN&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Kp&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Kp&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Kp&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.allowOverride===!1&&(i.allowOverride=!1),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};class q0 extends Go{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new an(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fu,this.combine=$_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const dd=$Me();function $Me(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),i=new Uint32Array(512),r=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(i[l]=0,i[l|256]=32768,r[l]=24,r[l|256]=24):c<-14?(i[l]=1024>>-c-14,i[l|256]=1024>>-c-14|32768,r[l]=-c-1,r[l|256]=-c-1):c<=15?(i[l]=c+15<<10,i[l|256]=c+15<<10|32768,r[l]=13,r[l|256]=13):c<128?(i[l]=31744,i[l|256]=64512,r[l]=24,r[l|256]=24):(i[l]=31744,i[l|256]=64512,r[l]=13,r[l|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,s[l]=c|u}for(let l=1024;l<2048;++l)s[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:i,shiftTable:r,mantissaTable:s,exponentTable:o,offsetTable:a}}function Ca(n){Math.abs(n)>65504&&Wt("DataUtils.toHalfFloat(): Value out of range."),n=Bn(n,-65504,65504),dd.floatView[0]=n;const e=dd.uint32View[0],t=e>>23&511;return dd.baseTable[t]+((e&8388607)>>dd.shiftTable[t])}function a3(n){const e=n>>10;return dd.uint32View[0]=dd.mantissaTable[dd.offsetTable[e]+(n&1023)]+dd.exponentTable[e],dd.floatView[0]}class GMe{static toHalfFloat(e){return Ca(e)}static fromHalfFloat(e){return a3(e)}}const as=new ye,X4=new Et;let WMe=0,lr=class{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:WMe++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Ob,this.updateRanges=[],this.gpuType=Do,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)X4.fromBufferAttribute(this,t),X4.applyMatrix3(e),this.setXY(t,X4.x,X4.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)as.fromBufferAttribute(this,t),as.applyMatrix3(e),this.setXYZ(t,as.x,as.y,as.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)as.fromBufferAttribute(this,t),as.applyMatrix4(e),this.setXYZ(t,as.x,as.y,as.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)as.fromBufferAttribute(this,t),as.applyNormalMatrix(e),this.setXYZ(t,as.x,as.y,as.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)as.fromBufferAttribute(this,t),as.transformDirection(e),this.setXYZ(t,as.x,as.y,as.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=ua(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Yn(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ua(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ua(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ua(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ua(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array),s=Yn(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Ob&&(e.usage=this.usage),e}};class KMe extends lr{constructor(e,t,i){super(new Int8Array(e),t,i)}}class qMe extends lr{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class ZMe extends lr{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class YMe extends lr{constructor(e,t,i){super(new Int16Array(e),t,i)}}let FD=class extends lr{constructor(e,t,i){super(new Uint16Array(e),t,i)}};class XMe extends lr{constructor(e,t,i){super(new Int32Array(e),t,i)}}let zD=class extends lr{constructor(e,t,i){super(new Uint32Array(e),t,i)}};class QMe extends lr{constructor(e,t,i){super(new Uint16Array(e),t,i),this.isFloat16BufferAttribute=!0}getX(e){let t=a3(this.array[e*this.itemSize]);return this.normalized&&(t=ua(t,this.array)),t}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize]=Ca(t),this}getY(e){let t=a3(this.array[e*this.itemSize+1]);return this.normalized&&(t=ua(t,this.array)),t}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+1]=Ca(t),this}getZ(e){let t=a3(this.array[e*this.itemSize+2]);return this.normalized&&(t=ua(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+2]=Ca(t),this}getW(e){let t=a3(this.array[e*this.itemSize+3]);return this.normalized&&(t=ua(t,this.array)),t}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.array[e*this.itemSize+3]=Ca(t),this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array)),this.array[e+0]=Ca(t),this.array[e+1]=Ca(i),this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array)),this.array[e+0]=Ca(t),this.array[e+1]=Ca(i),this.array[e+2]=Ca(r),this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array),s=Yn(s,this.array)),this.array[e+0]=Ca(t),this.array[e+1]=Ca(i),this.array[e+2]=Ca(r),this.array[e+3]=Ca(s),this}}let un=class extends lr{constructor(e,t,i){super(new Float32Array(e),t,i)}},JMe=0;const $l=new Hn,zC=new Qi,mg=new ye,dl=new Fo,wv=new Fo,Ds=new ye;let Jn=class Mne extends xh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:JMe++}),this.uuid=Tl(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(vne(e)?zD:FD)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new ti().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return $l.makeRotationFromQuaternion(e),this.applyMatrix4($l),this}rotateX(e){return $l.makeRotationX(e),this.applyMatrix4($l),this}rotateY(e){return $l.makeRotationY(e),this.applyMatrix4($l),this}rotateZ(e){return $l.makeRotationZ(e),this.applyMatrix4($l),this}translate(e,t,i){return $l.makeTranslation(e,t,i),this.applyMatrix4($l),this}scale(e,t,i){return $l.makeScale(e,t,i),this.applyMatrix4($l),this}lookAt(e){return zC.lookAt(e),zC.updateMatrix(),this.applyMatrix4(zC.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(mg).negate(),this.translate(mg.x,mg.y,mg.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const i=[];for(let r=0,s=e.length;r<s;r++){const o=e[r];i.push(o.x,o.y,o.z||0)}this.setAttribute("position",new un(i,3))}else{const i=Math.min(e.length,t.count);for(let r=0;r<i;r++){const s=e[r];t.setXYZ(r,s.x,s.y,s.z||0)}e.length>t.count&&Wt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){xn("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ye(-1/0,-1/0,-1/0),new ye(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];dl.setFromBufferAttribute(s),this.morphTargetsRelative?(Ds.addVectors(this.boundingBox.min,dl.min),this.boundingBox.expandByPoint(Ds),Ds.addVectors(this.boundingBox.max,dl.max),this.boundingBox.expandByPoint(Ds)):(this.boundingBox.expandByPoint(dl.min),this.boundingBox.expandByPoint(dl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&xn('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ro);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){xn("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ye,1/0);return}if(e){const i=this.boundingSphere.center;if(dl.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];wv.setFromBufferAttribute(a),this.morphTargetsRelative?(Ds.addVectors(dl.min,wv.min),dl.expandByPoint(Ds),Ds.addVectors(dl.max,wv.max),dl.expandByPoint(Ds)):(dl.expandByPoint(wv.min),dl.expandByPoint(wv.max))}dl.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Ds.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Ds));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Ds.fromBufferAttribute(a,c),l&&(mg.fromBufferAttribute(e,c),Ds.add(mg)),r=Math.max(r,i.distanceToSquared(Ds))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&xn('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){xn("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new lr(new Float32Array(4*i.count),4));const o=this.getAttribute("tangent"),a=[],l=[];for(let B=0;B<i.count;B++)a[B]=new ye,l[B]=new ye;const c=new ye,u=new ye,h=new ye,p=new Et,m=new Et,y=new Et,b=new ye,w=new ye;function v(B,N,I){c.fromBufferAttribute(i,B),u.fromBufferAttribute(i,N),h.fromBufferAttribute(i,I),p.fromBufferAttribute(s,B),m.fromBufferAttribute(s,N),y.fromBufferAttribute(s,I),u.sub(c),h.sub(c),m.sub(p),y.sub(p);const F=1/(m.x*y.y-y.x*m.y);isFinite(F)&&(b.copy(u).multiplyScalar(y.y).addScaledVector(h,-m.y).multiplyScalar(F),w.copy(h).multiplyScalar(m.x).addScaledVector(u,-y.x).multiplyScalar(F),a[B].add(b),a[N].add(b),a[I].add(b),l[B].add(w),l[N].add(w),l[I].add(w))}let T=this.groups;T.length===0&&(T=[{start:0,count:e.count}]);for(let B=0,N=T.length;B<N;++B){const I=T[B],F=I.start,j=I.count;for(let W=F,U=F+j;W<U;W+=3)v(e.getX(W+0),e.getX(W+1),e.getX(W+2))}const S=new ye,M=new ye,P=new ye,R=new ye;function O(B){P.fromBufferAttribute(r,B),R.copy(P);const N=a[B];S.copy(N),S.sub(P.multiplyScalar(P.dot(N))).normalize(),M.crossVectors(R,N);const F=M.dot(l[B])<0?-1:1;o.setXYZW(B,S.x,S.y,S.z,F)}for(let B=0,N=T.length;B<N;++B){const I=T[B],F=I.start,j=I.count;for(let W=F,U=F+j;W<U;W+=3)O(e.getX(W+0)),O(e.getX(W+1)),O(e.getX(W+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new lr(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let p=0,m=i.count;p<m;p++)i.setXYZ(p,0,0,0);const r=new ye,s=new ye,o=new ye,a=new ye,l=new ye,c=new ye,u=new ye,h=new ye;if(e)for(let p=0,m=e.count;p<m;p+=3){const y=e.getX(p+0),b=e.getX(p+1),w=e.getX(p+2);r.fromBufferAttribute(t,y),s.fromBufferAttribute(t,b),o.fromBufferAttribute(t,w),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(i,y),l.fromBufferAttribute(i,b),c.fromBufferAttribute(i,w),a.add(u),l.add(u),c.add(u),i.setXYZ(y,a.x,a.y,a.z),i.setXYZ(b,l.x,l.y,l.z),i.setXYZ(w,c.x,c.y,c.z)}else for(let p=0,m=t.count;p<m;p+=3)r.fromBufferAttribute(t,p+0),s.fromBufferAttribute(t,p+1),o.fromBufferAttribute(t,p+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),i.setXYZ(p+0,u.x,u.y,u.z),i.setXYZ(p+1,u.x,u.y,u.z),i.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Ds.fromBufferAttribute(e,t),Ds.normalize(),e.setXYZ(t,Ds.x,Ds.y,Ds.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,p=new c.constructor(l.length*u);let m=0,y=0;for(let b=0,w=l.length;b<w;b++){a.isInterleavedBufferAttribute?m=l[b]*a.data.stride+a.offset:m=l[b]*u;for(let v=0;v<u;v++)p[y++]=c[m++]}return new lr(p,u,h)}if(this.index===null)return Wt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Mne,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const p=c[u],m=e(p,i);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,p=c.length;h<p;h++){const m=c[h];u.push(m.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere=a.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone());const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let p=0,m=h.length;p<m;p++)u.push(h[p].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const UV=new Hn,Ap=new E1,Q4=new ro,FV=new ye,J4=new ye,e5=new ye,t5=new ye,jC=new ye,n5=new ye,zV=new ye,i5=new ye;class xs extends Qi{constructor(e=new Jn,t=new q0){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,s=i.morphAttributes.position,o=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const a=this.morphTargetInfluences;if(s&&a){n5.set(0,0,0);for(let l=0,c=s.length;l<c;l++){const u=a[l],h=s[l];u!==0&&(jC.fromBufferAttribute(h,e),o?n5.addScaledVector(jC,u):n5.addScaledVector(jC.sub(t),u))}t.add(n5)}return t}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Q4.copy(i.boundingSphere),Q4.applyMatrix4(s),Ap.copy(e.ray).recast(e.near),!(Q4.containsPoint(Ap.origin)===!1&&(Ap.intersectSphere(Q4,FV)===null||Ap.origin.distanceToSquared(FV)>(e.far-e.near)**2))&&(UV.copy(s).invert(),Ap.copy(e.ray).applyMatrix4(UV),!(i.boundingBox!==null&&Ap.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Ap)))}_computeIntersections(e,t,i){let r;const s=this.geometry,o=this.material,a=s.index,l=s.attributes.position,c=s.attributes.uv,u=s.attributes.uv1,h=s.attributes.normal,p=s.groups,m=s.drawRange;if(a!==null)if(Array.isArray(o))for(let y=0,b=p.length;y<b;y++){const w=p[y],v=o[w.materialIndex],T=Math.max(w.start,m.start),S=Math.min(a.count,Math.min(w.start+w.count,m.start+m.count));for(let M=T,P=S;M<P;M+=3){const R=a.getX(M),O=a.getX(M+1),B=a.getX(M+2);r=r5(this,v,e,i,c,u,h,R,O,B),r&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=w.materialIndex,t.push(r))}}else{const y=Math.max(0,m.start),b=Math.min(a.count,m.start+m.count);for(let w=y,v=b;w<v;w+=3){const T=a.getX(w),S=a.getX(w+1),M=a.getX(w+2);r=r5(this,o,e,i,c,u,h,T,S,M),r&&(r.faceIndex=Math.floor(w/3),t.push(r))}}else if(l!==void 0)if(Array.isArray(o))for(let y=0,b=p.length;y<b;y++){const w=p[y],v=o[w.materialIndex],T=Math.max(w.start,m.start),S=Math.min(l.count,Math.min(w.start+w.count,m.start+m.count));for(let M=T,P=S;M<P;M+=3){const R=M,O=M+1,B=M+2;r=r5(this,v,e,i,c,u,h,R,O,B),r&&(r.faceIndex=Math.floor(M/3),r.face.materialIndex=w.materialIndex,t.push(r))}}else{const y=Math.max(0,m.start),b=Math.min(l.count,m.start+m.count);for(let w=y,v=b;w<v;w+=3){const T=w,S=w+1,M=w+2;r=r5(this,o,e,i,c,u,h,T,S,M),r&&(r.faceIndex=Math.floor(w/3),t.push(r))}}}}function eRe(n,e,t,i,r,s,o,a){let l;if(e.side===fa?l=i.intersectTriangle(o,s,r,!0,a):l=i.intersectTriangle(r,s,o,e.side===Dd,a),l===null)return null;i5.copy(a),i5.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(i5);return c<t.near||c>t.far?null:{distance:c,point:i5.clone(),object:n}}function r5(n,e,t,i,r,s,o,a,l,c){n.getVertexPosition(a,J4),n.getVertexPosition(l,e5),n.getVertexPosition(c,t5);const u=eRe(n,e,t,i,J4,e5,t5,zV);if(u){const h=new ye;Ua.getBarycoord(zV,J4,e5,t5,h),r&&(u.uv=Ua.getInterpolatedAttribute(r,a,l,c,h,new Et)),s&&(u.uv1=Ua.getInterpolatedAttribute(s,a,l,c,h,new Et)),o&&(u.normal=Ua.getInterpolatedAttribute(o,a,l,c,h,new ye),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const p={a,b:l,c,normal:new ye,materialIndex:0};Ua.getNormal(J4,e5,t5,p.normal),u.face=p,u.barycoord=h}return u}class T1 extends Jn{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],h=[];let p=0,m=0;y("z","y","x",-1,-1,i,t,e,o,s,0),y("z","y","x",1,-1,i,t,-e,o,s,1),y("x","z","y",1,1,e,i,t,r,o,2),y("x","z","y",1,-1,e,i,-t,r,o,3),y("x","y","z",1,-1,e,t,i,r,s,4),y("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new un(c,3)),this.setAttribute("normal",new un(u,3)),this.setAttribute("uv",new un(h,2));function y(b,w,v,T,S,M,P,R,O,B,N){const I=M/O,F=P/B,j=M/2,W=P/2,U=R/2,H=O+1,q=B+1;let J=0,G=0;const ee=new ye;for(let Q=0;Q<q;Q++){const ne=Q*F-W;for(let fe=0;fe<H;fe++){const Ae=fe*I-j;ee[b]=Ae*T,ee[w]=ne*S,ee[v]=U,c.push(ee.x,ee.y,ee.z),ee[b]=0,ee[w]=0,ee[v]=R>0?1:-1,u.push(ee.x,ee.y,ee.z),h.push(fe/O),h.push(1-Q/B),J+=1}}for(let Q=0;Q<B;Q++)for(let ne=0;ne<O;ne++){const fe=p+ne+H*Q,Ae=p+ne+H*(Q+1),Pe=p+(ne+1)+H*(Q+1),Ce=p+(ne+1)+H*Q;l.push(fe,Ae,Ce),l.push(Ae,Pe,Ce),G+=6}a.addGroup(m,G,N),m+=G,p+=J}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new T1(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Y2(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(Wt("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function ta(n){const e={};for(let t=0;t<n.length;t++){const i=Y2(n[t]);for(const r in i)e[r]=i[r]}return e}function tRe(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function Rne(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:xi.workingColorSpace}const Ine={clone:Y2,merge:ta};var nRe=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,iRe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;let _c=class extends Go{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=nRe,this.fragmentShader=iRe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Y2(e.uniforms),this.uniformsGroups=tRe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}};class W_ extends Qi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Hn,this.projectionMatrix=new Hn,this.projectionMatrixInverse=new Hn,this.coordinateSystem=Sl,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Rf=new ye,jV=new Et,VV=new Et;let ns=class extends W_{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Z2*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Lm*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Z2*2*Math.atan(Math.tan(Lm*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Rf.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Rf.x,Rf.y).multiplyScalar(-e/Rf.z),Rf.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Rf.x,Rf.y).multiplyScalar(-e/Rf.z)}getViewSize(e,t){return this.getViewBounds(e,jV,VV),t.subVectors(VV,jV)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Lm*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;a!==0&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const gg=-90,yg=1;class Nne extends Qi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new ns(gg,yg,e,t);r.layers=this.layers,this.add(r);const s=new ns(gg,yg,e,t);s.layers=this.layers,this.add(s);const o=new ns(gg,yg,e,t);o.layers=this.layers,this.add(o);const a=new ns(gg,yg,e,t);a.layers=this.layers,this.add(a);const l=new ns(gg,yg,e,t);l.layers=this.layers,this.add(l);const c=new ns(gg,yg,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,s,o,a,l]=t;for(const c of t)this.remove(c);if(e===Sl)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===K2)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,a,l,c,u]=this.children,h=e.getRenderTarget(),p=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const b=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,s),e.setRenderTarget(i,1,r),e.render(t,o),e.setRenderTarget(i,2,r),e.render(t,a),e.setRenderTarget(i,3,r),e.render(t,l),e.setRenderTarget(i,4,r),e.render(t,c),i.texture.generateMipmaps=b,e.setRenderTarget(i,5,r),e.render(t,u),e.setRenderTarget(h,p,m),e.xr.enabled=y,i.texture.needsPMREMUpdate=!0}}class K_ extends Gs{constructor(e=[],t=fh,i,r,s,o,a,l,c,u){super(e,t,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class jD extends Xa{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new K_(r),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new T1(5,5,5),s=new _c({name:"CubemapFromEquirect",uniforms:Y2(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:fa,blending:ah});s.uniforms.tEquirect.value=t;const o=new xs(r,s),a=t.minFilter;return t.minFilter===th&&(t.minFilter=mr),new Nne(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,i=!0,r=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}class fy extends Qi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const rRe={type:"move"};class jS{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new fy,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new fy,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ye,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ye),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new fy,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ye,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ye),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){o=!0;for(const b of e.hand.values()){const w=t.getJointPose(b,i),v=this._getHandJoint(c,b);w!==null&&(v.matrix.fromArray(w.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=w.radius),v.visible=w!==null}const u=c.joints["index-finger-tip"],h=c.joints["thumb-tip"],p=u.position.distanceTo(h.position),m=.02,y=.005;c.inputState.pinching&&p>m+y?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&p<=m-y&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&s!==null&&(r=s),r!==null&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(rRe)))}return a!==null&&(a.visible=r!==null),l!==null&&(l.visible=s!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new fy;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class D9{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new an(e),this.density=t}clone(){return new D9(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class O9{constructor(e,t=1,i=1e3){this.isFog=!0,this.name="",this.color=new an(e),this.near=t,this.far=i}clone(){return new O9(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class VD extends Qi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new fu,this.environmentIntensity=1,this.environmentRotation=new fu,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class B9{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Ob,this.updateRanges=[],this.version=0,this.uuid=Tl()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let r=0,s=this.stride;r<s;r++)this.array[e+r]=t.array[i+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Tl()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ea=new ye;class r1{constructor(e,t,i,r=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)ea.fromBufferAttribute(this,t),ea.applyMatrix4(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ea.fromBufferAttribute(this,t),ea.applyNormalMatrix(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ea.fromBufferAttribute(this,t),ea.transformDirection(e),this.setXYZ(t,ea.x,ea.y,ea.z);return this}getComponent(e,t){let i=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(i=ua(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Yn(i,this.array)),this.data.array[e*this.data.stride+this.offset+t]=i,this}setX(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ua(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ua(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ua(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ua(t,this.array)),t}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,r){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Yn(t,this.array),i=Yn(i,this.array),r=Yn(r,this.array),s=Yn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=s,this}clone(e){if(e===void 0){Ub("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return new lr(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new r1(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){Ub("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const r=i*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[r+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class HD extends Go{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new an(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let xg;const Sv=new ye,vg=new ye,bg=new ye,_g=new Et,Ev=new Et,Pne=new Hn,s5=new ye,Tv=new ye,o5=new ye,HV=new Et,VC=new Et,$V=new Et;class kne extends Qi{constructor(e=new HD){if(super(),this.isSprite=!0,this.type="Sprite",xg===void 0){xg=new Jn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new B9(t,5);xg.setIndex([0,1,2,0,2,3]),xg.setAttribute("position",new r1(i,3,0,!1)),xg.setAttribute("uv",new r1(i,2,3,!1))}this.geometry=xg,this.material=e,this.center=new Et(.5,.5),this.count=1}raycast(e,t){e.camera===null&&xn('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),vg.setFromMatrixScale(this.matrixWorld),Pne.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),bg.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&vg.multiplyScalar(-bg.z);const i=this.material.rotation;let r,s;i!==0&&(s=Math.cos(i),r=Math.sin(i));const o=this.center;a5(s5.set(-.5,-.5,0),bg,o,vg,r,s),a5(Tv.set(.5,-.5,0),bg,o,vg,r,s),a5(o5.set(.5,.5,0),bg,o,vg,r,s),HV.set(0,0),VC.set(1,0),$V.set(1,1);let a=e.ray.intersectTriangle(s5,Tv,o5,!1,Sv);if(a===null&&(a5(Tv.set(-.5,.5,0),bg,o,vg,r,s),VC.set(0,1),a=e.ray.intersectTriangle(s5,o5,Tv,!1,Sv),a===null))return;const l=e.ray.origin.distanceTo(Sv);l<e.near||l>e.far||t.push({distance:l,point:Sv.clone(),uv:Ua.getInterpolation(Sv,s5,Tv,o5,HV,VC,$V,new Et),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function a5(n,e,t,i,r,s){_g.subVectors(n,t).addScalar(.5).multiply(i),r!==void 0?(Ev.x=s*_g.x-r*_g.y,Ev.y=r*_g.x+s*_g.y):Ev.copy(_g),n.copy(e),n.x+=Ev.x,n.y+=Ev.y,n.applyMatrix4(Pne)}const l5=new ye,GV=new ye;class Lne extends Qi{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let i=0,r=t.length;i<r;i++){const s=t[i];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,i=0){t=Math.abs(t);const r=this.levels;let s;for(s=0;s<r.length&&!(t<r[s].distance);s++);return r.splice(s,0,{distance:t,hysteresis:i,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let i=0;i<t.length;i++)if(t[i].distance===e){const r=t.splice(i,1);return this.remove(r[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,r;for(i=1,r=t.length;i<r;i++){let s=t[i].distance;if(t[i].object.visible&&(s-=s*t[i].hysteresis),e<s)break}return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){l5.setFromMatrixPosition(this.matrixWorld);const r=e.ray.origin.distanceTo(l5);this.getObjectForDistance(r).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){l5.setFromMatrixPosition(e.matrixWorld),GV.setFromMatrixPosition(this.matrixWorld);const i=l5.distanceTo(GV)/e.zoom;t[0].object.visible=!0;let r,s;for(r=1,s=t.length;r<s;r++){let o=t[r].distance;if(t[r].object.visible&&(o-=o*t[r].hysteresis),i>=o)t[r-1].object.visible=!1,t[r].object.visible=!0;else break}for(this._currentLevel=r-1;r<s;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let r=0,s=i.length;r<s;r++){const o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const WV=new ye,KV=new fr,qV=new fr,sRe=new ye,ZV=new Hn,c5=new ye,HC=new ro,YV=new Hn,$C=new E1;class Dne extends xs{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=kN,this.bindMatrix=new Hn,this.bindMatrixInverse=new Hn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Fo),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,c5),this.boundingBox.expandByPoint(c5)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new ro),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let i=0;i<t.count;i++)this.getVertexPosition(i,c5),this.boundingSphere.expandByPoint(c5)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const i=this.material,r=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),HC.copy(this.boundingSphere),HC.applyMatrix4(r),e.ray.intersectsSphere(HC)!==!1&&(YV.copy(r).invert(),$C.copy(e.ray).applyMatrix4(YV),!(this.boundingBox!==null&&$C.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,$C)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new fr,t=this.geometry.attributes.skinWeight;for(let i=0,r=t.count;i<r;i++){e.fromBufferAttribute(t,i);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===kN?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===ane?this.bindMatrixInverse.copy(this.bindMatrix).invert():Wt("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const i=this.skeleton,r=this.geometry;KV.fromBufferAttribute(r.attributes.skinIndex,e),qV.fromBufferAttribute(r.attributes.skinWeight,e),WV.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=qV.getComponent(s);if(o!==0){const a=KV.getComponent(s);ZV.multiplyMatrices(i.bones[a].matrixWorld,i.boneInverses[a]),t.addScaledVector(sRe.copy(WV).applyMatrix4(ZV),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class $D extends Qi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class cu extends Gs{constructor(e=null,t=1,i=1,r,s,o,a,l,c=is,u=is,h,p){super(null,o,a,l,c,u,r,s,h,p),this.isDataTexture=!0,this.image={data:e,width:t,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const XV=new Hn,oRe=new Hn;class U9{constructor(e=[],t=[]){this.uuid=Tl(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){Wt("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new Hn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const i=new Hn;this.bones[e]&&i.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&i.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const i=this.bones[e];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const a=e[s]?e[s].matrixWorld:oRe;XV.multiplyMatrices(a,t[s]),XV.toArray(i,s*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new U9(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new cu(t,e,e,Oo,Do);return i.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=i,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const r=this.bones[t];if(r.name===e)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,r=e.bones.length;i<r;i++){const s=e.bones[i];let o=t[s];o===void 0&&(Wt("Skeleton: No bone found with UUID:",s),o=new $D),this.bones.push(o),this.boneInverses.push(new Hn().fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let r=0,s=t.length;r<s;r++){const o=t[r];e.bones.push(o.uuid);const a=i[r];e.boneInverses.push(a.toArray())}return e}}class X2 extends lr{constructor(e,t,i,r=1){super(e,t,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const wg=new Hn,QV=new Hn,u5=[],JV=new Fo,aRe=new Hn,Av=new xs,Cv=new ro;class One extends xs{constructor(e,t,i){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new X2(new Float32Array(i*16),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let r=0;r<i;r++)this.setMatrixAt(r,aRe)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Fo),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wg),JV.copy(e.boundingBox).applyMatrix4(wg),this.boundingBox.union(JV)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new ro),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<t;i++)this.getMatrixAt(i,wg),Cv.copy(e.boundingSphere).applyMatrix4(wg),this.boundingSphere.union(Cv)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const i=t.morphTargetInfluences,r=this.morphTexture.source.data.data,s=i.length+1,o=e*s+1;for(let a=0;a<i.length;a++)i[a]=r[o+a]}raycast(e,t){const i=this.matrixWorld,r=this.count;if(Av.geometry=this.geometry,Av.material=this.material,Av.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Cv.copy(this.boundingSphere),Cv.applyMatrix4(i),e.ray.intersectsSphere(Cv)!==!1))for(let s=0;s<r;s++){this.getMatrixAt(s,wg),QV.multiplyMatrices(i,wg),Av.matrixWorld=QV,Av.raycast(e,u5);for(let o=0,a=u5.length;o<a;o++){const l=u5[o];l.instanceId=s,l.object=this,t.push(l)}u5.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new X2(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const i=t.morphTargetInfluences,r=i.length+1;this.morphTexture===null&&(this.morphTexture=new cu(new Float32Array(r*this.count),r,this.count,C9,Do));const s=this.morphTexture.source.data.data;let o=0;for(let c=0;c<i.length;c++)o+=i[c];const a=this.geometry.morphTargetsRelative?1:1-o,l=r*e;s[l]=a,s.set(i,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const GC=new ye,lRe=new ye,cRe=new ti;class rd{constructor(e=new ye(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=GC.subVectors(i,t).cross(lRe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(GC),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(e.start).addScaledVector(i,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||cRe.getNormalMatrix(e),r=this.coplanarPoint(GC).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Cp=new ro,uRe=new Et(.5,.5),h5=new ye;class vx{constructor(e=new rd,t=new rd,i=new rd,r=new rd,s=new rd,o=new rd){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=Sl,i=!1){const r=this.planes,s=e.elements,o=s[0],a=s[1],l=s[2],c=s[3],u=s[4],h=s[5],p=s[6],m=s[7],y=s[8],b=s[9],w=s[10],v=s[11],T=s[12],S=s[13],M=s[14],P=s[15];if(r[0].setComponents(c-o,m-u,v-y,P-T).normalize(),r[1].setComponents(c+o,m+u,v+y,P+T).normalize(),r[2].setComponents(c+a,m+h,v+b,P+S).normalize(),r[3].setComponents(c-a,m-h,v-b,P-S).normalize(),i)r[4].setComponents(l,p,w,M).normalize(),r[5].setComponents(c-l,m-p,v-w,P-M).normalize();else if(r[4].setComponents(c-l,m-p,v-w,P-M).normalize(),t===Sl)r[5].setComponents(c+l,m+p,v+w,P+M).normalize();else if(t===K2)r[5].setComponents(l,p,w,M).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Cp.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Cp.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Cp)}intersectsSprite(e){Cp.center.set(0,0,0);const t=uRe.distanceTo(e.center);return Cp.radius=.7071067811865476+t,Cp.applyMatrix4(e.matrixWorld),this.intersectsSphere(Cp)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(h5.x=r.normal.x>0?e.max.x:e.min.x,h5.y=r.normal.y>0?e.max.y:e.min.y,h5.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(h5)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Iu=new Hn,Nu=new vx;class F9{constructor(){this.coordinateSystem=Sl}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(Iu.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Nu.setFromProjectionMatrix(Iu,r.coordinateSystem,r.reversedDepth),Nu.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(Iu.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Nu.setFromProjectionMatrix(Iu,r.coordinateSystem,r.reversedDepth),Nu.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(Iu.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Nu.setFromProjectionMatrix(Iu,r.coordinateSystem,r.reversedDepth),Nu.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(Iu.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Nu.setFromProjectionMatrix(Iu,r.coordinateSystem,r.reversedDepth),Nu.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let i=0;i<t.cameras.length;i++){const r=t.cameras[i];if(Iu.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),Nu.setFromProjectionMatrix(Iu,r.coordinateSystem,r.reversedDepth),Nu.containsPoint(e))return!0}return!1}clone(){return new F9}}function WC(n,e){return n-e}function hRe(n,e){return n.z-e.z}function dRe(n,e){return e.z-n.z}class fRe{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,i,r){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const a=s[this.index];o.push(a),this.index++,a.start=e,a.count=t,a.z=i,a.index=r}reset(){this.list.length=0,this.index=0}}const Ta=new Hn,pRe=new an(1,1,1),eH=new vx,mRe=new F9,d5=new Fo,Mp=new ro,Mv=new ye,tH=new ye,gRe=new ye,KC=new fRe,_o=new xs,f5=[];function yRe(n,e,t=0){const i=e.itemSize;if(n.isInterleavedBufferAttribute||n.array.constructor!==e.array.constructor){const r=n.count;for(let s=0;s<r;s++)for(let o=0;o<i;o++)e.setComponent(s+t,o,n.getComponent(s,o))}else e.array.set(n.array,t*i);e.needsUpdate=!0}function Rp(n,e){if(n.constructor!==e.constructor){const t=Math.min(n.length,e.length);for(let i=0;i<t;i++)e[i]=n[i]}else{const t=Math.min(n.length,e.length);e.set(new n.constructor(n.buffer,0,t))}}class Bne extends xs{constructor(e,t,i=t*2,r){super(new Jn,r),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=i,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),i=new cu(t,e,e,Oo,Do);this._matricesTexture=i}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),i=new cu(t,e,e,G_,bc);this._indirectTexture=i}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),i=new cu(t,e,e,Oo,Do);i.colorSpace=xi.workingColorSpace,this._colorsTexture=i}_initializeGeometry(e){const t=this.geometry,i=this._maxVertexCount,r=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const o=e.getAttribute(s),{array:a,itemSize:l,normalized:c}=o,u=new a.constructor(i*l),h=new lr(u,l,c);t.setAttribute(s,h)}if(e.getIndex()!==null){const s=i>65535?new Uint32Array(r):new Uint16Array(r);t.setIndex(new lr(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const i in t.attributes){if(!e.hasAttribute(i))throw new Error(`THREE.BatchedMesh: Added geometry missing "${i}". All geometries must have consistent attributes.`);const r=e.getAttribute(i),s=t.getAttribute(i);if(r.itemSize!==s.itemSize||r.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Fo);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,Ta),this.getBoundingBoxAt(s,d5).applyMatrix4(Ta),e.union(d5)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ro);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let i=0,r=t.length;i<r;i++){if(t[i].active===!1)continue;const s=t[i].geometryIndex;this.getMatrixAt(i,Ta),this.getBoundingSphereAt(s,Mp).applyMatrix4(Ta),e.union(Mp)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const i={visible:!0,active:!0,geometryIndex:e};let r=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(WC),r=this._availableInstanceIds.shift(),this._instanceInfo[r]=i):(r=this._instanceInfo.length,this._instanceInfo.push(i));const s=this._matricesTexture;Ta.identity().toArray(s.image.data,r*16),s.needsUpdate=!0;const o=this._colorsTexture;return o&&(pRe.toArray(o.image.data,r*4),o.needsUpdate=!0),this._visibilityChanged=!0,r}addGeometry(e,t=-1,i=-1){this._initializeGeometry(e),this._validateGeometry(e);const r={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;r.vertexStart=this._nextVertexStart,r.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const o=e.getIndex();if(o!==null&&(r.indexStart=this._nextIndexStart,r.reservedIndexCount=i===-1?o.count:i),r.indexStart!==-1&&r.indexStart+r.reservedIndexCount>this._maxIndexCount||r.vertexStart+r.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let l;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(WC),l=this._availableGeometryIds.shift(),s[l]=r):(l=this._geometryCount,this._geometryCount++,s.push(r)),this.setGeometryAt(l,e),this._nextIndexStart=r.indexStart+r.reservedIndexCount,this._nextVertexStart=r.vertexStart+r.reservedVertexCount,l}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const i=this.geometry,r=i.getIndex()!==null,s=i.getIndex(),o=t.getIndex(),a=this._geometryInfo[e];if(r&&o.count>a.reservedIndexCount||t.attributes.position.count>a.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const l=a.vertexStart,c=a.reservedVertexCount;a.vertexCount=t.getAttribute("position").count;for(const u in i.attributes){const h=t.getAttribute(u),p=i.getAttribute(u);yRe(h,p,l);const m=h.itemSize;for(let y=h.count,b=c;y<b;y++){const w=l+y;for(let v=0;v<m;v++)p.setComponent(w,v,0)}p.needsUpdate=!0,p.addUpdateRange(l*m,c*m)}if(r){const u=a.indexStart,h=a.reservedIndexCount;a.indexCount=t.getIndex().count;for(let p=0;p<o.count;p++)s.setX(u+p,l+o.getX(p));for(let p=o.count,m=h;p<m;p++)s.setX(u+p,l);s.needsUpdate=!0,s.addUpdateRange(u,a.reservedIndexCount)}return a.start=r?a.indexStart:a.vertexStart,a.count=r?a.indexCount:a.vertexCount,a.boundingBox=null,t.boundingBox!==null&&(a.boundingBox=t.boundingBox.clone()),a.boundingSphere=null,t.boundingSphere!==null&&(a.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const i=this._instanceInfo;for(let r=0,s=i.length;r<s;r++)i[r].active&&i[r].geometryIndex===e&&this.deleteInstance(r);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const i=this._geometryInfo,r=i.map((o,a)=>a).sort((o,a)=>i[o].vertexStart-i[a].vertexStart),s=this.geometry;for(let o=0,a=i.length;o<a;o++){const l=r[o],c=i[l];if(c.active!==!1){if(s.index!==null){if(c.indexStart!==t){const{indexStart:u,vertexStart:h,reservedIndexCount:p}=c,m=s.index,y=m.array,b=e-h;for(let w=u;w<u+p;w++)y[w]=y[w]+b;m.array.copyWithin(t,u,u+p),m.addUpdateRange(t,p),m.needsUpdate=!0,c.indexStart=t}t+=c.reservedIndexCount}if(c.vertexStart!==e){const{vertexStart:u,reservedVertexCount:h}=c,p=s.attributes;for(const m in p){const y=p[m],{array:b,itemSize:w}=y;b.copyWithin(e*w,u*w,(u+h)*w),y.addUpdateRange(e*w,h*w),y.needsUpdate=!0}c.vertexStart=e}e+=c.reservedVertexCount,c.start=s.index?c.indexStart:c.vertexStart,this._nextIndexStart=s.index?c.indexStart+c.reservedIndexCount:0,this._nextVertexStart=c.vertexStart+c.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingBox===null){const s=new Fo,o=i.index,a=i.attributes.position;for(let l=r.start,c=r.start+r.count;l<c;l++){let u=l;o&&(u=o.getX(u)),s.expandByPoint(Mv.fromBufferAttribute(a,u))}r.boundingBox=s}return t.copy(r.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const i=this.geometry,r=this._geometryInfo[e];if(r.boundingSphere===null){const s=new ro;this.getBoundingBoxAt(e,d5),d5.getCenter(s.center);const o=i.index,a=i.attributes.position;let l=0;for(let c=r.start,u=r.start+r.count;c<u;c++){let h=c;o&&(h=o.getX(h)),Mv.fromBufferAttribute(a,h),l=Math.max(l,s.center.distanceToSquared(Mv))}s.radius=Math.sqrt(l),r.boundingSphere=s}return t.copy(r.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const i=this._matricesTexture,r=this._matricesTexture.image.data;return t.toArray(r,e*16),i.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const i=this._geometryInfo[e];return t.vertexStart=i.vertexStart,t.vertexCount=i.vertexCount,t.reservedVertexCount=i.reservedVertexCount,t.indexStart=i.indexStart,t.indexCount=i.indexCount,t.reservedIndexCount=i.reservedIndexCount,t.start=i.start,t.count=i.count,t}setInstanceCount(e){const t=this._availableInstanceIds,i=this._instanceInfo;for(t.sort(WC);t[t.length-1]===i.length-1;)i.pop(),t.pop();if(e<i.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const r=new Int32Array(e),s=new Int32Array(e);Rp(this._multiDrawCounts,r),Rp(this._multiDrawStarts,s),this._multiDrawCounts=r,this._multiDrawStarts=s,this._maxInstanceCount=e;const o=this._indirectTexture,a=this._matricesTexture,l=this._colorsTexture;o.dispose(),this._initIndirectTexture(),Rp(o.image.data,this._indirectTexture.image.data),a.dispose(),this._initMatricesTexture(),Rp(a.image.data,this._matricesTexture.image.data),l&&(l.dispose(),this._initColorsTexture(),Rp(l.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const i=[...this._geometryInfo].filter(a=>a.active);if(Math.max(...i.map(a=>a.vertexStart+a.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...i.map(l=>l.indexStart+l.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Jn,this._initializeGeometry(s));const o=this.geometry;s.index&&Rp(s.index.array,o.index.array);for(const a in s.attributes)Rp(s.attributes[a].array,o.attributes[a].array)}raycast(e,t){const i=this._instanceInfo,r=this._geometryInfo,s=this.matrixWorld,o=this.geometry;_o.material=this.material,_o.geometry.index=o.index,_o.geometry.attributes=o.attributes,_o.geometry.boundingBox===null&&(_o.geometry.boundingBox=new Fo),_o.geometry.boundingSphere===null&&(_o.geometry.boundingSphere=new ro);for(let a=0,l=i.length;a<l;a++){if(!i[a].visible||!i[a].active)continue;const c=i[a].geometryIndex,u=r[c];_o.geometry.setDrawRange(u.start,u.count),this.getMatrixAt(a,_o.matrixWorld).premultiply(s),this.getBoundingBoxAt(c,_o.geometry.boundingBox),this.getBoundingSphereAt(c,_o.geometry.boundingSphere),_o.raycast(e,f5);for(let h=0,p=f5.length;h<p;h++){const m=f5[h];m.object=this,m.batchId=a,t.push(m)}f5.length=0}_o.material=null,_o.geometry.index=null,_o.geometry.attributes={},_o.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,i,r,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=r.getIndex(),a=o===null?1:o.array.BYTES_PER_ELEMENT,l=this._instanceInfo,c=this._multiDrawStarts,u=this._multiDrawCounts,h=this._geometryInfo,p=this.perObjectFrustumCulled,m=this._indirectTexture,y=m.image.data,b=i.isArrayCamera?mRe:eH;p&&!i.isArrayCamera&&(Ta.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse).multiply(this.matrixWorld),eH.setFromProjectionMatrix(Ta,i.coordinateSystem,i.reversedDepth));let w=0;if(this.sortObjects){Ta.copy(this.matrixWorld).invert(),Mv.setFromMatrixPosition(i.matrixWorld).applyMatrix4(Ta),tH.set(0,0,-1).transformDirection(i.matrixWorld).transformDirection(Ta);for(let S=0,M=l.length;S<M;S++)if(l[S].visible&&l[S].active){const P=l[S].geometryIndex;this.getMatrixAt(S,Ta),this.getBoundingSphereAt(P,Mp).applyMatrix4(Ta);let R=!1;if(p&&(R=!b.intersectsSphere(Mp,i)),!R){const O=h[P],B=gRe.subVectors(Mp.center,Mv).dot(tH);KC.push(O.start,O.count,B,S)}}const v=KC.list,T=this.customSort;T===null?v.sort(s.transparent?dRe:hRe):T.call(this,v,i);for(let S=0,M=v.length;S<M;S++){const P=v[S];c[w]=P.start*a,u[w]=P.count,y[w]=P.index,w++}KC.reset()}else for(let v=0,T=l.length;v<T;v++)if(l[v].visible&&l[v].active){const S=l[v].geometryIndex;let M=!1;if(p&&(this.getMatrixAt(v,Ta),this.getBoundingSphereAt(S,Mp).applyMatrix4(Ta),M=!b.intersectsSphere(Mp,i)),!M){const P=h[S];c[w]=P.start*a,u[w]=P.count,y[w]=v,w++}}m.needsUpdate=!0,this._multiDrawCount=w,this._visibilityChanged=!1}onBeforeShadow(e,t,i,r,s,o){this.onBeforeRender(e,null,r,s,o)}}class ya extends Go{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new an(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const xE=new ye,vE=new ye,nH=new Hn,Rv=new E1,p5=new ro,qC=new ye,iH=new ye;class O0 extends Qi{constructor(e=new Jn,t=new ya){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)xE.fromBufferAttribute(t,r-1),vE.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=xE.distanceTo(vE);e.setAttribute("lineDistance",new un(i,1))}else Wt("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),p5.copy(i.boundingSphere),p5.applyMatrix4(r),p5.radius+=s,e.ray.intersectsSphere(p5)===!1)return;nH.copy(r).invert(),Rv.copy(e.ray).applyMatrix4(nH);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=this.isLineSegments?2:1,u=i.index,p=i.attributes.position;if(u!==null){const m=Math.max(0,o.start),y=Math.min(u.count,o.start+o.count);for(let b=m,w=y-1;b<w;b+=c){const v=u.getX(b),T=u.getX(b+1),S=m5(this,e,Rv,l,v,T,b);S&&t.push(S)}if(this.isLineLoop){const b=u.getX(y-1),w=u.getX(m),v=m5(this,e,Rv,l,b,w,y-1);v&&t.push(v)}}else{const m=Math.max(0,o.start),y=Math.min(p.count,o.start+o.count);for(let b=m,w=y-1;b<w;b+=c){const v=m5(this,e,Rv,l,b,b+1,b);v&&t.push(v)}if(this.isLineLoop){const b=m5(this,e,Rv,l,y-1,m,y-1);b&&t.push(b)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function m5(n,e,t,i,r,s,o){const a=n.geometry.attributes.position;if(xE.fromBufferAttribute(a,r),vE.fromBufferAttribute(a,s),t.distanceSqToSegment(xE,vE,qC,iH)>i)return;qC.applyMatrix4(n.matrixWorld);const c=e.ray.origin.distanceTo(qC);if(!(c<e.near||c>e.far))return{distance:c,point:iH.clone().applyMatrix4(n.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:n}}const rH=new ye,sH=new ye;class vh extends O0{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)rH.fromBufferAttribute(t,r),sH.fromBufferAttribute(t,r+1),i[r]=r===0?0:i[r-1],i[r+1]=i[r]+rH.distanceTo(sH);e.setAttribute("lineDistance",new un(i,1))}else Wt("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Une extends O0{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class GD extends Go{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new an(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const oH=new Hn,BN=new E1,g5=new ro,y5=new ye;class Fne extends Qi{constructor(e=new Jn,t=new GD){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Points.threshold,o=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),g5.copy(i.boundingSphere),g5.applyMatrix4(r),g5.radius+=s,e.ray.intersectsSphere(g5)===!1)return;oH.copy(r).invert(),BN.copy(e.ray).applyMatrix4(oH);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=i.index,h=i.attributes.position;if(c!==null){const p=Math.max(0,o.start),m=Math.min(c.count,o.start+o.count);for(let y=p,b=m;y<b;y++){const w=c.getX(y);y5.fromBufferAttribute(h,w),aH(y5,w,l,r,e,t,this)}}else{const p=Math.max(0,o.start),m=Math.min(h.count,o.start+o.count);for(let y=p,b=m;y<b;y++)y5.fromBufferAttribute(h,y),aH(y5,y,l,r,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function aH(n,e,t,i,r,s,o){const a=BN.distanceSqToPoint(n);if(a<t){const l=new ye;BN.closestPointToPoint(n,l),l.applyMatrix4(i);const c=r.ray.origin.distanceTo(l);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}let zne=class extends Gs{constructor(e,t,i,r,s=mr,o=mr,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const u=this;function h(){u.needsUpdate=!0,u._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(h))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}};class xRe extends zne{constructor(e,t,i,r,s,o,a,l){super({},e,t,i,r,s,o,a,l),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class vRe extends Gs{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=is,this.minFilter=is,this.generateMipmaps=!1,this.needsUpdate=!0}}class z9 extends Gs{constructor(e,t,i,r,s,o,a,l,c,u,h,p){super(null,o,a,l,c,u,r,s,h,p),this.isCompressedTexture=!0,this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class bRe extends z9{constructor(e,t,i,r,s,o){super(e,t,i,s,o),this.isCompressedArrayTexture=!0,this.image.depth=r,this.wrapR=Ga,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class _Re extends z9{constructor(e,t,i){super(void 0,e[0].width,e[0].height,t,i,fh),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class wRe extends Gs{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}let s1=class extends Gs{constructor(e,t,i=bc,r,s,o,a=is,l=is,c,u=ph,h=1){if(u!==ph&&u!==i0)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const p={width:e,height:t,depth:h};super(p,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new r0(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};class jne extends s1{constructor(e,t=bc,i=fh,r,s,o=is,a=is,l,c=ph){const u={width:e,height:e,depth:1},h=[u,u,u,u,u,u];super(e,e,t,i,r,s,o,a,l,c),this.image=h,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class WD extends Gs{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class j9 extends Jn{constructor(e=1,t=1,i=4,r=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:i,radialSegments:r,heightSegments:s},t=Math.max(0,t),i=Math.max(1,Math.floor(i)),r=Math.max(3,Math.floor(r)),s=Math.max(1,Math.floor(s));const o=[],a=[],l=[],c=[],u=t/2,h=Math.PI/2*e,p=t,m=2*h+p,y=i*2+s,b=r+1,w=new ye,v=new ye;for(let T=0;T<=y;T++){let S=0,M=0,P=0,R=0;if(T<=i){const N=T/i,I=N*Math.PI/2;M=-u-e*Math.cos(I),P=e*Math.sin(I),R=-e*Math.cos(I),S=N*h}else if(T<=i+s){const N=(T-i)/s;M=-u+N*t,P=e,R=0,S=h+N*p}else{const N=(T-i-s)/i,I=N*Math.PI/2;M=u+e*Math.sin(I),P=e*Math.cos(I),R=e*Math.sin(I),S=h+p+N*h}const O=Math.max(0,Math.min(1,S/m));let B=0;T===0?B=.5/r:T===y&&(B=-.5/r);for(let N=0;N<=r;N++){const I=N/r,F=I*Math.PI*2,j=Math.sin(F),W=Math.cos(F);v.x=-P*W,v.y=M,v.z=P*j,a.push(v.x,v.y,v.z),w.set(-P*W,R,P*j),w.normalize(),l.push(w.x,w.y,w.z),c.push(I+B,O)}if(T>0){const N=(T-1)*b;for(let I=0;I<r;I++){const F=N+I,j=N+I+1,W=T*b+I,U=T*b+I+1;o.push(F,j,W),o.push(j,U,W)}}}this.setIndex(o),this.setAttribute("position",new un(a,3)),this.setAttribute("normal",new un(l,3)),this.setAttribute("uv",new un(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new j9(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class V9 extends Jn{constructor(e=1,t=32,i=0,r=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},t=Math.max(3,t);const s=[],o=[],a=[],l=[],c=new ye,u=new Et;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let h=0,p=3;h<=t;h++,p+=3){const m=i+h/t*r;c.x=e*Math.cos(m),c.y=e*Math.sin(m),o.push(c.x,c.y,c.z),a.push(0,0,1),u.x=(o[p]/e+1)/2,u.y=(o[p+1]/e+1)/2,l.push(u.x,u.y)}for(let h=1;h<=t;h++)s.push(h,h+1,0);this.setIndex(s),this.setAttribute("position",new un(o,3)),this.setAttribute("normal",new un(a,3)),this.setAttribute("uv",new un(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new V9(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class q_ extends Jn{constructor(e=1,t=1,i=1,r=32,s=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:s,openEnded:o,thetaStart:a,thetaLength:l};const c=this;r=Math.floor(r),s=Math.floor(s);const u=[],h=[],p=[],m=[];let y=0;const b=[],w=i/2;let v=0;T(),o===!1&&(e>0&&S(!0),t>0&&S(!1)),this.setIndex(u),this.setAttribute("position",new un(h,3)),this.setAttribute("normal",new un(p,3)),this.setAttribute("uv",new un(m,2));function T(){const M=new ye,P=new ye;let R=0;const O=(t-e)/i;for(let B=0;B<=s;B++){const N=[],I=B/s,F=I*(t-e)+e;for(let j=0;j<=r;j++){const W=j/r,U=W*l+a,H=Math.sin(U),q=Math.cos(U);P.x=F*H,P.y=-I*i+w,P.z=F*q,h.push(P.x,P.y,P.z),M.set(H,O,q).normalize(),p.push(M.x,M.y,M.z),m.push(W,1-I),N.push(y++)}b.push(N)}for(let B=0;B<r;B++)for(let N=0;N<s;N++){const I=b[N][B],F=b[N+1][B],j=b[N+1][B+1],W=b[N][B+1];(e>0||N!==0)&&(u.push(I,F,W),R+=3),(t>0||N!==s-1)&&(u.push(F,j,W),R+=3)}c.addGroup(v,R,0),v+=R}function S(M){const P=y,R=new Et,O=new ye;let B=0;const N=M===!0?e:t,I=M===!0?1:-1;for(let j=1;j<=r;j++)h.push(0,w*I,0),p.push(0,I,0),m.push(.5,.5),y++;const F=y;for(let j=0;j<=r;j++){const U=j/r*l+a,H=Math.cos(U),q=Math.sin(U);O.x=N*q,O.y=w*I,O.z=N*H,h.push(O.x,O.y,O.z),p.push(0,I,0),R.x=H*.5+.5,R.y=q*.5*I+.5,m.push(R.x,R.y),y++}for(let j=0;j<r;j++){const W=P+j,U=F+j;M===!0?u.push(U,U+1,W):u.push(U+1,U,W),B+=3}c.addGroup(v,B,M===!0?1:2),v+=B}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new q_(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Z_ extends q_{constructor(e=1,t=1,i=32,r=1,s=!1,o=0,a=Math.PI*2){super(0,e,t,i,r,s,o,a),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a}}static fromJSON(e){return new Z_(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Z0 extends Jn{constructor(e=[],t=[],i=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r};const s=[],o=[];a(r),c(i),u(),this.setAttribute("position",new un(s,3)),this.setAttribute("normal",new un(s.slice(),3)),this.setAttribute("uv",new un(o,2)),r===0?this.computeVertexNormals():this.normalizeNormals();function a(T){const S=new ye,M=new ye,P=new ye;for(let R=0;R<t.length;R+=3)m(t[R+0],S),m(t[R+1],M),m(t[R+2],P),l(S,M,P,T)}function l(T,S,M,P){const R=P+1,O=[];for(let B=0;B<=R;B++){O[B]=[];const N=T.clone().lerp(M,B/R),I=S.clone().lerp(M,B/R),F=R-B;for(let j=0;j<=F;j++)j===0&&B===R?O[B][j]=N:O[B][j]=N.clone().lerp(I,j/F)}for(let B=0;B<R;B++)for(let N=0;N<2*(R-B)-1;N++){const I=Math.floor(N/2);N%2===0?(p(O[B][I+1]),p(O[B+1][I]),p(O[B][I])):(p(O[B][I+1]),p(O[B+1][I+1]),p(O[B+1][I]))}}function c(T){const S=new ye;for(let M=0;M<s.length;M+=3)S.x=s[M+0],S.y=s[M+1],S.z=s[M+2],S.normalize().multiplyScalar(T),s[M+0]=S.x,s[M+1]=S.y,s[M+2]=S.z}function u(){const T=new ye;for(let S=0;S<s.length;S+=3){T.x=s[S+0],T.y=s[S+1],T.z=s[S+2];const M=w(T)/2/Math.PI+.5,P=v(T)/Math.PI+.5;o.push(M,1-P)}y(),h()}function h(){for(let T=0;T<o.length;T+=6){const S=o[T+0],M=o[T+2],P=o[T+4],R=Math.max(S,M,P),O=Math.min(S,M,P);R>.9&&O<.1&&(S<.2&&(o[T+0]+=1),M<.2&&(o[T+2]+=1),P<.2&&(o[T+4]+=1))}}function p(T){s.push(T.x,T.y,T.z)}function m(T,S){const M=T*3;S.x=e[M+0],S.y=e[M+1],S.z=e[M+2]}function y(){const T=new ye,S=new ye,M=new ye,P=new ye,R=new Et,O=new Et,B=new Et;for(let N=0,I=0;N<s.length;N+=9,I+=6){T.set(s[N+0],s[N+1],s[N+2]),S.set(s[N+3],s[N+4],s[N+5]),M.set(s[N+6],s[N+7],s[N+8]),R.set(o[I+0],o[I+1]),O.set(o[I+2],o[I+3]),B.set(o[I+4],o[I+5]),P.copy(T).add(S).add(M).divideScalar(3);const F=w(P);b(R,I+0,T,F),b(O,I+2,S,F),b(B,I+4,M,F)}}function b(T,S,M,P){P<0&&T.x===1&&(o[S]=T.x-1),M.x===0&&M.z===0&&(o[S]=P/2/Math.PI+.5)}function w(T){return Math.atan2(T.z,-T.x)}function v(T){return Math.atan2(-T.y,Math.sqrt(T.x*T.x+T.z*T.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Z0(e.vertices,e.indices,e.radius,e.detail)}}class H9 extends Z0{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new H9(e.radius,e.detail)}}const x5=new ye,v5=new ye,ZC=new ye,b5=new Ua;class Vne extends Jn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const r=Math.pow(10,4),s=Math.cos(Lm*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],h=new Array(3),p={},m=[];for(let y=0;y<l;y+=3){o?(c[0]=o.getX(y),c[1]=o.getX(y+1),c[2]=o.getX(y+2)):(c[0]=y,c[1]=y+1,c[2]=y+2);const{a:b,b:w,c:v}=b5;if(b.fromBufferAttribute(a,c[0]),w.fromBufferAttribute(a,c[1]),v.fromBufferAttribute(a,c[2]),b5.getNormal(ZC),h[0]=`${Math.round(b.x*r)},${Math.round(b.y*r)},${Math.round(b.z*r)}`,h[1]=`${Math.round(w.x*r)},${Math.round(w.y*r)},${Math.round(w.z*r)}`,h[2]=`${Math.round(v.x*r)},${Math.round(v.y*r)},${Math.round(v.z*r)}`,!(h[0]===h[1]||h[1]===h[2]||h[2]===h[0]))for(let T=0;T<3;T++){const S=(T+1)%3,M=h[T],P=h[S],R=b5[u[T]],O=b5[u[S]],B=`${M}_${P}`,N=`${P}_${M}`;N in p&&p[N]?(ZC.dot(p[N].normal)<=s&&(m.push(R.x,R.y,R.z),m.push(O.x,O.y,O.z)),p[N]=null):B in p||(p[B]={index0:c[T],index1:c[S],normal:ZC.clone()})}}for(const y in p)if(p[y]){const{index0:b,index1:w}=p[y];x5.fromBufferAttribute(a,b),v5.fromBufferAttribute(a,w),m.push(x5.x,x5.y,x5.z),m.push(v5.x,v5.y,v5.z)}this.setAttribute("position",new un(m,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class gu{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Wt("Curve: .getPoint() not implemented.")}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,r=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)i=this.getPoint(o/e),s+=i.distanceTo(r),t.push(s),r=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const i=this.getLengths();let r=0;const s=i.length;let o;t?o=t:o=e*i[s-1];let a=0,l=s-1,c;for(;a<=l;)if(r=Math.floor(a+(l-a)/2),c=i[r]-o,c<0)a=r+1;else if(c>0)l=r-1;else{l=r;break}if(r=l,i[r]===o)return r/(s-1);const u=i[r],p=i[r+1]-u,m=(o-u)/p;return(r+m)/(s-1)}getTangent(e,t){let r=e-1e-4,s=e+1e-4;r<0&&(r=0),s>1&&(s=1);const o=this.getPoint(r),a=this.getPoint(s),l=t||(o.isVector2?new Et:new ye);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t=!1){const i=new ye,r=[],s=[],o=[],a=new ye,l=new Hn;for(let m=0;m<=e;m++){const y=m/e;r[m]=this.getTangentAt(y,new ye)}s[0]=new ye,o[0]=new ye;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),h=Math.abs(r[0].y),p=Math.abs(r[0].z);u<=c&&(c=u,i.set(1,0,0)),h<=c&&(c=h,i.set(0,1,0)),p<=c&&i.set(0,0,1),a.crossVectors(r[0],i).normalize(),s[0].crossVectors(r[0],a),o[0].crossVectors(r[0],s[0]);for(let m=1;m<=e;m++){if(s[m]=s[m-1].clone(),o[m]=o[m-1].clone(),a.crossVectors(r[m-1],r[m]),a.length()>Number.EPSILON){a.normalize();const y=Math.acos(Bn(r[m-1].dot(r[m]),-1,1));s[m].applyMatrix4(l.makeRotationAxis(a,y))}o[m].crossVectors(r[m],s[m])}if(t===!0){let m=Math.acos(Bn(s[0].dot(s[e]),-1,1));m/=e,r[0].dot(a.crossVectors(s[0],s[e]))>0&&(m=-m);for(let y=1;y<=e;y++)s[y].applyMatrix4(l.makeRotationAxis(r[y],m*y)),o[y].crossVectors(r[y],s[y])}return{tangents:r,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class $9 extends gu{constructor(e=0,t=0,i=1,r=1,s=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=r,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t=new Et){const i=t,r=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=r;for(;s>r;)s-=r;s<Number.EPSILON&&(o?s=0:s=r),this.aClockwise===!0&&!o&&(s===r?s=-r:s=s-r);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),p=l-this.aX,m=c-this.aY;l=p*u-m*h+this.aX,c=p*h+m*u+this.aY}return i.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class Hne extends $9{constructor(e,t,i,r,s,o){super(e,t,i,i,r,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function KD(){let n=0,e=0,t=0,i=0;function r(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,i=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){r(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,h){let p=(o-s)/c-(a-s)/(c+u)+(a-o)/u,m=(a-o)/u-(l-o)/(u+h)+(l-a)/h;p*=u,m*=u,r(o,a,p,m)},calc:function(s){const o=s*s,a=o*s;return n+e*s+t*o+i*a}}}const _5=new ye,YC=new KD,XC=new KD,QC=new KD;class $ne extends gu{constructor(e=[],t=!1,i="centripetal",r=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=r}getPoint(e,t=new ye){const i=t,r=this.points,s=r.length,o=(s-(this.closed?0:1))*e;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:l===0&&a===s-1&&(a=s-2,l=1);let c,u;this.closed||a>0?c=r[(a-1)%s]:(_5.subVectors(r[0],r[1]).add(r[0]),c=_5);const h=r[a%s],p=r[(a+1)%s];if(this.closed||a+2<s?u=r[(a+2)%s]:(_5.subVectors(r[s-1],r[s-2]).add(r[s-1]),u=_5),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let y=Math.pow(c.distanceToSquared(h),m),b=Math.pow(h.distanceToSquared(p),m),w=Math.pow(p.distanceToSquared(u),m);b<1e-4&&(b=1),y<1e-4&&(y=b),w<1e-4&&(w=b),YC.initNonuniformCatmullRom(c.x,h.x,p.x,u.x,y,b,w),XC.initNonuniformCatmullRom(c.y,h.y,p.y,u.y,y,b,w),QC.initNonuniformCatmullRom(c.z,h.z,p.z,u.z,y,b,w)}else this.curveType==="catmullrom"&&(YC.initCatmullRom(c.x,h.x,p.x,u.x,this.tension),XC.initCatmullRom(c.y,h.y,p.y,u.y,this.tension),QC.initCatmullRom(c.z,h.z,p.z,u.z,this.tension));return i.set(YC.calc(l),XC.calc(l),QC.calc(l)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new ye().fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function lH(n,e,t,i,r){const s=(i-e)*.5,o=(r-t)*.5,a=n*n,l=n*a;return(2*t-2*i+s+o)*l+(-3*t+3*i-2*s-o)*a+s*n+t}function SRe(n,e){const t=1-n;return t*t*e}function ERe(n,e){return 2*(1-n)*n*e}function TRe(n,e){return n*n*e}function L3(n,e,t,i){return SRe(n,e)+ERe(n,t)+TRe(n,i)}function ARe(n,e){const t=1-n;return t*t*t*e}function CRe(n,e){const t=1-n;return 3*t*t*n*e}function MRe(n,e){return 3*(1-n)*n*n*e}function RRe(n,e){return n*n*n*e}function D3(n,e,t,i,r){return ARe(n,e)+CRe(n,t)+MRe(n,i)+RRe(n,r)}class qD extends gu{constructor(e=new Et,t=new Et,i=new Et,r=new Et){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new Et){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(D3(e,r.x,s.x,o.x,a.x),D3(e,r.y,s.y,o.y,a.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class Gne extends gu{constructor(e=new ye,t=new ye,i=new ye,r=new ye){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=r}getPoint(e,t=new ye){const i=t,r=this.v0,s=this.v1,o=this.v2,a=this.v3;return i.set(D3(e,r.x,s.x,o.x,a.x),D3(e,r.y,s.y,o.y,a.y),D3(e,r.z,s.z,o.z,a.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class ZD extends gu{constructor(e=new Et,t=new Et){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Et){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Et){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Wne extends gu{constructor(e=new ye,t=new ye){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ye){const i=t;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ye){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class YD extends gu{constructor(e=new Et,t=new Et,i=new Et){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Et){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(L3(e,r.x,s.x,o.x),L3(e,r.y,s.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class XD extends gu{constructor(e=new ye,t=new ye,i=new ye){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new ye){const i=t,r=this.v0,s=this.v1,o=this.v2;return i.set(L3(e,r.x,s.x,o.x),L3(e,r.y,s.y,o.y),L3(e,r.z,s.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QD extends gu{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Et){const i=t,r=this.points,s=(r.length-1)*e,o=Math.floor(s),a=s-o,l=r[o===0?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],h=r[o>r.length-3?r.length-1:o+2];return i.set(lH(a,l.x,c.x,u.x,h.x),lH(a,l.y,c.y,u.y,h.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const r=this.points[t];e.points.push(r.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const r=e.points[t];this.points.push(new Et().fromArray(r))}return this}}var bE=Object.freeze({__proto__:null,ArcCurve:Hne,CatmullRomCurve3:$ne,CubicBezierCurve:qD,CubicBezierCurve3:Gne,EllipseCurve:$9,LineCurve:ZD,LineCurve3:Wne,QuadraticBezierCurve:YD,QuadraticBezierCurve3:XD,SplineCurve:QD});class Kne extends gu{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const i=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new bE[i](t,e))}return this}getPoint(e,t){const i=e*this.getLength(),r=this.getCurveLengths();let s=0;for(;s<r.length;){if(r[s]>=i){const o=r[s]-i,a=this.curves[s],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let r=0,s=this.curves;r<s.length;r++){const o=s[r],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,l=o.getPoints(a);for(let c=0;c<l.length;c++){const u=l[c];i&&i.equals(u)||(t.push(u),i=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const r=this.curves[t];e.curves.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const r=e.curves[t];this.curves.push(new bE[r.type]().fromJSON(r))}return this}}class _E extends Kne{constructor(e){super(),this.type="Path",this.currentPoint=new Et,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new ZD(this.currentPoint.clone(),new Et(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,r){const s=new YD(this.currentPoint.clone(),new Et(e,t),new Et(i,r));return this.curves.push(s),this.currentPoint.set(i,r),this}bezierCurveTo(e,t,i,r,s,o){const a=new qD(this.currentPoint.clone(),new Et(e,t),new Et(i,r),new Et(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new QD(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,r,s,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(e+a,t+l,i,r,s,o),this}absarc(e,t,i,r,s,o){return this.absellipse(e,t,i,i,r,s,o),this}ellipse(e,t,i,r,s,o,a,l){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,i,r,s,o,a,l),this}absellipse(e,t,i,r,s,o,a,l){const c=new $9(e,t,i,r,s,o,a,l);if(this.curves.length>0){const h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Om extends _E{constructor(e){super(e),this.uuid=Tl(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(r.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const r=this.holes[t];e.holes.push(r.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const r=e.holes[t];this.holes.push(new _E().fromJSON(r))}return this}}function IRe(n,e,t=2){const i=e&&e.length,r=i?e[0]*t:n.length;let s=qne(n,0,r,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c;if(i&&(s=DRe(n,e,s,t)),n.length>80*t){a=n[0],l=n[1];let u=a,h=l;for(let p=t;p<r;p+=t){const m=n[p],y=n[p+1];m<a&&(a=m),y<l&&(l=y),m>u&&(u=m),y>h&&(h=y)}c=Math.max(u-a,h-l),c=c!==0?32767/c:0}return Fb(s,o,t,a,l,c,0),o}function qne(n,e,t,i,r){let s;if(r===WRe(n,e,t,i)>0)for(let o=e;o<t;o+=i)s=cH(o/i|0,n[o],n[o+1],s);else for(let o=t-i;o>=e;o-=i)s=cH(o/i|0,n[o],n[o+1],s);return s&&Q2(s,s.next)&&(jb(s),s=s.next),s}function o1(n,e){if(!n)return n;e||(e=n);let t=n,i;do if(i=!1,!t.steiner&&(Q2(t,t.next)||Fr(t.prev,t,t.next)===0)){if(jb(t),t=e=t.prev,t===t.next)break;i=!0}else t=t.next;while(i||t!==e);return e}function Fb(n,e,t,i,r,s,o){if(!n)return;!o&&s&&zRe(n,i,r,s);let a=n;for(;n.prev!==n.next;){const l=n.prev,c=n.next;if(s?PRe(n,i,r,s):NRe(n)){e.push(l.i,n.i,c.i),jb(n),n=c.next,a=c.next;continue}if(n=c,n===a){o?o===1?(n=kRe(o1(n),e),Fb(n,e,t,i,r,s,2)):o===2&&LRe(n,e,t,i,r,s):Fb(o1(n),e,t,i,r,s,1);break}}}function NRe(n){const e=n.prev,t=n,i=n.next;if(Fr(e,t,i)>=0)return!1;const r=e.x,s=t.x,o=i.x,a=e.y,l=t.y,c=i.y,u=Math.min(r,s,o),h=Math.min(a,l,c),p=Math.max(r,s,o),m=Math.max(a,l,c);let y=i.next;for(;y!==e;){if(y.x>=u&&y.x<=p&&y.y>=h&&y.y<=m&&l3(r,a,s,l,o,c,y.x,y.y)&&Fr(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function PRe(n,e,t,i){const r=n.prev,s=n,o=n.next;if(Fr(r,s,o)>=0)return!1;const a=r.x,l=s.x,c=o.x,u=r.y,h=s.y,p=o.y,m=Math.min(a,l,c),y=Math.min(u,h,p),b=Math.max(a,l,c),w=Math.max(u,h,p),v=UN(m,y,e,t,i),T=UN(b,w,e,t,i);let S=n.prevZ,M=n.nextZ;for(;S&&S.z>=v&&M&&M.z<=T;){if(S.x>=m&&S.x<=b&&S.y>=y&&S.y<=w&&S!==r&&S!==o&&l3(a,u,l,h,c,p,S.x,S.y)&&Fr(S.prev,S,S.next)>=0||(S=S.prevZ,M.x>=m&&M.x<=b&&M.y>=y&&M.y<=w&&M!==r&&M!==o&&l3(a,u,l,h,c,p,M.x,M.y)&&Fr(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;S&&S.z>=v;){if(S.x>=m&&S.x<=b&&S.y>=y&&S.y<=w&&S!==r&&S!==o&&l3(a,u,l,h,c,p,S.x,S.y)&&Fr(S.prev,S,S.next)>=0)return!1;S=S.prevZ}for(;M&&M.z<=T;){if(M.x>=m&&M.x<=b&&M.y>=y&&M.y<=w&&M!==r&&M!==o&&l3(a,u,l,h,c,p,M.x,M.y)&&Fr(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function kRe(n,e){let t=n;do{const i=t.prev,r=t.next.next;!Q2(i,r)&&Yne(i,t,t.next,r)&&zb(i,r)&&zb(r,i)&&(e.push(i.i,t.i,r.i),jb(t),jb(t.next),t=n=r),t=t.next}while(t!==n);return o1(t)}function LRe(n,e,t,i,r,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&HRe(o,a)){let l=Xne(o,a);o=o1(o,o.next),l=o1(l,l.next),Fb(o,e,t,i,r,s,0),Fb(l,e,t,i,r,s,0);return}a=a.next}o=o.next}while(o!==n)}function DRe(n,e,t,i){const r=[];for(let s=0,o=e.length;s<o;s++){const a=e[s]*i,l=s<o-1?e[s+1]*i:n.length,c=qne(n,a,l,i,!1);c===c.next&&(c.steiner=!0),r.push(VRe(c))}r.sort(ORe);for(let s=0;s<r.length;s++)t=BRe(r[s],t);return t}function ORe(n,e){let t=n.x-e.x;if(t===0&&(t=n.y-e.y,t===0)){const i=(n.next.y-n.y)/(n.next.x-n.x),r=(e.next.y-e.y)/(e.next.x-e.x);t=i-r}return t}function BRe(n,e){const t=URe(n,e);if(!t)return e;const i=Xne(t,n);return o1(i,i.next),o1(t,t.next)}function URe(n,e){let t=e;const i=n.x,r=n.y;let s=-1/0,o;if(Q2(n,t))return t;do{if(Q2(n,t.next))return t.next;if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const h=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=i&&h>s&&(s=h,o=t.x<t.next.x?t:t.next,h===i))return o}t=t.next}while(t!==e);if(!o)return null;const a=o,l=o.x,c=o.y;let u=1/0;t=o;do{if(i>=t.x&&t.x>=l&&i!==t.x&&Zne(r<c?i:s,r,l,c,r<c?s:i,r,t.x,t.y)){const h=Math.abs(r-t.y)/(i-t.x);zb(t,n)&&(h<u||h===u&&(t.x>o.x||t.x===o.x&&FRe(o,t)))&&(o=t,u=h)}t=t.next}while(t!==a);return o}function FRe(n,e){return Fr(n.prev,n,e.prev)<0&&Fr(e.next,n,n.next)<0}function zRe(n,e,t,i){let r=n;do r.z===0&&(r.z=UN(r.x,r.y,e,t,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==n);r.prevZ.nextZ=null,r.prevZ=null,jRe(r)}function jRe(n){let e,t=1;do{let i=n,r;n=null;let s=null;for(e=0;i;){e++;let o=i,a=0;for(let c=0;c<t&&(a++,o=o.nextZ,!!o);c++);let l=t;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||i.z<=o.z)?(r=i,i=i.nextZ,a--):(r=o,o=o.nextZ,l--),s?s.nextZ=r:n=r,r.prevZ=s,s=r;i=o}s.nextZ=null,t*=2}while(e>1);return n}function UN(n,e,t,i,r){return n=(n-t)*r|0,e=(e-i)*r|0,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n|e<<1}function VRe(n){let e=n,t=n;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==n);return t}function Zne(n,e,t,i,r,s,o,a){return(r-o)*(e-a)>=(n-o)*(s-a)&&(n-o)*(i-a)>=(t-o)*(e-a)&&(t-o)*(s-a)>=(r-o)*(i-a)}function l3(n,e,t,i,r,s,o,a){return!(n===o&&e===a)&&Zne(n,e,t,i,r,s,o,a)}function HRe(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!$Re(n,e)&&(zb(n,e)&&zb(e,n)&&GRe(n,e)&&(Fr(n.prev,n,e.prev)||Fr(n,e.prev,e))||Q2(n,e)&&Fr(n.prev,n,n.next)>0&&Fr(e.prev,e,e.next)>0)}function Fr(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function Q2(n,e){return n.x===e.x&&n.y===e.y}function Yne(n,e,t,i){const r=S5(Fr(n,e,t)),s=S5(Fr(n,e,i)),o=S5(Fr(t,i,n)),a=S5(Fr(t,i,e));return!!(r!==s&&o!==a||r===0&&w5(n,t,e)||s===0&&w5(n,i,e)||o===0&&w5(t,n,i)||a===0&&w5(t,e,i))}function w5(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function S5(n){return n>0?1:n<0?-1:0}function $Re(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&Yne(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}function zb(n,e){return Fr(n.prev,n,n.next)<0?Fr(n,e,n.next)>=0&&Fr(n,n.prev,e)>=0:Fr(n,e,n.prev)<0||Fr(n,n.next,e)<0}function GRe(n,e){let t=n,i=!1;const r=(n.x+e.x)/2,s=(n.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&r<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(i=!i),t=t.next;while(t!==n);return i}function Xne(n,e){const t=FN(n.i,n.x,n.y),i=FN(e.i,e.x,e.y),r=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=r,r.prev=t,i.next=t,t.prev=i,s.next=i,i.prev=s,i}function cH(n,e,t,i){const r=FN(n,e,t);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function jb(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function FN(n,e,t){return{i:n,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function WRe(n,e,t,i){let r=0;for(let s=e,o=t-i;s<t;s+=i)r+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return r}class KRe{static triangulate(e,t,i=2){return IRe(e,t,i)}}class iu{static area(e){const t=e.length;let i=0;for(let r=t-1,s=0;s<t;r=s++)i+=e[r].x*e[s].y-e[s].x*e[r].y;return i*.5}static isClockWise(e){return iu.area(e)<0}static triangulateShape(e,t){const i=[],r=[],s=[];uH(e),hH(i,e);let o=e.length;t.forEach(uH);for(let l=0;l<t.length;l++)r.push(o),o+=t[l].length,hH(i,t[l]);const a=KRe.triangulate(i,r);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function uH(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function hH(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class G9 extends Jn{constructor(e=new Om([new Et(.5,.5),new Et(-.5,.5),new Et(-.5,-.5),new Et(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,r=[],s=[];for(let a=0,l=e.length;a<l;a++){const c=e[a];o(c)}this.setAttribute("position",new un(r,3)),this.setAttribute("uv",new un(s,2)),this.computeVertexNormals();function o(a){const l=[],c=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1;let p=t.bevelEnabled!==void 0?t.bevelEnabled:!0,m=t.bevelThickness!==void 0?t.bevelThickness:.2,y=t.bevelSize!==void 0?t.bevelSize:m-.1,b=t.bevelOffset!==void 0?t.bevelOffset:0,w=t.bevelSegments!==void 0?t.bevelSegments:3;const v=t.extrudePath,T=t.UVGenerator!==void 0?t.UVGenerator:qRe;let S,M=!1,P,R,O,B;if(v){S=v.getSpacedPoints(u),M=!0,p=!1;const gt=v.isCatmullRomCurve3?v.closed:!1;P=v.computeFrenetFrames(u,gt),R=new ye,O=new ye,B=new ye}p||(w=0,m=0,y=0,b=0);const N=a.extractPoints(c);let I=N.shape;const F=N.holes;if(!iu.isClockWise(I)){I=I.reverse();for(let gt=0,vt=F.length;gt<vt;gt++){const Oe=F[gt];iu.isClockWise(Oe)&&(F[gt]=Oe.reverse())}}function W(gt){const Oe=10000000000000001e-36;let xt=gt[0];for(let pe=1;pe<=gt.length;pe++){const qe=pe%gt.length,$e=gt[qe],Xe=$e.x-xt.x,Ye=$e.y-xt.y,oe=Xe*Xe+Ye*Ye,Z=Math.max(Math.abs($e.x),Math.abs($e.y),Math.abs(xt.x),Math.abs(xt.y)),he=Oe*Z*Z;if(oe<=he){gt.splice(qe,1),pe--;continue}xt=$e}}W(I),F.forEach(W);const U=F.length,H=I;for(let gt=0;gt<U;gt++){const vt=F[gt];I=I.concat(vt)}function q(gt,vt,Oe){return vt||xn("ExtrudeGeometry: vec does not exist"),gt.clone().addScaledVector(vt,Oe)}const J=I.length;function G(gt,vt,Oe){let xt,pe,qe;const $e=gt.x-vt.x,Xe=gt.y-vt.y,Ye=Oe.x-gt.x,oe=Oe.y-gt.y,Z=$e*$e+Xe*Xe,he=$e*oe-Xe*Ye;if(Math.abs(he)>Number.EPSILON){const Ge=Math.sqrt(Z),ct=Math.sqrt(Ye*Ye+oe*oe),tt=vt.x-Xe/Ge,Lt=vt.y+$e/Ge,Ct=Oe.x-oe/ct,Ot=Oe.y+Ye/ct,nn=((Ct-tt)*oe-(Ot-Lt)*Ye)/($e*oe-Xe*Ye);xt=tt+$e*nn-gt.x,pe=Lt+Xe*nn-gt.y;const Tt=xt*xt+pe*pe;if(Tt<=2)return new Et(xt,pe);qe=Math.sqrt(Tt/2)}else{let Ge=!1;$e>Number.EPSILON?Ye>Number.EPSILON&&(Ge=!0):$e<-Number.EPSILON?Ye<-Number.EPSILON&&(Ge=!0):Math.sign(Xe)===Math.sign(oe)&&(Ge=!0),Ge?(xt=-Xe,pe=$e,qe=Math.sqrt(Z)):(xt=$e,pe=Xe,qe=Math.sqrt(Z/2))}return new Et(xt/qe,pe/qe)}const ee=[];for(let gt=0,vt=H.length,Oe=vt-1,xt=gt+1;gt<vt;gt++,Oe++,xt++)Oe===vt&&(Oe=0),xt===vt&&(xt=0),ee[gt]=G(H[gt],H[Oe],H[xt]);const Q=[];let ne,fe=ee.concat();for(let gt=0,vt=U;gt<vt;gt++){const Oe=F[gt];ne=[];for(let xt=0,pe=Oe.length,qe=pe-1,$e=xt+1;xt<pe;xt++,qe++,$e++)qe===pe&&(qe=0),$e===pe&&($e=0),ne[xt]=G(Oe[xt],Oe[qe],Oe[$e]);Q.push(ne),fe=fe.concat(ne)}let Ae;if(w===0)Ae=iu.triangulateShape(H,F);else{const gt=[],vt=[];for(let Oe=0;Oe<w;Oe++){const xt=Oe/w,pe=m*Math.cos(xt*Math.PI/2),qe=y*Math.sin(xt*Math.PI/2)+b;for(let $e=0,Xe=H.length;$e<Xe;$e++){const Ye=q(H[$e],ee[$e],qe);me(Ye.x,Ye.y,-pe),xt===0&&gt.push(Ye)}for(let $e=0,Xe=U;$e<Xe;$e++){const Ye=F[$e];ne=Q[$e];const oe=[];for(let Z=0,he=Ye.length;Z<he;Z++){const Ge=q(Ye[Z],ne[Z],qe);me(Ge.x,Ge.y,-pe),xt===0&&oe.push(Ge)}xt===0&&vt.push(oe)}}Ae=iu.triangulateShape(gt,vt)}const Pe=Ae.length,Ce=y+b;for(let gt=0;gt<J;gt++){const vt=p?q(I[gt],fe[gt],Ce):I[gt];M?(O.copy(P.normals[0]).multiplyScalar(vt.x),R.copy(P.binormals[0]).multiplyScalar(vt.y),B.copy(S[0]).add(O).add(R),me(B.x,B.y,B.z)):me(vt.x,vt.y,0)}for(let gt=1;gt<=u;gt++)for(let vt=0;vt<J;vt++){const Oe=p?q(I[vt],fe[vt],Ce):I[vt];M?(O.copy(P.normals[gt]).multiplyScalar(Oe.x),R.copy(P.binormals[gt]).multiplyScalar(Oe.y),B.copy(S[gt]).add(O).add(R),me(B.x,B.y,B.z)):me(Oe.x,Oe.y,h/u*gt)}for(let gt=w-1;gt>=0;gt--){const vt=gt/w,Oe=m*Math.cos(vt*Math.PI/2),xt=y*Math.sin(vt*Math.PI/2)+b;for(let pe=0,qe=H.length;pe<qe;pe++){const $e=q(H[pe],ee[pe],xt);me($e.x,$e.y,h+Oe)}for(let pe=0,qe=F.length;pe<qe;pe++){const $e=F[pe];ne=Q[pe];for(let Xe=0,Ye=$e.length;Xe<Ye;Xe++){const oe=q($e[Xe],ne[Xe],xt);M?me(oe.x,oe.y+S[u-1].y,S[u-1].x+Oe):me(oe.x,oe.y,h+Oe)}}}de(),Ne();function de(){const gt=r.length/3;if(p){let vt=0,Oe=J*vt;for(let xt=0;xt<Pe;xt++){const pe=Ae[xt];nt(pe[2]+Oe,pe[1]+Oe,pe[0]+Oe)}vt=u+w*2,Oe=J*vt;for(let xt=0;xt<Pe;xt++){const pe=Ae[xt];nt(pe[0]+Oe,pe[1]+Oe,pe[2]+Oe)}}else{for(let vt=0;vt<Pe;vt++){const Oe=Ae[vt];nt(Oe[2],Oe[1],Oe[0])}for(let vt=0;vt<Pe;vt++){const Oe=Ae[vt];nt(Oe[0]+J*u,Oe[1]+J*u,Oe[2]+J*u)}}i.addGroup(gt,r.length/3-gt,0)}function Ne(){const gt=r.length/3;let vt=0;et(H,vt),vt+=H.length;for(let Oe=0,xt=F.length;Oe<xt;Oe++){const pe=F[Oe];et(pe,vt),vt+=pe.length}i.addGroup(gt,r.length/3-gt,1)}function et(gt,vt){let Oe=gt.length;for(;--Oe>=0;){const xt=Oe;let pe=Oe-1;pe<0&&(pe=gt.length-1);for(let qe=0,$e=u+w*2;qe<$e;qe++){const Xe=J*qe,Ye=J*(qe+1),oe=vt+xt+Xe,Z=vt+pe+Xe,he=vt+pe+Ye,Ge=vt+xt+Ye;Pt(oe,Z,he,Ge)}}}function me(gt,vt,Oe){l.push(gt),l.push(vt),l.push(Oe)}function nt(gt,vt,Oe){zt(gt),zt(vt),zt(Oe);const xt=r.length/3,pe=T.generateTopUV(i,r,xt-3,xt-2,xt-1);Dt(pe[0]),Dt(pe[1]),Dt(pe[2])}function Pt(gt,vt,Oe,xt){zt(gt),zt(vt),zt(xt),zt(vt),zt(Oe),zt(xt);const pe=r.length/3,qe=T.generateSideWallUV(i,r,pe-6,pe-3,pe-2,pe-1);Dt(qe[0]),Dt(qe[1]),Dt(qe[3]),Dt(qe[1]),Dt(qe[2]),Dt(qe[3])}function zt(gt){r.push(l[gt*3+0]),r.push(l[gt*3+1]),r.push(l[gt*3+2])}function Dt(gt){s.push(gt.x),s.push(gt.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,i=this.parameters.options;return ZRe(t,i,e)}static fromJSON(e,t){const i=[];for(let s=0,o=e.shapes.length;s<o;s++){const a=t[e.shapes[s]];i.push(a)}const r=e.options.extrudePath;return r!==void 0&&(e.options.extrudePath=new bE[r.type]().fromJSON(r)),new G9(i,e.options)}}const qRe={generateTopUV:function(n,e,t,i,r){const s=e[t*3],o=e[t*3+1],a=e[i*3],l=e[i*3+1],c=e[r*3],u=e[r*3+1];return[new Et(s,o),new Et(a,l),new Et(c,u)]},generateSideWallUV:function(n,e,t,i,r,s){const o=e[t*3],a=e[t*3+1],l=e[t*3+2],c=e[i*3],u=e[i*3+1],h=e[i*3+2],p=e[r*3],m=e[r*3+1],y=e[r*3+2],b=e[s*3],w=e[s*3+1],v=e[s*3+2];return Math.abs(a-u)<Math.abs(o-c)?[new Et(o,1-l),new Et(c,1-h),new Et(p,1-y),new Et(b,1-v)]:[new Et(a,1-l),new Et(u,1-h),new Et(m,1-y),new Et(w,1-v)]}};function ZRe(n,e,t){if(t.shapes=[],Array.isArray(n))for(let i=0,r=n.length;i<r;i++){const s=n[i];t.shapes.push(s.uuid)}else t.shapes.push(n.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class W9 extends Z0{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(r,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new W9(e.radius,e.detail)}}class K9 extends Jn{constructor(e=[new Et(0,-.5),new Et(.5,0),new Et(0,.5)],t=12,i=0,r=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t),r=Bn(r,0,Math.PI*2);const s=[],o=[],a=[],l=[],c=[],u=1/t,h=new ye,p=new Et,m=new ye,y=new ye,b=new ye;let w=0,v=0;for(let T=0;T<=e.length-1;T++)switch(T){case 0:w=e[T+1].x-e[T].x,v=e[T+1].y-e[T].y,m.x=v*1,m.y=-w,m.z=v*0,b.copy(m),m.normalize(),l.push(m.x,m.y,m.z);break;case e.length-1:l.push(b.x,b.y,b.z);break;default:w=e[T+1].x-e[T].x,v=e[T+1].y-e[T].y,m.x=v*1,m.y=-w,m.z=v*0,y.copy(m),m.x+=b.x,m.y+=b.y,m.z+=b.z,m.normalize(),l.push(m.x,m.y,m.z),b.copy(y)}for(let T=0;T<=t;T++){const S=i+T*u*r,M=Math.sin(S),P=Math.cos(S);for(let R=0;R<=e.length-1;R++){h.x=e[R].x*M,h.y=e[R].y,h.z=e[R].x*P,o.push(h.x,h.y,h.z),p.x=T/t,p.y=R/(e.length-1),a.push(p.x,p.y);const O=l[3*R+0]*M,B=l[3*R+1],N=l[3*R+0]*P;c.push(O,B,N)}}for(let T=0;T<t;T++)for(let S=0;S<e.length-1;S++){const M=S+T*e.length,P=M,R=M+e.length,O=M+e.length+1,B=M+1;s.push(P,R,B),s.push(O,B,R)}this.setIndex(s),this.setAttribute("position",new un(o,3)),this.setAttribute("uv",new un(a,2)),this.setAttribute("normal",new un(c,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new K9(e.points,e.segments,e.phiStart,e.phiLength)}}class Y_ extends Z0{constructor(e=1,t=0){const i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],r=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(i,r,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Y_(e.radius,e.detail)}}class bx extends Jn{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,h=e/a,p=t/l,m=[],y=[],b=[],w=[];for(let v=0;v<u;v++){const T=v*p-o;for(let S=0;S<c;S++){const M=S*h-s;y.push(M,-T,0),b.push(0,0,1),w.push(S/a),w.push(1-v/l)}}for(let v=0;v<l;v++)for(let T=0;T<a;T++){const S=T+c*v,M=T+c*(v+1),P=T+1+c*(v+1),R=T+1+c*v;m.push(S,M,R),m.push(M,P,R)}this.setIndex(m),this.setAttribute("position",new un(y,3)),this.setAttribute("normal",new un(b,3)),this.setAttribute("uv",new un(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bx(e.width,e.height,e.widthSegments,e.heightSegments)}}class q9 extends Jn{constructor(e=.5,t=1,i=32,r=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:s,thetaLength:o},i=Math.max(3,i),r=Math.max(1,r);const a=[],l=[],c=[],u=[];let h=e;const p=(t-e)/r,m=new ye,y=new Et;for(let b=0;b<=r;b++){for(let w=0;w<=i;w++){const v=s+w/i*o;m.x=h*Math.cos(v),m.y=h*Math.sin(v),l.push(m.x,m.y,m.z),c.push(0,0,1),y.x=(m.x/t+1)/2,y.y=(m.y/t+1)/2,u.push(y.x,y.y)}h+=p}for(let b=0;b<r;b++){const w=b*(i+1);for(let v=0;v<i;v++){const T=v+w,S=T,M=T+i+1,P=T+i+2,R=T+1;a.push(S,M,R),a.push(M,P,R)}}this.setIndex(a),this.setAttribute("position",new un(l,3)),this.setAttribute("normal",new un(c,3)),this.setAttribute("uv",new un(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new q9(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Z9 extends Jn{constructor(e=new Om([new Et(0,.5),new Et(-.5,-.5),new Et(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],r=[],s=[],o=[];let a=0,l=0;if(Array.isArray(e)===!1)c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;this.setIndex(i),this.setAttribute("position",new un(r,3)),this.setAttribute("normal",new un(s,3)),this.setAttribute("uv",new un(o,2));function c(u){const h=r.length/3,p=u.extractPoints(t);let m=p.shape;const y=p.holes;iu.isClockWise(m)===!1&&(m=m.reverse());for(let w=0,v=y.length;w<v;w++){const T=y[w];iu.isClockWise(T)===!0&&(y[w]=T.reverse())}const b=iu.triangulateShape(m,y);for(let w=0,v=y.length;w<v;w++){const T=y[w];m=m.concat(T)}for(let w=0,v=m.length;w<v;w++){const T=m[w];r.push(T.x,T.y,0),s.push(0,0,1),o.push(T.x,T.y)}for(let w=0,v=b.length;w<v;w++){const T=b[w],S=T[0]+h,M=T[1]+h,P=T[2]+h;i.push(S,M,P),l+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return YRe(t,e)}static fromJSON(e,t){const i=[];for(let r=0,s=e.shapes.length;r<s;r++){const o=t[e.shapes[r]];i.push(o)}return new Z9(i,e.curveSegments)}}function YRe(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,i=n.length;t<i;t++){const r=n[t];e.shapes.push(r.uuid)}else e.shapes.push(n.uuid);return e}let JD=class Qne extends Jn{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new ye,p=new ye,m=[],y=[],b=[],w=[];for(let v=0;v<=i;v++){const T=[],S=v/i;let M=0;v===0&&o===0?M=.5/t:v===i&&l===Math.PI&&(M=-.5/t);for(let P=0;P<=t;P++){const R=P/t;h.x=-e*Math.cos(r+R*s)*Math.sin(o+S*a),h.y=e*Math.cos(o+S*a),h.z=e*Math.sin(r+R*s)*Math.sin(o+S*a),y.push(h.x,h.y,h.z),p.copy(h).normalize(),b.push(p.x,p.y,p.z),w.push(R+M,1-S),T.push(c++)}u.push(T)}for(let v=0;v<i;v++)for(let T=0;T<t;T++){const S=u[v][T+1],M=u[v][T],P=u[v+1][T],R=u[v+1][T+1];(v!==0||o>0)&&m.push(S,M,R),(v!==i-1||l<Math.PI)&&m.push(M,P,R)}this.setIndex(m),this.setAttribute("position",new un(y,3)),this.setAttribute("normal",new un(b,3)),this.setAttribute("uv",new un(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Qne(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}};class Y9 extends Z0{constructor(e=1,t=0){const i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],r=[2,1,0,0,3,2,1,3,0,2,3,1];super(i,r,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Y9(e.radius,e.detail)}}class X9 extends Jn{constructor(e=1,t=.4,i=12,r=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:s},i=Math.floor(i),r=Math.floor(r);const o=[],a=[],l=[],c=[],u=new ye,h=new ye,p=new ye;for(let m=0;m<=i;m++)for(let y=0;y<=r;y++){const b=y/r*s,w=m/i*Math.PI*2;h.x=(e+t*Math.cos(w))*Math.cos(b),h.y=(e+t*Math.cos(w))*Math.sin(b),h.z=t*Math.sin(w),a.push(h.x,h.y,h.z),u.x=e*Math.cos(b),u.y=e*Math.sin(b),p.subVectors(h,u).normalize(),l.push(p.x,p.y,p.z),c.push(y/r),c.push(m/i)}for(let m=1;m<=i;m++)for(let y=1;y<=r;y++){const b=(r+1)*m+y-1,w=(r+1)*(m-1)+y-1,v=(r+1)*(m-1)+y,T=(r+1)*m+y;o.push(b,w,T),o.push(w,v,T)}this.setIndex(o),this.setAttribute("position",new un(a,3)),this.setAttribute("normal",new un(l,3)),this.setAttribute("uv",new un(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new X9(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Q9 extends Jn{constructor(e=1,t=.4,i=64,r=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:s,q:o},i=Math.floor(i),r=Math.floor(r);const a=[],l=[],c=[],u=[],h=new ye,p=new ye,m=new ye,y=new ye,b=new ye,w=new ye,v=new ye;for(let S=0;S<=i;++S){const M=S/i*s*Math.PI*2;T(M,s,o,e,m),T(M+.01,s,o,e,y),w.subVectors(y,m),v.addVectors(y,m),b.crossVectors(w,v),v.crossVectors(b,w),b.normalize(),v.normalize();for(let P=0;P<=r;++P){const R=P/r*Math.PI*2,O=-t*Math.cos(R),B=t*Math.sin(R);h.x=m.x+(O*v.x+B*b.x),h.y=m.y+(O*v.y+B*b.y),h.z=m.z+(O*v.z+B*b.z),l.push(h.x,h.y,h.z),p.subVectors(h,m).normalize(),c.push(p.x,p.y,p.z),u.push(S/i),u.push(P/r)}}for(let S=1;S<=i;S++)for(let M=1;M<=r;M++){const P=(r+1)*(S-1)+(M-1),R=(r+1)*S+(M-1),O=(r+1)*S+M,B=(r+1)*(S-1)+M;a.push(P,R,B),a.push(R,O,B)}this.setIndex(a),this.setAttribute("position",new un(l,3)),this.setAttribute("normal",new un(c,3)),this.setAttribute("uv",new un(u,2));function T(S,M,P,R,O){const B=Math.cos(S),N=Math.sin(S),I=P/M*S,F=Math.cos(I);O.x=R*(2+F)*.5*B,O.y=R*(2+F)*N*.5,O.z=R*Math.sin(I)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Q9(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class J9 extends Jn{constructor(e=new XD(new ye(-1,-1,0),new ye(-1,1,0),new ye(1,1,0)),t=64,i=1,r=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new ye,l=new ye,c=new Et;let u=new ye;const h=[],p=[],m=[],y=[];b(),this.setIndex(y),this.setAttribute("position",new un(h,3)),this.setAttribute("normal",new un(p,3)),this.setAttribute("uv",new un(m,2));function b(){for(let S=0;S<t;S++)w(S);w(s===!1?t:0),T(),v()}function w(S){u=e.getPointAt(S/t,u);const M=o.normals[S],P=o.binormals[S];for(let R=0;R<=r;R++){const O=R/r*Math.PI*2,B=Math.sin(O),N=-Math.cos(O);l.x=N*M.x+B*P.x,l.y=N*M.y+B*P.y,l.z=N*M.z+B*P.z,l.normalize(),p.push(l.x,l.y,l.z),a.x=u.x+i*l.x,a.y=u.y+i*l.y,a.z=u.z+i*l.z,h.push(a.x,a.y,a.z)}}function v(){for(let S=1;S<=t;S++)for(let M=1;M<=r;M++){const P=(r+1)*(S-1)+(M-1),R=(r+1)*S+(M-1),O=(r+1)*S+M,B=(r+1)*(S-1)+M;y.push(P,R,B),y.push(R,O,B)}}function T(){for(let S=0;S<=t;S++)for(let M=0;M<=r;M++)c.x=S/t,c.y=M/r,m.push(c.x,c.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new J9(new bE[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Jne extends Jn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],i=new Set,r=new ye,s=new ye;if(e.index!==null){const o=e.attributes.position,a=e.index;let l=e.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,u=l.length;c<u;++c){const h=l[c],p=h.start,m=h.count;for(let y=p,b=p+m;y<b;y+=3)for(let w=0;w<3;w++){const v=a.getX(y+w),T=a.getX(y+(w+1)%3);r.fromBufferAttribute(o,v),s.fromBufferAttribute(o,T),dH(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const u=3*a+c,h=3*a+(c+1)%3;r.fromBufferAttribute(o,u),s.fromBufferAttribute(o,h),dH(r,s,i)===!0&&(t.push(r.x,r.y,r.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new un(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function dH(n,e,t){const i=`${n.x},${n.y},${n.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${n.x},${n.y},${n.z}`;return t.has(i)===!0||t.has(r)===!0?!1:(t.add(i),t.add(r),!0)}var fH=Object.freeze({__proto__:null,BoxGeometry:T1,CapsuleGeometry:j9,CircleGeometry:V9,ConeGeometry:Z_,CylinderGeometry:q_,DodecahedronGeometry:H9,EdgesGeometry:Vne,ExtrudeGeometry:G9,IcosahedronGeometry:W9,LatheGeometry:K9,OctahedronGeometry:Y_,PlaneGeometry:bx,PolyhedronGeometry:Z0,RingGeometry:q9,ShapeGeometry:Z9,SphereGeometry:JD,TetrahedronGeometry:Y9,TorusGeometry:X9,TorusKnotGeometry:Q9,TubeGeometry:J9,WireframeGeometry:Jne});class eie extends Go{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new an(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class eO extends _c{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class tO extends Go{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new an(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=K0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fu,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class tie extends tO{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Et(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Bn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new an(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new an(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new an(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class nie extends Go{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new an(16777215),this.specular=new an(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=K0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fu,this.combine=$_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class iie extends Go{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new an(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=K0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class rie extends Go{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=K0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class sie extends Go{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new an(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new an(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=K0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fu,this.combine=$_,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nO extends Go{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=hne,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class iO extends Go{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class oie extends Go{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new an(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=K0,this.normalScale=new Et(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class aie extends ya{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function mm(n,e){return!n||n.constructor===e?n:typeof e.BYTES_PER_ELEMENT=="number"?new e(n):Array.prototype.slice.call(n)}function lie(n){function e(r,s){return n[r]-n[s]}const t=n.length,i=new Array(t);for(let r=0;r!==t;++r)i[r]=r;return i.sort(e),i}function zN(n,e,t){const i=n.length,r=new n.constructor(i);for(let s=0,o=0;o!==i;++s){const a=t[s]*e;for(let l=0;l!==e;++l)r[o++]=n[a+l]}return r}function rO(n,e,t,i){let r=1,s=n[0];for(;s!==void 0&&s[i]===void 0;)s=n[r++];if(s===void 0)return;let o=s[i];if(o!==void 0)if(Array.isArray(o))do o=s[i],o!==void 0&&(e.push(s.time),t.push(...o)),s=n[r++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[i],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=n[r++];while(s!==void 0);else do o=s[i],o!==void 0&&(e.push(s.time),t.push(o)),s=n[r++];while(s!==void 0)}function XRe(n,e,t,i,r=30){const s=n.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),h=[],p=[];for(let m=0;m<c.times.length;++m){const y=c.times[m]*r;if(!(y<t||y>=i)){h.push(c.times[m]);for(let b=0;b<u;++b)p.push(c.values[m*u+b])}}h.length!==0&&(c.times=mm(h,c.times.constructor),c.values=mm(p,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s}function QRe(n,e=0,t=n,i=30){i<=0&&(i=30);const r=t.tracks.length,s=e/i;for(let o=0;o<r;++o){const a=t.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=n.tracks.find(function(v){return v.name===a.name&&v.ValueTypeName===l});if(c===void 0)continue;let u=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let p=0;const m=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(p=m/3);const y=a.times.length-1;let b;if(s<=a.times[0]){const v=u,T=h-u;b=a.values.slice(v,T)}else if(s>=a.times[y]){const v=y*h+u,T=v+h-u;b=a.values.slice(v,T)}else{const v=a.createInterpolant(),T=u,S=h-u;v.evaluate(s),b=v.resultBuffer.slice(T,S)}l==="quaternion"&&new Uo().fromArray(b).normalize().conjugate().toArray(b);const w=c.times.length;for(let v=0;v<w;++v){const T=v*m+p;if(l==="quaternion")Uo.multiplyQuaternionsFlat(c.values,T,b,0,c.values,T);else{const S=m-p*2;for(let M=0;M<S;++M)c.values[T+M]-=b[M]}}}return n.blendMode=OD,n}class JRe{static convertArray(e,t){return mm(e,t)}static isTypedArray(e){return bne(e)}static getKeyframeOrder(e){return lie(e)}static sortedArray(e,t,i){return zN(e,t,i)}static flattenJSON(e,t,i,r){rO(e,t,i,r)}static subclip(e,t,i,r,s=30){return XRe(e,t,i,r,s)}static makeClipAdditive(e,t=0,i=e,r=30){return QRe(e,t,i,r)}}class X_{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=r!==void 0?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(r===void 0){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(!(e>=s)){const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0;break n}break e}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(r===void 0)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class cie extends X_{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:fm,endingEnd:fm}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(a===void 0)switch(this.getSettings_().endingStart){case pm:s=e,a=2*t-i;break;case Lb:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(l===void 0)switch(this.getSettings_().endingEnd){case pm:o=e,l=2*i-t;break;case Lb:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=(i-t)*.5,u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,h=this._offsetNext,p=this._weightPrev,m=this._weightNext,y=(i-t)/(r-t),b=y*y,w=b*y,v=-p*w+2*p*b-p*y,T=(1+p)*w+(-1.5-2*p)*b+(-.5+p)*y+1,S=(-1-m)*w+(1.5+m)*b+.5*y,M=m*w-m*b;for(let P=0;P!==a;++P)s[P]=v*o[u+P]+T*o[c+P]+S*o[l+P]+M*o[h+P];return s}}class sO extends X_{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),h=1-u;for(let p=0;p!==a;++p)s[p]=o[c+p]*h+o[l+p]*u;return s}}class uie extends X_{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Sc{constructor(e,t,i,r){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=mm(t,this.TimeBufferType),this.values=mm(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:mm(e.times,Array),values:mm(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new uie(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new sO(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new cie(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case kb:t=this.InterpolantFactoryMethodDiscrete;break;case yE:t=this.InterpolantFactoryMethodLinear;break;case US:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return Wt("KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return kb;case this.InterpolantFactoryMethodLinear:return yE;case this.InterpolantFactoryMethodSmooth:return US}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;o!==-1&&i[o]>t;)--o;if(++o,s!==0||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=i.slice(s,o),this.values=this.values.slice(s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(xn("KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;s===0&&(xn("KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if(typeof l=="number"&&isNaN(l)){xn("KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(o!==null&&o>l){xn("KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(r!==void 0&&bne(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){xn("KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),i=this.getValueSize(),r=this.getInterpolation()===US,s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a],u=e[a+1];if(c!==u&&(a!==1||c!==e[0]))if(r)l=!0;else{const h=a*i,p=h-i,m=h+i;for(let y=0;y!==i;++y){const b=t[h+y];if(b!==t[p+y]||b!==t[m+y]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const h=a*i,p=o*i;for(let m=0;m!==i;++m)t[p+m]=t[h+m]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*i)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),i=this.constructor,r=new i(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Sc.prototype.ValueTypeName="";Sc.prototype.TimeBufferType=Float32Array;Sc.prototype.ValueBufferType=Float32Array;Sc.prototype.DefaultInterpolation=yE;class A1 extends Sc{constructor(e,t,i){super(e,t,i)}}A1.prototype.ValueTypeName="bool";A1.prototype.ValueBufferType=Array;A1.prototype.DefaultInterpolation=kb;A1.prototype.InterpolantFactoryMethodLinear=void 0;A1.prototype.InterpolantFactoryMethodSmooth=void 0;class oO extends Sc{constructor(e,t,i,r){super(e,t,i,r)}}oO.prototype.ValueTypeName="color";class Vb extends Sc{constructor(e,t,i,r){super(e,t,i,r)}}Vb.prototype.ValueTypeName="number";class hie extends X_{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Uo.slerpFlat(s,0,o,c-a,o,c,l);return s}}class Q_ extends Sc{constructor(e,t,i,r){super(e,t,i,r)}InterpolantFactoryMethodLinear(e){return new hie(this.times,this.values,this.getValueSize(),e)}}Q_.prototype.ValueTypeName="quaternion";Q_.prototype.InterpolantFactoryMethodSmooth=void 0;class C1 extends Sc{constructor(e,t,i){super(e,t,i)}}C1.prototype.ValueTypeName="string";C1.prototype.ValueBufferType=Array;C1.prototype.DefaultInterpolation=kb;C1.prototype.InterpolantFactoryMethodLinear=void 0;C1.prototype.InterpolantFactoryMethodSmooth=void 0;class Hb extends Sc{constructor(e,t,i,r){super(e,t,i,r)}}Hb.prototype.ValueTypeName="vector";class $b{constructor(e="",t=-1,i=[],r=I9){this.name=e,this.tracks=i,this.duration=t,this.blendMode=r,this.uuid=Tl(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,r=1/(e.fps||1);for(let o=0,a=i.length;o!==a;++o)t.push(tIe(i[o]).scale(r));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,o=i.length;s!==o;++s)t.push(Sc.toJSON(i[s]));return r}static CreateFromMorphTargetSequence(e,t,i,r){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=lie(l);l=zN(l,1,u),c=zN(c,1,u),!r&&l[0]===0&&(l.push(s),c.push(c[0])),o.push(new Vb(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/i))}return new this(e,-1,o)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const r=e;i=r.geometry&&r.geometry.animations||r.animations}for(let r=0;r<i.length;r++)if(i[r].name===t)return i[r];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const r={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const h=u[1];let p=r[h];p||(r[h]=p=[]),p.push(c)}}const o=[];for(const a in r)o.push(this.CreateFromMorphTargetSequence(a,r[a],t,i));return o}static parseAnimation(e,t){if(Wt("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return xn("AnimationClip: No animation in JSONLoader data."),null;const i=function(h,p,m,y,b){if(m.length!==0){const w=[],v=[];rO(m,w,v,y),w.length!==0&&b.push(new h(p,w,v))}},r=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let h=0;h<c.length;h++){const p=c[h].keys;if(!(!p||p.length===0))if(p[0].morphTargets){const m={};let y;for(y=0;y<p.length;y++)if(p[y].morphTargets)for(let b=0;b<p[y].morphTargets.length;b++)m[p[y].morphTargets[b]]=-1;for(const b in m){const w=[],v=[];for(let T=0;T!==p[y].morphTargets.length;++T){const S=p[y];w.push(S.time),v.push(S.morphTarget===b?1:0)}r.push(new Vb(".morphTargetInfluence["+b+"]",w,v))}l=m.length*o}else{const m=".bones["+t[h].name+"]";i(Hb,m+".position",p,"pos",r),i(Q_,m+".quaternion",p,"rot",r),i(Hb,m+".scale",p,"scl",r)}}return r.length===0?null:new this(s,l,r,a)}resetDuration(){const e=this.tracks;let t=0;for(let i=0,r=e.length;i!==r;++i){const s=this.tracks[i];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let i=0;i<this.tracks.length;i++)e.push(this.tracks[i].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function eIe(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Vb;case"vector":case"vector2":case"vector3":case"vector4":return Hb;case"color":return oO;case"quaternion":return Q_;case"bool":case"boolean":return A1;case"string":return C1}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}function tIe(n){if(n.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=eIe(n.type);if(n.times===void 0){const t=[],i=[];rO(n.keys,t,i,"value"),n.times=t,n.values=i}return e.parse!==void 0?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const nh={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};let aO=class{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this._abortController=null,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,p=c.length;h<p;h+=2){const m=c[h],y=c[h+1];if(m.global&&(m.lastIndex=0),m.test(u))return y}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}};const die=new aO;let el=class{constructor(e){this.manager=e!==void 0?e:die,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}};el.DEFAULT_MATERIAL_NAME="__DEFAULT";const $h={};class nIe extends Error{constructor(e,t){super(e),this.response=t}}class Od extends el{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=nh.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if($h[e]!==void 0){$h[e].push({onLoad:t,onProgress:i,onError:r});return}$h[e]=[],$h[e].push({onLoad:t,onProgress:i,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&Wt("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=$h[e],h=c.body.getReader(),p=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),m=p?parseInt(p):0,y=m!==0;let b=0;const w=new ReadableStream({start(v){T();function T(){h.read().then(({done:S,value:M})=>{if(S)v.close();else{b+=M.byteLength;const P=new ProgressEvent("progress",{lengthComputable:y,loaded:b,total:m});for(let R=0,O=u.length;R<O;R++){const B=u[R];B.onProgress&&B.onProgress(P)}v.enqueue(M),T()}},S=>{v.error(S)})}}});return new Response(w)}else throw new nIe(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a==="")return c.text();{const h=/charset="?([^;"\s]*)"?/i.exec(a),p=h&&h[1]?h[1].toLowerCase():void 0,m=new TextDecoder(p);return c.arrayBuffer().then(y=>m.decode(y))}}}).then(c=>{nh.add(`file:${e}`,c);const u=$h[e];delete $h[e];for(let h=0,p=u.length;h<p;h++){const m=u[h];m.onLoad&&m.onLoad(c)}}).catch(c=>{const u=$h[e];if(u===void 0)throw this.manager.itemError(e),c;delete $h[e];for(let h=0,p=u.length;h<p;h++){const m=u[h];m.onError&&m.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class iIe extends el{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new Od(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):xn(l),s.manager.itemError(e)}},i,r)}parse(e){const t=[];for(let i=0;i<e.length;i++){const r=$b.parse(e[i]);t.push(r)}return t}}class rIe extends el{constructor(e){super(e)}load(e,t,i,r){const s=this,o=[],a=new z9,l=new Od(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(s.withCredentials);let c=0;function u(h){l.load(e[h],function(p){const m=s.parse(p,!0);o[h]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},c+=1,c===6&&(m.mipmapCount===1&&(a.minFilter=mr),a.image=o,a.format=m.format,a.needsUpdate=!0,t&&t(a))},i,r)}if(Array.isArray(e))for(let h=0,p=e.length;h<p;++h)u(h);else l.load(e,function(h){const p=s.parse(h,!0);if(p.isCubemap){const m=p.mipmaps.length/p.mipmapCount;for(let y=0;y<m;y++){o[y]={mipmaps:[]};for(let b=0;b<p.mipmapCount;b++)o[y].mipmaps.push(p.mipmaps[y*p.mipmapCount+b]),o[y].format=p.format,o[y].width=p.width,o[y].height=p.height}a.image=o}else a.image.width=p.width,a.image.height=p.height,a.mipmaps=p.mipmaps;p.mipmapCount===1&&(a.minFilter=mr),a.format=p.format,a.needsUpdate=!0,t&&t(a)},i,r);return a}}const Sg=new WeakMap;let Gb=class extends el{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=nh.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0);else{let h=Sg.get(o);h===void 0&&(h=[],Sg.set(o,h)),h.push({onLoad:t,onError:r})}return o}const a=Bb("img");function l(){u(),t&&t(this);const h=Sg.get(this)||[];for(let p=0;p<h.length;p++){const m=h[p];m.onLoad&&m.onLoad(this)}Sg.delete(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),nh.remove(`image:${e}`);const p=Sg.get(this)||[];for(let m=0;m<p.length;m++){const y=p[m];y.onError&&y.onError(h)}Sg.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),nh.add(`image:${e}`,a),s.manager.itemStart(e),a.src=e,a}};class sIe extends el{constructor(e){super(e)}load(e,t,i,r){const s=new K_;s.colorSpace=ka;const o=new Gb(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,a===6&&(s.needsUpdate=!0,t&&t(s))},void 0,r)}for(let c=0;c<e.length;++c)l(c);return s}}class oIe extends el{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new cu,a=new Od(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(s.withCredentials),a.load(e,function(l){let c;try{c=s.parse(l)}catch(u){if(r!==void 0)r(u);else{u(u);return}}c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:Ga,o.wrapT=c.wrapT!==void 0?c.wrapT:Ga,o.magFilter=c.magFilter!==void 0?c.magFilter:mr,o.minFilter=c.minFilter!==void 0?c.minFilter:mr,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(o.colorSpace=c.colorSpace),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=th),c.mipmapCount===1&&(o.minFilter=mr),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,t&&t(o,c)},i,r),o}}let aIe=class extends el{constructor(e){super(e)}load(e,t,i,r){const s=new Gs,o=new Gb(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}};class Y0 extends Qi{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new an(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class fie extends Y0{constructor(e,t,i){super(e,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.groundColor=new an(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const JC=new Hn,pH=new ye,mH=new ye;class lO{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Et(512,512),this.mapType=ca,this.map=null,this.mapPass=null,this.matrix=new Hn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vx,this._frameExtents=new Et(1,1),this._viewportCount=1,this._viewports=[new fr(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;pH.setFromMatrixPosition(e.matrixWorld),t.position.copy(pH),mH.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(mH),t.updateMatrixWorld(),JC.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(JC,t.coordinateSystem,t.reversedDepth),t.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(JC)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class lIe extends lO{constructor(){super(new ns(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,i=Z2*2*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(i!==t.fov||r!==t.aspect||s!==t.far)&&(t.fov=i,t.aspect=r,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class pie extends Y0{constructor(e,t,i=0,r=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.target=new Qi,this.distance=i,this.angle=r,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new lIe}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class cIe extends lO{constructor(){super(new ns(90,1,.5,500)),this.isPointLightShadow=!0}}class mie extends Y0{constructor(e,t,i=0,r=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=r,this.shadow=new cIe}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class Cd extends W_{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class uIe extends lO{constructor(){super(new Cd(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class gie extends Y0{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Qi.DEFAULT_UP),this.updateMatrix(),this.target=new Qi,this.shadow=new uIe}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class yie extends Y0{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class xie extends Y0{constructor(e,t,i=10,r=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class cO{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ye)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*i),t.addScaledVector(o[4],1.092548*(i*r)),t.addScaledVector(o[5],1.092548*(r*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(i*s)),t.addScaledVector(o[8],.546274*(i*i-r*r)),t}getIrradianceAt(e,t){const i=e.x,r=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*r),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*i),t.addScaledVector(o[4],2*.429043*i*r),t.addScaledVector(o[5],2*.429043*r*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*i*s),t.addScaledVector(o[8],.429043*(i*i-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].fromArray(e,t+r*3);return this}toArray(e=[],t=0){const i=this.coefficients;for(let r=0;r<9;r++)i[r].toArray(e,t+r*3);return e}static getBasisAt(e,t){const i=e.x,r=e.y,s=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*r,t[5]=1.092548*r*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-r*r)}}class vie extends Y0{constructor(e=new cO,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class eT extends el{constructor(e){super(e),this.textures={}}load(e,t,i,r){const s=this,o=new Od(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):xn(l),s.manager.itemError(e)}},i,r)}parse(e){const t=this.textures;function i(s){return t[s]===void 0&&Wt("MaterialLoader: Undefined texture",s),t[s]}const r=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(r.uuid=e.uuid),e.name!==void 0&&(r.name=e.name),e.color!==void 0&&r.color!==void 0&&r.color.setHex(e.color),e.roughness!==void 0&&(r.roughness=e.roughness),e.metalness!==void 0&&(r.metalness=e.metalness),e.sheen!==void 0&&(r.sheen=e.sheen),e.sheenColor!==void 0&&(r.sheenColor=new an().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(r.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&r.emissive!==void 0&&r.emissive.setHex(e.emissive),e.specular!==void 0&&r.specular!==void 0&&r.specular.setHex(e.specular),e.specularIntensity!==void 0&&(r.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&r.specularColor!==void 0&&r.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(r.shininess=e.shininess),e.clearcoat!==void 0&&(r.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(r.dispersion=e.dispersion),e.iridescence!==void 0&&(r.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(r.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(r.transmission=e.transmission),e.thickness!==void 0&&(r.thickness=e.thickness),e.attenuationDistance!==void 0&&(r.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&r.attenuationColor!==void 0&&r.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(r.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(r.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.combine!==void 0&&(r.combine=e.combine),e.side!==void 0&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.opacity!==void 0&&(r.opacity=e.opacity),e.transparent!==void 0&&(r.transparent=e.transparent),e.alphaTest!==void 0&&(r.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(r.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(r.blendSrc=e.blendSrc),e.blendDst!==void 0&&(r.blendDst=e.blendDst),e.blendEquation!==void 0&&(r.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(r.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(r.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(r.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&r.blendColor!==void 0&&r.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(r.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(r.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(r.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(r.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(r.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(r.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(r.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(r.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(r.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.linewidth!==void 0&&(r.linewidth=e.linewidth),e.dashSize!==void 0&&(r.dashSize=e.dashSize),e.gapSize!==void 0&&(r.gapSize=e.gapSize),e.scale!==void 0&&(r.scale=e.scale),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(r.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(r.allowOverride=e.allowOverride),e.visible!==void 0&&(r.visible=e.visible),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped),e.userData!==void 0&&(r.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(r.uniforms[s]={},o.type){case"t":r.uniforms[s].value=i(o.value);break;case"c":r.uniforms[s].value=new an().setHex(o.value);break;case"v2":r.uniforms[s].value=new Et().fromArray(o.value);break;case"v3":r.uniforms[s].value=new ye().fromArray(o.value);break;case"v4":r.uniforms[s].value=new fr().fromArray(o.value);break;case"m3":r.uniforms[s].value=new ti().fromArray(o.value);break;case"m4":r.uniforms[s].value=new Hn().fromArray(o.value);break;default:r.uniforms[s].value=o.value}}if(e.defines!==void 0&&(r.defines=e.defines),e.vertexShader!==void 0&&(r.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(r.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(r.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)r.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(r.lights=e.lights),e.clipping!==void 0&&(r.clipping=e.clipping),e.size!==void 0&&(r.size=e.size),e.sizeAttenuation!==void 0&&(r.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(r.map=i(e.map)),e.matcap!==void 0&&(r.matcap=i(e.matcap)),e.alphaMap!==void 0&&(r.alphaMap=i(e.alphaMap)),e.bumpMap!==void 0&&(r.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(r.bumpScale=e.bumpScale),e.normalMap!==void 0&&(r.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(r.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),r.normalScale=new Et().fromArray(s)}return e.displacementMap!==void 0&&(r.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(r.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(r.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(r.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(r.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(r.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(r.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(r.specularMap=i(e.specularMap)),e.specularIntensityMap!==void 0&&(r.specularIntensityMap=i(e.specularIntensityMap)),e.specularColorMap!==void 0&&(r.specularColorMap=i(e.specularColorMap)),e.envMap!==void 0&&(r.envMap=i(e.envMap)),e.envMapRotation!==void 0&&r.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(r.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(r.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(r.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(r.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(r.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(r.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(r.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(r.gradientMap=i(e.gradientMap)),e.clearcoatMap!==void 0&&(r.clearcoatMap=i(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(r.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(r.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(r.clearcoatNormalScale=new Et().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(r.iridescenceMap=i(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(r.iridescenceThicknessMap=i(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(r.transmissionMap=i(e.transmissionMap)),e.thicknessMap!==void 0&&(r.thicknessMap=i(e.thicknessMap)),e.anisotropyMap!==void 0&&(r.anisotropyMap=i(e.anisotropyMap)),e.sheenColorMap!==void 0&&(r.sheenColorMap=i(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(r.sheenRoughnessMap=i(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return eT.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:eie,SpriteMaterial:HD,RawShaderMaterial:eO,ShaderMaterial:_c,PointsMaterial:GD,MeshPhysicalMaterial:tie,MeshStandardMaterial:tO,MeshPhongMaterial:nie,MeshToonMaterial:iie,MeshNormalMaterial:rie,MeshLambertMaterial:sie,MeshDepthMaterial:nO,MeshDistanceMaterial:iO,MeshBasicMaterial:q0,MeshMatcapMaterial:oie,LineDashedMaterial:aie,LineBasicMaterial:ya,Material:Go};return new t[e]}}class jN{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class bie extends Jn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class _ie extends el{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new Od(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(a){try{t(s.parse(JSON.parse(a)))}catch(l){r?r(l):xn(l),s.manager.itemError(e)}},i,r)}parse(e){const t={},i={};function r(m,y){if(t[y]!==void 0)return t[y];const w=m.interleavedBuffers[y],v=s(m,w.buffer),T=dy(w.type,v),S=new B9(T,w.stride);return S.uuid=w.uuid,t[y]=S,S}function s(m,y){if(i[y]!==void 0)return i[y];const w=m.arrayBuffers[y],v=new Uint32Array(w).buffer;return i[y]=v,v}const o=e.isInstancedBufferGeometry?new bie:new Jn,a=e.data.index;if(a!==void 0){const m=dy(a.type,a.array);o.setIndex(new lr(m,1))}const l=e.data.attributes;for(const m in l){const y=l[m];let b;if(y.isInterleavedBufferAttribute){const w=r(e.data,y.data);b=new r1(w,y.itemSize,y.offset,y.normalized)}else{const w=dy(y.type,y.array),v=y.isInstancedBufferAttribute?X2:lr;b=new v(w,y.itemSize,y.normalized)}y.name!==void 0&&(b.name=y.name),y.usage!==void 0&&b.setUsage(y.usage),o.setAttribute(m,b)}const c=e.data.morphAttributes;if(c)for(const m in c){const y=c[m],b=[];for(let w=0,v=y.length;w<v;w++){const T=y[w];let S;if(T.isInterleavedBufferAttribute){const M=r(e.data,T.data);S=new r1(M,T.itemSize,T.offset,T.normalized)}else{const M=dy(T.type,T.array);S=new lr(M,T.itemSize,T.normalized)}T.name!==void 0&&(S.name=T.name),b.push(S)}o.morphAttributes[m]=b}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const h=e.data.groups||e.data.drawcalls||e.data.offsets;if(h!==void 0)for(let m=0,y=h.length;m!==y;++m){const b=h[m];o.addGroup(b.start,b.count,b.materialIndex)}const p=e.data.boundingSphere;return p!==void 0&&(o.boundingSphere=new ro().fromJSON(p)),e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class hIe extends el{constructor(e){super(e)}load(e,t,i,r){const s=this,o=this.path===""?jN.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const a=new Od(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){let c=null;try{c=JSON.parse(l)}catch(h){r!==void 0&&r(h),h("ObjectLoader: Can't parse "+e+".",h.message);return}const u=c.metadata;if(u===void 0||u.type===void 0||u.type.toLowerCase()==="geometry"){r!==void 0&&r(new Error("THREE.ObjectLoader: Can't load "+e)),xn("ObjectLoader: Can't load "+e);return}s.parse(c,t)},i,r)}async loadAsync(e,t){const i=this,r=this.path===""?jN.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const s=new Od(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await i.parseAsync(a)}parse(e,t){const i=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,function(){t!==void 0&&t(c)}),a=this.parseTextures(e.textures,o),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,s,l,a,i),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),this.bindLightTargets(c),t!==void 0){let h=!1;for(const p in o)if(o[p].data instanceof HTMLImageElement){h=!0;break}h===!1&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,r,a,o,t),c=this.parseSkeletons(e.skeletons,l);return this.bindSkeletons(l,c),this.bindLightTargets(l),l}parseShapes(e){const t={};if(e!==void 0)for(let i=0,r=e.length;i<r;i++){const s=new Om().fromJSON(e[i]);t[s.uuid]=s}return t}parseSkeletons(e,t){const i={},r={};if(t.traverse(function(s){s.isBone&&(r[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=new U9().fromJSON(e[s],r);i[a.uuid]=a}return i}parseGeometries(e,t){const i={};if(e!==void 0){const r=new _ie;for(let s=0,o=e.length;s<o;s++){let a;const l=e[s];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=r.parse(l);break;default:l.type in fH?a=fH[l.type].fromJSON(l,t):Wt(`ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),i[l.uuid]=a}}return i}parseMaterials(e,t){const i={},r={};if(e!==void 0){const s=new eT;s.setTextures(t);for(let o=0,a=e.length;o<a;o++){const l=e[o];i[l.uuid]===void 0&&(i[l.uuid]=s.parse(l)),r[l.uuid]=i[l.uuid]}}return r}parseAnimations(e){const t={};if(e!==void 0)for(let i=0;i<e.length;i++){const r=e[i],s=$b.parse(r);t[s.uuid]=s}return t}parseImages(e,t){const i=this,r={};let s;function o(l){return i.manager.itemStart(l),s.load(l,function(){i.manager.itemEnd(l)},void 0,function(){i.manager.itemError(l),i.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,u=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:i.resourcePath+c;return o(u)}else return l.data?{data:dy(l.type,l.data),width:l.width,height:l.height}:null}if(e!==void 0&&e.length>0){const l=new aO(t);s=new Gb(l),s.setCrossOrigin(this.crossOrigin);for(let c=0,u=e.length;c<u;c++){const h=e[c],p=h.url;if(Array.isArray(p)){const m=[];for(let y=0,b=p.length;y<b;y++){const w=p[y],v=a(w);v!==null&&(v instanceof HTMLImageElement?m.push(v):m.push(new cu(v.data,v.width,v.height)))}r[h.uuid]=new r0(m)}else{const m=a(h.url);r[h.uuid]=new r0(m)}}}return r}async parseImagesAsync(e){const t=this,i={};let r;async function s(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:t.resourcePath+a;return await r.loadAsync(l)}else return o.data?{data:dy(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){r=new Gb(this.manager),r.setCrossOrigin(this.crossOrigin);for(let o=0,a=e.length;o<a;o++){const l=e[o],c=l.url;if(Array.isArray(c)){const u=[];for(let h=0,p=c.length;h<p;h++){const m=c[h],y=await s(m);y!==null&&(y instanceof HTMLImageElement?u.push(y):u.push(new cu(y.data,y.width,y.height)))}i[l.uuid]=new r0(u)}else{const u=await s(l.url);i[l.uuid]=new r0(u)}}}return i}parseTextures(e,t){function i(s,o){return typeof s=="number"?s:(Wt("ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const r={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const a=e[s];a.image===void 0&&Wt('ObjectLoader: No "image" specified for',a.uuid),t[a.image]===void 0&&Wt("ObjectLoader: Undefined image",a.image);const l=t[a.image],c=l.data;let u;Array.isArray(c)?(u=new K_,c.length===6&&(u.needsUpdate=!0)):(c&&c.data?u=new cu:u=new Gs,c&&(u.needsUpdate=!0)),u.source=l,u.uuid=a.uuid,a.name!==void 0&&(u.name=a.name),a.mapping!==void 0&&(u.mapping=i(a.mapping,dIe)),a.channel!==void 0&&(u.channel=a.channel),a.offset!==void 0&&u.offset.fromArray(a.offset),a.repeat!==void 0&&u.repeat.fromArray(a.repeat),a.center!==void 0&&u.center.fromArray(a.center),a.rotation!==void 0&&(u.rotation=a.rotation),a.wrap!==void 0&&(u.wrapS=i(a.wrap[0],gH),u.wrapT=i(a.wrap[1],gH)),a.format!==void 0&&(u.format=a.format),a.internalFormat!==void 0&&(u.internalFormat=a.internalFormat),a.type!==void 0&&(u.type=a.type),a.colorSpace!==void 0&&(u.colorSpace=a.colorSpace),a.minFilter!==void 0&&(u.minFilter=i(a.minFilter,yH)),a.magFilter!==void 0&&(u.magFilter=i(a.magFilter,yH)),a.anisotropy!==void 0&&(u.anisotropy=a.anisotropy),a.flipY!==void 0&&(u.flipY=a.flipY),a.generateMipmaps!==void 0&&(u.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(u.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(u.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(u.compareFunction=a.compareFunction),a.userData!==void 0&&(u.userData=a.userData),r[a.uuid]=u}return r}parseObject(e,t,i,r,s){let o;function a(p){return t[p]===void 0&&Wt("ObjectLoader: Undefined geometry",p),t[p]}function l(p){if(p!==void 0){if(Array.isArray(p)){const m=[];for(let y=0,b=p.length;y<b;y++){const w=p[y];i[w]===void 0&&Wt("ObjectLoader: Undefined material",w),m.push(i[w])}return m}return i[p]===void 0&&Wt("ObjectLoader: Undefined material",p),i[p]}}function c(p){return r[p]===void 0&&Wt("ObjectLoader: Undefined texture",p),r[p]}let u,h;switch(e.type){case"Scene":o=new VD,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new an(e.background):o.background=c(e.background)),e.environment!==void 0&&(o.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new O9(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new D9(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new ns(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Cd(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new yie(e.color,e.intensity);break;case"DirectionalLight":o=new gie(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new mie(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new xie(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new pie(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new fie(e.color,e.groundColor,e.intensity);break;case"LightProbe":const p=new cO().fromArray(e.sh);o=new vie(p,e.intensity);break;case"SkinnedMesh":u=a(e.geometry),h=l(e.material),o=new Dne(u,h),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":u=a(e.geometry),h=l(e.material),o=new xs(u,h);break;case"InstancedMesh":u=a(e.geometry),h=l(e.material);const m=e.count,y=e.instanceMatrix,b=e.instanceColor;o=new One(u,h,m),o.instanceMatrix=new X2(new Float32Array(y.array),16),b!==void 0&&(o.instanceColor=new X2(new Float32Array(b.array),b.itemSize));break;case"BatchedMesh":u=a(e.geometry),h=l(e.material),o=new Bne(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,h),o.geometry=u,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._geometryInfo=e.geometryInfo.map(w=>{let v=null,T=null;return w.boundingBox!==void 0&&(v=new Fo().fromJSON(w.boundingBox)),w.boundingSphere!==void 0&&(T=new ro().fromJSON(w.boundingSphere)),{...w,boundingBox:v,boundingSphere:T}}),o._instanceInfo=e.instanceInfo,o._availableInstanceIds=e._availableInstanceIds,o._availableGeometryIds=e._availableGeometryIds,o._nextIndexStart=e.nextIndexStart,o._nextVertexStart=e.nextVertexStart,o._geometryCount=e.geometryCount,o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._matricesTexture=c(e.matricesTexture.uuid),o._indirectTexture=c(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=c(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(o.boundingSphere=new ro().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(o.boundingBox=new Fo().fromJSON(e.boundingBox));break;case"LOD":o=new Lne;break;case"Line":o=new O0(a(e.geometry),l(e.material));break;case"LineLoop":o=new Une(a(e.geometry),l(e.material));break;case"LineSegments":o=new vh(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":o=new Fne(a(e.geometry),l(e.material));break;case"Sprite":o=new kne(l(e.material));break;case"Group":o=new fy;break;case"Bone":o=new $D;break;default:o=new Qi}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const p=e.children;for(let m=0;m<p.length;m++)o.add(this.parseObject(p[m],t,i,r,s))}if(e.animations!==void 0){const p=e.animations;for(let m=0;m<p.length;m++){const y=p[m];o.animations.push(s[y])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const p=e.levels;for(let m=0;m<p.length;m++){const y=p[m],b=o.getObjectByProperty("uuid",y.object);b!==void 0&&o.addLevel(b,y.distance,y.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const r=t[i.skeleton];r===void 0?Wt("ObjectLoader: No skeleton found with UUID:",i.skeleton):i.bind(r,i.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const i=t.target,r=e.getObjectByProperty("uuid",i);r!==void 0?t.target=r:t.target=new Qi}})}}const dIe={UVMapping:S9,CubeReflectionMapping:fh,CubeRefractionMapping:L0,EquirectangularReflectionMapping:Rb,EquirectangularRefractionMapping:Ib,CubeUVReflectionMapping:xx},gH={RepeatWrapping:Nb,ClampToEdgeWrapping:Ga,MirroredRepeatWrapping:Pb},yH={NearestFilter:is,NearestMipmapNearestFilter:RD,NearestMipmapLinearFilter:hy,LinearFilter:mr,LinearMipmapNearestFilter:M3,LinearMipmapLinearFilter:th},eM=new WeakMap;class fIe extends el{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Wt("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Wt("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,i,r){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=nh.get(`image-bitmap:${e}`);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(c=>{if(eM.has(o)===!0)r&&r(eM.get(o)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(c),s.manager.itemEnd(e),c});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,a.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const l=fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(c){return nh.add(`image-bitmap:${e}`,c),t&&t(c),s.manager.itemEnd(e),c}).catch(function(c){r&&r(c),eM.set(l,c),nh.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});nh.add(`image-bitmap:${e}`,l),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let E5,uO=class{static getContext(){return E5===void 0&&(E5=new(window.AudioContext||window.webkitAudioContext)),E5}static setContext(e){E5=e}};class pIe extends el{constructor(e){super(e)}load(e,t,i,r){const s=this,o=new Od(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{const c=l.slice(0);uO.getContext().decodeAudioData(c,function(h){t(h)}).catch(a)}catch(c){a(c)}},i,r);function a(l){r?r(l):xn(l),s.manager.itemError(e)}}}const xH=new Hn,vH=new Hn,Ip=new Hn;class mIe{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ns,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ns,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Ip.copy(e.projectionMatrix);const r=t.eyeSep/2,s=r*t.near/t.focus,o=t.near*Math.tan(Lm*t.fov*.5)/t.zoom;let a,l;vH.elements[12]=-r,xH.elements[12]=r,a=-o*t.aspect+s,l=o*t.aspect+s,Ip.elements[0]=2*t.near/(l-a),Ip.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Ip),a=-o*t.aspect-s,l=o*t.aspect-s,Ip.elements[0]=2*t.near/(l-a),Ip.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Ip)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(vH),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(xH)}}class wie extends ns{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class hO{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Np=new ye,tM=new Uo,gIe=new ye,Pp=new ye,kp=new ye;class yIe extends Qi{constructor(){super(),this.type="AudioListener",this.context=uO.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new hO}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Np,tM,gIe),Pp.set(0,0,-1).applyQuaternion(tM),kp.set(0,1,0).applyQuaternion(tM),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Np.x,i),t.positionY.linearRampToValueAtTime(Np.y,i),t.positionZ.linearRampToValueAtTime(Np.z,i),t.forwardX.linearRampToValueAtTime(Pp.x,i),t.forwardY.linearRampToValueAtTime(Pp.y,i),t.forwardZ.linearRampToValueAtTime(Pp.z,i),t.upX.linearRampToValueAtTime(kp.x,i),t.upY.linearRampToValueAtTime(kp.y,i),t.upZ.linearRampToValueAtTime(kp.z,i)}else t.setPosition(Np.x,Np.y,Np.z),t.setOrientation(Pp.x,Pp.y,Pp.z,kp.x,kp.y,kp.z)}}let Sie=class extends Qi{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Wt("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Wt("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Wt("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Wt("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Wt("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Wt("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Wt("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(Wt("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}};const Lp=new ye,bH=new Uo,xIe=new ye,Dp=new ye;class vIe extends Sie{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lp,bH,xIe),Dp.set(0,0,1).applyQuaternion(bH);const t=this.panner;if(t.positionX){const i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Lp.x,i),t.positionY.linearRampToValueAtTime(Lp.y,i),t.positionZ.linearRampToValueAtTime(Lp.z,i),t.orientationX.linearRampToValueAtTime(Dp.x,i),t.orientationY.linearRampToValueAtTime(Dp.y,i),t.orientationZ.linearRampToValueAtTime(Dp.z,i)}else t.setPosition(Lp.x,Lp.y,Lp.z),t.setOrientation(Dp.x,Dp.y,Dp.z)}}class bIe{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class Eie{constructor(e,t,i){this.binding=e,this.valueSize=i;let r,s,o;switch(t){case"quaternion":r=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(i*6),this._workIndex=5;break;case"string":case"bool":r=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(i*5);break;default:r=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(i*5)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,r=this.valueSize,s=e*r+r;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==r;++a)i[s+a]=i[a];o=t}else{o+=t;const a=t/o;this._mixBufferRegion(i,s,0,a,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,r=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,r=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const l=t*this._origIndex;this._mixBufferRegion(i,r,l,1-s,t)}o>0&&this._mixBufferRegionAdditive(i,r,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(i[l]!==i[l+t]){a.setValue(i,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,r=i*this._origIndex;e.getValue(t,r);for(let s=i,o=r;s!==o;++s)t[s]=t[r+s%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,r,s){if(r>=.5)for(let o=0;o!==s;++o)e[t+o]=e[i+o]}_slerp(e,t,i,r){Uo.slerpFlat(e,t,e,t,e,i,r)}_slerpAdditive(e,t,i,r,s){const o=this._workIndex*s;Uo.multiplyQuaternionsFlat(e,o,e,t,e,i),Uo.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,i,r,s){const o=1-r;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[i+a]*r}}_lerpAdditive(e,t,i,r,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[i+o]*r}}}const dO="\\[\\]\\.:\\/",_Ie=new RegExp("["+dO+"]","g"),fO="[^"+dO+"]",wIe="[^"+dO.replace("\\.","")+"]",SIe=/((?:WC+[\/:])*)/.source.replace("WC",fO),EIe=/(WCOD+)?/.source.replace("WCOD",wIe),TIe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",fO),AIe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",fO),CIe=new RegExp("^"+SIe+EIe+TIe+AIe+"$"),MIe=["material","materials","bones","map"];class RIe{constructor(e,t,i){const r=i||Ci.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,r=this._bindings[i];r!==void 0&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}class Ci{constructor(e,t,i){this.path=t,this.parsedPath=i||Ci.parseTrackName(t),this.node=Ci.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new Ci.Composite(e,t,i):new Ci(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(_Ie,"")}static parseTrackName(e){const t=CIe.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(r!==void 0&&r!==-1){const s=i.nodeName.substring(r+1);MIe.indexOf(s)!==-1&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=s)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){const i=function(s){for(let o=0;o<s.length;o++){const a=s[o];if(a.name===t||a.uuid===t)return a;const l=i(a.children);if(l)return l}return null},r=i(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)e[t++]=i[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let r=0,s=i.length;r!==s;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,r=t.propertyName;let s=t.propertyIndex;if(e||(e=Ci.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Wt("PropertyBinding: No target node found for track: "+this.path+".");return}if(i){let c=t.objectIndex;switch(i){case"materials":if(!e.material){xn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){xn("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){xn("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===c){c=u;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){xn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){xn("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[i]===void 0){xn("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(c!==void 0){if(e[c]===void 0){xn("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[c]}}const o=e[r];if(o===void 0){const c=t.nodeName;xn("PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?a=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(s!==void 0){if(r==="morphTargetInfluences"){if(!e.geometry){xn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){xn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Ci.Composite=RIe;Ci.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};Ci.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};Ci.prototype.GetterByBindingType=[Ci.prototype._getValue_direct,Ci.prototype._getValue_array,Ci.prototype._getValue_arrayElement,Ci.prototype._getValue_toArray];Ci.prototype.SetterByBindingTypeAndVersioning=[[Ci.prototype._setValue_direct,Ci.prototype._setValue_direct_setNeedsUpdate,Ci.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ci.prototype._setValue_array,Ci.prototype._setValue_array_setNeedsUpdate,Ci.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ci.prototype._setValue_arrayElement,Ci.prototype._setValue_arrayElement_setNeedsUpdate,Ci.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ci.prototype._setValue_fromArray,Ci.prototype._setValue_fromArray_setNeedsUpdate,Ci.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class IIe{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Tl(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let i=0,r=arguments.length;i!==r;++i)e[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length;let a,l=e.length,c=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){const p=arguments[u],m=p.uuid;let y=t[m];if(y===void 0){y=l++,t[m]=y,e.push(p);for(let b=0,w=o;b!==w;++b)s[b].push(new Ci(p,i[b],r[b]))}else if(y<c){a=e[y];const b=--c,w=e[b];t[w.uuid]=y,e[y]=w,t[m]=b,e[b]=p;for(let v=0,T=o;v!==T;++v){const S=s[v],M=S[b];let P=S[y];S[y]=M,P===void 0&&(P=new Ci(p,i[v],r[v])),S[b]=P}}else e[y]!==a&&xn("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,u=t[c];if(u!==void 0&&u>=s){const h=s++,p=e[h];t[p.uuid]=u,e[u]=p,t[c]=h,e[h]=l;for(let m=0,y=r;m!==y;++m){const b=i[m],w=b[h],v=b[u];b[u]=w,b[h]=v}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,r=i.length;let s=this.nCachedObjects_,o=e.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],u=c.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<s){const p=--s,m=e[p],y=--o,b=e[y];t[m.uuid]=h,e[h]=m,t[b.uuid]=p,e[p]=b,e.pop();for(let w=0,v=r;w!==v;++w){const T=i[w],S=T[p],M=T[y];T[h]=S,T[p]=M,T.pop()}}else{const p=--o,m=e[p];p>0&&(t[m.uuid]=h),e[h]=m,e.pop();for(let y=0,b=r;y!==b;++y){const w=i[y];w[h]=w[p],w.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let r=i[e];const s=this._bindings;if(r!==void 0)return s[r];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,u=this.nCachedObjects_,h=new Array(c);r=s.length,i[e]=r,o.push(e),a.push(t),s.push(h);for(let p=u,m=l.length;p!==m;++p){const y=l[p];h[p]=new Ci(y,e,t)}return h}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){const r=this._paths,s=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=e[a];t[c]=i,o[i]=l,o.pop(),s[i]=s[a],s.pop(),r[i]=r[a],r.pop()}}}class Tie{constructor(e,t,i=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=r;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:fm,endingEnd:fm};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=cne,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i=!1){if(e.fadeOut(t),this.fadeIn(t),i===!0){const r=this._clip.duration,s=e._clip.duration,o=s/r,a=r/s;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,i=!1){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const r=this._mixer,s=r.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+i,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,r){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const l=(e-s)*i;l<0||i===0?t=0:(this._startTime=null,t=i*l)}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case OD:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);break;case I9:default:for(let u=0,h=l.length;u!==h;++u)l[u].evaluate(o),c[u].accumulate(r,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),r===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(i!==null){const r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let r=this.time+e,s=this._loopCount;const o=i===une;if(e===0)return s===-1?r:o&&(s&1)===1?t-r:r;if(i===lne){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else if(r<0)r=0;else{this.time=r;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),r>=t||r<0){const a=Math.floor(r/t);r-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(l===1){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=r;if(o&&(s&1)===1)return t-r}return r}_setEndings(e,t,i){const r=this._interpolantSettings;i?(r.endingStart=pm,r.endingEnd=pm):(e?r.endingStart=this.zeroSlopeAtStart?pm:fm:r.endingStart=Lb,t?r.endingEnd=this.zeroSlopeAtEnd?pm:fm:r.endingEnd=Lb)}_scheduleFading(e,t,i){const r=this._mixer,s=r.time;let o=this._weightInterpolant;o===null&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=i,this}}const NIe=new Float32Array(1);class PIe extends xh{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,r=e._clip.tracks,s=r.length,o=e._propertyBindings,a=e._interpolants,l=i.uuid,c=this._bindingsByRootAndName;let u=c[l];u===void 0&&(u={},c[l]=u);for(let h=0;h!==s;++h){const p=r[h],m=p.name;let y=u[m];if(y!==void 0)++y.referenceCount,o[h]=y;else{if(y=o[h],y!==void 0){y._cacheIndex===null&&(++y.referenceCount,this._addInactiveBinding(y,l,m));continue}const b=t&&t._propertyBindings[h].binding.parsedPath;y=new Eie(Ci.create(i,m,b),p.ValueTypeName,p.getValueSize()),++y.referenceCount,this._addInactiveBinding(y,l,m),o[h]=y}a[h].resultBuffer=y.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const i=(e._localRoot||this._root).uuid,r=e._clip.uuid,s=this._actionsByClip[r];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,r,i)}const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,i){const r=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null;const h=a.actionByRoot,p=(e._localRoot||this._root).uuid;delete h[p],l.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let i=0,r=t.length;i!==r;++i){const s=t[i];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const r=this._bindingsByRootAndName,s=this._bindings;let o=r[t];o===void 0&&(o={},r[t]=o),o[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,r=i.rootNode.uuid,s=i.path,o=this._bindingsByRootAndName,a=o[r],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],Object.keys(a).length===0&&delete o[r]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,s=t[r];e._cacheIndex=r,t[r]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return i===void 0&&(i=new sO(new Float32Array(2),new Float32Array(2),1,NIe),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,s=t[r];e.__cacheIndex=r,t[r]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const r=t||this._root,s=r.uuid;let o=typeof e=="string"?$b.findByName(r,e):e;const a=o!==null?o.uuid:e,l=this._actionsByClip[a];let c=null;if(i===void 0&&(o!==null?i=o.blendMode:i=I9),l!==void 0){const h=l.actionByRoot[s];if(h!==void 0&&h.blendMode===i)return h;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const u=new Tie(this,o,t,i);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const i=t||this._root,r=i.uuid,s=typeof e=="string"?$b.findByName(i,e):e,o=s?s.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[r]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let i=t-1;i>=0;--i)e[i].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,r=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==i;++c)t[c]._update(r,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,r=this._actionsByClip,s=r[i];if(s!==void 0){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,h=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const o in i){const a=i[o].actionByRoot,l=a[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const r=this._bindingsByRootAndName,s=r[t];if(s!==void 0)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}}class kIe extends UD{constructor(e=1,t=1,i=1,r={}){super(e,t,r),this.isRenderTarget3D=!0,this.depth=i,this.texture=new L9(null,e,t,i),this._setTextureOptions(r),this.texture.isRenderTargetTexture=!0}}class pO{constructor(e){this.value=e}clone(){return new pO(this.value.clone===void 0?this.value:this.value.clone())}}let LIe=0;class DIe extends xh{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:LIe++}),this.name="",this.usage=Ob,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let i=0,r=t.length;i<r;i++){const s=Array.isArray(t[i])?t[i]:[t[i]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class OIe extends B9{constructor(e,t,i=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class BIe{constructor(e,t,i,r,s,o=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=r,this.count=s,this.normalized=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const _H=new Hn;class Aie{constructor(e,t,i=0,r=1/0){this.ray=new E1(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Dm,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):xn("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return _H.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_H),this}intersectObject(e,t=!0,i=[]){return VN(e,this,i,t),i.sort(wH),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)VN(e[r],this,i,t);return i.sort(wH),i}}function wH(n,e){return n.distance-e.distance}function VN(n,e,t,i){let r=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(r=!1),r===!0&&i===!0){const s=n.children;for(let o=0,a=s.length;o<a;o++)VN(s[o],e,t,!0)}}class UIe{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=FIe.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function FIe(){this._document.hidden===!1&&this.reset()}class HN{constructor(e=1,t=0,i=0){this.radius=e,this.phi=t,this.theta=i}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Bn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Bn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class zIe{constructor(e=1,t=0,i=0){this.radius=e,this.theta=t,this.y=i}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return new this.constructor().copy(this)}}class mO{constructor(e,t,i,r){mO.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,i,r)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let i=0;i<4;i++)this.elements[i]=e[i+t];return this}set(e,t,i,r){const s=this.elements;return s[0]=e,s[2]=t,s[1]=i,s[3]=r,this}}const SH=new Et;class jIe{constructor(e=new Et(1/0,1/0),t=new Et(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=SH.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,SH).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const EH=new ye,T5=new ye,Eg=new ye,Tg=new ye,nM=new ye,VIe=new ye,HIe=new ye;class $Ie{constructor(e=new ye,t=new ye){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){EH.subVectors(e,this.start),T5.subVectors(this.end,this.start);const i=T5.dot(T5);let s=T5.dot(EH)/i;return t&&(s=Bn(s,0,1)),s}closestPointToPoint(e,t,i){const r=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(r).add(this.start)}distanceSqToLine3(e,t=VIe,i=HIe){const r=10000000000000001e-32;let s,o;const a=this.start,l=e.start,c=this.end,u=e.end;Eg.subVectors(c,a),Tg.subVectors(u,l),nM.subVectors(a,l);const h=Eg.dot(Eg),p=Tg.dot(Tg),m=Tg.dot(nM);if(h<=r&&p<=r)return t.copy(a),i.copy(l),t.sub(i),t.dot(t);if(h<=r)s=0,o=m/p,o=Bn(o,0,1);else{const y=Eg.dot(nM);if(p<=r)o=0,s=Bn(-y/h,0,1);else{const b=Eg.dot(Tg),w=h*p-b*b;w!==0?s=Bn((b*m-y*p)/w,0,1):s=0,o=(b*s+m)/p,o<0?(o=0,s=Bn(-y/h,0,1)):o>1&&(o=1,s=Bn((b-y)/h,0,1))}}return t.copy(a).add(Eg.multiplyScalar(s)),i.copy(l).add(Tg.multiplyScalar(o)),t.sub(i),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const TH=new ye;class GIe extends Qi{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const i=new Jn,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,u=a/l*Math.PI*2;r.push(Math.cos(c),Math.sin(c),1,Math.cos(u),Math.sin(u),1)}i.setAttribute("position",new un(r,3));const s=new ya({fog:!1,toneMapped:!1});this.cone=new vh(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),TH.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(TH),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const If=new ye,A5=new Hn,iM=new Hn;class WIe extends vh{constructor(e){const t=Cie(e),i=new Jn,r=[],s=[];for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}i.setAttribute("position",new un(r,3)),i.setAttribute("color",new un(s,3));const o=new ya({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(i,o),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const a=new an(255),l=new an(65280);this.setColors(a,l)}updateMatrixWorld(e){const t=this.bones,i=this.geometry,r=i.getAttribute("position");iM.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(A5.multiplyMatrices(iM,a.matrixWorld),If.setFromMatrixPosition(A5),r.setXYZ(o,If.x,If.y,If.z),A5.multiplyMatrices(iM,a.parent.matrixWorld),If.setFromMatrixPosition(A5),r.setXYZ(o+1,If.x,If.y,If.z),o+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const r=this.geometry.getAttribute("color");for(let s=0;s<r.count;s+=2)r.setXYZ(s,e.r,e.g,e.b),r.setXYZ(s+1,t.r,t.g,t.b);return r.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function Cie(n){const e=[];n.isBone===!0&&e.push(n);for(let t=0;t<n.children.length;t++)e.push(...Cie(n.children[t]));return e}class KIe extends xs{constructor(e,t,i){const r=new JD(t,4,2),s=new q0({wireframe:!0,fog:!1,toneMapped:!1});super(r,s),this.light=e,this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const qIe=new ye,AH=new an,CH=new an;class ZIe extends Qi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="HemisphereLightHelper";const r=new Y_(t);r.rotateY(Math.PI*.5),this.material=new q0({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=r.getAttribute("position"),o=new Float32Array(s.count*3);r.setAttribute("color",new lr(o,3)),this.add(new xs(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");AH.copy(this.light.color),CH.copy(this.light.groundColor);for(let i=0,r=t.count;i<r;i++){const s=i<r/2?AH:CH;t.setXYZ(i,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(qIe.setFromMatrixPosition(this.light.matrixWorld).negate())}}class YIe extends vh{constructor(e=10,t=10,i=4473924,r=8947848){i=new an(i),r=new an(r);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let p=0,m=0,y=-a;p<=t;p++,y+=o){l.push(-a,0,y,a,0,y),l.push(y,0,-a,y,0,a);const b=p===s?i:r;b.toArray(c,m),m+=3,b.toArray(c,m),m+=3,b.toArray(c,m),m+=3,b.toArray(c,m),m+=3}const u=new Jn;u.setAttribute("position",new un(l,3)),u.setAttribute("color",new un(c,3));const h=new ya({vertexColors:!0,toneMapped:!1});super(u,h),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class XIe extends vh{constructor(e=10,t=16,i=8,r=64,s=4473924,o=8947848){s=new an(s),o=new an(o);const a=[],l=[];if(t>1)for(let h=0;h<t;h++){const p=h/t*(Math.PI*2),m=Math.sin(p)*e,y=Math.cos(p)*e;a.push(0,0,0),a.push(m,0,y);const b=h&1?s:o;l.push(b.r,b.g,b.b),l.push(b.r,b.g,b.b)}for(let h=0;h<i;h++){const p=h&1?s:o,m=e-e/i*h;for(let y=0;y<r;y++){let b=y/r*(Math.PI*2),w=Math.sin(b)*m,v=Math.cos(b)*m;a.push(w,0,v),l.push(p.r,p.g,p.b),b=(y+1)/r*(Math.PI*2),w=Math.sin(b)*m,v=Math.cos(b)*m,a.push(w,0,v),l.push(p.r,p.g,p.b)}}const c=new Jn;c.setAttribute("position",new un(a,3)),c.setAttribute("color",new un(l,3));const u=new ya({vertexColors:!0,toneMapped:!1});super(c,u),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const MH=new ye,C5=new ye,RH=new ye;class QIe extends Qi{constructor(e,t,i){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,this.type="DirectionalLightHelper",t===void 0&&(t=1);let r=new Jn;r.setAttribute("position",new un([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new ya({fog:!1,toneMapped:!1});this.lightPlane=new O0(r,s),this.add(this.lightPlane),r=new Jn,r.setAttribute("position",new un([0,0,0,0,0,1],3)),this.targetLine=new O0(r,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),MH.setFromMatrixPosition(this.light.matrixWorld),C5.setFromMatrixPosition(this.light.target.matrixWorld),RH.subVectors(C5,MH),this.lightPlane.lookAt(C5),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(C5),this.targetLine.scale.z=RH.length()}}const M5=new ye,Wr=new W_;class JIe extends vh{constructor(e){const t=new Jn,i=new ya({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],s=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(y,b){l(y),l(b)}function l(y){r.push(0,0,0),s.push(0,0,0),o[y]===void 0&&(o[y]=[]),o[y].push(r.length/3-1)}t.setAttribute("position",new un(r,3)),t.setAttribute("color",new un(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new an(16755200),u=new an(16711680),h=new an(43775),p=new an(16777215),m=new an(3355443);this.setColors(c,u,h,p,m)}setColors(e,t,i,r,s){const a=this.geometry.getAttribute("color");return a.setXYZ(0,e.r,e.g,e.b),a.setXYZ(1,e.r,e.g,e.b),a.setXYZ(2,e.r,e.g,e.b),a.setXYZ(3,e.r,e.g,e.b),a.setXYZ(4,e.r,e.g,e.b),a.setXYZ(5,e.r,e.g,e.b),a.setXYZ(6,e.r,e.g,e.b),a.setXYZ(7,e.r,e.g,e.b),a.setXYZ(8,e.r,e.g,e.b),a.setXYZ(9,e.r,e.g,e.b),a.setXYZ(10,e.r,e.g,e.b),a.setXYZ(11,e.r,e.g,e.b),a.setXYZ(12,e.r,e.g,e.b),a.setXYZ(13,e.r,e.g,e.b),a.setXYZ(14,e.r,e.g,e.b),a.setXYZ(15,e.r,e.g,e.b),a.setXYZ(16,e.r,e.g,e.b),a.setXYZ(17,e.r,e.g,e.b),a.setXYZ(18,e.r,e.g,e.b),a.setXYZ(19,e.r,e.g,e.b),a.setXYZ(20,e.r,e.g,e.b),a.setXYZ(21,e.r,e.g,e.b),a.setXYZ(22,e.r,e.g,e.b),a.setXYZ(23,e.r,e.g,e.b),a.setXYZ(24,t.r,t.g,t.b),a.setXYZ(25,t.r,t.g,t.b),a.setXYZ(26,t.r,t.g,t.b),a.setXYZ(27,t.r,t.g,t.b),a.setXYZ(28,t.r,t.g,t.b),a.setXYZ(29,t.r,t.g,t.b),a.setXYZ(30,t.r,t.g,t.b),a.setXYZ(31,t.r,t.g,t.b),a.setXYZ(32,i.r,i.g,i.b),a.setXYZ(33,i.r,i.g,i.b),a.setXYZ(34,i.r,i.g,i.b),a.setXYZ(35,i.r,i.g,i.b),a.setXYZ(36,i.r,i.g,i.b),a.setXYZ(37,i.r,i.g,i.b),a.setXYZ(38,r.r,r.g,r.b),a.setXYZ(39,r.r,r.g,r.b),a.setXYZ(40,s.r,s.g,s.b),a.setXYZ(41,s.r,s.g,s.b),a.setXYZ(42,s.r,s.g,s.b),a.setXYZ(43,s.r,s.g,s.b),a.setXYZ(44,s.r,s.g,s.b),a.setXYZ(45,s.r,s.g,s.b),a.setXYZ(46,s.r,s.g,s.b),a.setXYZ(47,s.r,s.g,s.b),a.setXYZ(48,s.r,s.g,s.b),a.setXYZ(49,s.r,s.g,s.b),a.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,i=1,r=1;let s,o;if(Wr.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,o=0;else if(this.camera.coordinateSystem===Sl)s=-1,o=1;else if(this.camera.coordinateSystem===K2)s=0,o=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);es("c",t,e,Wr,0,0,s),es("t",t,e,Wr,0,0,o),es("n1",t,e,Wr,-i,-r,s),es("n2",t,e,Wr,i,-r,s),es("n3",t,e,Wr,-i,r,s),es("n4",t,e,Wr,i,r,s),es("f1",t,e,Wr,-i,-r,o),es("f2",t,e,Wr,i,-r,o),es("f3",t,e,Wr,-i,r,o),es("f4",t,e,Wr,i,r,o),es("u1",t,e,Wr,i*.7,r*1.1,s),es("u2",t,e,Wr,-i*.7,r*1.1,s),es("u3",t,e,Wr,0,r*2,s),es("cf1",t,e,Wr,-i,0,o),es("cf2",t,e,Wr,i,0,o),es("cf3",t,e,Wr,0,-r,o),es("cf4",t,e,Wr,0,r,o),es("cn1",t,e,Wr,-i,0,s),es("cn2",t,e,Wr,i,0,s),es("cn3",t,e,Wr,0,-r,s),es("cn4",t,e,Wr,0,r,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function es(n,e,t,i,r,s,o){M5.set(r,s,o).unproject(i);const a=e[n];if(a!==void 0){const l=t.getAttribute("position");for(let c=0,u=a.length;c<u;c++)l.setXYZ(a[c],M5.x,M5.y,M5.z)}}const R5=new Fo;class eNe extends vh{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(8*3),s=new Jn;s.setIndex(new lr(i,1)),s.setAttribute("position",new lr(r,3)),super(s,new ya({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&R5.setFromObject(this.object),R5.isEmpty())return;const e=R5.min,t=R5.max,i=this.geometry.attributes.position,r=i.array;r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=e.x,r[4]=t.y,r[5]=t.z,r[6]=e.x,r[7]=e.y,r[8]=t.z,r[9]=t.x,r[10]=e.y,r[11]=t.z,r[12]=t.x,r[13]=t.y,r[14]=e.z,r[15]=e.x,r[16]=t.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=t.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class tNe extends vh{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Jn;s.setIndex(new lr(i,1)),s.setAttribute("position",new un(r,3)),super(s,new ya({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class nNe extends O0{constructor(e,t=1,i=16776960){const r=i,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Jn;o.setAttribute("position",new un(s,3)),o.computeBoundingSphere(),super(o,new ya({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new Jn;l.setAttribute("position",new un(a,3)),l.computeBoundingSphere(),this.add(new xs(l,new q0({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const IH=new ye;let I5,rM;class iNe extends Qi{constructor(e=new ye(0,0,1),t=new ye(0,0,0),i=1,r=16776960,s=i*.2,o=s*.2){super(),this.type="ArrowHelper",I5===void 0&&(I5=new Jn,I5.setAttribute("position",new un([0,0,0,0,1,0],3)),rM=new Z_(.5,1,5,1),rM.translate(0,-.5,0)),this.position.copy(t),this.line=new O0(I5,new ya({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new xs(rM,new q0({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{IH.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(IH,t)}}setLength(e,t=e*.2,i=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class rNe extends vh{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],r=new Jn;r.setAttribute("position",new un(t,3)),r.setAttribute("color",new un(i,3));const s=new ya({vertexColors:!0,toneMapped:!1});super(r,s),this.type="AxesHelper"}setColors(e,t,i){const r=new an,s=this.geometry.attributes.color.array;return r.set(e),r.toArray(s,0),r.toArray(s,3),r.set(t),r.toArray(s,6),r.toArray(s,9),r.set(i),r.toArray(s,12),r.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class sNe{constructor(){this.type="ShapePath",this.color=new an,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new _E,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,r){return this.currentPath.quadraticCurveTo(e,t,i,r),this}bezierCurveTo(e,t,i,r,s,o){return this.currentPath.bezierCurveTo(e,t,i,r,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(v){const T=[];for(let S=0,M=v.length;S<M;S++){const P=v[S],R=new Om;R.curves=P.curves,T.push(R)}return T}function i(v,T){const S=T.length;let M=!1;for(let P=S-1,R=0;R<S;P=R++){let O=T[P],B=T[R],N=B.x-O.x,I=B.y-O.y;if(Math.abs(I)>Number.EPSILON){if(I<0&&(O=T[R],N=-N,B=T[P],I=-I),v.y<O.y||v.y>B.y)continue;if(v.y===O.y){if(v.x===O.x)return!0}else{const F=I*(v.x-O.x)-N*(v.y-O.y);if(F===0)return!0;if(F<0)continue;M=!M}}else{if(v.y!==O.y)continue;if(B.x<=v.x&&v.x<=O.x||O.x<=v.x&&v.x<=B.x)return!0}}return M}const r=iu.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,a,l;const c=[];if(s.length===1)return a=s[0],l=new Om,l.curves=a.curves,c.push(l),c;let u=!r(s[0].getPoints());u=e?!u:u;const h=[],p=[];let m=[],y=0,b;p[y]=void 0,m[y]=[];for(let v=0,T=s.length;v<T;v++)a=s[v],b=a.getPoints(),o=r(b),o=e?!o:o,o?(!u&&p[y]&&y++,p[y]={s:new Om,p:b},p[y].s.curves=a.curves,u&&y++,m[y]=[]):m[y].push({h:a,p:b[0]});if(!p[0])return t(s);if(p.length>1){let v=!1,T=0;for(let S=0,M=p.length;S<M;S++)h[S]=[];for(let S=0,M=p.length;S<M;S++){const P=m[S];for(let R=0;R<P.length;R++){const O=P[R];let B=!0;for(let N=0;N<p.length;N++)i(O.p,p[N].p)&&(S!==N&&T++,B?(B=!1,h[N].push(O)):v=!0);B&&h[S].push(O)}}T>0&&v===!1&&(m=h)}let w;for(let v=0,T=p.length;v<T;v++){l=p[v].s,c.push(l),w=m[v];for(let S=0,M=w.length;S<M;S++)l.holes.push(w[S].h)}return c}}class oNe extends xh{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Wt("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function aNe(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2):(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0),n}function lNe(n,e){const t=n.image&&n.image.width?n.image.width/n.image.height:1;return t>e?(n.repeat.x=e/t,n.repeat.y=1,n.offset.x=(1-n.repeat.x)/2,n.offset.y=0):(n.repeat.x=1,n.repeat.y=t/e,n.offset.x=0,n.offset.y=(1-n.repeat.y)/2),n}function cNe(n){return n.repeat.x=1,n.repeat.y=1,n.offset.x=0,n.offset.y=0,n}function $N(n,e,t,i){const r=uNe(i);switch(t){case LD:return n*e;case C9:return n*e/r.components*r.byteLength;case G_:return n*e/r.components*r.byteLength;case n1:return n*e*2/r.components*r.byteLength;case M9:return n*e*2/r.components*r.byteLength;case DD:return n*e*3/r.components*r.byteLength;case Oo:return n*e*4/r.components*r.byteLength;case R9:return n*e*4/r.components*r.byteLength;case R3:case I3:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case N3:case P3:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case z8:case V8:return Math.max(n,16)*Math.max(e,8)/4;case F8:case j8:return Math.max(n,8)*Math.max(e,8)/2;case H8:case $8:case W8:case K8:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case G8:case q8:case Z8:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Y8:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case X8:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case Q8:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case J8:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case eE:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case tE:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case nE:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case iE:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case rE:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case sE:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case oE:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case aE:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case lE:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case cE:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case uE:case hE:case dE:return Math.ceil(n/4)*Math.ceil(e/4)*16;case fE:case pE:return Math.ceil(n/4)*Math.ceil(e/4)*8;case mE:case gE:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function uNe(n){switch(n){case ca:case ID:return{byteLength:1,components:1};case G2:case ND:case du:return{byteLength:2,components:1};case T9:case A9:return{byteLength:2,components:4};case bc:case E9:case Do:return{byteLength:4,components:1};case PD:case kD:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}class hNe{static contain(e,t){return aNe(e,t)}static cover(e,t){return lNe(e,t)}static fill(e){return cNe(e)}static getByteLength(e,t,i,r){return $N(e,t,i,r)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_9}}));typeof window<"u"&&(window.__THREE__?Wt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_9);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function Mie(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function dNe(n){const e=new WeakMap;function t(a,l){const c=a.array,u=a.usage,h=c.byteLength,p=n.createBuffer();n.bindBuffer(l,p),n.bufferData(l,c,u),a.onUploadCallback();let m;if(c instanceof Float32Array)m=n.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)m=n.HALF_FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?m=n.HALF_FLOAT:m=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)m=n.SHORT;else if(c instanceof Uint32Array)m=n.UNSIGNED_INT;else if(c instanceof Int32Array)m=n.INT;else if(c instanceof Int8Array)m=n.BYTE;else if(c instanceof Uint8Array)m=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)m=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:p,type:m,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:h}}function i(a,l,c){const u=l.array,h=l.updateRanges;if(n.bindBuffer(c,a),h.length===0)n.bufferSubData(c,0,u);else{h.sort((m,y)=>m.start-y.start);let p=0;for(let m=1;m<h.length;m++){const y=h[p],b=h[m];b.start<=y.start+y.count+1?y.count=Math.max(y.count,b.start+b.count-y.start):(++p,h[p]=b)}h.length=p+1;for(let m=0,y=h.length;m<y;m++){const b=h[m];n.bufferSubData(c,b.start*u.BYTES_PER_ELEMENT,u,b.start,b.count)}l.clearUpdateRanges()}l.onUploadCallback()}function r(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function s(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function o(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(c.buffer,a,l),c.version=a.version}}return{get:r,remove:s,update:o}}var fNe=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,pNe=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,mNe=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,gNe=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,yNe=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,xNe=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,vNe=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,bNe=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,_Ne=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,wNe=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,SNe=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,ENe=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,TNe=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,ANe=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,CNe=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,MNe=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,RNe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,INe=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,NNe=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,PNe=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,kNe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,LNe=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,DNe=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,ONe=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,BNe=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,UNe=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,FNe=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,zNe=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,jNe=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,VNe=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,HNe="gl_FragColor = linearToOutputTexel( gl_FragColor );",$Ne=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,GNe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,WNe=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,KNe=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,qNe=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,ZNe=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,YNe=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,XNe=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,QNe=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,JNe=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,ePe=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,tPe=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,nPe=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,iPe=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,rPe=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,sPe=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,oPe=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,aPe=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lPe=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,cPe=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,uPe=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,hPe=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,dPe=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,fPe=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,pPe=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,mPe=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,gPe=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,yPe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,xPe=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,vPe=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,bPe=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,_Pe=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,wPe=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,SPe=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,EPe=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,TPe=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,APe=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,CPe=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,MPe=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,RPe=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,IPe=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,NPe=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,PPe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kPe=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,LPe=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,DPe=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,OPe=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,BPe=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,UPe=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,FPe=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,zPe=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,jPe=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,VPe=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,HPe=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,$Pe=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,GPe=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,WPe=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,KPe=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,qPe=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,ZPe=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,YPe=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,XPe=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,QPe=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,JPe=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,eke=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,tke=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,nke=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,ike=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,rke=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,ske=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,oke=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,ake=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,lke=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,cke=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uke=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,hke=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const dke=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fke=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pke=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,mke=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,gke=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,yke=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,xke=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,vke=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,bke=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,_ke=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,wke=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Ske=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Eke=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Tke=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ake=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Cke=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Mke=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rke=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ike=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,Nke=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pke=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,kke=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Lke=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Dke=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Oke=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Bke=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uke=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Fke=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zke=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,jke=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Vke=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Hke=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,$ke=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Gke=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ei={alphahash_fragment:fNe,alphahash_pars_fragment:pNe,alphamap_fragment:mNe,alphamap_pars_fragment:gNe,alphatest_fragment:yNe,alphatest_pars_fragment:xNe,aomap_fragment:vNe,aomap_pars_fragment:bNe,batching_pars_vertex:_Ne,batching_vertex:wNe,begin_vertex:SNe,beginnormal_vertex:ENe,bsdfs:TNe,iridescence_fragment:ANe,bumpmap_pars_fragment:CNe,clipping_planes_fragment:MNe,clipping_planes_pars_fragment:RNe,clipping_planes_pars_vertex:INe,clipping_planes_vertex:NNe,color_fragment:PNe,color_pars_fragment:kNe,color_pars_vertex:LNe,color_vertex:DNe,common:ONe,cube_uv_reflection_fragment:BNe,defaultnormal_vertex:UNe,displacementmap_pars_vertex:FNe,displacementmap_vertex:zNe,emissivemap_fragment:jNe,emissivemap_pars_fragment:VNe,colorspace_fragment:HNe,colorspace_pars_fragment:$Ne,envmap_fragment:GNe,envmap_common_pars_fragment:WNe,envmap_pars_fragment:KNe,envmap_pars_vertex:qNe,envmap_physical_pars_fragment:sPe,envmap_vertex:ZNe,fog_vertex:YNe,fog_pars_vertex:XNe,fog_fragment:QNe,fog_pars_fragment:JNe,gradientmap_pars_fragment:ePe,lightmap_pars_fragment:tPe,lights_lambert_fragment:nPe,lights_lambert_pars_fragment:iPe,lights_pars_begin:rPe,lights_toon_fragment:oPe,lights_toon_pars_fragment:aPe,lights_phong_fragment:lPe,lights_phong_pars_fragment:cPe,lights_physical_fragment:uPe,lights_physical_pars_fragment:hPe,lights_fragment_begin:dPe,lights_fragment_maps:fPe,lights_fragment_end:pPe,logdepthbuf_fragment:mPe,logdepthbuf_pars_fragment:gPe,logdepthbuf_pars_vertex:yPe,logdepthbuf_vertex:xPe,map_fragment:vPe,map_pars_fragment:bPe,map_particle_fragment:_Pe,map_particle_pars_fragment:wPe,metalnessmap_fragment:SPe,metalnessmap_pars_fragment:EPe,morphinstance_vertex:TPe,morphcolor_vertex:APe,morphnormal_vertex:CPe,morphtarget_pars_vertex:MPe,morphtarget_vertex:RPe,normal_fragment_begin:IPe,normal_fragment_maps:NPe,normal_pars_fragment:PPe,normal_pars_vertex:kPe,normal_vertex:LPe,normalmap_pars_fragment:DPe,clearcoat_normal_fragment_begin:OPe,clearcoat_normal_fragment_maps:BPe,clearcoat_pars_fragment:UPe,iridescence_pars_fragment:FPe,opaque_fragment:zPe,packing:jPe,premultiplied_alpha_fragment:VPe,project_vertex:HPe,dithering_fragment:$Pe,dithering_pars_fragment:GPe,roughnessmap_fragment:WPe,roughnessmap_pars_fragment:KPe,shadowmap_pars_fragment:qPe,shadowmap_pars_vertex:ZPe,shadowmap_vertex:YPe,shadowmask_pars_fragment:XPe,skinbase_vertex:QPe,skinning_pars_vertex:JPe,skinning_vertex:eke,skinnormal_vertex:tke,specularmap_fragment:nke,specularmap_pars_fragment:ike,tonemapping_fragment:rke,tonemapping_pars_fragment:ske,transmission_fragment:oke,transmission_pars_fragment:ake,uv_pars_fragment:lke,uv_pars_vertex:cke,uv_vertex:uke,worldpos_vertex:hke,background_vert:dke,background_frag:fke,backgroundCube_vert:pke,backgroundCube_frag:mke,cube_vert:gke,cube_frag:yke,depth_vert:xke,depth_frag:vke,distance_vert:bke,distance_frag:_ke,equirect_vert:wke,equirect_frag:Ske,linedashed_vert:Eke,linedashed_frag:Tke,meshbasic_vert:Ake,meshbasic_frag:Cke,meshlambert_vert:Mke,meshlambert_frag:Rke,meshmatcap_vert:Ike,meshmatcap_frag:Nke,meshnormal_vert:Pke,meshnormal_frag:kke,meshphong_vert:Lke,meshphong_frag:Dke,meshphysical_vert:Oke,meshphysical_frag:Bke,meshtoon_vert:Uke,meshtoon_frag:Fke,points_vert:zke,points_frag:jke,shadow_vert:Vke,shadow_frag:Hke,sprite_vert:$ke,sprite_frag:Gke},qt={common:{diffuse:{value:new an(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new ti},alphaMap:{value:null},alphaMapTransform:{value:new ti},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new ti}},envmap:{envMap:{value:null},envMapRotation:{value:new ti},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new ti}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new ti}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new ti},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new ti},normalScale:{value:new Et(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new ti},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new ti}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new ti}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new ti}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new an(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new an(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new ti},alphaTest:{value:0},uvTransform:{value:new ti}},sprite:{diffuse:{value:new an(16777215)},opacity:{value:1},center:{value:new Et(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new ti},alphaMap:{value:null},alphaMapTransform:{value:new ti},alphaTest:{value:0}}},Xc={basic:{uniforms:ta([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.fog]),vertexShader:ei.meshbasic_vert,fragmentShader:ei.meshbasic_frag},lambert:{uniforms:ta([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new an(0)}}]),vertexShader:ei.meshlambert_vert,fragmentShader:ei.meshlambert_frag},phong:{uniforms:ta([qt.common,qt.specularmap,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,qt.lights,{emissive:{value:new an(0)},specular:{value:new an(1118481)},shininess:{value:30}}]),vertexShader:ei.meshphong_vert,fragmentShader:ei.meshphong_frag},standard:{uniforms:ta([qt.common,qt.envmap,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.roughnessmap,qt.metalnessmap,qt.fog,qt.lights,{emissive:{value:new an(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ei.meshphysical_vert,fragmentShader:ei.meshphysical_frag},toon:{uniforms:ta([qt.common,qt.aomap,qt.lightmap,qt.emissivemap,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.gradientmap,qt.fog,qt.lights,{emissive:{value:new an(0)}}]),vertexShader:ei.meshtoon_vert,fragmentShader:ei.meshtoon_frag},matcap:{uniforms:ta([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,qt.fog,{matcap:{value:null}}]),vertexShader:ei.meshmatcap_vert,fragmentShader:ei.meshmatcap_frag},points:{uniforms:ta([qt.points,qt.fog]),vertexShader:ei.points_vert,fragmentShader:ei.points_frag},dashed:{uniforms:ta([qt.common,qt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ei.linedashed_vert,fragmentShader:ei.linedashed_frag},depth:{uniforms:ta([qt.common,qt.displacementmap]),vertexShader:ei.depth_vert,fragmentShader:ei.depth_frag},normal:{uniforms:ta([qt.common,qt.bumpmap,qt.normalmap,qt.displacementmap,{opacity:{value:1}}]),vertexShader:ei.meshnormal_vert,fragmentShader:ei.meshnormal_frag},sprite:{uniforms:ta([qt.sprite,qt.fog]),vertexShader:ei.sprite_vert,fragmentShader:ei.sprite_frag},background:{uniforms:{uvTransform:{value:new ti},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ei.background_vert,fragmentShader:ei.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new ti}},vertexShader:ei.backgroundCube_vert,fragmentShader:ei.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ei.cube_vert,fragmentShader:ei.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ei.equirect_vert,fragmentShader:ei.equirect_frag},distance:{uniforms:ta([qt.common,qt.displacementmap,{referencePosition:{value:new ye},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ei.distance_vert,fragmentShader:ei.distance_frag},shadow:{uniforms:ta([qt.lights,qt.fog,{color:{value:new an(0)},opacity:{value:1}}]),vertexShader:ei.shadow_vert,fragmentShader:ei.shadow_frag}};Xc.physical={uniforms:ta([Xc.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new ti},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new ti},clearcoatNormalScale:{value:new Et(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new ti},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new ti},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new ti},sheen:{value:0},sheenColor:{value:new an(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new ti},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new ti},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new ti},transmissionSamplerSize:{value:new Et},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new ti},attenuationDistance:{value:0},attenuationColor:{value:new an(0)},specularColor:{value:new an(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new ti},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new ti},anisotropyVector:{value:new Et},anisotropyMap:{value:null},anisotropyMapTransform:{value:new ti}}]),vertexShader:ei.meshphysical_vert,fragmentShader:ei.meshphysical_frag};const N5={r:0,b:0,g:0},Op=new fu,Wke=new Hn;function Kke(n,e,t,i,r,s,o){const a=new an(0);let l=s===!0?0:1,c,u,h=null,p=0,m=null;function y(S){let M=S.isScene===!0?S.background:null;return M&&M.isTexture&&(M=(S.backgroundBlurriness>0?t:e).get(M)),M}function b(S){let M=!1;const P=y(S);P===null?v(a,l):P&&P.isColor&&(v(P,1),M=!0);const R=n.xr.getEnvironmentBlendMode();R==="additive"?i.buffers.color.setClear(0,0,0,1,o):R==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,o),(n.autoClear||M)&&(i.buffers.depth.setTest(!0),i.buffers.depth.setMask(!0),i.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function w(S,M){const P=y(M);P&&(P.isCubeTexture||P.mapping===xx)?(u===void 0&&(u=new xs(new T1(1,1,1),new _c({name:"BackgroundCubeMaterial",uniforms:Y2(Xc.backgroundCube.uniforms),vertexShader:Xc.backgroundCube.vertexShader,fragmentShader:Xc.backgroundCube.fragmentShader,side:fa,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(R,O,B){this.matrixWorld.copyPosition(B.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),Op.copy(M.backgroundRotation),Op.x*=-1,Op.y*=-1,Op.z*=-1,P.isCubeTexture&&P.isRenderTargetTexture===!1&&(Op.y*=-1,Op.z*=-1),u.material.uniforms.envMap.value=P,u.material.uniforms.flipEnvMap.value=P.isCubeTexture&&P.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=M.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=M.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Wke.makeRotationFromEuler(Op)),u.material.toneMapped=xi.getTransfer(P.colorSpace)!==Gi,(h!==P||p!==P.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,h=P,p=P.version,m=n.toneMapping),u.layers.enableAll(),S.unshift(u,u.geometry,u.material,0,0,null)):P&&P.isTexture&&(c===void 0&&(c=new xs(new bx(2,2),new _c({name:"BackgroundMaterial",uniforms:Y2(Xc.background.uniforms),vertexShader:Xc.background.vertexShader,fragmentShader:Xc.background.fragmentShader,side:Dd,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=P,c.material.uniforms.backgroundIntensity.value=M.backgroundIntensity,c.material.toneMapped=xi.getTransfer(P.colorSpace)!==Gi,P.matrixAutoUpdate===!0&&P.updateMatrix(),c.material.uniforms.uvTransform.value.copy(P.matrix),(h!==P||p!==P.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,h=P,p=P.version,m=n.toneMapping),c.layers.enableAll(),S.unshift(c,c.geometry,c.material,0,0,null))}function v(S,M){S.getRGB(N5,Rne(n)),i.buffers.color.setClear(N5.r,N5.g,N5.b,M,o)}function T(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return a},setClearColor:function(S,M=1){a.set(S),l=M,v(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(S){l=S,v(a,l)},render:b,addToRenderList:w,dispose:T}}function qke(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=p(null);let s=r,o=!1;function a(I,F,j,W,U){let H=!1;const q=h(W,j,F);s!==q&&(s=q,c(s.object)),H=m(I,W,j,U),H&&y(I,W,j,U),U!==null&&e.update(U,n.ELEMENT_ARRAY_BUFFER),(H||o)&&(o=!1,M(I,F,j,W),U!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(U).buffer))}function l(){return n.createVertexArray()}function c(I){return n.bindVertexArray(I)}function u(I){return n.deleteVertexArray(I)}function h(I,F,j){const W=j.wireframe===!0;let U=i[I.id];U===void 0&&(U={},i[I.id]=U);let H=U[F.id];H===void 0&&(H={},U[F.id]=H);let q=H[W];return q===void 0&&(q=p(l()),H[W]=q),q}function p(I){const F=[],j=[],W=[];for(let U=0;U<t;U++)F[U]=0,j[U]=0,W[U]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:F,enabledAttributes:j,attributeDivisors:W,object:I,attributes:{},index:null}}function m(I,F,j,W){const U=s.attributes,H=F.attributes;let q=0;const J=j.getAttributes();for(const G in J)if(J[G].location>=0){const Q=U[G];let ne=H[G];if(ne===void 0&&(G==="instanceMatrix"&&I.instanceMatrix&&(ne=I.instanceMatrix),G==="instanceColor"&&I.instanceColor&&(ne=I.instanceColor)),Q===void 0||Q.attribute!==ne||ne&&Q.data!==ne.data)return!0;q++}return s.attributesNum!==q||s.index!==W}function y(I,F,j,W){const U={},H=F.attributes;let q=0;const J=j.getAttributes();for(const G in J)if(J[G].location>=0){let Q=H[G];Q===void 0&&(G==="instanceMatrix"&&I.instanceMatrix&&(Q=I.instanceMatrix),G==="instanceColor"&&I.instanceColor&&(Q=I.instanceColor));const ne={};ne.attribute=Q,Q&&Q.data&&(ne.data=Q.data),U[G]=ne,q++}s.attributes=U,s.attributesNum=q,s.index=W}function b(){const I=s.newAttributes;for(let F=0,j=I.length;F<j;F++)I[F]=0}function w(I){v(I,0)}function v(I,F){const j=s.newAttributes,W=s.enabledAttributes,U=s.attributeDivisors;j[I]=1,W[I]===0&&(n.enableVertexAttribArray(I),W[I]=1),U[I]!==F&&(n.vertexAttribDivisor(I,F),U[I]=F)}function T(){const I=s.newAttributes,F=s.enabledAttributes;for(let j=0,W=F.length;j<W;j++)F[j]!==I[j]&&(n.disableVertexAttribArray(j),F[j]=0)}function S(I,F,j,W,U,H,q){q===!0?n.vertexAttribIPointer(I,F,j,U,H):n.vertexAttribPointer(I,F,j,W,U,H)}function M(I,F,j,W){b();const U=W.attributes,H=j.getAttributes(),q=F.defaultAttributeValues;for(const J in H){const G=H[J];if(G.location>=0){let ee=U[J];if(ee===void 0&&(J==="instanceMatrix"&&I.instanceMatrix&&(ee=I.instanceMatrix),J==="instanceColor"&&I.instanceColor&&(ee=I.instanceColor)),ee!==void 0){const Q=ee.normalized,ne=ee.itemSize,fe=e.get(ee);if(fe===void 0)continue;const Ae=fe.buffer,Pe=fe.type,Ce=fe.bytesPerElement,de=Pe===n.INT||Pe===n.UNSIGNED_INT||ee.gpuType===E9;if(ee.isInterleavedBufferAttribute){const Ne=ee.data,et=Ne.stride,me=ee.offset;if(Ne.isInstancedInterleavedBuffer){for(let nt=0;nt<G.locationSize;nt++)v(G.location+nt,Ne.meshPerAttribute);I.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=Ne.meshPerAttribute*Ne.count)}else for(let nt=0;nt<G.locationSize;nt++)w(G.location+nt);n.bindBuffer(n.ARRAY_BUFFER,Ae);for(let nt=0;nt<G.locationSize;nt++)S(G.location+nt,ne/G.locationSize,Pe,Q,et*Ce,(me+ne/G.locationSize*nt)*Ce,de)}else{if(ee.isInstancedBufferAttribute){for(let Ne=0;Ne<G.locationSize;Ne++)v(G.location+Ne,ee.meshPerAttribute);I.isInstancedMesh!==!0&&W._maxInstanceCount===void 0&&(W._maxInstanceCount=ee.meshPerAttribute*ee.count)}else for(let Ne=0;Ne<G.locationSize;Ne++)w(G.location+Ne);n.bindBuffer(n.ARRAY_BUFFER,Ae);for(let Ne=0;Ne<G.locationSize;Ne++)S(G.location+Ne,ne/G.locationSize,Pe,Q,ne*Ce,ne/G.locationSize*Ne*Ce,de)}}else if(q!==void 0){const Q=q[J];if(Q!==void 0)switch(Q.length){case 2:n.vertexAttrib2fv(G.location,Q);break;case 3:n.vertexAttrib3fv(G.location,Q);break;case 4:n.vertexAttrib4fv(G.location,Q);break;default:n.vertexAttrib1fv(G.location,Q)}}}}T()}function P(){B();for(const I in i){const F=i[I];for(const j in F){const W=F[j];for(const U in W)u(W[U].object),delete W[U];delete F[j]}delete i[I]}}function R(I){if(i[I.id]===void 0)return;const F=i[I.id];for(const j in F){const W=F[j];for(const U in W)u(W[U].object),delete W[U];delete F[j]}delete i[I.id]}function O(I){for(const F in i){const j=i[F];if(j[I.id]===void 0)continue;const W=j[I.id];for(const U in W)u(W[U].object),delete W[U];delete j[I.id]}}function B(){N(),o=!0,s!==r&&(s=r,c(s.object))}function N(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:a,reset:B,resetDefaultState:N,dispose:P,releaseStatesOfGeometry:R,releaseStatesOfProgram:O,initAttributes:b,enableAttribute:w,disableUnusedAttributes:T}}function Zke(n,e,t){let i;function r(c){i=c}function s(c,u){n.drawArrays(i,c,u),t.update(u,i,1)}function o(c,u,h){h!==0&&(n.drawArraysInstanced(i,c,u,h),t.update(u,i,h))}function a(c,u,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(i,c,0,u,0,h);let m=0;for(let y=0;y<h;y++)m+=u[y];t.update(m,i,1)}function l(c,u,h,p){if(h===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let y=0;y<c.length;y++)o(c[y],u[y],p[y]);else{m.multiDrawArraysInstancedWEBGL(i,c,0,u,0,p,0,h);let y=0;for(let b=0;b<h;b++)y+=u[b]*p[b];t.update(y,i,1)}}this.setMode=r,this.render=s,this.renderInstances=o,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function Yke(n,e,t,i){let r;function s(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const O=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(O){return!(O!==Oo&&i.convert(O)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(O){const B=O===du&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(O!==ca&&i.convert(O)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&O!==Do&&!B)}function l(O){if(O==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";O="mediump"}return O==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(Wt("WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const h=t.logarithmicDepthBuffer===!0,p=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),y=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),b=n.getParameter(n.MAX_TEXTURE_SIZE),w=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),v=n.getParameter(n.MAX_VERTEX_ATTRIBS),T=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),S=n.getParameter(n.MAX_VARYING_VECTORS),M=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),P=n.getParameter(n.MAX_SAMPLES),R=n.getParameter(n.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:l,textureFormatReadable:o,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:h,reversedDepthBuffer:p,maxTextures:m,maxVertexTextures:y,maxTextureSize:b,maxCubemapSize:w,maxAttributes:v,maxVertexUniforms:T,maxVaryings:S,maxFragmentUniforms:M,maxSamples:P,samples:R}}function Xke(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new rd,a=new ti,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(h,p){const m=h.length!==0||p||i!==0||r;return r=p,i=h.length,m},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(h,p){t=u(h,p,0)},this.setState=function(h,p,m){const y=h.clippingPlanes,b=h.clipIntersection,w=h.clipShadows,v=n.get(h);if(!r||y===null||y.length===0||s&&!w)s?u(null):c();else{const T=s?0:i,S=T*4;let M=v.clippingState||null;l.value=M,M=u(y,p,S,m);for(let P=0;P!==S;++P)M[P]=t[P];v.clippingState=M,this.numIntersection=b?this.numPlanes:0,this.numPlanes+=T}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(h,p,m,y){const b=h!==null?h.length:0;let w=null;if(b!==0){if(w=l.value,y!==!0||w===null){const v=m+b*4,T=p.matrixWorldInverse;a.getNormalMatrix(T),(w===null||w.length<v)&&(w=new Float32Array(v));for(let S=0,M=m;S!==b;++S,M+=4)o.copy(h[S]).applyMatrix4(T,a),o.normal.toArray(w,M),w[M+3]=o.constant}l.value=w,l.needsUpdate=!0}return e.numPlanes=b,e.numIntersection=0,w}}function Qke(n){let e=new WeakMap;function t(o,a){return a===Rb?o.mapping=fh:a===Ib&&(o.mapping=L0),o}function i(o){if(o&&o.isTexture){const a=o.mapping;if(a===Rb||a===Ib)if(e.has(o)){const l=e.get(o).texture;return t(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new jD(l.height);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}else return null}}return o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function s(){e=new WeakMap}return{get:i,dispose:s}}const s0=4,NH=[.125,.215,.35,.446,.526,.582],Yp=20,Jke=256,Iv=new Cd,PH=new an;let sM=null,oM=0,aM=0,lM=!1;const eLe=new ye;class GN{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,i=.1,r=100,s={}){const{size:o=256,position:a=eLe}=s;sM=this._renderer.getRenderTarget(),oM=this._renderer.getActiveCubeFace(),aM=this._renderer.getActiveMipmapLevel(),lM=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,r,l,a),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=DH(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=LH(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(sM,oM,aM),this._renderer.xr.enabled=lM,e.scissorTest=!1,Ag(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===fh||e.mapping===L0?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),sM=this._renderer.getRenderTarget(),oM=this._renderer.getActiveCubeFace(),aM=this._renderer.getActiveMipmapLevel(),lM=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:mr,minFilter:mr,generateMipmaps:!1,type:du,format:Oo,colorSpace:i1,depthBuffer:!1},r=kH(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=kH(e,t,i);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=tLe(s)),this._blurMaterial=iLe(s,e,t),this._ggxMaterial=nLe(s,e,t)}return r}_compileMaterial(e){const t=new xs(new Jn,e);this._renderer.compile(t,Iv)}_sceneToCubeUV(e,t,i,r,s){const l=new ns(90,1,t,i),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],h=this._renderer,p=h.autoClear,m=h.toneMapping;h.getClearColor(PH),h.toneMapping=pc,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(r),h.clearDepth(),h.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new xs(new T1,new q0({name:"PMREM.Background",side:fa,depthWrite:!1,depthTest:!1})));const b=this._backgroundBox,w=b.material;let v=!1;const T=e.background;T?T.isColor&&(w.color.copy(T),e.background=null,v=!0):(w.color.copy(PH),v=!0);for(let S=0;S<6;S++){const M=S%3;M===0?(l.up.set(0,c[S],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x+u[S],s.y,s.z)):M===1?(l.up.set(0,0,c[S]),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y+u[S],s.z)):(l.up.set(0,c[S],0),l.position.set(s.x,s.y,s.z),l.lookAt(s.x,s.y,s.z+u[S]));const P=this._cubeSize;Ag(r,M*P,S>2?P:0,P,P),h.setRenderTarget(r),v&&h.render(b,l),h.render(e,l)}h.toneMapping=m,h.autoClear=p,e.background=T}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===fh||e.mapping===L0;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=DH()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=LH());const s=r?this._cubemapMaterial:this._equirectMaterial,o=this._lodMeshes[0];o.material=s;const a=s.uniforms;a.envMap.value=e;const l=this._cubeSize;Ag(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Iv)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;const r=this._lodMeshes.length;for(let s=1;s<r;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=i}_applyGGXFilter(e,t,i){const r=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,a=this._lodMeshes[i];a.material=o;const l=o.uniforms,c=i/(this._lodMeshes.length-1),u=t/(this._lodMeshes.length-1),h=Math.sqrt(c*c-u*u),p=0+c*1.25,m=h*p,{_lodMax:y}=this,b=this._sizeLods[i],w=3*b*(i>y-s0?i-y+s0:0),v=4*(this._cubeSize-b);l.envMap.value=e.texture,l.roughness.value=m,l.mipInt.value=y-t,Ag(s,w,v,3*b,2*b),r.setRenderTarget(s),r.render(a,Iv),l.envMap.value=s.texture,l.roughness.value=0,l.mipInt.value=y-i,Ag(e,w,v,3*b,2*b),r.setRenderTarget(e),r.render(a,Iv)}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&xn("blur direction must be either latitudinal or longitudinal!");const u=3,h=this._lodMeshes[r];h.material=c;const p=c.uniforms,m=this._sizeLods[i]-1,y=isFinite(s)?Math.PI/(2*m):2*Math.PI/(2*Yp-1),b=s/y,w=isFinite(s)?1+Math.floor(u*b):Yp;w>Yp&&Wt(`sigmaRadians, ${s}, is too large and will clip, as it requested ${w} samples when the maximum is set to ${Yp}`);const v=[];let T=0;for(let O=0;O<Yp;++O){const B=O/b,N=Math.exp(-B*B/2);v.push(N),O===0?T+=N:O<w&&(T+=2*N)}for(let O=0;O<v.length;O++)v[O]=v[O]/T;p.envMap.value=e.texture,p.samples.value=w,p.weights.value=v,p.latitudinal.value=o==="latitudinal",a&&(p.poleAxis.value=a);const{_lodMax:S}=this;p.dTheta.value=y,p.mipInt.value=S-i;const M=this._sizeLods[r],P=3*M*(r>S-s0?r-S+s0:0),R=4*(this._cubeSize-M);Ag(t,P,R,3*M,2*M),l.setRenderTarget(t),l.render(h,Iv)}}function tLe(n){const e=[],t=[],i=[];let r=n;const s=n-s0+1+NH.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);e.push(a);let l=1/a;o>n-s0?l=NH[o-n+s0-1]:o===0&&(l=0),t.push(l);const c=1/(a-2),u=-c,h=1+c,p=[u,u,h,u,h,h,u,u,h,h,u,h],m=6,y=6,b=3,w=2,v=1,T=new Float32Array(b*y*m),S=new Float32Array(w*y*m),M=new Float32Array(v*y*m);for(let R=0;R<m;R++){const O=R%3*2/3-1,B=R>2?0:-1,N=[O,B,0,O+2/3,B,0,O+2/3,B+1,0,O,B,0,O+2/3,B+1,0,O,B+1,0];T.set(N,b*y*R),S.set(p,w*y*R);const I=[R,R,R,R,R,R];M.set(I,v*y*R)}const P=new Jn;P.setAttribute("position",new lr(T,b)),P.setAttribute("uv",new lr(S,w)),P.setAttribute("faceIndex",new lr(M,v)),i.push(new xs(P,null)),r>s0&&r--}return{lodMeshes:i,sizeLods:e,sigmas:t}}function kH(n,e,t){const i=new Xa(n,e,t);return i.texture.mapping=xx,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Ag(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function nLe(n,e,t){return new _c({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:Jke,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:tT(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:ah,depthTest:!1,depthWrite:!1})}function iLe(n,e,t){const i=new Float32Array(Yp),r=new ye(0,1,0);return new _c({name:"SphericalGaussianBlur",defines:{n:Yp,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:tT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ah,depthTest:!1,depthWrite:!1})}function LH(){return new _c({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:tT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ah,depthTest:!1,depthWrite:!1})}function DH(){return new _c({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:tT(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ah,depthTest:!1,depthWrite:!1})}function tT(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function rLe(n){let e=new WeakMap,t=null;function i(a){if(a&&a.isTexture){const l=a.mapping,c=l===Rb||l===Ib,u=l===fh||l===L0;if(c||u){let h=e.get(a);const p=h!==void 0?h.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==p)return t===null&&(t=new GN(n)),h=c?t.fromEquirectangular(a,h):t.fromCubemap(a,h),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),h.texture;if(h!==void 0)return h.texture;{const m=a.image;return c&&m&&m.height>0||u&&m&&r(m)?(t===null&&(t=new GN(n)),h=c?t.fromEquirectangular(a):t.fromCubemap(a),h.texture.pmremVersion=a.pmremVersion,e.set(a,h),a.addEventListener("dispose",s),h.texture):null}}}return a}function r(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:o}}function sLe(n){const e={};function t(i){if(e[i]!==void 0)return e[i];const r=n.getExtension(i);return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&q2("WebGLRenderer: "+i+" extension not supported."),r}}}function oLe(n,e,t,i){const r={},s=new WeakMap;function o(h){const p=h.target;p.index!==null&&e.remove(p.index);for(const y in p.attributes)e.remove(p.attributes[y]);p.removeEventListener("dispose",o),delete r[p.id];const m=s.get(p);m&&(e.remove(m),s.delete(p)),i.releaseStatesOfGeometry(p),p.isInstancedBufferGeometry===!0&&delete p._maxInstanceCount,t.memory.geometries--}function a(h,p){return r[p.id]===!0||(p.addEventListener("dispose",o),r[p.id]=!0,t.memory.geometries++),p}function l(h){const p=h.attributes;for(const m in p)e.update(p[m],n.ARRAY_BUFFER)}function c(h){const p=[],m=h.index,y=h.attributes.position;let b=0;if(m!==null){const T=m.array;b=m.version;for(let S=0,M=T.length;S<M;S+=3){const P=T[S+0],R=T[S+1],O=T[S+2];p.push(P,R,R,O,O,P)}}else if(y!==void 0){const T=y.array;b=y.version;for(let S=0,M=T.length/3-1;S<M;S+=3){const P=S+0,R=S+1,O=S+2;p.push(P,R,R,O,O,P)}}else return;const w=new(vne(p)?zD:FD)(p,1);w.version=b;const v=s.get(h);v&&e.remove(v),s.set(h,w)}function u(h){const p=s.get(h);if(p){const m=h.index;m!==null&&p.version<m.version&&c(h)}else c(h);return s.get(h)}return{get:a,update:l,getWireframeAttribute:u}}function aLe(n,e,t){let i;function r(p){i=p}let s,o;function a(p){s=p.type,o=p.bytesPerElement}function l(p,m){n.drawElements(i,m,s,p*o),t.update(m,i,1)}function c(p,m,y){y!==0&&(n.drawElementsInstanced(i,m,s,p*o,y),t.update(m,i,y))}function u(p,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(i,m,0,s,p,0,y);let w=0;for(let v=0;v<y;v++)w+=m[v];t.update(w,i,1)}function h(p,m,y,b){if(y===0)return;const w=e.get("WEBGL_multi_draw");if(w===null)for(let v=0;v<p.length;v++)c(p[v]/o,m[v],b[v]);else{w.multiDrawElementsInstancedWEBGL(i,m,0,s,p,0,b,0,y);let v=0;for(let T=0;T<y;T++)v+=m[T]*b[T];t.update(v,i,1)}}this.setMode=r,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=h}function lLe(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(s,o,a){switch(t.calls++,o){case n.TRIANGLES:t.triangles+=a*(s/3);break;case n.LINES:t.lines+=a*(s/2);break;case n.LINE_STRIP:t.lines+=a*(s-1);break;case n.LINE_LOOP:t.lines+=a*s;break;case n.POINTS:t.points+=a*s;break;default:xn("WebGLInfo: Unknown draw mode:",o);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function cLe(n,e,t){const i=new WeakMap,r=new fr;function s(o,a,l){const c=o.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,h=u!==void 0?u.length:0;let p=i.get(a);if(p===void 0||p.count!==h){let N=function(){O.dispose(),i.delete(a),a.removeEventListener("dispose",N)};p!==void 0&&p.texture.dispose();const m=a.morphAttributes.position!==void 0,y=a.morphAttributes.normal!==void 0,b=a.morphAttributes.color!==void 0,w=a.morphAttributes.position||[],v=a.morphAttributes.normal||[],T=a.morphAttributes.color||[];let S=0;m===!0&&(S=1),y===!0&&(S=2),b===!0&&(S=3);let M=a.attributes.position.count*S,P=1;M>e.maxTextureSize&&(P=Math.ceil(M/e.maxTextureSize),M=e.maxTextureSize);const R=new Float32Array(M*P*4*h),O=new k9(R,M,P,h);O.type=Do,O.needsUpdate=!0;const B=S*4;for(let I=0;I<h;I++){const F=w[I],j=v[I],W=T[I],U=M*P*4*I;for(let H=0;H<F.count;H++){const q=H*B;m===!0&&(r.fromBufferAttribute(F,H),R[U+q+0]=r.x,R[U+q+1]=r.y,R[U+q+2]=r.z,R[U+q+3]=0),y===!0&&(r.fromBufferAttribute(j,H),R[U+q+4]=r.x,R[U+q+5]=r.y,R[U+q+6]=r.z,R[U+q+7]=0),b===!0&&(r.fromBufferAttribute(W,H),R[U+q+8]=r.x,R[U+q+9]=r.y,R[U+q+10]=r.z,R[U+q+11]=W.itemSize===4?r.w:1)}}p={count:h,texture:O,size:new Et(M,P)},i.set(a,p),a.addEventListener("dispose",N)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",o.morphTexture,t);else{let m=0;for(let b=0;b<c.length;b++)m+=c[b];const y=a.morphTargetsRelative?1:1-m;l.getUniforms().setValue(n,"morphTargetBaseInfluence",y),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",p.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",p.size)}return{update:s}}function uLe(n,e,t,i){let r=new WeakMap;function s(l){const c=i.render.frame,u=l.geometry,h=e.get(l,u);if(r.get(h)!==c&&(e.update(h),r.set(h,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),r.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),r.set(l,c))),l.isSkinnedMesh){const p=l.skeleton;r.get(p)!==c&&(p.update(),r.set(p,c))}return h}function o(){r=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:s,dispose:o}}const hLe={[SD]:"LINEAR_TONE_MAPPING",[ED]:"REINHARD_TONE_MAPPING",[TD]:"CINEON_TONE_MAPPING",[w9]:"ACES_FILMIC_TONE_MAPPING",[CD]:"AGX_TONE_MAPPING",[MD]:"NEUTRAL_TONE_MAPPING",[AD]:"CUSTOM_TONE_MAPPING"};function dLe(n,e,t,i,r){const s=new Xa(e,t,{type:n,depthBuffer:i,stencilBuffer:r}),o=new Xa(e,t,{type:du,depthBuffer:!1,stencilBuffer:!1}),a=new Jn;a.setAttribute("position",new un([-1,3,0,-1,-1,0,3,-1,0],3)),a.setAttribute("uv",new un([0,2,0,0,2,0],2));const l=new eO({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),c=new xs(a,l),u=new Cd(-1,1,1,-1,0,1);let h=null,p=null,m=!1,y,b=null,w=[],v=!1;this.setSize=function(T,S){s.setSize(T,S),o.setSize(T,S);for(let M=0;M<w.length;M++){const P=w[M];P.setSize&&P.setSize(T,S)}},this.setEffects=function(T){w=T,v=w.length>0&&w[0].isRenderPass===!0;const S=s.width,M=s.height;for(let P=0;P<w.length;P++){const R=w[P];R.setSize&&R.setSize(S,M)}},this.begin=function(T,S){if(m||T.toneMapping===pc&&w.length===0)return!1;if(b=S,S!==null){const M=S.width,P=S.height;(s.width!==M||s.height!==P)&&this.setSize(M,P)}return v===!1&&T.setRenderTarget(s),y=T.toneMapping,T.toneMapping=pc,!0},this.hasRenderPass=function(){return v},this.end=function(T,S){T.toneMapping=y,m=!0;let M=s,P=o;for(let R=0;R<w.length;R++){const O=w[R];if(O.enabled!==!1&&(O.render(T,P,M,S),O.needsSwap!==!1)){const B=M;M=P,P=B}}if(h!==T.outputColorSpace||p!==T.toneMapping){h=T.outputColorSpace,p=T.toneMapping,l.defines={},xi.getTransfer(h)===Gi&&(l.defines.SRGB_TRANSFER="");const R=hLe[p];R&&(l.defines[R]=""),l.needsUpdate=!0}l.uniforms.tDiffuse.value=M.texture,T.setRenderTarget(b),T.render(c,u),b=null,m=!1},this.isCompositing=function(){return m},this.dispose=function(){s.dispose(),o.dispose(),a.dispose(),l.dispose()}}const Rie=new Gs,WN=new s1(1,1),Iie=new k9,Nie=new L9,Pie=new K_,OH=[],BH=[],UH=new Float32Array(16),FH=new Float32Array(9),zH=new Float32Array(4);function _x(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=OH[r];if(s===void 0&&(s=new Float32Array(r),OH[r]=s),e!==0){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function Rs(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Is(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function nT(n,e){let t=BH[e];t===void 0&&(t=new Int32Array(e),BH[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function fLe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function pLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rs(t,e))return;n.uniform2fv(this.addr,e),Is(t,e)}}function mLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Rs(t,e))return;n.uniform3fv(this.addr,e),Is(t,e)}}function gLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rs(t,e))return;n.uniform4fv(this.addr,e),Is(t,e)}}function yLe(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Rs(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Is(t,e)}else{if(Rs(t,i))return;zH.set(i),n.uniformMatrix2fv(this.addr,!1,zH),Is(t,i)}}function xLe(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Rs(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Is(t,e)}else{if(Rs(t,i))return;FH.set(i),n.uniformMatrix3fv(this.addr,!1,FH),Is(t,i)}}function vLe(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Rs(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Is(t,e)}else{if(Rs(t,i))return;UH.set(i),n.uniformMatrix4fv(this.addr,!1,UH),Is(t,i)}}function bLe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function _Le(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rs(t,e))return;n.uniform2iv(this.addr,e),Is(t,e)}}function wLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Rs(t,e))return;n.uniform3iv(this.addr,e),Is(t,e)}}function SLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rs(t,e))return;n.uniform4iv(this.addr,e),Is(t,e)}}function ELe(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function TLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Rs(t,e))return;n.uniform2uiv(this.addr,e),Is(t,e)}}function ALe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Rs(t,e))return;n.uniform3uiv(this.addr,e),Is(t,e)}}function CLe(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Rs(t,e))return;n.uniform4uiv(this.addr,e),Is(t,e)}}function MLe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);let s;this.type===n.SAMPLER_2D_SHADOW?(WN.compareFunction=t.isReversedDepthBuffer()?P9:N9,s=WN):s=Rie,t.setTexture2D(e||s,r)}function RLe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||Nie,r)}function ILe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||Pie,r)}function NLe(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||Iie,r)}function PLe(n){switch(n){case 5126:return fLe;case 35664:return pLe;case 35665:return mLe;case 35666:return gLe;case 35674:return yLe;case 35675:return xLe;case 35676:return vLe;case 5124:case 35670:return bLe;case 35667:case 35671:return _Le;case 35668:case 35672:return wLe;case 35669:case 35673:return SLe;case 5125:return ELe;case 36294:return TLe;case 36295:return ALe;case 36296:return CLe;case 35678:case 36198:case 36298:case 36306:case 35682:return MLe;case 35679:case 36299:case 36307:return RLe;case 35680:case 36300:case 36308:case 36293:return ILe;case 36289:case 36303:case 36311:case 36292:return NLe}}function kLe(n,e){n.uniform1fv(this.addr,e)}function LLe(n,e){const t=_x(e,this.size,2);n.uniform2fv(this.addr,t)}function DLe(n,e){const t=_x(e,this.size,3);n.uniform3fv(this.addr,t)}function OLe(n,e){const t=_x(e,this.size,4);n.uniform4fv(this.addr,t)}function BLe(n,e){const t=_x(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function ULe(n,e){const t=_x(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function FLe(n,e){const t=_x(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function zLe(n,e){n.uniform1iv(this.addr,e)}function jLe(n,e){n.uniform2iv(this.addr,e)}function VLe(n,e){n.uniform3iv(this.addr,e)}function HLe(n,e){n.uniform4iv(this.addr,e)}function $Le(n,e){n.uniform1uiv(this.addr,e)}function GLe(n,e){n.uniform2uiv(this.addr,e)}function WLe(n,e){n.uniform3uiv(this.addr,e)}function KLe(n,e){n.uniform4uiv(this.addr,e)}function qLe(n,e,t){const i=this.cache,r=e.length,s=nT(t,r);Rs(i,s)||(n.uniform1iv(this.addr,s),Is(i,s));let o;this.type===n.SAMPLER_2D_SHADOW?o=WN:o=Rie;for(let a=0;a!==r;++a)t.setTexture2D(e[a]||o,s[a])}function ZLe(n,e,t){const i=this.cache,r=e.length,s=nT(t,r);Rs(i,s)||(n.uniform1iv(this.addr,s),Is(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||Nie,s[o])}function YLe(n,e,t){const i=this.cache,r=e.length,s=nT(t,r);Rs(i,s)||(n.uniform1iv(this.addr,s),Is(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||Pie,s[o])}function XLe(n,e,t){const i=this.cache,r=e.length,s=nT(t,r);Rs(i,s)||(n.uniform1iv(this.addr,s),Is(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||Iie,s[o])}function QLe(n){switch(n){case 5126:return kLe;case 35664:return LLe;case 35665:return DLe;case 35666:return OLe;case 35674:return BLe;case 35675:return ULe;case 35676:return FLe;case 5124:case 35670:return zLe;case 35667:case 35671:return jLe;case 35668:case 35672:return VLe;case 35669:case 35673:return HLe;case 5125:return $Le;case 36294:return GLe;case 36295:return WLe;case 36296:return KLe;case 35678:case 36198:case 36298:case 36306:case 35682:return qLe;case 35679:case 36299:case 36307:return ZLe;case 35680:case 36300:case 36308:case 36293:return YLe;case 36289:case 36303:case 36311:case 36292:return XLe}}class JLe{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=PLe(t.type)}}class eDe{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=QLe(t.type)}}class tDe{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const cM=/(\w+)(\])?(\[|\.)?/g;function jH(n,e){n.seq.push(e),n.map[e.id]=e}function nDe(n,e,t){const i=n.name,r=i.length;for(cM.lastIndex=0;;){const s=cM.exec(i),o=cM.lastIndex;let a=s[1];const l=s[2]==="]",c=s[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===r){jH(t,c===void 0?new JLe(a,n,e):new eDe(a,n,e));break}else{let h=t.map[a];h===void 0&&(h=new tDe(a),jH(t,h)),t=h}}}class VS{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<i;++o){const a=e.getActiveUniform(t,o),l=e.getUniformLocation(t,a.name);nDe(a,l,this)}const r=[],s=[];for(const o of this.seq)o.type===e.SAMPLER_2D_SHADOW||o.type===e.SAMPLER_CUBE_SHADOW||o.type===e.SAMPLER_2D_ARRAY_SHADOW?r.push(o):s.push(o);r.length>0&&(this.seq=r.concat(s))}setValue(e,t,i,r){const s=this.map[t];s!==void 0&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function VH(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const iDe=37297;let rDe=0;function sDe(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join(`
`)}const HH=new ti;function oDe(n){xi._getMatrix(HH,xi.workingColorSpace,n);const e=`mat3( ${HH.elements.map(t=>t.toFixed(4))} )`;switch(xi.getTransfer(n)){case Db:return[e,"LinearTransferOETF"];case Gi:return[e,"sRGBTransferOETF"];default:return Wt("WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function $H(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),s=(n.getShaderInfoLog(e)||"").trim();if(i&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const a=parseInt(o[1]);return t.toUpperCase()+`

`+s+`

`+sDe(n.getShaderSource(e),a)}else return s}function aDe(n,e){const t=oDe(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const lDe={[SD]:"Linear",[ED]:"Reinhard",[TD]:"Cineon",[w9]:"ACESFilmic",[CD]:"AgX",[MD]:"Neutral",[AD]:"Custom"};function cDe(n,e){const t=lDe[e];return t===void 0?(Wt("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+n+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const P5=new ye;function uDe(){xi.getLuminanceCoefficients(P5);const n=P5.x.toFixed(4),e=P5.y.toFixed(4),t=P5.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function hDe(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(c3).join(`
`)}function dDe(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function fDe(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;s.type===n.FLOAT_MAT2&&(a=2),s.type===n.FLOAT_MAT3&&(a=3),s.type===n.FLOAT_MAT4&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}function c3(n){return n!==""}function GH(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function WH(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const pDe=/^[ \t]*#include +<([\w\d./]+)>/gm;function KN(n){return n.replace(pDe,gDe)}const mDe=new Map;function gDe(n,e){let t=ei[e];if(t===void 0){const i=mDe.get(e);if(i!==void 0)t=ei[i],Wt('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return KN(t)}const yDe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function KH(n){return n.replace(yDe,xDe)}function xDe(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function qH(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const vDe={[ky]:"SHADOWMAP_TYPE_PCF",[dm]:"SHADOWMAP_TYPE_VSM"};function bDe(n){return vDe[n.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const _De={[fh]:"ENVMAP_TYPE_CUBE",[L0]:"ENVMAP_TYPE_CUBE",[xx]:"ENVMAP_TYPE_CUBE_UV"};function wDe(n){return n.envMap===!1?"ENVMAP_TYPE_CUBE":_De[n.envMapMode]||"ENVMAP_TYPE_CUBE"}const SDe={[L0]:"ENVMAP_MODE_REFRACTION"};function EDe(n){return n.envMap===!1?"ENVMAP_MODE_REFLECTION":SDe[n.envMapMode]||"ENVMAP_MODE_REFLECTION"}const TDe={[$_]:"ENVMAP_BLENDING_MULTIPLY",[sne]:"ENVMAP_BLENDING_MIX",[one]:"ENVMAP_BLENDING_ADD"};function ADe(n){return n.envMap===!1?"ENVMAP_BLENDING_NONE":TDe[n.combine]||"ENVMAP_BLENDING_NONE"}function CDe(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function MDe(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=bDe(t),c=wDe(t),u=EDe(t),h=ADe(t),p=CDe(t),m=hDe(t),y=dDe(s),b=r.createProgram();let w,v,T=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(w=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(c3).join(`
`),w.length>0&&(w+=`
`),v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(c3).join(`
`),v.length>0&&(v+=`
`)):(w=[qH(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(c3).join(`
`),v=[qH(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==pc?"#define TONE_MAPPING":"",t.toneMapping!==pc?ei.tonemapping_pars_fragment:"",t.toneMapping!==pc?cDe("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ei.colorspace_pars_fragment,aDe("linearToOutputTexel",t.outputColorSpace),uDe(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(c3).join(`
`)),o=KN(o),o=GH(o,t),o=WH(o,t),a=KN(a),a=GH(a,t),a=WH(a,t),o=KH(o),a=KH(a),t.isRawShaderMaterial!==!0&&(T=`#version 300 es
`,w=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+w,v=["#define varying in",t.glslVersion===DN?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===DN?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const S=T+w+o,M=T+v+a,P=VH(r,r.VERTEX_SHADER,S),R=VH(r,r.FRAGMENT_SHADER,M);r.attachShader(b,P),r.attachShader(b,R),t.index0AttributeName!==void 0?r.bindAttribLocation(b,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(b,0,"position"),r.linkProgram(b);function O(F){if(n.debug.checkShaderErrors){const j=r.getProgramInfoLog(b)||"",W=r.getShaderInfoLog(P)||"",U=r.getShaderInfoLog(R)||"",H=j.trim(),q=W.trim(),J=U.trim();let G=!0,ee=!0;if(r.getProgramParameter(b,r.LINK_STATUS)===!1)if(G=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,b,P,R);else{const Q=$H(r,P,"vertex"),ne=$H(r,R,"fragment");xn("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(b,r.VALIDATE_STATUS)+`

Material Name: `+F.name+`
Material Type: `+F.type+`

Program Info Log: `+H+`
`+Q+`
`+ne)}else H!==""?Wt("WebGLProgram: Program Info Log:",H):(q===""||J==="")&&(ee=!1);ee&&(F.diagnostics={runnable:G,programLog:H,vertexShader:{log:q,prefix:w},fragmentShader:{log:J,prefix:v}})}r.deleteShader(P),r.deleteShader(R),B=new VS(r,b),N=fDe(r,b)}let B;this.getUniforms=function(){return B===void 0&&O(this),B};let N;this.getAttributes=function(){return N===void 0&&O(this),N};let I=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return I===!1&&(I=r.getProgramParameter(b,iDe)),I},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(b),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=rDe++,this.cacheKey=e,this.usedTimes=1,this.program=b,this.vertexShader=P,this.fragmentShader=R,this}let RDe=0;class IDe{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return o.has(r)===!1&&(o.add(r),r.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new NDe(e),t.set(e,i)),i}}class NDe{constructor(e){this.id=RDe++,this.code=e,this.usedTimes=0}}function PDe(n,e,t,i,r,s,o){const a=new Dm,l=new IDe,c=new Set,u=[],h=new Map,p=r.logarithmicDepthBuffer;let m=r.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function b(N){return c.add(N),N===0?"uv":`uv${N}`}function w(N,I,F,j,W){const U=j.fog,H=W.geometry,q=N.isMeshStandardMaterial?j.environment:null,J=(N.isMeshStandardMaterial?t:e).get(N.envMap||q),G=J&&J.mapping===xx?J.image.height:null,ee=y[N.type];N.precision!==null&&(m=r.getMaxPrecision(N.precision),m!==N.precision&&Wt("WebGLProgram.getParameters:",N.precision,"not supported, using",m,"instead."));const Q=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,ne=Q!==void 0?Q.length:0;let fe=0;H.morphAttributes.position!==void 0&&(fe=1),H.morphAttributes.normal!==void 0&&(fe=2),H.morphAttributes.color!==void 0&&(fe=3);let Ae,Pe,Ce,de;if(ee){const mn=Xc[ee];Ae=mn.vertexShader,Pe=mn.fragmentShader}else Ae=N.vertexShader,Pe=N.fragmentShader,l.update(N),Ce=l.getVertexShaderID(N),de=l.getFragmentShaderID(N);const Ne=n.getRenderTarget(),et=n.state.buffers.depth.getReversed(),me=W.isInstancedMesh===!0,nt=W.isBatchedMesh===!0,Pt=!!N.map,zt=!!N.matcap,Dt=!!J,gt=!!N.aoMap,vt=!!N.lightMap,Oe=!!N.bumpMap,xt=!!N.normalMap,pe=!!N.displacementMap,qe=!!N.emissiveMap,$e=!!N.metalnessMap,Xe=!!N.roughnessMap,Ye=N.anisotropy>0,oe=N.clearcoat>0,Z=N.dispersion>0,he=N.iridescence>0,Ge=N.sheen>0,ct=N.transmission>0,tt=Ye&&!!N.anisotropyMap,Lt=oe&&!!N.clearcoatMap,Ct=oe&&!!N.clearcoatNormalMap,Ot=oe&&!!N.clearcoatRoughnessMap,nn=he&&!!N.iridescenceMap,Tt=he&&!!N.iridescenceThicknessMap,Ve=Ge&&!!N.sheenColorMap,ut=Ge&&!!N.sheenRoughnessMap,ue=!!N.specularMap,Ie=!!N.specularColorMap,ft=!!N.specularIntensityMap,xe=ct&&!!N.transmissionMap,pt=ct&&!!N.thicknessMap,ge=!!N.gradientMap,Qe=!!N.alphaMap,ht=N.alphaTest>0,at=!!N.alphaHash,yt=!!N.extensions;let Gt=pc;N.toneMapped&&(Ne===null||Ne.isXRRenderTarget===!0)&&(Gt=n.toneMapping);const on={shaderID:ee,shaderType:N.type,shaderName:N.name,vertexShader:Ae,fragmentShader:Pe,defines:N.defines,customVertexShaderID:Ce,customFragmentShaderID:de,isRawShaderMaterial:N.isRawShaderMaterial===!0,glslVersion:N.glslVersion,precision:m,batching:nt,batchingColor:nt&&W._colorsTexture!==null,instancing:me,instancingColor:me&&W.instanceColor!==null,instancingMorph:me&&W.morphTexture!==null,outputColorSpace:Ne===null?n.outputColorSpace:Ne.isXRRenderTarget===!0?Ne.texture.colorSpace:i1,alphaToCoverage:!!N.alphaToCoverage,map:Pt,matcap:zt,envMap:Dt,envMapMode:Dt&&J.mapping,envMapCubeUVHeight:G,aoMap:gt,lightMap:vt,bumpMap:Oe,normalMap:xt,displacementMap:pe,emissiveMap:qe,normalMapObjectSpace:xt&&N.normalMapType===dne,normalMapTangentSpace:xt&&N.normalMapType===K0,metalnessMap:$e,roughnessMap:Xe,anisotropy:Ye,anisotropyMap:tt,clearcoat:oe,clearcoatMap:Lt,clearcoatNormalMap:Ct,clearcoatRoughnessMap:Ot,dispersion:Z,iridescence:he,iridescenceMap:nn,iridescenceThicknessMap:Tt,sheen:Ge,sheenColorMap:Ve,sheenRoughnessMap:ut,specularMap:ue,specularColorMap:Ie,specularIntensityMap:ft,transmission:ct,transmissionMap:xe,thicknessMap:pt,gradientMap:ge,opaque:N.transparent===!1&&N.blending===km&&N.alphaToCoverage===!1,alphaMap:Qe,alphaTest:ht,alphaHash:at,combine:N.combine,mapUv:Pt&&b(N.map.channel),aoMapUv:gt&&b(N.aoMap.channel),lightMapUv:vt&&b(N.lightMap.channel),bumpMapUv:Oe&&b(N.bumpMap.channel),normalMapUv:xt&&b(N.normalMap.channel),displacementMapUv:pe&&b(N.displacementMap.channel),emissiveMapUv:qe&&b(N.emissiveMap.channel),metalnessMapUv:$e&&b(N.metalnessMap.channel),roughnessMapUv:Xe&&b(N.roughnessMap.channel),anisotropyMapUv:tt&&b(N.anisotropyMap.channel),clearcoatMapUv:Lt&&b(N.clearcoatMap.channel),clearcoatNormalMapUv:Ct&&b(N.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ot&&b(N.clearcoatRoughnessMap.channel),iridescenceMapUv:nn&&b(N.iridescenceMap.channel),iridescenceThicknessMapUv:Tt&&b(N.iridescenceThicknessMap.channel),sheenColorMapUv:Ve&&b(N.sheenColorMap.channel),sheenRoughnessMapUv:ut&&b(N.sheenRoughnessMap.channel),specularMapUv:ue&&b(N.specularMap.channel),specularColorMapUv:Ie&&b(N.specularColorMap.channel),specularIntensityMapUv:ft&&b(N.specularIntensityMap.channel),transmissionMapUv:xe&&b(N.transmissionMap.channel),thicknessMapUv:pt&&b(N.thicknessMap.channel),alphaMapUv:Qe&&b(N.alphaMap.channel),vertexTangents:!!H.attributes.tangent&&(xt||Ye),vertexColors:N.vertexColors,vertexAlphas:N.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,pointsUvs:W.isPoints===!0&&!!H.attributes.uv&&(Pt||Qe),fog:!!U,useFog:N.fog===!0,fogExp2:!!U&&U.isFogExp2,flatShading:N.flatShading===!0&&N.wireframe===!1,sizeAttenuation:N.sizeAttenuation===!0,logarithmicDepthBuffer:p,reversedDepthBuffer:et,skinning:W.isSkinnedMesh===!0,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:ne,morphTextureStride:fe,numDirLights:I.directional.length,numPointLights:I.point.length,numSpotLights:I.spot.length,numSpotLightMaps:I.spotLightMap.length,numRectAreaLights:I.rectArea.length,numHemiLights:I.hemi.length,numDirLightShadows:I.directionalShadowMap.length,numPointLightShadows:I.pointShadowMap.length,numSpotLightShadows:I.spotShadowMap.length,numSpotLightShadowsWithMaps:I.numSpotLightShadowsWithMaps,numLightProbes:I.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:N.dithering,shadowMapEnabled:n.shadowMap.enabled&&F.length>0,shadowMapType:n.shadowMap.type,toneMapping:Gt,decodeVideoTexture:Pt&&N.map.isVideoTexture===!0&&xi.getTransfer(N.map.colorSpace)===Gi,decodeVideoTextureEmissive:qe&&N.emissiveMap.isVideoTexture===!0&&xi.getTransfer(N.emissiveMap.colorSpace)===Gi,premultipliedAlpha:N.premultipliedAlpha,doubleSided:N.side===Yu,flipSided:N.side===fa,useDepthPacking:N.depthPacking>=0,depthPacking:N.depthPacking||0,index0AttributeName:N.index0AttributeName,extensionClipCullDistance:yt&&N.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(yt&&N.extensions.multiDraw===!0||nt)&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:N.customProgramCacheKey()};return on.vertexUv1s=c.has(1),on.vertexUv2s=c.has(2),on.vertexUv3s=c.has(3),c.clear(),on}function v(N){const I=[];if(N.shaderID?I.push(N.shaderID):(I.push(N.customVertexShaderID),I.push(N.customFragmentShaderID)),N.defines!==void 0)for(const F in N.defines)I.push(F),I.push(N.defines[F]);return N.isRawShaderMaterial===!1&&(T(I,N),S(I,N),I.push(n.outputColorSpace)),I.push(N.customProgramCacheKey),I.join()}function T(N,I){N.push(I.precision),N.push(I.outputColorSpace),N.push(I.envMapMode),N.push(I.envMapCubeUVHeight),N.push(I.mapUv),N.push(I.alphaMapUv),N.push(I.lightMapUv),N.push(I.aoMapUv),N.push(I.bumpMapUv),N.push(I.normalMapUv),N.push(I.displacementMapUv),N.push(I.emissiveMapUv),N.push(I.metalnessMapUv),N.push(I.roughnessMapUv),N.push(I.anisotropyMapUv),N.push(I.clearcoatMapUv),N.push(I.clearcoatNormalMapUv),N.push(I.clearcoatRoughnessMapUv),N.push(I.iridescenceMapUv),N.push(I.iridescenceThicknessMapUv),N.push(I.sheenColorMapUv),N.push(I.sheenRoughnessMapUv),N.push(I.specularMapUv),N.push(I.specularColorMapUv),N.push(I.specularIntensityMapUv),N.push(I.transmissionMapUv),N.push(I.thicknessMapUv),N.push(I.combine),N.push(I.fogExp2),N.push(I.sizeAttenuation),N.push(I.morphTargetsCount),N.push(I.morphAttributeCount),N.push(I.numDirLights),N.push(I.numPointLights),N.push(I.numSpotLights),N.push(I.numSpotLightMaps),N.push(I.numHemiLights),N.push(I.numRectAreaLights),N.push(I.numDirLightShadows),N.push(I.numPointLightShadows),N.push(I.numSpotLightShadows),N.push(I.numSpotLightShadowsWithMaps),N.push(I.numLightProbes),N.push(I.shadowMapType),N.push(I.toneMapping),N.push(I.numClippingPlanes),N.push(I.numClipIntersection),N.push(I.depthPacking)}function S(N,I){a.disableAll(),I.instancing&&a.enable(0),I.instancingColor&&a.enable(1),I.instancingMorph&&a.enable(2),I.matcap&&a.enable(3),I.envMap&&a.enable(4),I.normalMapObjectSpace&&a.enable(5),I.normalMapTangentSpace&&a.enable(6),I.clearcoat&&a.enable(7),I.iridescence&&a.enable(8),I.alphaTest&&a.enable(9),I.vertexColors&&a.enable(10),I.vertexAlphas&&a.enable(11),I.vertexUv1s&&a.enable(12),I.vertexUv2s&&a.enable(13),I.vertexUv3s&&a.enable(14),I.vertexTangents&&a.enable(15),I.anisotropy&&a.enable(16),I.alphaHash&&a.enable(17),I.batching&&a.enable(18),I.dispersion&&a.enable(19),I.batchingColor&&a.enable(20),I.gradientMap&&a.enable(21),N.push(a.mask),a.disableAll(),I.fog&&a.enable(0),I.useFog&&a.enable(1),I.flatShading&&a.enable(2),I.logarithmicDepthBuffer&&a.enable(3),I.reversedDepthBuffer&&a.enable(4),I.skinning&&a.enable(5),I.morphTargets&&a.enable(6),I.morphNormals&&a.enable(7),I.morphColors&&a.enable(8),I.premultipliedAlpha&&a.enable(9),I.shadowMapEnabled&&a.enable(10),I.doubleSided&&a.enable(11),I.flipSided&&a.enable(12),I.useDepthPacking&&a.enable(13),I.dithering&&a.enable(14),I.transmission&&a.enable(15),I.sheen&&a.enable(16),I.opaque&&a.enable(17),I.pointsUvs&&a.enable(18),I.decodeVideoTexture&&a.enable(19),I.decodeVideoTextureEmissive&&a.enable(20),I.alphaToCoverage&&a.enable(21),N.push(a.mask)}function M(N){const I=y[N.type];let F;if(I){const j=Xc[I];F=Ine.clone(j.uniforms)}else F=N.uniforms;return F}function P(N,I){let F=h.get(I);return F!==void 0?++F.usedTimes:(F=new MDe(n,I,N,s),u.push(F),h.set(I,F)),F}function R(N){if(--N.usedTimes===0){const I=u.indexOf(N);u[I]=u[u.length-1],u.pop(),h.delete(N.cacheKey),N.destroy()}}function O(N){l.remove(N)}function B(){l.dispose()}return{getParameters:w,getProgramCacheKey:v,getUniforms:M,acquireProgram:P,releaseProgram:R,releaseShaderCache:O,programs:u,dispose:B}}function kDe(){let n=new WeakMap;function e(o){return n.has(o)}function t(o){let a=n.get(o);return a===void 0&&(a={},n.set(o,a)),a}function i(o){n.delete(o)}function r(o,a,l){n.get(o)[a]=l}function s(){n=new WeakMap}return{has:e,get:t,remove:i,update:r,dispose:s}}function LDe(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function ZH(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function YH(){const n=[];let e=0;const t=[],i=[],r=[];function s(){e=0,t.length=0,i.length=0,r.length=0}function o(h,p,m,y,b,w){let v=n[e];return v===void 0?(v={id:h.id,object:h,geometry:p,material:m,groupOrder:y,renderOrder:h.renderOrder,z:b,group:w},n[e]=v):(v.id=h.id,v.object=h,v.geometry=p,v.material=m,v.groupOrder=y,v.renderOrder=h.renderOrder,v.z=b,v.group=w),e++,v}function a(h,p,m,y,b,w){const v=o(h,p,m,y,b,w);m.transmission>0?i.push(v):m.transparent===!0?r.push(v):t.push(v)}function l(h,p,m,y,b,w){const v=o(h,p,m,y,b,w);m.transmission>0?i.unshift(v):m.transparent===!0?r.unshift(v):t.unshift(v)}function c(h,p){t.length>1&&t.sort(h||LDe),i.length>1&&i.sort(p||ZH),r.length>1&&r.sort(p||ZH)}function u(){for(let h=e,p=n.length;h<p;h++){const m=n[h];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:i,transparent:r,init:s,push:a,unshift:l,finish:u,sort:c}}function DDe(){let n=new WeakMap;function e(i,r){const s=n.get(i);let o;return s===void 0?(o=new YH,n.set(i,[o])):r>=s.length?(o=new YH,s.push(o)):o=s[r],o}function t(){n=new WeakMap}return{get:e,dispose:t}}function ODe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ye,color:new an};break;case"SpotLight":t={position:new ye,direction:new ye,color:new an,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ye,color:new an,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ye,skyColor:new an,groundColor:new an};break;case"RectAreaLight":t={color:new an,position:new ye,halfWidth:new ye,halfHeight:new ye};break}return n[e.id]=t,t}}}function BDe(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Et,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let UDe=0;function FDe(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function zDe(n){const e=new ODe,t=BDe(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)i.probe.push(new ye);const r=new ye,s=new Hn,o=new Hn;function a(c){let u=0,h=0,p=0;for(let N=0;N<9;N++)i.probe[N].set(0,0,0);let m=0,y=0,b=0,w=0,v=0,T=0,S=0,M=0,P=0,R=0,O=0;c.sort(FDe);for(let N=0,I=c.length;N<I;N++){const F=c[N],j=F.color,W=F.intensity,U=F.distance;let H=null;if(F.shadow&&F.shadow.map&&(F.shadow.map.texture.format===n1?H=F.shadow.map.texture:H=F.shadow.map.depthTexture||F.shadow.map.texture),F.isAmbientLight)u+=j.r*W,h+=j.g*W,p+=j.b*W;else if(F.isLightProbe){for(let q=0;q<9;q++)i.probe[q].addScaledVector(F.sh.coefficients[q],W);O++}else if(F.isDirectionalLight){const q=e.get(F);if(q.color.copy(F.color).multiplyScalar(F.intensity),F.castShadow){const J=F.shadow,G=t.get(F);G.shadowIntensity=J.intensity,G.shadowBias=J.bias,G.shadowNormalBias=J.normalBias,G.shadowRadius=J.radius,G.shadowMapSize=J.mapSize,i.directionalShadow[m]=G,i.directionalShadowMap[m]=H,i.directionalShadowMatrix[m]=F.shadow.matrix,T++}i.directional[m]=q,m++}else if(F.isSpotLight){const q=e.get(F);q.position.setFromMatrixPosition(F.matrixWorld),q.color.copy(j).multiplyScalar(W),q.distance=U,q.coneCos=Math.cos(F.angle),q.penumbraCos=Math.cos(F.angle*(1-F.penumbra)),q.decay=F.decay,i.spot[b]=q;const J=F.shadow;if(F.map&&(i.spotLightMap[P]=F.map,P++,J.updateMatrices(F),F.castShadow&&R++),i.spotLightMatrix[b]=J.matrix,F.castShadow){const G=t.get(F);G.shadowIntensity=J.intensity,G.shadowBias=J.bias,G.shadowNormalBias=J.normalBias,G.shadowRadius=J.radius,G.shadowMapSize=J.mapSize,i.spotShadow[b]=G,i.spotShadowMap[b]=H,M++}b++}else if(F.isRectAreaLight){const q=e.get(F);q.color.copy(j).multiplyScalar(W),q.halfWidth.set(F.width*.5,0,0),q.halfHeight.set(0,F.height*.5,0),i.rectArea[w]=q,w++}else if(F.isPointLight){const q=e.get(F);if(q.color.copy(F.color).multiplyScalar(F.intensity),q.distance=F.distance,q.decay=F.decay,F.castShadow){const J=F.shadow,G=t.get(F);G.shadowIntensity=J.intensity,G.shadowBias=J.bias,G.shadowNormalBias=J.normalBias,G.shadowRadius=J.radius,G.shadowMapSize=J.mapSize,G.shadowCameraNear=J.camera.near,G.shadowCameraFar=J.camera.far,i.pointShadow[y]=G,i.pointShadowMap[y]=H,i.pointShadowMatrix[y]=F.shadow.matrix,S++}i.point[y]=q,y++}else if(F.isHemisphereLight){const q=e.get(F);q.skyColor.copy(F.color).multiplyScalar(W),q.groundColor.copy(F.groundColor).multiplyScalar(W),i.hemi[v]=q,v++}}w>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=qt.LTC_FLOAT_1,i.rectAreaLTC2=qt.LTC_FLOAT_2):(i.rectAreaLTC1=qt.LTC_HALF_1,i.rectAreaLTC2=qt.LTC_HALF_2)),i.ambient[0]=u,i.ambient[1]=h,i.ambient[2]=p;const B=i.hash;(B.directionalLength!==m||B.pointLength!==y||B.spotLength!==b||B.rectAreaLength!==w||B.hemiLength!==v||B.numDirectionalShadows!==T||B.numPointShadows!==S||B.numSpotShadows!==M||B.numSpotMaps!==P||B.numLightProbes!==O)&&(i.directional.length=m,i.spot.length=b,i.rectArea.length=w,i.point.length=y,i.hemi.length=v,i.directionalShadow.length=T,i.directionalShadowMap.length=T,i.pointShadow.length=S,i.pointShadowMap.length=S,i.spotShadow.length=M,i.spotShadowMap.length=M,i.directionalShadowMatrix.length=T,i.pointShadowMatrix.length=S,i.spotLightMatrix.length=M+P-R,i.spotLightMap.length=P,i.numSpotLightShadowsWithMaps=R,i.numLightProbes=O,B.directionalLength=m,B.pointLength=y,B.spotLength=b,B.rectAreaLength=w,B.hemiLength=v,B.numDirectionalShadows=T,B.numPointShadows=S,B.numSpotShadows=M,B.numSpotMaps=P,B.numLightProbes=O,i.version=UDe++)}function l(c,u){let h=0,p=0,m=0,y=0,b=0;const w=u.matrixWorldInverse;for(let v=0,T=c.length;v<T;v++){const S=c[v];if(S.isDirectionalLight){const M=i.directional[h];M.direction.setFromMatrixPosition(S.matrixWorld),r.setFromMatrixPosition(S.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(w),h++}else if(S.isSpotLight){const M=i.spot[m];M.position.setFromMatrixPosition(S.matrixWorld),M.position.applyMatrix4(w),M.direction.setFromMatrixPosition(S.matrixWorld),r.setFromMatrixPosition(S.target.matrixWorld),M.direction.sub(r),M.direction.transformDirection(w),m++}else if(S.isRectAreaLight){const M=i.rectArea[y];M.position.setFromMatrixPosition(S.matrixWorld),M.position.applyMatrix4(w),o.identity(),s.copy(S.matrixWorld),s.premultiply(w),o.extractRotation(s),M.halfWidth.set(S.width*.5,0,0),M.halfHeight.set(0,S.height*.5,0),M.halfWidth.applyMatrix4(o),M.halfHeight.applyMatrix4(o),y++}else if(S.isPointLight){const M=i.point[p];M.position.setFromMatrixPosition(S.matrixWorld),M.position.applyMatrix4(w),p++}else if(S.isHemisphereLight){const M=i.hemi[b];M.direction.setFromMatrixPosition(S.matrixWorld),M.direction.transformDirection(w),b++}}}return{setup:a,setupView:l,state:i}}function XH(n){const e=new zDe(n),t=[],i=[];function r(u){c.camera=u,t.length=0,i.length=0}function s(u){t.push(u)}function o(u){i.push(u)}function a(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:i,camera:null,lights:e,transmissionRenderTarget:{}};return{init:r,state:c,setupLights:a,setupLightsView:l,pushLight:s,pushShadow:o}}function jDe(n){let e=new WeakMap;function t(r,s=0){const o=e.get(r);let a;return o===void 0?(a=new XH(n),e.set(r,[a])):s>=o.length?(a=new XH(n),o.push(a)):a=o[s],a}function i(){e=new WeakMap}return{get:t,dispose:i}}const VDe=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,HDe=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,$De=[new ye(1,0,0),new ye(-1,0,0),new ye(0,1,0),new ye(0,-1,0),new ye(0,0,1),new ye(0,0,-1)],GDe=[new ye(0,-1,0),new ye(0,-1,0),new ye(0,0,1),new ye(0,0,-1),new ye(0,-1,0),new ye(0,-1,0)],QH=new Hn,Nv=new ye,uM=new ye;function WDe(n,e,t){let i=new vx;const r=new Et,s=new Et,o=new fr,a=new nO,l=new iO,c={},u=t.maxTextureSize,h={[Dd]:fa,[fa]:Dd,[Yu]:Yu},p=new _c({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Et},radius:{value:4}},vertexShader:VDe,fragmentShader:HDe}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const y=new Jn;y.setAttribute("position",new lr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const b=new xs(y,p),w=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ky;let v=this.type;this.render=function(R,O,B){if(w.enabled===!1||w.autoUpdate===!1&&w.needsUpdate===!1||R.length===0)return;R.type===C3&&(Wt("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),R.type=ky);const N=n.getRenderTarget(),I=n.getActiveCubeFace(),F=n.getActiveMipmapLevel(),j=n.state;j.setBlending(ah),j.buffers.depth.getReversed()===!0?j.buffers.color.setClear(0,0,0,0):j.buffers.color.setClear(1,1,1,1),j.buffers.depth.setTest(!0),j.setScissorTest(!1);const W=v!==this.type;W&&O.traverse(function(U){U.material&&(Array.isArray(U.material)?U.material.forEach(H=>H.needsUpdate=!0):U.material.needsUpdate=!0)});for(let U=0,H=R.length;U<H;U++){const q=R[U],J=q.shadow;if(J===void 0){Wt("WebGLShadowMap:",q,"has no shadow.");continue}if(J.autoUpdate===!1&&J.needsUpdate===!1)continue;r.copy(J.mapSize);const G=J.getFrameExtents();if(r.multiply(G),s.copy(J.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/G.x),r.x=s.x*G.x,J.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/G.y),r.y=s.y*G.y,J.mapSize.y=s.y)),J.map===null||W===!0){if(J.map!==null&&(J.map.depthTexture!==null&&(J.map.depthTexture.dispose(),J.map.depthTexture=null),J.map.dispose()),this.type===dm){if(q.isPointLight){Wt("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}J.map=new Xa(r.x,r.y,{format:n1,type:du,minFilter:mr,magFilter:mr,generateMipmaps:!1}),J.map.texture.name=q.name+".shadowMap",J.map.depthTexture=new s1(r.x,r.y,Do),J.map.depthTexture.name=q.name+".shadowMapDepth",J.map.depthTexture.format=ph,J.map.depthTexture.compareFunction=null,J.map.depthTexture.minFilter=is,J.map.depthTexture.magFilter=is}else{q.isPointLight?(J.map=new jD(r.x),J.map.depthTexture=new jne(r.x,bc)):(J.map=new Xa(r.x,r.y),J.map.depthTexture=new s1(r.x,r.y,bc)),J.map.depthTexture.name=q.name+".shadowMap",J.map.depthTexture.format=ph;const Q=n.state.buffers.depth.getReversed();this.type===ky?(J.map.depthTexture.compareFunction=Q?P9:N9,J.map.depthTexture.minFilter=mr,J.map.depthTexture.magFilter=mr):(J.map.depthTexture.compareFunction=null,J.map.depthTexture.minFilter=is,J.map.depthTexture.magFilter=is)}J.camera.updateProjectionMatrix()}const ee=J.map.isWebGLCubeRenderTarget?6:1;for(let Q=0;Q<ee;Q++){if(J.map.isWebGLCubeRenderTarget)n.setRenderTarget(J.map,Q),n.clear();else{Q===0&&(n.setRenderTarget(J.map),n.clear());const ne=J.getViewport(Q);o.set(s.x*ne.x,s.y*ne.y,s.x*ne.z,s.y*ne.w),j.viewport(o)}if(q.isPointLight){const ne=J.camera,fe=J.matrix,Ae=q.distance||ne.far;Ae!==ne.far&&(ne.far=Ae,ne.updateProjectionMatrix()),Nv.setFromMatrixPosition(q.matrixWorld),ne.position.copy(Nv),uM.copy(ne.position),uM.add($De[Q]),ne.up.copy(GDe[Q]),ne.lookAt(uM),ne.updateMatrixWorld(),fe.makeTranslation(-Nv.x,-Nv.y,-Nv.z),QH.multiplyMatrices(ne.projectionMatrix,ne.matrixWorldInverse),J._frustum.setFromProjectionMatrix(QH,ne.coordinateSystem,ne.reversedDepth)}else J.updateMatrices(q);i=J.getFrustum(),M(O,B,J.camera,q,this.type)}J.isPointLightShadow!==!0&&this.type===dm&&T(J,B),J.needsUpdate=!1}v=this.type,w.needsUpdate=!1,n.setRenderTarget(N,I,F)};function T(R,O){const B=e.update(b);p.defines.VSM_SAMPLES!==R.blurSamples&&(p.defines.VSM_SAMPLES=R.blurSamples,m.defines.VSM_SAMPLES=R.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),R.mapPass===null&&(R.mapPass=new Xa(r.x,r.y,{format:n1,type:du})),p.uniforms.shadow_pass.value=R.map.depthTexture,p.uniforms.resolution.value=R.mapSize,p.uniforms.radius.value=R.radius,n.setRenderTarget(R.mapPass),n.clear(),n.renderBufferDirect(O,null,B,p,b,null),m.uniforms.shadow_pass.value=R.mapPass.texture,m.uniforms.resolution.value=R.mapSize,m.uniforms.radius.value=R.radius,n.setRenderTarget(R.map),n.clear(),n.renderBufferDirect(O,null,B,m,b,null)}function S(R,O,B,N){let I=null;const F=B.isPointLight===!0?R.customDistanceMaterial:R.customDepthMaterial;if(F!==void 0)I=F;else if(I=B.isPointLight===!0?l:a,n.localClippingEnabled&&O.clipShadows===!0&&Array.isArray(O.clippingPlanes)&&O.clippingPlanes.length!==0||O.displacementMap&&O.displacementScale!==0||O.alphaMap&&O.alphaTest>0||O.map&&O.alphaTest>0||O.alphaToCoverage===!0){const j=I.uuid,W=O.uuid;let U=c[j];U===void 0&&(U={},c[j]=U);let H=U[W];H===void 0&&(H=I.clone(),U[W]=H,O.addEventListener("dispose",P)),I=H}if(I.visible=O.visible,I.wireframe=O.wireframe,N===dm?I.side=O.shadowSide!==null?O.shadowSide:O.side:I.side=O.shadowSide!==null?O.shadowSide:h[O.side],I.alphaMap=O.alphaMap,I.alphaTest=O.alphaToCoverage===!0?.5:O.alphaTest,I.map=O.map,I.clipShadows=O.clipShadows,I.clippingPlanes=O.clippingPlanes,I.clipIntersection=O.clipIntersection,I.displacementMap=O.displacementMap,I.displacementScale=O.displacementScale,I.displacementBias=O.displacementBias,I.wireframeLinewidth=O.wireframeLinewidth,I.linewidth=O.linewidth,B.isPointLight===!0&&I.isMeshDistanceMaterial===!0){const j=n.properties.get(I);j.light=B}return I}function M(R,O,B,N,I){if(R.visible===!1)return;if(R.layers.test(O.layers)&&(R.isMesh||R.isLine||R.isPoints)&&(R.castShadow||R.receiveShadow&&I===dm)&&(!R.frustumCulled||i.intersectsObject(R))){R.modelViewMatrix.multiplyMatrices(B.matrixWorldInverse,R.matrixWorld);const W=e.update(R),U=R.material;if(Array.isArray(U)){const H=W.groups;for(let q=0,J=H.length;q<J;q++){const G=H[q],ee=U[G.materialIndex];if(ee&&ee.visible){const Q=S(R,ee,N,I);R.onBeforeShadow(n,R,O,B,W,Q,G),n.renderBufferDirect(B,null,W,Q,R,G),R.onAfterShadow(n,R,O,B,W,Q,G)}}}else if(U.visible){const H=S(R,U,N,I);R.onBeforeShadow(n,R,O,B,W,H,null),n.renderBufferDirect(B,null,W,H,R,null),R.onAfterShadow(n,R,O,B,W,H,null)}}const j=R.children;for(let W=0,U=j.length;W<U;W++)M(j[W],O,B,N,I)}function P(R){R.target.removeEventListener("dispose",P);for(const B in c){const N=c[B],I=R.target.uuid;I in N&&(N[I].dispose(),delete N[I])}}}const KDe={[P8]:k8,[L8]:B8,[D8]:U8,[t1]:O8,[k8]:P8,[B8]:L8,[U8]:D8,[O8]:t1};function qDe(n,e){function t(){let xe=!1;const pt=new fr;let ge=null;const Qe=new fr(0,0,0,0);return{setMask:function(ht){ge!==ht&&!xe&&(n.colorMask(ht,ht,ht,ht),ge=ht)},setLocked:function(ht){xe=ht},setClear:function(ht,at,yt,Gt,on){on===!0&&(ht*=Gt,at*=Gt,yt*=Gt),pt.set(ht,at,yt,Gt),Qe.equals(pt)===!1&&(n.clearColor(ht,at,yt,Gt),Qe.copy(pt))},reset:function(){xe=!1,ge=null,Qe.set(-1,0,0,0)}}}function i(){let xe=!1,pt=!1,ge=null,Qe=null,ht=null;return{setReversed:function(at){if(pt!==at){const yt=e.get("EXT_clip_control");at?yt.clipControlEXT(yt.LOWER_LEFT_EXT,yt.ZERO_TO_ONE_EXT):yt.clipControlEXT(yt.LOWER_LEFT_EXT,yt.NEGATIVE_ONE_TO_ONE_EXT),pt=at;const Gt=ht;ht=null,this.setClear(Gt)}},getReversed:function(){return pt},setTest:function(at){at?Ne(n.DEPTH_TEST):et(n.DEPTH_TEST)},setMask:function(at){ge!==at&&!xe&&(n.depthMask(at),ge=at)},setFunc:function(at){if(pt&&(at=KDe[at]),Qe!==at){switch(at){case P8:n.depthFunc(n.NEVER);break;case k8:n.depthFunc(n.ALWAYS);break;case L8:n.depthFunc(n.LESS);break;case t1:n.depthFunc(n.LEQUAL);break;case D8:n.depthFunc(n.EQUAL);break;case O8:n.depthFunc(n.GEQUAL);break;case B8:n.depthFunc(n.GREATER);break;case U8:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Qe=at}},setLocked:function(at){xe=at},setClear:function(at){ht!==at&&(pt&&(at=1-at),n.clearDepth(at),ht=at)},reset:function(){xe=!1,ge=null,Qe=null,ht=null,pt=!1}}}function r(){let xe=!1,pt=null,ge=null,Qe=null,ht=null,at=null,yt=null,Gt=null,on=null;return{setTest:function(mn){xe||(mn?Ne(n.STENCIL_TEST):et(n.STENCIL_TEST))},setMask:function(mn){pt!==mn&&!xe&&(n.stencilMask(mn),pt=mn)},setFunc:function(mn,Cn,gi){(ge!==mn||Qe!==Cn||ht!==gi)&&(n.stencilFunc(mn,Cn,gi),ge=mn,Qe=Cn,ht=gi)},setOp:function(mn,Cn,gi){(at!==mn||yt!==Cn||Gt!==gi)&&(n.stencilOp(mn,Cn,gi),at=mn,yt=Cn,Gt=gi)},setLocked:function(mn){xe=mn},setClear:function(mn){on!==mn&&(n.clearStencil(mn),on=mn)},reset:function(){xe=!1,pt=null,ge=null,Qe=null,ht=null,at=null,yt=null,Gt=null,on=null}}}const s=new t,o=new i,a=new r,l=new WeakMap,c=new WeakMap;let u={},h={},p=new WeakMap,m=[],y=null,b=!1,w=null,v=null,T=null,S=null,M=null,P=null,R=null,O=new an(0,0,0),B=0,N=!1,I=null,F=null,j=null,W=null,U=null;const H=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let q=!1,J=0;const G=n.getParameter(n.VERSION);G.indexOf("WebGL")!==-1?(J=parseFloat(/^WebGL (\d)/.exec(G)[1]),q=J>=1):G.indexOf("OpenGL ES")!==-1&&(J=parseFloat(/^OpenGL ES (\d)/.exec(G)[1]),q=J>=2);let ee=null,Q={};const ne=n.getParameter(n.SCISSOR_BOX),fe=n.getParameter(n.VIEWPORT),Ae=new fr().fromArray(ne),Pe=new fr().fromArray(fe);function Ce(xe,pt,ge,Qe){const ht=new Uint8Array(4),at=n.createTexture();n.bindTexture(xe,at),n.texParameteri(xe,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(xe,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let yt=0;yt<ge;yt++)xe===n.TEXTURE_3D||xe===n.TEXTURE_2D_ARRAY?n.texImage3D(pt,0,n.RGBA,1,1,Qe,0,n.RGBA,n.UNSIGNED_BYTE,ht):n.texImage2D(pt+yt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ht);return at}const de={};de[n.TEXTURE_2D]=Ce(n.TEXTURE_2D,n.TEXTURE_2D,1),de[n.TEXTURE_CUBE_MAP]=Ce(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),de[n.TEXTURE_2D_ARRAY]=Ce(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),de[n.TEXTURE_3D]=Ce(n.TEXTURE_3D,n.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),Ne(n.DEPTH_TEST),o.setFunc(t1),Oe(!1),xt(RN),Ne(n.CULL_FACE),gt(ah);function Ne(xe){u[xe]!==!0&&(n.enable(xe),u[xe]=!0)}function et(xe){u[xe]!==!1&&(n.disable(xe),u[xe]=!1)}function me(xe,pt){return h[xe]!==pt?(n.bindFramebuffer(xe,pt),h[xe]=pt,xe===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=pt),xe===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=pt),!0):!1}function nt(xe,pt){let ge=m,Qe=!1;if(xe){ge=p.get(pt),ge===void 0&&(ge=[],p.set(pt,ge));const ht=xe.textures;if(ge.length!==ht.length||ge[0]!==n.COLOR_ATTACHMENT0){for(let at=0,yt=ht.length;at<yt;at++)ge[at]=n.COLOR_ATTACHMENT0+at;ge.length=ht.length,Qe=!0}}else ge[0]!==n.BACK&&(ge[0]=n.BACK,Qe=!0);Qe&&n.drawBuffers(ge)}function Pt(xe){return y!==xe?(n.useProgram(xe),y=xe,!0):!1}const zt={[$f]:n.FUNC_ADD,[Vte]:n.FUNC_SUBTRACT,[Hte]:n.FUNC_REVERSE_SUBTRACT};zt[$te]=n.MIN,zt[Gte]=n.MAX;const Dt={[Wte]:n.ZERO,[Kte]:n.ONE,[qte]:n.SRC_COLOR,[I8]:n.SRC_ALPHA,[ene]:n.SRC_ALPHA_SATURATE,[Qte]:n.DST_COLOR,[Yte]:n.DST_ALPHA,[Zte]:n.ONE_MINUS_SRC_COLOR,[N8]:n.ONE_MINUS_SRC_ALPHA,[Jte]:n.ONE_MINUS_DST_COLOR,[Xte]:n.ONE_MINUS_DST_ALPHA,[tne]:n.CONSTANT_COLOR,[nne]:n.ONE_MINUS_CONSTANT_COLOR,[ine]:n.CONSTANT_ALPHA,[rne]:n.ONE_MINUS_CONSTANT_ALPHA};function gt(xe,pt,ge,Qe,ht,at,yt,Gt,on,mn){if(xe===ah){b===!0&&(et(n.BLEND),b=!1);return}if(b===!1&&(Ne(n.BLEND),b=!0),xe!==jte){if(xe!==w||mn!==N){if((v!==$f||M!==$f)&&(n.blendEquation(n.FUNC_ADD),v=$f,M=$f),mn)switch(xe){case km:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case IN:n.blendFunc(n.ONE,n.ONE);break;case NN:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case PN:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:xn("WebGLState: Invalid blending: ",xe);break}else switch(xe){case km:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case IN:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case NN:xn("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case PN:xn("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:xn("WebGLState: Invalid blending: ",xe);break}T=null,S=null,P=null,R=null,O.set(0,0,0),B=0,w=xe,N=mn}return}ht=ht||pt,at=at||ge,yt=yt||Qe,(pt!==v||ht!==M)&&(n.blendEquationSeparate(zt[pt],zt[ht]),v=pt,M=ht),(ge!==T||Qe!==S||at!==P||yt!==R)&&(n.blendFuncSeparate(Dt[ge],Dt[Qe],Dt[at],Dt[yt]),T=ge,S=Qe,P=at,R=yt),(Gt.equals(O)===!1||on!==B)&&(n.blendColor(Gt.r,Gt.g,Gt.b,on),O.copy(Gt),B=on),w=xe,N=!1}function vt(xe,pt){xe.side===Yu?et(n.CULL_FACE):Ne(n.CULL_FACE);let ge=xe.side===fa;pt&&(ge=!ge),Oe(ge),xe.blending===km&&xe.transparent===!1?gt(ah):gt(xe.blending,xe.blendEquation,xe.blendSrc,xe.blendDst,xe.blendEquationAlpha,xe.blendSrcAlpha,xe.blendDstAlpha,xe.blendColor,xe.blendAlpha,xe.premultipliedAlpha),o.setFunc(xe.depthFunc),o.setTest(xe.depthTest),o.setMask(xe.depthWrite),s.setMask(xe.colorWrite);const Qe=xe.stencilWrite;a.setTest(Qe),Qe&&(a.setMask(xe.stencilWriteMask),a.setFunc(xe.stencilFunc,xe.stencilRef,xe.stencilFuncMask),a.setOp(xe.stencilFail,xe.stencilZFail,xe.stencilZPass)),qe(xe.polygonOffset,xe.polygonOffsetFactor,xe.polygonOffsetUnits),xe.alphaToCoverage===!0?Ne(n.SAMPLE_ALPHA_TO_COVERAGE):et(n.SAMPLE_ALPHA_TO_COVERAGE)}function Oe(xe){I!==xe&&(xe?n.frontFace(n.CW):n.frontFace(n.CCW),I=xe)}function xt(xe){xe!==Ute?(Ne(n.CULL_FACE),xe!==F&&(xe===RN?n.cullFace(n.BACK):xe===Fte?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):et(n.CULL_FACE),F=xe}function pe(xe){xe!==j&&(q&&n.lineWidth(xe),j=xe)}function qe(xe,pt,ge){xe?(Ne(n.POLYGON_OFFSET_FILL),(W!==pt||U!==ge)&&(n.polygonOffset(pt,ge),W=pt,U=ge)):et(n.POLYGON_OFFSET_FILL)}function $e(xe){xe?Ne(n.SCISSOR_TEST):et(n.SCISSOR_TEST)}function Xe(xe){xe===void 0&&(xe=n.TEXTURE0+H-1),ee!==xe&&(n.activeTexture(xe),ee=xe)}function Ye(xe,pt,ge){ge===void 0&&(ee===null?ge=n.TEXTURE0+H-1:ge=ee);let Qe=Q[ge];Qe===void 0&&(Qe={type:void 0,texture:void 0},Q[ge]=Qe),(Qe.type!==xe||Qe.texture!==pt)&&(ee!==ge&&(n.activeTexture(ge),ee=ge),n.bindTexture(xe,pt||de[xe]),Qe.type=xe,Qe.texture=pt)}function oe(){const xe=Q[ee];xe!==void 0&&xe.type!==void 0&&(n.bindTexture(xe.type,null),xe.type=void 0,xe.texture=void 0)}function Z(){try{n.compressedTexImage2D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function he(){try{n.compressedTexImage3D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function Ge(){try{n.texSubImage2D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function ct(){try{n.texSubImage3D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function tt(){try{n.compressedTexSubImage2D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function Lt(){try{n.compressedTexSubImage3D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function Ct(){try{n.texStorage2D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function Ot(){try{n.texStorage3D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function nn(){try{n.texImage2D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function Tt(){try{n.texImage3D(...arguments)}catch(xe){xn("WebGLState:",xe)}}function Ve(xe){Ae.equals(xe)===!1&&(n.scissor(xe.x,xe.y,xe.z,xe.w),Ae.copy(xe))}function ut(xe){Pe.equals(xe)===!1&&(n.viewport(xe.x,xe.y,xe.z,xe.w),Pe.copy(xe))}function ue(xe,pt){let ge=c.get(pt);ge===void 0&&(ge=new WeakMap,c.set(pt,ge));let Qe=ge.get(xe);Qe===void 0&&(Qe=n.getUniformBlockIndex(pt,xe.name),ge.set(xe,Qe))}function Ie(xe,pt){const Qe=c.get(pt).get(xe);l.get(pt)!==Qe&&(n.uniformBlockBinding(pt,Qe,xe.__bindingPointIndex),l.set(pt,Qe))}function ft(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),o.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},ee=null,Q={},h={},p=new WeakMap,m=[],y=null,b=!1,w=null,v=null,T=null,S=null,M=null,P=null,R=null,O=new an(0,0,0),B=0,N=!1,I=null,F=null,j=null,W=null,U=null,Ae.set(0,0,n.canvas.width,n.canvas.height),Pe.set(0,0,n.canvas.width,n.canvas.height),s.reset(),o.reset(),a.reset()}return{buffers:{color:s,depth:o,stencil:a},enable:Ne,disable:et,bindFramebuffer:me,drawBuffers:nt,useProgram:Pt,setBlending:gt,setMaterial:vt,setFlipSided:Oe,setCullFace:xt,setLineWidth:pe,setPolygonOffset:qe,setScissorTest:$e,activeTexture:Xe,bindTexture:Ye,unbindTexture:oe,compressedTexImage2D:Z,compressedTexImage3D:he,texImage2D:nn,texImage3D:Tt,updateUBOMapping:ue,uniformBlockBinding:Ie,texStorage2D:Ct,texStorage3D:Ot,texSubImage2D:Ge,texSubImage3D:ct,compressedTexSubImage2D:tt,compressedTexSubImage3D:Lt,scissor:Ve,viewport:ut,reset:ft}}function ZDe(n,e,t,i,r,s,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new Et,u=new WeakMap;let h;const p=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(oe,Z){return m?new OffscreenCanvas(oe,Z):Bb("canvas")}function b(oe,Z,he){let Ge=1;const ct=Ye(oe);if((ct.width>he||ct.height>he)&&(Ge=he/Math.max(ct.width,ct.height)),Ge<1)if(typeof HTMLImageElement<"u"&&oe instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&oe instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&oe instanceof ImageBitmap||typeof VideoFrame<"u"&&oe instanceof VideoFrame){const tt=Math.floor(Ge*ct.width),Lt=Math.floor(Ge*ct.height);h===void 0&&(h=y(tt,Lt));const Ct=Z?y(tt,Lt):h;return Ct.width=tt,Ct.height=Lt,Ct.getContext("2d").drawImage(oe,0,0,tt,Lt),Wt("WebGLRenderer: Texture has been resized from ("+ct.width+"x"+ct.height+") to ("+tt+"x"+Lt+")."),Ct}else return"data"in oe&&Wt("WebGLRenderer: Image in DataTexture is too big ("+ct.width+"x"+ct.height+")."),oe;return oe}function w(oe){return oe.generateMipmaps}function v(oe){n.generateMipmap(oe)}function T(oe){return oe.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:oe.isWebGL3DRenderTarget?n.TEXTURE_3D:oe.isWebGLArrayRenderTarget||oe.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function S(oe,Z,he,Ge,ct=!1){if(oe!==null){if(n[oe]!==void 0)return n[oe];Wt("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+oe+"'")}let tt=Z;if(Z===n.RED&&(he===n.FLOAT&&(tt=n.R32F),he===n.HALF_FLOAT&&(tt=n.R16F),he===n.UNSIGNED_BYTE&&(tt=n.R8)),Z===n.RED_INTEGER&&(he===n.UNSIGNED_BYTE&&(tt=n.R8UI),he===n.UNSIGNED_SHORT&&(tt=n.R16UI),he===n.UNSIGNED_INT&&(tt=n.R32UI),he===n.BYTE&&(tt=n.R8I),he===n.SHORT&&(tt=n.R16I),he===n.INT&&(tt=n.R32I)),Z===n.RG&&(he===n.FLOAT&&(tt=n.RG32F),he===n.HALF_FLOAT&&(tt=n.RG16F),he===n.UNSIGNED_BYTE&&(tt=n.RG8)),Z===n.RG_INTEGER&&(he===n.UNSIGNED_BYTE&&(tt=n.RG8UI),he===n.UNSIGNED_SHORT&&(tt=n.RG16UI),he===n.UNSIGNED_INT&&(tt=n.RG32UI),he===n.BYTE&&(tt=n.RG8I),he===n.SHORT&&(tt=n.RG16I),he===n.INT&&(tt=n.RG32I)),Z===n.RGB_INTEGER&&(he===n.UNSIGNED_BYTE&&(tt=n.RGB8UI),he===n.UNSIGNED_SHORT&&(tt=n.RGB16UI),he===n.UNSIGNED_INT&&(tt=n.RGB32UI),he===n.BYTE&&(tt=n.RGB8I),he===n.SHORT&&(tt=n.RGB16I),he===n.INT&&(tt=n.RGB32I)),Z===n.RGBA_INTEGER&&(he===n.UNSIGNED_BYTE&&(tt=n.RGBA8UI),he===n.UNSIGNED_SHORT&&(tt=n.RGBA16UI),he===n.UNSIGNED_INT&&(tt=n.RGBA32UI),he===n.BYTE&&(tt=n.RGBA8I),he===n.SHORT&&(tt=n.RGBA16I),he===n.INT&&(tt=n.RGBA32I)),Z===n.RGB&&(he===n.UNSIGNED_INT_5_9_9_9_REV&&(tt=n.RGB9_E5),he===n.UNSIGNED_INT_10F_11F_11F_REV&&(tt=n.R11F_G11F_B10F)),Z===n.RGBA){const Lt=ct?Db:xi.getTransfer(Ge);he===n.FLOAT&&(tt=n.RGBA32F),he===n.HALF_FLOAT&&(tt=n.RGBA16F),he===n.UNSIGNED_BYTE&&(tt=Lt===Gi?n.SRGB8_ALPHA8:n.RGBA8),he===n.UNSIGNED_SHORT_4_4_4_4&&(tt=n.RGBA4),he===n.UNSIGNED_SHORT_5_5_5_1&&(tt=n.RGB5_A1)}return(tt===n.R16F||tt===n.R32F||tt===n.RG16F||tt===n.RG32F||tt===n.RGBA16F||tt===n.RGBA32F)&&e.get("EXT_color_buffer_float"),tt}function M(oe,Z){let he;return oe?Z===null||Z===bc||Z===W2?he=n.DEPTH24_STENCIL8:Z===Do?he=n.DEPTH32F_STENCIL8:Z===G2&&(he=n.DEPTH24_STENCIL8,Wt("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Z===null||Z===bc||Z===W2?he=n.DEPTH_COMPONENT24:Z===Do?he=n.DEPTH_COMPONENT32F:Z===G2&&(he=n.DEPTH_COMPONENT16),he}function P(oe,Z){return w(oe)===!0||oe.isFramebufferTexture&&oe.minFilter!==is&&oe.minFilter!==mr?Math.log2(Math.max(Z.width,Z.height))+1:oe.mipmaps!==void 0&&oe.mipmaps.length>0?oe.mipmaps.length:oe.isCompressedTexture&&Array.isArray(oe.image)?Z.mipmaps.length:1}function R(oe){const Z=oe.target;Z.removeEventListener("dispose",R),B(Z),Z.isVideoTexture&&u.delete(Z)}function O(oe){const Z=oe.target;Z.removeEventListener("dispose",O),I(Z)}function B(oe){const Z=i.get(oe);if(Z.__webglInit===void 0)return;const he=oe.source,Ge=p.get(he);if(Ge){const ct=Ge[Z.__cacheKey];ct.usedTimes--,ct.usedTimes===0&&N(oe),Object.keys(Ge).length===0&&p.delete(he)}i.remove(oe)}function N(oe){const Z=i.get(oe);n.deleteTexture(Z.__webglTexture);const he=oe.source,Ge=p.get(he);delete Ge[Z.__cacheKey],o.memory.textures--}function I(oe){const Z=i.get(oe);if(oe.depthTexture&&(oe.depthTexture.dispose(),i.remove(oe.depthTexture)),oe.isWebGLCubeRenderTarget)for(let Ge=0;Ge<6;Ge++){if(Array.isArray(Z.__webglFramebuffer[Ge]))for(let ct=0;ct<Z.__webglFramebuffer[Ge].length;ct++)n.deleteFramebuffer(Z.__webglFramebuffer[Ge][ct]);else n.deleteFramebuffer(Z.__webglFramebuffer[Ge]);Z.__webglDepthbuffer&&n.deleteRenderbuffer(Z.__webglDepthbuffer[Ge])}else{if(Array.isArray(Z.__webglFramebuffer))for(let Ge=0;Ge<Z.__webglFramebuffer.length;Ge++)n.deleteFramebuffer(Z.__webglFramebuffer[Ge]);else n.deleteFramebuffer(Z.__webglFramebuffer);if(Z.__webglDepthbuffer&&n.deleteRenderbuffer(Z.__webglDepthbuffer),Z.__webglMultisampledFramebuffer&&n.deleteFramebuffer(Z.__webglMultisampledFramebuffer),Z.__webglColorRenderbuffer)for(let Ge=0;Ge<Z.__webglColorRenderbuffer.length;Ge++)Z.__webglColorRenderbuffer[Ge]&&n.deleteRenderbuffer(Z.__webglColorRenderbuffer[Ge]);Z.__webglDepthRenderbuffer&&n.deleteRenderbuffer(Z.__webglDepthRenderbuffer)}const he=oe.textures;for(let Ge=0,ct=he.length;Ge<ct;Ge++){const tt=i.get(he[Ge]);tt.__webglTexture&&(n.deleteTexture(tt.__webglTexture),o.memory.textures--),i.remove(he[Ge])}i.remove(oe)}let F=0;function j(){F=0}function W(){const oe=F;return oe>=r.maxTextures&&Wt("WebGLTextures: Trying to use "+oe+" texture units while this GPU supports only "+r.maxTextures),F+=1,oe}function U(oe){const Z=[];return Z.push(oe.wrapS),Z.push(oe.wrapT),Z.push(oe.wrapR||0),Z.push(oe.magFilter),Z.push(oe.minFilter),Z.push(oe.anisotropy),Z.push(oe.internalFormat),Z.push(oe.format),Z.push(oe.type),Z.push(oe.generateMipmaps),Z.push(oe.premultiplyAlpha),Z.push(oe.flipY),Z.push(oe.unpackAlignment),Z.push(oe.colorSpace),Z.join()}function H(oe,Z){const he=i.get(oe);if(oe.isVideoTexture&&$e(oe),oe.isRenderTargetTexture===!1&&oe.isExternalTexture!==!0&&oe.version>0&&he.__version!==oe.version){const Ge=oe.image;if(Ge===null)Wt("WebGLRenderer: Texture marked for update but no image data found.");else if(Ge.complete===!1)Wt("WebGLRenderer: Texture marked for update but image is incomplete");else{de(he,oe,Z);return}}else oe.isExternalTexture&&(he.__webglTexture=oe.sourceTexture?oe.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,he.__webglTexture,n.TEXTURE0+Z)}function q(oe,Z){const he=i.get(oe);if(oe.isRenderTargetTexture===!1&&oe.version>0&&he.__version!==oe.version){de(he,oe,Z);return}else oe.isExternalTexture&&(he.__webglTexture=oe.sourceTexture?oe.sourceTexture:null);t.bindTexture(n.TEXTURE_2D_ARRAY,he.__webglTexture,n.TEXTURE0+Z)}function J(oe,Z){const he=i.get(oe);if(oe.isRenderTargetTexture===!1&&oe.version>0&&he.__version!==oe.version){de(he,oe,Z);return}t.bindTexture(n.TEXTURE_3D,he.__webglTexture,n.TEXTURE0+Z)}function G(oe,Z){const he=i.get(oe);if(oe.isCubeDepthTexture!==!0&&oe.version>0&&he.__version!==oe.version){Ne(he,oe,Z);return}t.bindTexture(n.TEXTURE_CUBE_MAP,he.__webglTexture,n.TEXTURE0+Z)}const ee={[Nb]:n.REPEAT,[Ga]:n.CLAMP_TO_EDGE,[Pb]:n.MIRRORED_REPEAT},Q={[is]:n.NEAREST,[RD]:n.NEAREST_MIPMAP_NEAREST,[hy]:n.NEAREST_MIPMAP_LINEAR,[mr]:n.LINEAR,[M3]:n.LINEAR_MIPMAP_NEAREST,[th]:n.LINEAR_MIPMAP_LINEAR},ne={[fne]:n.NEVER,[xne]:n.ALWAYS,[pne]:n.LESS,[N9]:n.LEQUAL,[mne]:n.EQUAL,[P9]:n.GEQUAL,[gne]:n.GREATER,[yne]:n.NOTEQUAL};function fe(oe,Z){if(Z.type===Do&&e.has("OES_texture_float_linear")===!1&&(Z.magFilter===mr||Z.magFilter===M3||Z.magFilter===hy||Z.magFilter===th||Z.minFilter===mr||Z.minFilter===M3||Z.minFilter===hy||Z.minFilter===th)&&Wt("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(oe,n.TEXTURE_WRAP_S,ee[Z.wrapS]),n.texParameteri(oe,n.TEXTURE_WRAP_T,ee[Z.wrapT]),(oe===n.TEXTURE_3D||oe===n.TEXTURE_2D_ARRAY)&&n.texParameteri(oe,n.TEXTURE_WRAP_R,ee[Z.wrapR]),n.texParameteri(oe,n.TEXTURE_MAG_FILTER,Q[Z.magFilter]),n.texParameteri(oe,n.TEXTURE_MIN_FILTER,Q[Z.minFilter]),Z.compareFunction&&(n.texParameteri(oe,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(oe,n.TEXTURE_COMPARE_FUNC,ne[Z.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(Z.magFilter===is||Z.minFilter!==hy&&Z.minFilter!==th||Z.type===Do&&e.has("OES_texture_float_linear")===!1)return;if(Z.anisotropy>1||i.get(Z).__currentAnisotropy){const he=e.get("EXT_texture_filter_anisotropic");n.texParameterf(oe,he.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Z.anisotropy,r.getMaxAnisotropy())),i.get(Z).__currentAnisotropy=Z.anisotropy}}}function Ae(oe,Z){let he=!1;oe.__webglInit===void 0&&(oe.__webglInit=!0,Z.addEventListener("dispose",R));const Ge=Z.source;let ct=p.get(Ge);ct===void 0&&(ct={},p.set(Ge,ct));const tt=U(Z);if(tt!==oe.__cacheKey){ct[tt]===void 0&&(ct[tt]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,he=!0),ct[tt].usedTimes++;const Lt=ct[oe.__cacheKey];Lt!==void 0&&(ct[oe.__cacheKey].usedTimes--,Lt.usedTimes===0&&N(Z)),oe.__cacheKey=tt,oe.__webglTexture=ct[tt].texture}return he}function Pe(oe,Z,he){return Math.floor(Math.floor(oe/he)/Z)}function Ce(oe,Z,he,Ge){const tt=oe.updateRanges;if(tt.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,Z.width,Z.height,he,Ge,Z.data);else{tt.sort((Tt,Ve)=>Tt.start-Ve.start);let Lt=0;for(let Tt=1;Tt<tt.length;Tt++){const Ve=tt[Lt],ut=tt[Tt],ue=Ve.start+Ve.count,Ie=Pe(ut.start,Z.width,4),ft=Pe(Ve.start,Z.width,4);ut.start<=ue+1&&Ie===ft&&Pe(ut.start+ut.count-1,Z.width,4)===Ie?Ve.count=Math.max(Ve.count,ut.start+ut.count-Ve.start):(++Lt,tt[Lt]=ut)}tt.length=Lt+1;const Ct=n.getParameter(n.UNPACK_ROW_LENGTH),Ot=n.getParameter(n.UNPACK_SKIP_PIXELS),nn=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,Z.width);for(let Tt=0,Ve=tt.length;Tt<Ve;Tt++){const ut=tt[Tt],ue=Math.floor(ut.start/4),Ie=Math.ceil(ut.count/4),ft=ue%Z.width,xe=Math.floor(ue/Z.width),pt=Ie,ge=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,ft),n.pixelStorei(n.UNPACK_SKIP_ROWS,xe),t.texSubImage2D(n.TEXTURE_2D,0,ft,xe,pt,ge,he,Ge,Z.data)}oe.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,Ct),n.pixelStorei(n.UNPACK_SKIP_PIXELS,Ot),n.pixelStorei(n.UNPACK_SKIP_ROWS,nn)}}function de(oe,Z,he){let Ge=n.TEXTURE_2D;(Z.isDataArrayTexture||Z.isCompressedArrayTexture)&&(Ge=n.TEXTURE_2D_ARRAY),Z.isData3DTexture&&(Ge=n.TEXTURE_3D);const ct=Ae(oe,Z),tt=Z.source;t.bindTexture(Ge,oe.__webglTexture,n.TEXTURE0+he);const Lt=i.get(tt);if(tt.version!==Lt.__version||ct===!0){t.activeTexture(n.TEXTURE0+he);const Ct=xi.getPrimaries(xi.workingColorSpace),Ot=Z.colorSpace===hd?null:xi.getPrimaries(Z.colorSpace),nn=Z.colorSpace===hd||Ct===Ot?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,Z.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,Z.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,nn);let Tt=b(Z.image,!1,r.maxTextureSize);Tt=Xe(Z,Tt);const Ve=s.convert(Z.format,Z.colorSpace),ut=s.convert(Z.type);let ue=S(Z.internalFormat,Ve,ut,Z.colorSpace,Z.isVideoTexture);fe(Ge,Z);let Ie;const ft=Z.mipmaps,xe=Z.isVideoTexture!==!0,pt=Lt.__version===void 0||ct===!0,ge=tt.dataReady,Qe=P(Z,Tt);if(Z.isDepthTexture)ue=M(Z.format===i0,Z.type),pt&&(xe?t.texStorage2D(n.TEXTURE_2D,1,ue,Tt.width,Tt.height):t.texImage2D(n.TEXTURE_2D,0,ue,Tt.width,Tt.height,0,Ve,ut,null));else if(Z.isDataTexture)if(ft.length>0){xe&&pt&&t.texStorage2D(n.TEXTURE_2D,Qe,ue,ft[0].width,ft[0].height);for(let ht=0,at=ft.length;ht<at;ht++)Ie=ft[ht],xe?ge&&t.texSubImage2D(n.TEXTURE_2D,ht,0,0,Ie.width,Ie.height,Ve,ut,Ie.data):t.texImage2D(n.TEXTURE_2D,ht,ue,Ie.width,Ie.height,0,Ve,ut,Ie.data);Z.generateMipmaps=!1}else xe?(pt&&t.texStorage2D(n.TEXTURE_2D,Qe,ue,Tt.width,Tt.height),ge&&Ce(Z,Tt,Ve,ut)):t.texImage2D(n.TEXTURE_2D,0,ue,Tt.width,Tt.height,0,Ve,ut,Tt.data);else if(Z.isCompressedTexture)if(Z.isCompressedArrayTexture){xe&&pt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Qe,ue,ft[0].width,ft[0].height,Tt.depth);for(let ht=0,at=ft.length;ht<at;ht++)if(Ie=ft[ht],Z.format!==Oo)if(Ve!==null)if(xe){if(ge)if(Z.layerUpdates.size>0){const yt=$N(Ie.width,Ie.height,Z.format,Z.type);for(const Gt of Z.layerUpdates){const on=Ie.data.subarray(Gt*yt/Ie.data.BYTES_PER_ELEMENT,(Gt+1)*yt/Ie.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ht,0,0,Gt,Ie.width,Ie.height,1,Ve,on)}Z.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,ht,0,0,0,Ie.width,Ie.height,Tt.depth,Ve,Ie.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,ht,ue,Ie.width,Ie.height,Tt.depth,0,Ie.data,0,0);else Wt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else xe?ge&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,ht,0,0,0,Ie.width,Ie.height,Tt.depth,Ve,ut,Ie.data):t.texImage3D(n.TEXTURE_2D_ARRAY,ht,ue,Ie.width,Ie.height,Tt.depth,0,Ve,ut,Ie.data)}else{xe&&pt&&t.texStorage2D(n.TEXTURE_2D,Qe,ue,ft[0].width,ft[0].height);for(let ht=0,at=ft.length;ht<at;ht++)Ie=ft[ht],Z.format!==Oo?Ve!==null?xe?ge&&t.compressedTexSubImage2D(n.TEXTURE_2D,ht,0,0,Ie.width,Ie.height,Ve,Ie.data):t.compressedTexImage2D(n.TEXTURE_2D,ht,ue,Ie.width,Ie.height,0,Ie.data):Wt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):xe?ge&&t.texSubImage2D(n.TEXTURE_2D,ht,0,0,Ie.width,Ie.height,Ve,ut,Ie.data):t.texImage2D(n.TEXTURE_2D,ht,ue,Ie.width,Ie.height,0,Ve,ut,Ie.data)}else if(Z.isDataArrayTexture)if(xe){if(pt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Qe,ue,Tt.width,Tt.height,Tt.depth),ge)if(Z.layerUpdates.size>0){const ht=$N(Tt.width,Tt.height,Z.format,Z.type);for(const at of Z.layerUpdates){const yt=Tt.data.subarray(at*ht/Tt.data.BYTES_PER_ELEMENT,(at+1)*ht/Tt.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,at,Tt.width,Tt.height,1,Ve,ut,yt)}Z.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Tt.width,Tt.height,Tt.depth,Ve,ut,Tt.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,ue,Tt.width,Tt.height,Tt.depth,0,Ve,ut,Tt.data);else if(Z.isData3DTexture)xe?(pt&&t.texStorage3D(n.TEXTURE_3D,Qe,ue,Tt.width,Tt.height,Tt.depth),ge&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Tt.width,Tt.height,Tt.depth,Ve,ut,Tt.data)):t.texImage3D(n.TEXTURE_3D,0,ue,Tt.width,Tt.height,Tt.depth,0,Ve,ut,Tt.data);else if(Z.isFramebufferTexture){if(pt)if(xe)t.texStorage2D(n.TEXTURE_2D,Qe,ue,Tt.width,Tt.height);else{let ht=Tt.width,at=Tt.height;for(let yt=0;yt<Qe;yt++)t.texImage2D(n.TEXTURE_2D,yt,ue,ht,at,0,Ve,ut,null),ht>>=1,at>>=1}}else if(ft.length>0){if(xe&&pt){const ht=Ye(ft[0]);t.texStorage2D(n.TEXTURE_2D,Qe,ue,ht.width,ht.height)}for(let ht=0,at=ft.length;ht<at;ht++)Ie=ft[ht],xe?ge&&t.texSubImage2D(n.TEXTURE_2D,ht,0,0,Ve,ut,Ie):t.texImage2D(n.TEXTURE_2D,ht,ue,Ve,ut,Ie);Z.generateMipmaps=!1}else if(xe){if(pt){const ht=Ye(Tt);t.texStorage2D(n.TEXTURE_2D,Qe,ue,ht.width,ht.height)}ge&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Ve,ut,Tt)}else t.texImage2D(n.TEXTURE_2D,0,ue,Ve,ut,Tt);w(Z)&&v(Ge),Lt.__version=tt.version,Z.onUpdate&&Z.onUpdate(Z)}oe.__version=Z.version}function Ne(oe,Z,he){if(Z.image.length!==6)return;const Ge=Ae(oe,Z),ct=Z.source;t.bindTexture(n.TEXTURE_CUBE_MAP,oe.__webglTexture,n.TEXTURE0+he);const tt=i.get(ct);if(ct.version!==tt.__version||Ge===!0){t.activeTexture(n.TEXTURE0+he);const Lt=xi.getPrimaries(xi.workingColorSpace),Ct=Z.colorSpace===hd?null:xi.getPrimaries(Z.colorSpace),Ot=Z.colorSpace===hd||Lt===Ct?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,Z.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Z.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,Z.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ot);const nn=Z.isCompressedTexture||Z.image[0].isCompressedTexture,Tt=Z.image[0]&&Z.image[0].isDataTexture,Ve=[];for(let at=0;at<6;at++)!nn&&!Tt?Ve[at]=b(Z.image[at],!0,r.maxCubemapSize):Ve[at]=Tt?Z.image[at].image:Z.image[at],Ve[at]=Xe(Z,Ve[at]);const ut=Ve[0],ue=s.convert(Z.format,Z.colorSpace),Ie=s.convert(Z.type),ft=S(Z.internalFormat,ue,Ie,Z.colorSpace),xe=Z.isVideoTexture!==!0,pt=tt.__version===void 0||Ge===!0,ge=ct.dataReady;let Qe=P(Z,ut);fe(n.TEXTURE_CUBE_MAP,Z);let ht;if(nn){xe&&pt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Qe,ft,ut.width,ut.height);for(let at=0;at<6;at++){ht=Ve[at].mipmaps;for(let yt=0;yt<ht.length;yt++){const Gt=ht[yt];Z.format!==Oo?ue!==null?xe?ge&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt,0,0,Gt.width,Gt.height,ue,Gt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt,ft,Gt.width,Gt.height,0,Gt.data):Wt("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):xe?ge&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt,0,0,Gt.width,Gt.height,ue,Ie,Gt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt,ft,Gt.width,Gt.height,0,ue,Ie,Gt.data)}}}else{if(ht=Z.mipmaps,xe&&pt){ht.length>0&&Qe++;const at=Ye(Ve[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Qe,ft,at.width,at.height)}for(let at=0;at<6;at++)if(Tt){xe?ge&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,0,0,Ve[at].width,Ve[at].height,ue,Ie,Ve[at].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,ft,Ve[at].width,Ve[at].height,0,ue,Ie,Ve[at].data);for(let yt=0;yt<ht.length;yt++){const on=ht[yt].image[at].image;xe?ge&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt+1,0,0,on.width,on.height,ue,Ie,on.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt+1,ft,on.width,on.height,0,ue,Ie,on.data)}}else{xe?ge&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,0,0,ue,Ie,Ve[at]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,ft,ue,Ie,Ve[at]);for(let yt=0;yt<ht.length;yt++){const Gt=ht[yt];xe?ge&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt+1,0,0,ue,Ie,Gt.image[at]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+at,yt+1,ft,ue,Ie,Gt.image[at])}}}w(Z)&&v(n.TEXTURE_CUBE_MAP),tt.__version=ct.version,Z.onUpdate&&Z.onUpdate(Z)}oe.__version=Z.version}function et(oe,Z,he,Ge,ct,tt){const Lt=s.convert(he.format,he.colorSpace),Ct=s.convert(he.type),Ot=S(he.internalFormat,Lt,Ct,he.colorSpace),nn=i.get(Z),Tt=i.get(he);if(Tt.__renderTarget=Z,!nn.__hasExternalTextures){const Ve=Math.max(1,Z.width>>tt),ut=Math.max(1,Z.height>>tt);ct===n.TEXTURE_3D||ct===n.TEXTURE_2D_ARRAY?t.texImage3D(ct,tt,Ot,Ve,ut,Z.depth,0,Lt,Ct,null):t.texImage2D(ct,tt,Ot,Ve,ut,0,Lt,Ct,null)}t.bindFramebuffer(n.FRAMEBUFFER,oe),qe(Z)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ge,ct,Tt.__webglTexture,0,pe(Z)):(ct===n.TEXTURE_2D||ct>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&ct<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ge,ct,Tt.__webglTexture,tt),t.bindFramebuffer(n.FRAMEBUFFER,null)}function me(oe,Z,he){if(n.bindRenderbuffer(n.RENDERBUFFER,oe),Z.depthBuffer){const Ge=Z.depthTexture,ct=Ge&&Ge.isDepthTexture?Ge.type:null,tt=M(Z.stencilBuffer,ct),Lt=Z.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;qe(Z)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,pe(Z),tt,Z.width,Z.height):he?n.renderbufferStorageMultisample(n.RENDERBUFFER,pe(Z),tt,Z.width,Z.height):n.renderbufferStorage(n.RENDERBUFFER,tt,Z.width,Z.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Lt,n.RENDERBUFFER,oe)}else{const Ge=Z.textures;for(let ct=0;ct<Ge.length;ct++){const tt=Ge[ct],Lt=s.convert(tt.format,tt.colorSpace),Ct=s.convert(tt.type),Ot=S(tt.internalFormat,Lt,Ct,tt.colorSpace);qe(Z)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,pe(Z),Ot,Z.width,Z.height):he?n.renderbufferStorageMultisample(n.RENDERBUFFER,pe(Z),Ot,Z.width,Z.height):n.renderbufferStorage(n.RENDERBUFFER,Ot,Z.width,Z.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function nt(oe,Z,he){const Ge=Z.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(n.FRAMEBUFFER,oe),!(Z.depthTexture&&Z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ct=i.get(Z.depthTexture);if(ct.__renderTarget=Z,(!ct.__webglTexture||Z.depthTexture.image.width!==Z.width||Z.depthTexture.image.height!==Z.height)&&(Z.depthTexture.image.width=Z.width,Z.depthTexture.image.height=Z.height,Z.depthTexture.needsUpdate=!0),Ge){if(ct.__webglInit===void 0&&(ct.__webglInit=!0,Z.depthTexture.addEventListener("dispose",R)),ct.__webglTexture===void 0){ct.__webglTexture=n.createTexture(),t.bindTexture(n.TEXTURE_CUBE_MAP,ct.__webglTexture),fe(n.TEXTURE_CUBE_MAP,Z.depthTexture);const nn=s.convert(Z.depthTexture.format),Tt=s.convert(Z.depthTexture.type);let Ve;Z.depthTexture.format===ph?Ve=n.DEPTH_COMPONENT24:Z.depthTexture.format===i0&&(Ve=n.DEPTH24_STENCIL8);for(let ut=0;ut<6;ut++)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,Ve,Z.width,Z.height,0,nn,Tt,null)}}else H(Z.depthTexture,0);const tt=ct.__webglTexture,Lt=pe(Z),Ct=Ge?n.TEXTURE_CUBE_MAP_POSITIVE_X+he:n.TEXTURE_2D,Ot=Z.depthTexture.format===i0?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;if(Z.depthTexture.format===ph)qe(Z)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ot,Ct,tt,0,Lt):n.framebufferTexture2D(n.FRAMEBUFFER,Ot,Ct,tt,0);else if(Z.depthTexture.format===i0)qe(Z)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ot,Ct,tt,0,Lt):n.framebufferTexture2D(n.FRAMEBUFFER,Ot,Ct,tt,0);else throw new Error("Unknown depthTexture format")}function Pt(oe){const Z=i.get(oe),he=oe.isWebGLCubeRenderTarget===!0;if(Z.__boundDepthTexture!==oe.depthTexture){const Ge=oe.depthTexture;if(Z.__depthDisposeCallback&&Z.__depthDisposeCallback(),Ge){const ct=()=>{delete Z.__boundDepthTexture,delete Z.__depthDisposeCallback,Ge.removeEventListener("dispose",ct)};Ge.addEventListener("dispose",ct),Z.__depthDisposeCallback=ct}Z.__boundDepthTexture=Ge}if(oe.depthTexture&&!Z.__autoAllocateDepthBuffer)if(he)for(let Ge=0;Ge<6;Ge++)nt(Z.__webglFramebuffer[Ge],oe,Ge);else{const Ge=oe.texture.mipmaps;Ge&&Ge.length>0?nt(Z.__webglFramebuffer[0],oe,0):nt(Z.__webglFramebuffer,oe,0)}else if(he){Z.__webglDepthbuffer=[];for(let Ge=0;Ge<6;Ge++)if(t.bindFramebuffer(n.FRAMEBUFFER,Z.__webglFramebuffer[Ge]),Z.__webglDepthbuffer[Ge]===void 0)Z.__webglDepthbuffer[Ge]=n.createRenderbuffer(),me(Z.__webglDepthbuffer[Ge],oe,!1);else{const ct=oe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,tt=Z.__webglDepthbuffer[Ge];n.bindRenderbuffer(n.RENDERBUFFER,tt),n.framebufferRenderbuffer(n.FRAMEBUFFER,ct,n.RENDERBUFFER,tt)}}else{const Ge=oe.texture.mipmaps;if(Ge&&Ge.length>0?t.bindFramebuffer(n.FRAMEBUFFER,Z.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,Z.__webglFramebuffer),Z.__webglDepthbuffer===void 0)Z.__webglDepthbuffer=n.createRenderbuffer(),me(Z.__webglDepthbuffer,oe,!1);else{const ct=oe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,tt=Z.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,tt),n.framebufferRenderbuffer(n.FRAMEBUFFER,ct,n.RENDERBUFFER,tt)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function zt(oe,Z,he){const Ge=i.get(oe);Z!==void 0&&et(Ge.__webglFramebuffer,oe,oe.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),he!==void 0&&Pt(oe)}function Dt(oe){const Z=oe.texture,he=i.get(oe),Ge=i.get(Z);oe.addEventListener("dispose",O);const ct=oe.textures,tt=oe.isWebGLCubeRenderTarget===!0,Lt=ct.length>1;if(Lt||(Ge.__webglTexture===void 0&&(Ge.__webglTexture=n.createTexture()),Ge.__version=Z.version,o.memory.textures++),tt){he.__webglFramebuffer=[];for(let Ct=0;Ct<6;Ct++)if(Z.mipmaps&&Z.mipmaps.length>0){he.__webglFramebuffer[Ct]=[];for(let Ot=0;Ot<Z.mipmaps.length;Ot++)he.__webglFramebuffer[Ct][Ot]=n.createFramebuffer()}else he.__webglFramebuffer[Ct]=n.createFramebuffer()}else{if(Z.mipmaps&&Z.mipmaps.length>0){he.__webglFramebuffer=[];for(let Ct=0;Ct<Z.mipmaps.length;Ct++)he.__webglFramebuffer[Ct]=n.createFramebuffer()}else he.__webglFramebuffer=n.createFramebuffer();if(Lt)for(let Ct=0,Ot=ct.length;Ct<Ot;Ct++){const nn=i.get(ct[Ct]);nn.__webglTexture===void 0&&(nn.__webglTexture=n.createTexture(),o.memory.textures++)}if(oe.samples>0&&qe(oe)===!1){he.__webglMultisampledFramebuffer=n.createFramebuffer(),he.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,he.__webglMultisampledFramebuffer);for(let Ct=0;Ct<ct.length;Ct++){const Ot=ct[Ct];he.__webglColorRenderbuffer[Ct]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,he.__webglColorRenderbuffer[Ct]);const nn=s.convert(Ot.format,Ot.colorSpace),Tt=s.convert(Ot.type),Ve=S(Ot.internalFormat,nn,Tt,Ot.colorSpace,oe.isXRRenderTarget===!0),ut=pe(oe);n.renderbufferStorageMultisample(n.RENDERBUFFER,ut,Ve,oe.width,oe.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Ct,n.RENDERBUFFER,he.__webglColorRenderbuffer[Ct])}n.bindRenderbuffer(n.RENDERBUFFER,null),oe.depthBuffer&&(he.__webglDepthRenderbuffer=n.createRenderbuffer(),me(he.__webglDepthRenderbuffer,oe,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(tt){t.bindTexture(n.TEXTURE_CUBE_MAP,Ge.__webglTexture),fe(n.TEXTURE_CUBE_MAP,Z);for(let Ct=0;Ct<6;Ct++)if(Z.mipmaps&&Z.mipmaps.length>0)for(let Ot=0;Ot<Z.mipmaps.length;Ot++)et(he.__webglFramebuffer[Ct][Ot],oe,Z,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,Ot);else et(he.__webglFramebuffer[Ct],oe,Z,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Ct,0);w(Z)&&v(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Lt){for(let Ct=0,Ot=ct.length;Ct<Ot;Ct++){const nn=ct[Ct],Tt=i.get(nn);let Ve=n.TEXTURE_2D;(oe.isWebGL3DRenderTarget||oe.isWebGLArrayRenderTarget)&&(Ve=oe.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Ve,Tt.__webglTexture),fe(Ve,nn),et(he.__webglFramebuffer,oe,nn,n.COLOR_ATTACHMENT0+Ct,Ve,0),w(nn)&&v(Ve)}t.unbindTexture()}else{let Ct=n.TEXTURE_2D;if((oe.isWebGL3DRenderTarget||oe.isWebGLArrayRenderTarget)&&(Ct=oe.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Ct,Ge.__webglTexture),fe(Ct,Z),Z.mipmaps&&Z.mipmaps.length>0)for(let Ot=0;Ot<Z.mipmaps.length;Ot++)et(he.__webglFramebuffer[Ot],oe,Z,n.COLOR_ATTACHMENT0,Ct,Ot);else et(he.__webglFramebuffer,oe,Z,n.COLOR_ATTACHMENT0,Ct,0);w(Z)&&v(Ct),t.unbindTexture()}oe.depthBuffer&&Pt(oe)}function gt(oe){const Z=oe.textures;for(let he=0,Ge=Z.length;he<Ge;he++){const ct=Z[he];if(w(ct)){const tt=T(oe),Lt=i.get(ct).__webglTexture;t.bindTexture(tt,Lt),v(tt),t.unbindTexture()}}}const vt=[],Oe=[];function xt(oe){if(oe.samples>0){if(qe(oe)===!1){const Z=oe.textures,he=oe.width,Ge=oe.height;let ct=n.COLOR_BUFFER_BIT;const tt=oe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Lt=i.get(oe),Ct=Z.length>1;if(Ct)for(let nn=0;nn<Z.length;nn++)t.bindFramebuffer(n.FRAMEBUFFER,Lt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+nn,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Lt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+nn,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Lt.__webglMultisampledFramebuffer);const Ot=oe.texture.mipmaps;Ot&&Ot.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Lt.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Lt.__webglFramebuffer);for(let nn=0;nn<Z.length;nn++){if(oe.resolveDepthBuffer&&(oe.depthBuffer&&(ct|=n.DEPTH_BUFFER_BIT),oe.stencilBuffer&&oe.resolveStencilBuffer&&(ct|=n.STENCIL_BUFFER_BIT)),Ct){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Lt.__webglColorRenderbuffer[nn]);const Tt=i.get(Z[nn]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Tt,0)}n.blitFramebuffer(0,0,he,Ge,0,0,he,Ge,ct,n.NEAREST),l===!0&&(vt.length=0,Oe.length=0,vt.push(n.COLOR_ATTACHMENT0+nn),oe.depthBuffer&&oe.resolveDepthBuffer===!1&&(vt.push(tt),Oe.push(tt),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Oe)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,vt))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Ct)for(let nn=0;nn<Z.length;nn++){t.bindFramebuffer(n.FRAMEBUFFER,Lt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+nn,n.RENDERBUFFER,Lt.__webglColorRenderbuffer[nn]);const Tt=i.get(Z[nn]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Lt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+nn,n.TEXTURE_2D,Tt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Lt.__webglMultisampledFramebuffer)}else if(oe.depthBuffer&&oe.resolveDepthBuffer===!1&&l){const Z=oe.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[Z])}}}function pe(oe){return Math.min(r.maxSamples,oe.samples)}function qe(oe){const Z=i.get(oe);return oe.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&Z.__useRenderToTexture!==!1}function $e(oe){const Z=o.render.frame;u.get(oe)!==Z&&(u.set(oe,Z),oe.update())}function Xe(oe,Z){const he=oe.colorSpace,Ge=oe.format,ct=oe.type;return oe.isCompressedTexture===!0||oe.isVideoTexture===!0||he!==i1&&he!==hd&&(xi.getTransfer(he)===Gi?(Ge!==Oo||ct!==ca)&&Wt("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):xn("WebGLTextures: Unsupported texture color space:",he)),Z}function Ye(oe){return typeof HTMLImageElement<"u"&&oe instanceof HTMLImageElement?(c.width=oe.naturalWidth||oe.width,c.height=oe.naturalHeight||oe.height):typeof VideoFrame<"u"&&oe instanceof VideoFrame?(c.width=oe.displayWidth,c.height=oe.displayHeight):(c.width=oe.width,c.height=oe.height),c}this.allocateTextureUnit=W,this.resetTextureUnits=j,this.setTexture2D=H,this.setTexture2DArray=q,this.setTexture3D=J,this.setTextureCube=G,this.rebindTextures=zt,this.setupRenderTarget=Dt,this.updateRenderTargetMipmap=gt,this.updateMultisampleRenderTarget=xt,this.setupDepthRenderbuffer=Pt,this.setupFrameBufferTexture=et,this.useMultisampledRTT=qe,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function kie(n,e){function t(i,r=hd){let s;const o=xi.getTransfer(r);if(i===ca)return n.UNSIGNED_BYTE;if(i===T9)return n.UNSIGNED_SHORT_4_4_4_4;if(i===A9)return n.UNSIGNED_SHORT_5_5_5_1;if(i===PD)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===kD)return n.UNSIGNED_INT_10F_11F_11F_REV;if(i===ID)return n.BYTE;if(i===ND)return n.SHORT;if(i===G2)return n.UNSIGNED_SHORT;if(i===E9)return n.INT;if(i===bc)return n.UNSIGNED_INT;if(i===Do)return n.FLOAT;if(i===du)return n.HALF_FLOAT;if(i===LD)return n.ALPHA;if(i===DD)return n.RGB;if(i===Oo)return n.RGBA;if(i===ph)return n.DEPTH_COMPONENT;if(i===i0)return n.DEPTH_STENCIL;if(i===C9)return n.RED;if(i===G_)return n.RED_INTEGER;if(i===n1)return n.RG;if(i===M9)return n.RG_INTEGER;if(i===R9)return n.RGBA_INTEGER;if(i===R3||i===I3||i===N3||i===P3)if(o===Gi)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(i===R3)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===I3)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===N3)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===P3)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(i===R3)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===I3)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===N3)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===P3)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===F8||i===z8||i===j8||i===V8)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(i===F8)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===z8)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===j8)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===V8)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===H8||i===$8||i===G8||i===W8||i===K8||i===q8||i===Z8)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(i===H8||i===$8)return o===Gi?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===G8)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(i===W8)return s.COMPRESSED_R11_EAC;if(i===K8)return s.COMPRESSED_SIGNED_R11_EAC;if(i===q8)return s.COMPRESSED_RG11_EAC;if(i===Z8)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(i===Y8||i===X8||i===Q8||i===J8||i===eE||i===tE||i===nE||i===iE||i===rE||i===sE||i===oE||i===aE||i===lE||i===cE)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(i===Y8)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===X8)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===Q8)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===J8)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===eE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===tE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===nE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===iE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===rE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===sE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===oE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===aE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===lE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===cE)return o===Gi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===uE||i===hE||i===dE)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(i===uE)return o===Gi?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===hE)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===dE)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===fE||i===pE||i===mE||i===gE)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(i===fE)return s.COMPRESSED_RED_RGTC1_EXT;if(i===pE)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===mE)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===gE)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===W2?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}const YDe=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,XDe=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class QDe{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const i=new WD(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,i=new _c({vertexShader:YDe,fragmentShader:XDe,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new xs(new bx(20,20),i)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class JDe extends xh{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=1,c=null,u=null,h=null,p=null,m=null,y=null;const b=typeof XRWebGLBinding<"u",w=new QDe,v={},T=t.getContextAttributes();let S=null,M=null;const P=[],R=[],O=new Et;let B=null;const N=new ns;N.viewport=new fr;const I=new ns;I.viewport=new fr;const F=[N,I],j=new wie;let W=null,U=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(de){let Ne=P[de];return Ne===void 0&&(Ne=new jS,P[de]=Ne),Ne.getTargetRaySpace()},this.getControllerGrip=function(de){let Ne=P[de];return Ne===void 0&&(Ne=new jS,P[de]=Ne),Ne.getGripSpace()},this.getHand=function(de){let Ne=P[de];return Ne===void 0&&(Ne=new jS,P[de]=Ne),Ne.getHandSpace()};function H(de){const Ne=R.indexOf(de.inputSource);if(Ne===-1)return;const et=P[Ne];et!==void 0&&(et.update(de.inputSource,de.frame,c||o),et.dispatchEvent({type:de.type,data:de.inputSource}))}function q(){r.removeEventListener("select",H),r.removeEventListener("selectstart",H),r.removeEventListener("selectend",H),r.removeEventListener("squeeze",H),r.removeEventListener("squeezestart",H),r.removeEventListener("squeezeend",H),r.removeEventListener("end",q),r.removeEventListener("inputsourceschange",J);for(let de=0;de<P.length;de++){const Ne=R[de];Ne!==null&&(R[de]=null,P[de].disconnect(Ne))}W=null,U=null,w.reset();for(const de in v)delete v[de];e.setRenderTarget(S),m=null,p=null,h=null,r=null,M=null,Ce.stop(),i.isPresenting=!1,e.setPixelRatio(B),e.setSize(O.width,O.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(de){s=de,i.isPresenting===!0&&Wt("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(de){a=de,i.isPresenting===!0&&Wt("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(de){c=de},this.getBaseLayer=function(){return p!==null?p:m},this.getBinding=function(){return h===null&&b&&(h=new XRWebGLBinding(r,t)),h},this.getFrame=function(){return y},this.getSession=function(){return r},this.setSession=async function(de){if(r=de,r!==null){if(S=e.getRenderTarget(),r.addEventListener("select",H),r.addEventListener("selectstart",H),r.addEventListener("selectend",H),r.addEventListener("squeeze",H),r.addEventListener("squeezestart",H),r.addEventListener("squeezeend",H),r.addEventListener("end",q),r.addEventListener("inputsourceschange",J),T.xrCompatible!==!0&&await t.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(O),b&&"createProjectionLayer"in XRWebGLBinding.prototype){let et=null,me=null,nt=null;T.depth&&(nt=T.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,et=T.stencil?i0:ph,me=T.stencil?W2:bc);const Pt={colorFormat:t.RGBA8,depthFormat:nt,scaleFactor:s};h=this.getBinding(),p=h.createProjectionLayer(Pt),r.updateRenderState({layers:[p]}),e.setPixelRatio(1),e.setSize(p.textureWidth,p.textureHeight,!1),M=new Xa(p.textureWidth,p.textureHeight,{format:Oo,type:ca,depthTexture:new s1(p.textureWidth,p.textureHeight,me,void 0,void 0,void 0,void 0,void 0,void 0,et),stencilBuffer:T.stencil,colorSpace:e.outputColorSpace,samples:T.antialias?4:0,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}else{const et={antialias:T.antialias,alpha:!0,depth:T.depth,stencil:T.stencil,framebufferScaleFactor:s};m=new XRWebGLLayer(r,t,et),r.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),M=new Xa(m.framebufferWidth,m.framebufferHeight,{format:Oo,type:ca,colorSpace:e.outputColorSpace,stencilBuffer:T.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}M.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await r.requestReferenceSpace(a),Ce.setContext(r),Ce.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode},this.getDepthTexture=function(){return w.getDepthTexture()};function J(de){for(let Ne=0;Ne<de.removed.length;Ne++){const et=de.removed[Ne],me=R.indexOf(et);me>=0&&(R[me]=null,P[me].disconnect(et))}for(let Ne=0;Ne<de.added.length;Ne++){const et=de.added[Ne];let me=R.indexOf(et);if(me===-1){for(let Pt=0;Pt<P.length;Pt++)if(Pt>=R.length){R.push(et),me=Pt;break}else if(R[Pt]===null){R[Pt]=et,me=Pt;break}if(me===-1)break}const nt=P[me];nt&&nt.connect(et)}}const G=new ye,ee=new ye;function Q(de,Ne,et){G.setFromMatrixPosition(Ne.matrixWorld),ee.setFromMatrixPosition(et.matrixWorld);const me=G.distanceTo(ee),nt=Ne.projectionMatrix.elements,Pt=et.projectionMatrix.elements,zt=nt[14]/(nt[10]-1),Dt=nt[14]/(nt[10]+1),gt=(nt[9]+1)/nt[5],vt=(nt[9]-1)/nt[5],Oe=(nt[8]-1)/nt[0],xt=(Pt[8]+1)/Pt[0],pe=zt*Oe,qe=zt*xt,$e=me/(-Oe+xt),Xe=$e*-Oe;if(Ne.matrixWorld.decompose(de.position,de.quaternion,de.scale),de.translateX(Xe),de.translateZ($e),de.matrixWorld.compose(de.position,de.quaternion,de.scale),de.matrixWorldInverse.copy(de.matrixWorld).invert(),nt[10]===-1)de.projectionMatrix.copy(Ne.projectionMatrix),de.projectionMatrixInverse.copy(Ne.projectionMatrixInverse);else{const Ye=zt+$e,oe=Dt+$e,Z=pe-Xe,he=qe+(me-Xe),Ge=gt*Dt/oe*Ye,ct=vt*Dt/oe*Ye;de.projectionMatrix.makePerspective(Z,he,Ge,ct,Ye,oe),de.projectionMatrixInverse.copy(de.projectionMatrix).invert()}}function ne(de,Ne){Ne===null?de.matrixWorld.copy(de.matrix):de.matrixWorld.multiplyMatrices(Ne.matrixWorld,de.matrix),de.matrixWorldInverse.copy(de.matrixWorld).invert()}this.updateCamera=function(de){if(r===null)return;let Ne=de.near,et=de.far;w.texture!==null&&(w.depthNear>0&&(Ne=w.depthNear),w.depthFar>0&&(et=w.depthFar)),j.near=I.near=N.near=Ne,j.far=I.far=N.far=et,(W!==j.near||U!==j.far)&&(r.updateRenderState({depthNear:j.near,depthFar:j.far}),W=j.near,U=j.far),j.layers.mask=de.layers.mask|6,N.layers.mask=j.layers.mask&3,I.layers.mask=j.layers.mask&5;const me=de.parent,nt=j.cameras;ne(j,me);for(let Pt=0;Pt<nt.length;Pt++)ne(nt[Pt],me);nt.length===2?Q(j,N,I):j.projectionMatrix.copy(N.projectionMatrix),fe(de,j,me)};function fe(de,Ne,et){et===null?de.matrix.copy(Ne.matrixWorld):(de.matrix.copy(et.matrixWorld),de.matrix.invert(),de.matrix.multiply(Ne.matrixWorld)),de.matrix.decompose(de.position,de.quaternion,de.scale),de.updateMatrixWorld(!0),de.projectionMatrix.copy(Ne.projectionMatrix),de.projectionMatrixInverse.copy(Ne.projectionMatrixInverse),de.isPerspectiveCamera&&(de.fov=Z2*2*Math.atan(1/de.projectionMatrix.elements[5]),de.zoom=1)}this.getCamera=function(){return j},this.getFoveation=function(){if(!(p===null&&m===null))return l},this.setFoveation=function(de){l=de,p!==null&&(p.fixedFoveation=de),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=de)},this.hasDepthSensing=function(){return w.texture!==null},this.getDepthSensingMesh=function(){return w.getMesh(j)},this.getCameraTexture=function(de){return v[de]};let Ae=null;function Pe(de,Ne){if(u=Ne.getViewerPose(c||o),y=Ne,u!==null){const et=u.views;m!==null&&(e.setRenderTargetFramebuffer(M,m.framebuffer),e.setRenderTarget(M));let me=!1;et.length!==j.cameras.length&&(j.cameras.length=0,me=!0);for(let Dt=0;Dt<et.length;Dt++){const gt=et[Dt];let vt=null;if(m!==null)vt=m.getViewport(gt);else{const xt=h.getViewSubImage(p,gt);vt=xt.viewport,Dt===0&&(e.setRenderTargetTextures(M,xt.colorTexture,xt.depthStencilTexture),e.setRenderTarget(M))}let Oe=F[Dt];Oe===void 0&&(Oe=new ns,Oe.layers.enable(Dt),Oe.viewport=new fr,F[Dt]=Oe),Oe.matrix.fromArray(gt.transform.matrix),Oe.matrix.decompose(Oe.position,Oe.quaternion,Oe.scale),Oe.projectionMatrix.fromArray(gt.projectionMatrix),Oe.projectionMatrixInverse.copy(Oe.projectionMatrix).invert(),Oe.viewport.set(vt.x,vt.y,vt.width,vt.height),Dt===0&&(j.matrix.copy(Oe.matrix),j.matrix.decompose(j.position,j.quaternion,j.scale)),me===!0&&j.cameras.push(Oe)}const nt=r.enabledFeatures;if(nt&&nt.includes("depth-sensing")&&r.depthUsage=="gpu-optimized"&&b){h=i.getBinding();const Dt=h.getDepthInformation(et[0]);Dt&&Dt.isValid&&Dt.texture&&w.init(Dt,r.renderState)}if(nt&&nt.includes("camera-access")&&b){e.state.unbindTexture(),h=i.getBinding();for(let Dt=0;Dt<et.length;Dt++){const gt=et[Dt].camera;if(gt){let vt=v[gt];vt||(vt=new WD,v[gt]=vt);const Oe=h.getCameraImage(gt);vt.sourceTexture=Oe}}}}for(let et=0;et<P.length;et++){const me=R[et],nt=P[et];me!==null&&nt!==void 0&&nt.update(me,Ne,c||o)}Ae&&Ae(de,Ne),Ne.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:Ne}),y=null}const Ce=new Mie;Ce.setAnimationLoop(Pe),this.setAnimationLoop=function(de){Ae=de},this.dispose=function(){}}}const Bp=new fu,eOe=new Hn;function tOe(n,e){function t(w,v){w.matrixAutoUpdate===!0&&w.updateMatrix(),v.value.copy(w.matrix)}function i(w,v){v.color.getRGB(w.fogColor.value,Rne(n)),v.isFog?(w.fogNear.value=v.near,w.fogFar.value=v.far):v.isFogExp2&&(w.fogDensity.value=v.density)}function r(w,v,T,S,M){v.isMeshBasicMaterial||v.isMeshLambertMaterial?s(w,v):v.isMeshToonMaterial?(s(w,v),h(w,v)):v.isMeshPhongMaterial?(s(w,v),u(w,v)):v.isMeshStandardMaterial?(s(w,v),p(w,v),v.isMeshPhysicalMaterial&&m(w,v,M)):v.isMeshMatcapMaterial?(s(w,v),y(w,v)):v.isMeshDepthMaterial?s(w,v):v.isMeshDistanceMaterial?(s(w,v),b(w,v)):v.isMeshNormalMaterial?s(w,v):v.isLineBasicMaterial?(o(w,v),v.isLineDashedMaterial&&a(w,v)):v.isPointsMaterial?l(w,v,T,S):v.isSpriteMaterial?c(w,v):v.isShadowMaterial?(w.color.value.copy(v.color),w.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function s(w,v){w.opacity.value=v.opacity,v.color&&w.diffuse.value.copy(v.color),v.emissive&&w.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(w.map.value=v.map,t(v.map,w.mapTransform)),v.alphaMap&&(w.alphaMap.value=v.alphaMap,t(v.alphaMap,w.alphaMapTransform)),v.bumpMap&&(w.bumpMap.value=v.bumpMap,t(v.bumpMap,w.bumpMapTransform),w.bumpScale.value=v.bumpScale,v.side===fa&&(w.bumpScale.value*=-1)),v.normalMap&&(w.normalMap.value=v.normalMap,t(v.normalMap,w.normalMapTransform),w.normalScale.value.copy(v.normalScale),v.side===fa&&w.normalScale.value.negate()),v.displacementMap&&(w.displacementMap.value=v.displacementMap,t(v.displacementMap,w.displacementMapTransform),w.displacementScale.value=v.displacementScale,w.displacementBias.value=v.displacementBias),v.emissiveMap&&(w.emissiveMap.value=v.emissiveMap,t(v.emissiveMap,w.emissiveMapTransform)),v.specularMap&&(w.specularMap.value=v.specularMap,t(v.specularMap,w.specularMapTransform)),v.alphaTest>0&&(w.alphaTest.value=v.alphaTest);const T=e.get(v),S=T.envMap,M=T.envMapRotation;S&&(w.envMap.value=S,Bp.copy(M),Bp.x*=-1,Bp.y*=-1,Bp.z*=-1,S.isCubeTexture&&S.isRenderTargetTexture===!1&&(Bp.y*=-1,Bp.z*=-1),w.envMapRotation.value.setFromMatrix4(eOe.makeRotationFromEuler(Bp)),w.flipEnvMap.value=S.isCubeTexture&&S.isRenderTargetTexture===!1?-1:1,w.reflectivity.value=v.reflectivity,w.ior.value=v.ior,w.refractionRatio.value=v.refractionRatio),v.lightMap&&(w.lightMap.value=v.lightMap,w.lightMapIntensity.value=v.lightMapIntensity,t(v.lightMap,w.lightMapTransform)),v.aoMap&&(w.aoMap.value=v.aoMap,w.aoMapIntensity.value=v.aoMapIntensity,t(v.aoMap,w.aoMapTransform))}function o(w,v){w.diffuse.value.copy(v.color),w.opacity.value=v.opacity,v.map&&(w.map.value=v.map,t(v.map,w.mapTransform))}function a(w,v){w.dashSize.value=v.dashSize,w.totalSize.value=v.dashSize+v.gapSize,w.scale.value=v.scale}function l(w,v,T,S){w.diffuse.value.copy(v.color),w.opacity.value=v.opacity,w.size.value=v.size*T,w.scale.value=S*.5,v.map&&(w.map.value=v.map,t(v.map,w.uvTransform)),v.alphaMap&&(w.alphaMap.value=v.alphaMap,t(v.alphaMap,w.alphaMapTransform)),v.alphaTest>0&&(w.alphaTest.value=v.alphaTest)}function c(w,v){w.diffuse.value.copy(v.color),w.opacity.value=v.opacity,w.rotation.value=v.rotation,v.map&&(w.map.value=v.map,t(v.map,w.mapTransform)),v.alphaMap&&(w.alphaMap.value=v.alphaMap,t(v.alphaMap,w.alphaMapTransform)),v.alphaTest>0&&(w.alphaTest.value=v.alphaTest)}function u(w,v){w.specular.value.copy(v.specular),w.shininess.value=Math.max(v.shininess,1e-4)}function h(w,v){v.gradientMap&&(w.gradientMap.value=v.gradientMap)}function p(w,v){w.metalness.value=v.metalness,v.metalnessMap&&(w.metalnessMap.value=v.metalnessMap,t(v.metalnessMap,w.metalnessMapTransform)),w.roughness.value=v.roughness,v.roughnessMap&&(w.roughnessMap.value=v.roughnessMap,t(v.roughnessMap,w.roughnessMapTransform)),v.envMap&&(w.envMapIntensity.value=v.envMapIntensity)}function m(w,v,T){w.ior.value=v.ior,v.sheen>0&&(w.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),w.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(w.sheenColorMap.value=v.sheenColorMap,t(v.sheenColorMap,w.sheenColorMapTransform)),v.sheenRoughnessMap&&(w.sheenRoughnessMap.value=v.sheenRoughnessMap,t(v.sheenRoughnessMap,w.sheenRoughnessMapTransform))),v.clearcoat>0&&(w.clearcoat.value=v.clearcoat,w.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(w.clearcoatMap.value=v.clearcoatMap,t(v.clearcoatMap,w.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(w.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,t(v.clearcoatRoughnessMap,w.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(w.clearcoatNormalMap.value=v.clearcoatNormalMap,t(v.clearcoatNormalMap,w.clearcoatNormalMapTransform),w.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===fa&&w.clearcoatNormalScale.value.negate())),v.dispersion>0&&(w.dispersion.value=v.dispersion),v.iridescence>0&&(w.iridescence.value=v.iridescence,w.iridescenceIOR.value=v.iridescenceIOR,w.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],w.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(w.iridescenceMap.value=v.iridescenceMap,t(v.iridescenceMap,w.iridescenceMapTransform)),v.iridescenceThicknessMap&&(w.iridescenceThicknessMap.value=v.iridescenceThicknessMap,t(v.iridescenceThicknessMap,w.iridescenceThicknessMapTransform))),v.transmission>0&&(w.transmission.value=v.transmission,w.transmissionSamplerMap.value=T.texture,w.transmissionSamplerSize.value.set(T.width,T.height),v.transmissionMap&&(w.transmissionMap.value=v.transmissionMap,t(v.transmissionMap,w.transmissionMapTransform)),w.thickness.value=v.thickness,v.thicknessMap&&(w.thicknessMap.value=v.thicknessMap,t(v.thicknessMap,w.thicknessMapTransform)),w.attenuationDistance.value=v.attenuationDistance,w.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(w.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(w.anisotropyMap.value=v.anisotropyMap,t(v.anisotropyMap,w.anisotropyMapTransform))),w.specularIntensity.value=v.specularIntensity,w.specularColor.value.copy(v.specularColor),v.specularColorMap&&(w.specularColorMap.value=v.specularColorMap,t(v.specularColorMap,w.specularColorMapTransform)),v.specularIntensityMap&&(w.specularIntensityMap.value=v.specularIntensityMap,t(v.specularIntensityMap,w.specularIntensityMapTransform))}function y(w,v){v.matcap&&(w.matcap.value=v.matcap)}function b(w,v){const T=e.get(v).light;w.referencePosition.value.setFromMatrixPosition(T.matrixWorld),w.nearDistance.value=T.shadow.camera.near,w.farDistance.value=T.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function nOe(n,e,t,i){let r={},s={},o=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(T,S){const M=S.program;i.uniformBlockBinding(T,M)}function c(T,S){let M=r[T.id];M===void 0&&(y(T),M=u(T),r[T.id]=M,T.addEventListener("dispose",w));const P=S.program;i.updateUBOMapping(T,P);const R=e.render.frame;s[T.id]!==R&&(p(T),s[T.id]=R)}function u(T){const S=h();T.__bindingPointIndex=S;const M=n.createBuffer(),P=T.__size,R=T.usage;return n.bindBuffer(n.UNIFORM_BUFFER,M),n.bufferData(n.UNIFORM_BUFFER,P,R),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,S,M),M}function h(){for(let T=0;T<a;T++)if(o.indexOf(T)===-1)return o.push(T),T;return xn("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function p(T){const S=r[T.id],M=T.uniforms,P=T.__cache;n.bindBuffer(n.UNIFORM_BUFFER,S);for(let R=0,O=M.length;R<O;R++){const B=Array.isArray(M[R])?M[R]:[M[R]];for(let N=0,I=B.length;N<I;N++){const F=B[N];if(m(F,R,N,P)===!0){const j=F.__offset,W=Array.isArray(F.value)?F.value:[F.value];let U=0;for(let H=0;H<W.length;H++){const q=W[H],J=b(q);typeof q=="number"||typeof q=="boolean"?(F.__data[0]=q,n.bufferSubData(n.UNIFORM_BUFFER,j+U,F.__data)):q.isMatrix3?(F.__data[0]=q.elements[0],F.__data[1]=q.elements[1],F.__data[2]=q.elements[2],F.__data[3]=0,F.__data[4]=q.elements[3],F.__data[5]=q.elements[4],F.__data[6]=q.elements[5],F.__data[7]=0,F.__data[8]=q.elements[6],F.__data[9]=q.elements[7],F.__data[10]=q.elements[8],F.__data[11]=0):(q.toArray(F.__data,U),U+=J.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,j,F.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(T,S,M,P){const R=T.value,O=S+"_"+M;if(P[O]===void 0)return typeof R=="number"||typeof R=="boolean"?P[O]=R:P[O]=R.clone(),!0;{const B=P[O];if(typeof R=="number"||typeof R=="boolean"){if(B!==R)return P[O]=R,!0}else if(B.equals(R)===!1)return B.copy(R),!0}return!1}function y(T){const S=T.uniforms;let M=0;const P=16;for(let O=0,B=S.length;O<B;O++){const N=Array.isArray(S[O])?S[O]:[S[O]];for(let I=0,F=N.length;I<F;I++){const j=N[I],W=Array.isArray(j.value)?j.value:[j.value];for(let U=0,H=W.length;U<H;U++){const q=W[U],J=b(q),G=M%P,ee=G%J.boundary,Q=G+ee;M+=ee,Q!==0&&P-Q<J.storage&&(M+=P-Q),j.__data=new Float32Array(J.storage/Float32Array.BYTES_PER_ELEMENT),j.__offset=M,M+=J.storage}}}const R=M%P;return R>0&&(M+=P-R),T.__size=M,T.__cache={},this}function b(T){const S={boundary:0,storage:0};return typeof T=="number"||typeof T=="boolean"?(S.boundary=4,S.storage=4):T.isVector2?(S.boundary=8,S.storage=8):T.isVector3||T.isColor?(S.boundary=16,S.storage=12):T.isVector4?(S.boundary=16,S.storage=16):T.isMatrix3?(S.boundary=48,S.storage=48):T.isMatrix4?(S.boundary=64,S.storage=64):T.isTexture?Wt("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Wt("WebGLRenderer: Unsupported uniform value type.",T),S}function w(T){const S=T.target;S.removeEventListener("dispose",w);const M=o.indexOf(S.__bindingPointIndex);o.splice(M,1),n.deleteBuffer(r[S.id]),delete r[S.id],delete s[S.id]}function v(){for(const T in r)n.deleteBuffer(r[T]);o=[],r={},s={}}return{bind:l,update:c,dispose:v}}const iOe=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Pu=null;function rOe(){return Pu===null&&(Pu=new cu(iOe,16,16,n1,du),Pu.name="DFG_LUT",Pu.minFilter=mr,Pu.magFilter=mr,Pu.wrapS=Ga,Pu.wrapT=Ga,Pu.generateMipmaps=!1,Pu.needsUpdate=!0),Pu}class Lie{constructor(e={}){const{canvas:t=_ne(),context:i=null,depth:r=!0,stencil:s=!1,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:p=!1,outputBufferType:m=ca}=e;this.isWebGLRenderer=!0;let y;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=i.getContextAttributes().alpha}else y=o;const b=m,w=new Set([R9,M9,G_]),v=new Set([ca,bc,G2,W2,T9,A9]),T=new Uint32Array(4),S=new Int32Array(4);let M=null,P=null;const R=[],O=[];let B=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=pc,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const N=this;let I=!1;this._outputColorSpace=ka;let F=0,j=0,W=null,U=-1,H=null;const q=new fr,J=new fr;let G=null;const ee=new an(0);let Q=0,ne=t.width,fe=t.height,Ae=1,Pe=null,Ce=null;const de=new fr(0,0,ne,fe),Ne=new fr(0,0,ne,fe);let et=!1;const me=new vx;let nt=!1,Pt=!1;const zt=new Hn,Dt=new ye,gt=new fr,vt={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Oe=!1;function xt(){return W===null?Ae:1}let pe=i;function qe(ie,_e){return t.getContext(ie,_e)}try{const ie={alpha:!0,depth:r,stencil:s,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${_9}`),t.addEventListener("webglcontextlost",Gt,!1),t.addEventListener("webglcontextrestored",on,!1),t.addEventListener("webglcontextcreationerror",mn,!1),pe===null){const _e="webgl2";if(pe=qe(_e,ie),pe===null)throw qe(_e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ie){throw xn("WebGLRenderer: "+ie.message),ie}let $e,Xe,Ye,oe,Z,he,Ge,ct,tt,Lt,Ct,Ot,nn,Tt,Ve,ut,ue,Ie,ft,xe,pt,ge,Qe,ht;function at(){$e=new sLe(pe),$e.init(),ge=new kie(pe,$e),Xe=new Yke(pe,$e,e,ge),Ye=new qDe(pe,$e),Xe.reversedDepthBuffer&&p&&Ye.buffers.depth.setReversed(!0),oe=new lLe(pe),Z=new kDe,he=new ZDe(pe,$e,Ye,Z,Xe,ge,oe),Ge=new Qke(N),ct=new rLe(N),tt=new dNe(pe),Qe=new qke(pe,tt),Lt=new oLe(pe,tt,oe,Qe),Ct=new uLe(pe,Lt,tt,oe),ft=new cLe(pe,Xe,he),ut=new Xke(Z),Ot=new PDe(N,Ge,ct,$e,Xe,Qe,ut),nn=new tOe(N,Z),Tt=new DDe,Ve=new jDe($e),Ie=new Kke(N,Ge,ct,Ye,Ct,y,l),ue=new WDe(N,Ct,Xe),ht=new nOe(pe,oe,Xe,Ye),xe=new Zke(pe,$e,oe),pt=new aLe(pe,$e,oe),oe.programs=Ot.programs,N.capabilities=Xe,N.extensions=$e,N.properties=Z,N.renderLists=Tt,N.shadowMap=ue,N.state=Ye,N.info=oe}at(),b!==ca&&(B=new dLe(b,t.width,t.height,r,s));const yt=new JDe(N,pe);this.xr=yt,this.getContext=function(){return pe},this.getContextAttributes=function(){return pe.getContextAttributes()},this.forceContextLoss=function(){const ie=$e.get("WEBGL_lose_context");ie&&ie.loseContext()},this.forceContextRestore=function(){const ie=$e.get("WEBGL_lose_context");ie&&ie.restoreContext()},this.getPixelRatio=function(){return Ae},this.setPixelRatio=function(ie){ie!==void 0&&(Ae=ie,this.setSize(ne,fe,!1))},this.getSize=function(ie){return ie.set(ne,fe)},this.setSize=function(ie,_e,ke=!0){if(yt.isPresenting){Wt("WebGLRenderer: Can't change size while VR device is presenting.");return}ne=ie,fe=_e,t.width=Math.floor(ie*Ae),t.height=Math.floor(_e*Ae),ke===!0&&(t.style.width=ie+"px",t.style.height=_e+"px"),B!==null&&B.setSize(t.width,t.height),this.setViewport(0,0,ie,_e)},this.getDrawingBufferSize=function(ie){return ie.set(ne*Ae,fe*Ae).floor()},this.setDrawingBufferSize=function(ie,_e,ke){ne=ie,fe=_e,Ae=ke,t.width=Math.floor(ie*ke),t.height=Math.floor(_e*ke),this.setViewport(0,0,ie,_e)},this.setEffects=function(ie){if(b===ca){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(ie){for(let _e=0;_e<ie.length;_e++)if(ie[_e].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}B.setEffects(ie||[])},this.getCurrentViewport=function(ie){return ie.copy(q)},this.getViewport=function(ie){return ie.copy(de)},this.setViewport=function(ie,_e,ke,Re){ie.isVector4?de.set(ie.x,ie.y,ie.z,ie.w):de.set(ie,_e,ke,Re),Ye.viewport(q.copy(de).multiplyScalar(Ae).round())},this.getScissor=function(ie){return ie.copy(Ne)},this.setScissor=function(ie,_e,ke,Re){ie.isVector4?Ne.set(ie.x,ie.y,ie.z,ie.w):Ne.set(ie,_e,ke,Re),Ye.scissor(J.copy(Ne).multiplyScalar(Ae).round())},this.getScissorTest=function(){return et},this.setScissorTest=function(ie){Ye.setScissorTest(et=ie)},this.setOpaqueSort=function(ie){Pe=ie},this.setTransparentSort=function(ie){Ce=ie},this.getClearColor=function(ie){return ie.copy(Ie.getClearColor())},this.setClearColor=function(){Ie.setClearColor(...arguments)},this.getClearAlpha=function(){return Ie.getClearAlpha()},this.setClearAlpha=function(){Ie.setClearAlpha(...arguments)},this.clear=function(ie=!0,_e=!0,ke=!0){let Re=0;if(ie){let Te=!1;if(W!==null){const it=W.texture.format;Te=w.has(it)}if(Te){const it=W.texture.type,rt=v.has(it),we=Ie.getClearColor(),Ee=Ie.getClearAlpha(),De=we.r,Le=we.g,ae=we.b;rt?(T[0]=De,T[1]=Le,T[2]=ae,T[3]=Ee,pe.clearBufferuiv(pe.COLOR,0,T)):(S[0]=De,S[1]=Le,S[2]=ae,S[3]=Ee,pe.clearBufferiv(pe.COLOR,0,S))}else Re|=pe.COLOR_BUFFER_BIT}_e&&(Re|=pe.DEPTH_BUFFER_BIT),ke&&(Re|=pe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),pe.clear(Re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Gt,!1),t.removeEventListener("webglcontextrestored",on,!1),t.removeEventListener("webglcontextcreationerror",mn,!1),Ie.dispose(),Tt.dispose(),Ve.dispose(),Z.dispose(),Ge.dispose(),ct.dispose(),Ct.dispose(),Qe.dispose(),ht.dispose(),Ot.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",te),yt.removeEventListener("sessionend",z),le.stop()};function Gt(ie){ie.preventDefault(),Ub("WebGLRenderer: Context Lost."),I=!0}function on(){Ub("WebGLRenderer: Context Restored."),I=!1;const ie=oe.autoReset,_e=ue.enabled,ke=ue.autoUpdate,Re=ue.needsUpdate,Te=ue.type;at(),oe.autoReset=ie,ue.enabled=_e,ue.autoUpdate=ke,ue.needsUpdate=Re,ue.type=Te}function mn(ie){xn("WebGLRenderer: A WebGL context could not be created. Reason: ",ie.statusMessage)}function Cn(ie){const _e=ie.target;_e.removeEventListener("dispose",Cn),gi(_e)}function gi(ie){$r(ie),Z.remove(ie)}function $r(ie){const _e=Z.get(ie).programs;_e!==void 0&&(_e.forEach(function(ke){Ot.releaseProgram(ke)}),ie.isShaderMaterial&&Ot.releaseShaderCache(ie))}this.renderBufferDirect=function(ie,_e,ke,Re,Te,it){_e===null&&(_e=vt);const rt=Te.isMesh&&Te.matrixWorld.determinant()<0,we=Sn(ie,_e,ke,Re,Te);Ye.setMaterial(Re,rt);let Ee=ke.index,De=1;if(Re.wireframe===!0){if(Ee=Lt.getWireframeAttribute(ke),Ee===void 0)return;De=2}const Le=ke.drawRange,ae=ke.attributes.position;let be=Le.start*De,Ue=(Le.start+Le.count)*De;it!==null&&(be=Math.max(be,it.start*De),Ue=Math.min(Ue,(it.start+it.count)*De)),Ee!==null?(be=Math.max(be,0),Ue=Math.min(Ue,Ee.count)):ae!=null&&(be=Math.max(be,0),Ue=Math.min(Ue,ae.count));const We=Ue-be;if(We<0||We===1/0)return;Qe.setup(Te,Re,we,ke,Ee);let st,_t=xe;if(Ee!==null&&(st=tt.get(Ee),_t=pt,_t.setIndex(st)),Te.isMesh)Re.wireframe===!0?(Ye.setLineWidth(Re.wireframeLinewidth*xt()),_t.setMode(pe.LINES)):_t.setMode(pe.TRIANGLES);else if(Te.isLine){let ce=Re.linewidth;ce===void 0&&(ce=1),Ye.setLineWidth(ce*xt()),Te.isLineSegments?_t.setMode(pe.LINES):Te.isLineLoop?_t.setMode(pe.LINE_LOOP):_t.setMode(pe.LINE_STRIP)}else Te.isPoints?_t.setMode(pe.POINTS):Te.isSprite&&_t.setMode(pe.TRIANGLES);if(Te.isBatchedMesh)if(Te._multiDrawInstances!==null)q2("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),_t.renderMultiDrawInstances(Te._multiDrawStarts,Te._multiDrawCounts,Te._multiDrawCount,Te._multiDrawInstances);else if($e.get("WEBGL_multi_draw"))_t.renderMultiDraw(Te._multiDrawStarts,Te._multiDrawCounts,Te._multiDrawCount);else{const ce=Te._multiDrawStarts,Bt=Te._multiDrawCounts,Nt=Te._multiDrawCount,hn=Ee?tt.get(Ee).bytesPerElement:1,Rn=Z.get(Re).currentProgram.getUniforms();for(let gn=0;gn<Nt;gn++)Rn.setValue(pe,"_gl_DrawID",gn),_t.render(ce[gn]/hn,Bt[gn])}else if(Te.isInstancedMesh)_t.renderInstances(be,We,Te.count);else if(ke.isInstancedBufferGeometry){const ce=ke._maxInstanceCount!==void 0?ke._maxInstanceCount:1/0,Bt=Math.min(ke.instanceCount,ce);_t.renderInstances(be,We,Bt)}else _t.render(be,We)};function Il(ie,_e,ke){ie.transparent===!0&&ie.side===Yu&&ie.forceSinglePass===!1?(ie.side=fa,ie.needsUpdate=!0,Ht(ie,_e,ke),ie.side=Dd,ie.needsUpdate=!0,Ht(ie,_e,ke),ie.side=Yu):Ht(ie,_e,ke)}this.compile=function(ie,_e,ke=null){ke===null&&(ke=ie),P=Ve.get(ke),P.init(_e),O.push(P),ke.traverseVisible(function(Te){Te.isLight&&Te.layers.test(_e.layers)&&(P.pushLight(Te),Te.castShadow&&P.pushShadow(Te))}),ie!==ke&&ie.traverseVisible(function(Te){Te.isLight&&Te.layers.test(_e.layers)&&(P.pushLight(Te),Te.castShadow&&P.pushShadow(Te))}),P.setupLights();const Re=new Set;return ie.traverse(function(Te){if(!(Te.isMesh||Te.isPoints||Te.isLine||Te.isSprite))return;const it=Te.material;if(it)if(Array.isArray(it))for(let rt=0;rt<it.length;rt++){const we=it[rt];Il(we,ke,Te),Re.add(we)}else Il(it,ke,Te),Re.add(it)}),P=O.pop(),Re},this.compileAsync=function(ie,_e,ke=null){const Re=this.compile(ie,_e,ke);return new Promise(Te=>{function it(){if(Re.forEach(function(rt){Z.get(rt).currentProgram.isReady()&&Re.delete(rt)}),Re.size===0){Te(ie);return}setTimeout(it,10)}$e.get("KHR_parallel_shader_compile")!==null?it():setTimeout(it,10)})};let X=null;function se(ie){X&&X(ie)}function te(){le.stop()}function z(){le.start()}const le=new Mie;le.setAnimationLoop(se),typeof self<"u"&&le.setContext(self),this.setAnimationLoop=function(ie){X=ie,yt.setAnimationLoop(ie),ie===null?le.stop():le.start()},yt.addEventListener("sessionstart",te),yt.addEventListener("sessionend",z),this.render=function(ie,_e){if(_e!==void 0&&_e.isCamera!==!0){xn("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(I===!0)return;const ke=yt.enabled===!0&&yt.isPresenting===!0,Re=B!==null&&(W===null||ke)&&B.begin(N,W);if(ie.matrixWorldAutoUpdate===!0&&ie.updateMatrixWorld(),_e.parent===null&&_e.matrixWorldAutoUpdate===!0&&_e.updateMatrixWorld(),yt.enabled===!0&&yt.isPresenting===!0&&(B===null||B.isCompositing()===!1)&&(yt.cameraAutoUpdate===!0&&yt.updateCamera(_e),_e=yt.getCamera()),ie.isScene===!0&&ie.onBeforeRender(N,ie,_e,W),P=Ve.get(ie,O.length),P.init(_e),O.push(P),zt.multiplyMatrices(_e.projectionMatrix,_e.matrixWorldInverse),me.setFromProjectionMatrix(zt,Sl,_e.reversedDepth),Pt=this.localClippingEnabled,nt=ut.init(this.clippingPlanes,Pt),M=Tt.get(ie,R.length),M.init(),R.push(M),yt.enabled===!0&&yt.isPresenting===!0){const rt=N.xr.getDepthSensingMesh();rt!==null&&je(rt,_e,-1/0,N.sortObjects)}je(ie,_e,0,N.sortObjects),M.finish(),N.sortObjects===!0&&M.sort(Pe,Ce),Oe=yt.enabled===!1||yt.isPresenting===!1||yt.hasDepthSensing()===!1,Oe&&Ie.addToRenderList(M,ie),this.info.render.frame++,nt===!0&&ut.beginShadows();const Te=P.state.shadowsArray;if(ue.render(Te,ie,_e),nt===!0&&ut.endShadows(),this.info.autoReset===!0&&this.info.reset(),(Re&&B.hasRenderPass())===!1){const rt=M.opaque,we=M.transmissive;if(P.setupLights(),_e.isArrayCamera){const Ee=_e.cameras;if(we.length>0)for(let De=0,Le=Ee.length;De<Le;De++){const ae=Ee[De];St(rt,we,ie,ae)}Oe&&Ie.render(ie);for(let De=0,Le=Ee.length;De<Le;De++){const ae=Ee[De];Ke(M,ie,ae,ae.viewport)}}else we.length>0&&St(rt,we,ie,_e),Oe&&Ie.render(ie),Ke(M,ie,_e)}W!==null&&j===0&&(he.updateMultisampleRenderTarget(W),he.updateRenderTargetMipmap(W)),Re&&B.end(N),ie.isScene===!0&&ie.onAfterRender(N,ie,_e),Qe.resetDefaultState(),U=-1,H=null,O.pop(),O.length>0?(P=O[O.length-1],nt===!0&&ut.setGlobalState(N.clippingPlanes,P.state.camera)):P=null,R.pop(),R.length>0?M=R[R.length-1]:M=null};function je(ie,_e,ke,Re){if(ie.visible===!1)return;if(ie.layers.test(_e.layers)){if(ie.isGroup)ke=ie.renderOrder;else if(ie.isLOD)ie.autoUpdate===!0&&ie.update(_e);else if(ie.isLight)P.pushLight(ie),ie.castShadow&&P.pushShadow(ie);else if(ie.isSprite){if(!ie.frustumCulled||me.intersectsSprite(ie)){Re&&gt.setFromMatrixPosition(ie.matrixWorld).applyMatrix4(zt);const rt=Ct.update(ie),we=ie.material;we.visible&&M.push(ie,rt,we,ke,gt.z,null)}}else if((ie.isMesh||ie.isLine||ie.isPoints)&&(!ie.frustumCulled||me.intersectsObject(ie))){const rt=Ct.update(ie),we=ie.material;if(Re&&(ie.boundingSphere!==void 0?(ie.boundingSphere===null&&ie.computeBoundingSphere(),gt.copy(ie.boundingSphere.center)):(rt.boundingSphere===null&&rt.computeBoundingSphere(),gt.copy(rt.boundingSphere.center)),gt.applyMatrix4(ie.matrixWorld).applyMatrix4(zt)),Array.isArray(we)){const Ee=rt.groups;for(let De=0,Le=Ee.length;De<Le;De++){const ae=Ee[De],be=we[ae.materialIndex];be&&be.visible&&M.push(ie,rt,be,ke,gt.z,ae)}}else we.visible&&M.push(ie,rt,we,ke,gt.z,null)}}const it=ie.children;for(let rt=0,we=it.length;rt<we;rt++)je(it[rt],_e,ke,Re)}function Ke(ie,_e,ke,Re){const{opaque:Te,transmissive:it,transparent:rt}=ie;P.setupLightsView(ke),nt===!0&&ut.setGlobalState(N.clippingPlanes,ke),Re&&Ye.viewport(q.copy(Re)),Te.length>0&&It(Te,_e,ke),it.length>0&&It(it,_e,ke),rt.length>0&&It(rt,_e,ke),Ye.buffers.depth.setTest(!0),Ye.buffers.depth.setMask(!0),Ye.buffers.color.setMask(!0),Ye.setPolygonOffset(!1)}function St(ie,_e,ke,Re){if((ke.isScene===!0?ke.overrideMaterial:null)!==null)return;if(P.state.transmissionRenderTarget[Re.id]===void 0){const be=$e.has("EXT_color_buffer_half_float")||$e.has("EXT_color_buffer_float");P.state.transmissionRenderTarget[Re.id]=new Xa(1,1,{generateMipmaps:!0,type:be?du:ca,minFilter:th,samples:Xe.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:xi.workingColorSpace})}const it=P.state.transmissionRenderTarget[Re.id],rt=Re.viewport||q;it.setSize(rt.z*N.transmissionResolutionScale,rt.w*N.transmissionResolutionScale);const we=N.getRenderTarget(),Ee=N.getActiveCubeFace(),De=N.getActiveMipmapLevel();N.setRenderTarget(it),N.getClearColor(ee),Q=N.getClearAlpha(),Q<1&&N.setClearColor(16777215,.5),N.clear(),Oe&&Ie.render(ke);const Le=N.toneMapping;N.toneMapping=pc;const ae=Re.viewport;if(Re.viewport!==void 0&&(Re.viewport=void 0),P.setupLightsView(Re),nt===!0&&ut.setGlobalState(N.clippingPlanes,Re),It(ie,ke,Re),he.updateMultisampleRenderTarget(it),he.updateRenderTargetMipmap(it),$e.has("WEBGL_multisampled_render_to_texture")===!1){let be=!1;for(let Ue=0,We=_e.length;Ue<We;Ue++){const st=_e[Ue],{object:_t,geometry:ce,material:Bt,group:Nt}=st;if(Bt.side===Yu&&_t.layers.test(Re.layers)){const hn=Bt.side;Bt.side=fa,Bt.needsUpdate=!0,Yt(_t,ke,Re,ce,Bt,Nt),Bt.side=hn,Bt.needsUpdate=!0,be=!0}}be===!0&&(he.updateMultisampleRenderTarget(it),he.updateRenderTargetMipmap(it))}N.setRenderTarget(we,Ee,De),N.setClearColor(ee,Q),ae!==void 0&&(Re.viewport=ae),N.toneMapping=Le}function It(ie,_e,ke){const Re=_e.isScene===!0?_e.overrideMaterial:null;for(let Te=0,it=ie.length;Te<it;Te++){const rt=ie[Te],{object:we,geometry:Ee,group:De}=rt;let Le=rt.material;Le.allowOverride===!0&&Re!==null&&(Le=Re),we.layers.test(ke.layers)&&Yt(we,_e,ke,Ee,Le,De)}}function Yt(ie,_e,ke,Re,Te,it){ie.onBeforeRender(N,_e,ke,Re,Te,it),ie.modelViewMatrix.multiplyMatrices(ke.matrixWorldInverse,ie.matrixWorld),ie.normalMatrix.getNormalMatrix(ie.modelViewMatrix),Te.onBeforeRender(N,_e,ke,Re,ie,it),Te.transparent===!0&&Te.side===Yu&&Te.forceSinglePass===!1?(Te.side=fa,Te.needsUpdate=!0,N.renderBufferDirect(ke,_e,Re,Te,ie,it),Te.side=Dd,Te.needsUpdate=!0,N.renderBufferDirect(ke,_e,Re,Te,ie,it),Te.side=Yu):N.renderBufferDirect(ke,_e,Re,Te,ie,it),ie.onAfterRender(N,_e,ke,Re,Te,it)}function Ht(ie,_e,ke){_e.isScene!==!0&&(_e=vt);const Re=Z.get(ie),Te=P.state.lights,it=P.state.shadowsArray,rt=Te.state.version,we=Ot.getParameters(ie,Te.state,it,_e,ke),Ee=Ot.getProgramCacheKey(we);let De=Re.programs;Re.environment=ie.isMeshStandardMaterial?_e.environment:null,Re.fog=_e.fog,Re.envMap=(ie.isMeshStandardMaterial?ct:Ge).get(ie.envMap||Re.environment),Re.envMapRotation=Re.environment!==null&&ie.envMap===null?_e.environmentRotation:ie.envMapRotation,De===void 0&&(ie.addEventListener("dispose",Cn),De=new Map,Re.programs=De);let Le=De.get(Ee);if(Le!==void 0){if(Re.currentProgram===Le&&Re.lightsStateVersion===rt)return Kt(ie,we),Le}else we.uniforms=Ot.getUniforms(ie),ie.onBeforeCompile(we,N),Le=Ot.acquireProgram(we,Ee),De.set(Ee,Le),Re.uniforms=we.uniforms;const ae=Re.uniforms;return(!ie.isShaderMaterial&&!ie.isRawShaderMaterial||ie.clipping===!0)&&(ae.clippingPlanes=ut.uniform),Kt(ie,we),Re.needsLights=kn(ie),Re.lightsStateVersion=rt,Re.needsLights&&(ae.ambientLightColor.value=Te.state.ambient,ae.lightProbe.value=Te.state.probe,ae.directionalLights.value=Te.state.directional,ae.directionalLightShadows.value=Te.state.directionalShadow,ae.spotLights.value=Te.state.spot,ae.spotLightShadows.value=Te.state.spotShadow,ae.rectAreaLights.value=Te.state.rectArea,ae.ltc_1.value=Te.state.rectAreaLTC1,ae.ltc_2.value=Te.state.rectAreaLTC2,ae.pointLights.value=Te.state.point,ae.pointLightShadows.value=Te.state.pointShadow,ae.hemisphereLights.value=Te.state.hemi,ae.directionalShadowMap.value=Te.state.directionalShadowMap,ae.directionalShadowMatrix.value=Te.state.directionalShadowMatrix,ae.spotShadowMap.value=Te.state.spotShadowMap,ae.spotLightMatrix.value=Te.state.spotLightMatrix,ae.spotLightMap.value=Te.state.spotLightMap,ae.pointShadowMap.value=Te.state.pointShadowMap,ae.pointShadowMatrix.value=Te.state.pointShadowMatrix),Re.currentProgram=Le,Re.uniformsList=null,Le}function $n(ie){if(ie.uniformsList===null){const _e=ie.currentProgram.getUniforms();ie.uniformsList=VS.seqWithValue(_e.seq,ie.uniforms)}return ie.uniformsList}function Kt(ie,_e){const ke=Z.get(ie);ke.outputColorSpace=_e.outputColorSpace,ke.batching=_e.batching,ke.batchingColor=_e.batchingColor,ke.instancing=_e.instancing,ke.instancingColor=_e.instancingColor,ke.instancingMorph=_e.instancingMorph,ke.skinning=_e.skinning,ke.morphTargets=_e.morphTargets,ke.morphNormals=_e.morphNormals,ke.morphColors=_e.morphColors,ke.morphTargetsCount=_e.morphTargetsCount,ke.numClippingPlanes=_e.numClippingPlanes,ke.numIntersection=_e.numClipIntersection,ke.vertexAlphas=_e.vertexAlphas,ke.vertexTangents=_e.vertexTangents,ke.toneMapping=_e.toneMapping}function Sn(ie,_e,ke,Re,Te){_e.isScene!==!0&&(_e=vt),he.resetTextureUnits();const it=_e.fog,rt=Re.isMeshStandardMaterial?_e.environment:null,we=W===null?N.outputColorSpace:W.isXRRenderTarget===!0?W.texture.colorSpace:i1,Ee=(Re.isMeshStandardMaterial?ct:Ge).get(Re.envMap||rt),De=Re.vertexColors===!0&&!!ke.attributes.color&&ke.attributes.color.itemSize===4,Le=!!ke.attributes.tangent&&(!!Re.normalMap||Re.anisotropy>0),ae=!!ke.morphAttributes.position,be=!!ke.morphAttributes.normal,Ue=!!ke.morphAttributes.color;let We=pc;Re.toneMapped&&(W===null||W.isXRRenderTarget===!0)&&(We=N.toneMapping);const st=ke.morphAttributes.position||ke.morphAttributes.normal||ke.morphAttributes.color,_t=st!==void 0?st.length:0,ce=Z.get(Re),Bt=P.state.lights;if(nt===!0&&(Pt===!0||ie!==H)){const Fn=ie===H&&Re.id===U;ut.setState(Re,ie,Fn)}let Nt=!1;Re.version===ce.__version?(ce.needsLights&&ce.lightsStateVersion!==Bt.state.version||ce.outputColorSpace!==we||Te.isBatchedMesh&&ce.batching===!1||!Te.isBatchedMesh&&ce.batching===!0||Te.isBatchedMesh&&ce.batchingColor===!0&&Te.colorTexture===null||Te.isBatchedMesh&&ce.batchingColor===!1&&Te.colorTexture!==null||Te.isInstancedMesh&&ce.instancing===!1||!Te.isInstancedMesh&&ce.instancing===!0||Te.isSkinnedMesh&&ce.skinning===!1||!Te.isSkinnedMesh&&ce.skinning===!0||Te.isInstancedMesh&&ce.instancingColor===!0&&Te.instanceColor===null||Te.isInstancedMesh&&ce.instancingColor===!1&&Te.instanceColor!==null||Te.isInstancedMesh&&ce.instancingMorph===!0&&Te.morphTexture===null||Te.isInstancedMesh&&ce.instancingMorph===!1&&Te.morphTexture!==null||ce.envMap!==Ee||Re.fog===!0&&ce.fog!==it||ce.numClippingPlanes!==void 0&&(ce.numClippingPlanes!==ut.numPlanes||ce.numIntersection!==ut.numIntersection)||ce.vertexAlphas!==De||ce.vertexTangents!==Le||ce.morphTargets!==ae||ce.morphNormals!==be||ce.morphColors!==Ue||ce.toneMapping!==We||ce.morphTargetsCount!==_t)&&(Nt=!0):(Nt=!0,ce.__version=Re.version);let hn=ce.currentProgram;Nt===!0&&(hn=Ht(Re,_e,Te));let Rn=!1,gn=!1,fn=!1;const pn=hn.getUniforms(),En=ce.uniforms;if(Ye.useProgram(hn.program)&&(Rn=!0,gn=!0,fn=!0),Re.id!==U&&(U=Re.id,gn=!0),Rn||H!==ie){Ye.buffers.depth.getReversed()&&ie.reversedDepth!==!0&&(ie._reversedDepth=!0,ie.updateProjectionMatrix()),pn.setValue(pe,"projectionMatrix",ie.projectionMatrix),pn.setValue(pe,"viewMatrix",ie.matrixWorldInverse);const zn=pn.map.cameraPosition;zn!==void 0&&zn.setValue(pe,Dt.setFromMatrixPosition(ie.matrixWorld)),Xe.logarithmicDepthBuffer&&pn.setValue(pe,"logDepthBufFC",2/(Math.log(ie.far+1)/Math.LN2)),(Re.isMeshPhongMaterial||Re.isMeshToonMaterial||Re.isMeshLambertMaterial||Re.isMeshBasicMaterial||Re.isMeshStandardMaterial||Re.isShaderMaterial)&&pn.setValue(pe,"isOrthographic",ie.isOrthographicCamera===!0),H!==ie&&(H=ie,gn=!0,fn=!0)}if(ce.needsLights&&(Bt.state.directionalShadowMap.length>0&&pn.setValue(pe,"directionalShadowMap",Bt.state.directionalShadowMap,he),Bt.state.spotShadowMap.length>0&&pn.setValue(pe,"spotShadowMap",Bt.state.spotShadowMap,he),Bt.state.pointShadowMap.length>0&&pn.setValue(pe,"pointShadowMap",Bt.state.pointShadowMap,he)),Te.isSkinnedMesh){pn.setOptional(pe,Te,"bindMatrix"),pn.setOptional(pe,Te,"bindMatrixInverse");const Fn=Te.skeleton;Fn&&(Fn.boneTexture===null&&Fn.computeBoneTexture(),pn.setValue(pe,"boneTexture",Fn.boneTexture,he))}Te.isBatchedMesh&&(pn.setOptional(pe,Te,"batchingTexture"),pn.setValue(pe,"batchingTexture",Te._matricesTexture,he),pn.setOptional(pe,Te,"batchingIdTexture"),pn.setValue(pe,"batchingIdTexture",Te._indirectTexture,he),pn.setOptional(pe,Te,"batchingColorTexture"),Te._colorsTexture!==null&&pn.setValue(pe,"batchingColorTexture",Te._colorsTexture,he));const Un=ke.morphAttributes;if((Un.position!==void 0||Un.normal!==void 0||Un.color!==void 0)&&ft.update(Te,ke,hn),(gn||ce.receiveShadow!==Te.receiveShadow)&&(ce.receiveShadow=Te.receiveShadow,pn.setValue(pe,"receiveShadow",Te.receiveShadow)),Re.isMeshGouraudMaterial&&Re.envMap!==null&&(En.envMap.value=Ee,En.flipEnvMap.value=Ee.isCubeTexture&&Ee.isRenderTargetTexture===!1?-1:1),Re.isMeshStandardMaterial&&Re.envMap===null&&_e.environment!==null&&(En.envMapIntensity.value=_e.environmentIntensity),En.dfgLUT!==void 0&&(En.dfgLUT.value=rOe()),gn&&(pn.setValue(pe,"toneMappingExposure",N.toneMappingExposure),ce.needsLights&&Mn(En,fn),it&&Re.fog===!0&&nn.refreshFogUniforms(En,it),nn.refreshMaterialUniforms(En,Re,Ae,fe,P.state.transmissionRenderTarget[ie.id]),VS.upload(pe,$n(ce),En,he)),Re.isShaderMaterial&&Re.uniformsNeedUpdate===!0&&(VS.upload(pe,$n(ce),En,he),Re.uniformsNeedUpdate=!1),Re.isSpriteMaterial&&pn.setValue(pe,"center",Te.center),pn.setValue(pe,"modelViewMatrix",Te.modelViewMatrix),pn.setValue(pe,"normalMatrix",Te.normalMatrix),pn.setValue(pe,"modelMatrix",Te.matrixWorld),Re.isShaderMaterial||Re.isRawShaderMaterial){const Fn=Re.uniformsGroups;for(let zn=0,Zi=Fn.length;zn<Zi;zn++){const Ni=Fn[zn];ht.update(Ni,hn),ht.bind(Ni,hn)}}return hn}function Mn(ie,_e){ie.ambientLightColor.needsUpdate=_e,ie.lightProbe.needsUpdate=_e,ie.directionalLights.needsUpdate=_e,ie.directionalLightShadows.needsUpdate=_e,ie.pointLights.needsUpdate=_e,ie.pointLightShadows.needsUpdate=_e,ie.spotLights.needsUpdate=_e,ie.spotLightShadows.needsUpdate=_e,ie.rectAreaLights.needsUpdate=_e,ie.hemisphereLights.needsUpdate=_e}function kn(ie){return ie.isMeshLambertMaterial||ie.isMeshToonMaterial||ie.isMeshPhongMaterial||ie.isMeshStandardMaterial||ie.isShadowMaterial||ie.isShaderMaterial&&ie.lights===!0}this.getActiveCubeFace=function(){return F},this.getActiveMipmapLevel=function(){return j},this.getRenderTarget=function(){return W},this.setRenderTargetTextures=function(ie,_e,ke){const Re=Z.get(ie);Re.__autoAllocateDepthBuffer=ie.resolveDepthBuffer===!1,Re.__autoAllocateDepthBuffer===!1&&(Re.__useRenderToTexture=!1),Z.get(ie.texture).__webglTexture=_e,Z.get(ie.depthTexture).__webglTexture=Re.__autoAllocateDepthBuffer?void 0:ke,Re.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(ie,_e){const ke=Z.get(ie);ke.__webglFramebuffer=_e,ke.__useDefaultFramebuffer=_e===void 0};const Ln=pe.createFramebuffer();this.setRenderTarget=function(ie,_e=0,ke=0){W=ie,F=_e,j=ke;let Re=null,Te=!1,it=!1;if(ie){const we=Z.get(ie);if(we.__useDefaultFramebuffer!==void 0){Ye.bindFramebuffer(pe.FRAMEBUFFER,we.__webglFramebuffer),q.copy(ie.viewport),J.copy(ie.scissor),G=ie.scissorTest,Ye.viewport(q),Ye.scissor(J),Ye.setScissorTest(G),U=-1;return}else if(we.__webglFramebuffer===void 0)he.setupRenderTarget(ie);else if(we.__hasExternalTextures)he.rebindTextures(ie,Z.get(ie.texture).__webglTexture,Z.get(ie.depthTexture).__webglTexture);else if(ie.depthBuffer){const Le=ie.depthTexture;if(we.__boundDepthTexture!==Le){if(Le!==null&&Z.has(Le)&&(ie.width!==Le.image.width||ie.height!==Le.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");he.setupDepthRenderbuffer(ie)}}const Ee=ie.texture;(Ee.isData3DTexture||Ee.isDataArrayTexture||Ee.isCompressedArrayTexture)&&(it=!0);const De=Z.get(ie).__webglFramebuffer;ie.isWebGLCubeRenderTarget?(Array.isArray(De[_e])?Re=De[_e][ke]:Re=De[_e],Te=!0):ie.samples>0&&he.useMultisampledRTT(ie)===!1?Re=Z.get(ie).__webglMultisampledFramebuffer:Array.isArray(De)?Re=De[ke]:Re=De,q.copy(ie.viewport),J.copy(ie.scissor),G=ie.scissorTest}else q.copy(de).multiplyScalar(Ae).floor(),J.copy(Ne).multiplyScalar(Ae).floor(),G=et;if(ke!==0&&(Re=Ln),Ye.bindFramebuffer(pe.FRAMEBUFFER,Re)&&Ye.drawBuffers(ie,Re),Ye.viewport(q),Ye.scissor(J),Ye.setScissorTest(G),Te){const we=Z.get(ie.texture);pe.framebufferTexture2D(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_CUBE_MAP_POSITIVE_X+_e,we.__webglTexture,ke)}else if(it){const we=_e;for(let Ee=0;Ee<ie.textures.length;Ee++){const De=Z.get(ie.textures[Ee]);pe.framebufferTextureLayer(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0+Ee,De.__webglTexture,ke,we)}}else if(ie!==null&&ke!==0){const we=Z.get(ie.texture);pe.framebufferTexture2D(pe.FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_2D,we.__webglTexture,ke)}U=-1},this.readRenderTargetPixels=function(ie,_e,ke,Re,Te,it,rt,we=0){if(!(ie&&ie.isWebGLRenderTarget)){xn("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ee=Z.get(ie).__webglFramebuffer;if(ie.isWebGLCubeRenderTarget&&rt!==void 0&&(Ee=Ee[rt]),Ee){Ye.bindFramebuffer(pe.FRAMEBUFFER,Ee);try{const De=ie.textures[we],Le=De.format,ae=De.type;if(!Xe.textureFormatReadable(Le)){xn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Xe.textureTypeReadable(ae)){xn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}_e>=0&&_e<=ie.width-Re&&ke>=0&&ke<=ie.height-Te&&(ie.textures.length>1&&pe.readBuffer(pe.COLOR_ATTACHMENT0+we),pe.readPixels(_e,ke,Re,Te,ge.convert(Le),ge.convert(ae),it))}finally{const De=W!==null?Z.get(W).__webglFramebuffer:null;Ye.bindFramebuffer(pe.FRAMEBUFFER,De)}}},this.readRenderTargetPixelsAsync=async function(ie,_e,ke,Re,Te,it,rt,we=0){if(!(ie&&ie.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ee=Z.get(ie).__webglFramebuffer;if(ie.isWebGLCubeRenderTarget&&rt!==void 0&&(Ee=Ee[rt]),Ee)if(_e>=0&&_e<=ie.width-Re&&ke>=0&&ke<=ie.height-Te){Ye.bindFramebuffer(pe.FRAMEBUFFER,Ee);const De=ie.textures[we],Le=De.format,ae=De.type;if(!Xe.textureFormatReadable(Le))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Xe.textureTypeReadable(ae))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const be=pe.createBuffer();pe.bindBuffer(pe.PIXEL_PACK_BUFFER,be),pe.bufferData(pe.PIXEL_PACK_BUFFER,it.byteLength,pe.STREAM_READ),ie.textures.length>1&&pe.readBuffer(pe.COLOR_ATTACHMENT0+we),pe.readPixels(_e,ke,Re,Te,ge.convert(Le),ge.convert(ae),0);const Ue=W!==null?Z.get(W).__webglFramebuffer:null;Ye.bindFramebuffer(pe.FRAMEBUFFER,Ue);const We=pe.fenceSync(pe.SYNC_GPU_COMMANDS_COMPLETE,0);return pe.flush(),await fMe(pe,We,4),pe.bindBuffer(pe.PIXEL_PACK_BUFFER,be),pe.getBufferSubData(pe.PIXEL_PACK_BUFFER,0,it),pe.deleteBuffer(be),pe.deleteSync(We),it}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(ie,_e=null,ke=0){const Re=Math.pow(2,-ke),Te=Math.floor(ie.image.width*Re),it=Math.floor(ie.image.height*Re),rt=_e!==null?_e.x:0,we=_e!==null?_e.y:0;he.setTexture2D(ie,0),pe.copyTexSubImage2D(pe.TEXTURE_2D,ke,0,0,rt,we,Te,it),Ye.unbindTexture()};const vn=pe.createFramebuffer(),bn=pe.createFramebuffer();this.copyTextureToTexture=function(ie,_e,ke=null,Re=null,Te=0,it=null){it===null&&(Te!==0?(q2("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),it=Te,Te=0):it=0);let rt,we,Ee,De,Le,ae,be,Ue,We;const st=ie.isCompressedTexture?ie.mipmaps[it]:ie.image;if(ke!==null)rt=ke.max.x-ke.min.x,we=ke.max.y-ke.min.y,Ee=ke.isBox3?ke.max.z-ke.min.z:1,De=ke.min.x,Le=ke.min.y,ae=ke.isBox3?ke.min.z:0;else{const Un=Math.pow(2,-Te);rt=Math.floor(st.width*Un),we=Math.floor(st.height*Un),ie.isDataArrayTexture?Ee=st.depth:ie.isData3DTexture?Ee=Math.floor(st.depth*Un):Ee=1,De=0,Le=0,ae=0}Re!==null?(be=Re.x,Ue=Re.y,We=Re.z):(be=0,Ue=0,We=0);const _t=ge.convert(_e.format),ce=ge.convert(_e.type);let Bt;_e.isData3DTexture?(he.setTexture3D(_e,0),Bt=pe.TEXTURE_3D):_e.isDataArrayTexture||_e.isCompressedArrayTexture?(he.setTexture2DArray(_e,0),Bt=pe.TEXTURE_2D_ARRAY):(he.setTexture2D(_e,0),Bt=pe.TEXTURE_2D),pe.pixelStorei(pe.UNPACK_FLIP_Y_WEBGL,_e.flipY),pe.pixelStorei(pe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,_e.premultiplyAlpha),pe.pixelStorei(pe.UNPACK_ALIGNMENT,_e.unpackAlignment);const Nt=pe.getParameter(pe.UNPACK_ROW_LENGTH),hn=pe.getParameter(pe.UNPACK_IMAGE_HEIGHT),Rn=pe.getParameter(pe.UNPACK_SKIP_PIXELS),gn=pe.getParameter(pe.UNPACK_SKIP_ROWS),fn=pe.getParameter(pe.UNPACK_SKIP_IMAGES);pe.pixelStorei(pe.UNPACK_ROW_LENGTH,st.width),pe.pixelStorei(pe.UNPACK_IMAGE_HEIGHT,st.height),pe.pixelStorei(pe.UNPACK_SKIP_PIXELS,De),pe.pixelStorei(pe.UNPACK_SKIP_ROWS,Le),pe.pixelStorei(pe.UNPACK_SKIP_IMAGES,ae);const pn=ie.isDataArrayTexture||ie.isData3DTexture,En=_e.isDataArrayTexture||_e.isData3DTexture;if(ie.isDepthTexture){const Un=Z.get(ie),Fn=Z.get(_e),zn=Z.get(Un.__renderTarget),Zi=Z.get(Fn.__renderTarget);Ye.bindFramebuffer(pe.READ_FRAMEBUFFER,zn.__webglFramebuffer),Ye.bindFramebuffer(pe.DRAW_FRAMEBUFFER,Zi.__webglFramebuffer);for(let Ni=0;Ni<Ee;Ni++)pn&&(pe.framebufferTextureLayer(pe.READ_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,Z.get(ie).__webglTexture,Te,ae+Ni),pe.framebufferTextureLayer(pe.DRAW_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,Z.get(_e).__webglTexture,it,We+Ni)),pe.blitFramebuffer(De,Le,rt,we,be,Ue,rt,we,pe.DEPTH_BUFFER_BIT,pe.NEAREST);Ye.bindFramebuffer(pe.READ_FRAMEBUFFER,null),Ye.bindFramebuffer(pe.DRAW_FRAMEBUFFER,null)}else if(Te!==0||ie.isRenderTargetTexture||Z.has(ie)){const Un=Z.get(ie),Fn=Z.get(_e);Ye.bindFramebuffer(pe.READ_FRAMEBUFFER,vn),Ye.bindFramebuffer(pe.DRAW_FRAMEBUFFER,bn);for(let zn=0;zn<Ee;zn++)pn?pe.framebufferTextureLayer(pe.READ_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,Un.__webglTexture,Te,ae+zn):pe.framebufferTexture2D(pe.READ_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_2D,Un.__webglTexture,Te),En?pe.framebufferTextureLayer(pe.DRAW_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,Fn.__webglTexture,it,We+zn):pe.framebufferTexture2D(pe.DRAW_FRAMEBUFFER,pe.COLOR_ATTACHMENT0,pe.TEXTURE_2D,Fn.__webglTexture,it),Te!==0?pe.blitFramebuffer(De,Le,rt,we,be,Ue,rt,we,pe.COLOR_BUFFER_BIT,pe.NEAREST):En?pe.copyTexSubImage3D(Bt,it,be,Ue,We+zn,De,Le,rt,we):pe.copyTexSubImage2D(Bt,it,be,Ue,De,Le,rt,we);Ye.bindFramebuffer(pe.READ_FRAMEBUFFER,null),Ye.bindFramebuffer(pe.DRAW_FRAMEBUFFER,null)}else En?ie.isDataTexture||ie.isData3DTexture?pe.texSubImage3D(Bt,it,be,Ue,We,rt,we,Ee,_t,ce,st.data):_e.isCompressedArrayTexture?pe.compressedTexSubImage3D(Bt,it,be,Ue,We,rt,we,Ee,_t,st.data):pe.texSubImage3D(Bt,it,be,Ue,We,rt,we,Ee,_t,ce,st):ie.isDataTexture?pe.texSubImage2D(pe.TEXTURE_2D,it,be,Ue,rt,we,_t,ce,st.data):ie.isCompressedTexture?pe.compressedTexSubImage2D(pe.TEXTURE_2D,it,be,Ue,st.width,st.height,_t,st.data):pe.texSubImage2D(pe.TEXTURE_2D,it,be,Ue,rt,we,_t,ce,st);pe.pixelStorei(pe.UNPACK_ROW_LENGTH,Nt),pe.pixelStorei(pe.UNPACK_IMAGE_HEIGHT,hn),pe.pixelStorei(pe.UNPACK_SKIP_PIXELS,Rn),pe.pixelStorei(pe.UNPACK_SKIP_ROWS,gn),pe.pixelStorei(pe.UNPACK_SKIP_IMAGES,fn),it===0&&_e.generateMipmaps&&pe.generateMipmap(Bt),Ye.unbindTexture()},this.initRenderTarget=function(ie){Z.get(ie).__webglFramebuffer===void 0&&he.setupRenderTarget(ie)},this.initTexture=function(ie){ie.isCubeTexture?he.setTextureCube(ie,0):ie.isData3DTexture?he.setTexture3D(ie,0):ie.isDataArrayTexture||ie.isCompressedArrayTexture?he.setTexture2DArray(ie,0):he.setTexture2D(ie,0),Ye.unbindTexture()},this.resetState=function(){F=0,j=0,W=null,Ye.reset(),Qe.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Sl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=xi._getDrawingBufferColorSpace(e),t.unpackColorSpace=xi._getUnpackColorSpace()}}const sOe=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:w9,AddEquation:$f,AddOperation:one,AdditiveAnimationBlendMode:OD,AdditiveBlending:IN,AgXToneMapping:CD,AlphaFormat:LD,AlwaysCompare:xne,AlwaysDepth:k8,AlwaysStencilFunc:LN,AmbientLight:yie,AnimationAction:Tie,AnimationClip:$b,AnimationLoader:iIe,AnimationMixer:PIe,AnimationObjectGroup:IIe,AnimationUtils:JRe,ArcCurve:Hne,ArrayCamera:wie,ArrowHelper:iNe,AttachedBindMode:kN,Audio:Sie,AudioAnalyser:bIe,AudioContext:uO,AudioListener:yIe,AudioLoader:pIe,AxesHelper:rNe,BackSide:fa,BasicDepthPacking:hne,BasicShadowMap:zte,BatchedMesh:Bne,Bone:$D,BooleanKeyframeTrack:A1,Box2:jIe,Box3:Fo,Box3Helper:tNe,BoxGeometry:T1,BoxHelper:eNe,BufferAttribute:lr,BufferGeometry:Jn,BufferGeometryLoader:_ie,ByteType:ID,Cache:nh,Camera:W_,CameraHelper:JIe,CanvasTexture:wRe,CapsuleGeometry:j9,CatmullRomCurve3:$ne,CineonToneMapping:TD,CircleGeometry:V9,ClampToEdgeWrapping:Ga,Clock:hO,Color:an,ColorKeyframeTrack:oO,ColorManagement:xi,CompressedArrayTexture:bRe,CompressedCubeTexture:_Re,CompressedTexture:z9,CompressedTextureLoader:rIe,ConeGeometry:Z_,ConstantAlphaFactor:ine,ConstantColorFactor:tne,Controls:oNe,CubeCamera:Nne,CubeDepthTexture:jne,CubeReflectionMapping:fh,CubeRefractionMapping:L0,CubeTexture:K_,CubeTextureLoader:sIe,CubeUVReflectionMapping:xx,CubicBezierCurve:qD,CubicBezierCurve3:Gne,CubicInterpolant:cie,CullFaceBack:RN,CullFaceFront:Fte,CullFaceFrontBack:SCe,CullFaceNone:Ute,Curve:gu,CurvePath:Kne,CustomBlending:jte,CustomToneMapping:AD,CylinderGeometry:q_,Cylindrical:zIe,Data3DTexture:L9,DataArrayTexture:k9,DataTexture:cu,DataTextureLoader:oIe,DataUtils:GMe,DecrementStencilOp:jCe,DecrementWrapStencilOp:HCe,DefaultLoadingManager:die,DepthFormat:ph,DepthStencilFormat:i0,DepthTexture:s1,DetachedBindMode:ane,DirectionalLight:gie,DirectionalLightHelper:QIe,DiscreteInterpolant:uie,DodecahedronGeometry:H9,DoubleSide:Yu,DstAlphaFactor:Yte,DstColorFactor:Qte,DynamicCopyUsage:rMe,DynamicDrawUsage:QCe,DynamicReadUsage:tMe,EdgesGeometry:Vne,EllipseCurve:$9,EqualCompare:mne,EqualDepth:D8,EqualStencilFunc:KCe,EquirectangularReflectionMapping:Rb,EquirectangularRefractionMapping:Ib,Euler:fu,EventDispatcher:xh,ExternalTexture:WD,ExtrudeGeometry:G9,FileLoader:Od,Float16BufferAttribute:QMe,Float32BufferAttribute:un,FloatType:Do,Fog:O9,FogExp2:D9,FramebufferTexture:vRe,FrontSide:Dd,Frustum:vx,FrustumArray:F9,GLBufferAttribute:BIe,GLSL1:oMe,GLSL3:DN,GreaterCompare:gne,GreaterDepth:B8,GreaterEqualCompare:P9,GreaterEqualDepth:O8,GreaterEqualStencilFunc:XCe,GreaterStencilFunc:ZCe,GridHelper:YIe,Group:fy,HalfFloatType:du,HemisphereLight:fie,HemisphereLightHelper:ZIe,IcosahedronGeometry:W9,ImageBitmapLoader:fIe,ImageLoader:Gb,ImageUtils:Tne,IncrementStencilOp:zCe,IncrementWrapStencilOp:VCe,InstancedBufferAttribute:X2,InstancedBufferGeometry:bie,InstancedInterleavedBuffer:OIe,InstancedMesh:One,Int16BufferAttribute:YMe,Int32BufferAttribute:XMe,Int8BufferAttribute:KMe,IntType:E9,InterleavedBuffer:B9,InterleavedBufferAttribute:r1,Interpolant:X_,InterpolateDiscrete:kb,InterpolateLinear:yE,InterpolateSmooth:US,InterpolationSamplingMode:cMe,InterpolationSamplingType:lMe,InvertStencilOp:$Ce,KeepStencilOp:Kp,KeyframeTrack:Sc,LOD:Lne,LatheGeometry:K9,Layers:Dm,LessCompare:pne,LessDepth:L8,LessEqualCompare:N9,LessEqualDepth:t1,LessEqualStencilFunc:qCe,LessStencilFunc:WCe,Light:Y0,LightProbe:vie,Line:O0,Line3:$Ie,LineBasicMaterial:ya,LineCurve:ZD,LineCurve3:Wne,LineDashedMaterial:aie,LineLoop:Une,LineSegments:vh,LinearFilter:mr,LinearInterpolant:sO,LinearMipMapLinearFilter:CCe,LinearMipMapNearestFilter:ACe,LinearMipmapLinearFilter:th,LinearMipmapNearestFilter:M3,LinearSRGBColorSpace:i1,LinearToneMapping:SD,LinearTransfer:Db,Loader:el,LoaderUtils:jN,LoadingManager:aO,LoopOnce:lne,LoopPingPong:une,LoopRepeat:cne,MOUSE:Gp,Material:Go,MaterialLoader:eT,MathUtils:IMe,Matrix2:mO,Matrix3:ti,Matrix4:Hn,MaxEquation:Gte,Mesh:xs,MeshBasicMaterial:q0,MeshDepthMaterial:nO,MeshDistanceMaterial:iO,MeshLambertMaterial:sie,MeshMatcapMaterial:oie,MeshNormalMaterial:rie,MeshPhongMaterial:nie,MeshPhysicalMaterial:tie,MeshStandardMaterial:tO,MeshToonMaterial:iie,MinEquation:$te,MirroredRepeatWrapping:Pb,MixOperation:sne,MultiplyBlending:PN,MultiplyOperation:$_,NearestFilter:is,NearestMipMapLinearFilter:TCe,NearestMipMapNearestFilter:ECe,NearestMipmapLinearFilter:hy,NearestMipmapNearestFilter:RD,NeutralToneMapping:MD,NeverCompare:fne,NeverDepth:P8,NeverStencilFunc:GCe,NoBlending:ah,NoColorSpace:hd,NoNormalPacking:DCe,NoToneMapping:pc,NormalAnimationBlendMode:I9,NormalBlending:km,NormalGAPacking:BCe,NormalRGPacking:OCe,NotEqualCompare:yne,NotEqualDepth:U8,NotEqualStencilFunc:YCe,NumberKeyframeTrack:Vb,Object3D:Qi,ObjectLoader:hIe,ObjectSpaceNormalMap:dne,OctahedronGeometry:Y_,OneFactor:Kte,OneMinusConstantAlphaFactor:rne,OneMinusConstantColorFactor:nne,OneMinusDstAlphaFactor:Xte,OneMinusDstColorFactor:Jte,OneMinusSrcAlphaFactor:N8,OneMinusSrcColorFactor:Zte,OrthographicCamera:Cd,PCFShadowMap:ky,PCFSoftShadowMap:C3,PMREMGenerator:GN,Path:_E,PerspectiveCamera:ns,Plane:rd,PlaneGeometry:bx,PlaneHelper:nNe,PointLight:mie,PointLightHelper:KIe,Points:Fne,PointsMaterial:GD,PolarGridHelper:XIe,PolyhedronGeometry:Z0,PositionalAudio:vIe,PropertyBinding:Ci,PropertyMixer:Eie,QuadraticBezierCurve:YD,QuadraticBezierCurve3:XD,Quaternion:Uo,QuaternionKeyframeTrack:Q_,QuaternionLinearInterpolant:hie,R11_EAC_Format:W8,RED_GREEN_RGTC2_Format:mE,RED_RGTC1_Format:fE,REVISION:_9,RG11_EAC_Format:q8,RGBADepthPacking:PCe,RGBAFormat:Oo,RGBAIntegerFormat:R9,RGBA_ASTC_10x10_Format:aE,RGBA_ASTC_10x5_Format:rE,RGBA_ASTC_10x6_Format:sE,RGBA_ASTC_10x8_Format:oE,RGBA_ASTC_12x10_Format:lE,RGBA_ASTC_12x12_Format:cE,RGBA_ASTC_4x4_Format:Y8,RGBA_ASTC_5x4_Format:X8,RGBA_ASTC_5x5_Format:Q8,RGBA_ASTC_6x5_Format:J8,RGBA_ASTC_6x6_Format:eE,RGBA_ASTC_8x5_Format:tE,RGBA_ASTC_8x6_Format:nE,RGBA_ASTC_8x8_Format:iE,RGBA_BPTC_Format:uE,RGBA_ETC2_EAC_Format:G8,RGBA_PVRTC_2BPPV1_Format:V8,RGBA_PVRTC_4BPPV1_Format:j8,RGBA_S3TC_DXT1_Format:I3,RGBA_S3TC_DXT3_Format:N3,RGBA_S3TC_DXT5_Format:P3,RGBDepthPacking:kCe,RGBFormat:DD,RGBIntegerFormat:MCe,RGB_BPTC_SIGNED_Format:hE,RGB_BPTC_UNSIGNED_Format:dE,RGB_ETC1_Format:H8,RGB_ETC2_Format:$8,RGB_PVRTC_2BPPV1_Format:z8,RGB_PVRTC_4BPPV1_Format:F8,RGB_S3TC_DXT1_Format:R3,RGDepthPacking:LCe,RGFormat:n1,RGIntegerFormat:M9,RawShaderMaterial:eO,Ray:E1,Raycaster:Aie,RectAreaLight:xie,RedFormat:C9,RedIntegerFormat:G_,ReinhardToneMapping:ED,RenderTarget:UD,RenderTarget3D:kIe,RepeatWrapping:Nb,ReplaceStencilOp:FCe,ReverseSubtractEquation:Hte,RingGeometry:q9,SIGNED_R11_EAC_Format:K8,SIGNED_RED_GREEN_RGTC2_Format:gE,SIGNED_RED_RGTC1_Format:pE,SIGNED_RG11_EAC_Format:Z8,SRGBColorSpace:ka,SRGBTransfer:Gi,Scene:VD,ShaderChunk:ei,ShaderLib:Xc,ShaderMaterial:_c,ShadowMaterial:eie,Shape:Om,ShapeGeometry:Z9,ShapePath:sNe,ShapeUtils:iu,ShortType:ND,Skeleton:U9,SkeletonHelper:WIe,SkinnedMesh:Dne,Source:r0,Sphere:ro,SphereGeometry:JD,Spherical:HN,SphericalHarmonics3:cO,SplineCurve:QD,SpotLight:pie,SpotLightHelper:GIe,Sprite:kne,SpriteMaterial:HD,SrcAlphaFactor:I8,SrcAlphaSaturateFactor:ene,SrcColorFactor:qte,StaticCopyUsage:iMe,StaticDrawUsage:Ob,StaticReadUsage:eMe,StereoCamera:mIe,StreamCopyUsage:sMe,StreamDrawUsage:JCe,StreamReadUsage:nMe,StringKeyframeTrack:C1,SubtractEquation:Vte,SubtractiveBlending:NN,TOUCH:Wp,TangentSpaceNormalMap:K0,TetrahedronGeometry:Y9,Texture:Gs,TextureLoader:aIe,TextureUtils:hNe,Timer:UIe,TimestampQuery:aMe,TorusGeometry:X9,TorusKnotGeometry:Q9,Triangle:Ua,TriangleFanDrawMode:NCe,TriangleStripDrawMode:ICe,TrianglesDrawMode:RCe,TubeGeometry:J9,UVMapping:S9,Uint16BufferAttribute:FD,Uint32BufferAttribute:zD,Uint8BufferAttribute:qMe,Uint8ClampedBufferAttribute:ZMe,Uniform:pO,UniformsGroup:DIe,UniformsLib:qt,UniformsUtils:Ine,UnsignedByteType:ca,UnsignedInt101111Type:kD,UnsignedInt248Type:W2,UnsignedInt5999Type:PD,UnsignedIntType:bc,UnsignedShort4444Type:T9,UnsignedShort5551Type:A9,UnsignedShortType:G2,VSMShadowMap:dm,Vector2:Et,Vector3:ye,Vector4:fr,VectorKeyframeTrack:Hb,VideoFrameTexture:xRe,VideoTexture:zne,WebGL3DRenderTarget:DMe,WebGLArrayRenderTarget:LMe,WebGLCoordinateSystem:Sl,WebGLCubeRenderTarget:jD,WebGLRenderTarget:Xa,WebGLRenderer:Lie,WebGLUtils:kie,WebGPUCoordinateSystem:K2,WebXRController:jS,WireframeGeometry:Jne,WrapAroundEnding:Lb,ZeroCurvatureEnding:fm,ZeroFactor:Wte,ZeroSlopeEnding:pm,ZeroStencilOp:UCe,createCanvasElement:_ne,error:xn,getConsoleFunction:dMe,log:Ub,setConsoleFunction:hMe,warn:Wt,warnOnce:q2},Symbol.toStringTag,{value:"Module"}));var Die={exports:{}},M1={};/**
 * @license React
 * react-reconciler-constants.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */M1.ConcurrentRoot=1;M1.ContinuousEventPriority=4;M1.DefaultEventPriority=16;M1.DiscreteEventPriority=1;M1.IdleEventPriority=536870912;M1.LegacyRoot=0;Die.exports=M1;var py=Die.exports;function oOe(n){let e;const t=new Set,i=(c,u)=>{const h=typeof c=="function"?c(e):c;if(h!==e){const p=e;e=u?h:Object.assign({},e,h),t.forEach(m=>m(e,p))}},r=()=>e,s=(c,u=r,h=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let p=u(e);function m(){const y=u(e);if(!h(p,y)){const b=p;c(p=y,b)}}return t.add(m),()=>t.delete(m)},l={setState:i,getState:r,subscribe:(c,u,h)=>u||h?s(c,u,h):(t.add(c),()=>t.delete(c)),destroy:()=>t.clear()};return e=n(i,r,l),l}const aOe=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),JH=aOe?$.useEffect:$.useLayoutEffect;function lOe(n){const e=typeof n=="function"?oOe(n):n,t=(i=e.getState,r=Object.is)=>{const[,s]=$.useReducer(w=>w+1,0),o=e.getState(),a=$.useRef(o),l=$.useRef(i),c=$.useRef(r),u=$.useRef(!1),h=$.useRef();h.current===void 0&&(h.current=i(o));let p,m=!1;(a.current!==o||l.current!==i||c.current!==r||u.current)&&(p=i(o),m=!r(h.current,p)),JH(()=>{m&&(h.current=p),a.current=o,l.current=i,c.current=r,u.current=!1});const y=$.useRef(o);JH(()=>{const w=()=>{try{const T=e.getState(),S=l.current(T);c.current(h.current,S)||(a.current=T,h.current=S,s())}catch{u.current=!0,s()}},v=e.subscribe(w);return e.getState()!==y.current&&w(),v},[]);const b=m?p:h.current;return $.useDebugValue(b),b};return Object.assign(t,e),t[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[t,e];return{next(){const r=i.length<=0;return{value:i.shift(),done:r}}}},t}var Oie={exports:{}},Bie={exports:{}},Uie={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(G,ee){var Q=G.length;G.push(ee);e:for(;0<Q;){var ne=Q-1>>>1,fe=G[ne];if(0<r(fe,ee))G[ne]=ee,G[Q]=fe,Q=ne;else break e}}function t(G){return G.length===0?null:G[0]}function i(G){if(G.length===0)return null;var ee=G[0],Q=G.pop();if(Q!==ee){G[0]=Q;e:for(var ne=0,fe=G.length,Ae=fe>>>1;ne<Ae;){var Pe=2*(ne+1)-1,Ce=G[Pe],de=Pe+1,Ne=G[de];if(0>r(Ce,Q))de<fe&&0>r(Ne,Ce)?(G[ne]=Ne,G[de]=Q,ne=de):(G[ne]=Ce,G[Pe]=Q,ne=Pe);else if(de<fe&&0>r(Ne,Q))G[ne]=Ne,G[de]=Q,ne=de;else break e}}return ee}function r(G,ee){var Q=G.sortIndex-ee.sortIndex;return Q!==0?Q:G.id-ee.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,p=3,m=!1,y=!1,b=!1,w=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function S(G){for(var ee=t(c);ee!==null;){if(ee.callback===null)i(c);else if(ee.startTime<=G)i(c),ee.sortIndex=ee.expirationTime,e(l,ee);else break;ee=t(c)}}function M(G){if(b=!1,S(G),!y)if(t(l)!==null)y=!0,q(P);else{var ee=t(c);ee!==null&&J(M,ee.startTime-G)}}function P(G,ee){y=!1,b&&(b=!1,v(B),B=-1),m=!0;var Q=p;try{for(S(ee),h=t(l);h!==null&&(!(h.expirationTime>ee)||G&&!F());){var ne=h.callback;if(typeof ne=="function"){h.callback=null,p=h.priorityLevel;var fe=ne(h.expirationTime<=ee);ee=n.unstable_now(),typeof fe=="function"?h.callback=fe:h===t(l)&&i(l),S(ee)}else i(l);h=t(l)}if(h!==null)var Ae=!0;else{var Pe=t(c);Pe!==null&&J(M,Pe.startTime-ee),Ae=!1}return Ae}finally{h=null,p=Q,m=!1}}var R=!1,O=null,B=-1,N=5,I=-1;function F(){return!(n.unstable_now()-I<N)}function j(){if(O!==null){var G=n.unstable_now();I=G;var ee=!0;try{ee=O(!0,G)}finally{ee?W():(R=!1,O=null)}}else R=!1}var W;if(typeof T=="function")W=function(){T(j)};else if(typeof MessageChannel<"u"){var U=new MessageChannel,H=U.port2;U.port1.onmessage=j,W=function(){H.postMessage(null)}}else W=function(){w(j,0)};function q(G){O=G,R||(R=!0,W())}function J(G,ee){B=w(function(){G(n.unstable_now())},ee)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(G){G.callback=null},n.unstable_continueExecution=function(){y||m||(y=!0,q(P))},n.unstable_forceFrameRate=function(G){0>G||125<G?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<G?Math.floor(1e3/G):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(G){switch(p){case 1:case 2:case 3:var ee=3;break;default:ee=p}var Q=p;p=ee;try{return G()}finally{p=Q}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(G,ee){switch(G){case 1:case 2:case 3:case 4:case 5:break;default:G=3}var Q=p;p=G;try{return ee()}finally{p=Q}},n.unstable_scheduleCallback=function(G,ee,Q){var ne=n.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ne+Q:ne):Q=ne,G){case 1:var fe=-1;break;case 2:fe=250;break;case 5:fe=1073741823;break;case 4:fe=1e4;break;default:fe=5e3}return fe=Q+fe,G={id:u++,callback:ee,priorityLevel:G,startTime:Q,expirationTime:fe,sortIndex:-1},Q>ne?(G.sortIndex=Q,e(c,G),t(l)===null&&G===t(c)&&(b?(v(B),B=-1):b=!0,J(M,Q-ne))):(G.sortIndex=fe,e(l,G),y||m||(y=!0,q(P))),G},n.unstable_shouldYield=F,n.unstable_wrapCallback=function(G){var ee=p;return function(){var Q=p;p=ee;try{return G.apply(this,arguments)}finally{p=Q}}}})(Uie);Bie.exports=Uie;var qN=Bie.exports;/**
 * @license React
 * react-reconciler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var cOe=function(e){var t={},i=$,r=qN,s=Object.assign;function o(g){for(var x="https://reactjs.org/docs/error-decoder.html?invariant="+g,C=1;C<arguments.length;C++)x+="&args[]="+encodeURIComponent(arguments[C]);return"Minified React error #"+g+"; visit "+x+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,l=Symbol.for("react.element"),c=Symbol.for("react.portal"),u=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),m=Symbol.for("react.provider"),y=Symbol.for("react.context"),b=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),v=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),S=Symbol.for("react.lazy"),M=Symbol.for("react.offscreen"),P=Symbol.iterator;function R(g){return g===null||typeof g!="object"?null:(g=P&&g[P]||g["@@iterator"],typeof g=="function"?g:null)}function O(g){if(g==null)return null;if(typeof g=="function")return g.displayName||g.name||null;if(typeof g=="string")return g;switch(g){case u:return"Fragment";case c:return"Portal";case p:return"Profiler";case h:return"StrictMode";case w:return"Suspense";case v:return"SuspenseList"}if(typeof g=="object")switch(g.$$typeof){case y:return(g.displayName||"Context")+".Consumer";case m:return(g._context.displayName||"Context")+".Provider";case b:var x=g.render;return g=g.displayName,g||(g=x.displayName||x.name||"",g=g!==""?"ForwardRef("+g+")":"ForwardRef"),g;case T:return x=g.displayName||null,x!==null?x:O(g.type)||"Memo";case S:x=g._payload,g=g._init;try{return O(g(x))}catch{}}return null}function B(g){var x=g.type;switch(g.tag){case 24:return"Cache";case 9:return(x.displayName||"Context")+".Consumer";case 10:return(x._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return g=x.render,g=g.displayName||g.name||"",x.displayName||(g!==""?"ForwardRef("+g+")":"ForwardRef");case 7:return"Fragment";case 5:return x;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return O(x);case 8:return x===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof x=="function")return x.displayName||x.name||null;if(typeof x=="string")return x}return null}function N(g){var x=g,C=g;if(g.alternate)for(;x.return;)x=x.return;else{g=x;do x=g,x.flags&4098&&(C=x.return),g=x.return;while(g)}return x.tag===3?C:null}function I(g){if(N(g)!==g)throw Error(o(188))}function F(g){var x=g.alternate;if(!x){if(x=N(g),x===null)throw Error(o(188));return x!==g?null:g}for(var C=g,k=x;;){var V=C.return;if(V===null)break;var Y=V.alternate;if(Y===null){if(k=V.return,k!==null){C=k;continue}break}if(V.child===Y.child){for(Y=V.child;Y;){if(Y===C)return I(V),g;if(Y===k)return I(V),x;Y=Y.sibling}throw Error(o(188))}if(C.return!==k.return)C=V,k=Y;else{for(var ve=!1,Fe=V.child;Fe;){if(Fe===C){ve=!0,C=V,k=Y;break}if(Fe===k){ve=!0,k=V,C=Y;break}Fe=Fe.sibling}if(!ve){for(Fe=Y.child;Fe;){if(Fe===C){ve=!0,C=Y,k=V;break}if(Fe===k){ve=!0,k=Y,C=V;break}Fe=Fe.sibling}if(!ve)throw Error(o(189))}}if(C.alternate!==k)throw Error(o(190))}if(C.tag!==3)throw Error(o(188));return C.stateNode.current===C?g:x}function j(g){return g=F(g),g!==null?W(g):null}function W(g){if(g.tag===5||g.tag===6)return g;for(g=g.child;g!==null;){var x=W(g);if(x!==null)return x;g=g.sibling}return null}function U(g){if(g.tag===5||g.tag===6)return g;for(g=g.child;g!==null;){if(g.tag!==4){var x=U(g);if(x!==null)return x}g=g.sibling}return null}var H=Array.isArray,q=e.getPublicInstance,J=e.getRootHostContext,G=e.getChildHostContext,ee=e.prepareForCommit,Q=e.resetAfterCommit,ne=e.createInstance,fe=e.appendInitialChild,Ae=e.finalizeInitialChildren,Pe=e.prepareUpdate,Ce=e.shouldSetTextContent,de=e.createTextInstance,Ne=e.scheduleTimeout,et=e.cancelTimeout,me=e.noTimeout,nt=e.isPrimaryRenderer,Pt=e.supportsMutation,zt=e.supportsPersistence,Dt=e.supportsHydration,gt=e.getInstanceFromNode,vt=e.preparePortalMount,Oe=e.getCurrentEventPriority,xt=e.detachDeletedInstance,pe=e.supportsMicrotasks,qe=e.scheduleMicrotask,$e=e.supportsTestSelectors,Xe=e.findFiberRoot,Ye=e.getBoundingRect,oe=e.getTextContent,Z=e.isHiddenSubtree,he=e.matchAccessibilityRole,Ge=e.setFocusIfFocusable,ct=e.setupIntersectionObserver,tt=e.appendChild,Lt=e.appendChildToContainer,Ct=e.commitTextUpdate,Ot=e.commitMount,nn=e.commitUpdate,Tt=e.insertBefore,Ve=e.insertInContainerBefore,ut=e.removeChild,ue=e.removeChildFromContainer,Ie=e.resetTextContent,ft=e.hideInstance,xe=e.hideTextInstance,pt=e.unhideInstance,ge=e.unhideTextInstance,Qe=e.clearContainer,ht=e.cloneInstance,at=e.createContainerChildSet,yt=e.appendChildToContainerChildSet,Gt=e.finalizeContainerChildren,on=e.replaceContainerChildren,mn=e.cloneHiddenInstance,Cn=e.cloneHiddenTextInstance,gi=e.canHydrateInstance,$r=e.canHydrateTextInstance,Il=e.canHydrateSuspenseInstance,X=e.isSuspenseInstancePending,se=e.isSuspenseInstanceFallback,te=e.registerSuspenseInstanceRetry,z=e.getNextHydratableSibling,le=e.getFirstHydratableChild,je=e.getFirstHydratableChildWithinContainer,Ke=e.getFirstHydratableChildWithinSuspenseInstance,St=e.hydrateInstance,It=e.hydrateTextInstance,Yt=e.hydrateSuspenseInstance,Ht=e.getNextHydratableInstanceAfterSuspenseInstance,$n=e.commitHydratedContainer,Kt=e.commitHydratedSuspenseInstance,Sn=e.clearSuspenseBoundary,Mn=e.clearSuspenseBoundaryFromContainer,kn=e.shouldDeleteUnhydratedTailInstances,Ln=e.didNotMatchHydratedContainerTextInstance,vn=e.didNotMatchHydratedTextInstance,bn;function ie(g){if(bn===void 0)try{throw Error()}catch(C){var x=C.stack.trim().match(/\n( *(at )?)/);bn=x&&x[1]||""}return`
`+bn+g}var _e=!1;function ke(g,x){if(!g||_e)return"";_e=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(x)if(x=function(){throw Error()},Object.defineProperty(x.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(x,[])}catch(jt){var k=jt}Reflect.construct(g,[],x)}else{try{x.call()}catch(jt){k=jt}g.call(x.prototype)}else{try{throw Error()}catch(jt){k=jt}g()}}catch(jt){if(jt&&k&&typeof jt.stack=="string"){for(var V=jt.stack.split(`
`),Y=k.stack.split(`
`),ve=V.length-1,Fe=Y.length-1;1<=ve&&0<=Fe&&V[ve]!==Y[Fe];)Fe--;for(;1<=ve&&0<=Fe;ve--,Fe--)if(V[ve]!==Y[Fe]){if(ve!==1||Fe!==1)do if(ve--,Fe--,0>Fe||V[ve]!==Y[Fe]){var bt=`
`+V[ve].replace(" at new "," at ");return g.displayName&&bt.includes("<anonymous>")&&(bt=bt.replace("<anonymous>",g.displayName)),bt}while(1<=ve&&0<=Fe);break}}}finally{_e=!1,Error.prepareStackTrace=C}return(g=g?g.displayName||g.name:"")?ie(g):""}var Re=Object.prototype.hasOwnProperty,Te=[],it=-1;function rt(g){return{current:g}}function we(g){0>it||(g.current=Te[it],Te[it]=null,it--)}function Ee(g,x){it++,Te[it]=g.current,g.current=x}var De={},Le=rt(De),ae=rt(!1),be=De;function Ue(g,x){var C=g.type.contextTypes;if(!C)return De;var k=g.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===x)return k.__reactInternalMemoizedMaskedChildContext;var V={},Y;for(Y in C)V[Y]=x[Y];return k&&(g=g.stateNode,g.__reactInternalMemoizedUnmaskedChildContext=x,g.__reactInternalMemoizedMaskedChildContext=V),V}function We(g){return g=g.childContextTypes,g!=null}function st(){we(ae),we(Le)}function _t(g,x,C){if(Le.current!==De)throw Error(o(168));Ee(Le,x),Ee(ae,C)}function ce(g,x,C){var k=g.stateNode;if(x=x.childContextTypes,typeof k.getChildContext!="function")return C;k=k.getChildContext();for(var V in k)if(!(V in x))throw Error(o(108,B(g)||"Unknown",V));return s({},C,k)}function Bt(g){return g=(g=g.stateNode)&&g.__reactInternalMemoizedMergedChildContext||De,be=Le.current,Ee(Le,g),Ee(ae,ae.current),!0}function Nt(g,x,C){var k=g.stateNode;if(!k)throw Error(o(169));C?(g=ce(g,x,be),k.__reactInternalMemoizedMergedChildContext=g,we(ae),we(Le),Ee(Le,g)):we(ae),Ee(ae,C)}var hn=Math.clz32?Math.clz32:fn,Rn=Math.log,gn=Math.LN2;function fn(g){return g>>>=0,g===0?32:31-(Rn(g)/gn|0)|0}var pn=64,En=4194304;function Un(g){switch(g&-g){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return g&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return g}}function Fn(g,x){var C=g.pendingLanes;if(C===0)return 0;var k=0,V=g.suspendedLanes,Y=g.pingedLanes,ve=C&268435455;if(ve!==0){var Fe=ve&~V;Fe!==0?k=Un(Fe):(Y&=ve,Y!==0&&(k=Un(Y)))}else ve=C&~V,ve!==0?k=Un(ve):Y!==0&&(k=Un(Y));if(k===0)return 0;if(x!==0&&x!==k&&!(x&V)&&(V=k&-k,Y=x&-x,V>=Y||V===16&&(Y&4194240)!==0))return x;if(k&4&&(k|=C&16),x=g.entangledLanes,x!==0)for(g=g.entanglements,x&=k;0<x;)C=31-hn(x),V=1<<C,k|=g[C],x&=~V;return k}function zn(g,x){switch(g){case 1:case 2:case 4:return x+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return x+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zi(g,x){for(var C=g.suspendedLanes,k=g.pingedLanes,V=g.expirationTimes,Y=g.pendingLanes;0<Y;){var ve=31-hn(Y),Fe=1<<ve,bt=V[ve];bt===-1?(!(Fe&C)||Fe&k)&&(V[ve]=zn(Fe,x)):bt<=x&&(g.expiredLanes|=Fe),Y&=~Fe}}function Ni(g){return g=g.pendingLanes&-1073741825,g!==0?g:g&1073741824?1073741824:0}function wr(g){for(var x=[],C=0;31>C;C++)x.push(g);return x}function gr(g,x,C){g.pendingLanes|=x,x!==536870912&&(g.suspendedLanes=0,g.pingedLanes=0),g=g.eventTimes,x=31-hn(x),g[x]=C}function wx(g,x){var C=g.pendingLanes&~x;g.pendingLanes=x,g.suspendedLanes=0,g.pingedLanes=0,g.expiredLanes&=x,g.mutableReadLanes&=x,g.entangledLanes&=x,x=g.entanglements;var k=g.eventTimes;for(g=g.expirationTimes;0<C;){var V=31-hn(C),Y=1<<V;x[V]=0,k[V]=-1,g[V]=-1,C&=~Y}}function Gd(g,x){var C=g.entangledLanes|=x;for(g=g.entanglements;C;){var k=31-hn(C),V=1<<k;V&x|g[k]&x&&(g[k]|=x),C&=~V}}var yi=0;function R1(g){return g&=-g,1<g?4<g?g&268435455?16:536870912:4:1}var Sx=r.unstable_scheduleCallback,jn=r.unstable_cancelCallback,Nl=r.unstable_shouldYield,Ji=r.unstable_requestPaint,Qr=r.unstable_now,Q0=r.unstable_ImmediatePriority,Ex=r.unstable_UserBlockingPriority,J0=r.unstable_NormalPriority,bh=r.unstable_IdlePriority,Wd=null,co=null;function vs(g){if(co&&typeof co.onCommitFiberRoot=="function")try{co.onCommitFiberRoot(Wd,g,void 0,(g.current.flags&128)===128)}catch{}}function _h(g,x){return g===x&&(g!==0||1/g===1/x)||g!==g&&x!==x}var tl=typeof Object.is=="function"?Object.is:_h,Pl=null,I1=!1,N1=!1;function P1(g){Pl===null?Pl=[g]:Pl.push(g)}function sT(g){I1=!0,P1(g)}function nl(){if(!N1&&Pl!==null){N1=!0;var g=0,x=yi;try{var C=Pl;for(yi=1;g<C.length;g++){var k=C[g];do k=k(!0);while(k!==null)}Pl=null,I1=!1}catch(V){throw Pl!==null&&(Pl=Pl.slice(g+1)),Sx(Q0,nl),V}finally{yi=x,N1=!1}}return null}var hi=a.ReactCurrentBatchConfig;function k1(g,x){if(tl(g,x))return!0;if(typeof g!="object"||g===null||typeof x!="object"||x===null)return!1;var C=Object.keys(g),k=Object.keys(x);if(C.length!==k.length)return!1;for(k=0;k<C.length;k++){var V=C[k];if(!Re.call(x,V)||!tl(g[V],x[V]))return!1}return!0}function il(g){switch(g.tag){case 5:return ie(g.type);case 16:return ie("Lazy");case 13:return ie("Suspense");case 19:return ie("SuspenseList");case 0:case 2:case 15:return g=ke(g.type,!1),g;case 11:return g=ke(g.type.render,!1),g;case 1:return g=ke(g.type,!0),g;default:return""}}function Ws(g,x){if(g&&g.defaultProps){x=s({},x),g=g.defaultProps;for(var C in g)x[C]===void 0&&(x[C]=g[C]);return x}return x}var ep=rt(null),L1=null,yu=null,Tx=null;function D1(){Tx=yu=L1=null}function rw(g,x,C){nt?(Ee(ep,x._currentValue),x._currentValue=C):(Ee(ep,x._currentValue2),x._currentValue2=C)}function Ax(g){var x=ep.current;we(ep),nt?g._currentValue=x:g._currentValue2=x}function tp(g,x,C){for(;g!==null;){var k=g.alternate;if((g.childLanes&x)!==x?(g.childLanes|=x,k!==null&&(k.childLanes|=x)):k!==null&&(k.childLanes&x)!==x&&(k.childLanes|=x),g===C)break;g=g.return}}function Kd(g,x){L1=g,Tx=yu=null,g=g.dependencies,g!==null&&g.firstContext!==null&&(g.lanes&x&&(al=!0),g.firstContext=null)}function Or(g){var x=nt?g._currentValue:g._currentValue2;if(Tx!==g)if(g={context:g,memoizedValue:x,next:null},yu===null){if(L1===null)throw Error(o(308));yu=g,L1.dependencies={lanes:0,firstContext:g}}else yu=yu.next=g;return x}var kl=null,Ec=!1;function Ll(g){g.updateQueue={baseState:g.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Cx(g,x){g=g.updateQueue,x.updateQueue===g&&(x.updateQueue={baseState:g.baseState,firstBaseUpdate:g.firstBaseUpdate,lastBaseUpdate:g.lastBaseUpdate,shared:g.shared,effects:g.effects})}function Dl(g,x){return{eventTime:g,lane:x,tag:0,payload:null,callback:null,next:null}}function Ol(g,x){var C=g.updateQueue;C!==null&&(C=C.shared,ss!==null&&g.mode&1&&!(oi&2)?(g=C.interleaved,g===null?(x.next=x,kl===null?kl=[C]:kl.push(C)):(x.next=g.next,g.next=x),C.interleaved=x):(g=C.pending,g===null?x.next=x:(x.next=g.next,g.next=x),C.pending=x))}function O1(g,x,C){if(x=x.updateQueue,x!==null&&(x=x.shared,(C&4194240)!==0)){var k=x.lanes;k&=g.pendingLanes,C|=k,x.lanes=C,Gd(g,C)}}function Mx(g,x){var C=g.updateQueue,k=g.alternate;if(k!==null&&(k=k.updateQueue,C===k)){var V=null,Y=null;if(C=C.firstBaseUpdate,C!==null){do{var ve={eventTime:C.eventTime,lane:C.lane,tag:C.tag,payload:C.payload,callback:C.callback,next:null};Y===null?V=Y=ve:Y=Y.next=ve,C=C.next}while(C!==null);Y===null?V=Y=x:Y=Y.next=x}else V=Y=x;C={baseState:k.baseState,firstBaseUpdate:V,lastBaseUpdate:Y,shared:k.shared,effects:k.effects},g.updateQueue=C;return}g=C.lastBaseUpdate,g===null?C.firstBaseUpdate=x:g.next=x,C.lastBaseUpdate=x}function np(g,x,C,k){var V=g.updateQueue;Ec=!1;var Y=V.firstBaseUpdate,ve=V.lastBaseUpdate,Fe=V.shared.pending;if(Fe!==null){V.shared.pending=null;var bt=Fe,jt=bt.next;bt.next=null,ve===null?Y=jt:ve.next=jt,ve=bt;var dn=g.alternate;dn!==null&&(dn=dn.updateQueue,Fe=dn.lastBaseUpdate,Fe!==ve&&(Fe===null?dn.firstBaseUpdate=jt:Fe.next=jt,dn.lastBaseUpdate=bt))}if(Y!==null){var Gn=V.baseState;ve=0,dn=jt=bt=null,Fe=Y;do{var Nn=Fe.lane,hr=Fe.eventTime;if((k&Nn)===Nn){dn!==null&&(dn=dn.next={eventTime:hr,lane:0,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null});e:{var _n=g,po=Fe;switch(Nn=x,hr=C,po.tag){case 1:if(_n=po.payload,typeof _n=="function"){Gn=_n.call(hr,Gn,Nn);break e}Gn=_n;break e;case 3:_n.flags=_n.flags&-65537|128;case 0:if(_n=po.payload,Nn=typeof _n=="function"?_n.call(hr,Gn,Nn):_n,Nn==null)break e;Gn=s({},Gn,Nn);break e;case 2:Ec=!0}}Fe.callback!==null&&Fe.lane!==0&&(g.flags|=64,Nn=V.effects,Nn===null?V.effects=[Fe]:Nn.push(Fe))}else hr={eventTime:hr,lane:Nn,tag:Fe.tag,payload:Fe.payload,callback:Fe.callback,next:null},dn===null?(jt=dn=hr,bt=Gn):dn=dn.next=hr,ve|=Nn;if(Fe=Fe.next,Fe===null){if(Fe=V.shared.pending,Fe===null)break;Nn=Fe,Fe=Nn.next,Nn.next=null,V.lastBaseUpdate=Nn,V.shared.pending=null}}while(1);if(dn===null&&(bt=Gn),V.baseState=bt,V.firstBaseUpdate=jt,V.lastBaseUpdate=dn,x=V.shared.interleaved,x!==null){V=x;do ve|=V.lane,V=V.next;while(V!==x)}else Y===null&&(V.shared.lanes=0);K1|=ve,g.lanes=ve,g.memoizedState=Gn}}function sw(g,x,C){if(g=x.effects,x.effects=null,g!==null)for(x=0;x<g.length;x++){var k=g[x],V=k.callback;if(V!==null){if(k.callback=null,k=C,typeof V!="function")throw Error(o(191,V));V.call(k)}}}var ow=new i.Component().refs;function ip(g,x,C,k){x=g.memoizedState,C=C(k,x),C=C==null?x:s({},x,C),g.memoizedState=C,g.lanes===0&&(g.updateQueue.baseState=C)}var B1={isMounted:function(g){return(g=g._reactInternals)?N(g)===g:!1},enqueueSetState:function(g,x,C){g=g._reactInternals;var k=Jo(),V=lf(g),Y=Dl(k,V);Y.payload=x,C!=null&&(Y.callback=C),Ol(g,Y),x=zl(g,V,k),x!==null&&O1(x,g,V)},enqueueReplaceState:function(g,x,C){g=g._reactInternals;var k=Jo(),V=lf(g),Y=Dl(k,V);Y.tag=1,Y.payload=x,C!=null&&(Y.callback=C),Ol(g,Y),x=zl(g,V,k),x!==null&&O1(x,g,V)},enqueueForceUpdate:function(g,x){g=g._reactInternals;var C=Jo(),k=lf(g),V=Dl(C,k);V.tag=2,x!=null&&(V.callback=x),Ol(g,V),x=zl(g,k,C),x!==null&&O1(x,g,k)}};function Rx(g,x,C,k,V,Y,ve){return g=g.stateNode,typeof g.shouldComponentUpdate=="function"?g.shouldComponentUpdate(k,Y,ve):x.prototype&&x.prototype.isPureReactComponent?!k1(C,k)||!k1(V,Y):!0}function Ix(g,x,C){var k=!1,V=De,Y=x.contextType;return typeof Y=="object"&&Y!==null?Y=Or(Y):(V=We(x)?be:Le.current,k=x.contextTypes,Y=(k=k!=null)?Ue(g,V):De),x=new x(C,Y),g.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=B1,g.stateNode=x,x._reactInternals=g,k&&(g=g.stateNode,g.__reactInternalMemoizedUnmaskedChildContext=V,g.__reactInternalMemoizedMaskedChildContext=Y),x}function rp(g,x,C,k){g=x.state,typeof x.componentWillReceiveProps=="function"&&x.componentWillReceiveProps(C,k),typeof x.UNSAFE_componentWillReceiveProps=="function"&&x.UNSAFE_componentWillReceiveProps(C,k),x.state!==g&&B1.enqueueReplaceState(x,x.state,null)}function Tc(g,x,C,k){var V=g.stateNode;V.props=C,V.state=g.memoizedState,V.refs=ow,Ll(g);var Y=x.contextType;typeof Y=="object"&&Y!==null?V.context=Or(Y):(Y=We(x)?be:Le.current,V.context=Ue(g,Y)),V.state=g.memoizedState,Y=x.getDerivedStateFromProps,typeof Y=="function"&&(ip(g,x,Y,C),V.state=g.memoizedState),typeof x.getDerivedStateFromProps=="function"||typeof V.getSnapshotBeforeUpdate=="function"||typeof V.UNSAFE_componentWillMount!="function"&&typeof V.componentWillMount!="function"||(x=V.state,typeof V.componentWillMount=="function"&&V.componentWillMount(),typeof V.UNSAFE_componentWillMount=="function"&&V.UNSAFE_componentWillMount(),x!==V.state&&B1.enqueueReplaceState(V,V.state,null),np(g,C,V,k),V.state=g.memoizedState),typeof V.componentDidMount=="function"&&(g.flags|=4194308)}var qd=[],Bl=0,Ks=null,sp=0,Wo=[],xa=0,Ac=null,rl=1,Cc="";function wh(g,x){qd[Bl++]=sp,qd[Bl++]=Ks,Ks=g,sp=x}function Nx(g,x,C){Wo[xa++]=rl,Wo[xa++]=Cc,Wo[xa++]=Ac,Ac=g;var k=rl;g=Cc;var V=32-hn(k)-1;k&=~(1<<V),C+=1;var Y=32-hn(x)+V;if(30<Y){var ve=V-V%5;Y=(k&(1<<ve)-1).toString(32),k>>=ve,V-=ve,rl=1<<32-hn(x)+V|C<<V|k,Cc=Y+g}else rl=1<<Y|C<<V|k,Cc=g}function Px(g){g.return!==null&&(wh(g,1),Nx(g,1,0))}function Ko(g){for(;g===Ks;)Ks=qd[--Bl],qd[Bl]=null,sp=qd[--Bl],qd[Bl]=null;for(;g===Ac;)Ac=Wo[--xa],Wo[xa]=null,Cc=Wo[--xa],Wo[xa]=null,rl=Wo[--xa],Wo[xa]=null}var rs=null,qo=null,Si=!1,op=!1,Ns=null;function aw(g,x){var C=jl(5,null,null,0);C.elementType="DELETED",C.stateNode=x,C.return=g,x=g.deletions,x===null?(g.deletions=[C],g.flags|=16):x.push(C)}function Zd(g,x){switch(g.tag){case 5:return x=gi(x,g.type,g.pendingProps),x!==null?(g.stateNode=x,rs=g,qo=le(x),!0):!1;case 6:return x=$r(x,g.pendingProps),x!==null?(g.stateNode=x,rs=g,qo=null,!0):!1;case 13:if(x=Il(x),x!==null){var C=Ac!==null?{id:rl,overflow:Cc}:null;return g.memoizedState={dehydrated:x,treeContext:C,retryLane:1073741824},C=jl(18,null,null,0),C.stateNode=x,C.return=g,g.child=C,rs=g,qo=null,!0}return!1;default:return!1}}function U1(g){return(g.mode&1)!==0&&(g.flags&128)===0}function Yd(g){if(Si){var x=qo;if(x){var C=x;if(!Zd(g,x)){if(U1(g))throw Error(o(418));x=z(C);var k=rs;x&&Zd(g,x)?aw(k,C):(g.flags=g.flags&-4097|2,Si=!1,rs=g)}}else{if(U1(g))throw Error(o(418));g.flags=g.flags&-4097|2,Si=!1,rs=g}}}function lw(g){for(g=g.return;g!==null&&g.tag!==5&&g.tag!==3&&g.tag!==13;)g=g.return;rs=g}function va(g){if(!Dt||g!==rs)return!1;if(!Si)return lw(g),Si=!0,!1;if(g.tag!==3&&(g.tag!==5||kn(g.type)&&!Ce(g.type,g.memoizedProps))){var x=qo;if(x){if(U1(g)){for(g=qo;g;)g=z(g);throw Error(o(418))}for(;x;)aw(g,x),x=z(x)}}if(lw(g),g.tag===13){if(!Dt)throw Error(o(316));if(g=g.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(o(317));qo=Ht(g)}else qo=rs?z(g.stateNode):null;return!0}function Mc(){Dt&&(qo=rs=null,op=Si=!1)}function kx(g){Ns===null?Ns=[g]:Ns.push(g)}function Sh(g,x,C){if(g=C.ref,g!==null&&typeof g!="function"&&typeof g!="object"){if(C._owner){if(C=C._owner,C){if(C.tag!==1)throw Error(o(309));var k=C.stateNode}if(!k)throw Error(o(147,g));var V=k,Y=""+g;return x!==null&&x.ref!==null&&typeof x.ref=="function"&&x.ref._stringRef===Y?x.ref:(x=function(ve){var Fe=V.refs;Fe===ow&&(Fe=V.refs={}),ve===null?delete Fe[Y]:Fe[Y]=ve},x._stringRef=Y,x)}if(typeof g!="string")throw Error(o(284));if(!C._owner)throw Error(o(290,g))}return g}function F1(g,x){throw g=Object.prototype.toString.call(x),Error(o(31,g==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":g))}function Ul(g){var x=g._init;return x(g._payload)}function cw(g){function x(ot,He){if(g){var mt=ot.deletions;mt===null?(ot.deletions=[He],ot.flags|=16):mt.push(He)}}function C(ot,He){if(!g)return null;for(;He!==null;)x(ot,He),He=He.sibling;return null}function k(ot,He){for(ot=new Map;He!==null;)He.key!==null?ot.set(He.key,He):ot.set(He.index,He),He=He.sibling;return ot}function V(ot,He){return ot=uf(ot,He),ot.index=0,ot.sibling=null,ot}function Y(ot,He,mt){return ot.index=mt,g?(mt=ot.alternate,mt!==null?(mt=mt.index,mt<He?(ot.flags|=2,He):mt):(ot.flags|=2,He)):(ot.flags|=1048576,He)}function ve(ot){return g&&ot.alternate===null&&(ot.flags|=2),ot}function Fe(ot,He,mt,tn){return He===null||He.tag!==6?(He=PT(mt,ot.mode,tn),He.return=ot,He):(He=V(He,mt),He.return=ot,He)}function bt(ot,He,mt,tn){var yn=mt.type;return yn===u?dn(ot,He,mt.props.children,tn,mt.key):He!==null&&(He.elementType===yn||typeof yn=="object"&&yn!==null&&yn.$$typeof===S&&Ul(yn)===He.type)?(tn=V(He,mt.props),tn.ref=Sh(ot,He,mt),tn.return=ot,tn):(tn=Uw(mt.type,mt.key,mt.props,null,ot.mode,tn),tn.ref=Sh(ot,He,mt),tn.return=ot,tn)}function jt(ot,He,mt,tn){return He===null||He.tag!==4||He.stateNode.containerInfo!==mt.containerInfo||He.stateNode.implementation!==mt.implementation?(He=kT(mt,ot.mode,tn),He.return=ot,He):(He=V(He,mt.children||[]),He.return=ot,He)}function dn(ot,He,mt,tn,yn){return He===null||He.tag!==7?(He=xp(mt,ot.mode,tn,yn),He.return=ot,He):(He=V(He,mt),He.return=ot,He)}function Gn(ot,He,mt){if(typeof He=="string"&&He!==""||typeof He=="number")return He=PT(""+He,ot.mode,mt),He.return=ot,He;if(typeof He=="object"&&He!==null){switch(He.$$typeof){case l:return mt=Uw(He.type,He.key,He.props,null,ot.mode,mt),mt.ref=Sh(ot,null,He),mt.return=ot,mt;case c:return He=kT(He,ot.mode,mt),He.return=ot,He;case S:var tn=He._init;return Gn(ot,tn(He._payload),mt)}if(H(He)||R(He))return He=xp(He,ot.mode,mt,null),He.return=ot,He;F1(ot,He)}return null}function Nn(ot,He,mt,tn){var yn=He!==null?He.key:null;if(typeof mt=="string"&&mt!==""||typeof mt=="number")return yn!==null?null:Fe(ot,He,""+mt,tn);if(typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case l:return mt.key===yn?bt(ot,He,mt,tn):null;case c:return mt.key===yn?jt(ot,He,mt,tn):null;case S:return yn=mt._init,Nn(ot,He,yn(mt._payload),tn)}if(H(mt)||R(mt))return yn!==null?null:dn(ot,He,mt,tn,null);F1(ot,mt)}return null}function hr(ot,He,mt,tn,yn){if(typeof tn=="string"&&tn!==""||typeof tn=="number")return ot=ot.get(mt)||null,Fe(He,ot,""+tn,yn);if(typeof tn=="object"&&tn!==null){switch(tn.$$typeof){case l:return ot=ot.get(tn.key===null?mt:tn.key)||null,bt(He,ot,tn,yn);case c:return ot=ot.get(tn.key===null?mt:tn.key)||null,jt(He,ot,tn,yn);case S:var ri=tn._init;return hr(ot,He,mt,ri(tn._payload),yn)}if(H(tn)||R(tn))return ot=ot.get(mt)||null,dn(He,ot,tn,yn,null);F1(He,tn)}return null}function _n(ot,He,mt,tn){for(var yn=null,ri=null,Wn=He,Pi=He=0,ks=null;Wn!==null&&Pi<mt.length;Pi++){Wn.index>Pi?(ks=Wn,Wn=null):ks=Wn.sibling;var ki=Nn(ot,Wn,mt[Pi],tn);if(ki===null){Wn===null&&(Wn=ks);break}g&&Wn&&ki.alternate===null&&x(ot,Wn),He=Y(ki,He,Pi),ri===null?yn=ki:ri.sibling=ki,ri=ki,Wn=ks}if(Pi===mt.length)return C(ot,Wn),Si&&wh(ot,Pi),yn;if(Wn===null){for(;Pi<mt.length;Pi++)Wn=Gn(ot,mt[Pi],tn),Wn!==null&&(He=Y(Wn,He,Pi),ri===null?yn=Wn:ri.sibling=Wn,ri=Wn);return Si&&wh(ot,Pi),yn}for(Wn=k(ot,Wn);Pi<mt.length;Pi++)ks=hr(Wn,ot,Pi,mt[Pi],tn),ks!==null&&(g&&ks.alternate!==null&&Wn.delete(ks.key===null?Pi:ks.key),He=Y(ks,He,Pi),ri===null?yn=ks:ri.sibling=ks,ri=ks);return g&&Wn.forEach(function(hf){return x(ot,hf)}),Si&&wh(ot,Pi),yn}function po(ot,He,mt,tn){var yn=R(mt);if(typeof yn!="function")throw Error(o(150));if(mt=yn.call(mt),mt==null)throw Error(o(151));for(var ri=yn=null,Wn=He,Pi=He=0,ks=null,ki=mt.next();Wn!==null&&!ki.done;Pi++,ki=mt.next()){Wn.index>Pi?(ks=Wn,Wn=null):ks=Wn.sibling;var hf=Nn(ot,Wn,ki.value,tn);if(hf===null){Wn===null&&(Wn=ks);break}g&&Wn&&hf.alternate===null&&x(ot,Wn),He=Y(hf,He,Pi),ri===null?yn=hf:ri.sibling=hf,ri=hf,Wn=ks}if(ki.done)return C(ot,Wn),Si&&wh(ot,Pi),yn;if(Wn===null){for(;!ki.done;Pi++,ki=mt.next())ki=Gn(ot,ki.value,tn),ki!==null&&(He=Y(ki,He,Pi),ri===null?yn=ki:ri.sibling=ki,ri=ki);return Si&&wh(ot,Pi),yn}for(Wn=k(ot,Wn);!ki.done;Pi++,ki=mt.next())ki=hr(Wn,ot,Pi,ki.value,tn),ki!==null&&(g&&ki.alternate!==null&&Wn.delete(ki.key===null?Pi:ki.key),He=Y(ki,He,Pi),ri===null?yn=ki:ri.sibling=ki,ri=ki);return g&&Wn.forEach(function(Ire){return x(ot,Ire)}),Si&&wh(ot,Pi),yn}function Vl(ot,He,mt,tn){if(typeof mt=="object"&&mt!==null&&mt.type===u&&mt.key===null&&(mt=mt.props.children),typeof mt=="object"&&mt!==null){switch(mt.$$typeof){case l:e:{for(var yn=mt.key,ri=He;ri!==null;){if(ri.key===yn){if(yn=mt.type,yn===u){if(ri.tag===7){C(ot,ri.sibling),He=V(ri,mt.props.children),He.return=ot,ot=He;break e}}else if(ri.elementType===yn||typeof yn=="object"&&yn!==null&&yn.$$typeof===S&&Ul(yn)===ri.type){C(ot,ri.sibling),He=V(ri,mt.props),He.ref=Sh(ot,ri,mt),He.return=ot,ot=He;break e}C(ot,ri);break}else x(ot,ri);ri=ri.sibling}mt.type===u?(He=xp(mt.props.children,ot.mode,tn,mt.key),He.return=ot,ot=He):(tn=Uw(mt.type,mt.key,mt.props,null,ot.mode,tn),tn.ref=Sh(ot,He,mt),tn.return=ot,ot=tn)}return ve(ot);case c:e:{for(ri=mt.key;He!==null;){if(He.key===ri)if(He.tag===4&&He.stateNode.containerInfo===mt.containerInfo&&He.stateNode.implementation===mt.implementation){C(ot,He.sibling),He=V(He,mt.children||[]),He.return=ot,ot=He;break e}else{C(ot,He);break}else x(ot,He);He=He.sibling}He=kT(mt,ot.mode,tn),He.return=ot,ot=He}return ve(ot);case S:return ri=mt._init,Vl(ot,He,ri(mt._payload),tn)}if(H(mt))return _n(ot,He,mt,tn);if(R(mt))return po(ot,He,mt,tn);F1(ot,mt)}return typeof mt=="string"&&mt!==""||typeof mt=="number"?(mt=""+mt,He!==null&&He.tag===6?(C(ot,He.sibling),He=V(He,mt),He.return=ot,ot=He):(C(ot,He),He=PT(mt,ot.mode,tn),He.return=ot,ot=He),ve(ot)):C(ot,He)}return Vl}var sl=cw(!0),uw=cw(!1),Zo={},qs=rt(Zo),Xd=rt(Zo),xu=rt(Zo);function Yo(g){if(g===Zo)throw Error(o(174));return g}function ap(g,x){Ee(xu,x),Ee(Xd,g),Ee(qs,Zo),g=J(x),we(qs),Ee(qs,g)}function Rc(){we(qs),we(Xd),we(xu)}function Eh(g){var x=Yo(xu.current),C=Yo(qs.current);x=G(C,g.type,x),C!==x&&(Ee(Xd,g),Ee(qs,x))}function Qd(g){Xd.current===g&&(we(qs),we(Xd))}var ur=rt(0);function lp(g){for(var x=g;x!==null;){if(x.tag===13){var C=x.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||X(C)||se(C)))return x}else if(x.tag===19&&x.memoizedProps.revealOrder!==void 0){if(x.flags&128)return x}else if(x.child!==null){x.child.return=x,x=x.child;continue}if(x===g)break;for(;x.sibling===null;){if(x.return===null||x.return===g)return null;x=x.return}x.sibling.return=x.return,x=x.sibling}return null}var Lx=[];function Jd(){for(var g=0;g<Lx.length;g++){var x=Lx[g];nt?x._workInProgressVersionPrimary=null:x._workInProgressVersionSecondary=null}Lx.length=0}var z1=a.ReactCurrentDispatcher,Xo=a.ReactCurrentBatchConfig,ef=0,Sr=null,Ps=null,Yi=null,Th=!1,cp=!1,vu=0,oT=0;function bs(){throw Error(o(321))}function Dx(g,x){if(x===null)return!1;for(var C=0;C<x.length&&C<g.length;C++)if(!tl(g[C],x[C]))return!1;return!0}function Ah(g,x,C,k,V,Y){if(ef=Y,Sr=x,x.memoizedState=null,x.updateQueue=null,x.lanes=0,z1.current=g===null||g.memoizedState===null?Dn:ii,g=C(k,V),cp){Y=0;do{if(cp=!1,vu=0,25<=Y)throw Error(o(301));Y+=1,Yi=Ps=null,x.updateQueue=null,z1.current=Zs,g=C(k,V)}while(cp)}if(z1.current=Xt,x=Ps!==null&&Ps.next!==null,ef=0,Yi=Ps=Sr=null,Th=!1,x)throw Error(o(300));return g}function Ox(){var g=vu!==0;return vu=0,g}function uo(){var g={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Yi===null?Sr.memoizedState=Yi=g:Yi=Yi.next=g,Yi}function ol(){if(Ps===null){var g=Sr.alternate;g=g!==null?g.memoizedState:null}else g=Ps.next;var x=Yi===null?Sr.memoizedState:Yi.next;if(x!==null)Yi=x,Ps=g;else{if(g===null)throw Error(o(310));Ps=g,g={memoizedState:Ps.memoizedState,baseState:Ps.baseState,baseQueue:Ps.baseQueue,queue:Ps.queue,next:null},Yi===null?Sr.memoizedState=Yi=g:Yi=Yi.next=g}return Yi}function bu(g,x){return typeof x=="function"?x(g):x}function j1(g){var x=ol(),C=x.queue;if(C===null)throw Error(o(311));C.lastRenderedReducer=g;var k=Ps,V=k.baseQueue,Y=C.pending;if(Y!==null){if(V!==null){var ve=V.next;V.next=Y.next,Y.next=ve}k.baseQueue=V=Y,C.pending=null}if(V!==null){Y=V.next,k=k.baseState;var Fe=ve=null,bt=null,jt=Y;do{var dn=jt.lane;if((ef&dn)===dn)bt!==null&&(bt=bt.next={lane:0,action:jt.action,hasEagerState:jt.hasEagerState,eagerState:jt.eagerState,next:null}),k=jt.hasEagerState?jt.eagerState:g(k,jt.action);else{var Gn={lane:dn,action:jt.action,hasEagerState:jt.hasEagerState,eagerState:jt.eagerState,next:null};bt===null?(Fe=bt=Gn,ve=k):bt=bt.next=Gn,Sr.lanes|=dn,K1|=dn}jt=jt.next}while(jt!==null&&jt!==Y);bt===null?ve=k:bt.next=Fe,tl(k,x.memoizedState)||(al=!0),x.memoizedState=k,x.baseState=ve,x.baseQueue=bt,C.lastRenderedState=k}if(g=C.interleaved,g!==null){V=g;do Y=V.lane,Sr.lanes|=Y,K1|=Y,V=V.next;while(V!==g)}else V===null&&(C.lanes=0);return[x.memoizedState,C.dispatch]}function ba(g){var x=ol(),C=x.queue;if(C===null)throw Error(o(311));C.lastRenderedReducer=g;var k=C.dispatch,V=C.pending,Y=x.memoizedState;if(V!==null){C.pending=null;var ve=V=V.next;do Y=g(Y,ve.action),ve=ve.next;while(ve!==V);tl(Y,x.memoizedState)||(al=!0),x.memoizedState=Y,x.baseQueue===null&&(x.baseState=Y),C.lastRenderedState=Y}return[Y,k]}function Bx(){}function Ux(g,x){var C=Sr,k=ol(),V=x(),Y=!tl(k.memoizedState,V);if(Y&&(k.memoizedState=V,al=!0),k=k.queue,sf(up.bind(null,C,k,g),[g]),k.getSnapshot!==x||Y||Yi!==null&&Yi.memoizedState.tag&1){if(C.flags|=2048,rf(9,hw.bind(null,C,k,V,x),void 0,null),ss===null)throw Error(o(349));ef&30||tf(C,x,V)}return V}function tf(g,x,C){g.flags|=16384,g={getSnapshot:x,value:C},x=Sr.updateQueue,x===null?(x={lastEffect:null,stores:null},Sr.updateQueue=x,x.stores=[g]):(C=x.stores,C===null?x.stores=[g]:C.push(g))}function hw(g,x,C,k){x.value=C,x.getSnapshot=k,nf(x)&&zl(g,1,-1)}function up(g,x,C){return C(function(){nf(x)&&zl(g,1,-1)})}function nf(g){var x=g.getSnapshot;g=g.value;try{var C=x();return!tl(g,C)}catch{return!0}}function V1(g){var x=uo();return typeof g=="function"&&(g=g()),x.memoizedState=x.baseState=g,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:bu,lastRenderedState:g},x.queue=g,g=g.dispatch=re.bind(null,Sr,g),[x.memoizedState,g]}function rf(g,x,C,k){return g={tag:g,create:x,destroy:C,deps:k,next:null},x=Sr.updateQueue,x===null?(x={lastEffect:null,stores:null},Sr.updateQueue=x,x.lastEffect=g.next=g):(C=x.lastEffect,C===null?x.lastEffect=g.next=g:(k=C.next,C.next=g,g.next=k,x.lastEffect=g)),g}function dw(){return ol().memoizedState}function hp(g,x,C,k){var V=uo();Sr.flags|=g,V.memoizedState=rf(1|x,C,void 0,k===void 0?null:k)}function dp(g,x,C,k){var V=ol();k=k===void 0?null:k;var Y=void 0;if(Ps!==null){var ve=Ps.memoizedState;if(Y=ve.destroy,k!==null&&Dx(k,ve.deps)){V.memoizedState=rf(x,C,Y,k);return}}Sr.flags|=g,V.memoizedState=rf(1|x,C,Y,k)}function H1(g,x){return hp(8390656,8,g,x)}function sf(g,x){return dp(2048,8,g,x)}function Fx(g,x){return dp(4,2,g,x)}function fw(g,x){return dp(4,4,g,x)}function zx(g,x){if(typeof x=="function")return g=g(),x(g),function(){x(null)};if(x!=null)return g=g(),x.current=g,function(){x.current=null}}function jx(g,x,C){return C=C!=null?C.concat([g]):null,dp(4,4,zx.bind(null,x,g),C)}function Vx(){}function d(g,x){var C=ol();x=x===void 0?null:x;var k=C.memoizedState;return k!==null&&x!==null&&Dx(x,k[1])?k[0]:(C.memoizedState=[g,x],g)}function _(g,x){var C=ol();x=x===void 0?null:x;var k=C.memoizedState;return k!==null&&x!==null&&Dx(x,k[1])?k[0]:(g=g(),C.memoizedState=[g,x],g)}function A(g,x){var C=yi;yi=C!==0&&4>C?C:4,g(!0);var k=Xo.transition;Xo.transition={};try{g(!1),x()}finally{yi=C,Xo.transition=k}}function D(){return ol().memoizedState}function K(g,x,C){var k=lf(g);C={lane:k,action:C,hasEagerState:!1,eagerState:null,next:null},Me(g)?Ze(x,C):(lt(g,x,C),C=Jo(),g=zl(g,k,C),g!==null&&Mt(g,x,k))}function re(g,x,C){var k=lf(g),V={lane:k,action:C,hasEagerState:!1,eagerState:null,next:null};if(Me(g))Ze(x,V);else{lt(g,x,V);var Y=g.alternate;if(g.lanes===0&&(Y===null||Y.lanes===0)&&(Y=x.lastRenderedReducer,Y!==null))try{var ve=x.lastRenderedState,Fe=Y(ve,C);if(V.hasEagerState=!0,V.eagerState=Fe,tl(Fe,ve))return}catch{}finally{}C=Jo(),g=zl(g,k,C),g!==null&&Mt(g,x,k)}}function Me(g){var x=g.alternate;return g===Sr||x!==null&&x===Sr}function Ze(g,x){cp=Th=!0;var C=g.pending;C===null?x.next=x:(x.next=C.next,C.next=x),g.pending=x}function lt(g,x,C){ss!==null&&g.mode&1&&!(oi&2)?(g=x.interleaved,g===null?(C.next=C,kl===null?kl=[x]:kl.push(x)):(C.next=g.next,g.next=C),x.interleaved=C):(g=x.pending,g===null?C.next=C:(C.next=g.next,g.next=C),x.pending=C)}function Mt(g,x,C){if(C&4194240){var k=x.lanes;k&=g.pendingLanes,C|=k,x.lanes=C,Gd(g,C)}}var Xt={readContext:Or,useCallback:bs,useContext:bs,useEffect:bs,useImperativeHandle:bs,useInsertionEffect:bs,useLayoutEffect:bs,useMemo:bs,useReducer:bs,useRef:bs,useState:bs,useDebugValue:bs,useDeferredValue:bs,useTransition:bs,useMutableSource:bs,useSyncExternalStore:bs,useId:bs,unstable_isNewReconciler:!1},Dn={readContext:Or,useCallback:function(g,x){return uo().memoizedState=[g,x===void 0?null:x],g},useContext:Or,useEffect:H1,useImperativeHandle:function(g,x,C){return C=C!=null?C.concat([g]):null,hp(4194308,4,zx.bind(null,x,g),C)},useLayoutEffect:function(g,x){return hp(4194308,4,g,x)},useInsertionEffect:function(g,x){return hp(4,2,g,x)},useMemo:function(g,x){var C=uo();return x=x===void 0?null:x,g=g(),C.memoizedState=[g,x],g},useReducer:function(g,x,C){var k=uo();return x=C!==void 0?C(x):x,k.memoizedState=k.baseState=x,g={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:g,lastRenderedState:x},k.queue=g,g=g.dispatch=K.bind(null,Sr,g),[k.memoizedState,g]},useRef:function(g){var x=uo();return g={current:g},x.memoizedState=g},useState:V1,useDebugValue:Vx,useDeferredValue:function(g){var x=V1(g),C=x[0],k=x[1];return H1(function(){var V=Xo.transition;Xo.transition={};try{k(g)}finally{Xo.transition=V}},[g]),C},useTransition:function(){var g=V1(!1),x=g[0];return g=A.bind(null,g[1]),uo().memoizedState=g,[x,g]},useMutableSource:function(){},useSyncExternalStore:function(g,x,C){var k=Sr,V=uo();if(Si){if(C===void 0)throw Error(o(407));C=C()}else{if(C=x(),ss===null)throw Error(o(349));ef&30||tf(k,x,C)}V.memoizedState=C;var Y={value:C,getSnapshot:x};return V.queue=Y,H1(up.bind(null,k,Y,g),[g]),k.flags|=2048,rf(9,hw.bind(null,k,Y,C,x),void 0,null),C},useId:function(){var g=uo(),x=ss.identifierPrefix;if(Si){var C=Cc,k=rl;C=(k&~(1<<32-hn(k)-1)).toString(32)+C,x=":"+x+"R"+C,C=vu++,0<C&&(x+="H"+C.toString(32)),x+=":"}else C=oT++,x=":"+x+"r"+C.toString(32)+":";return g.memoizedState=x},unstable_isNewReconciler:!1},ii={readContext:Or,useCallback:d,useContext:Or,useEffect:sf,useImperativeHandle:jx,useInsertionEffect:Fx,useLayoutEffect:fw,useMemo:_,useReducer:j1,useRef:dw,useState:function(){return j1(bu)},useDebugValue:Vx,useDeferredValue:function(g){var x=j1(bu),C=x[0],k=x[1];return sf(function(){var V=Xo.transition;Xo.transition={};try{k(g)}finally{Xo.transition=V}},[g]),C},useTransition:function(){var g=j1(bu)[0],x=ol().memoizedState;return[g,x]},useMutableSource:Bx,useSyncExternalStore:Ux,useId:D,unstable_isNewReconciler:!1},Zs={readContext:Or,useCallback:d,useContext:Or,useEffect:sf,useImperativeHandle:jx,useInsertionEffect:Fx,useLayoutEffect:fw,useMemo:_,useReducer:ba,useRef:dw,useState:function(){return ba(bu)},useDebugValue:Vx,useDeferredValue:function(g){var x=ba(bu),C=x[0],k=x[1];return sf(function(){var V=Xo.transition;Xo.transition={};try{k(g)}finally{Xo.transition=V}},[g]),C},useTransition:function(){var g=ba(bu)[0],x=ol().memoizedState;return[g,x]},useMutableSource:Bx,useSyncExternalStore:Ux,useId:D,unstable_isNewReconciler:!1};function Gr(g,x){try{var C="",k=x;do C+=il(k),k=k.return;while(k);var V=C}catch(Y){V=`
Error generating stack: `+Y.message+`
`+Y.stack}return{value:g,source:x,stack:V}}function ho(g,x){try{console.error(x.value)}catch(C){setTimeout(function(){throw C})}}var fo=typeof WeakMap=="function"?WeakMap:Map;function Ch(g,x,C){C=Dl(-1,C),C.tag=3,C.payload={element:null};var k=x.value;return C.callback=function(){Nw||(Nw=!0,TT=k),ho(g,x)},C}function pw(g,x,C){C=Dl(-1,C),C.tag=3;var k=g.type.getDerivedStateFromError;if(typeof k=="function"){var V=x.value;C.payload=function(){return k(V)},C.callback=function(){ho(g,x)}}var Y=g.stateNode;return Y!==null&&typeof Y.componentDidCatch=="function"&&(C.callback=function(){ho(g,x),typeof k!="function"&&(of===null?of=new Set([this]):of.add(this));var ve=x.stack;this.componentDidCatch(x.value,{componentStack:ve!==null?ve:""})}),C}function mw(g,x,C){var k=g.pingCache;if(k===null){k=g.pingCache=new fo;var V=new Set;k.set(x,V)}else V=k.get(x),V===void 0&&(V=new Set,k.set(x,V));V.has(C)||(V.add(C),g=wre.bind(null,g,x,C),x.then(g,g))}function gw(g){do{var x;if((x=g.tag===13)&&(x=g.memoizedState,x=x!==null?x.dehydrated!==null:!0),x)return g;g=g.return}while(g!==null);return null}function Hx(g,x,C,k,V){return g.mode&1?(g.flags|=65536,g.lanes=V,g):(g===x?g.flags|=65536:(g.flags|=128,C.flags|=131072,C.flags&=-52805,C.tag===1&&(C.alternate===null?C.tag=17:(x=Dl(-1,1),x.tag=2,Ol(C,x))),C.lanes|=1),g)}function Fl(g){g.flags|=4}function $x(g,x){if(g!==null&&g.child===x.child)return!0;if(x.flags&16)return!1;for(g=x.child;g!==null;){if(g.flags&12854||g.subtreeFlags&12854)return!1;g=g.sibling}return!0}var yr,_u,$1,G1;if(Pt)yr=function(g,x){for(var C=x.child;C!==null;){if(C.tag===5||C.tag===6)fe(g,C.stateNode);else if(C.tag!==4&&C.child!==null){C.child.return=C,C=C.child;continue}if(C===x)break;for(;C.sibling===null;){if(C.return===null||C.return===x)return;C=C.return}C.sibling.return=C.return,C=C.sibling}},_u=function(){},$1=function(g,x,C,k,V){if(g=g.memoizedProps,g!==k){var Y=x.stateNode,ve=Yo(qs.current);C=Pe(Y,C,g,k,V,ve),(x.updateQueue=C)&&Fl(x)}},G1=function(g,x,C,k){C!==k&&Fl(x)};else if(zt){yr=function(g,x,C,k){for(var V=x.child;V!==null;){if(V.tag===5){var Y=V.stateNode;C&&k&&(Y=mn(Y,V.type,V.memoizedProps,V)),fe(g,Y)}else if(V.tag===6)Y=V.stateNode,C&&k&&(Y=Cn(Y,V.memoizedProps,V)),fe(g,Y);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)Y=V.child,Y!==null&&(Y.return=V),yr(g,V,!0,!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===x)break;for(;V.sibling===null;){if(V.return===null||V.return===x)return;V=V.return}V.sibling.return=V.return,V=V.sibling}};var yw=function(g,x,C,k){for(var V=x.child;V!==null;){if(V.tag===5){var Y=V.stateNode;C&&k&&(Y=mn(Y,V.type,V.memoizedProps,V)),yt(g,Y)}else if(V.tag===6)Y=V.stateNode,C&&k&&(Y=Cn(Y,V.memoizedProps,V)),yt(g,Y);else if(V.tag!==4){if(V.tag===22&&V.memoizedState!==null)Y=V.child,Y!==null&&(Y.return=V),yw(g,V,!0,!0);else if(V.child!==null){V.child.return=V,V=V.child;continue}}if(V===x)break;for(;V.sibling===null;){if(V.return===null||V.return===x)return;V=V.return}V.sibling.return=V.return,V=V.sibling}};_u=function(g,x){var C=x.stateNode;if(!$x(g,x)){g=C.containerInfo;var k=at(g);yw(k,x,!1,!1),C.pendingChildren=k,Fl(x),Gt(g,k)}},$1=function(g,x,C,k,V){var Y=g.stateNode,ve=g.memoizedProps;if((g=$x(g,x))&&ve===k)x.stateNode=Y;else{var Fe=x.stateNode,bt=Yo(qs.current),jt=null;ve!==k&&(jt=Pe(Fe,C,ve,k,V,bt)),g&&jt===null?x.stateNode=Y:(Y=ht(Y,jt,C,ve,k,x,g,Fe),Ae(Y,C,k,V,bt)&&Fl(x),x.stateNode=Y,g?Fl(x):yr(Y,x,!1,!1))}},G1=function(g,x,C,k){C!==k?(g=Yo(xu.current),C=Yo(qs.current),x.stateNode=de(k,g,C,x),Fl(x)):x.stateNode=g.stateNode}}else _u=function(){},$1=function(){},G1=function(){};function Mh(g,x){if(!Si)switch(g.tailMode){case"hidden":x=g.tail;for(var C=null;x!==null;)x.alternate!==null&&(C=x),x=x.sibling;C===null?g.tail=null:C.sibling=null;break;case"collapsed":C=g.tail;for(var k=null;C!==null;)C.alternate!==null&&(k=C),C=C.sibling;k===null?x||g.tail===null?g.tail=null:g.tail.sibling=null:k.sibling=null}}function _s(g){var x=g.alternate!==null&&g.alternate.child===g.child,C=0,k=0;if(x)for(var V=g.child;V!==null;)C|=V.lanes|V.childLanes,k|=V.subtreeFlags&14680064,k|=V.flags&14680064,V.return=g,V=V.sibling;else for(V=g.child;V!==null;)C|=V.lanes|V.childLanes,k|=V.subtreeFlags,k|=V.flags,V.return=g,V=V.sibling;return g.subtreeFlags|=k,g.childLanes=C,x}function aT(g,x,C){var k=x.pendingProps;switch(Ko(x),x.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return _s(x),null;case 1:return We(x.type)&&st(),_s(x),null;case 3:return k=x.stateNode,Rc(),we(ae),we(Le),Jd(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(g===null||g.child===null)&&(va(x)?Fl(x):g===null||g.memoizedState.isDehydrated&&!(x.flags&256)||(x.flags|=1024,Ns!==null&&(MT(Ns),Ns=null))),_u(g,x),_s(x),null;case 5:Qd(x),C=Yo(xu.current);var V=x.type;if(g!==null&&x.stateNode!=null)$1(g,x,V,k,C),g.ref!==x.ref&&(x.flags|=512,x.flags|=2097152);else{if(!k){if(x.stateNode===null)throw Error(o(166));return _s(x),null}if(g=Yo(qs.current),va(x)){if(!Dt)throw Error(o(175));g=St(x.stateNode,x.type,x.memoizedProps,C,g,x,!op),x.updateQueue=g,g!==null&&Fl(x)}else{var Y=ne(V,k,C,g,x);yr(Y,x,!1,!1),x.stateNode=Y,Ae(Y,V,k,C,g)&&Fl(x)}x.ref!==null&&(x.flags|=512,x.flags|=2097152)}return _s(x),null;case 6:if(g&&x.stateNode!=null)G1(g,x,g.memoizedProps,k);else{if(typeof k!="string"&&x.stateNode===null)throw Error(o(166));if(g=Yo(xu.current),C=Yo(qs.current),va(x)){if(!Dt)throw Error(o(176));if(g=x.stateNode,k=x.memoizedProps,(C=It(g,k,x,!op))&&(V=rs,V!==null))switch(Y=(V.mode&1)!==0,V.tag){case 3:Ln(V.stateNode.containerInfo,g,k,Y);break;case 5:vn(V.type,V.memoizedProps,V.stateNode,g,k,Y)}C&&Fl(x)}else x.stateNode=de(k,g,C,x)}return _s(x),null;case 13:if(we(ur),k=x.memoizedState,Si&&qo!==null&&x.mode&1&&!(x.flags&128)){for(g=qo;g;)g=z(g);return Mc(),x.flags|=98560,x}if(k!==null&&k.dehydrated!==null){if(k=va(x),g===null){if(!k)throw Error(o(318));if(!Dt)throw Error(o(344));if(g=x.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(o(317));Yt(g,x)}else Mc(),!(x.flags&128)&&(x.memoizedState=null),x.flags|=4;return _s(x),null}return Ns!==null&&(MT(Ns),Ns=null),x.flags&128?(x.lanes=C,x):(k=k!==null,C=!1,g===null?va(x):C=g.memoizedState!==null,k&&!C&&(x.child.flags|=8192,x.mode&1&&(g===null||ur.current&1?ws===0&&(ws=3):IT())),x.updateQueue!==null&&(x.flags|=4),_s(x),null);case 4:return Rc(),_u(g,x),g===null&&vt(x.stateNode.containerInfo),_s(x),null;case 10:return Ax(x.type._context),_s(x),null;case 17:return We(x.type)&&st(),_s(x),null;case 19:if(we(ur),V=x.memoizedState,V===null)return _s(x),null;if(k=(x.flags&128)!==0,Y=V.rendering,Y===null)if(k)Mh(V,!1);else{if(ws!==0||g!==null&&g.flags&128)for(g=x.child;g!==null;){if(Y=lp(g),Y!==null){for(x.flags|=128,Mh(V,!1),g=Y.updateQueue,g!==null&&(x.updateQueue=g,x.flags|=4),x.subtreeFlags=0,g=C,k=x.child;k!==null;)C=k,V=g,C.flags&=14680066,Y=C.alternate,Y===null?(C.childLanes=0,C.lanes=V,C.child=null,C.subtreeFlags=0,C.memoizedProps=null,C.memoizedState=null,C.updateQueue=null,C.dependencies=null,C.stateNode=null):(C.childLanes=Y.childLanes,C.lanes=Y.lanes,C.child=Y.child,C.subtreeFlags=0,C.deletions=null,C.memoizedProps=Y.memoizedProps,C.memoizedState=Y.memoizedState,C.updateQueue=Y.updateQueue,C.type=Y.type,V=Y.dependencies,C.dependencies=V===null?null:{lanes:V.lanes,firstContext:V.firstContext}),k=k.sibling;return Ee(ur,ur.current&1|2),x.child}g=g.sibling}V.tail!==null&&Qr()>ET&&(x.flags|=128,k=!0,Mh(V,!1),x.lanes=4194304)}else{if(!k)if(g=lp(Y),g!==null){if(x.flags|=128,k=!0,g=g.updateQueue,g!==null&&(x.updateQueue=g,x.flags|=4),Mh(V,!0),V.tail===null&&V.tailMode==="hidden"&&!Y.alternate&&!Si)return _s(x),null}else 2*Qr()-V.renderingStartTime>ET&&C!==1073741824&&(x.flags|=128,k=!0,Mh(V,!1),x.lanes=4194304);V.isBackwards?(Y.sibling=x.child,x.child=Y):(g=V.last,g!==null?g.sibling=Y:x.child=Y,V.last=Y)}return V.tail!==null?(x=V.tail,V.rendering=x,V.tail=x.sibling,V.renderingStartTime=Qr(),x.sibling=null,g=ur.current,Ee(ur,k?g&1|2:g&1),x):(_s(x),null);case 22:case 23:return RT(),k=x.memoizedState!==null,g!==null&&g.memoizedState!==null!==k&&(x.flags|=8192),k&&x.mode&1?ll&1073741824&&(_s(x),Pt&&x.subtreeFlags&6&&(x.flags|=8192)):_s(x),null;case 24:return null;case 25:return null}throw Error(o(156,x.tag))}var ure=a.ReactCurrentOwner,al=!1;function Qo(g,x,C,k){x.child=g===null?uw(x,null,C,k):sl(x,g.child,C,k)}function SO(g,x,C,k,V){C=C.render;var Y=x.ref;return Kd(x,V),k=Ah(g,x,C,k,Y,V),C=Ox(),g!==null&&!al?(x.updateQueue=g.updateQueue,x.flags&=-2053,g.lanes&=~V,Rh(g,x,V)):(Si&&C&&Px(x),x.flags|=1,Qo(g,x,k,V),x.child)}function EO(g,x,C,k,V){if(g===null){var Y=C.type;return typeof Y=="function"&&!NT(Y)&&Y.defaultProps===void 0&&C.compare===null&&C.defaultProps===void 0?(x.tag=15,x.type=Y,TO(g,x,Y,k,V)):(g=Uw(C.type,null,k,x,x.mode,V),g.ref=x.ref,g.return=x,x.child=g)}if(Y=g.child,!(g.lanes&V)){var ve=Y.memoizedProps;if(C=C.compare,C=C!==null?C:k1,C(ve,k)&&g.ref===x.ref)return Rh(g,x,V)}return x.flags|=1,g=uf(Y,k),g.ref=x.ref,g.return=x,x.child=g}function TO(g,x,C,k,V){if(g!==null&&k1(g.memoizedProps,k)&&g.ref===x.ref)if(al=!1,(g.lanes&V)!==0)g.flags&131072&&(al=!0);else return x.lanes=g.lanes,Rh(g,x,V);return lT(g,x,C,k,V)}function AO(g,x,C){var k=x.pendingProps,V=k.children,Y=g!==null?g.memoizedState:null;if(k.mode==="hidden")if(!(x.mode&1))x.memoizedState={baseLanes:0,cachePool:null},Ee(W1,ll),ll|=C;else if(C&1073741824)x.memoizedState={baseLanes:0,cachePool:null},k=Y!==null?Y.baseLanes:C,Ee(W1,ll),ll|=k;else return g=Y!==null?Y.baseLanes|C:C,x.lanes=x.childLanes=1073741824,x.memoizedState={baseLanes:g,cachePool:null},x.updateQueue=null,Ee(W1,ll),ll|=g,null;else Y!==null?(k=Y.baseLanes|C,x.memoizedState=null):k=C,Ee(W1,ll),ll|=k;return Qo(g,x,V,C),x.child}function CO(g,x){var C=x.ref;(g===null&&C!==null||g!==null&&g.ref!==C)&&(x.flags|=512,x.flags|=2097152)}function lT(g,x,C,k,V){var Y=We(C)?be:Le.current;return Y=Ue(x,Y),Kd(x,V),C=Ah(g,x,C,k,Y,V),k=Ox(),g!==null&&!al?(x.updateQueue=g.updateQueue,x.flags&=-2053,g.lanes&=~V,Rh(g,x,V)):(Si&&k&&Px(x),x.flags|=1,Qo(g,x,C,V),x.child)}function MO(g,x,C,k,V){if(We(C)){var Y=!0;Bt(x)}else Y=!1;if(Kd(x,V),x.stateNode===null)g!==null&&(g.alternate=null,x.alternate=null,x.flags|=2),Ix(x,C,k),Tc(x,C,k,V),k=!0;else if(g===null){var ve=x.stateNode,Fe=x.memoizedProps;ve.props=Fe;var bt=ve.context,jt=C.contextType;typeof jt=="object"&&jt!==null?jt=Or(jt):(jt=We(C)?be:Le.current,jt=Ue(x,jt));var dn=C.getDerivedStateFromProps,Gn=typeof dn=="function"||typeof ve.getSnapshotBeforeUpdate=="function";Gn||typeof ve.UNSAFE_componentWillReceiveProps!="function"&&typeof ve.componentWillReceiveProps!="function"||(Fe!==k||bt!==jt)&&rp(x,ve,k,jt),Ec=!1;var Nn=x.memoizedState;ve.state=Nn,np(x,k,ve,V),bt=x.memoizedState,Fe!==k||Nn!==bt||ae.current||Ec?(typeof dn=="function"&&(ip(x,C,dn,k),bt=x.memoizedState),(Fe=Ec||Rx(x,C,Fe,k,Nn,bt,jt))?(Gn||typeof ve.UNSAFE_componentWillMount!="function"&&typeof ve.componentWillMount!="function"||(typeof ve.componentWillMount=="function"&&ve.componentWillMount(),typeof ve.UNSAFE_componentWillMount=="function"&&ve.UNSAFE_componentWillMount()),typeof ve.componentDidMount=="function"&&(x.flags|=4194308)):(typeof ve.componentDidMount=="function"&&(x.flags|=4194308),x.memoizedProps=k,x.memoizedState=bt),ve.props=k,ve.state=bt,ve.context=jt,k=Fe):(typeof ve.componentDidMount=="function"&&(x.flags|=4194308),k=!1)}else{ve=x.stateNode,Cx(g,x),Fe=x.memoizedProps,jt=x.type===x.elementType?Fe:Ws(x.type,Fe),ve.props=jt,Gn=x.pendingProps,Nn=ve.context,bt=C.contextType,typeof bt=="object"&&bt!==null?bt=Or(bt):(bt=We(C)?be:Le.current,bt=Ue(x,bt));var hr=C.getDerivedStateFromProps;(dn=typeof hr=="function"||typeof ve.getSnapshotBeforeUpdate=="function")||typeof ve.UNSAFE_componentWillReceiveProps!="function"&&typeof ve.componentWillReceiveProps!="function"||(Fe!==Gn||Nn!==bt)&&rp(x,ve,k,bt),Ec=!1,Nn=x.memoizedState,ve.state=Nn,np(x,k,ve,V);var _n=x.memoizedState;Fe!==Gn||Nn!==_n||ae.current||Ec?(typeof hr=="function"&&(ip(x,C,hr,k),_n=x.memoizedState),(jt=Ec||Rx(x,C,jt,k,Nn,_n,bt)||!1)?(dn||typeof ve.UNSAFE_componentWillUpdate!="function"&&typeof ve.componentWillUpdate!="function"||(typeof ve.componentWillUpdate=="function"&&ve.componentWillUpdate(k,_n,bt),typeof ve.UNSAFE_componentWillUpdate=="function"&&ve.UNSAFE_componentWillUpdate(k,_n,bt)),typeof ve.componentDidUpdate=="function"&&(x.flags|=4),typeof ve.getSnapshotBeforeUpdate=="function"&&(x.flags|=1024)):(typeof ve.componentDidUpdate!="function"||Fe===g.memoizedProps&&Nn===g.memoizedState||(x.flags|=4),typeof ve.getSnapshotBeforeUpdate!="function"||Fe===g.memoizedProps&&Nn===g.memoizedState||(x.flags|=1024),x.memoizedProps=k,x.memoizedState=_n),ve.props=k,ve.state=_n,ve.context=bt,k=jt):(typeof ve.componentDidUpdate!="function"||Fe===g.memoizedProps&&Nn===g.memoizedState||(x.flags|=4),typeof ve.getSnapshotBeforeUpdate!="function"||Fe===g.memoizedProps&&Nn===g.memoizedState||(x.flags|=1024),k=!1)}return cT(g,x,C,k,Y,V)}function cT(g,x,C,k,V,Y){CO(g,x);var ve=(x.flags&128)!==0;if(!k&&!ve)return V&&Nt(x,C,!1),Rh(g,x,Y);k=x.stateNode,ure.current=x;var Fe=ve&&typeof C.getDerivedStateFromError!="function"?null:k.render();return x.flags|=1,g!==null&&ve?(x.child=sl(x,g.child,null,Y),x.child=sl(x,null,Fe,Y)):Qo(g,x,Fe,Y),x.memoizedState=k.state,V&&Nt(x,C,!0),x.child}function RO(g){var x=g.stateNode;x.pendingContext?_t(g,x.pendingContext,x.pendingContext!==x.context):x.context&&_t(g,x.context,!1),ap(g,x.containerInfo)}function IO(g,x,C,k,V){return Mc(),kx(V),x.flags|=256,Qo(g,x,C,k),x.child}var xw={dehydrated:null,treeContext:null,retryLane:0};function vw(g){return{baseLanes:g,cachePool:null}}function NO(g,x,C){var k=x.pendingProps,V=ur.current,Y=!1,ve=(x.flags&128)!==0,Fe;if((Fe=ve)||(Fe=g!==null&&g.memoizedState===null?!1:(V&2)!==0),Fe?(Y=!0,x.flags&=-129):(g===null||g.memoizedState!==null)&&(V|=1),Ee(ur,V&1),g===null)return Yd(x),g=x.memoizedState,g!==null&&(g=g.dehydrated,g!==null)?(x.mode&1?se(g)?x.lanes=8:x.lanes=1073741824:x.lanes=1,null):(V=k.children,g=k.fallback,Y?(k=x.mode,Y=x.child,V={mode:"hidden",children:V},!(k&1)&&Y!==null?(Y.childLanes=0,Y.pendingProps=V):Y=Fw(V,k,0,null),g=xp(g,k,C,null),Y.return=x,g.return=x,Y.sibling=g,x.child=Y,x.child.memoizedState=vw(C),x.memoizedState=xw,g):uT(x,V));if(V=g.memoizedState,V!==null){if(Fe=V.dehydrated,Fe!==null){if(ve)return x.flags&256?(x.flags&=-257,bw(g,x,C,Error(o(422)))):x.memoizedState!==null?(x.child=g.child,x.flags|=128,null):(Y=k.fallback,V=x.mode,k=Fw({mode:"visible",children:k.children},V,0,null),Y=xp(Y,V,C,null),Y.flags|=2,k.return=x,Y.return=x,k.sibling=Y,x.child=k,x.mode&1&&sl(x,g.child,null,C),x.child.memoizedState=vw(C),x.memoizedState=xw,Y);if(!(x.mode&1))x=bw(g,x,C,null);else if(se(Fe))x=bw(g,x,C,Error(o(419)));else if(k=(C&g.childLanes)!==0,al||k){if(k=ss,k!==null){switch(C&-C){case 4:Y=2;break;case 16:Y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Y=32;break;case 536870912:Y=268435456;break;default:Y=0}k=Y&(k.suspendedLanes|C)?0:Y,k!==0&&k!==V.retryLane&&(V.retryLane=k,zl(g,k,-1))}IT(),x=bw(g,x,C,Error(o(421)))}else X(Fe)?(x.flags|=128,x.child=g.child,x=Sre.bind(null,g),te(Fe,x),x=null):(C=V.treeContext,Dt&&(qo=Ke(Fe),rs=x,Si=!0,Ns=null,op=!1,C!==null&&(Wo[xa++]=rl,Wo[xa++]=Cc,Wo[xa++]=Ac,rl=C.id,Cc=C.overflow,Ac=x)),x=uT(x,x.pendingProps.children),x.flags|=4096);return x}return Y?(k=kO(g,x,k.children,k.fallback,C),Y=x.child,V=g.child.memoizedState,Y.memoizedState=V===null?vw(C):{baseLanes:V.baseLanes|C,cachePool:null},Y.childLanes=g.childLanes&~C,x.memoizedState=xw,k):(C=PO(g,x,k.children,C),x.memoizedState=null,C)}return Y?(k=kO(g,x,k.children,k.fallback,C),Y=x.child,V=g.child.memoizedState,Y.memoizedState=V===null?vw(C):{baseLanes:V.baseLanes|C,cachePool:null},Y.childLanes=g.childLanes&~C,x.memoizedState=xw,k):(C=PO(g,x,k.children,C),x.memoizedState=null,C)}function uT(g,x){return x=Fw({mode:"visible",children:x},g.mode,0,null),x.return=g,g.child=x}function PO(g,x,C,k){var V=g.child;return g=V.sibling,C=uf(V,{mode:"visible",children:C}),!(x.mode&1)&&(C.lanes=k),C.return=x,C.sibling=null,g!==null&&(k=x.deletions,k===null?(x.deletions=[g],x.flags|=16):k.push(g)),x.child=C}function kO(g,x,C,k,V){var Y=x.mode;g=g.child;var ve=g.sibling,Fe={mode:"hidden",children:C};return!(Y&1)&&x.child!==g?(C=x.child,C.childLanes=0,C.pendingProps=Fe,x.deletions=null):(C=uf(g,Fe),C.subtreeFlags=g.subtreeFlags&14680064),ve!==null?k=uf(ve,k):(k=xp(k,Y,V,null),k.flags|=2),k.return=x,C.return=x,C.sibling=k,x.child=C,k}function bw(g,x,C,k){return k!==null&&kx(k),sl(x,g.child,null,C),g=uT(x,x.pendingProps.children),g.flags|=2,x.memoizedState=null,g}function LO(g,x,C){g.lanes|=x;var k=g.alternate;k!==null&&(k.lanes|=x),tp(g.return,x,C)}function hT(g,x,C,k,V){var Y=g.memoizedState;Y===null?g.memoizedState={isBackwards:x,rendering:null,renderingStartTime:0,last:k,tail:C,tailMode:V}:(Y.isBackwards=x,Y.rendering=null,Y.renderingStartTime=0,Y.last=k,Y.tail=C,Y.tailMode=V)}function DO(g,x,C){var k=x.pendingProps,V=k.revealOrder,Y=k.tail;if(Qo(g,x,k.children,C),k=ur.current,k&2)k=k&1|2,x.flags|=128;else{if(g!==null&&g.flags&128)e:for(g=x.child;g!==null;){if(g.tag===13)g.memoizedState!==null&&LO(g,C,x);else if(g.tag===19)LO(g,C,x);else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===x)break e;for(;g.sibling===null;){if(g.return===null||g.return===x)break e;g=g.return}g.sibling.return=g.return,g=g.sibling}k&=1}if(Ee(ur,k),!(x.mode&1))x.memoizedState=null;else switch(V){case"forwards":for(C=x.child,V=null;C!==null;)g=C.alternate,g!==null&&lp(g)===null&&(V=C),C=C.sibling;C=V,C===null?(V=x.child,x.child=null):(V=C.sibling,C.sibling=null),hT(x,!1,V,C,Y);break;case"backwards":for(C=null,V=x.child,x.child=null;V!==null;){if(g=V.alternate,g!==null&&lp(g)===null){x.child=V;break}g=V.sibling,V.sibling=C,C=V,V=g}hT(x,!0,C,null,Y);break;case"together":hT(x,!1,null,null,void 0);break;default:x.memoizedState=null}return x.child}function Rh(g,x,C){if(g!==null&&(x.dependencies=g.dependencies),K1|=x.lanes,!(C&x.childLanes))return null;if(g!==null&&x.child!==g.child)throw Error(o(153));if(x.child!==null){for(g=x.child,C=uf(g,g.pendingProps),x.child=C,C.return=x;g.sibling!==null;)g=g.sibling,C=C.sibling=uf(g,g.pendingProps),C.return=x;C.sibling=null}return x.child}function hre(g,x,C){switch(x.tag){case 3:RO(x),Mc();break;case 5:Eh(x);break;case 1:We(x.type)&&Bt(x);break;case 4:ap(x,x.stateNode.containerInfo);break;case 10:rw(x,x.type._context,x.memoizedProps.value);break;case 13:var k=x.memoizedState;if(k!==null)return k.dehydrated!==null?(Ee(ur,ur.current&1),x.flags|=128,null):C&x.child.childLanes?NO(g,x,C):(Ee(ur,ur.current&1),g=Rh(g,x,C),g!==null?g.sibling:null);Ee(ur,ur.current&1);break;case 19:if(k=(C&x.childLanes)!==0,g.flags&128){if(k)return DO(g,x,C);x.flags|=128}var V=x.memoizedState;if(V!==null&&(V.rendering=null,V.tail=null,V.lastEffect=null),Ee(ur,ur.current),k)break;return null;case 22:case 23:return x.lanes=0,AO(g,x,C)}return Rh(g,x,C)}function dre(g,x){switch(Ko(x),x.tag){case 1:return We(x.type)&&st(),g=x.flags,g&65536?(x.flags=g&-65537|128,x):null;case 3:return Rc(),we(ae),we(Le),Jd(),g=x.flags,g&65536&&!(g&128)?(x.flags=g&-65537|128,x):null;case 5:return Qd(x),null;case 13:if(we(ur),g=x.memoizedState,g!==null&&g.dehydrated!==null){if(x.alternate===null)throw Error(o(340));Mc()}return g=x.flags,g&65536?(x.flags=g&-65537|128,x):null;case 19:return we(ur),null;case 4:return Rc(),null;case 10:return Ax(x.type._context),null;case 22:case 23:return RT(),null;case 24:return null;default:return null}}var _w=!1,fp=!1,fre=typeof WeakSet=="function"?WeakSet:Set,Qt=null;function ww(g,x){var C=g.ref;if(C!==null)if(typeof C=="function")try{C(null)}catch(k){Sa(g,x,k)}else C.current=null}function dT(g,x,C){try{C()}catch(k){Sa(g,x,k)}}var OO=!1;function pre(g,x){for(ee(g.containerInfo),Qt=x;Qt!==null;)if(g=Qt,x=g.child,(g.subtreeFlags&1028)!==0&&x!==null)x.return=g,Qt=x;else for(;Qt!==null;){g=Qt;try{var C=g.alternate;if(g.flags&1024)switch(g.tag){case 0:case 11:case 15:break;case 1:if(C!==null){var k=C.memoizedProps,V=C.memoizedState,Y=g.stateNode,ve=Y.getSnapshotBeforeUpdate(g.elementType===g.type?k:Ws(g.type,k),V);Y.__reactInternalSnapshotBeforeUpdate=ve}break;case 3:Pt&&Qe(g.stateNode.containerInfo);break;case 5:case 6:case 4:case 17:break;default:throw Error(o(163))}}catch(Fe){Sa(g,g.return,Fe)}if(x=g.sibling,x!==null){x.return=g.return,Qt=x;break}Qt=g.return}return C=OO,OO=!1,C}function pp(g,x,C){var k=x.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var V=k=k.next;do{if((V.tag&g)===g){var Y=V.destroy;V.destroy=void 0,Y!==void 0&&dT(x,C,Y)}V=V.next}while(V!==k)}}function Gx(g,x){if(x=x.updateQueue,x=x!==null?x.lastEffect:null,x!==null){var C=x=x.next;do{if((C.tag&g)===g){var k=C.create;C.destroy=k()}C=C.next}while(C!==x)}}function fT(g){var x=g.ref;if(x!==null){var C=g.stateNode;switch(g.tag){case 5:g=q(C);break;default:g=C}typeof x=="function"?x(g):x.current=g}}function BO(g,x,C){if(co&&typeof co.onCommitFiberUnmount=="function")try{co.onCommitFiberUnmount(Wd,x)}catch{}switch(x.tag){case 0:case 11:case 14:case 15:if(g=x.updateQueue,g!==null&&(g=g.lastEffect,g!==null)){var k=g=g.next;do{var V=k,Y=V.destroy;V=V.tag,Y!==void 0&&(V&2||V&4)&&dT(x,C,Y),k=k.next}while(k!==g)}break;case 1:if(ww(x,C),g=x.stateNode,typeof g.componentWillUnmount=="function")try{g.props=x.memoizedProps,g.state=x.memoizedState,g.componentWillUnmount()}catch(ve){Sa(x,C,ve)}break;case 5:ww(x,C);break;case 4:Pt?HO(g,x,C):zt&&zt&&(x=x.stateNode.containerInfo,C=at(x),on(x,C))}}function UO(g,x,C){for(var k=x;;)if(BO(g,k,C),k.child===null||Pt&&k.tag===4){if(k===x)break;for(;k.sibling===null;){if(k.return===null||k.return===x)return;k=k.return}k.sibling.return=k.return,k=k.sibling}else k.child.return=k,k=k.child}function FO(g){var x=g.alternate;x!==null&&(g.alternate=null,FO(x)),g.child=null,g.deletions=null,g.sibling=null,g.tag===5&&(x=g.stateNode,x!==null&&xt(x)),g.stateNode=null,g.return=null,g.dependencies=null,g.memoizedProps=null,g.memoizedState=null,g.pendingProps=null,g.stateNode=null,g.updateQueue=null}function zO(g){return g.tag===5||g.tag===3||g.tag===4}function jO(g){e:for(;;){for(;g.sibling===null;){if(g.return===null||zO(g.return))return null;g=g.return}for(g.sibling.return=g.return,g=g.sibling;g.tag!==5&&g.tag!==6&&g.tag!==18;){if(g.flags&2||g.child===null||g.tag===4)continue e;g.child.return=g,g=g.child}if(!(g.flags&2))return g.stateNode}}function VO(g){if(Pt){e:{for(var x=g.return;x!==null;){if(zO(x))break e;x=x.return}throw Error(o(160))}var C=x;switch(C.tag){case 5:x=C.stateNode,C.flags&32&&(Ie(x),C.flags&=-33),C=jO(g),mT(g,C,x);break;case 3:case 4:x=C.stateNode.containerInfo,C=jO(g),pT(g,C,x);break;default:throw Error(o(161))}}}function pT(g,x,C){var k=g.tag;if(k===5||k===6)g=g.stateNode,x?Ve(C,g,x):Lt(C,g);else if(k!==4&&(g=g.child,g!==null))for(pT(g,x,C),g=g.sibling;g!==null;)pT(g,x,C),g=g.sibling}function mT(g,x,C){var k=g.tag;if(k===5||k===6)g=g.stateNode,x?Tt(C,g,x):tt(C,g);else if(k!==4&&(g=g.child,g!==null))for(mT(g,x,C),g=g.sibling;g!==null;)mT(g,x,C),g=g.sibling}function HO(g,x,C){for(var k=x,V=!1,Y,ve;;){if(!V){V=k.return;e:for(;;){if(V===null)throw Error(o(160));switch(Y=V.stateNode,V.tag){case 5:ve=!1;break e;case 3:Y=Y.containerInfo,ve=!0;break e;case 4:Y=Y.containerInfo,ve=!0;break e}V=V.return}V=!0}if(k.tag===5||k.tag===6)UO(g,k,C),ve?ue(Y,k.stateNode):ut(Y,k.stateNode);else if(k.tag===18)ve?Mn(Y,k.stateNode):Sn(Y,k.stateNode);else if(k.tag===4){if(k.child!==null){Y=k.stateNode.containerInfo,ve=!0,k.child.return=k,k=k.child;continue}}else if(BO(g,k,C),k.child!==null){k.child.return=k,k=k.child;continue}if(k===x)break;for(;k.sibling===null;){if(k.return===null||k.return===x)return;k=k.return,k.tag===4&&(V=!1)}k.sibling.return=k.return,k=k.sibling}}function gT(g,x){if(Pt){switch(x.tag){case 0:case 11:case 14:case 15:pp(3,x,x.return),Gx(3,x),pp(5,x,x.return);return;case 1:return;case 5:var C=x.stateNode;if(C!=null){var k=x.memoizedProps;g=g!==null?g.memoizedProps:k;var V=x.type,Y=x.updateQueue;x.updateQueue=null,Y!==null&&nn(C,Y,V,g,k,x)}return;case 6:if(x.stateNode===null)throw Error(o(162));C=x.memoizedProps,Ct(x.stateNode,g!==null?g.memoizedProps:C,C);return;case 3:Dt&&g!==null&&g.memoizedState.isDehydrated&&$n(x.stateNode.containerInfo);return;case 12:return;case 13:Sw(x);return;case 19:Sw(x);return;case 17:return}throw Error(o(163))}switch(x.tag){case 0:case 11:case 14:case 15:pp(3,x,x.return),Gx(3,x),pp(5,x,x.return);return;case 12:return;case 13:Sw(x);return;case 19:Sw(x);return;case 3:Dt&&g!==null&&g.memoizedState.isDehydrated&&$n(x.stateNode.containerInfo);break;case 22:case 23:return}e:if(zt){switch(x.tag){case 1:case 5:case 6:break e;case 3:case 4:x=x.stateNode,on(x.containerInfo,x.pendingChildren);break e}throw Error(o(163))}}function Sw(g){var x=g.updateQueue;if(x!==null){g.updateQueue=null;var C=g.stateNode;C===null&&(C=g.stateNode=new fre),x.forEach(function(k){var V=Ere.bind(null,g,k);C.has(k)||(C.add(k),k.then(V,V))})}}function mre(g,x){for(Qt=x;Qt!==null;){x=Qt;var C=x.deletions;if(C!==null)for(var k=0;k<C.length;k++){var V=C[k];try{var Y=g;Pt?HO(Y,V,x):UO(Y,V,x);var ve=V.alternate;ve!==null&&(ve.return=null),V.return=null}catch(yn){Sa(V,x,yn)}}if(C=x.child,x.subtreeFlags&12854&&C!==null)C.return=x,Qt=C;else for(;Qt!==null;){x=Qt;try{var Fe=x.flags;if(Fe&32&&Pt&&Ie(x.stateNode),Fe&512){var bt=x.alternate;if(bt!==null){var jt=bt.ref;jt!==null&&(typeof jt=="function"?jt(null):jt.current=null)}}if(Fe&8192)switch(x.tag){case 13:if(x.memoizedState!==null){var dn=x.alternate;(dn===null||dn.memoizedState===null)&&(ST=Qr())}break;case 22:var Gn=x.memoizedState!==null,Nn=x.alternate,hr=Nn!==null&&Nn.memoizedState!==null;if(C=x,Pt){e:if(k=C,V=Gn,Y=null,Pt)for(var _n=k;;){if(_n.tag===5){if(Y===null){Y=_n;var po=_n.stateNode;V?ft(po):pt(_n.stateNode,_n.memoizedProps)}}else if(_n.tag===6){if(Y===null){var Vl=_n.stateNode;V?xe(Vl):ge(Vl,_n.memoizedProps)}}else if((_n.tag!==22&&_n.tag!==23||_n.memoizedState===null||_n===k)&&_n.child!==null){_n.child.return=_n,_n=_n.child;continue}if(_n===k)break;for(;_n.sibling===null;){if(_n.return===null||_n.return===k)break e;Y===_n&&(Y=null),_n=_n.return}Y===_n&&(Y=null),_n.sibling.return=_n.return,_n=_n.sibling}}if(Gn&&!hr&&C.mode&1){Qt=C;for(var ot=C.child;ot!==null;){for(C=Qt=ot;Qt!==null;){k=Qt;var He=k.child;switch(k.tag){case 0:case 11:case 14:case 15:pp(4,k,k.return);break;case 1:ww(k,k.return);var mt=k.stateNode;if(typeof mt.componentWillUnmount=="function"){var tn=k.return;try{mt.props=k.memoizedProps,mt.state=k.memoizedState,mt.componentWillUnmount()}catch(yn){Sa(k,tn,yn)}}break;case 5:ww(k,k.return);break;case 22:if(k.memoizedState!==null){WO(C);continue}}He!==null?(He.return=k,Qt=He):WO(C)}ot=ot.sibling}}}switch(Fe&4102){case 2:VO(x),x.flags&=-3;break;case 6:VO(x),x.flags&=-3,gT(x.alternate,x);break;case 4096:x.flags&=-4097;break;case 4100:x.flags&=-4097,gT(x.alternate,x);break;case 4:gT(x.alternate,x)}}catch(yn){Sa(x,x.return,yn)}if(C=x.sibling,C!==null){C.return=x.return,Qt=C;break}Qt=x.return}}}function gre(g,x,C){Qt=g,$O(g)}function $O(g,x,C){for(var k=(g.mode&1)!==0;Qt!==null;){var V=Qt,Y=V.child;if(V.tag===22&&k){var ve=V.memoizedState!==null||_w;if(!ve){var Fe=V.alternate,bt=Fe!==null&&Fe.memoizedState!==null||fp;Fe=_w;var jt=fp;if(_w=ve,(fp=bt)&&!jt)for(Qt=V;Qt!==null;)ve=Qt,bt=ve.child,ve.tag===22&&ve.memoizedState!==null?KO(V):bt!==null?(bt.return=ve,Qt=bt):KO(V);for(;Y!==null;)Qt=Y,$O(Y),Y=Y.sibling;Qt=V,_w=Fe,fp=jt}GO(g)}else V.subtreeFlags&8772&&Y!==null?(Y.return=V,Qt=Y):GO(g)}}function GO(g){for(;Qt!==null;){var x=Qt;if(x.flags&8772){var C=x.alternate;try{if(x.flags&8772)switch(x.tag){case 0:case 11:case 15:fp||Gx(5,x);break;case 1:var k=x.stateNode;if(x.flags&4&&!fp)if(C===null)k.componentDidMount();else{var V=x.elementType===x.type?C.memoizedProps:Ws(x.type,C.memoizedProps);k.componentDidUpdate(V,C.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var Y=x.updateQueue;Y!==null&&sw(x,Y,k);break;case 3:var ve=x.updateQueue;if(ve!==null){if(C=null,x.child!==null)switch(x.child.tag){case 5:C=q(x.child.stateNode);break;case 1:C=x.child.stateNode}sw(x,ve,C)}break;case 5:var Fe=x.stateNode;C===null&&x.flags&4&&Ot(Fe,x.type,x.memoizedProps,x);break;case 6:break;case 4:break;case 12:break;case 13:if(Dt&&x.memoizedState===null){var bt=x.alternate;if(bt!==null){var jt=bt.memoizedState;if(jt!==null){var dn=jt.dehydrated;dn!==null&&Kt(dn)}}}break;case 19:case 17:case 21:case 22:case 23:break;default:throw Error(o(163))}fp||x.flags&512&&fT(x)}catch(Gn){Sa(x,x.return,Gn)}}if(x===g){Qt=null;break}if(C=x.sibling,C!==null){C.return=x.return,Qt=C;break}Qt=x.return}}function WO(g){for(;Qt!==null;){var x=Qt;if(x===g){Qt=null;break}var C=x.sibling;if(C!==null){C.return=x.return,Qt=C;break}Qt=x.return}}function KO(g){for(;Qt!==null;){var x=Qt;try{switch(x.tag){case 0:case 11:case 15:var C=x.return;try{Gx(4,x)}catch(bt){Sa(x,C,bt)}break;case 1:var k=x.stateNode;if(typeof k.componentDidMount=="function"){var V=x.return;try{k.componentDidMount()}catch(bt){Sa(x,V,bt)}}var Y=x.return;try{fT(x)}catch(bt){Sa(x,Y,bt)}break;case 5:var ve=x.return;try{fT(x)}catch(bt){Sa(x,ve,bt)}}}catch(bt){Sa(x,x.return,bt)}if(x===g){Qt=null;break}var Fe=x.sibling;if(Fe!==null){Fe.return=x.return,Qt=Fe;break}Qt=x.return}}var Ew=0,Tw=1,Aw=2,Cw=3,Mw=4;if(typeof Symbol=="function"&&Symbol.for){var Wx=Symbol.for;Ew=Wx("selector.component"),Tw=Wx("selector.has_pseudo_class"),Aw=Wx("selector.role"),Cw=Wx("selector.test_id"),Mw=Wx("selector.text")}function yT(g){var x=gt(g);if(x!=null){if(typeof x.memoizedProps["data-testname"]!="string")throw Error(o(364));return x}if(g=Xe(g),g===null)throw Error(o(362));return g.stateNode.current}function xT(g,x){switch(x.$$typeof){case Ew:if(g.type===x.value)return!0;break;case Tw:e:{x=x.value,g=[g,0];for(var C=0;C<g.length;){var k=g[C++],V=g[C++],Y=x[V];if(k.tag!==5||!Z(k)){for(;Y!=null&&xT(k,Y);)V++,Y=x[V];if(V===x.length){x=!0;break e}else for(k=k.child;k!==null;)g.push(k,V),k=k.sibling}}x=!1}return x;case Aw:if(g.tag===5&&he(g.stateNode,x.value))return!0;break;case Mw:if((g.tag===5||g.tag===6)&&(g=oe(g),g!==null&&0<=g.indexOf(x.value)))return!0;break;case Cw:if(g.tag===5&&(g=g.memoizedProps["data-testname"],typeof g=="string"&&g.toLowerCase()===x.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function vT(g){switch(g.$$typeof){case Ew:return"<"+(O(g.value)||"Unknown")+">";case Tw:return":has("+(vT(g)||"")+")";case Aw:return'[role="'+g.value+'"]';case Mw:return'"'+g.value+'"';case Cw:return'[data-testname="'+g.value+'"]';default:throw Error(o(365))}}function qO(g,x){var C=[];g=[g,0];for(var k=0;k<g.length;){var V=g[k++],Y=g[k++],ve=x[Y];if(V.tag!==5||!Z(V)){for(;ve!=null&&xT(V,ve);)Y++,ve=x[Y];if(Y===x.length)C.push(V);else for(V=V.child;V!==null;)g.push(V,Y),V=V.sibling}}return C}function bT(g,x){if(!$e)throw Error(o(363));g=yT(g),g=qO(g,x),x=[],g=Array.from(g);for(var C=0;C<g.length;){var k=g[C++];if(k.tag===5)Z(k)||x.push(k.stateNode);else for(k=k.child;k!==null;)g.push(k),k=k.sibling}return x}var yre=Math.ceil,Rw=a.ReactCurrentDispatcher,_T=a.ReactCurrentOwner,Jr=a.ReactCurrentBatchConfig,oi=0,ss=null,os=null,Ys=0,ll=0,W1=rt(0),ws=0,Kx=null,K1=0,Iw=0,wT=0,qx=null,_a=null,ST=0,ET=1/0;function q1(){ET=Qr()+500}var Nw=!1,TT=null,of=null,Pw=!1,af=null,kw=0,Zx=0,AT=null,Lw=-1,Dw=0;function Jo(){return oi&6?Qr():Lw!==-1?Lw:Lw=Qr()}function lf(g){return g.mode&1?oi&2&&Ys!==0?Ys&-Ys:hi.transition!==null?(Dw===0&&(g=pn,pn<<=1,!(pn&4194240)&&(pn=64),Dw=g),Dw):(g=yi,g!==0?g:Oe()):1}function zl(g,x,C){if(50<Zx)throw Zx=0,AT=null,Error(o(185));var k=Ow(g,x);return k===null?null:(gr(k,x,C),(!(oi&2)||k!==ss)&&(k===ss&&(!(oi&2)&&(Iw|=x),ws===4&&cf(k,Ys)),wa(k,C),x===1&&oi===0&&!(g.mode&1)&&(q1(),I1&&nl())),k)}function Ow(g,x){g.lanes|=x;var C=g.alternate;for(C!==null&&(C.lanes|=x),C=g,g=g.return;g!==null;)g.childLanes|=x,C=g.alternate,C!==null&&(C.childLanes|=x),C=g,g=g.return;return C.tag===3?C.stateNode:null}function wa(g,x){var C=g.callbackNode;Zi(g,x);var k=Fn(g,g===ss?Ys:0);if(k===0)C!==null&&jn(C),g.callbackNode=null,g.callbackPriority=0;else if(x=k&-k,g.callbackPriority!==x){if(C!=null&&jn(C),x===1)g.tag===0?sT(YO.bind(null,g)):P1(YO.bind(null,g)),pe?qe(function(){oi===0&&nl()}):Sx(Q0,nl),C=null;else{switch(R1(k)){case 1:C=Q0;break;case 4:C=Ex;break;case 16:C=J0;break;case 536870912:C=bh;break;default:C=J0}C=sB(C,ZO.bind(null,g))}g.callbackPriority=x,g.callbackNode=C}}function ZO(g,x){if(Lw=-1,Dw=0,oi&6)throw Error(o(327));var C=g.callbackNode;if(yp()&&g.callbackNode!==C)return null;var k=Fn(g,g===ss?Ys:0);if(k===0)return null;if(k&30||k&g.expiredLanes||x)x=Bw(g,k);else{x=k;var V=oi;oi|=2;var Y=JO();(ss!==g||Ys!==x)&&(q1(),mp(g,x));do try{bre();break}catch(Fe){QO(g,Fe)}while(1);D1(),Rw.current=Y,oi=V,os!==null?x=0:(ss=null,Ys=0,x=ws)}if(x!==0){if(x===2&&(V=Ni(g),V!==0&&(k=V,x=CT(g,V))),x===1)throw C=Kx,mp(g,0),cf(g,k),wa(g,Qr()),C;if(x===6)cf(g,k);else{if(V=g.current.alternate,!(k&30)&&!xre(V)&&(x=Bw(g,k),x===2&&(Y=Ni(g),Y!==0&&(k=Y,x=CT(g,Y))),x===1))throw C=Kx,mp(g,0),cf(g,k),wa(g,Qr()),C;switch(g.finishedWork=V,g.finishedLanes=k,x){case 0:case 1:throw Error(o(345));case 2:gp(g,_a);break;case 3:if(cf(g,k),(k&130023424)===k&&(x=ST+500-Qr(),10<x)){if(Fn(g,0)!==0)break;if(V=g.suspendedLanes,(V&k)!==k){Jo(),g.pingedLanes|=g.suspendedLanes&V;break}g.timeoutHandle=Ne(gp.bind(null,g,_a),x);break}gp(g,_a);break;case 4:if(cf(g,k),(k&4194240)===k)break;for(x=g.eventTimes,V=-1;0<k;){var ve=31-hn(k);Y=1<<ve,ve=x[ve],ve>V&&(V=ve),k&=~Y}if(k=V,k=Qr()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*yre(k/1960))-k,10<k){g.timeoutHandle=Ne(gp.bind(null,g,_a),k);break}gp(g,_a);break;case 5:gp(g,_a);break;default:throw Error(o(329))}}}return wa(g,Qr()),g.callbackNode===C?ZO.bind(null,g):null}function CT(g,x){var C=qx;return g.current.memoizedState.isDehydrated&&(mp(g,x).flags|=256),g=Bw(g,x),g!==2&&(x=_a,_a=C,x!==null&&MT(x)),g}function MT(g){_a===null?_a=g:_a.push.apply(_a,g)}function xre(g){for(var x=g;;){if(x.flags&16384){var C=x.updateQueue;if(C!==null&&(C=C.stores,C!==null))for(var k=0;k<C.length;k++){var V=C[k],Y=V.getSnapshot;V=V.value;try{if(!tl(Y(),V))return!1}catch{return!1}}}if(C=x.child,x.subtreeFlags&16384&&C!==null)C.return=x,x=C;else{if(x===g)break;for(;x.sibling===null;){if(x.return===null||x.return===g)return!0;x=x.return}x.sibling.return=x.return,x=x.sibling}}return!0}function cf(g,x){for(x&=~wT,x&=~Iw,g.suspendedLanes|=x,g.pingedLanes&=~x,g=g.expirationTimes;0<x;){var C=31-hn(x),k=1<<C;g[C]=-1,x&=~k}}function YO(g){if(oi&6)throw Error(o(327));yp();var x=Fn(g,0);if(!(x&1))return wa(g,Qr()),null;var C=Bw(g,x);if(g.tag!==0&&C===2){var k=Ni(g);k!==0&&(x=k,C=CT(g,k))}if(C===1)throw C=Kx,mp(g,0),cf(g,x),wa(g,Qr()),C;if(C===6)throw Error(o(345));return g.finishedWork=g.current.alternate,g.finishedLanes=x,gp(g,_a),wa(g,Qr()),null}function XO(g){af!==null&&af.tag===0&&!(oi&6)&&yp();var x=oi;oi|=1;var C=Jr.transition,k=yi;try{if(Jr.transition=null,yi=1,g)return g()}finally{yi=k,Jr.transition=C,oi=x,!(oi&6)&&nl()}}function RT(){ll=W1.current,we(W1)}function mp(g,x){g.finishedWork=null,g.finishedLanes=0;var C=g.timeoutHandle;if(C!==me&&(g.timeoutHandle=me,et(C)),os!==null)for(C=os.return;C!==null;){var k=C;switch(Ko(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&st();break;case 3:Rc(),we(ae),we(Le),Jd();break;case 5:Qd(k);break;case 4:Rc();break;case 13:we(ur);break;case 19:we(ur);break;case 10:Ax(k.type._context);break;case 22:case 23:RT()}C=C.return}if(ss=g,os=g=uf(g.current,null),Ys=ll=x,ws=0,Kx=null,wT=Iw=K1=0,_a=qx=null,kl!==null){for(x=0;x<kl.length;x++)if(C=kl[x],k=C.interleaved,k!==null){C.interleaved=null;var V=k.next,Y=C.pending;if(Y!==null){var ve=Y.next;Y.next=V,k.next=ve}C.pending=k}kl=null}return g}function QO(g,x){do{var C=os;try{if(D1(),z1.current=Xt,Th){for(var k=Sr.memoizedState;k!==null;){var V=k.queue;V!==null&&(V.pending=null),k=k.next}Th=!1}if(ef=0,Yi=Ps=Sr=null,cp=!1,vu=0,_T.current=null,C===null||C.return===null){ws=1,Kx=x,os=null;break}e:{var Y=g,ve=C.return,Fe=C,bt=x;if(x=Ys,Fe.flags|=32768,bt!==null&&typeof bt=="object"&&typeof bt.then=="function"){var jt=bt,dn=Fe,Gn=dn.tag;if(!(dn.mode&1)&&(Gn===0||Gn===11||Gn===15)){var Nn=dn.alternate;Nn?(dn.updateQueue=Nn.updateQueue,dn.memoizedState=Nn.memoizedState,dn.lanes=Nn.lanes):(dn.updateQueue=null,dn.memoizedState=null)}var hr=gw(ve);if(hr!==null){hr.flags&=-257,Hx(hr,ve,Fe,Y,x),hr.mode&1&&mw(Y,jt,x),x=hr,bt=jt;var _n=x.updateQueue;if(_n===null){var po=new Set;po.add(bt),x.updateQueue=po}else _n.add(bt);break e}else{if(!(x&1)){mw(Y,jt,x),IT();break e}bt=Error(o(426))}}else if(Si&&Fe.mode&1){var Vl=gw(ve);if(Vl!==null){!(Vl.flags&65536)&&(Vl.flags|=256),Hx(Vl,ve,Fe,Y,x),kx(bt);break e}}Y=bt,ws!==4&&(ws=2),qx===null?qx=[Y]:qx.push(Y),bt=Gr(bt,Fe),Fe=ve;do{switch(Fe.tag){case 3:Fe.flags|=65536,x&=-x,Fe.lanes|=x;var ot=Ch(Fe,bt,x);Mx(Fe,ot);break e;case 1:Y=bt;var He=Fe.type,mt=Fe.stateNode;if(!(Fe.flags&128)&&(typeof He.getDerivedStateFromError=="function"||mt!==null&&typeof mt.componentDidCatch=="function"&&(of===null||!of.has(mt)))){Fe.flags|=65536,x&=-x,Fe.lanes|=x;var tn=pw(Fe,Y,x);Mx(Fe,tn);break e}}Fe=Fe.return}while(Fe!==null)}tB(C)}catch(yn){x=yn,os===C&&C!==null&&(os=C=C.return);continue}break}while(1)}function JO(){var g=Rw.current;return Rw.current=Xt,g===null?Xt:g}function IT(){(ws===0||ws===3||ws===2)&&(ws=4),ss===null||!(K1&268435455)&&!(Iw&268435455)||cf(ss,Ys)}function Bw(g,x){var C=oi;oi|=2;var k=JO();ss===g&&Ys===x||mp(g,x);do try{vre();break}catch(V){QO(g,V)}while(1);if(D1(),oi=C,Rw.current=k,os!==null)throw Error(o(261));return ss=null,Ys=0,ws}function vre(){for(;os!==null;)eB(os)}function bre(){for(;os!==null&&!Nl();)eB(os)}function eB(g){var x=rB(g.alternate,g,ll);g.memoizedProps=g.pendingProps,x===null?tB(g):os=x,_T.current=null}function tB(g){var x=g;do{var C=x.alternate;if(g=x.return,x.flags&32768){if(C=dre(C,x),C!==null){C.flags&=32767,os=C;return}if(g!==null)g.flags|=32768,g.subtreeFlags=0,g.deletions=null;else{ws=6,os=null;return}}else if(C=aT(C,x,ll),C!==null){os=C;return}if(x=x.sibling,x!==null){os=x;return}os=x=g}while(x!==null);ws===0&&(ws=5)}function gp(g,x){var C=yi,k=Jr.transition;try{Jr.transition=null,yi=1,_re(g,x,C)}finally{Jr.transition=k,yi=C}return null}function _re(g,x,C){do yp();while(af!==null);if(oi&6)throw Error(o(327));var k=g.finishedWork,V=g.finishedLanes;if(k===null)return null;if(g.finishedWork=null,g.finishedLanes=0,k===g.current)throw Error(o(177));g.callbackNode=null,g.callbackPriority=0;var Y=k.lanes|k.childLanes;if(wx(g,Y),g===ss&&(os=ss=null,Ys=0),!(k.subtreeFlags&2064)&&!(k.flags&2064)||Pw||(Pw=!0,sB(J0,function(){return yp(),null})),Y=(k.flags&15990)!==0,k.subtreeFlags&15990||Y){Y=Jr.transition,Jr.transition=null;var ve=yi;yi=1;var Fe=oi;oi|=4,_T.current=null,pre(g,k),mre(g,k),Q(g.containerInfo),g.current=k,gre(k),Ji(),oi=Fe,yi=ve,Jr.transition=Y}else g.current=k;if(Pw&&(Pw=!1,af=g,kw=V),Y=g.pendingLanes,Y===0&&(of=null),vs(k.stateNode),wa(g,Qr()),x!==null)for(C=g.onRecoverableError,k=0;k<x.length;k++)C(x[k]);if(Nw)throw Nw=!1,g=TT,TT=null,g;return kw&1&&g.tag!==0&&yp(),Y=g.pendingLanes,Y&1?g===AT?Zx++:(Zx=0,AT=g):Zx=0,nl(),null}function yp(){if(af!==null){var g=R1(kw),x=Jr.transition,C=yi;try{if(Jr.transition=null,yi=16>g?16:g,af===null)var k=!1;else{if(g=af,af=null,kw=0,oi&6)throw Error(o(331));var V=oi;for(oi|=4,Qt=g.current;Qt!==null;){var Y=Qt,ve=Y.child;if(Qt.flags&16){var Fe=Y.deletions;if(Fe!==null){for(var bt=0;bt<Fe.length;bt++){var jt=Fe[bt];for(Qt=jt;Qt!==null;){var dn=Qt;switch(dn.tag){case 0:case 11:case 15:pp(8,dn,Y)}var Gn=dn.child;if(Gn!==null)Gn.return=dn,Qt=Gn;else for(;Qt!==null;){dn=Qt;var Nn=dn.sibling,hr=dn.return;if(FO(dn),dn===jt){Qt=null;break}if(Nn!==null){Nn.return=hr,Qt=Nn;break}Qt=hr}}}var _n=Y.alternate;if(_n!==null){var po=_n.child;if(po!==null){_n.child=null;do{var Vl=po.sibling;po.sibling=null,po=Vl}while(po!==null)}}Qt=Y}}if(Y.subtreeFlags&2064&&ve!==null)ve.return=Y,Qt=ve;else e:for(;Qt!==null;){if(Y=Qt,Y.flags&2048)switch(Y.tag){case 0:case 11:case 15:pp(9,Y,Y.return)}var ot=Y.sibling;if(ot!==null){ot.return=Y.return,Qt=ot;break e}Qt=Y.return}}var He=g.current;for(Qt=He;Qt!==null;){ve=Qt;var mt=ve.child;if(ve.subtreeFlags&2064&&mt!==null)mt.return=ve,Qt=mt;else e:for(ve=He;Qt!==null;){if(Fe=Qt,Fe.flags&2048)try{switch(Fe.tag){case 0:case 11:case 15:Gx(9,Fe)}}catch(yn){Sa(Fe,Fe.return,yn)}if(Fe===ve){Qt=null;break e}var tn=Fe.sibling;if(tn!==null){tn.return=Fe.return,Qt=tn;break e}Qt=Fe.return}}if(oi=V,nl(),co&&typeof co.onPostCommitFiberRoot=="function")try{co.onPostCommitFiberRoot(Wd,g)}catch{}k=!0}return k}finally{yi=C,Jr.transition=x}}return!1}function nB(g,x,C){x=Gr(C,x),x=Ch(g,x,1),Ol(g,x),x=Jo(),g=Ow(g,1),g!==null&&(gr(g,1,x),wa(g,x))}function Sa(g,x,C){if(g.tag===3)nB(g,g,C);else for(;x!==null;){if(x.tag===3){nB(x,g,C);break}else if(x.tag===1){var k=x.stateNode;if(typeof x.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(of===null||!of.has(k))){g=Gr(C,g),g=pw(x,g,1),Ol(x,g),g=Jo(),x=Ow(x,1),x!==null&&(gr(x,1,g),wa(x,g));break}}x=x.return}}function wre(g,x,C){var k=g.pingCache;k!==null&&k.delete(x),x=Jo(),g.pingedLanes|=g.suspendedLanes&C,ss===g&&(Ys&C)===C&&(ws===4||ws===3&&(Ys&130023424)===Ys&&500>Qr()-ST?mp(g,0):wT|=C),wa(g,x)}function iB(g,x){x===0&&(g.mode&1?(x=En,En<<=1,!(En&130023424)&&(En=4194304)):x=1);var C=Jo();g=Ow(g,x),g!==null&&(gr(g,x,C),wa(g,C))}function Sre(g){var x=g.memoizedState,C=0;x!==null&&(C=x.retryLane),iB(g,C)}function Ere(g,x){var C=0;switch(g.tag){case 13:var k=g.stateNode,V=g.memoizedState;V!==null&&(C=V.retryLane);break;case 19:k=g.stateNode;break;default:throw Error(o(314))}k!==null&&k.delete(x),iB(g,C)}var rB;rB=function(g,x,C){if(g!==null)if(g.memoizedProps!==x.pendingProps||ae.current)al=!0;else{if(!(g.lanes&C)&&!(x.flags&128))return al=!1,hre(g,x,C);al=!!(g.flags&131072)}else al=!1,Si&&x.flags&1048576&&Nx(x,sp,x.index);switch(x.lanes=0,x.tag){case 2:var k=x.type;g!==null&&(g.alternate=null,x.alternate=null,x.flags|=2),g=x.pendingProps;var V=Ue(x,Le.current);Kd(x,C),V=Ah(null,x,k,g,V,C);var Y=Ox();return x.flags|=1,typeof V=="object"&&V!==null&&typeof V.render=="function"&&V.$$typeof===void 0?(x.tag=1,x.memoizedState=null,x.updateQueue=null,We(k)?(Y=!0,Bt(x)):Y=!1,x.memoizedState=V.state!==null&&V.state!==void 0?V.state:null,Ll(x),V.updater=B1,x.stateNode=V,V._reactInternals=x,Tc(x,k,g,C),x=cT(null,x,k,!0,Y,C)):(x.tag=0,Si&&Y&&Px(x),Qo(null,x,V,C),x=x.child),x;case 16:k=x.elementType;e:{switch(g!==null&&(g.alternate=null,x.alternate=null,x.flags|=2),g=x.pendingProps,V=k._init,k=V(k._payload),x.type=k,V=x.tag=Are(k),g=Ws(k,g),V){case 0:x=lT(null,x,k,g,C);break e;case 1:x=MO(null,x,k,g,C);break e;case 11:x=SO(null,x,k,g,C);break e;case 14:x=EO(null,x,k,Ws(k.type,g),C);break e}throw Error(o(306,k,""))}return x;case 0:return k=x.type,V=x.pendingProps,V=x.elementType===k?V:Ws(k,V),lT(g,x,k,V,C);case 1:return k=x.type,V=x.pendingProps,V=x.elementType===k?V:Ws(k,V),MO(g,x,k,V,C);case 3:e:{if(RO(x),g===null)throw Error(o(387));k=x.pendingProps,Y=x.memoizedState,V=Y.element,Cx(g,x),np(x,k,null,C);var ve=x.memoizedState;if(k=ve.element,Dt&&Y.isDehydrated)if(Y={element:k,isDehydrated:!1,cache:ve.cache,transitions:ve.transitions},x.updateQueue.baseState=Y,x.memoizedState=Y,x.flags&256){V=Error(o(423)),x=IO(g,x,k,C,V);break e}else if(k!==V){V=Error(o(424)),x=IO(g,x,k,C,V);break e}else for(Dt&&(qo=je(x.stateNode.containerInfo),rs=x,Si=!0,Ns=null,op=!1),C=uw(x,null,k,C),x.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(Mc(),k===V){x=Rh(g,x,C);break e}Qo(g,x,k,C)}x=x.child}return x;case 5:return Eh(x),g===null&&Yd(x),k=x.type,V=x.pendingProps,Y=g!==null?g.memoizedProps:null,ve=V.children,Ce(k,V)?ve=null:Y!==null&&Ce(k,Y)&&(x.flags|=32),CO(g,x),Qo(g,x,ve,C),x.child;case 6:return g===null&&Yd(x),null;case 13:return NO(g,x,C);case 4:return ap(x,x.stateNode.containerInfo),k=x.pendingProps,g===null?x.child=sl(x,null,k,C):Qo(g,x,k,C),x.child;case 11:return k=x.type,V=x.pendingProps,V=x.elementType===k?V:Ws(k,V),SO(g,x,k,V,C);case 7:return Qo(g,x,x.pendingProps,C),x.child;case 8:return Qo(g,x,x.pendingProps.children,C),x.child;case 12:return Qo(g,x,x.pendingProps.children,C),x.child;case 10:e:{if(k=x.type._context,V=x.pendingProps,Y=x.memoizedProps,ve=V.value,rw(x,k,ve),Y!==null)if(tl(Y.value,ve)){if(Y.children===V.children&&!ae.current){x=Rh(g,x,C);break e}}else for(Y=x.child,Y!==null&&(Y.return=x);Y!==null;){var Fe=Y.dependencies;if(Fe!==null){ve=Y.child;for(var bt=Fe.firstContext;bt!==null;){if(bt.context===k){if(Y.tag===1){bt=Dl(-1,C&-C),bt.tag=2;var jt=Y.updateQueue;if(jt!==null){jt=jt.shared;var dn=jt.pending;dn===null?bt.next=bt:(bt.next=dn.next,dn.next=bt),jt.pending=bt}}Y.lanes|=C,bt=Y.alternate,bt!==null&&(bt.lanes|=C),tp(Y.return,C,x),Fe.lanes|=C;break}bt=bt.next}}else if(Y.tag===10)ve=Y.type===x.type?null:Y.child;else if(Y.tag===18){if(ve=Y.return,ve===null)throw Error(o(341));ve.lanes|=C,Fe=ve.alternate,Fe!==null&&(Fe.lanes|=C),tp(ve,C,x),ve=Y.sibling}else ve=Y.child;if(ve!==null)ve.return=Y;else for(ve=Y;ve!==null;){if(ve===x){ve=null;break}if(Y=ve.sibling,Y!==null){Y.return=ve.return,ve=Y;break}ve=ve.return}Y=ve}Qo(g,x,V.children,C),x=x.child}return x;case 9:return V=x.type,k=x.pendingProps.children,Kd(x,C),V=Or(V),k=k(V),x.flags|=1,Qo(g,x,k,C),x.child;case 14:return k=x.type,V=Ws(k,x.pendingProps),V=Ws(k.type,V),EO(g,x,k,V,C);case 15:return TO(g,x,x.type,x.pendingProps,C);case 17:return k=x.type,V=x.pendingProps,V=x.elementType===k?V:Ws(k,V),g!==null&&(g.alternate=null,x.alternate=null,x.flags|=2),x.tag=1,We(k)?(g=!0,Bt(x)):g=!1,Kd(x,C),Ix(x,k,V),Tc(x,k,V,C),cT(null,x,k,!0,g,C);case 19:return DO(g,x,C);case 22:return AO(g,x,C)}throw Error(o(156,x.tag))};function sB(g,x){return Sx(g,x)}function Tre(g,x,C,k){this.tag=g,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=x,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function jl(g,x,C,k){return new Tre(g,x,C,k)}function NT(g){return g=g.prototype,!(!g||!g.isReactComponent)}function Are(g){if(typeof g=="function")return NT(g)?1:0;if(g!=null){if(g=g.$$typeof,g===b)return 11;if(g===T)return 14}return 2}function uf(g,x){var C=g.alternate;return C===null?(C=jl(g.tag,x,g.key,g.mode),C.elementType=g.elementType,C.type=g.type,C.stateNode=g.stateNode,C.alternate=g,g.alternate=C):(C.pendingProps=x,C.type=g.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=g.flags&14680064,C.childLanes=g.childLanes,C.lanes=g.lanes,C.child=g.child,C.memoizedProps=g.memoizedProps,C.memoizedState=g.memoizedState,C.updateQueue=g.updateQueue,x=g.dependencies,C.dependencies=x===null?null:{lanes:x.lanes,firstContext:x.firstContext},C.sibling=g.sibling,C.index=g.index,C.ref=g.ref,C}function Uw(g,x,C,k,V,Y){var ve=2;if(k=g,typeof g=="function")NT(g)&&(ve=1);else if(typeof g=="string")ve=5;else e:switch(g){case u:return xp(C.children,V,Y,x);case h:ve=8,V|=8;break;case p:return g=jl(12,C,x,V|2),g.elementType=p,g.lanes=Y,g;case w:return g=jl(13,C,x,V),g.elementType=w,g.lanes=Y,g;case v:return g=jl(19,C,x,V),g.elementType=v,g.lanes=Y,g;case M:return Fw(C,V,Y,x);default:if(typeof g=="object"&&g!==null)switch(g.$$typeof){case m:ve=10;break e;case y:ve=9;break e;case b:ve=11;break e;case T:ve=14;break e;case S:ve=16,k=null;break e}throw Error(o(130,g==null?g:typeof g,""))}return x=jl(ve,C,x,V),x.elementType=g,x.type=k,x.lanes=Y,x}function xp(g,x,C,k){return g=jl(7,g,k,x),g.lanes=C,g}function Fw(g,x,C,k){return g=jl(22,g,k,x),g.elementType=M,g.lanes=C,g.stateNode={},g}function PT(g,x,C){return g=jl(6,g,null,x),g.lanes=C,g}function kT(g,x,C){return x=jl(4,g.children!==null?g.children:[],g.key,x),x.lanes=C,x.stateNode={containerInfo:g.containerInfo,pendingChildren:null,implementation:g.implementation},x}function Cre(g,x,C,k,V){this.tag=x,this.containerInfo=g,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=me,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=wr(0),this.expirationTimes=wr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=wr(0),this.identifierPrefix=k,this.onRecoverableError=V,Dt&&(this.mutableSourceEagerHydrationData=null)}function oB(g,x,C,k,V,Y,ve,Fe,bt){return g=new Cre(g,x,C,Fe,bt),x===1?(x=1,Y===!0&&(x|=8)):x=0,Y=jl(3,null,null,x),g.current=Y,Y.stateNode=g,Y.memoizedState={element:k,isDehydrated:C,cache:null,transitions:null},Ll(Y),g}function aB(g){if(!g)return De;g=g._reactInternals;e:{if(N(g)!==g||g.tag!==1)throw Error(o(170));var x=g;do{switch(x.tag){case 3:x=x.stateNode.context;break e;case 1:if(We(x.type)){x=x.stateNode.__reactInternalMemoizedMergedChildContext;break e}}x=x.return}while(x!==null);throw Error(o(171))}if(g.tag===1){var C=g.type;if(We(C))return ce(g,C,x)}return x}function lB(g){var x=g._reactInternals;if(x===void 0)throw typeof g.render=="function"?Error(o(188)):(g=Object.keys(g).join(","),Error(o(268,g)));return g=j(x),g===null?null:g.stateNode}function cB(g,x){if(g=g.memoizedState,g!==null&&g.dehydrated!==null){var C=g.retryLane;g.retryLane=C!==0&&C<x?C:x}}function LT(g,x){cB(g,x),(g=g.alternate)&&cB(g,x)}function Mre(g){return g=j(g),g===null?null:g.stateNode}function Rre(){return null}return t.attemptContinuousHydration=function(g){if(g.tag===13){var x=Jo();zl(g,134217728,x),LT(g,134217728)}},t.attemptHydrationAtCurrentPriority=function(g){if(g.tag===13){var x=Jo(),C=lf(g);zl(g,C,x),LT(g,C)}},t.attemptSynchronousHydration=function(g){switch(g.tag){case 3:var x=g.stateNode;if(x.current.memoizedState.isDehydrated){var C=Un(x.pendingLanes);C!==0&&(Gd(x,C|1),wa(x,Qr()),!(oi&6)&&(q1(),nl()))}break;case 13:var k=Jo();XO(function(){return zl(g,1,k)}),LT(g,1)}},t.batchedUpdates=function(g,x){var C=oi;oi|=1;try{return g(x)}finally{oi=C,oi===0&&(q1(),I1&&nl())}},t.createComponentSelector=function(g){return{$$typeof:Ew,value:g}},t.createContainer=function(g,x,C,k,V,Y,ve){return oB(g,x,!1,null,C,k,V,Y,ve)},t.createHasPseudoClassSelector=function(g){return{$$typeof:Tw,value:g}},t.createHydrationContainer=function(g,x,C,k,V,Y,ve,Fe,bt){return g=oB(C,k,!0,g,V,Y,ve,Fe,bt),g.context=aB(null),C=g.current,k=Jo(),V=lf(C),Y=Dl(k,V),Y.callback=x??null,Ol(C,Y),g.current.lanes=V,gr(g,V,k),wa(g,k),g},t.createPortal=function(g,x,C){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:c,key:k==null?null:""+k,children:g,containerInfo:x,implementation:C}},t.createRoleSelector=function(g){return{$$typeof:Aw,value:g}},t.createTestNameSelector=function(g){return{$$typeof:Cw,value:g}},t.createTextSelector=function(g){return{$$typeof:Mw,value:g}},t.deferredUpdates=function(g){var x=yi,C=Jr.transition;try{return Jr.transition=null,yi=16,g()}finally{yi=x,Jr.transition=C}},t.discreteUpdates=function(g,x,C,k,V){var Y=yi,ve=Jr.transition;try{return Jr.transition=null,yi=1,g(x,C,k,V)}finally{yi=Y,Jr.transition=ve,oi===0&&q1()}},t.findAllNodes=bT,t.findBoundingRects=function(g,x){if(!$e)throw Error(o(363));x=bT(g,x),g=[];for(var C=0;C<x.length;C++)g.push(Ye(x[C]));for(x=g.length-1;0<x;x--){C=g[x];for(var k=C.x,V=k+C.width,Y=C.y,ve=Y+C.height,Fe=x-1;0<=Fe;Fe--)if(x!==Fe){var bt=g[Fe],jt=bt.x,dn=jt+bt.width,Gn=bt.y,Nn=Gn+bt.height;if(k>=jt&&Y>=Gn&&V<=dn&&ve<=Nn){g.splice(x,1);break}else if(k!==jt||C.width!==bt.width||Nn<Y||Gn>ve){if(!(Y!==Gn||C.height!==bt.height||dn<k||jt>V)){jt>k&&(bt.width+=jt-k,bt.x=k),dn<V&&(bt.width=V-jt),g.splice(x,1);break}}else{Gn>Y&&(bt.height+=Gn-Y,bt.y=Y),Nn<ve&&(bt.height=ve-Gn),g.splice(x,1);break}}}return g},t.findHostInstance=lB,t.findHostInstanceWithNoPortals=function(g){return g=F(g),g=g!==null?U(g):null,g===null?null:g.stateNode},t.findHostInstanceWithWarning=function(g){return lB(g)},t.flushControlled=function(g){var x=oi;oi|=1;var C=Jr.transition,k=yi;try{Jr.transition=null,yi=1,g()}finally{yi=k,Jr.transition=C,oi=x,oi===0&&(q1(),nl())}},t.flushPassiveEffects=yp,t.flushSync=XO,t.focusWithin=function(g,x){if(!$e)throw Error(o(363));for(g=yT(g),x=qO(g,x),x=Array.from(x),g=0;g<x.length;){var C=x[g++];if(!Z(C)){if(C.tag===5&&Ge(C.stateNode))return!0;for(C=C.child;C!==null;)x.push(C),C=C.sibling}}return!1},t.getCurrentUpdatePriority=function(){return yi},t.getFindAllNodesFailureDescription=function(g,x){if(!$e)throw Error(o(363));var C=0,k=[];g=[yT(g),0];for(var V=0;V<g.length;){var Y=g[V++],ve=g[V++],Fe=x[ve];if((Y.tag!==5||!Z(Y))&&(xT(Y,Fe)&&(k.push(vT(Fe)),ve++,ve>C&&(C=ve)),ve<x.length))for(Y=Y.child;Y!==null;)g.push(Y,ve),Y=Y.sibling}if(C<x.length){for(g=[];C<x.length;C++)g.push(vT(x[C]));return`findAllNodes was able to match part of the selector:
  `+(k.join(" > ")+`

No matching component was found for:
  `)+g.join(" > ")}return null},t.getPublicRootInstance=function(g){if(g=g.current,!g.child)return null;switch(g.child.tag){case 5:return q(g.child.stateNode);default:return g.child.stateNode}},t.injectIntoDevTools=function(g){if(g={bundleType:g.bundleType,version:g.version,rendererPackageName:g.rendererPackageName,rendererConfig:g.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:a.ReactCurrentDispatcher,findHostInstanceByFiber:Mre,findFiberByHostInstance:g.findFiberByHostInstance||Rre,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")g=!1;else{var x=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(x.isDisabled||!x.supportsFiber)g=!0;else{try{Wd=x.inject(g),co=x}catch{}g=!!x.checkDCE}}return g},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(g,x,C,k){if(!$e)throw Error(o(363));g=bT(g,x);var V=ct(g,C,k).disconnect;return{disconnect:function(){V()}}},t.registerMutableSourceForHydration=function(g,x){var C=x._getVersion;C=C(x._source),g.mutableSourceEagerHydrationData==null?g.mutableSourceEagerHydrationData=[x,C]:g.mutableSourceEagerHydrationData.push(x,C)},t.runWithPriority=function(g,x){var C=yi;try{return yi=g,x()}finally{yi=C}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(g,x,C,k){var V=x.current,Y=Jo(),ve=lf(V);return C=aB(C),x.context===null?x.context=C:x.pendingContext=C,x=Dl(Y,ve),x.payload={element:g},k=k===void 0?null:k,k!==null&&(x.callback=k),Ol(V,x),g=zl(V,ve,Y),g!==null&&O1(g,V,ve),ve},t};Oie.exports=cOe;var uOe=Oie.exports;const hOe=wc(uOe),gO={},dOe=n=>void Object.assign(gO,n);function fOe(n,e){function t(u,{args:h=[],attach:p,...m},y){let b=`${u[0].toUpperCase()}${u.slice(1)}`,w;if(u==="primitive"){if(m.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const v=m.object;w=jg(v,{type:u,root:y,attach:p,primitive:!0})}else{const v=gO[b];if(!v)throw new Error(`R3F: ${b} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(h))throw new Error("R3F: The args prop must be an array!");w=jg(new v(...h),{type:u,root:y,attach:p,memoizedProps:{args:h}})}return w.__r3f.attach===void 0&&(w.isBufferGeometry?w.__r3f.attach="geometry":w.isMaterial&&(w.__r3f.attach="material")),b!=="inject"&&fM(w,m),w}function i(u,h){let p=!1;if(h){var m,y;(m=h.__r3f)!=null&&m.attach?dM(u,h,h.__r3f.attach):h.isObject3D&&u.isObject3D&&(u.add(h),p=!0),p||(y=u.__r3f)==null||y.objects.push(h),h.__r3f||jg(h,{}),h.__r3f.parent=u,YN(h),Vg(h)}}function r(u,h,p){let m=!1;if(h){var y,b;if((y=h.__r3f)!=null&&y.attach)dM(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){h.parent=u,h.dispatchEvent({type:"added"}),u.dispatchEvent({type:"childadded",child:h});const w=u.children.filter(T=>T!==h),v=w.indexOf(p);u.children=[...w.slice(0,v),h,...w.slice(v)],m=!0}m||(b=u.__r3f)==null||b.objects.push(h),h.__r3f||jg(h,{}),h.__r3f.parent=u,YN(h),Vg(h)}}function s(u,h,p=!1){u&&[...u].forEach(m=>o(h,m,p))}function o(u,h,p){if(h){var m,y,b;if(h.__r3f&&(h.__r3f.parent=null),(m=u.__r3f)!=null&&m.objects&&(u.__r3f.objects=u.__r3f.objects.filter(M=>M!==h)),(y=h.__r3f)!=null&&y.attach)r$(u,h,h.__r3f.attach);else if(h.isObject3D&&u.isObject3D){var w;u.remove(h),(w=h.__r3f)!=null&&w.root&&_Oe(HS(h),h)}const T=(b=h.__r3f)==null?void 0:b.primitive,S=!T&&(p===void 0?h.dispose!==null:p);if(!T){var v;s((v=h.__r3f)==null?void 0:v.objects,h,S),s(h.children,h,S)}if(delete h.__r3f,S&&h.dispose&&h.type!=="Scene"){const M=()=>{try{h.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?qN.unstable_scheduleCallback(qN.unstable_IdlePriority,M):M()}Vg(u)}}function a(u,h,p,m){var y;const b=(y=u.__r3f)==null?void 0:y.parent;if(!b)return;const w=t(h,p,u.__r3f.root);if(u.children){for(const v of u.children)v.__r3f&&i(w,v);u.children=u.children.filter(v=>!v.__r3f)}u.__r3f.objects.forEach(v=>i(w,v)),u.__r3f.objects=[],u.__r3f.autoRemovedBeforeAppend||o(b,u),w.parent&&(w.__r3f.autoRemovedBeforeAppend=!0),i(b,w),w.raycast&&w.__r3f.eventCount&&HS(w).getState().internal.interaction.push(w),[m,m.alternate].forEach(v=>{v!==null&&(v.stateNode=w,v.ref&&(typeof v.ref=="function"?v.ref(w):v.ref.current=w))})}const l=()=>{};return{reconciler:hOe({createInstance:t,removeChild:o,appendChild:i,appendInitialChild:i,insertBefore:r,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(u,h)=>{if(!h)return;const p=u.getState().scene;p.__r3f&&(p.__r3f.root=u,i(p,h))},removeChildFromContainer:(u,h)=>{h&&o(u.getState().scene,h)},insertInContainerBefore:(u,h,p)=>{if(!h||!p)return;const m=u.getState().scene;m.__r3f&&r(m,h,p)},getRootHostContext:()=>null,getChildHostContext:u=>u,finalizeInitialChildren(u){var h;return!!((h=u?.__r3f)!=null?h:{}).handlers},prepareUpdate(u,h,p,m){var y;if(((y=u?.__r3f)!=null?y:{}).primitive&&m.object&&m.object!==u)return[!0];{const{args:w=[],children:v,...T}=m,{args:S=[],children:M,...P}=p;if(!Array.isArray(w))throw new Error("R3F: the args prop must be an array!");if(w.some((O,B)=>O!==S[B]))return[!0];const R=Gie(u,T,P,!0);return R.changes.length?[!1,R]:null}},commitUpdate(u,[h,p],m,y,b,w){h?a(u,m,b,w):fM(u,p)},commitMount(u,h,p,m){var y;const b=(y=u.__r3f)!=null?y:{};u.raycast&&b.handlers&&b.eventCount&&HS(u).getState().internal.interaction.push(u)},getPublicInstance:u=>u,prepareForCommit:()=>null,preparePortalMount:u=>jg(u.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(u){var h;const{attach:p,parent:m}=(h=u.__r3f)!=null?h:{};p&&m&&r$(m,u,p),u.isObject3D&&(u.visible=!1),Vg(u)},unhideInstance(u,h){var p;const{attach:m,parent:y}=(p=u.__r3f)!=null?p:{};m&&y&&dM(y,u,m),(u.isObject3D&&h.visible==null||h.visible)&&(u.visible=!0),Vg(u)},createTextInstance:l,hideTextInstance:l,unhideTextInstance:l,getCurrentEventPriority:()=>e?e():py.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&Cr.fun(performance.now)?performance.now:Cr.fun(Date.now)?Date.now:()=>0,scheduleTimeout:Cr.fun(setTimeout)?setTimeout:void 0,cancelTimeout:Cr.fun(clearTimeout)?clearTimeout:void 0}),applyProps:fM}}var e$,t$;const hM=n=>"colorSpace"in n||"outputColorSpace"in n,Fie=()=>{var n;return(n=gO.ColorManagement)!=null?n:null},zie=n=>n&&n.isOrthographicCamera,pOe=n=>n&&n.hasOwnProperty("current"),J_=typeof window<"u"&&((e$=window.document)!=null&&e$.createElement||((t$=window.navigator)==null?void 0:t$.product)==="ReactNative")?$.useLayoutEffect:$.useEffect;function jie(n){const e=$.useRef(n);return J_(()=>void(e.current=n),[n]),e}function mOe({set:n}){return J_(()=>(n(new Promise(()=>null)),()=>n(!1)),[n]),null}class Vie extends $.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}Vie.getDerivedStateFromError=()=>({error:!0});const Hie="__default",n$=new Map,gOe=n=>n&&!!n.memoized&&!!n.changes;function $ie(n){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(n)?Math.min(Math.max(n[0],t),n[1]):n}const Pv=n=>{var e;return(e=n.__r3f)==null?void 0:e.root.getState()};function HS(n){let e=n.__r3f.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const Cr={obj:n=>n===Object(n)&&!Cr.arr(n)&&typeof n!="function",fun:n=>typeof n=="function",str:n=>typeof n=="string",num:n=>typeof n=="number",boo:n=>typeof n=="boolean",und:n=>n===void 0,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:i="reference",strict:r=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(Cr.str(n)||Cr.num(n)||Cr.boo(n))return n===e;const s=Cr.obj(n);if(s&&i==="reference")return n===e;const o=Cr.arr(n);if(o&&t==="reference")return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;if(s&&t==="shallow"&&i==="shallow"){for(a in r?e:n)if(!Cr.equ(n[a],e[a],{strict:r,objects:"reference"}))return!1}else for(a in r?e:n)if(n[a]!==e[a])return!1;if(Cr.und(a)){if(o&&n.length===0&&e.length===0||s&&Object.keys(n).length===0&&Object.keys(e).length===0)return!0;if(n!==e)return!1}return!0}};function yOe(n){n.dispose&&n.type!=="Scene"&&n.dispose();for(const e in n)e.dispose==null||e.dispose(),delete n[e]}function jg(n,e){const t=n;return t.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...e},n}function ZN(n,e){let t=n;if(e.includes("-")){const i=e.split("-"),r=i.pop();return t=i.reduce((s,o)=>s[o],n),{target:t,key:r}}else return{target:t,key:e}}const i$=/-\d+$/;function dM(n,e,t){if(Cr.str(t)){if(i$.test(t)){const s=t.replace(i$,""),{target:o,key:a}=ZN(n,s);Array.isArray(o[a])||(o[a]=[])}const{target:i,key:r}=ZN(n,t);e.__r3f.previousAttach=i[r],i[r]=e}else e.__r3f.previousAttach=t(n,e)}function r$(n,e,t){var i,r;if(Cr.str(t)){const{target:s,key:o}=ZN(n,t),a=e.__r3f.previousAttach;a===void 0?delete s[o]:s[o]=a}else(i=e.__r3f)==null||i.previousAttach==null||i.previousAttach(n,e);(r=e.__r3f)==null||delete r.previousAttach}function Gie(n,{children:e,key:t,ref:i,...r},{children:s,key:o,ref:a,...l}={},c=!1){const u=n.__r3f,h=Object.entries(r),p=[];if(c){const y=Object.keys(l);for(let b=0;b<y.length;b++)r.hasOwnProperty(y[b])||h.unshift([y[b],Hie+"remove"])}h.forEach(([y,b])=>{var w;if((w=n.__r3f)!=null&&w.primitive&&y==="object"||Cr.equ(b,l[y]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(y))return p.push([y,b,!0,[]]);let v=[];y.includes("-")&&(v=y.split("-")),p.push([y,b,!1,v]);for(const T in r){const S=r[T];T.startsWith(`${y}-`)&&p.push([T,S,!1,T.split("-")])}});const m={...r};return u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.args&&(m.args=u.memoizedProps.args),u!=null&&u.memoizedProps&&u!=null&&u.memoizedProps.attach&&(m.attach=u.memoizedProps.attach),{memoized:m,changes:p}}const xOe=typeof process<"u"&&!1;function fM(n,e){var t;const i=n.__r3f,r=i?.root,s=r==null||r.getState==null?void 0:r.getState(),{memoized:o,changes:a}=gOe(e)?e:Gie(n,e),l=i?.eventCount;n.__r3f&&(n.__r3f.memoizedProps=o);for(let p=0;p<a.length;p++){let[m,y,b,w]=a[p];if(hM(n)){const M="srgb",P="srgb-linear";m==="encoding"?(m="colorSpace",y=y===3001?M:P):m==="outputEncoding"&&(m="outputColorSpace",y=y===3001?M:P)}let v=n,T=v[m];if(w.length&&(T=w.reduce((S,M)=>S[M],n),!(T&&T.set))){const[S,...M]=w.reverse();v=M.reverse().reduce((P,R)=>P[R],n),m=S}if(y===Hie+"remove")if(v.constructor){let S=n$.get(v.constructor);S||(S=new v.constructor,n$.set(v.constructor,S)),y=S[m]}else y=0;if(b&&i)y?i.handlers[m]=y:delete i.handlers[m],i.eventCount=Object.keys(i.handlers).length;else if(T&&T.set&&(T.copy||T instanceof Dm)){if(Array.isArray(y))T.fromArray?T.fromArray(y):T.set(...y);else if(T.copy&&y&&y.constructor&&(xOe?T.constructor.name===y.constructor.name:T.constructor===y.constructor))T.copy(y);else if(y!==void 0){var c;const S=(c=T)==null?void 0:c.isColor;!S&&T.setScalar?T.setScalar(y):T instanceof Dm&&y instanceof Dm?T.mask=y.mask:T.set(y),!Fie()&&s&&!s.linear&&S&&T.convertSRGBToLinear()}}else{var u;if(v[m]=y,(u=v[m])!=null&&u.isTexture&&v[m].format===Oo&&v[m].type===ca&&s){const S=v[m];hM(S)&&hM(s.gl)?S.colorSpace=s.gl.outputColorSpace:S.encoding=s.gl.outputEncoding}}Vg(n)}if(i&&i.parent&&n.raycast&&l!==i.eventCount){const p=HS(n).getState().internal,m=p.interaction.indexOf(n);m>-1&&p.interaction.splice(m,1),i.eventCount&&p.interaction.push(n)}return!(a.length===1&&a[0][0]==="onUpdate")&&a.length&&(t=n.__r3f)!=null&&t.parent&&YN(n),n}function Vg(n){var e,t;const i=(e=n.__r3f)==null||(t=e.root)==null||t.getState==null?void 0:t.getState();i&&i.internal.frames===0&&i.invalidate()}function YN(n){n.onUpdate==null||n.onUpdate(n)}function vOe(n,e){n.manual||(zie(n)?(n.left=e.width/-2,n.right=e.width/2,n.top=e.height/2,n.bottom=e.height/-2):n.aspect=e.width/e.height,n.updateProjectionMatrix(),n.updateMatrixWorld())}function k5(n){return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId}function bOe(){var n;const e=typeof self<"u"&&self||typeof window<"u"&&window;if(!e)return py.DefaultEventPriority;switch((n=e.event)==null?void 0:n.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return py.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return py.ContinuousEventPriority;default:return py.DefaultEventPriority}}function Wie(n,e,t,i){const r=t.get(e);r&&(t.delete(e),t.size===0&&(n.delete(i),r.target.releasePointerCapture(i)))}function _Oe(n,e){const{internal:t}=n.getState();t.interaction=t.interaction.filter(i=>i!==e),t.initialHits=t.initialHits.filter(i=>i!==e),t.hovered.forEach((i,r)=>{(i.eventObject===e||i.object===e)&&t.hovered.delete(r)}),t.capturedMap.forEach((i,r)=>{Wie(t.capturedMap,e,i,r)})}function wOe(n){function e(l){const{internal:c}=n.getState(),u=l.offsetX-c.initialClick[0],h=l.offsetY-c.initialClick[1];return Math.round(Math.sqrt(u*u+h*h))}function t(l){return l.filter(c=>["Move","Over","Enter","Out","Leave"].some(u=>{var h;return(h=c.__r3f)==null?void 0:h.handlers["onPointer"+u]}))}function i(l,c){const u=n.getState(),h=new Set,p=[],m=c?c(u.internal.interaction):u.internal.interaction;for(let v=0;v<m.length;v++){const T=Pv(m[v]);T&&(T.raycaster.camera=void 0)}u.previousRoot||u.events.compute==null||u.events.compute(l,u);function y(v){const T=Pv(v);if(!T||!T.events.enabled||T.raycaster.camera===null)return[];if(T.raycaster.camera===void 0){var S;T.events.compute==null||T.events.compute(l,T,(S=T.previousRoot)==null?void 0:S.getState()),T.raycaster.camera===void 0&&(T.raycaster.camera=null)}return T.raycaster.camera?T.raycaster.intersectObject(v,!0):[]}let b=m.flatMap(y).sort((v,T)=>{const S=Pv(v.object),M=Pv(T.object);return!S||!M?v.distance-T.distance:M.events.priority-S.events.priority||v.distance-T.distance}).filter(v=>{const T=k5(v);return h.has(T)?!1:(h.add(T),!0)});u.events.filter&&(b=u.events.filter(b,u));for(const v of b){let T=v.object;for(;T;){var w;(w=T.__r3f)!=null&&w.eventCount&&p.push({...v,eventObject:T}),T=T.parent}}if("pointerId"in l&&u.internal.capturedMap.has(l.pointerId))for(let v of u.internal.capturedMap.get(l.pointerId).values())h.has(k5(v.intersection))||p.push(v.intersection);return p}function r(l,c,u,h){const p=n.getState();if(l.length){const m={stopped:!1};for(const y of l){const b=Pv(y.object)||p,{raycaster:w,pointer:v,camera:T,internal:S}=b,M=new ye(v.x,v.y,0).unproject(T),P=I=>{var F,j;return(F=(j=S.capturedMap.get(I))==null?void 0:j.has(y.eventObject))!=null?F:!1},R=I=>{const F={intersection:y,target:c.target};S.capturedMap.has(I)?S.capturedMap.get(I).set(y.eventObject,F):S.capturedMap.set(I,new Map([[y.eventObject,F]])),c.target.setPointerCapture(I)},O=I=>{const F=S.capturedMap.get(I);F&&Wie(S.capturedMap,y.eventObject,F,I)};let B={};for(let I in c){let F=c[I];typeof F!="function"&&(B[I]=F)}let N={...y,...B,pointer:v,intersections:l,stopped:m.stopped,delta:u,unprojectedPoint:M,ray:w.ray,camera:T,stopPropagation(){const I="pointerId"in c&&S.capturedMap.get(c.pointerId);if((!I||I.has(y.eventObject))&&(N.stopped=m.stopped=!0,S.hovered.size&&Array.from(S.hovered.values()).find(F=>F.eventObject===y.eventObject))){const F=l.slice(0,l.indexOf(y));s([...F,y])}},target:{hasPointerCapture:P,setPointerCapture:R,releasePointerCapture:O},currentTarget:{hasPointerCapture:P,setPointerCapture:R,releasePointerCapture:O},nativeEvent:c};if(h(N),m.stopped===!0)break}}return l}function s(l){const{internal:c}=n.getState();for(const u of c.hovered.values())if(!l.length||!l.find(h=>h.object===u.object&&h.index===u.index&&h.instanceId===u.instanceId)){const p=u.eventObject.__r3f,m=p?.handlers;if(c.hovered.delete(k5(u)),p!=null&&p.eventCount){const y={...u,intersections:l};m.onPointerOut==null||m.onPointerOut(y),m.onPointerLeave==null||m.onPointerLeave(y)}}}function o(l,c){for(let u=0;u<c.length;u++){const h=c[u].__r3f;h==null||h.handlers.onPointerMissed==null||h.handlers.onPointerMissed(l)}}function a(l){switch(l){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return c=>{const{internal:u}=n.getState();"pointerId"in c&&u.capturedMap.has(c.pointerId)&&requestAnimationFrame(()=>{u.capturedMap.has(c.pointerId)&&(u.capturedMap.delete(c.pointerId),s([]))})}}return function(u){const{onPointerMissed:h,internal:p}=n.getState();p.lastEvent.current=u;const m=l==="onPointerMove",y=l==="onClick"||l==="onContextMenu"||l==="onDoubleClick",w=i(u,m?t:void 0),v=y?e(u):0;l==="onPointerDown"&&(p.initialClick=[u.offsetX,u.offsetY],p.initialHits=w.map(S=>S.eventObject)),y&&!w.length&&v<=2&&(o(u,p.interaction),h&&h(u)),m&&s(w);function T(S){const M=S.eventObject,P=M.__r3f,R=P?.handlers;if(P!=null&&P.eventCount)if(m){if(R.onPointerOver||R.onPointerEnter||R.onPointerOut||R.onPointerLeave){const O=k5(S),B=p.hovered.get(O);B?B.stopped&&S.stopPropagation():(p.hovered.set(O,S),R.onPointerOver==null||R.onPointerOver(S),R.onPointerEnter==null||R.onPointerEnter(S))}R.onPointerMove==null||R.onPointerMove(S)}else{const O=R[l];O?(!y||p.initialHits.includes(M))&&(o(u,p.interaction.filter(B=>!p.initialHits.includes(B))),O(S)):y&&p.initialHits.includes(M)&&o(u,p.interaction.filter(B=>!p.initialHits.includes(B)))}}r(w,u,v,T)}}return{handlePointer:a}}const Kie=n=>!!(n!=null&&n.render),qie=$.createContext(null),SOe=(n,e)=>{const t=lOe((a,l)=>{const c=new ye,u=new ye,h=new ye;function p(v=l().camera,T=u,S=l().size){const{width:M,height:P,top:R,left:O}=S,B=M/P;T.isVector3?h.copy(T):h.set(...T);const N=v.getWorldPosition(c).distanceTo(h);if(zie(v))return{width:M/v.zoom,height:P/v.zoom,top:R,left:O,factor:1,distance:N,aspect:B};{const I=v.fov*Math.PI/180,F=2*Math.tan(I/2)*N,j=F*(M/P);return{width:j,height:F,top:R,left:O,factor:M/j,distance:N,aspect:B}}}let m;const y=v=>a(T=>({performance:{...T.performance,current:v}})),b=new Et;return{set:a,get:l,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(v=1)=>n(l(),v),advance:(v,T)=>e(v,T,l()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new hO,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const v=l();m&&clearTimeout(m),v.performance.current!==v.performance.min&&y(v.performance.min),m=setTimeout(()=>y(l().performance.max),v.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:p},setEvents:v=>a(T=>({...T,events:{...T.events,...v}})),setSize:(v,T,S,M,P)=>{const R=l().camera,O={width:v,height:T,top:M||0,left:P||0,updateStyle:S};a(B=>({size:O,viewport:{...B.viewport,...p(R,u,O)}}))},setDpr:v=>a(T=>{const S=$ie(v);return{viewport:{...T.viewport,dpr:S,initialDpr:T.viewport.initialDpr||S}}}),setFrameloop:(v="always")=>{const T=l().clock;T.stop(),T.elapsedTime=0,v!=="never"&&(T.start(),T.elapsedTime=0),a(()=>({frameloop:v}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:$.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(v,T,S)=>{const M=l().internal;return M.priority=M.priority+(T>0?1:0),M.subscribers.push({ref:v,priority:T,store:S}),M.subscribers=M.subscribers.sort((P,R)=>P.priority-R.priority),()=>{const P=l().internal;P!=null&&P.subscribers&&(P.priority=P.priority-(T>0?1:0),P.subscribers=P.subscribers.filter(R=>R.ref!==v))}}}}}),i=t.getState();let r=i.size,s=i.viewport.dpr,o=i.camera;return t.subscribe(()=>{const{camera:a,size:l,viewport:c,gl:u,set:h}=t.getState();if(l.width!==r.width||l.height!==r.height||c.dpr!==s){var p;r=l,s=c.dpr,vOe(a,l),u.setPixelRatio(c.dpr);const m=(p=l.updateStyle)!=null?p:typeof HTMLCanvasElement<"u"&&u.domElement instanceof HTMLCanvasElement;u.setSize(l.width,l.height,m)}a!==o&&(o=a,h(m=>({viewport:{...m.viewport,...m.viewport.getCurrentViewport(a)}})))}),t.subscribe(a=>n(a)),t};let L5,EOe=new Set,TOe=new Set,AOe=new Set;function pM(n,e){if(n.size)for(const{callback:t}of n.values())t(e)}function kv(n,e){switch(n){case"before":return pM(EOe,e);case"after":return pM(TOe,e);case"tail":return pM(AOe,e)}}let mM,gM;function yM(n,e,t){let i=e.clock.getDelta();for(e.frameloop==="never"&&typeof n=="number"&&(i=n-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=n),mM=e.internal.subscribers,L5=0;L5<mM.length;L5++)gM=mM[L5],gM.ref.current(gM.store.getState(),i,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}function COe(n){let e=!1,t=!1,i,r,s;function o(c){r=requestAnimationFrame(o),e=!0,i=0,kv("before",c),t=!0;for(const h of n.values()){var u;s=h.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((u=s.gl.xr)!=null&&u.isPresenting)&&(i+=yM(c,s))}if(t=!1,kv("after",c),i===0)return kv("tail",c),e=!1,cancelAnimationFrame(r)}function a(c,u=1){var h;if(!c)return n.forEach(p=>a(p.store.getState(),u));(h=c.gl.xr)!=null&&h.isPresenting||!c.internal.active||c.frameloop==="never"||(u>1?c.internal.frames=Math.min(60,c.internal.frames+u):t?c.internal.frames=2:c.internal.frames=1,e||(e=!0,requestAnimationFrame(o)))}function l(c,u=!0,h,p){if(u&&kv("before",c),h)yM(c,h,p);else for(const m of n.values())yM(c,m.store.getState());u&&kv("after",c)}return{loop:o,invalidate:a,advance:l}}function Zie(){const n=$.useContext(qie);if(!n)throw new Error("R3F: Hooks can only be used within the Canvas component!");return n}function aa(n=t=>t,e){return Zie()(n,e)}function ew(n,e=0){const t=Zie(),i=t.getState().internal.subscribe,r=jie(n);return J_(()=>i(r,e,t),[e,i,t]),null}const J2=new Map,{invalidate:s$,advance:o$}=COe(J2),{reconciler:wE,applyProps:Cg}=fOe(J2,bOe),Mg={objects:"shallow",strict:!1},MOe=(n,e)=>{const t=typeof n=="function"?n(e):n;return Kie(t)?t:new Lie({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0,...n})};function ROe(n,e){const t=typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement;if(e){const{width:i,height:r,top:s,left:o,updateStyle:a=t}=e;return{width:i,height:r,top:s,left:o,updateStyle:a}}else if(typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement&&n.parentElement){const{width:i,height:r,top:s,left:o}=n.parentElement.getBoundingClientRect();return{width:i,height:r,top:s,left:o,updateStyle:t}}else if(typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height,top:0,left:0,updateStyle:t};return{width:0,height:0,top:0,left:0}}function IOe(n){const e=J2.get(n),t=e?.fiber,i=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const r=typeof reportError=="function"?reportError:console.error,s=i||SOe(s$,o$),o=t||wE.createContainer(s,py.ConcurrentRoot,null,!1,null,"",r,null);e||J2.set(n,{fiber:o,store:s});let a,l=!1,c;return{configure(u={}){let{gl:h,size:p,scene:m,events:y,onCreated:b,shadows:w=!1,linear:v=!1,flat:T=!1,legacy:S=!1,orthographic:M=!1,frameloop:P="always",dpr:R=[1,2],performance:O,raycaster:B,camera:N,onPointerMissed:I}=u,F=s.getState(),j=F.gl;F.gl||F.set({gl:j=MOe(h,n)});let W=F.raycaster;W||F.set({raycaster:W=new Aie});const{params:U,...H}=B||{};if(Cr.equ(H,W,Mg)||Cg(W,{...H}),Cr.equ(U,W.params,Mg)||Cg(W,{params:{...W.params,...U}}),!F.camera||F.camera===c&&!Cr.equ(c,N,Mg)){c=N;const Q=N instanceof W_,ne=Q?N:M?new Cd(0,0,0,0,.1,1e3):new ns(75,0,.1,1e3);Q||(ne.position.z=5,N&&(Cg(ne,N),("aspect"in N||"left"in N||"right"in N||"bottom"in N||"top"in N)&&(ne.manual=!0,ne.updateProjectionMatrix())),!F.camera&&!(N!=null&&N.rotation)&&ne.lookAt(0,0,0)),F.set({camera:ne}),W.camera=ne}if(!F.scene){let Q;m!=null&&m.isScene?Q=m:(Q=new VD,m&&Cg(Q,m)),F.set({scene:jg(Q)})}if(!F.xr){var q;const Q=(Ae,Pe)=>{const Ce=s.getState();Ce.frameloop!=="never"&&o$(Ae,!0,Ce,Pe)},ne=()=>{const Ae=s.getState();Ae.gl.xr.enabled=Ae.gl.xr.isPresenting,Ae.gl.xr.setAnimationLoop(Ae.gl.xr.isPresenting?Q:null),Ae.gl.xr.isPresenting||s$(Ae)},fe={connect(){const Ae=s.getState().gl;Ae.xr.addEventListener("sessionstart",ne),Ae.xr.addEventListener("sessionend",ne)},disconnect(){const Ae=s.getState().gl;Ae.xr.removeEventListener("sessionstart",ne),Ae.xr.removeEventListener("sessionend",ne)}};typeof((q=j.xr)==null?void 0:q.addEventListener)=="function"&&fe.connect(),F.set({xr:fe})}if(j.shadowMap){const Q=j.shadowMap.enabled,ne=j.shadowMap.type;if(j.shadowMap.enabled=!!w,Cr.boo(w))j.shadowMap.type=C3;else if(Cr.str(w)){var J;const fe={basic:zte,percentage:ky,soft:C3,variance:dm};j.shadowMap.type=(J=fe[w])!=null?J:C3}else Cr.obj(w)&&Object.assign(j.shadowMap,w);(Q!==j.shadowMap.enabled||ne!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const G=Fie();G&&("enabled"in G?G.enabled=!S:"legacyMode"in G&&(G.legacyMode=S)),l||Cg(j,{outputEncoding:v?3e3:3001,toneMapping:T?pc:w9}),F.legacy!==S&&F.set(()=>({legacy:S})),F.linear!==v&&F.set(()=>({linear:v})),F.flat!==T&&F.set(()=>({flat:T})),h&&!Cr.fun(h)&&!Kie(h)&&!Cr.equ(h,j,Mg)&&Cg(j,h),y&&!F.events.handlers&&F.set({events:y(s)});const ee=ROe(n,p);return Cr.equ(ee,F.size,Mg)||F.setSize(ee.width,ee.height,ee.updateStyle,ee.top,ee.left),R&&F.viewport.dpr!==$ie(R)&&F.setDpr(R),F.frameloop!==P&&F.setFrameloop(P),F.onPointerMissed||F.set({onPointerMissed:I}),O&&!Cr.equ(O,F.performance,Mg)&&F.set(Q=>({performance:{...Q.performance,...O}})),a=b,l=!0,this},render(u){return l||this.configure(),wE.updateContainer(f.jsx(NOe,{store:s,children:u,onCreated:a,rootElement:n}),o,null,()=>{}),s},unmount(){Yie(n)}}}function NOe({store:n,children:e,onCreated:t,rootElement:i}){return J_(()=>{const r=n.getState();r.set(s=>({internal:{...s.internal,active:!0}})),t&&t(r),n.getState().events.connected||r.events.connect==null||r.events.connect(i)},[]),f.jsx(qie.Provider,{value:n,children:e})}function Yie(n,e){const t=J2.get(n),i=t?.fiber;if(i){const r=t?.store.getState();r&&(r.internal.active=!1),wE.updateContainer(null,i,null,()=>{r&&setTimeout(()=>{try{var s,o,a,l;r.events.disconnect==null||r.events.disconnect(),(s=r.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(a=r.gl)==null||a.forceContextLoss==null||a.forceContextLoss(),(l=r.gl)!=null&&l.xr&&r.xr.disconnect(),yOe(r),J2.delete(n),e&&e(n)}catch{}},500)})}}wE.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:$.version});const xM={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function POe(n){const{handlePointer:e}=wOe(n);return{priority:1,enabled:!0,compute(t,i,r){i.pointer.set(t.offsetX/i.size.width*2-1,-(t.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(xM).reduce((t,i)=>({...t,[i]:e(i)}),{}),update:()=>{var t;const{events:i,internal:r}=n.getState();(t=r.lastEvent)!=null&&t.current&&i.handlers&&i.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var i;const{set:r,events:s}=n.getState();s.disconnect==null||s.disconnect(),r(o=>({events:{...o.events,connected:t}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([o,a])=>{const[l,c]=xM[o];t.addEventListener(l,a,{passive:c})})},disconnect:()=>{const{set:t,events:i}=n.getState();if(i.connected){var r;Object.entries((r=i.handlers)!=null?r:[]).forEach(([s,o])=>{if(i&&i.connected instanceof HTMLElement){const[a]=xM[s];i.connected.removeEventListener(a,o)}}),t(s=>({events:{...s.events,connected:void 0}}))}}}}function a$(n,e){let t;return(...i)=>{window.clearTimeout(t),t=window.setTimeout(()=>n(...i),e)}}function kOe({debounce:n,scroll:e,polyfill:t,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const r=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!r)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=$.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),a=$.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),l=n?typeof n=="number"?n:n.scroll:null,c=n?typeof n=="number"?n:n.resize:null,u=$.useRef(!1);$.useEffect(()=>(u.current=!0,()=>void(u.current=!1)));const[h,p,m]=$.useMemo(()=>{const v=()=>{if(!a.current.element)return;const{left:T,top:S,width:M,height:P,bottom:R,right:O,x:B,y:N}=a.current.element.getBoundingClientRect(),I={left:T,top:S,width:M,height:P,bottom:R,right:O,x:B,y:N};a.current.element instanceof HTMLElement&&i&&(I.height=a.current.element.offsetHeight,I.width=a.current.element.offsetWidth),Object.freeze(I),u.current&&!BOe(a.current.lastBounds,I)&&o(a.current.lastBounds=I)};return[v,c?a$(v,c):v,l?a$(v,l):v]},[o,i,l,c]);function y(){a.current.scrollContainers&&(a.current.scrollContainers.forEach(v=>v.removeEventListener("scroll",m,!0)),a.current.scrollContainers=null),a.current.resizeObserver&&(a.current.resizeObserver.disconnect(),a.current.resizeObserver=null),a.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",a.current.orientationHandler))}function b(){a.current.element&&(a.current.resizeObserver=new r(m),a.current.resizeObserver.observe(a.current.element),e&&a.current.scrollContainers&&a.current.scrollContainers.forEach(v=>v.addEventListener("scroll",m,{capture:!0,passive:!0})),a.current.orientationHandler=()=>{m()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",a.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",a.current.orientationHandler))}const w=v=>{!v||v===a.current.element||(y(),a.current.element=v,a.current.scrollContainers=Xie(v),b())};return DOe(m,!!e),LOe(p),$.useEffect(()=>{y(),b()},[e,m,p]),$.useEffect(()=>y,[]),[w,s,h]}function LOe(n){$.useEffect(()=>{const e=n;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[n])}function DOe(n,e){$.useEffect(()=>{if(e){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,e])}function Xie(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:i,overflowY:r}=window.getComputedStyle(n);return[t,i,r].some(s=>s==="auto"||s==="scroll")&&e.push(n),[...e,...Xie(n.parentElement)]}const OOe=["x","y","top","bottom","left","right","width","height"],BOe=(n,e)=>OOe.every(t=>n[t]===e[t]);var UOe=Object.defineProperty,FOe=Object.defineProperties,zOe=Object.getOwnPropertyDescriptors,l$=Object.getOwnPropertySymbols,jOe=Object.prototype.hasOwnProperty,VOe=Object.prototype.propertyIsEnumerable,c$=(n,e,t)=>e in n?UOe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,u$=(n,e)=>{for(var t in e||(e={}))jOe.call(e,t)&&c$(n,t,e[t]);if(l$)for(var t of l$(e))VOe.call(e,t)&&c$(n,t,e[t]);return n},HOe=(n,e)=>FOe(n,zOe(e)),h$,d$;typeof window<"u"&&((h$=window.document)!=null&&h$.createElement||((d$=window.navigator)==null?void 0:d$.product)==="ReactNative")?$.useLayoutEffect:$.useEffect;function Qie(n,e,t){if(!n)return;if(t(n)===!0)return n;let i=e?n.return:n.child;for(;i;){const r=Qie(i,e,t);if(r)return r;i=e?null:i.sibling}}function Jie(n){try{return Object.defineProperties(n,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return n}}const f$=console.error;console.error=function(){const n=[...arguments].join("");if(n?.startsWith("Warning:")&&n.includes("useContext")){console.error=f$;return}return f$.apply(this,arguments)};const yO=Jie($.createContext(null));class ere extends $.Component{render(){return $.createElement(yO.Provider,{value:this._reactInternals},this.props.children)}}function $Oe(){const n=$.useContext(yO);if(n===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=$.useId();return $.useMemo(()=>{for(const i of[n,n?.alternate]){if(!i)continue;const r=Qie(i,!1,s=>{let o=s.memoizedState;for(;o;){if(o.memoizedState===e)return!0;o=o.next}});if(r)return r}},[n,e])}function GOe(){const n=$Oe(),[e]=$.useState(()=>new Map);e.clear();let t=n;for(;t;){if(t.type&&typeof t.type=="object"){const r=t.type._context===void 0&&t.type.Provider===t.type?t.type:t.type._context;r&&r!==yO&&!e.has(r)&&e.set(r,$.useContext(Jie(r)))}t=t.return}return e}function WOe(){const n=GOe();return $.useMemo(()=>Array.from(n.keys()).reduce((e,t)=>i=>$.createElement(e,null,$.createElement(t.Provider,HOe(u$({},i),{value:n.get(t)}))),e=>$.createElement(ere,u$({},e))),[n])}const KOe=$.forwardRef(function({children:e,fallback:t,resize:i,style:r,gl:s,events:o=POe,eventSource:a,eventPrefix:l,shadows:c,linear:u,flat:h,legacy:p,orthographic:m,frameloop:y,dpr:b,performance:w,raycaster:v,camera:T,scene:S,onPointerMissed:M,onCreated:P,...R},O){$.useMemo(()=>dOe(sOe),[]);const B=WOe(),[N,I]=kOe({scroll:!0,debounce:{scroll:50,resize:0},...i}),F=$.useRef(null),j=$.useRef(null);$.useImperativeHandle(O,()=>F.current);const W=jie(M),[U,H]=$.useState(!1),[q,J]=$.useState(!1);if(U)throw U;if(q)throw q;const G=$.useRef(null);J_(()=>{const Q=F.current;I.width>0&&I.height>0&&Q&&(G.current||(G.current=IOe(Q)),G.current.configure({gl:s,events:o,shadows:c,linear:u,flat:h,legacy:p,orthographic:m,frameloop:y,dpr:b,performance:w,raycaster:v,camera:T,scene:S,size:I,onPointerMissed:(...ne)=>W.current==null?void 0:W.current(...ne),onCreated:ne=>{ne.events.connect==null||ne.events.connect(a?pOe(a)?a.current:a:j.current),l&&ne.setEvents({compute:(fe,Ae)=>{const Pe=fe[l+"X"],Ce=fe[l+"Y"];Ae.pointer.set(Pe/Ae.size.width*2-1,-(Ce/Ae.size.height)*2+1),Ae.raycaster.setFromCamera(Ae.pointer,Ae.camera)}}),P?.(ne)}}),G.current.render(f.jsx(B,{children:f.jsx(Vie,{set:J,children:f.jsx($.Suspense,{fallback:f.jsx(mOe,{set:H}),children:e??null})})})))}),$.useEffect(()=>{const Q=F.current;if(Q)return()=>Yie(Q)},[]);const ee=a?"none":"auto";return f.jsx("div",{ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ee,...r},...R,children:f.jsx("div",{ref:N,style:{width:"100%",height:"100%"},children:f.jsx("canvas",{ref:F,style:{display:"block"},children:t})})})}),qOe=$.forwardRef(function(e,t){return f.jsx(ere,{children:f.jsx(KOe,{...e,ref:t})})});function SE(){return SE=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},SE.apply(null,arguments)}var ZOe=Object.defineProperty,YOe=(n,e,t)=>e in n?ZOe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,XOe=(n,e,t)=>(YOe(n,typeof e!="symbol"?e+"":e,t),t);let QOe=class{constructor(){XOe(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}};var JOe=Object.defineProperty,eBe=(n,e,t)=>e in n?JOe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Pn=(n,e,t)=>(eBe(n,typeof e!="symbol"?e+"":e,t),t);const D5=new E1,p$=new rd,tBe=Math.cos(70*(Math.PI/180)),m$=(n,e)=>(n%e+e)%e;let nBe=class extends QOe{constructor(e,t){super(),Pn(this,"object"),Pn(this,"domElement"),Pn(this,"enabled",!0),Pn(this,"target",new ye),Pn(this,"minDistance",0),Pn(this,"maxDistance",1/0),Pn(this,"minZoom",0),Pn(this,"maxZoom",1/0),Pn(this,"minPolarAngle",0),Pn(this,"maxPolarAngle",Math.PI),Pn(this,"minAzimuthAngle",-1/0),Pn(this,"maxAzimuthAngle",1/0),Pn(this,"enableDamping",!1),Pn(this,"dampingFactor",.05),Pn(this,"enableZoom",!0),Pn(this,"zoomSpeed",1),Pn(this,"enableRotate",!0),Pn(this,"rotateSpeed",1),Pn(this,"enablePan",!0),Pn(this,"panSpeed",1),Pn(this,"screenSpacePanning",!0),Pn(this,"keyPanSpeed",7),Pn(this,"zoomToCursor",!1),Pn(this,"autoRotate",!1),Pn(this,"autoRotateSpeed",2),Pn(this,"reverseOrbit",!1),Pn(this,"reverseHorizontalOrbit",!1),Pn(this,"reverseVerticalOrbit",!1),Pn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),Pn(this,"mouseButtons",{LEFT:Gp.ROTATE,MIDDLE:Gp.DOLLY,RIGHT:Gp.PAN}),Pn(this,"touches",{ONE:Wp.ROTATE,TWO:Wp.DOLLY_PAN}),Pn(this,"target0"),Pn(this,"position0"),Pn(this,"zoom0"),Pn(this,"_domElementKeyEvents",null),Pn(this,"getPolarAngle"),Pn(this,"getAzimuthalAngle"),Pn(this,"setPolarAngle"),Pn(this,"setAzimuthalAngle"),Pn(this,"getDistance"),Pn(this,"getZoomScale"),Pn(this,"listenToKeyEvents"),Pn(this,"stopListenToKeyEvents"),Pn(this,"saveState"),Pn(this,"reset"),Pn(this,"update"),Pn(this,"connect"),Pn(this,"dispose"),Pn(this,"dollyIn"),Pn(this,"dollyOut"),Pn(this,"getScale"),Pn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=ue=>{let Ie=m$(ue,2*Math.PI),ft=u.phi;ft<0&&(ft+=2*Math.PI),Ie<0&&(Ie+=2*Math.PI);let xe=Math.abs(Ie-ft);2*Math.PI-xe<xe&&(Ie<ft?Ie+=2*Math.PI:ft+=2*Math.PI),h.phi=Ie-ft,i.update()},this.setAzimuthalAngle=ue=>{let Ie=m$(ue,2*Math.PI),ft=u.theta;ft<0&&(ft+=2*Math.PI),Ie<0&&(Ie+=2*Math.PI);let xe=Math.abs(Ie-ft);2*Math.PI-xe<xe&&(Ie<ft?Ie+=2*Math.PI:ft+=2*Math.PI),h.theta=Ie-ft,i.update()},this.getDistance=()=>i.object.position.distanceTo(i.target),this.listenToKeyEvents=ue=>{ue.addEventListener("keydown",tt),this._domElementKeyEvents=ue},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",tt),this._domElementKeyEvents=null},this.saveState=()=>{i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=()=>{i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(r),i.update(),l=a.NONE},this.update=(()=>{const ue=new ye,Ie=new ye(0,1,0),ft=new Uo().setFromUnitVectors(e.up,Ie),xe=ft.clone().invert(),pt=new ye,ge=new Uo,Qe=2*Math.PI;return function(){const at=i.object.position;ft.setFromUnitVectors(e.up,Ie),xe.copy(ft).invert(),ue.copy(at).sub(i.target),ue.applyQuaternion(ft),u.setFromVector3(ue),i.autoRotate&&l===a.NONE&&U(j()),i.enableDamping?(u.theta+=h.theta*i.dampingFactor,u.phi+=h.phi*i.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let yt=i.minAzimuthAngle,Gt=i.maxAzimuthAngle;isFinite(yt)&&isFinite(Gt)&&(yt<-Math.PI?yt+=Qe:yt>Math.PI&&(yt-=Qe),Gt<-Math.PI?Gt+=Qe:Gt>Math.PI&&(Gt-=Qe),yt<=Gt?u.theta=Math.max(yt,Math.min(Gt,u.theta)):u.theta=u.theta>(yt+Gt)/2?Math.max(yt,u.theta):Math.min(Gt,u.theta)),u.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,u.phi)),u.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(m,i.dampingFactor):i.target.add(m),i.zoomToCursor&&N||i.object.isOrthographicCamera?u.radius=Ae(u.radius):u.radius=Ae(u.radius*p),ue.setFromSpherical(u),ue.applyQuaternion(xe),at.copy(i.target).add(ue),i.object.matrixAutoUpdate||i.object.updateMatrix(),i.object.lookAt(i.target),i.enableDamping===!0?(h.theta*=1-i.dampingFactor,h.phi*=1-i.dampingFactor,m.multiplyScalar(1-i.dampingFactor)):(h.set(0,0,0),m.set(0,0,0));let on=!1;if(i.zoomToCursor&&N){let mn=null;if(i.object instanceof ns&&i.object.isPerspectiveCamera){const Cn=ue.length();mn=Ae(Cn*p);const gi=Cn-mn;i.object.position.addScaledVector(O,gi),i.object.updateMatrixWorld()}else if(i.object.isOrthographicCamera){const Cn=new ye(B.x,B.y,0);Cn.unproject(i.object),i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/p)),i.object.updateProjectionMatrix(),on=!0;const gi=new ye(B.x,B.y,0);gi.unproject(i.object),i.object.position.sub(gi).add(Cn),i.object.updateMatrixWorld(),mn=ue.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;mn!==null&&(i.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(mn).add(i.object.position):(D5.origin.copy(i.object.position),D5.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(D5.direction))<tBe?e.lookAt(i.target):(p$.setFromNormalAndCoplanarPoint(i.object.up,i.target),D5.intersectPlane(p$,i.target))))}else i.object instanceof Cd&&i.object.isOrthographicCamera&&(on=p!==1,on&&(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/p)),i.object.updateProjectionMatrix()));return p=1,N=!1,on||pt.distanceToSquared(i.object.position)>c||8*(1-ge.dot(i.object.quaternion))>c?(i.dispatchEvent(r),pt.copy(i.object.position),ge.copy(i.object.quaternion),on=!1,!0):!1}})(),this.connect=ue=>{i.domElement=ue,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",Ot),i.domElement.addEventListener("pointerdown",Ye),i.domElement.addEventListener("pointercancel",Z),i.domElement.addEventListener("wheel",ct)},this.dispose=()=>{var ue,Ie,ft,xe,pt,ge;i.domElement&&(i.domElement.style.touchAction="auto"),(ue=i.domElement)==null||ue.removeEventListener("contextmenu",Ot),(Ie=i.domElement)==null||Ie.removeEventListener("pointerdown",Ye),(ft=i.domElement)==null||ft.removeEventListener("pointercancel",Z),(xe=i.domElement)==null||xe.removeEventListener("wheel",ct),(pt=i.domElement)==null||pt.ownerDocument.removeEventListener("pointermove",oe),(ge=i.domElement)==null||ge.ownerDocument.removeEventListener("pointerup",Z),i._domElementKeyEvents!==null&&i._domElementKeyEvents.removeEventListener("keydown",tt)};const i=this,r={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const c=1e-6,u=new HN,h=new HN;let p=1;const m=new ye,y=new Et,b=new Et,w=new Et,v=new Et,T=new Et,S=new Et,M=new Et,P=new Et,R=new Et,O=new ye,B=new Et;let N=!1;const I=[],F={};function j(){return 2*Math.PI/60/60*i.autoRotateSpeed}function W(){return Math.pow(.95,i.zoomSpeed)}function U(ue){i.reverseOrbit||i.reverseHorizontalOrbit?h.theta+=ue:h.theta-=ue}function H(ue){i.reverseOrbit||i.reverseVerticalOrbit?h.phi+=ue:h.phi-=ue}const q=(()=>{const ue=new ye;return function(ft,xe){ue.setFromMatrixColumn(xe,0),ue.multiplyScalar(-ft),m.add(ue)}})(),J=(()=>{const ue=new ye;return function(ft,xe){i.screenSpacePanning===!0?ue.setFromMatrixColumn(xe,1):(ue.setFromMatrixColumn(xe,0),ue.crossVectors(i.object.up,ue)),ue.multiplyScalar(ft),m.add(ue)}})(),G=(()=>{const ue=new ye;return function(ft,xe){const pt=i.domElement;if(pt&&i.object instanceof ns&&i.object.isPerspectiveCamera){const ge=i.object.position;ue.copy(ge).sub(i.target);let Qe=ue.length();Qe*=Math.tan(i.object.fov/2*Math.PI/180),q(2*ft*Qe/pt.clientHeight,i.object.matrix),J(2*xe*Qe/pt.clientHeight,i.object.matrix)}else pt&&i.object instanceof Cd&&i.object.isOrthographicCamera?(q(ft*(i.object.right-i.object.left)/i.object.zoom/pt.clientWidth,i.object.matrix),J(xe*(i.object.top-i.object.bottom)/i.object.zoom/pt.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}})();function ee(ue){i.object instanceof ns&&i.object.isPerspectiveCamera||i.object instanceof Cd&&i.object.isOrthographicCamera?p=ue:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Q(ue){ee(p/ue)}function ne(ue){ee(p*ue)}function fe(ue){if(!i.zoomToCursor||!i.domElement)return;N=!0;const Ie=i.domElement.getBoundingClientRect(),ft=ue.clientX-Ie.left,xe=ue.clientY-Ie.top,pt=Ie.width,ge=Ie.height;B.x=ft/pt*2-1,B.y=-(xe/ge)*2+1,O.set(B.x,B.y,1).unproject(i.object).sub(i.object.position).normalize()}function Ae(ue){return Math.max(i.minDistance,Math.min(i.maxDistance,ue))}function Pe(ue){y.set(ue.clientX,ue.clientY)}function Ce(ue){fe(ue),M.set(ue.clientX,ue.clientY)}function de(ue){v.set(ue.clientX,ue.clientY)}function Ne(ue){b.set(ue.clientX,ue.clientY),w.subVectors(b,y).multiplyScalar(i.rotateSpeed);const Ie=i.domElement;Ie&&(U(2*Math.PI*w.x/Ie.clientHeight),H(2*Math.PI*w.y/Ie.clientHeight)),y.copy(b),i.update()}function et(ue){P.set(ue.clientX,ue.clientY),R.subVectors(P,M),R.y>0?Q(W()):R.y<0&&ne(W()),M.copy(P),i.update()}function me(ue){T.set(ue.clientX,ue.clientY),S.subVectors(T,v).multiplyScalar(i.panSpeed),G(S.x,S.y),v.copy(T),i.update()}function nt(ue){fe(ue),ue.deltaY<0?ne(W()):ue.deltaY>0&&Q(W()),i.update()}function Pt(ue){let Ie=!1;switch(ue.code){case i.keys.UP:G(0,i.keyPanSpeed),Ie=!0;break;case i.keys.BOTTOM:G(0,-i.keyPanSpeed),Ie=!0;break;case i.keys.LEFT:G(i.keyPanSpeed,0),Ie=!0;break;case i.keys.RIGHT:G(-i.keyPanSpeed,0),Ie=!0;break}Ie&&(ue.preventDefault(),i.update())}function zt(){if(I.length==1)y.set(I[0].pageX,I[0].pageY);else{const ue=.5*(I[0].pageX+I[1].pageX),Ie=.5*(I[0].pageY+I[1].pageY);y.set(ue,Ie)}}function Dt(){if(I.length==1)v.set(I[0].pageX,I[0].pageY);else{const ue=.5*(I[0].pageX+I[1].pageX),Ie=.5*(I[0].pageY+I[1].pageY);v.set(ue,Ie)}}function gt(){const ue=I[0].pageX-I[1].pageX,Ie=I[0].pageY-I[1].pageY,ft=Math.sqrt(ue*ue+Ie*Ie);M.set(0,ft)}function vt(){i.enableZoom&&gt(),i.enablePan&&Dt()}function Oe(){i.enableZoom&&gt(),i.enableRotate&&zt()}function xt(ue){if(I.length==1)b.set(ue.pageX,ue.pageY);else{const ft=ut(ue),xe=.5*(ue.pageX+ft.x),pt=.5*(ue.pageY+ft.y);b.set(xe,pt)}w.subVectors(b,y).multiplyScalar(i.rotateSpeed);const Ie=i.domElement;Ie&&(U(2*Math.PI*w.x/Ie.clientHeight),H(2*Math.PI*w.y/Ie.clientHeight)),y.copy(b)}function pe(ue){if(I.length==1)T.set(ue.pageX,ue.pageY);else{const Ie=ut(ue),ft=.5*(ue.pageX+Ie.x),xe=.5*(ue.pageY+Ie.y);T.set(ft,xe)}S.subVectors(T,v).multiplyScalar(i.panSpeed),G(S.x,S.y),v.copy(T)}function qe(ue){const Ie=ut(ue),ft=ue.pageX-Ie.x,xe=ue.pageY-Ie.y,pt=Math.sqrt(ft*ft+xe*xe);P.set(0,pt),R.set(0,Math.pow(P.y/M.y,i.zoomSpeed)),Q(R.y),M.copy(P)}function $e(ue){i.enableZoom&&qe(ue),i.enablePan&&pe(ue)}function Xe(ue){i.enableZoom&&qe(ue),i.enableRotate&&xt(ue)}function Ye(ue){var Ie,ft;i.enabled!==!1&&(I.length===0&&((Ie=i.domElement)==null||Ie.ownerDocument.addEventListener("pointermove",oe),(ft=i.domElement)==null||ft.ownerDocument.addEventListener("pointerup",Z)),nn(ue),ue.pointerType==="touch"?Lt(ue):he(ue))}function oe(ue){i.enabled!==!1&&(ue.pointerType==="touch"?Ct(ue):Ge(ue))}function Z(ue){var Ie,ft,xe;Tt(ue),I.length===0&&((Ie=i.domElement)==null||Ie.releasePointerCapture(ue.pointerId),(ft=i.domElement)==null||ft.ownerDocument.removeEventListener("pointermove",oe),(xe=i.domElement)==null||xe.ownerDocument.removeEventListener("pointerup",Z)),i.dispatchEvent(o),l=a.NONE}function he(ue){let Ie;switch(ue.button){case 0:Ie=i.mouseButtons.LEFT;break;case 1:Ie=i.mouseButtons.MIDDLE;break;case 2:Ie=i.mouseButtons.RIGHT;break;default:Ie=-1}switch(Ie){case Gp.DOLLY:if(i.enableZoom===!1)return;Ce(ue),l=a.DOLLY;break;case Gp.ROTATE:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(i.enablePan===!1)return;de(ue),l=a.PAN}else{if(i.enableRotate===!1)return;Pe(ue),l=a.ROTATE}break;case Gp.PAN:if(ue.ctrlKey||ue.metaKey||ue.shiftKey){if(i.enableRotate===!1)return;Pe(ue),l=a.ROTATE}else{if(i.enablePan===!1)return;de(ue),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(s)}function Ge(ue){if(i.enabled!==!1)switch(l){case a.ROTATE:if(i.enableRotate===!1)return;Ne(ue);break;case a.DOLLY:if(i.enableZoom===!1)return;et(ue);break;case a.PAN:if(i.enablePan===!1)return;me(ue);break}}function ct(ue){i.enabled===!1||i.enableZoom===!1||l!==a.NONE&&l!==a.ROTATE||(ue.preventDefault(),i.dispatchEvent(s),nt(ue),i.dispatchEvent(o))}function tt(ue){i.enabled===!1||i.enablePan===!1||Pt(ue)}function Lt(ue){switch(Ve(ue),I.length){case 1:switch(i.touches.ONE){case Wp.ROTATE:if(i.enableRotate===!1)return;zt(),l=a.TOUCH_ROTATE;break;case Wp.PAN:if(i.enablePan===!1)return;Dt(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(i.touches.TWO){case Wp.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;vt(),l=a.TOUCH_DOLLY_PAN;break;case Wp.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Oe(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&i.dispatchEvent(s)}function Ct(ue){switch(Ve(ue),l){case a.TOUCH_ROTATE:if(i.enableRotate===!1)return;xt(ue),i.update();break;case a.TOUCH_PAN:if(i.enablePan===!1)return;pe(ue),i.update();break;case a.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;$e(ue),i.update();break;case a.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;Xe(ue),i.update();break;default:l=a.NONE}}function Ot(ue){i.enabled!==!1&&ue.preventDefault()}function nn(ue){I.push(ue)}function Tt(ue){delete F[ue.pointerId];for(let Ie=0;Ie<I.length;Ie++)if(I[Ie].pointerId==ue.pointerId){I.splice(Ie,1);return}}function Ve(ue){let Ie=F[ue.pointerId];Ie===void 0&&(Ie=new Et,F[ue.pointerId]=Ie),Ie.set(ue.pageX,ue.pageY)}function ut(ue){const Ie=ue.pointerId===I[0].pointerId?I[1]:I[0];return F[Ie.pointerId]}this.dollyIn=(ue=W())=>{ne(ue),i.update()},this.dollyOut=(ue=W())=>{Q(ue),i.update()},this.getScale=()=>p,this.setScale=ue=>{ee(ue),i.update()},this.getZoomScale=()=>W(),t!==void 0&&this.connect(t),this.update()}};function iBe(n,e,t){const i=aa(p=>p.size),r=aa(p=>p.viewport),s=typeof n=="number"?n:i.width*r.dpr,o=typeof e=="number"?e:i.height*r.dpr,a=(typeof n=="number"?t:n)||{},{samples:l=0,depth:c,...u}=a,h=$.useMemo(()=>{const p=new Xa(s,o,{minFilter:mr,magFilter:mr,type:du,...u});return c&&(p.depthTexture=new s1(s,o,Do)),p.samples=l,p},[]);return $.useLayoutEffect(()=>{h.setSize(s,o),l&&(h.samples=l)},[l,h,s,o]),$.useEffect(()=>()=>h.dispose(),[]),h}const rBe=n=>typeof n=="function",sBe=$.forwardRef(({envMap:n,resolution:e=256,frames:t=1/0,makeDefault:i,children:r,...s},o)=>{const a=aa(({set:w})=>w),l=aa(({camera:w})=>w),c=aa(({size:w})=>w),u=$.useRef(null);$.useImperativeHandle(o,()=>u.current,[]);const h=$.useRef(null),p=iBe(e);$.useLayoutEffect(()=>{s.manual||(u.current.aspect=c.width/c.height)},[c,s]),$.useLayoutEffect(()=>{u.current.updateProjectionMatrix()});let m=0,y=null;const b=rBe(r);return ew(w=>{b&&(t===1/0||m<t)&&(h.current.visible=!1,w.gl.setRenderTarget(p),y=w.scene.background,n&&(w.scene.background=n),w.gl.render(w.scene,u.current),w.scene.background=y,w.gl.setRenderTarget(null),h.current.visible=!0,m++)}),$.useLayoutEffect(()=>{if(i){const w=l;return a(()=>({camera:u.current})),()=>a(()=>({camera:w}))}},[u,i,a]),$.createElement($.Fragment,null,$.createElement("perspectiveCamera",SE({ref:u},s),!b&&r),$.createElement("group",{ref:h},b&&r(p.texture)))}),oBe=$.forwardRef(({makeDefault:n,camera:e,regress:t,domElement:i,enableDamping:r=!0,keyEvents:s=!1,onChange:o,onStart:a,onEnd:l,...c},u)=>{const h=aa(R=>R.invalidate),p=aa(R=>R.camera),m=aa(R=>R.gl),y=aa(R=>R.events),b=aa(R=>R.setEvents),w=aa(R=>R.set),v=aa(R=>R.get),T=aa(R=>R.performance),S=e||p,M=i||y.connected||m.domElement,P=$.useMemo(()=>new nBe(S),[S]);return ew(()=>{P.enabled&&P.update()},-1),$.useEffect(()=>(s&&P.connect(s===!0?M:s),P.connect(M),()=>void P.dispose()),[s,M,t,P,h]),$.useEffect(()=>{const R=N=>{h(),t&&T.regress(),o&&o(N)},O=N=>{a&&a(N)},B=N=>{l&&l(N)};return P.addEventListener("change",R),P.addEventListener("start",O),P.addEventListener("end",B),()=>{P.removeEventListener("start",O),P.removeEventListener("end",B),P.removeEventListener("change",R)}},[o,a,l,P,h,b]),$.useEffect(()=>{if(n){const R=v().controls;return w({controls:P}),()=>w({controls:R})}},[n,P]),$.createElement("primitive",SE({ref:u,object:P,enableDamping:r},c))}),aBe="modulepreload",lBe=function(n){return"/"+n},g$={},cBe=function(e,t,i){if(!t||t.length===0)return e();const r=document.getElementsByTagName("link");return Promise.all(t.map(s=>{if(s=lBe(s),s in g$)return;g$[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=r.length-1;u>=0;u--){const h=r[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":aBe,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const tre="160",y$=0,kje=1,uBe=2,x$=1,v$=100,b$=204,_$=205,w$=3,nre=300,S$=1e3,O5=1001,E$=1002,T$=1003,gm=1006,hBe=1008,dBe=1009,fBe=1014,pBe=1015,mBe=1020,gBe=1023,vM=1026,A$=1027,yBe=3e3,bM=3001,$S="",Zc="srgb",xO="srgb-linear",xBe="display-p3",ire="display-p3-linear",XN="linear",C$="srgb",M$="rec709",R$="p3",Rg=7680,I$=519,vBe=515,N$=35044,B5=2e3,P$=2001;class iT{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const wo=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function tw(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(wo[n&255]+wo[n>>8&255]+wo[n>>16&255]+wo[n>>24&255]+"-"+wo[e&255]+wo[e>>8&255]+"-"+wo[e>>16&15|64]+wo[e>>24&255]+"-"+wo[t&63|128]+wo[t>>8&255]+"-"+wo[t>>16&255]+wo[t>>24&255]+wo[i&255]+wo[i>>8&255]+wo[i>>16&255]+wo[i>>24&255]).toLowerCase()}function Oa(n,e,t){return Math.max(e,Math.min(t,n))}function bBe(n,e){return(n%e+e)%e}function _M(n,e,t){return(1-t)*n+t*e}function Lv(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Aa(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}class so{constructor(e=0,t=0){so.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Oa(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class X0{constructor(e,t,i,r,s,o,a,l,c){X0.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c)}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],h=i[7],p=i[2],m=i[5],y=i[8],b=r[0],w=r[3],v=r[6],T=r[1],S=r[4],M=r[7],P=r[2],R=r[5],O=r[8];return s[0]=o*b+a*T+l*P,s[3]=o*w+a*S+l*R,s[6]=o*v+a*M+l*O,s[1]=c*b+u*T+h*P,s[4]=c*w+u*S+h*R,s[7]=c*v+u*M+h*O,s[2]=p*b+m*T+y*P,s[5]=p*w+m*S+y*R,s[8]=p*v+m*M+y*O,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,p=a*l-u*s,m=c*s-o*l,y=t*h+i*p+r*m;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const b=1/y;return e[0]=h*b,e[1]=(r*c-u*i)*b,e[2]=(a*i-r*o)*b,e[3]=p*b,e[4]=(u*t-r*l)*b,e[5]=(r*s-a*t)*b,e[6]=m*b,e[7]=(i*l-c*t)*b,e[8]=(o*t-i*s)*b,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(wM.makeScale(e,t)),this}rotate(e){return this.premultiply(wM.makeRotation(-e)),this}translate(e,t){return this.premultiply(wM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const wM=new X0;function _Be(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function QN(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}const k$={};function SM(n){n in k$||(k$[n]=!0,console.warn(n))}const L$=new X0().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),D$=new X0().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),U5={[xO]:{transfer:XN,primaries:M$,toReference:n=>n,fromReference:n=>n},[Zc]:{transfer:C$,primaries:M$,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[ire]:{transfer:XN,primaries:R$,toReference:n=>n.applyMatrix3(D$),fromReference:n=>n.applyMatrix3(L$)},[xBe]:{transfer:C$,primaries:R$,toReference:n=>n.convertSRGBToLinear().applyMatrix3(D$),fromReference:n=>n.applyMatrix3(L$).convertLinearToSRGB()}},wBe=new Set([xO,ire]),Bc={enabled:!0,_workingColorSpace:xO,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!wBe.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=U5[e].toReference,r=U5[t].fromReference;return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return U5[n].primaries},getTransfer:function(n){return n===$S?XN:U5[n].transfer}};function Dy(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function EM(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Ig;class SBe{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Ig===void 0&&(Ig=QN("canvas")),Ig.width=e.width,Ig.height=e.height;const i=Ig.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ig}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=QN("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=Dy(s[o]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Dy(t[i]/255)*255):t[i]=Dy(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let EBe=0;class TBe{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:EBe++}),this.uuid=tw(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)r[o].isDataTexture?s.push(TM(r[o].image)):s.push(TM(r[o]))}else s=TM(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function TM(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?SBe.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ABe=0;class lh extends iT{constructor(e=lh.DEFAULT_IMAGE,t=lh.DEFAULT_MAPPING,i=O5,r=O5,s=gm,o=hBe,a=gBe,l=dBe,c=lh.DEFAULT_ANISOTROPY,u=$S){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ABe++}),this.uuid=tw(),this.name="",this.source=new TBe(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=s,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new so(0,0),this.repeat=new so(1,1),this.center=new so(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new X0,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof u=="string"?this.colorSpace=u:(SM("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=u===bM?Zc:$S),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==nre)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case S$:e.x=e.x-Math.floor(e.x);break;case O5:e.x=e.x<0?0:1;break;case E$:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case S$:e.y=e.y-Math.floor(e.y);break;case O5:e.y=e.y<0?0:1;break;case E$:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return SM("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===Zc?bM:yBe}set encoding(e){SM("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=e===bM?Zc:$S}}lh.DEFAULT_IMAGE=null;lh.DEFAULT_MAPPING=nre;lh.DEFAULT_ANISOTROPY=1;class nw{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],h=i[r+3];const p=s[o+0],m=s[o+1],y=s[o+2],b=s[o+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=p,e[t+1]=m,e[t+2]=y,e[t+3]=b;return}if(h!==b||l!==p||c!==m||u!==y){let w=1-a;const v=l*p+c*m+u*y+h*b,T=v>=0?1:-1,S=1-v*v;if(S>Number.EPSILON){const P=Math.sqrt(S),R=Math.atan2(P,v*T);w=Math.sin(w*R)/P,a=Math.sin(a*R)/P}const M=a*T;if(l=l*w+p*M,c=c*w+m*M,u=u*w+y*M,h=h*w+b*M,w===1-a){const P=1/Math.sqrt(l*l+c*c+u*u+h*h);l*=P,c*=P,u*=P,h*=P}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],h=s[o],p=s[o+1],m=s[o+2],y=s[o+3];return e[t]=a*y+u*h+l*m-c*p,e[t+1]=l*y+u*p+c*h-a*m,e[t+2]=c*y+u*m+a*p-l*h,e[t+3]=u*y-a*h-l*p-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),h=a(s/2),p=l(i/2),m=l(r/2),y=l(s/2);switch(o){case"XYZ":this._x=p*u*h+c*m*y,this._y=c*m*h-p*u*y,this._z=c*u*y+p*m*h,this._w=c*u*h-p*m*y;break;case"YXZ":this._x=p*u*h+c*m*y,this._y=c*m*h-p*u*y,this._z=c*u*y-p*m*h,this._w=c*u*h+p*m*y;break;case"ZXY":this._x=p*u*h-c*m*y,this._y=c*m*h+p*u*y,this._z=c*u*y+p*m*h,this._w=c*u*h-p*m*y;break;case"ZYX":this._x=p*u*h-c*m*y,this._y=c*m*h+p*u*y,this._z=c*u*y-p*m*h,this._w=c*u*h+p*m*y;break;case"YZX":this._x=p*u*h+c*m*y,this._y=c*m*h+p*u*y,this._z=c*u*y-p*m*h,this._w=c*u*h-p*m*y;break;case"XZY":this._x=p*u*h-c*m*y,this._y=c*m*h-p*u*y,this._z=c*u*y+p*m*h,this._w=c*u*h+p*m*y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],h=t[10],p=i+a+h;if(p>0){const m=.5/Math.sqrt(p+1);this._w=.25/m,this._x=(u-l)*m,this._y=(s-c)*m,this._z=(o-r)*m}else if(i>a&&i>h){const m=2*Math.sqrt(1+i-a-h);this._w=(u-l)/m,this._x=.25*m,this._y=(r+o)/m,this._z=(s+c)/m}else if(a>h){const m=2*Math.sqrt(1+a-i-h);this._w=(s-c)/m,this._x=(r+o)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+h-i-a);this._w=(o-r)/m,this._x=(s+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Oa(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-t;return this._w=m*o+t*this._w,this._x=m*i+t*this._x,this._y=m*r+t*this._y,this._z=m*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),h=Math.sin((1-t)*u)/c,p=Math.sin(t*u)/c;return this._w=o*h+this._w*p,this._x=i*h+this._x*p,this._y=r*h+this._y*p,this._z=s*h+this._z*p,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class en{constructor(e=0,t=0,i=0){en.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(O$.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(O$.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=2*(o*r-a*i),u=2*(a*t-s*r),h=2*(s*i-o*t);return this.x=t+l*c+o*h-a*u,this.y=i+l*u+a*c-s*h,this.z=r+l*h+s*u-o*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return AM.copy(this).projectOnVector(e),this.sub(AM)}reflect(e){return this.sub(AM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Oa(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const AM=new en,O$=new nw;class iw{constructor(e=new en(1/0,1/0,1/0),t=new en(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Uc.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Uc.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Uc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const s=i.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,a=s.count;o<a;o++)e.isMesh===!0?e.getVertexPosition(o,Uc):Uc.fromBufferAttribute(s,o),Uc.applyMatrix4(e.matrixWorld),this.expandByPoint(Uc);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),F5.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),F5.copy(i.boundingBox)),F5.applyMatrix4(e.matrixWorld),this.union(F5)}const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Uc),Uc.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Dv),z5.subVectors(this.max,Dv),Ng.subVectors(e.a,Dv),Pg.subVectors(e.b,Dv),kg.subVectors(e.c,Dv),Nf.subVectors(Pg,Ng),Pf.subVectors(kg,Pg),Up.subVectors(Ng,kg);let t=[0,-Nf.z,Nf.y,0,-Pf.z,Pf.y,0,-Up.z,Up.y,Nf.z,0,-Nf.x,Pf.z,0,-Pf.x,Up.z,0,-Up.x,-Nf.y,Nf.x,0,-Pf.y,Pf.x,0,-Up.y,Up.x,0];return!CM(t,Ng,Pg,kg,z5)||(t=[1,0,0,0,1,0,0,0,1],!CM(t,Ng,Pg,kg,z5))?!1:(j5.crossVectors(Nf,Pf),t=[j5.x,j5.y,j5.z],CM(t,Ng,Pg,kg,z5))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Uc).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Uc).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Gh[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Gh[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Gh[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Gh[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Gh[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Gh[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Gh[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Gh[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Gh),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Gh=[new en,new en,new en,new en,new en,new en,new en,new en],Uc=new en,F5=new iw,Ng=new en,Pg=new en,kg=new en,Nf=new en,Pf=new en,Up=new en,Dv=new en,z5=new en,j5=new en,Fp=new en;function CM(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){Fp.fromArray(n,s);const a=r.x*Math.abs(Fp.x)+r.y*Math.abs(Fp.y)+r.z*Math.abs(Fp.z),l=e.dot(Fp),c=t.dot(Fp),u=i.dot(Fp);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const CBe=new iw,Ov=new en,MM=new en;class MBe{constructor(e=new en,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):CBe.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ov.subVectors(e,this.center);const t=Ov.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(Ov,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(MM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ov.copy(e.center).add(MM)),this.expandByPoint(Ov.copy(e.center).sub(MM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}class ch{constructor(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w){ch.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w)}set(e,t,i,r,s,o,a,l,c,u,h,p,m,y,b,w){const v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=r,v[1]=s,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=u,v[10]=h,v[14]=p,v[3]=m,v[7]=y,v[11]=b,v[15]=w,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ch().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Lg.setFromMatrixColumn(e,0).length(),s=1/Lg.setFromMatrixColumn(e,1).length(),o=1/Lg.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),h=Math.sin(s);if(e.order==="XYZ"){const p=o*u,m=o*h,y=a*u,b=a*h;t[0]=l*u,t[4]=-l*h,t[8]=c,t[1]=m+y*c,t[5]=p-b*c,t[9]=-a*l,t[2]=b-p*c,t[6]=y+m*c,t[10]=o*l}else if(e.order==="YXZ"){const p=l*u,m=l*h,y=c*u,b=c*h;t[0]=p+b*a,t[4]=y*a-m,t[8]=o*c,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=m*a-y,t[6]=b+p*a,t[10]=o*l}else if(e.order==="ZXY"){const p=l*u,m=l*h,y=c*u,b=c*h;t[0]=p-b*a,t[4]=-o*h,t[8]=y+m*a,t[1]=m+y*a,t[5]=o*u,t[9]=b-p*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if(e.order==="ZYX"){const p=o*u,m=o*h,y=a*u,b=a*h;t[0]=l*u,t[4]=y*c-m,t[8]=p*c+b,t[1]=l*h,t[5]=b*c+p,t[9]=m*c-y,t[2]=-c,t[6]=a*l,t[10]=o*l}else if(e.order==="YZX"){const p=o*l,m=o*c,y=a*l,b=a*c;t[0]=l*u,t[4]=b-p*h,t[8]=y*h+m,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=m*h+y,t[10]=p-b*h}else if(e.order==="XZY"){const p=o*l,m=o*c,y=a*l,b=a*c;t[0]=l*u,t[4]=-h,t[8]=c*u,t[1]=p*h+b,t[5]=o*u,t[9]=m*h-y,t[2]=y*h-m,t[6]=a*u,t[10]=b*h+p}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(RBe,e,IBe)}lookAt(e,t,i){const r=this.elements;return fl.subVectors(e,t),fl.lengthSq()===0&&(fl.z=1),fl.normalize(),kf.crossVectors(i,fl),kf.lengthSq()===0&&(Math.abs(i.z)===1?fl.x+=1e-4:fl.z+=1e-4,fl.normalize(),kf.crossVectors(i,fl)),kf.normalize(),V5.crossVectors(fl,kf),r[0]=kf.x,r[4]=V5.x,r[8]=fl.x,r[1]=kf.y,r[5]=V5.y,r[9]=fl.y,r[2]=kf.z,r[6]=V5.z,r[10]=fl.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],h=i[5],p=i[9],m=i[13],y=i[2],b=i[6],w=i[10],v=i[14],T=i[3],S=i[7],M=i[11],P=i[15],R=r[0],O=r[4],B=r[8],N=r[12],I=r[1],F=r[5],j=r[9],W=r[13],U=r[2],H=r[6],q=r[10],J=r[14],G=r[3],ee=r[7],Q=r[11],ne=r[15];return s[0]=o*R+a*I+l*U+c*G,s[4]=o*O+a*F+l*H+c*ee,s[8]=o*B+a*j+l*q+c*Q,s[12]=o*N+a*W+l*J+c*ne,s[1]=u*R+h*I+p*U+m*G,s[5]=u*O+h*F+p*H+m*ee,s[9]=u*B+h*j+p*q+m*Q,s[13]=u*N+h*W+p*J+m*ne,s[2]=y*R+b*I+w*U+v*G,s[6]=y*O+b*F+w*H+v*ee,s[10]=y*B+b*j+w*q+v*Q,s[14]=y*N+b*W+w*J+v*ne,s[3]=T*R+S*I+M*U+P*G,s[7]=T*O+S*F+M*H+P*ee,s[11]=T*B+S*j+M*q+P*Q,s[15]=T*N+S*W+M*J+P*ne,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],h=e[6],p=e[10],m=e[14],y=e[3],b=e[7],w=e[11],v=e[15];return y*(+s*l*h-r*c*h-s*a*p+i*c*p+r*a*m-i*l*m)+b*(+t*l*m-t*c*p+s*o*p-r*o*m+r*c*u-s*l*u)+w*(+t*c*h-t*a*m-s*o*h+i*o*m+s*a*u-i*c*u)+v*(-r*a*u-t*l*h+t*a*p+r*o*h-i*o*p+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],p=e[10],m=e[11],y=e[12],b=e[13],w=e[14],v=e[15],T=h*w*c-b*p*c+b*l*m-a*w*m-h*l*v+a*p*v,S=y*p*c-u*w*c-y*l*m+o*w*m+u*l*v-o*p*v,M=u*b*c-y*h*c+y*a*m-o*b*m-u*a*v+o*h*v,P=y*h*l-u*b*l-y*a*p+o*b*p+u*a*w-o*h*w,R=t*T+i*S+r*M+s*P;if(R===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const O=1/R;return e[0]=T*O,e[1]=(b*p*s-h*w*s-b*r*m+i*w*m+h*r*v-i*p*v)*O,e[2]=(a*w*s-b*l*s+b*r*c-i*w*c-a*r*v+i*l*v)*O,e[3]=(h*l*s-a*p*s-h*r*c+i*p*c+a*r*m-i*l*m)*O,e[4]=S*O,e[5]=(u*w*s-y*p*s+y*r*m-t*w*m-u*r*v+t*p*v)*O,e[6]=(y*l*s-o*w*s-y*r*c+t*w*c+o*r*v-t*l*v)*O,e[7]=(o*p*s-u*l*s+u*r*c-t*p*c-o*r*m+t*l*m)*O,e[8]=M*O,e[9]=(y*h*s-u*b*s-y*i*m+t*b*m+u*i*v-t*h*v)*O,e[10]=(o*b*s-y*a*s+y*i*c-t*b*c-o*i*v+t*a*v)*O,e[11]=(u*a*s-o*h*s-u*i*c+t*h*c+o*i*m-t*a*m)*O,e[12]=P*O,e[13]=(u*b*r-y*h*r+y*i*p-t*b*p-u*i*w+t*h*w)*O,e[14]=(y*a*r-o*b*r-y*i*l+t*b*l+o*i*w-t*a*w)*O,e[15]=(o*h*r-u*a*r+u*i*l-t*h*l-o*i*p+t*a*p)*O,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,h=a+a,p=s*c,m=s*u,y=s*h,b=o*u,w=o*h,v=a*h,T=l*c,S=l*u,M=l*h,P=i.x,R=i.y,O=i.z;return r[0]=(1-(b+v))*P,r[1]=(m+M)*P,r[2]=(y-S)*P,r[3]=0,r[4]=(m-M)*R,r[5]=(1-(p+v))*R,r[6]=(w+T)*R,r[7]=0,r[8]=(y+S)*O,r[9]=(w-T)*O,r[10]=(1-(p+b))*O,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=Lg.set(r[0],r[1],r[2]).length();const o=Lg.set(r[4],r[5],r[6]).length(),a=Lg.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],Fc.copy(this);const c=1/s,u=1/o,h=1/a;return Fc.elements[0]*=c,Fc.elements[1]*=c,Fc.elements[2]*=c,Fc.elements[4]*=u,Fc.elements[5]*=u,Fc.elements[6]*=u,Fc.elements[8]*=h,Fc.elements[9]*=h,Fc.elements[10]*=h,t.setFromRotationMatrix(Fc),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o,a=B5){const l=this.elements,c=2*s/(t-e),u=2*s/(i-r),h=(t+e)/(t-e),p=(i+r)/(i-r);let m,y;if(a===B5)m=-(o+s)/(o-s),y=-2*o*s/(o-s);else if(a===P$)m=-o/(o-s),y=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=h,l[12]=0,l[1]=0,l[5]=u,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=y,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,i,r,s,o,a=B5){const l=this.elements,c=1/(t-e),u=1/(i-r),h=1/(o-s),p=(t+e)*c,m=(i+r)*u;let y,b;if(a===B5)y=(o+s)*h,b=-2*h;else if(a===P$)y=s*h,b=-1*h;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-p,l[1]=0,l[5]=2*u,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=b,l[14]=-y,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Lg=new en,Fc=new ch,RBe=new en(0,0,0),IBe=new en(1,1,1),kf=new en,V5=new en,fl=new en,B$=new ch,U$=new nw;class rT{constructor(e=0,t=0,i=0,r=rT.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,s=r[0],o=r[4],a=r[8],l=r[1],c=r[5],u=r[9],h=r[2],p=r[6],m=r[10];switch(t){case"XYZ":this._y=Math.asin(Oa(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(p,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Oa(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-h,s),this._z=0);break;case"ZXY":this._x=Math.asin(Oa(p,-1,1)),Math.abs(p)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-Oa(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(p,m),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(Oa(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-h,s)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-Oa(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(p,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return B$.makeRotationFromQuaternion(e),this.setFromRotationMatrix(B$,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return U$.setFromEuler(this),this.setFromQuaternion(U$,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}rT.DEFAULT_ORDER="XYZ";class NBe{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let PBe=0;const F$=new en,Dg=new nw,Wh=new ch,H5=new en,Bv=new en,kBe=new en,LBe=new nw,z$=new en(1,0,0),j$=new en(0,1,0),V$=new en(0,0,1),DBe={type:"added"},OBe={type:"removed"};class w0 extends iT{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:PBe++}),this.uuid=tw(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=w0.DEFAULT_UP.clone();const e=new en,t=new rT,i=new nw,r=new en(1,1,1);function s(){i.setFromEuler(t,!1)}function o(){t.setFromQuaternion(i,void 0,!1)}t._onChange(s),i._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new ch},normalMatrix:{value:new X0}}),this.matrix=new ch,this.matrixWorld=new ch,this.matrixAutoUpdate=w0.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=w0.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new NBe,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Dg.setFromAxisAngle(e,t),this.quaternion.multiply(Dg),this}rotateOnWorldAxis(e,t){return Dg.setFromAxisAngle(e,t),this.quaternion.premultiply(Dg),this}rotateX(e){return this.rotateOnAxis(z$,e)}rotateY(e){return this.rotateOnAxis(j$,e)}rotateZ(e){return this.rotateOnAxis(V$,e)}translateOnAxis(e,t){return F$.copy(e).applyQuaternion(this.quaternion),this.position.add(F$.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(z$,e)}translateY(e){return this.translateOnAxis(j$,e)}translateZ(e){return this.translateOnAxis(V$,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Wh.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?H5.copy(e):H5.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),Bv.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Wh.lookAt(Bv,H5,this.up):Wh.lookAt(H5,Bv,this.up),this.quaternion.setFromRotationMatrix(Wh),r&&(Wh.extractRotation(r.matrixWorld),Dg.setFromRotationMatrix(Wh),this.quaternion.premultiply(Dg.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(DBe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(OBe)),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Wh.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Wh.multiply(e.parent.matrixWorld)),e.applyMatrix4(Wh),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let s=0,o=r.length;s<o;s++)r[s].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bv,e,kBe),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Bv,LBe,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const s=t[i];(s.matrixWorldAutoUpdate===!0||e===!0)&&s.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let s=0,o=r.length;s<o;s++){const a=r[s];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function s(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const h=l[c];s(e.shapes,h)}else s(e.shapes,l)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));r.material=a}else r.material=s(e.materials,this.material);if(this.children.length>0){r.children=[];for(let a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];r.animations.push(s(e.animations,l))}}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),h=o(e.shapes),p=o(e.skeletons),m=o(e.animations),y=o(e.nodes);a.length>0&&(i.geometries=a),l.length>0&&(i.materials=l),c.length>0&&(i.textures=c),u.length>0&&(i.images=u),h.length>0&&(i.shapes=h),p.length>0&&(i.skeletons=p),m.length>0&&(i.animations=m),y.length>0&&(i.nodes=y)}return i.object=r,i;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}w0.DEFAULT_UP=new en(0,1,0);w0.DEFAULT_MATRIX_AUTO_UPDATE=!0;w0.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const rre={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Lf={h:0,s:0,l:0},$5={h:0,s:0,l:0};function RM(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class vO{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Zc){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Bc.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Bc.workingColorSpace){return this.r=e,this.g=t,this.b=i,Bc.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Bc.workingColorSpace){if(e=bBe(e,1),t=Oa(t,0,1),i=Oa(i,0,1),t===0)this.r=this.g=this.b=i;else{const s=i<=.5?i*(1+t):i+t-i*t,o=2*i-s;this.r=RM(o,s,e+1/3),this.g=RM(o,s,e),this.b=RM(o,s,e-1/3)}return Bc.toWorkingColorSpace(this,r),this}setStyle(e,t=Zc){function i(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=r[1],a=r[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=r[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Zc){const i=rre[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Dy(e.r),this.g=Dy(e.g),this.b=Dy(e.b),this}copyLinearToSRGB(e){return this.r=EM(e.r),this.g=EM(e.g),this.b=EM(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Zc){return Bc.fromWorkingColorSpace(So.copy(this),e),Math.round(Oa(So.r*255,0,255))*65536+Math.round(Oa(So.g*255,0,255))*256+Math.round(Oa(So.b*255,0,255))}getHexString(e=Zc){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Bc.workingColorSpace){Bc.fromWorkingColorSpace(So.copy(this),t);const i=So.r,r=So.g,s=So.b,o=Math.max(i,r,s),a=Math.min(i,r,s);let l,c;const u=(a+o)/2;if(a===o)l=0,c=0;else{const h=o-a;switch(c=u<=.5?h/(o+a):h/(2-o-a),o){case i:l=(r-s)/h+(r<s?6:0);break;case r:l=(s-i)/h+2;break;case s:l=(i-r)/h+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Bc.workingColorSpace){return Bc.fromWorkingColorSpace(So.copy(this),t),e.r=So.r,e.g=So.g,e.b=So.b,e}getStyle(e=Zc){Bc.fromWorkingColorSpace(So.copy(this),e);const t=So.r,i=So.g,r=So.b;return e!==Zc?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(Lf),this.setHSL(Lf.h+e,Lf.s+t,Lf.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(Lf),e.getHSL($5);const i=_M(Lf.h,$5.h,t),r=_M(Lf.s,$5.s,t),s=_M(Lf.l,$5.l,t);return this.setHSL(i,r,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,s=e.elements;return this.r=s[0]*t+s[3]*i+s[6]*r,this.g=s[1]*t+s[4]*i+s[7]*r,this.b=s[2]*t+s[5]*i+s[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const So=new vO;vO.NAMES=rre;let BBe=0;class UBe extends iT{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:BBe++}),this.uuid=tw(),this.name="",this.type="Material",this.blending=x$,this.side=y$,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=b$,this.blendDst=_$,this.blendEquation=v$,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new vO(0,0,0),this.blendAlpha=0,this.depthFunc=w$,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=I$,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rg,this.stencilZFail=Rg,this.stencilZPass=Rg,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==x$&&(i.blending=this.blending),this.side!==y$&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==b$&&(i.blendSrc=this.blendSrc),this.blendDst!==_$&&(i.blendDst=this.blendDst),this.blendEquation!==v$&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==w$&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==I$&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Rg&&(i.stencilFail=this.stencilFail),this.stencilZFail!==Rg&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==Rg&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}const ls=new en,G5=new so;class Oy{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=N$,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=pBe,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return console.warn("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)G5.fromBufferAttribute(this,t),G5.applyMatrix3(e),this.setXY(t,G5.x,G5.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ls.fromBufferAttribute(this,t),ls.applyMatrix3(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ls.fromBufferAttribute(this,t),ls.applyMatrix4(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ls.fromBufferAttribute(this,t),ls.applyNormalMatrix(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ls.fromBufferAttribute(this,t),ls.transformDirection(e),this.setXYZ(t,ls.x,ls.y,ls.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Lv(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Aa(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Lv(t,this.array)),t}setX(e,t){return this.normalized&&(t=Aa(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Lv(t,this.array)),t}setY(e,t){return this.normalized&&(t=Aa(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Lv(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Aa(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Lv(t,this.array)),t}setW(e,t){return this.normalized&&(t=Aa(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Aa(t,this.array),i=Aa(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Aa(t,this.array),i=Aa(i,this.array),r=Aa(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Aa(t,this.array),i=Aa(i,this.array),r=Aa(r,this.array),s=Aa(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==N$&&(e.usage=this.usage),e}}class FBe extends Oy{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class zBe extends Oy{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class GS extends Oy{constructor(e,t,i){super(new Float32Array(e),t,i)}}let jBe=0;const Gl=new ch,IM=new w0,Og=new en,pl=new iw,Uv=new iw,Os=new en;class bO extends iT{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:jBe++}),this.uuid=tw(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(_Be(e)?zBe:FBe)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const s=new X0().getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Gl.makeRotationFromQuaternion(e),this.applyMatrix4(Gl),this}rotateX(e){return Gl.makeRotationX(e),this.applyMatrix4(Gl),this}rotateY(e){return Gl.makeRotationY(e),this.applyMatrix4(Gl),this}rotateZ(e){return Gl.makeRotationZ(e),this.applyMatrix4(Gl),this}translate(e,t,i){return Gl.makeTranslation(e,t,i),this.applyMatrix4(Gl),this}scale(e,t,i){return Gl.makeScale(e,t,i),this.applyMatrix4(Gl),this}lookAt(e){return IM.lookAt(e),IM.updateMatrix(),this.applyMatrix4(IM.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Og).negate(),this.translate(Og.x,Og.y,Og.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new GS(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new iw);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new en(-1/0,-1/0,-1/0),new en(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const s=t[i];pl.setFromBufferAttribute(s),this.morphTargetsRelative?(Os.addVectors(this.boundingBox.min,pl.min),this.boundingBox.expandByPoint(Os),Os.addVectors(this.boundingBox.max,pl.max),this.boundingBox.expandByPoint(Os)):(this.boundingBox.expandByPoint(pl.min),this.boundingBox.expandByPoint(pl.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new MBe);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new en,1/0);return}if(e){const i=this.boundingSphere.center;if(pl.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const a=t[s];Uv.setFromBufferAttribute(a),this.morphTargetsRelative?(Os.addVectors(pl.min,Uv.min),pl.expandByPoint(Os),Os.addVectors(pl.max,Uv.max),pl.expandByPoint(Os)):(pl.expandByPoint(Uv.min),pl.expandByPoint(Uv.max))}pl.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Os.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Os));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Os.fromBufferAttribute(a,c),l&&(Og.fromBufferAttribute(e,c),Os.add(Og)),r=Math.max(r,i.distanceToSquared(Os))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Oy(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let I=0;I<a;I++)c[I]=new en,u[I]=new en;const h=new en,p=new en,m=new en,y=new so,b=new so,w=new so,v=new en,T=new en;function S(I,F,j){h.fromArray(r,I*3),p.fromArray(r,F*3),m.fromArray(r,j*3),y.fromArray(o,I*2),b.fromArray(o,F*2),w.fromArray(o,j*2),p.sub(h),m.sub(h),b.sub(y),w.sub(y);const W=1/(b.x*w.y-w.x*b.y);isFinite(W)&&(v.copy(p).multiplyScalar(w.y).addScaledVector(m,-b.y).multiplyScalar(W),T.copy(m).multiplyScalar(b.x).addScaledVector(p,-w.x).multiplyScalar(W),c[I].add(v),c[F].add(v),c[j].add(v),u[I].add(T),u[F].add(T),u[j].add(T))}let M=this.groups;M.length===0&&(M=[{start:0,count:i.length}]);for(let I=0,F=M.length;I<F;++I){const j=M[I],W=j.start,U=j.count;for(let H=W,q=W+U;H<q;H+=3)S(i[H+0],i[H+1],i[H+2])}const P=new en,R=new en,O=new en,B=new en;function N(I){O.fromArray(s,I*3),B.copy(O);const F=c[I];P.copy(F),P.sub(O.multiplyScalar(O.dot(F))).normalize(),R.crossVectors(B,F);const W=R.dot(u[I])<0?-1:1;l[I*4]=P.x,l[I*4+1]=P.y,l[I*4+2]=P.z,l[I*4+3]=W}for(let I=0,F=M.length;I<F;++I){const j=M[I],W=j.start,U=j.count;for(let H=W,q=W+U;H<q;H+=3)N(i[H+0]),N(i[H+1]),N(i[H+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Oy(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let p=0,m=i.count;p<m;p++)i.setXYZ(p,0,0,0);const r=new en,s=new en,o=new en,a=new en,l=new en,c=new en,u=new en,h=new en;if(e)for(let p=0,m=e.count;p<m;p+=3){const y=e.getX(p+0),b=e.getX(p+1),w=e.getX(p+2);r.fromBufferAttribute(t,y),s.fromBufferAttribute(t,b),o.fromBufferAttribute(t,w),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),a.fromBufferAttribute(i,y),l.fromBufferAttribute(i,b),c.fromBufferAttribute(i,w),a.add(u),l.add(u),c.add(u),i.setXYZ(y,a.x,a.y,a.z),i.setXYZ(b,l.x,l.y,l.z),i.setXYZ(w,c.x,c.y,c.z)}else for(let p=0,m=t.count;p<m;p+=3)r.fromBufferAttribute(t,p+0),s.fromBufferAttribute(t,p+1),o.fromBufferAttribute(t,p+2),u.subVectors(o,s),h.subVectors(r,s),u.cross(h),i.setXYZ(p+0,u.x,u.y,u.z),i.setXYZ(p+1,u.x,u.y,u.z),i.setXYZ(p+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Os.fromBufferAttribute(e,t),Os.normalize(),e.setXYZ(t,Os.x,Os.y,Os.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,h=a.normalized,p=new c.constructor(l.length*u);let m=0,y=0;for(let b=0,w=l.length;b<w;b++){a.isInterleavedBufferAttribute?m=l[b]*a.data.stride+a.offset:m=l[b]*u;for(let v=0;v<u;v++)p[y++]=c[m++]}return new Oy(p,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new bO,i=this.index.array,r=this.attributes;for(const a in r){const l=r[a],c=e(l,i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,h=c.length;u<h;u++){const p=c[u],m=e(p,i);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i){const c=i[l];e.data.attributes[l]=c.toJSON(e.data)}const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let h=0,p=c.length;h<p;h++){const m=c[h];u.push(m.toJSON(e.data))}u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r){const u=r[c];this.setAttribute(c,u.clone(t))}const s=e.morphAttributes;for(const c in s){const u=[],h=s[c];for(let p=0,m=h.length;p<m;p++)u.push(h[p].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const h=o[c];this.addGroup(h.start,h.count,h.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}function VBe(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function HBe(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}var $Be=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,GBe=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class WBe extends UBe{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=$Be,this.fragmentShader=GBe,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1,clipCullDistance:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=VBe(e.uniforms),this.uniformsGroups=HBe(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;o&&o.isTexture?t.uniforms[r]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[r]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[r]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[r]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[r]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[r]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[r]={type:"m4",value:o.toArray()}:t.uniforms[r]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class KBe extends lh{constructor(e,t,i,r,s,o,a,l,c,u){if(u=u!==void 0?u:vM,u!==vM&&u!==A$)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&u===vM&&(i=fBe),i===void 0&&u===A$&&(i=mBe),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=a!==void 0?a:T$,this.minFilter=l!==void 0?l:T$,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const qBe=new KBe(1,1);qBe.compareFunction=vBe;class ZBe extends lh{constructor(e,t,i,r,s,o,a,l,c){super(e,t,i,r,s,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:gm,this.magFilter=s!==void 0?s:gm,this.generateMipmaps=!1;const u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class _O extends bO{constructor(e=1,t=32,i=16,r=0,s=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const u=[],h=new en,p=new en,m=[],y=[],b=[],w=[];for(let v=0;v<=i;v++){const T=[],S=v/i;let M=0;v===0&&o===0?M=.5/t:v===i&&l===Math.PI&&(M=-.5/t);for(let P=0;P<=t;P++){const R=P/t;h.x=-e*Math.cos(r+R*s)*Math.sin(o+S*a),h.y=e*Math.cos(o+S*a),h.z=e*Math.sin(r+R*s)*Math.sin(o+S*a),y.push(h.x,h.y,h.z),p.copy(h).normalize(),b.push(p.x,p.y,p.z),w.push(R+M,1-S),T.push(c++)}u.push(T)}for(let v=0;v<i;v++)for(let T=0;T<t;T++){const S=u[v][T+1],M=u[v][T],P=u[v+1][T],R=u[v+1][T+1];(v!==0||o>0)&&m.push(S,M,R),(v!==i-1||l<Math.PI)&&m.push(M,P,R)}this.setIndex(m),this.setAttribute("position",new GS(y,3)),this.setAttribute("normal",new GS(b,3)),this.setAttribute("uv",new GS(w,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _O(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}const H$={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class YBe{constructor(e,t,i){const r=this;let s=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(u){a++,s===!1&&r.onStart!==void 0&&r.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,r.onProgress!==void 0&&r.onProgress(u,o,a),o===a&&(s=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(u){r.onError!==void 0&&r.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,h){return c.push(u,h),this},this.removeHandler=function(u){const h=c.indexOf(u);return h!==-1&&c.splice(h,2),this},this.getHandler=function(u){for(let h=0,p=c.length;h<p;h+=2){const m=c[h],y=c[h+1];if(m.global&&(m.lastIndex=0),m.test(u))return y}return null}}}const XBe=new YBe;class wO{constructor(e){this.manager=e!==void 0?e:XBe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,s){i.load(e,r,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}wO.DEFAULT_MATERIAL_NAME="__DEFAULT";class QBe extends wO{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=H$.get(e);if(o!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=QN("img");function l(){u(),H$.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(h){u(),r&&r(h),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class JBe extends wO{constructor(e){super(e)}load(e,t,i,r){const s=new lh,o=new QBe(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,t!==void 0&&t(s)},i,r),s}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:tre}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=tre);function eUe(n,e,t,i){const r=t[0]/255,s=t[1]/255,o=t[2]/255;t[3]/255;const a=(r+s+o)/3,l=new en(r-a,s-a,o-a),c=l.x*l.y*l.z,u=Math.sqrt(a*a+l.lengthSq()+c*c);return{position:new so(n,e),color:t,scalar:a,bivector:l,trivector:c,magnitude:u,rank:i}}function tUe(n,e=256){const{width:t,height:i,data:r}=n,s=[],o=Math.max(1,Math.floor(t/e)),a=Math.max(1,Math.floor(i/e));for(let u=0;u<i;u+=a)for(let h=0;h<t;h+=o){const p=(u*t+h)*4,m=[r[p],r[p+1],r[p+2],r[p+3]],y=h/t*2-1,b=u/i*2-1,w=eUe(y,b,m,3);s.push(w)}return{pixels:s,width:t,height:i,resolution:e,phiValue:1.618033988749895,piValue:3.141592653589793,timestamp:Date.now()}}function sre(n,e){const t=n.scalar*e.scalar-n.bivector.dot(e.bivector),i=new en(n.scalar*e.bivector.x+e.scalar*n.bivector.x,n.scalar*e.bivector.y+e.scalar*n.bivector.y,n.scalar*e.bivector.z+e.scalar*n.bivector.z),r=n.scalar*e.trivector+e.scalar*n.trivector+n.bivector.x*e.bivector.y*e.bivector.z+e.bivector.x*n.bivector.y*n.bivector.z,s=Math.abs(t)>.1?0:i.length()>.1?2:3,o=n.position.distanceTo(e.position);return{pixel1:n,pixel2:e,scalarPart:t,bivectorPart:i,trivectorPart:r,grade:s,distance:o}}function nUe(n,e,t=1e3){const i=[],r=n.length;if(r<2)return i;const s=Math.max(1,Math.floor(r*r/t));let o=0;for(let a=0;a<r-1;a++)for(let l=a+1;l<r;l++){if(o++,o%s!==0)continue;const c=n[a],u=n[l];if(c.position.distanceTo(u.position)<=e){const p=sre(c,u);if(i.push(p),i.length>=t)return i}}return i}function $$(n,e,t,i,r=1,s=0){const o=[],a=[],l=.2*r;a.push({center:n.clone(),radius:l,generation:0});for(let c=1;c<=e;c++){const u=6*c,h=l*Math.pow(i,c-1),p=2*t/u;for(let m=0;m<u;m++){const y=m*p+s,b=h*i,w=new so(n.x+Math.cos(y)*b,n.y+Math.sin(y)*b);a.push({center:w,radius:h,generation:c});const v=new so(Math.cos(y),Math.sin(y)).normalize();o.push({origin:n.clone(),direction:v,length:b*i,generation:c,phiScaled:!0,active:!0})}}return{center:n,generations:e,rays:o,circles:a,totalRays:o.length,phiConstant:i,piConstant:t}}function G$(n,e,t,i=.1){if(!e||e.pixels.length===0)return n;const r=[];for(const s of n){let o=0,a=0;const l=10;for(let u=0;u<=1;u+=1/l){const h=new so(s.origin.x+s.direction.x*s.length*u,s.origin.y+s.direction.y*s.length*u);let p=null,m=1/0;for(const y of e.pixels){const b=y.position.distanceTo(h);b<m&&(m=b,p=y)}p&&m<.1&&(o+=p.magnitude,a++)}(a>0?o/a:0)>=i||s.generation<=1?r.push({...s,active:!0}):r.push({...s,active:!1})}return r}function iUe(n,e,t){const i=[];let r=0,s=0;const o=n.rays.filter(c=>c.active);for(const c of o){const u=[];for(const h of e.pixels){const m=new so(h.position.x-c.origin.x,h.position.y-c.origin.y).dot(c.direction);if(m>=0&&m<=c.length){const y=new so(c.origin.x+c.direction.x*m,c.origin.y+c.direction.y*m);h.position.distanceTo(y)<.05&&u.push(h)}}if(u.length>=2){r++;for(let h=0;h<u.length-1;h++)for(let p=h+1;p<u.length;p++){const m=sre(u[h],u[p]);if(i.push(m),s++,i.length>=t){const b=e.pixels.length*(e.pixels.length-1)/2/s;return{products:i,raysProcessed:r,totalOperations:s,optimizationRatio:b}}}}}const a=e.pixels.length*(e.pixels.length-1)/2,l=s>0?a/s:1;return{products:i,raysProcessed:r,totalOperations:s,optimizationRatio:l}}const rUe=1.618033988749895,sUe=3.141592653589793,oUe={fps:0,frameTime:0,stepCount:0,tensorOperations:0,geometricProducts:0,activeRays:0,tensorFieldSize:0,optimizationRatio:1},Tn=z_((n,e)=>({phi:rUe,pi:sUe,phiStepMultiplier:.5,piPrecisionThreshold:8e-4,maxSteps:300,maxDistance:100,depthScale:1.5,metricExtension:2,eigenValue:2.618,zkpProofConsistency:1,saturation:1,brightness:0,exposure:0,contrast:1,shadows:0,highlights:0,vibrance:0,hue:0,bwFilter:0,zoomLevel:5,stitchDensity:1,volumetricDepth:1,manifoldContinuity:.7,resolution:{x:window.innerWidth,y:window.innerHeight},time:0,cameraPosition:[0,0,8],mouse:[0,0],showPhiSteps:!1,showDistanceField:!1,showNormals:!1,showTensorField:!1,showFlowerOfLife:!1,performance:{fps:0,frameTime:0,stepCount:0},activeAssetType:null,assetUrl:null,assetTexture:null,tensorRank:3,flowerOfLifeGenerations:3,geometricProductThreshold:100,tensorFieldResolution:256,piRayDensity:1,coordinateInvariance:!0,bivectorScale:1,trivectorScale:1,tensorMagnitude:1,flowerOfLifeActive:!0,flowerOfLifeRotation:0,sacredGeometryScale:1,computationalOptimization:!0,tensorFieldCulling:!0,geometricProductBatching:!0,tensorField:null,tensorFieldVersion:0,flowerOfLifePattern:null,tensorPerformance:oUe,setPhi:t=>n({phi:t}),setPi:t=>n({pi:t}),setPhiStepMultiplier:t=>n({phiStepMultiplier:t}),setPiPrecisionThreshold:t=>n({piPrecisionThreshold:t}),setMaxSteps:t=>n({maxSteps:t}),setDepthScale:t=>n({depthScale:t}),setMetricExtension:t=>n({metricExtension:t}),setEigenValue:t=>n({eigenValue:t}),setZkpProofConsistency:t=>n({zkpProofConsistency:t}),setSaturation:t=>n({saturation:t}),setBrightness:t=>n({brightness:t}),setExposure:t=>n({exposure:t}),setContrast:t=>n({contrast:t}),setShadows:t=>n({shadows:t}),setHighlights:t=>n({highlights:t}),setVibrance:t=>n({vibrance:t}),setHue:t=>n({hue:t}),setBwFilter:t=>n({bwFilter:t}),setZoomLevel:t=>n({zoomLevel:t}),setStitchDensity:t=>n({stitchDensity:t}),setVolumetricDepth:t=>n({volumetricDepth:t}),setManifoldContinuity:t=>n({manifoldContinuity:t}),updateTime:t=>n(i=>({time:i.time+t})),setMouse:(t,i)=>n({mouse:[t,i]}),toggleDebug:t=>n(i=>({[t]:!i[t]})),setCameraPosition:t=>n({cameraPosition:t}),updatePerformance:t=>n({performance:t}),setAsset:(t,i=null)=>n(r=>(r.assetUrl&&r.assetUrl.startsWith("blob:")&&URL.revokeObjectURL(r.assetUrl),{activeAssetType:t,assetUrl:i})),setAssetTexture:t=>n({assetTexture:t}),setTensorRank:t=>n({tensorRank:t}),setFlowerOfLifeGenerations:t=>{n({flowerOfLifeGenerations:t}),e().updateFlowerOfLifeRays()},setGeometricProductThreshold:t=>n({geometricProductThreshold:t}),setTensorFieldResolution:t=>n({tensorFieldResolution:t}),setPiRayDensity:t=>n({piRayDensity:t}),setCoordinateInvariance:t=>n({coordinateInvariance:t}),setBivectorScale:t=>n({bivectorScale:t}),setTrivectorScale:t=>n({trivectorScale:t}),setTensorMagnitude:t=>n({tensorMagnitude:t}),setFlowerOfLifeActive:t=>n({flowerOfLifeActive:t}),setFlowerOfLifeRotation:t=>{n({flowerOfLifeRotation:t}),e().updateFlowerOfLifeRays()},setSacredGeometryScale:t=>{n({sacredGeometryScale:t}),e().updateFlowerOfLifeRays()},setComputationalOptimization:t=>n({computationalOptimization:t}),setTensorFieldCulling:t=>n({tensorFieldCulling:t}),setGeometricProductBatching:t=>n({geometricProductBatching:t}),processTensorField:(t,i,r)=>{const s=performance.now(),o=e();try{const a=tUe(t,o.tensorFieldResolution);if(n(c=>({tensorField:a,tensorFieldVersion:c.tensorFieldVersion+1})),o.flowerOfLifeActive){const c=new so(0,0);let u=$$(c,o.flowerOfLifeGenerations,o.pi,o.phi,o.sacredGeometryScale,o.flowerOfLifeRotation);if(o.tensorFieldCulling){const h=G$(u.rays,a,o.geometricProductThreshold,.1);u={...u,rays:h}}n({flowerOfLifePattern:u})}const l=performance.now()-s;n(c=>({tensorPerformance:{...c.tensorPerformance,tensorFieldSize:a.pixels.length,frameTime:l}}))}catch(a){console.error("[TensorStore] Error processing tensor field:",a)}},calculateGeometricProducts:()=>{const t=performance.now(),i=e(),{tensorField:r,flowerOfLifePattern:s,flowerOfLifeActive:o,computationalOptimization:a}=i;if(!r||r.pixels.length===0)return[];let l=[],c=0,u=1;try{if(o&&s&&a){const p=iUe(s,r,Math.floor(i.geometricProductThreshold));l=p.products,c=p.totalOperations,u=p.optimizationRatio,n(m=>({tensorPerformance:{...m.tensorPerformance,activeRays:p.raysProcessed,optimizationRatio:u}}))}else{const p=i.piRayDensity*.5;l=nUe(r.pixels,p,Math.floor(i.geometricProductThreshold*10)),c=l.length}const h=performance.now()-t;n(p=>({tensorPerformance:{...p.tensorPerformance,geometricProducts:c,tensorOperations:c,frameTime:h,optimizationRatio:u}}))}catch(h){console.error("[TensorStore] Error calculating geometric products:",h)}return l},updateFlowerOfLifeRays:()=>{const t=e();if(!t.flowerOfLifeActive){n({flowerOfLifePattern:null});return}try{const i=new so(0,0);let r=$$(i,t.flowerOfLifeGenerations,t.pi,t.phi,t.sacredGeometryScale,t.flowerOfLifeRotation);if(t.tensorField&&t.tensorFieldCulling){const s=G$(r.rays,t.tensorField,t.geometricProductThreshold,.1);r={...r,rays:s}}n({flowerOfLifePattern:r,tensorPerformance:{...t.tensorPerformance,activeRays:r.rays.length}})}catch(i){console.error("[TensorStore] Error updating Flower of Life rays:",i)}},updateTensorPerformance:t=>{n(i=>({tensorPerformance:{...i.tensorPerformance,...t}}))},setTensorField:t=>n({tensorField:t}),setFlowerOfLifePattern:t=>n({flowerOfLifePattern:t})})),ore=1.618033988749895,aUe=3.141592653589793,lUe=`
  varying vec3 vLocalPosition;
  varying vec2 vUv;
  void main() {
    vUv = uv;
    vLocalPosition = position;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,cUe=`
  precision highp float;

  uniform float uPhi;
  uniform float uPi;
  uniform float uTime;
  uniform vec3 uLocalCameraPosition;
  uniform float uPhiStepMultiplier;
  uniform float uPiPrecisionThreshold;
  uniform float uMaxSteps;
  uniform float uMaxDistance;
  uniform float uDepthScale;
  uniform float uMetricExtension; 
  uniform float uEigenValue;
  uniform float uZkpProofConsistency;
  uniform float uAssetAspect;
  
  uniform float uShowPhiSteps;
  uniform float uShowNormals;
  uniform float uShowBlade;
  uniform float uShowStepDepth;
  uniform float uBladeDepthDebug;
  
  uniform sampler2D uVideoTexture;
  uniform bool uHasVideo;
  
  // Texture modulation uniforms
  uniform float uSaturation;
  uniform float uBrightness;
  uniform float uExposure;
  uniform float uContrast;
  uniform float uShadows;
  uniform float uHighlights;
  uniform float uVibrance;
  uniform float uHue;
  uniform float uBwFilter;

  varying vec3 vLocalPosition;
  varying vec2 vUv;
  
  vec3 rgb2hsv(vec3 c) {
    vec4 K = vec4(0.0, -1.0/3.0, 2.0/3.0, -1.0);
    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));
    float d = q.x - min(q.w, q.y);
    float e = 1.0e-10;
    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
  }
  
  vec3 hsv2rgb(vec3 c) {
    vec4 K = vec4(1.0, 2.0/3.0, 1.0/3.0, 3.0);
    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
  }
  
  vec3 applyTextureModulation(vec3 color) {
    // Exposure
    color *= pow(2.0, uExposure);
    
    // Brightness
    color += uBrightness;
    
    // Contrast
    color = (color - 0.5) * uContrast + 0.5;
    
    // Shadows/Highlights
    float luma = dot(color, vec3(0.299, 0.587, 0.114));
    float shadowMask = 1.0 - smoothstep(0.0, 0.5, luma);
    float highlightMask = smoothstep(0.5, 1.0, luma);
    color += shadowMask * uShadows * 0.5;
    color += highlightMask * uHighlights * 0.5;
    
    // Saturation
    vec3 gray = vec3(luma);
    color = mix(gray, color, uSaturation);
    
    // Vibrance (smart saturation - affects less saturated colors more)
    float maxC = max(color.r, max(color.g, color.b));
    float minC = min(color.r, min(color.g, color.b));
    float sat = (maxC - minC) / (maxC + 0.001);
    color = mix(gray, color, 1.0 + uVibrance * (1.0 - sat));
    
    // Hue shift
    vec3 hsv = rgb2hsv(color);
    hsv.x = fract(hsv.x + uHue);
    color = hsv2rgb(hsv);
    
    // BW Filter (convert to grayscale)
    color = mix(color, vec3(luma), uBwFilter);
    
    return clamp(color, 0.0, 1.0);
  }

  float getRotorHarmonic(vec3 p) {
    float dist = length(p.xy);
    float angle = dist * uPhi + p.z * (uPi / uPhi);
    float s = sin(p.x * uPhi + angle);
    float c = cos(p.y * uPhi - angle);
    return (s * c) * 0.5 + 0.5;
  }

  float getStitch(float r, float z, float rotor, float substrate) {
    float freq = (3.0 + uPhi) * 2.0 * (0.9 + 0.2 * rotor);
    float sliceLayers = floor(abs(z) * 10.0 * uPhi);
    float x = r * freq + z * uPi + substrate * uPhi + sliceLayers * 0.1;
    float x7 = mod(x, 7.0);
    int idx = int(floor(x7));
    float pulse = (idx == 0 || idx == 3 || idx == 4 || idx == 6) ? 1.0 : 0.2;
    return pulse;
  }

  struct RealityMetric {
    float depth;
    vec3 color;
    bool isValid;
  };

  RealityMetric sampleReality(vec2 uv) {
    if (uv.x < 0.0 || uv.x > 1.0 || uv.y < 0.0 || uv.y > 1.0) {
        return RealityMetric(0.0, vec3(0.0), false);
    }
    if (!uHasVideo) {
      // Generate procedural texture when no video
      float pattern = sin(uv.x * 20.0 + uTime) * cos(uv.y * 20.0) * 0.5 + 0.5;
      vec3 color = vec3(pattern, pattern * 0.8, pattern * 0.6);
      float depth = pattern * 0.1;
      return RealityMetric(depth, color, true);
    }

    vec4 tex = texture2D(uVideoTexture, uv);
    vec3 modColor = applyTextureModulation(tex.rgb);
    float luma = dot(modColor, vec3(0.299, 0.587, 0.114));
    float reconDepth = pow(luma, uEigenValue * 0.5) * uMetricExtension;
    return RealityMetric(reconDepth, modColor, true);
  }

  float verifyUnifiedReality(vec3 p) {
    vec2 uv = p.xy * 0.5 + 0.5;
    RealityMetric reality = sampleReality(uv);
    
    float r = length(p.xy);
    float bladeBase = pow(abs(cos(r * (uPi * 0.5))), uPhi * 0.4) * uDepthScale;
    
    float rotor = getRotorHarmonic(p);
    float stitch = getStitch(r, p.z, rotor, bladeBase);
    
    float garmentThickness = reality.depth * stitch;
    
    float totalThickness = mix(bladeBase, garmentThickness, uZkpProofConsistency);
    
    float d = abs(p.z) - totalThickness;
    
    float micro = sin(p.x * 60.0 + uTime) * cos(p.y * 60.0) * 0.0003 * uZkpProofConsistency;
    
    return (d + micro) * 0.75;
  }

  vec3 calcNormal(vec3 p) {
    float h = 0.0008;
    const vec2 k = vec2(1, -1);
    vec3 n = normalize(k.xyy * verifyUnifiedReality(p + k.xyy * h) + 
                       k.yyx * verifyUnifiedReality(p + k.yyx * h) + 
                       k.yxy * verifyUnifiedReality(p + k.yxy * h) + 
                       k.xxx * verifyUnifiedReality(p + k.xxx * h));
    return n;
  }

  void main() {
    vec3 ro = uLocalCameraPosition;
    vec3 rd = normalize(vLocalPosition - ro);

    float dO = 0.0;
    bool hit = false;
    float steps = 0.0;
    
    for(int i = 0; i < 512; i++) {
      if(float(i) >= uMaxSteps) break;
      vec3 p = ro + rd * dO;
      float dS = verifyUnifiedReality(p);
      
      dO += dS * uPhiStepMultiplier;
      steps += 1.0;
      
      if(dS < uPiPrecisionThreshold) { hit = true; break; }
      if(dO > uMaxDistance) break;
    }

    vec3 col = vec3(0.0);
    if(hit) {
      vec3 p = ro + rd * dO;
      vec3 n = calcNormal(p);
      
      vec2 uv = p.xy * 0.5 + 0.5;
      RealityMetric reality = sampleReality(uv);
      
      vec3 lPos = vec3(8.0, 8.0, 12.0 * sign(ro.z));
      vec3 lDir = normalize(lPos - p);
      float diff = max(dot(n, lDir), 0.0);
      float rim = pow(1.0 - max(dot(n, -rd), 0.0), 4.0);
      float spec = pow(max(dot(reflect(-lDir, n), -rd), 0.0), 64.0);
      
      col = reality.color * (diff + 0.12);
      
      float rotor = getRotorHarmonic(p);
      float pulse = getStitch(length(p.xy), p.z, rotor, reality.depth);
      vec3 energy = mix(vec3(0.0, 1.0, 0.9), vec3(0.9, 0.2, 1.0), pulse);
      col = mix(col, energy * (diff + rim), 0.08 * (1.0 - uZkpProofConsistency));
      
      col += vec3(1.0) * spec * 0.45;

      if(uBladeDepthDebug > 0.0) {
          col = mix(col, vec3(reality.depth * 0.3, reality.depth * 0.1, 0.5), 0.6 * uBladeDepthDebug);
      }
      if(uShowNormals > 0.5) col = n * 0.5 + 0.5;
      if(uShowPhiSteps > 0.5) {
          float s = steps / uMaxSteps;
          col = mix(vec3(0.0, 0.05, 0.15), vec3(1.0, 0.85, 0.1), s);
      }
      if(uShowStepDepth > 0.5) {
          col = vec3(pulse, rotor, fract(p.z * uPhi));
      }
    } else {
      float bg = pow(1.0 - length(vUv - 0.5), 2.2);
      col = vec3(0.0, 0.002, 0.006) * bg;
    }

    gl_FragColor = vec4(pow(col, vec3(0.4545)), 1.0);
  }
`;class uUe extends WBe{constructor(){super({uniforms:{uPhi:{value:ore},uPi:{value:aUe},uTime:{value:0},uLocalCameraPosition:{value:new en(0,0,5)},uPhiStepMultiplier:{value:.5},uPiPrecisionThreshold:{value:15e-5},uMaxSteps:{value:400},uMaxDistance:{value:100},uDepthScale:{value:1.5},uMetricExtension:{value:2},uEigenValue:{value:2.618},uZkpProofConsistency:{value:1},uAssetAspect:{value:1},uShowPhiSteps:{value:0},uShowNormals:{value:0},uShowBlade:{value:0},uShowStepDepth:{value:0},uBladeDepthDebug:{value:0},uVideoTexture:{value:null},uHasVideo:{value:!1},uSaturation:{value:1},uBrightness:{value:0},uExposure:{value:0},uContrast:{value:1},uShadows:{value:0},uHighlights:{value:0},uVibrance:{value:0},uHue:{value:0},uBwFilter:{value:0}},vertexShader:lUe,fragmentShader:cUe,transparent:!0,side:uBe,depthWrite:!0,depthTest:!0})}updateUniforms(e,t,i,r,s){const o=this.uniforms;if(!o)return;if(o.uTime.value=t,o.uPhi.value=e.phi,o.uPi.value=e.pi,o.uPhiStepMultiplier.value=e.phiStepMultiplier,o.uPiPrecisionThreshold.value=e.piPrecisionThreshold,o.uMaxSteps.value=e.maxSteps,o.uDepthScale.value=e.depthScale,o.uMetricExtension.value=e.metricExtension,o.uEigenValue.value=e.eigenValue,o.uZkpProofConsistency.value=e.zkpProofConsistency,o.uBladeDepthDebug.value=e.bladeDepthDebug,s&&s.image){const l=s.image,c=l.videoWidth||l.width||1,u=l.videoHeight||l.height||1;o.uAssetAspect.value=c/u}const a=i.clone();r.worldToLocal(a),o.uLocalCameraPosition.value.copy(a),o.uShowPhiSteps.value=e.showPhiSteps?1:0,o.uShowNormals.value=e.showNormals?1:0,o.uShowBlade.value=e.showBlade?1:0,o.uShowStepDepth.value=e.showStepDepth?1:0,s?(o.uVideoTexture.value=s,o.uHasVideo.value=!0):o.uHasVideo.value=!1,o.uSaturation.value=e.saturation,o.uBrightness.value=e.brightness,o.uExposure.value=e.exposure,o.uContrast.value=e.contrast,o.uShadows.value=e.shadows,o.uHighlights.value=e.highlights,o.uVibrance.value=e.vibrance,o.uHue.value=e.hue,o.uBwFilter.value=e.bwFilter}disposeResources(){this.uniforms.uVideoTexture.value&&(this.uniforms.uVideoTexture.value.dispose(),this.uniforms.uVideoTexture.value=null),this.uniforms.uHasVideo.value=!1,this.dispose()}setBladeDepthDebug(e){this.uniforms.uBladeDepthDebug.value=e}setShowStepDepth(e){this.uniforms.uShowStepDepth.value=e?1:0}setShowBlade(e){this.uniforms.uShowBlade.value=e?1:0}}const hUe=({zoomLevel:n,setZoomLevel:e,enablePan:t=!1,minDistance:i=3,maxDistance:r=20})=>{const s=$.useRef(null),{camera:o}=aa(),a=$.useRef(n),l=$.useRef(!1);return $.useEffect(()=>{Math.abs(a.current-n)>.01&&(l.current=!0,o.position.setLength(n),a.current=n,s.current&&s.current.update(),setTimeout(()=>{l.current=!1},50))},[n,o]),ew(()=>{if(s.current&&!l.current){const c=o.position.length();Math.abs(c-a.current)>.1&&(a.current=c,e(Math.round(c*10)/10))}}),f.jsx(oBe,{ref:s,enableZoom:!0,enablePan:t,minDistance:i,maxDistance:r,autoRotate:!1})},dUe=({textureUrl:n,isVideo:e,aspectRatio:t})=>{const i=$.useRef(null),r=$.useRef(null),[s,o]=$.useState(null),{camera:a}=aa(),l=Tn(U=>U.phi),c=Tn(U=>U.pi),u=Tn(U=>U.phiStepMultiplier),h=Tn(U=>U.piPrecisionThreshold),p=Tn(U=>U.maxSteps),m=Tn(U=>U.depthScale),y=Tn(U=>U.metricExtension),b=Tn(U=>U.eigenValue),w=Tn(U=>U.zkpProofConsistency),v=Tn(U=>U.showPhiSteps),T=Tn(U=>U.showNormals),S=Tn(U=>U.saturation),M=Tn(U=>U.brightness),P=Tn(U=>U.exposure),R=Tn(U=>U.contrast),O=Tn(U=>U.shadows),B=Tn(U=>U.highlights),N=Tn(U=>U.vibrance),I=Tn(U=>U.hue),F=Tn(U=>U.bwFilter),j=$.useMemo(()=>{const U=new uUe;return r.current=U,U},[]),W=$.useMemo(()=>{const U=new _O(4,32,32),H=U.attributes.position;for(let q=0;q<H.count;q++){const J=H.getX(q),G=H.getY(q),ee=H.getZ(q),Q=(Math.sin(J*10)+Math.cos(G*10)+Math.sin(ee*10))*.1;H.setXYZ(q,J+Q,G+Q,ee+Q)}return U.computeVertexNormals(),U},[]);return $.useEffect(()=>{if(!n)return;let U=!0,H=null,q=null;const J=()=>{H&&(H.pause(),H.src="",H=null),q&&(q.dispose(),q=null)},G=ee=>{if(!i.current)return;const Q=ee.videoWidth||ee.naturalWidth||ee.width||1,ne=ee.videoHeight||ee.naturalHeight||ee.height||1,fe=Q/ne;i.current.scale.set(10*fe,10,1)};return e?(H=document.createElement("video"),H.src=n,H.crossOrigin="anonymous",H.loop=!0,H.muted=!0,H.playsInline=!0,H.onloadedmetadata=()=>{if(!U||!H)return;H.play().catch(()=>{});const ee=new ZBe(H);ee.minFilter=gm,ee.magFilter=gm,q=ee,o(ee),G(H)}):new JBe().load(n,Q=>{U&&(Q.minFilter=gm,Q.magFilter=gm,q=Q,o(Q),Q.image&&G(Q.image))}),()=>{U=!1,J()}},[n,e]),$.useEffect(()=>()=>{r.current&&r.current.disposeResources(),W.dispose(),s&&s.dispose()},[W,s]),ew(U=>{if(!i.current||!r.current)return;i.current.rotation.y=U.clock.elapsedTime*.1;const H={phi:l,pi:c,phiStepMultiplier:u,piPrecisionThreshold:h,maxSteps:p,depthScale:m,metricExtension:y,eigenValue:b,zkpProofConsistency:w,bladeDepthDebug:0,showPhiSteps:v,showNormals:T,showBlade:!1,showStepDepth:!1,saturation:S,brightness:M,exposure:P,contrast:R,shadows:O,highlights:B,vibrance:N,hue:I,bwFilter:F};r.current.updateUniforms(H,U.clock.elapsedTime,a.position,i.current,s)}),f.jsx("mesh",{ref:i,geometry:W,material:j})},fUe=({size:n})=>{const e=$.useRef(null);ew(i=>{e.current&&(e.current.rotation.z=i.clock.elapsedTime*.1)});const t=$.useMemo(()=>{const i=[],r=n*.15;i.push(f.jsxs("mesh",{position:[0,0,-.5],children:[f.jsx("ringGeometry",{args:[r-.01,r,64]}),f.jsx("meshBasicMaterial",{color:"#00f3ff",transparent:!0,opacity:.15})]},"center"));for(let s=0;s<6;s++){const o=s*60*(Math.PI/180),a=r*Math.cos(o),l=r*Math.sin(o);i.push(f.jsxs("mesh",{position:[a,l,-.5],children:[f.jsx("ringGeometry",{args:[r-.01,r,64]}),f.jsx("meshBasicMaterial",{color:"#4caf50",transparent:!0,opacity:.1})]},`ring1-${s}`))}for(let s=0;s<12;s++){const o=(s*30+15)*(Math.PI/180),a=r*ore,l=Math.cos(o)*a,c=Math.sin(o)*a;i.push(f.jsxs("mesh",{position:[l,c,-.5],children:[f.jsx("ringGeometry",{args:[r*.8-.01,r*.8,48]}),f.jsx("meshBasicMaterial",{color:"#00f3ff",transparent:!0,opacity:.06})]},`ring2-${s}`))}return i.length!==19&&console.warn(`[FlowerOfLife] Expected 19 circles, got ${i.length}`),i},[n]);return f.jsx("group",{ref:e,children:t})},pUe=({tensorData:n,onClose:e})=>{const[t,i]=$.useState(0),r=$.useRef(null),s=$.useRef(null);$.useState("normal");const o=Tn(me=>me.toggleDebug),a=Tn(me=>me.setZkpProofConsistency),l=Tn(me=>me.zkpProofConsistency),c=Tn(me=>me.setDepthScale),u=Tn(me=>me.depthScale),h=Tn(me=>me.setMetricExtension),p=Tn(me=>me.metricExtension),m=Tn(me=>me.showPhiSteps),y=Tn(me=>me.showNormals),b=Tn(me=>me.zoomLevel),w=Tn(me=>me.setZoomLevel),v=Tn(me=>me.saturation),T=Tn(me=>me.setSaturation),S=Tn(me=>me.brightness),M=Tn(me=>me.setBrightness),P=Tn(me=>me.exposure),R=Tn(me=>me.setExposure),O=Tn(me=>me.contrast),B=Tn(me=>me.setContrast),N=Tn(me=>me.shadows),I=Tn(me=>me.setShadows),F=Tn(me=>me.highlights),j=Tn(me=>me.setHighlights),W=Tn(me=>me.vibrance),U=Tn(me=>me.setVibrance),H=Tn(me=>me.hue),q=Tn(me=>me.setHue),J=Tn(me=>me.bwFilter),G=Tn(me=>me.setBwFilter),ee=$.useCallback(()=>{i(me=>me+1),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>i(0),500)},[]);$.useEffect(()=>{t>=3&&(e(),i(0))},[t,e]),$.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]);const Q=$.useCallback(()=>{const me=JSON.stringify(n,null,2),nt=new Blob([me],{type:"application/json"}),Pt=URL.createObjectURL(nt),zt=document.createElement("a");zt.href=Pt,zt.download=`tensor_object_${Date.now()}.json`,zt.click(),URL.revokeObjectURL(Pt)},[n]),ne=$.useCallback(me=>{const nt=document.createElement("a");nt.href=me.url,nt.download=me.fileName,nt.target="_blank",nt.click()},[]),fe=n.originalFiles?.[0],Ae=fe?.mimeType?.startsWith("video/"),Pe=n.dimensions.width/n.dimensions.height||1;Tn(me=>me.tensorField),Tn(me=>me.flowerOfLifePattern);const Ce=Tn(me=>me.tensorPerformance),de=Tn(me=>me.phi),Ne=Tn(me=>me.pi),et=Tn(me=>me.eigenValue);return f.jsxs("div",{ref:s,className:"fixed inset-0 z-[400] flex items-center justify-center backdrop-blur-xl bg-black/80 touch-manipulation",onClick:ee,style:{backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)"},children:[f.jsx("button",{onClick:me=>{me.stopPropagation(),e()},className:"absolute top-4 right-4 z-10 p-2 bg-black/60 border border-[#00f3ff]/30 rounded-full text-[#00f3ff] hover:bg-[#00f3ff]/20 transition-all",children:f.jsx(Ui,{size:20})}),f.jsxs("div",{className:"absolute top-4 left-4 z-10 flex flex-col gap-2",children:[f.jsxs("div",{className:"px-3 py-1.5 bg-black/80 border border-purple-500/40 rounded backdrop-blur-sm",children:[f.jsxs("div",{className:"text-[8px] text-purple-400/80 uppercase tracking-wider flex items-center gap-1",children:[f.jsx(nk,{size:10})," ACUTE REALITY V7"]}),f.jsx("div",{className:"text-[10px] text-purple-300 font-mono",children:"PHI-PI SUBSTRATE ENGINE"})]}),f.jsxs("div",{className:"px-3 py-1.5 bg-black/80 border border-[#00f3ff]/30 rounded backdrop-blur-sm",children:[f.jsx("div",{className:"text-[8px] text-[#00f3ff]/60 uppercase tracking-wider",children:"RAYMARCHING"}),f.jsxs("div",{className:"text-[10px] text-[#00f3ff] font-mono",children:[n.vertices," vertices"]})]}),f.jsxs("div",{className:"px-3 py-1.5 bg-black/80 border border-[#4caf50]/30 rounded backdrop-blur-sm",children:[f.jsx("div",{className:"text-[8px] text-[#4caf50]/60 uppercase tracking-wider",children:"RBBRRBR STITCHING"}),f.jsxs("div",{className:"text-[10px] text-[#4caf50] font-mono",children:["ZKP Consistency: ",(l*100).toFixed(0),"%"]})]}),Ce.tensorOperations>0&&f.jsxs("div",{className:"px-3 py-1.5 bg-black/80 border border-[#4caf50]/30 rounded backdrop-blur-sm",children:[f.jsxs("div",{className:"text-[8px] text-[#4caf50]/60 uppercase tracking-wider flex items-center gap-1",children:[f.jsx(Vm,{size:10})," PERFORMANCE"]}),f.jsxs("div",{className:"text-[9px] text-[#4caf50] font-mono space-y-0.5",children:[f.jsxs("div",{children:["Products: ",Ce.geometricProducts]}),f.jsxs("div",{children:["Optimization: ",Ce.optimizationRatio.toFixed(1),"x"]})]})]})]}),f.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-10 text-center max-w-[90vw] sm:max-w-none",children:[f.jsx("div",{className:"text-[8px] sm:text-[9px] text-[#00f3ff]/40 uppercase tracking-wider mb-2",children:"Triple-tap to close | Drag to rotate | Pinch to zoom"}),f.jsxs("div",{className:"flex gap-1 sm:gap-2 justify-center flex-wrap px-2",children:[f.jsxs("button",{onClick:me=>{me.stopPropagation(),Q()},className:"px-3 sm:px-4 py-2 bg-[#00f3ff]/10 border border-[#00f3ff]/40 text-[#00f3ff] text-[8px] sm:text-[9px] font-bold uppercase tracking-wider rounded hover:bg-[#00f3ff]/20 transition-all flex items-center gap-1 sm:gap-2 touch-manipulation",children:[f.jsx(Zf,{size:12})," Tensor"]}),n.originalFiles?.map((me,nt)=>f.jsxs("button",{onClick:Pt=>{Pt.stopPropagation(),ne(me)},className:"px-3 sm:px-4 py-2 bg-[#4caf50]/10 border border-[#4caf50]/40 text-[#4caf50] text-[8px] sm:text-[9px] font-bold uppercase tracking-wider rounded hover:bg-[#4caf50]/20 transition-all flex items-center gap-1 sm:gap-2 touch-manipulation",children:[me.mimeType?.startsWith("video/")?f.jsx(JP,{size:12}):f.jsx(J3,{size:12}),f.jsxs("span",{className:"hidden sm:inline",children:[me.fileName.slice(0,15),"..."]}),f.jsxs("span",{className:"sm:hidden",children:[me.fileName.slice(0,8),"..."]})]},nt))]})]}),f.jsx("div",{className:"w-full h-full max-w-4xl max-h-[80vh] aspect-square",onClick:me=>me.stopPropagation(),children:f.jsxs(qOe,{shadows:!0,children:[f.jsx(sBe,{makeDefault:!0,position:[0,0,b],fov:50}),f.jsx("ambientLight",{intensity:.2}),f.jsx("pointLight",{position:[8,8,12],intensity:.8,castShadow:!0,color:"#ffffff"}),f.jsx("pointLight",{position:[-8,-8,12],intensity:.4,color:"#00f3ff"}),f.jsx(dUe,{textureUrl:fe?.url,isVideo:Ae,aspectRatio:Pe}),f.jsx(fUe,{size:3}),f.jsx(hUe,{zoomLevel:b,setZoomLevel:w,enablePan:!1,minDistance:3,maxDistance:20})]})}),f.jsxs("div",{className:"absolute right-2 sm:right-4 top-1/2 -translate-y-1/2 z-10 flex flex-col gap-2 max-h-[80vh] overflow-y-auto",children:[f.jsxs("div",{className:"px-3 py-2 bg-black/80 border border-purple-500/20 rounded backdrop-blur-sm text-[8px] text-purple-400/80 space-y-2",children:[f.jsxs("div",{className:"text-purple-300 font-bold uppercase tracking-wider flex items-center gap-1",children:[f.jsx(Mae,{size:10})," SUBSTRATE CONTROLS"]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-purple-400/60",children:"ZKP Consistency"}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.01",value:l,onChange:me=>a(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-purple-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-purple-400/60",children:"Depth Scale"}),f.jsx("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:u,onChange:me=>c(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-purple-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-purple-400/60",children:"Metric Extension"}),f.jsx("input",{type:"range",min:"0.5",max:"4",step:"0.1",value:p,onChange:me=>h(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-purple-900/50 rounded appearance-none cursor-pointer"})]})]}),f.jsxs("div",{className:"px-3 py-2 bg-black/80 border border-[#00f3ff]/20 rounded backdrop-blur-sm text-[8px] text-[#00f3ff]/60 space-y-1",children:[f.jsx("div",{className:"text-[#00f3ff] font-bold uppercase tracking-wider",children:"PHI-PI CONSTANTS"}),f.jsxs("div",{className:"font-mono",children:[": ",de.toFixed(9)]}),f.jsxs("div",{className:"font-mono",children:[": ",Ne.toFixed(9)]}),f.jsxs("div",{className:"font-mono",children:[" (Eigen): ",et.toFixed(3)]}),f.jsxs("div",{className:"font-mono",children:["Depth: ",u.toFixed(1)]}),f.jsxs("div",{className:"font-mono",children:["Extension: ",p.toFixed(1)]})]}),f.jsxs("div",{className:"px-3 py-2 bg-black/80 border border-[#4caf50]/20 rounded backdrop-blur-sm text-[8px] text-[#4caf50]/60 space-y-1",children:[f.jsx("div",{className:"text-[#4caf50] font-bold uppercase tracking-wider",children:"MANIFOLD STATUS"}),f.jsxs("div",{className:"font-mono",children:["Aspect: ",Pe.toFixed(2)]}),f.jsxs("div",{className:"font-mono",children:["Vertices: ",n.vertices]}),f.jsxs("div",{className:"font-mono flex items-center gap-1",children:[f.jsx("span",{className:"w-1.5 h-1.5 bg-green-400 rounded-full animate-pulse"}),"SEWN TO SUBSTRATE"]})]}),f.jsxs("div",{className:"px-3 py-2 bg-black/80 border border-orange-500/20 rounded backdrop-blur-sm text-[8px] space-y-2",children:[f.jsxs("div",{className:"text-orange-400 font-bold uppercase tracking-wider flex items-center gap-1",children:[f.jsx(QP,{size:10})," DEBUG MODES"]}),f.jsxs("div",{className:"flex flex-wrap gap-1",children:[f.jsx("button",{onClick:me=>{me.stopPropagation(),o("showNormals")},className:`px-2 py-1 text-[7px] rounded border transition-all ${y?"bg-orange-500/30 border-orange-400 text-orange-300":"bg-black/40 border-orange-500/30 text-orange-500/60"}`,children:"NORMALS"}),f.jsx("button",{onClick:me=>{me.stopPropagation(),o("showPhiSteps")},className:`px-2 py-1 text-[7px] rounded border transition-all ${m?"bg-orange-500/30 border-orange-400 text-orange-300":"bg-black/40 border-orange-500/30 text-orange-500/60"}`,children:"PHI STEPS"})]})]})]}),f.jsxs("div",{className:"absolute left-2 sm:left-4 top-1/2 -translate-y-1/2 z-10 flex flex-col gap-2 mt-16 sm:mt-32 max-h-[70vh] overflow-y-auto",children:[f.jsxs("div",{className:"px-3 py-2 bg-black/80 border border-cyan-500/20 rounded backdrop-blur-sm text-[8px] space-y-2 w-36",children:[f.jsxs("div",{className:"text-cyan-300 font-bold uppercase tracking-wider flex items-center gap-1",children:[f.jsx(EK,{size:10})," ZOOM"]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("input",{type:"range",min:"3",max:"20",step:"0.5",value:b,onChange:me=>w(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-cyan-900/50 rounded appearance-none cursor-pointer"}),f.jsxs("div",{className:"text-[7px] text-cyan-400/60 text-right",children:[b.toFixed(1),"x"]})]})]}),f.jsxs("div",{className:"px-3 py-2 bg-black/80 border border-pink-500/20 rounded backdrop-blur-sm text-[8px] space-y-2 w-36 max-h-[45vh] overflow-y-auto",children:[f.jsxs("div",{className:"text-pink-300 font-bold uppercase tracking-wider flex items-center gap-1",children:[f.jsx(J3,{size:10})," TEXTURE"]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Saturation"}),f.jsx("input",{type:"range",min:"0",max:"2",step:"0.05",value:v,onChange:me=>T(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Brightness"}),f.jsx("input",{type:"range",min:"-0.5",max:"0.5",step:"0.02",value:S,onChange:me=>M(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Exposure"}),f.jsx("input",{type:"range",min:"-2",max:"2",step:"0.1",value:P,onChange:me=>R(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Contrast"}),f.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.05",value:O,onChange:me=>B(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Shadows"}),f.jsx("input",{type:"range",min:"-1",max:"1",step:"0.05",value:N,onChange:me=>I(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Highlights"}),f.jsx("input",{type:"range",min:"-1",max:"1",step:"0.05",value:F,onChange:me=>j(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Vibrance"}),f.jsx("input",{type:"range",min:"-1",max:"1",step:"0.05",value:W,onChange:me=>U(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"Hue Shift"}),f.jsx("input",{type:"range",min:"-0.5",max:"0.5",step:"0.02",value:H,onChange:me=>q(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("div",{className:"space-y-1",children:[f.jsx("label",{className:"block text-[7px] text-pink-400/60",children:"B&W Filter"}),f.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:J,onChange:me=>G(parseFloat(me.target.value)),onClick:me=>me.stopPropagation(),className:"w-full h-1 bg-pink-900/50 rounded appearance-none cursor-pointer"})]}),f.jsxs("button",{onClick:me=>{me.stopPropagation(),T(1),M(0),R(0),B(1),I(0),j(0),U(0),q(0),G(0)},className:"w-full mt-1 px-2 py-1 text-[7px] bg-pink-500/20 border border-pink-500/40 text-pink-300 rounded hover:bg-pink-500/30 transition-all flex items-center justify-center gap-1",children:[f.jsx(l7,{size:8})," RESET"]})]})]})]})},Fv="",mUe={".docx":"application/vnd.openxmlformats-officedocument.wordprocessingml.document",".doc":"application/msword",".odt":"application/vnd.oasis.opendocument.text",".rtf":"application/rtf",".pages":"application/x-iwork-pages-sffpages",".wpd":"application/vnd.wordperfect",".wp5":"application/vnd.wordperfect",".wps":"application/vnd.ms-works",".gdoc":"application/vnd.google-apps.document",".txt":"text/plain",".md":"text/markdown",".log":"text/plain",".csv":"text/csv",".asc":"text/plain",".tex":"application/x-tex",".ini":"text/plain",".cfg":"text/plain",".pdf":"application/pdf",".epub":"application/epub+zip",".ps":"application/postscript",".xps":"application/vnd.ms-xpsdocument",".eml":"message/rfc822",".emlx":"message/rfc822",".msg":"application/vnd.ms-outlook",".html":"text/html",".htm":"text/html",".xml":"application/xml",".json":"application/json",".c":"text/x-csrc",".cpp":"text/x-c++src",".h":"text/x-c++src",".java":"text/x-java",".class":"application/java-vm",".py":"text/x-python",".js":"text/javascript",".ts":"text/typescript",".jsx":"text/javascript",".tsx":"text/typescript",".sh":"application/x-sh",".bat":"application/x-bat",".ipynb":"application/x-ipynb+json",".css":"text/css",".yaml":"text/yaml",".yml":"text/yaml",".circom":"application/x-circom",".asm":"text/x-asm",".rs":"text/x-rust",".go":"text/x-go"},VE=class VE{static getInstance(){return this.instance||(this.instance=new VE),this.instance}async uploadFile(e,t){return new Promise((i,r)=>{const s=new FileReader;s.onload=async()=>{try{const o=s.result,a=await fetch(`${Fv}/api/media/upload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:o,filename:e.name,mimeType:e.type||this.getMimeType(e.name),senderId:t})});if(!a.ok){const c=await a.json();throw new Error(c.error||"Upload failed")}const l=await a.json();i({success:!0,fileId:l.fileId,url:`${Fv}${l.url}`,metadata:l.metadata})}catch(o){r(o)}},s.onerror=()=>r(new Error("Failed to read file")),s.readAsDataURL(e)})}async uploadMultipleFiles(e,t){const i=[];for(const r of e)try{const s=await this.uploadFile(r,t);i.push(s)}catch(s){console.error(`Failed to upload ${r.name}:`,s)}return i}getMediaUrl(e){return`${Fv}/media/${e}`}getDownloadUrl(e){return`${Fv}/api/media/${e}`}async getFileInfo(e){try{const t=await fetch(`${Fv}/api/media/${e}/info`);return t.ok?await t.json():null}catch{return null}}getMimeType(e){const t="."+e.split(".").pop()?.toLowerCase();return mUe[t]||"application/octet-stream"}isImage(e){return e.startsWith("image/")}isVideo(e){return e.startsWith("video/")}isDocument(e){return e.startsWith("text/")||e.startsWith("application/vnd.openxmlformats")||e.startsWith("application/vnd.oasis.opendocument")||e==="application/pdf"||e==="application/json"||e==="application/msword"||e==="application/rtf"||e==="application/epub+zip"||e==="application/postscript"||e==="application/xml"||e==="application/x-circom"||e==="application/x-ipynb+json"||e==="message/rfc822"}getFileTypeCategory(e){return this.isImage(e)?"image":this.isVideo(e)?"video":this.isDocument(e)?"document":"unknown"}};E(VE,"instance");let JN=VE;const Bg=JN.getInstance(),W5=1.618033988749895,W$=3.141592653589793,HE=class HE{static getInstance(){return this.instance||(this.instance=new HE),this.instance}createTensorPixel(e,t,i,r,s){const o={x:e,y:t,z:i},a=Math.sqrt(e*e+t*t+i*i),l={e12:e*t,e13:e*i,e23:t*i,magnitude:Math.sqrt(e*e+t*t+i*i)},c={e123:e*t*i,magnitude:Math.abs(e*t*i)};return{rgb:o,coordinate:{x:r,y:s},magnitude:a,rank:a>.5?3:a>.2?2:1,bivector:l,trivector:c}}generateFlowerOfLifeRays(e,t,i,r,s){const o=[];o.push({center:{x:e,y:t},radius:i*s,generation:0,active:!0});for(let a=1;a<=r;a++){const l=6*a,c=i*Math.pow(W5,a-1)*s;for(let u=0;u<l;u++){const h=u*(360/l)*(W$/180),p=c*W5;o.push({center:{x:e+Math.cos(h)*p,y:t+Math.sin(h)*p},radius:c,generation:a,active:!0})}}return o}async processImageToTensorField(e){const t=document.createElement("canvas"),i=t.getContext("2d");let r,s;e instanceof HTMLVideoElement?(r=e.videoWidth||256,s=e.videoHeight||256):e instanceof HTMLImageElement?(r=e.naturalWidth||e.width||256,s=e.naturalHeight||e.height||256):(r=e.width||256,s=e.height||256);const o=64;t.width=Math.min(r,o),t.height=Math.min(s,o),i.drawImage(e,0,0,t.width,t.height);const a=i.getImageData(0,0,t.width,t.height),l=[],c=Math.max(1,Math.floor(t.width/Math.sqrt(o))),u=Math.max(1,Math.floor(t.height/Math.sqrt(o)));for(let h=0;h<t.height;h+=u)for(let p=0;p<t.width;p+=c){const m=(h*t.width+p)*4,y=a.data[m]/255,b=a.data[m+1]/255,w=a.data[m+2]/255,v=p/t.width*2-1,T=h/t.height*2-1;l.push(this.createTensorPixel(y,b,w,v,T))}return{pixels:l,bounds:{min:{x:-1,y:-1},max:{x:1,y:1}},resolution:o,width:t.width,height:t.height}}async convertToTensor3DObject(e,t={}){const{generations:i=3,sacredGeometryScale:r=1,tensorResolution:s=64}=t;let o=null;const a=document.createElement("canvas");a.width=128,a.height=128;const l=a.getContext("2d"),c=e.length,u=Math.ceil(Math.sqrt(c)),h=a.width/u,p=a.height/u;for(let v=0;v<e.length;v++){const T=e[v],S=await this.processImageToTensorField(T.element);o?o.pixels.push(...S.pixels.map(R=>({...R,coordinate:{x:R.coordinate.x+v%2*.5,y:R.coordinate.y+Math.floor(v/2)*.5}}))):o=S;const M=Math.floor(v/u),P=v%u;l.drawImage(T.element,P*h,M*p,h,p)}if(!o)throw new Error("No valid sources to process");const m=this.generateFlowerOfLifeRays(0,0,.3,i,r),y=o.width/o.height,b={width:y>1?2:2*y,height:y>1?2/y:2,depth:.5*W5},w=o.pixels.length*8;return{id:`tensor_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,tensorField:o,flowerOfLifeRays:m,dimensions:b,vertices:w,metadata:{phiValue:W5,piValue:W$,generations:i,sacredGeometryScale:r,rayCount:m.length,tensorResolution:s,createdAt:Date.now()},sourceFiles:e.map(v=>({url:v.url,name:v.name,type:v.type})),thumbnailDataUrl:a.toDataURL("image/png")}}exportToJSON(e){return JSON.stringify(e,null,2)}async importFromJSON(e){return JSON.parse(e)}};E(HE,"instance");let eP=HE;const gUe=eP.getInstance(),K$={category:Wl.ALL,dateFrom:void 0,dateTo:void 0,groupId:void 0,senderId:void 0,hasFiles:void 0,isVerified:void 0},q$=(n,e)=>e.trim()?n.split(new RegExp(`(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi")).map((i,r)=>i.toLowerCase()===e.toLowerCase()?f.jsx("span",{className:"bg-[#00f3ff]/30 text-[#00f3ff] font-bold",children:i},r):i):n,yUe=({messages:n,groups:e,members:t,onResultClick:i,onClose:r})=>{const[s,o]=$.useState(""),[a,l]=$.useState(K$),[c,u]=$.useState([]),[h,p]=$.useState(!1),[m,y]=$.useState(!1),[b,w]=$.useState(!1),v=$.useRef(null),T=$.useRef(null),S=$.useRef(null);$.useEffect(()=>(v.current?.focus(),()=>{T.current&&clearTimeout(T.current),S.current&&clearTimeout(S.current)}),[]);const M=$.useCallback((I,F)=>{if(!I.trim()&&F.category===Wl.ALL){u([]),w(!1);return}p(!0),w(!0);const j=I.toLowerCase().trim(),W=[];(F.category===Wl.ALL||F.category===Wl.MESSAGES)&&n.filter(U=>{if(U.deletedAt||!j)return!1;const H=U.content.toLowerCase().includes(j),q=U.sender.toLowerCase().includes(j);if(!H&&!q||F.dateFrom&&U.timestamp<F.dateFrom||F.dateTo&&U.timestamp>F.dateTo)return!1;if(F.hasFiles!==void 0){const J=U.type==="file"||U.type==="image"||U.type==="voice";if(F.hasFiles!==J)return!1}return!(F.isVerified!==void 0&&(U.isZkpVerified??!1)!==F.isVerified)}).forEach(U=>{const H=[];U.content.toLowerCase().includes(j)&&H.push("content"),U.sender.toLowerCase().includes(j)&&H.push("sender"),W.push({id:`msg_${U.id}`,type:"message",title:U.sender,snippet:U.content.length>120?U.content.substring(0,120)+"...":U.content,timestamp:U.timestamp,senderId:U.sender,senderName:U.sender,messageId:U.id,matchedTerms:H,relevanceScore:H.length*10+(U.isZkpVerified??!1?5:0)})}),(F.category===Wl.ALL||F.category===Wl.GROUPS)&&e.filter(U=>j?U.name.toLowerCase().includes(j)||U.description?.toLowerCase().includes(j):!1).forEach(U=>{const H=[];U.name.toLowerCase().includes(j)&&H.push("name"),U.description?.toLowerCase().includes(j)&&H.push("description"),W.push({id:`group_${U.id}`,type:"group",title:U.name,snippet:U.description||`${U.memberCount} members`,timestamp:U.createdAt,groupId:U.id,groupName:U.name,matchedTerms:H,relevanceScore:H.length*15+U.memberCount})}),(F.category===Wl.ALL||F.category===Wl.USERS)&&t.filter(U=>j?U.displayName.toLowerCase().includes(j)||U.peerId.toLowerCase().includes(j):!1).forEach(U=>{const H=[];U.displayName.toLowerCase().includes(j)&&H.push("name"),U.peerId.toLowerCase().includes(j)&&H.push("peerId"),W.push({id:`operator_${U.peerId}`,type:"operator",title:U.displayName,snippet:`Peer: ${U.peerId.substring(0,16)}...`,timestamp:U.joinedAt,senderId:U.peerId,senderName:U.displayName,matchedTerms:H,relevanceScore:H.length*10+(U.isOnline?10:0)})}),(F.category===Wl.ALL||F.category===Wl.FILES)&&n.filter(U=>{if(U.deletedAt||U.type!=="file"&&U.type!=="image")return!1;if(!j)return!0;const H=U.fileName?.toLowerCase().includes(j),q=U.content.toLowerCase().includes(j);return H||q}).forEach(U=>{const H=[];U.fileName?.toLowerCase().includes(j)&&H.push("filename"),U.content.toLowerCase().includes(j)&&H.push("content"),W.push({id:`file_${U.id}`,type:"file",title:U.fileName||"Unnamed File",snippet:`From ${U.sender} - ${U.fileSize?`${(U.fileSize/1024).toFixed(1)} KB`:"Unknown size"}`,timestamp:U.timestamp,senderId:U.sender,senderName:U.sender,messageId:U.id,matchedTerms:H,relevanceScore:H.length*10})}),W.sort((U,H)=>H.relevanceScore-U.relevanceScore),S.current&&clearTimeout(S.current),S.current=setTimeout(()=>{u(W),p(!1)},150)},[n,e,t]),P=$.useCallback(I=>{const F=I.target.value;o(F),T.current&&clearTimeout(T.current),T.current=setTimeout(()=>{M(F,a)},200)},[a,M]),R=$.useCallback((I,F)=>{const j={...a,[I]:F};l(j),M(s,j)},[a,s,M]),O=$.useCallback(()=>{o(""),l(K$),u([]),w(!1),v.current?.focus()},[]),B=I=>{switch(I){case"message":return f.jsx(Pd,{size:14,strokeWidth:1});case"group":return f.jsx(As,{size:14,strokeWidth:1});case"operator":return f.jsx(As,{size:14,strokeWidth:1});case"file":return f.jsx(_K,{size:14,strokeWidth:1});default:return f.jsx(ja,{size:14,strokeWidth:1})}},N=I=>{switch(I){case"message":return"MESSAGE";case"group":return"GROUP";case"operator":return"OPERATOR";case"file":return"FILE";default:return"RESULT"}};return f.jsxs("div",{className:"fixed inset-0 bg-black/95 z-50 flex flex-col animate-in fade-in duration-300",children:[f.jsx("div",{className:"border-b border-[#00f3ff]/20 bg-black/80 backdrop-blur-xl",children:f.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsxs("div",{className:"relative flex-1",children:[f.jsx(ja,{size:18,strokeWidth:1,className:"absolute left-4 top-1/2 -translate-y-1/2 text-[#00f3ff]/50"}),f.jsx("input",{ref:v,type:"text",value:s,onChange:P,placeholder:"SEARCH_MESH_NETWORK...",className:"w-full bg-white/[0.02] border border-[#00f3ff]/20 rounded-none px-12 py-4 text-[#00f3ff] placeholder:text-[#00f3ff]/30 focus:outline-none focus:border-[#00f3ff]/50 font-mono text-sm tracking-wide"}),s&&f.jsx("button",{onClick:O,className:"absolute right-4 top-1/2 -translate-y-1/2 text-[#00f3ff]/50 hover:text-[#00f3ff] transition-colors",children:f.jsx(Ui,{size:18,strokeWidth:1})})]}),f.jsx("button",{onClick:()=>y(!m),className:`p-4 border transition-all ${m?"bg-[#00f3ff]/10 border-[#00f3ff]/50 text-[#00f3ff]":"border-[#00f3ff]/20 text-[#00f3ff]/50 hover:text-[#00f3ff]"}`,children:f.jsx(_ae,{size:18,strokeWidth:1})}),f.jsx("button",{onClick:r,className:"p-4 border border-white/10 text-white/50 hover:text-white hover:border-white/30 transition-all",children:f.jsx(Ui,{size:18,strokeWidth:1})})]}),m&&f.jsx("div",{className:"mt-4 pt-4 border-t border-[#00f3ff]/10 animate-in slide-in-from-top-2 duration-200",children:f.jsxs("div",{className:"flex flex-wrap gap-3",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[8px] font-black tracking-[0.3em] text-[#00f3ff]/50 uppercase",children:"Category:"}),f.jsx("div",{className:"flex gap-1",children:Object.values(Wl).map(I=>f.jsx("button",{onClick:()=>R("category",I),className:`px-3 py-1.5 text-[9px] font-black tracking-widest uppercase transition-all border ${a.category===I?"bg-[#00f3ff]/20 border-[#00f3ff] text-[#00f3ff]":"border-[#00f3ff]/20 text-[#00f3ff]/50 hover:text-[#00f3ff] hover:border-[#00f3ff]/50"}`,children:I},I))})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[8px] font-black tracking-[0.3em] text-[#00f3ff]/50 uppercase",children:"Verified:"}),f.jsxs("button",{onClick:()=>R("isVerified",a.isVerified===!0?void 0:!0),className:`px-3 py-1.5 text-[9px] font-black tracking-widest uppercase transition-all border flex items-center gap-1 ${a.isVerified===!0?"bg-[#4caf50]/20 border-[#4caf50] text-[#4caf50]":"border-[#4caf50]/20 text-[#4caf50]/50 hover:text-[#4caf50]"}`,children:[f.jsx(us,{size:10,strokeWidth:1}),"ZKP_ONLY"]})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[8px] font-black tracking-[0.3em] text-[#00f3ff]/50 uppercase",children:"Files:"}),f.jsxs("button",{onClick:()=>R("hasFiles",a.hasFiles===!0?void 0:!0),className:`px-3 py-1.5 text-[9px] font-black tracking-widest uppercase transition-all border flex items-center gap-1 ${a.hasFiles===!0?"bg-[#00f3ff]/20 border-[#00f3ff] text-[#00f3ff]":"border-[#00f3ff]/20 text-[#00f3ff]/50 hover:text-[#00f3ff]"}`,children:[f.jsx(Sae,{size:10,strokeWidth:1}),"WITH_FILES"]})]})]})})]})}),f.jsx("div",{className:"flex-1 overflow-auto",children:f.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[h&&f.jsx("div",{className:"flex items-center justify-center py-20",children:f.jsxs("div",{className:"flex items-center gap-3 text-[#00f3ff]/50",children:[f.jsx(xr,{size:20,strokeWidth:1,className:"animate-spin"}),f.jsx("span",{className:"text-[10px] font-black tracking-[0.3em] uppercase animate-pulse",children:"SCANNING_MESH..."})]})}),!h&&b&&c.length===0&&f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx(ja,{size:40,strokeWidth:.5,className:"text-[#00f3ff]/20 mb-4"}),f.jsx("p",{className:"text-[#00f3ff]/40 text-[10px] font-black tracking-[0.3em] uppercase mb-2",children:"NO_RESULTS_FOUND"}),f.jsx("p",{className:"text-white/30 text-xs",children:"Try adjusting your search terms or filters"})]}),!h&&!b&&f.jsxs("div",{className:"flex flex-col items-center justify-center py-20 text-center",children:[f.jsx(ja,{size:40,strokeWidth:.5,className:"text-[#00f3ff]/20 mb-4"}),f.jsx("p",{className:"text-[#00f3ff]/40 text-[10px] font-black tracking-[0.3em] uppercase mb-2",children:"MESH_SEARCH_READY"}),f.jsx("p",{className:"text-white/30 text-xs",children:"Search messages, groups, peers, and files"})]}),!h&&c.length>0&&f.jsxs("div",{className:"space-y-2",children:[f.jsxs("div",{className:"flex items-center justify-between mb-4",children:[f.jsxs("span",{className:"text-[8px] font-black tracking-[0.3em] text-[#00f3ff]/50 uppercase",children:[c.length," RESULT",c.length!==1?"S":""," FOUND"]}),f.jsxs("span",{className:"text-[8px] font-black tracking-[0.3em] text-[#4caf50]/50 uppercase flex items-center gap-1",children:[f.jsx(us,{size:10,strokeWidth:1}),"SORTED_BY_RELEVANCE"]})]}),c.map((I,F)=>f.jsx("button",{onClick:()=>i(I),className:"w-full text-left p-4 bg-white/[0.02] border border-[#00f3ff]/10 hover:border-[#00f3ff]/30 hover:bg-[#00f3ff]/[0.03] transition-all group animate-in fade-in slide-in-from-bottom-2",style:{animationDelay:`${F*30}ms`},children:f.jsxs("div",{className:"flex items-start gap-4",children:[f.jsx("div",{className:`p-2 border ${I.type==="message"?"border-[#00f3ff]/30 text-[#00f3ff]":I.type==="group"?"border-[#4caf50]/30 text-[#4caf50]":I.type==="operator"?"border-purple-500/30 text-purple-400":"border-yellow-500/30 text-yellow-400"}`,children:B(I.type)}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[f.jsx("span",{className:`text-[7px] font-black tracking-[0.3em] uppercase px-2 py-0.5 ${I.type==="message"?"bg-[#00f3ff]/10 text-[#00f3ff]":I.type==="group"?"bg-[#4caf50]/10 text-[#4caf50]":I.type==="operator"?"bg-purple-500/10 text-purple-400":"bg-yellow-500/10 text-yellow-400"}`,children:N(I.type)}),f.jsx("span",{className:"text-[10px] font-bold text-white/80 truncate",children:q$(I.title,s)})]}),f.jsx("p",{className:"text-xs text-white/40 truncate group-hover:text-white/60 transition-colors",children:q$(I.snippet,s)}),f.jsxs("div",{className:"flex items-center gap-3 mt-2 text-[8px] text-white/30",children:[f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(fae,{size:10,strokeWidth:1}),new Date(I.timestamp).toLocaleDateString()]}),I.groupName&&f.jsxs("span",{className:"flex items-center gap-1",children:[f.jsx(As,{size:10,strokeWidth:1}),I.groupName]}),I.matchedTerms.length>0&&f.jsxs("span",{className:"text-[#00f3ff]/50",children:["Matched: ",I.matchedTerms.join(", ")]})]})]}),f.jsx("div",{className:"text-[#00f3ff]/30 group-hover:text-[#00f3ff] transition-colors",children:f.jsx(Hm,{size:16,strokeWidth:1,className:"-rotate-90"})})]})},I.id))]})]})}),f.jsx("div",{className:"border-t border-[#00f3ff]/10 bg-black/80 backdrop-blur-xl p-3",children:f.jsxs("div",{className:"max-w-4xl mx-auto flex items-center justify-between text-[8px] text-white/30 font-mono tracking-wider",children:[f.jsx("span",{children:"ESC to close"}),f.jsxs("span",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-[#4caf50]",children:"ZKP"}),f.jsx("span",{children:"ENCRYPTED_SEARCH_INDEX"})]})]})})]})};var WS=(n=>(n.MESSAGE="message",n.GROUP_INVITE="group_invite",n.GROUP_JOIN="group_join",n.SECURITY="security",n.WARNING="warning",n.SUCCESS="success",n.INFO="info",n))(WS||{});const xUe={enabled:!0,sound:!0,desktop:!0,showPreview:!0,mutedGroups:[],mutedUntil:null},are=n=>{switch(n){case"message":return f.jsx(Pd,{size:16,strokeWidth:1.5});case"group_invite":case"group_join":return f.jsx(As,{size:16,strokeWidth:1.5});case"security":return f.jsx(ao,{size:16,strokeWidth:1.5});case"warning":return f.jsx(T0,{size:16,strokeWidth:1.5});case"success":return f.jsx(f2,{size:16,strokeWidth:1.5});case"info":default:return f.jsx(Cae,{size:16,strokeWidth:1.5})}},lre=n=>{switch(n){case"message":return"text-[#00f3ff] border-[#00f3ff]/30 bg-[#00f3ff]/5";case"group_invite":case"group_join":return"text-[#4caf50] border-[#4caf50]/30 bg-[#4caf50]/5";case"security":return"text-purple-400 border-purple-400/30 bg-purple-400/5";case"warning":return"text-yellow-400 border-yellow-400/30 bg-yellow-400/5";case"success":return"text-[#4caf50] border-[#4caf50]/30 bg-[#4caf50]/5";case"info":default:return"text-white/70 border-white/20 bg-white/5"}},vUe=({notification:n,onDismiss:e,onClick:t})=>{const i=$.useRef(null);$.useEffect(()=>(i.current=setTimeout(()=>{e(n.id)},5e3),()=>{i.current&&clearTimeout(i.current)}),[n.id,e]);const r=lre(n.type);return f.jsx("div",{className:`animate-in slide-in-from-right-full fade-in duration-300 border ${r} p-4 shadow-lg cursor-pointer hover:scale-[1.02] transition-transform`,onClick:()=>t?.(n),children:f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx("div",{className:"mt-0.5 flex-shrink-0",children:are(n.type)}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center justify-between gap-2",children:[f.jsx("h4",{className:"text-[10px] font-black uppercase tracking-wider truncate",children:n.title}),f.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),e(n.id)},className:"text-white/40 hover:text-white p-1 -mr-1 flex-shrink-0",children:f.jsx(Ui,{size:12,strokeWidth:1.5})})]}),f.jsx("p",{className:"text-[9px] text-white/60 mt-1 line-clamp-2",children:n.message}),f.jsx("div",{className:"text-[7px] text-white/30 mt-2 uppercase tracking-wider",children:new Date(n.timestamp).toLocaleTimeString()})]})]})})},bUe=({notifications:n,onDismiss:e,onClick:t})=>{const i=n.filter(r=>!r.read).slice(0,5);return i.length===0?null:f.jsx("div",{className:"fixed top-4 right-4 z-[100] flex flex-col gap-2 max-w-xs w-full pointer-events-auto",children:i.map(r=>f.jsx(vUe,{notification:r,onDismiss:e,onClick:t},r.id))})},_Ue=({notifications:n,settings:e,onUpdateSettings:t,onMarkRead:i,onMarkAllRead:r,onDelete:s,onClearAll:o,onClick:a,onClose:l})=>{const[c,u]=Fa.useState("all"),h=n.filter(m=>!m.read).length,p=m=>{t({...e,mutedUntil:m?Date.now()+m:null})};return f.jsx("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4 animate-in fade-in duration-300",children:f.jsxs("div",{className:"bg-[#010401] border border-[#00f3ff]/20 w-full max-w-lg max-h-[80vh] flex flex-col shadow-[0_0_40px_rgba(0,243,255,0.1)]",children:[f.jsxs("div",{className:"p-4 border-b border-[#00f3ff]/10 flex items-center justify-between flex-shrink-0",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(A0,{size:18,className:"text-[#00f3ff]",strokeWidth:1}),f.jsx("h2",{className:"text-[#00f3ff] font-black text-sm uppercase tracking-[0.2em]",children:"Notifications"}),h>0&&f.jsx("span",{className:"bg-[#00f3ff] text-black text-[8px] font-black px-2 py-0.5 rounded-full",children:h})]}),f.jsx("button",{onClick:l,className:"text-white/40 hover:text-white p-2",children:f.jsx(Ui,{size:18,strokeWidth:1})})]}),f.jsxs("div",{className:"flex border-b border-[#00f3ff]/10 flex-shrink-0",children:[f.jsxs("button",{type:"button",onClick:()=>u("all"),className:`flex-1 px-4 py-3 text-[9px] font-black uppercase tracking-widest transition-all ${c==="all"?"text-[#00f3ff] border-b-2 border-[#00f3ff]":"text-white/40 hover:text-white/60"}`,children:["All (",n.length,")"]}),f.jsx("button",{type:"button",onClick:()=>u("settings"),className:`flex-1 px-4 py-3 text-[9px] font-black uppercase tracking-widest transition-all ${c==="settings"?"text-[#00f3ff] border-b-2 border-[#00f3ff]":"text-white/40 hover:text-white/60"}`,children:"Settings"})]}),f.jsx("div",{className:"flex-1 overflow-y-auto",children:c==="all"?f.jsx("div",{className:"divide-y divide-white/5",children:n.length===0?f.jsxs("div",{className:"p-8 text-center",children:[f.jsx(A0,{size:32,className:"text-white/10 mx-auto mb-4",strokeWidth:1}),f.jsx("p",{className:"text-white/30 text-[10px] uppercase tracking-wider",children:"No notifications"})]}):f.jsx(f.Fragment,{children:n.map(m=>{const y=lre(m.type);return f.jsx("div",{className:`p-4 hover:bg-white/[0.02] cursor-pointer transition-colors ${m.read?"":"bg-white/[0.01]"}`,onClick:()=>{m.read||i(m.id),a?.(m)},children:f.jsxs("div",{className:"flex items-start gap-3",children:[f.jsx("div",{className:`mt-0.5 flex-shrink-0 ${y.split(" ")[0]}`,children:are(m.type)}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("h4",{className:"text-[10px] font-bold text-white/90 truncate",children:m.title}),!m.read&&f.jsx("span",{className:"w-1.5 h-1.5 bg-[#00f3ff] rounded-full flex-shrink-0"})]}),f.jsx("p",{className:"text-[9px] text-white/50 mt-1 line-clamp-2",children:m.message}),f.jsx("div",{className:"text-[7px] text-white/30 mt-2 uppercase tracking-wider",children:new Date(m.timestamp).toLocaleString()})]}),f.jsx("button",{type:"button",onClick:b=>{b.stopPropagation(),s(m.id)},className:"text-white/20 hover:text-red-400 p-1 flex-shrink-0",children:f.jsx(Ui,{size:12,strokeWidth:1.5})})]})},m.id)})})}):f.jsxs("div",{className:"p-4 space-y-4",children:[f.jsx("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] font-bold text-white/90",children:"Notifications Enabled"}),f.jsx("div",{className:"text-[8px] text-white/50 mt-1",children:"Receive in-app notifications"})]}),f.jsx("button",{type:"button",onClick:()=>t({...e,enabled:!e.enabled}),className:`w-10 h-5 rounded-full transition-colors relative ${e.enabled?"bg-[#4caf50]":"bg-white/20"}`,children:f.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${e.enabled?"left-5":"left-0.5"}`})})]})}),f.jsx("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] font-bold text-white/90",children:"Sound"}),f.jsx("div",{className:"text-[8px] text-white/50 mt-1",children:"Play sound for notifications"})]}),f.jsx("button",{type:"button",onClick:()=>t({...e,sound:!e.sound}),className:`w-10 h-5 rounded-full transition-colors relative ${e.sound?"bg-[#4caf50]":"bg-white/20"}`,children:f.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${e.sound?"left-5":"left-0.5"}`})})]})}),f.jsx("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] font-bold text-white/90",children:"Desktop Notifications"}),f.jsx("div",{className:"text-[8px] text-white/50 mt-1",children:"Show system notifications"})]}),f.jsx("button",{type:"button",onClick:()=>t({...e,desktop:!e.desktop}),className:`w-10 h-5 rounded-full transition-colors relative ${e.desktop?"bg-[#4caf50]":"bg-white/20"}`,children:f.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${e.desktop?"left-5":"left-0.5"}`})})]})}),f.jsx("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("div",{className:"text-[10px] font-bold text-white/90",children:"Show Message Preview"}),f.jsx("div",{className:"text-[8px] text-white/50 mt-1",children:"Display message content in notifications"})]}),f.jsx("button",{type:"button",onClick:()=>t({...e,showPreview:!e.showPreview}),className:`w-10 h-5 rounded-full transition-colors relative ${e.showPreview?"bg-[#4caf50]":"bg-white/20"}`,children:f.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-transform ${e.showPreview?"left-5":"left-0.5"}`})})]})}),f.jsxs("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[10px] font-bold text-white/90 mb-3",children:"Mute Notifications"}),f.jsx("div",{className:"flex flex-wrap gap-2",children:e.mutedUntil&&e.mutedUntil>Date.now()?f.jsxs("button",{type:"button",onClick:()=>p(null),className:"px-3 py-1.5 bg-yellow-500/20 text-yellow-400 text-[8px] font-bold uppercase tracking-wider hover:bg-yellow-500/30 transition-colors",children:["Unmute (",Math.ceil((e.mutedUntil-Date.now())/6e4),"m left)"]}):f.jsxs(f.Fragment,{children:[f.jsx("button",{type:"button",onClick:()=>p(30*60*1e3),className:"px-3 py-1.5 border border-white/20 text-white/60 text-[8px] font-bold uppercase tracking-wider hover:bg-white/5 transition-colors",children:"30 min"}),f.jsx("button",{type:"button",onClick:()=>p(60*60*1e3),className:"px-3 py-1.5 border border-white/20 text-white/60 text-[8px] font-bold uppercase tracking-wider hover:bg-white/5 transition-colors",children:"1 hour"}),f.jsx("button",{type:"button",onClick:()=>p(8*60*60*1e3),className:"px-3 py-1.5 border border-white/20 text-white/60 text-[8px] font-bold uppercase tracking-wider hover:bg-white/5 transition-colors",children:"8 hours"}),f.jsx("button",{type:"button",onClick:()=>p(24*60*60*1e3),className:"px-3 py-1.5 border border-white/20 text-white/60 text-[8px] font-bold uppercase tracking-wider hover:bg-white/5 transition-colors",children:"24 hours"})]})})]})]})}),c==="all"&&n.length>0&&f.jsxs("div",{className:"p-4 border-t border-white/10 flex gap-2 flex-shrink-0",children:[f.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-[#00f3ff]/30 text-[#00f3ff] text-[9px] font-black uppercase tracking-widest hover:bg-[#00f3ff]/10 transition-all",children:"Mark All Read"}),f.jsx("button",{type:"button",onClick:o,className:"flex-1 px-4 py-2 border border-red-500/30 text-red-400 text-[9px] font-black uppercase tracking-widest hover:bg-red-500/10 transition-all",children:"Clear All"})]})]})})},wUe=n=>{const e=$.useRef(null);$.useEffect(()=>{e.current=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2teleT4iXZDN1adREghA")},[]);const t=async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission==="denied"?!1:await Notification.requestPermission()==="granted":!1;return{playSound:()=>{n.sound&&e.current&&(e.current.currentTime=0,e.current.play().catch(()=>{}))},showDesktopNotification:async(o,a,l)=>{if(!n.desktop)return;await t()&&new Notification(o,{body:a,icon:l??"/favicon.ico",silent:!0})},shouldNotify:()=>!(!n.enabled||n.mutedUntil&&n.mutedUntil>Date.now()),requestDesktopPermission:t}};function Z$(n){const e=new Date(n),i=new Date().getTime()-e.getTime(),r=Math.floor(i/(1e3*60*60*24));return r===0?e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):r===1?"Yesterday":r<7?e.toLocaleDateString([],{weekday:"short"}):e.toLocaleDateString([],{month:"short",day:"numeric"})}function SUe({activeTab:n,groups:e,contacts:t,selectedChatId:i,onSelectChat:r,onCreateGroup:s,onJoinGroup:o,onAddContact:a}){return n==="groups"?e.length===0?f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6",children:[f.jsx("div",{className:"w-16 h-16 rounded-full bg-[#4caf50]/10 border border-[#4caf50]/20 flex items-center justify-center mb-4",children:f.jsx(As,{className:"w-8 h-8 text-[#4caf50]/40"})}),f.jsx("h3",{className:"text-sm font-bold text-[#00f3ff] mb-2",children:"No Groups"}),f.jsx("p",{className:"text-xs text-[#4caf50]/60 text-center mb-6",children:"Create or join a group to start secure communications"}),f.jsxs("div",{className:"flex flex-col gap-2 w-full max-w-[200px]",children:[f.jsxs("button",{onClick:s,className:"w-full py-2.5 rounded-lg bg-[#00f3ff]/10 border border-[#00f3ff]/40 text-[#00f3ff] text-xs font-bold uppercase tracking-wide hover:bg-[#00f3ff]/20 transition-all flex items-center justify-center gap-2",children:[f.jsx(eb,{className:"w-4 h-4"}),"Create Group"]}),f.jsxs("button",{onClick:o,className:"w-full py-2.5 rounded-lg bg-[#4caf50]/10 border border-[#4caf50]/40 text-[#4caf50] text-xs font-bold uppercase tracking-wide hover:bg-[#4caf50]/20 transition-all flex items-center justify-center gap-2",children:[f.jsx(sh,{className:"w-4 h-4"}),"Join Group"]})]})]}):f.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e.map(l=>f.jsxs("button",{onClick:()=>r(l.id,"group"),className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-[#4caf50]/5 transition-colors border-b border-[#4caf50]/10 ${i===l.id?"bg-[#00f3ff]/10":""}`,children:[f.jsxs("div",{className:"relative flex-shrink-0",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center",children:f.jsx("span",{className:"text-[#4caf50] font-bold text-sm",children:l.name.substring(0,2).toUpperCase()})}),l.unreadCount>0&&f.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center px-1 bg-[#00f3ff] text-black text-[10px] font-bold rounded-full",children:l.unreadCount})]}),f.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsx("span",{className:"text-sm font-semibold text-[#00f3ff] truncate",children:l.name}),f.jsx("span",{className:"text-[10px] text-[#4caf50]/60",children:l.lastActivity?Z$(l.lastActivity):""})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(As,{className:"w-3 h-3 text-[#4caf50]/40 flex-shrink-0"}),f.jsxs("span",{className:"text-xs text-[#4caf50]/60 truncate",children:[l.memberCount," members"]}),l.isPrivate&&f.jsx(j0,{className:"w-3 h-3 text-[#4caf50]/40"}),l.zkpVerified&&f.jsx(f_,{className:"w-3 h-3 text-[#00f3ff]/40"})]})]})]},l.id)),f.jsxs("div",{className:"p-4 flex gap-2",children:[f.jsxs("button",{onClick:s,className:"flex-1 py-2 rounded-lg border border-[#00f3ff]/30 text-[#00f3ff] text-xs font-bold hover:bg-[#00f3ff]/10 transition-all flex items-center justify-center gap-1",children:[f.jsx(eb,{className:"w-3 h-3"})," Create"]}),f.jsxs("button",{onClick:o,className:"flex-1 py-2 rounded-lg border border-[#4caf50]/30 text-[#4caf50] text-xs font-bold hover:bg-[#4caf50]/10 transition-all flex items-center justify-center gap-1",children:[f.jsx(sh,{className:"w-3 h-3"})," Join"]})]})]}):t.length===0?f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6",children:[f.jsx("div",{className:"w-16 h-16 rounded-full bg-[#4caf50]/10 border border-[#4caf50]/20 flex items-center justify-center mb-4",children:f.jsx(Pd,{className:"w-8 h-8 text-[#4caf50]/40"})}),f.jsx("h3",{className:"text-sm font-bold text-[#00f3ff] mb-2",children:"No Chats"}),f.jsx("p",{className:"text-xs text-[#4caf50]/60 text-center mb-6",children:"Add a contact to start a secure conversation"}),f.jsxs("button",{onClick:()=>a({peerId:""}),className:"px-6 py-2.5 rounded-lg bg-[#00f3ff]/10 border border-[#00f3ff]/40 text-[#00f3ff] text-xs font-bold uppercase tracking-wide hover:bg-[#00f3ff]/20 transition-all flex items-center gap-2",children:[f.jsx(sh,{className:"w-4 h-4"}),"Add Contact"]})]}):f.jsx("div",{className:"flex-1 overflow-y-auto",children:t.map(l=>f.jsxs("button",{onClick:()=>r(l.peerId,"contact"),className:`w-full px-4 py-3 flex items-center gap-3 hover:bg-[#4caf50]/5 transition-colors border-b border-[#4caf50]/10 ${i===l.peerId?"bg-[#00f3ff]/10":""}`,children:[f.jsxs("div",{className:"relative flex-shrink-0",children:[f.jsx("div",{className:"w-12 h-12 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center overflow-hidden",children:l.avatar?f.jsx("img",{src:l.avatar,alt:"",className:"w-full h-full object-cover"}):f.jsx("span",{className:"text-[#00f3ff] font-bold text-sm",children:(l.displayName||"U").charAt(0).toUpperCase()})}),f.jsx("span",{className:`absolute bottom-0 right-0 w-3 h-3 rounded-full border-2 border-[#010401] ${l.isOnline?"bg-[#4caf50]":"bg-[#4caf50]/30"}`}),l.unreadCount>0&&f.jsx("span",{className:"absolute -top-1 -right-1 min-w-[18px] h-[18px] flex items-center justify-center px-1 bg-[#00f3ff] text-black text-[10px] font-bold rounded-full",children:l.unreadCount})]}),f.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[f.jsxs("div",{className:"flex items-center justify-between mb-1",children:[f.jsx("span",{className:"text-sm font-semibold text-[#00f3ff] truncate",children:l.displayName||`Peer ${l.peerId.substring(0,8)}`}),l.lastMessage&&f.jsx("span",{className:"text-[10px] text-[#4caf50]/60",children:Z$(l.lastMessage.timestamp)})]}),l.lastMessage&&f.jsxs("p",{className:"text-xs text-[#4caf50]/60 truncate",children:[l.lastMessage.isMe&&"You: ",l.lastMessage.content]})]})]},l.peerId))})}const EUe=({originalImage:n,onComplete:e,onCancel:t})=>{const i=$.useRef(null),r=$.useRef(null),s=$.useRef(null),o=$.useRef(null),a=$.useRef(null),[l,c]=$.useState("auto"),[u,h]=$.useState(null),[p,m]=$.useState(20),[y,b]=$.useState("foreground"),[w,v]=$.useState(!1),[T,S]=$.useState(!0),[M,P]=$.useState(!1),[R,O]=$.useState(1),[B,N]=$.useState(.3),[I,F]=$.useState(.1),[j,W]=$.useState(2),[U,H]=$.useState(!1),[q,J]=$.useState({width:0,height:0}),[G,ee]=$.useState(!1),[Q,ne]=$.useState(null),[fe,Ae]=$.useState([]),[Pe,Ce]=$.useState(-1),[de,Ne]=$.useState(!1),[et,me]=$.useState(null),[nt,Pt]=$.useState(null),zt=$.useRef(null);$.useEffect(()=>(zt.current=new Worker(new URL("/assets/ImageProcessor.worker-ddd96702.js",self.location),{type:"module"}),()=>{zt.current?.terminate()}),[]),$.useEffect(()=>{Dt()},[n]);const Dt=async()=>{const Ve=new Image;Ve.src=URL.createObjectURL(n),Ve.onload=()=>{let ue=Ve.width,Ie=Ve.height;if(ue>2048||Ie>2048){const ft=Math.min(2048/ue,2048/Ie);ue=Math.floor(ue*ft),Ie=Math.floor(Ie*ft)}if(J({width:ue,height:Ie}),i.current&&r.current&&s.current){[i,r,s].forEach(ge=>{ge.current&&(ge.current.width=ue,ge.current.height=Ie)});const ft=i.current.getContext("2d"),xe=r.current.getContext("2d"),pt=s.current.getContext("2d");if(ft&&xe&&pt){xe.drawImage(Ve,0,0,ue,Ie),ft.drawImage(Ve,0,0,ue,Ie),pt.drawImage(Ve,0,0,ue,Ie);const ge=xe.getImageData(0,0,ue,Ie);gt(ge);const Qe=new Uint8Array(ue*Ie).fill(255);ne(Qe),H(!0)}}URL.revokeObjectURL(Ve.src)}},gt=Ve=>{if(!zt.current)return;const ut=`bg_detect_${Date.now()}`,ue=Ie=>{(Ie.data.requestId===ut||Ie.data.success&&Array.isArray(Ie.data.result))&&(zt.current?.removeEventListener("message",ue),Ie.data.success&&Array.isArray(Ie.data.result)&&h(Ie.data.result))};zt.current.addEventListener("message",ue),zt.current.postMessage({type:"detectBackground",imageData:Ve,params:{requestId:ut}})},vt=$.useCallback((Ve,ut,ue={})=>new Promise((Ie,ft)=>{if(!zt.current){ft(new Error("Worker not initialized"));return}const xe=pt=>{zt.current?.removeEventListener("message",xe),pt.data.success?Ie(pt.data.result):ft(new Error(pt.data.error))};zt.current.addEventListener("message",xe),zt.current.postMessage({type:Ve,imageData:ut,params:ue})}),[]),Oe=async()=>{if(!(!r.current||!i.current)){v(!0);try{const Ve=r.current.getContext("2d");if(!Ve)return;const ut=Ve.getImageData(0,0,r.current.width,r.current.height);let ue=await vt("saliency",ut,{threshold:.4});ue=await vt("fillHoles",ut,{mask:ue,width:q.width,height:q.height}),j>0&&(ue=await vt("feather",ut,{mask:ue,width:q.width,height:q.height,radius:j})),ne(ue),pe(ue),Ye(ue)}catch(Ve){console.error("Auto detection failed:",Ve)}finally{v(!1)}}},xt=async()=>{if(!(!r.current||!u)){v(!0);try{const Ve=r.current.getContext("2d");if(!Ve)return;const ut=Ve.getImageData(0,0,r.current.width,r.current.height);let ue=await vt("color",ut,{targetColor:u,tolerance:B,softness:I});j>0&&(ue=await vt("feather",ut,{mask:ue,width:q.width,height:q.height,radius:j})),ne(new Uint8Array(ue)),pe(new Uint8Array(ue)),Ye(new Uint8Array(ue))}catch(Ve){console.error("Color-based removal failed:",Ve)}finally{v(!1)}}},pe=Ve=>{const ut=fe.slice(0,Pe+1);ut.push({mask:new Uint8Array(Ve),timestamp:Date.now()}),ut.length>50&&ut.shift(),Ae(ut),Ce(ut.length-1)},qe=()=>{if(Pe>0){const Ve=Pe-1;Ce(Ve);const ut=fe[Ve];if(ut){const ue=new Uint8Array(ut.mask);ne(ue),Ye(ue)}}},$e=()=>{if(Pe<fe.length-1){const Ve=Pe+1;Ce(Ve);const ut=fe[Ve];if(ut){const ue=new Uint8Array(ut.mask);ne(ue),Ye(ue)}}},Xe=()=>{const{width:Ve,height:ut}=q,ue=new Uint8Array(Ve*ut).fill(255);ne(ue),pe(ue),Ye(ue)},Ye=Ve=>{if(!r.current||!s.current)return;const ut=r.current.getContext("2d"),ue=s.current.getContext("2d");if(!ut||!ue)return;const{width:Ie,height:ft}=q,xe=ut.getImageData(0,0,Ie,ft);for(let pt=0;pt<Ve.length;pt++)xe.data[pt*4+3]=Ve[pt];ue.clearRect(0,0,Ie,ft),T&&Z(ue,Ie,ft),ue.putImageData(xe,0,0),oe(Ve)},oe=Ve=>{if(!o.current||!M)return;const ut=o.current.getContext("2d");if(!ut)return;const{width:ue,height:Ie}=q;o.current.width=ue,o.current.height=Ie;const ft=ut.createImageData(ue,Ie);for(let xe=0;xe<Ve.length;xe++){const pt=Ve[xe];ft.data[xe*4]=255,ft.data[xe*4+1]=0,ft.data[xe*4+2]=0,ft.data[xe*4+3]=pt>127?0:128}ut.putImageData(ft,0,0)},Z=(Ve,ut,ue)=>{Ve.fillStyle="#ffffff",Ve.fillRect(0,0,ut,ue),Ve.fillStyle="#cccccc";for(let ft=0;ft<ue;ft+=10)for(let xe=0;xe<ut;xe+=10)(Math.floor(xe/10)+Math.floor(ft/10))%2===0&&Ve.fillRect(xe,ft,10,10)},he=Ve=>{const ut=Ve.currentTarget,ue=ut.getBoundingClientRect(),Ie=Math.floor((Ve.clientX-ue.left)/ue.width*ut.width),ft=Math.floor((Ve.clientY-ue.top)/ue.height*ut.height);return{x:Ie,y:ft}},Ge=Ve=>{if(G){nn(Ve);return}if(l!=="manual")return;Ne(!0);const{x:ut,y:ue}=he(Ve);me({x:ut,y:ue}),Ct(ut,ue)},ct=Ve=>{const{x:ut,y:ue}=he(Ve);Pt({x:ut*R,y:ue*R}),!(!de||l!=="manual"||!et)&&(Ot(et.x,et.y,ut,ue),me({x:ut,y:ue}))},tt=()=>{Lt(),Pt(null)},Lt=()=>{de&&Q&&pe(Q),Ne(!1),me(null)},Ct=(Ve,ut)=>{if(!Q)return;const{width:ue,height:Ie}=q,ft=new Uint8Array(Q),xe=p*p;let pt;switch(y){case"foreground":pt=255;break;case"background":pt=0;break;case"erase":pt=128;break}for(let ge=-p;ge<=p;ge++)for(let Qe=-p;Qe<=p;Qe++){const ht=Ve+Qe,at=ut+ge;if(ht>=0&&ht<ue&&at>=0&&at<Ie&&Qe*Qe+ge*ge<=xe){const yt=at*ue+ht;y==="erase"?ft[yt]=255:ft[yt]=pt}}ne(ft),Ye(ft)},Ot=(Ve,ut,ue,Ie)=>{const ft=Math.abs(ue-Ve),xe=Math.abs(Ie-ut),pt=Math.max(ft,xe);for(let ge=0;ge<=pt;ge++){const Qe=pt===0?0:ge/pt,ht=Math.round(Ve+(ue-Ve)*Qe),at=Math.round(ut+(Ie-ut)*Qe);Ct(ht,at)}},nn=Ve=>{if(!r.current)return;const{x:ut,y:ue}=he(Ve),Ie=r.current.getContext("2d");if(!Ie)return;const ft=Ie.getImageData(ut,ue,1,1).data;h([ft[0],ft[1],ft[2]]),ee(!1)},Tt=async()=>{if(!(!Q||!r.current)){v(!0);try{const{width:Ve,height:ut}=q,ue=r.current.getContext("2d");if(!ue)return;const Ie=document.createElement("canvas");Ie.width=Ve,Ie.height=ut;const ft=Ie.getContext("2d");if(!ft)return;const xe=ue.getImageData(0,0,Ve,ut);for(let yt=0;yt<Q.length;yt++)xe.data[yt*4+3]=Q[yt];ft.putImageData(xe,0,0);const pt=await new Promise((yt,Gt)=>{Ie.toBlob(on=>{if(on){const mn=new Blob([JSON.stringify({operation:"background_removal",timestamp:Date.now(),method:l,legitimate:!0})],{type:"application/json"}),Cn=new Blob([on,mn],{type:"image/png"});yt(Cn)}else Gt(new Error("Failed to create image blob"))},"image/png")}),ge=document.createElement("canvas");ge.width=Ve,ge.height=ut;const Qe=ge.getContext("2d");if(!Qe)return;const ht=Qe.createImageData(Ve,ut);for(let yt=0;yt<Q.length;yt++)ht.data[yt*4]=Q[yt],ht.data[yt*4+1]=Q[yt],ht.data[yt*4+2]=Q[yt],ht.data[yt*4+3]=255;Qe.putImageData(ht,0,0);const at=await new Promise((yt,Gt)=>{ge.toBlob(on=>{on?yt(on):Gt(new Error("Failed to create mask blob"))},"image/png")});e({imageBlob:pt,maskBlob:at})}catch(Ve){console.error("Failed to complete:",Ve)}finally{v(!1)}}};return f.jsx("div",{className:"fixed inset-0 z-[300] flex items-center justify-center bg-black/90 backdrop-blur-sm",children:f.jsxs("div",{className:"w-full max-w-6xl h-[90vh] bg-[#010401] border border-[#00f3ff]/30 flex flex-col",children:[f.jsxs("div",{className:"flex items-center justify-between px-6 py-3 border-b border-[#00f3ff]/20",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(x6,{size:16,className:"text-[#00f3ff]"}),f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.3em] text-[#00f3ff]",children:"BACKGROUND_REMOVAL_EDITOR"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("button",{onClick:()=>S(!T),className:`p-2 rounded transition-colors ${T?"bg-[#00f3ff]/20 text-[#00f3ff]":"text-[#00f3ff]/40 hover:text-[#00f3ff]"}`,title:"Toggle transparency preview",children:T?f.jsx(QP,{size:14}):f.jsx(vae,{size:14})}),f.jsx("button",{onClick:()=>P(!M),className:`p-2 rounded transition-colors ${M?"bg-[#4caf50]/20 text-[#4caf50]":"text-[#00f3ff]/40 hover:text-[#00f3ff]"}`,title:"Toggle mask overlay",children:f.jsx(Uae,{size:14})}),f.jsx("button",{onClick:t,className:"p-2 text-[#00f3ff]/40 hover:text-[#00f3ff] transition-colors",children:f.jsx(Ui,{size:16})})]})]}),f.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[f.jsx("div",{className:"w-64 border-r border-[#00f3ff]/20 p-4 overflow-y-auto",children:f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[9px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-2 block",children:"Detection Method"}),f.jsx("div",{className:"space-y-2",children:["auto","color","manual"].map(Ve=>f.jsxs("button",{onClick:()=>c(Ve),className:`w-full py-2 px-3 text-[9px] font-bold uppercase tracking-wider text-left transition-all border ${l===Ve?"bg-[#00f3ff]/20 border-[#00f3ff]/60 text-[#00f3ff]":"bg-black/30 border-[#00f3ff]/20 text-[#00f3ff]/60 hover:border-[#00f3ff]/40"}`,children:[Ve==="auto"&&"Auto Detect",Ve==="color"&&"Color Range",Ve==="manual"&&"Manual Brush"]},Ve))})]}),l==="auto"&&f.jsxs("button",{onClick:Oe,disabled:w||!U,className:"w-full py-3 bg-[#00f3ff]/20 border border-[#00f3ff]/40 text-[#00f3ff] text-[9px] font-bold uppercase tracking-wider hover:bg-[#00f3ff]/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:[w?f.jsx(xr,{size:12,className:"animate-spin"}):f.jsx(x6,{size:12}),"Detect Subject"]}),l==="color"&&f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-1 block",children:"Target Color"}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("div",{className:"w-8 h-8 border border-[#00f3ff]/40 cursor-pointer",style:{backgroundColor:u?`rgb(${u[0]}, ${u[1]}, ${u[2]})`:"#ffffff"},onClick:()=>ee(!0)}),f.jsx("button",{onClick:()=>ee(!G),className:`p-2 border transition-colors ${G?"bg-[#4caf50]/20 border-[#4caf50]/60 text-[#4caf50]":"border-[#00f3ff]/20 text-[#00f3ff]/60 hover:text-[#00f3ff]"}`,children:f.jsx(Dae,{size:12})})]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-1 block",children:["Tolerance: ",(B*100).toFixed(0),"%"]}),f.jsx("input",{type:"range",min:"0",max:"100",value:B*100,onChange:Ve=>N(Number(Ve.target.value)/100),className:"w-full accent-[#00f3ff]"})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-1 block",children:["Edge Softness: ",(I*100).toFixed(0),"%"]}),f.jsx("input",{type:"range",min:"0",max:"50",value:I*100,onChange:Ve=>F(Number(Ve.target.value)/100),className:"w-full accent-[#00f3ff]"})]}),f.jsxs("button",{onClick:xt,disabled:w||!u||!U,className:"w-full py-3 bg-[#00f3ff]/20 border border-[#00f3ff]/40 text-[#00f3ff] text-[9px] font-bold uppercase tracking-wider hover:bg-[#00f3ff]/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:[w?f.jsx(xr,{size:12,className:"animate-spin"}):f.jsx(yae,{size:12}),"Remove Color"]})]}),l==="manual"&&f.jsxs("div",{className:"space-y-3",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-1 block",children:"Brush Mode"}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>b("foreground"),className:`flex-1 py-2 px-2 text-[8px] font-bold uppercase border transition-colors ${y==="foreground"?"bg-[#4caf50]/20 border-[#4caf50]/60 text-[#4caf50]":"border-[#00f3ff]/20 text-[#00f3ff]/60"}`,title:"Keep area (foreground)",children:f.jsx(kae,{size:12,className:"mx-auto"})}),f.jsx("button",{onClick:()=>b("background"),className:`flex-1 py-2 px-2 text-[8px] font-bold uppercase border transition-colors ${y==="background"?"bg-red-500/20 border-red-500/60 text-red-400":"border-[#00f3ff]/20 text-[#00f3ff]/60"}`,title:"Remove area (background)",children:f.jsx(xae,{size:12,className:"mx-auto"})})]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-1 block",children:["Brush Size: ",p,"px"]}),f.jsx("input",{type:"range",min:"5",max:"100",value:p,onChange:Ve=>m(Number(Ve.target.value)),className:"w-full accent-[#00f3ff]"})]})]}),f.jsxs("div",{children:[f.jsxs("label",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60 mb-1 block",children:["Feather Radius: ",j,"px"]}),f.jsx("input",{type:"range",min:"0",max:"10",value:j,onChange:Ve=>W(Number(Ve.target.value)),className:"w-full accent-[#00f3ff]"})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:qe,disabled:Pe<=0,className:"flex-1 py-2 border border-[#00f3ff]/20 text-[#00f3ff]/60 hover:text-[#00f3ff] disabled:opacity-40 disabled:cursor-not-allowed transition-colors",title:"Undo",children:f.jsx(Vae,{size:12,className:"mx-auto"})}),f.jsx("button",{onClick:$e,disabled:Pe>=fe.length-1,className:"flex-1 py-2 border border-[#00f3ff]/20 text-[#00f3ff]/60 hover:text-[#00f3ff] disabled:opacity-40 disabled:cursor-not-allowed transition-colors",title:"Redo",children:f.jsx(Bae,{size:12,className:"mx-auto"})}),f.jsx("button",{onClick:Xe,className:"flex-1 py-2 border border-[#00f3ff]/20 text-[#00f3ff]/60 hover:text-[#00f3ff] transition-colors",title:"Reset",children:f.jsx(l7,{size:12,className:"mx-auto"})})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>O(Math.max(.25,R-.25)),className:"flex-1 py-2 border border-[#00f3ff]/20 text-[#00f3ff]/60 hover:text-[#00f3ff] transition-colors",children:f.jsx(Zae,{size:12,className:"mx-auto"})}),f.jsxs("span",{className:"flex-1 py-2 text-center text-[9px] text-[#00f3ff]/60",children:[(R*100).toFixed(0),"%"]}),f.jsx("button",{onClick:()=>O(Math.min(4,R+.25)),className:"flex-1 py-2 border border-[#00f3ff]/20 text-[#00f3ff]/60 hover:text-[#00f3ff] transition-colors",children:f.jsx(qae,{size:12,className:"mx-auto"})})]})]})}),f.jsxs("div",{ref:a,className:"flex-1 relative overflow-auto bg-black/50 p-4",style:{cursor:G||l==="manual"?"crosshair":"default"},children:[f.jsxs("div",{className:"relative mx-auto",style:{width:q.width*R,height:q.height*R},children:[f.jsx("canvas",{ref:r,className:"absolute top-0 left-0 hidden"}),f.jsx("canvas",{ref:s,className:"absolute top-0 left-0",style:{width:q.width*R,height:q.height*R},onMouseDown:Ge,onMouseMove:ct,onMouseUp:Lt,onMouseLeave:tt}),l==="manual"&&nt&&f.jsx("div",{className:"absolute pointer-events-none border-2 rounded-full",style:{left:nt.x-p*R/2,top:nt.y-p*R/2,width:p*R,height:p*R,borderColor:y==="foreground"?"#4caf50":y==="background"?"#ff4444":"#00f3ff",backgroundColor:y==="foreground"?"rgba(76, 175, 80, 0.2)":y==="background"?"rgba(255, 68, 68, 0.2)":"rgba(0, 243, 255, 0.2)"}}),M&&f.jsx("canvas",{ref:o,className:"absolute top-0 left-0 pointer-events-none",style:{width:q.width*R,height:q.height*R}}),f.jsx("canvas",{ref:i,className:"hidden"})]}),!U&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:f.jsx(xr,{size:32,className:"text-[#00f3ff] animate-spin"})})]})]}),f.jsxs("div",{className:"flex gap-3 px-6 py-4 border-t border-[#00f3ff]/20",children:[f.jsx("button",{onClick:t,className:"flex-1 py-3 bg-black/50 border border-[#4caf50]/20 text-[#4caf50]/60 text-[9px] font-bold uppercase tracking-wider hover:bg-black/70 transition-all",children:"Cancel"}),f.jsx("button",{onClick:Tt,disabled:!Q||w,className:"flex-1 py-3 bg-[#00f3ff]/20 border border-[#00f3ff]/40 text-[#00f3ff] text-[9px] font-bold uppercase tracking-wider hover:bg-[#00f3ff]/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:w?f.jsxs(f.Fragment,{children:[f.jsx(xr,{size:12,className:"animate-spin"}),"PROCESSING..."]}):f.jsxs(f.Fragment,{children:[f.jsx(f2,{size:12}),"APPLY_CHANGES"]})})]})]})})},K5=typeof window<"u"&&typeof document<"u";class TUe{static async analyzeProcessedImage(e,t,i=null){const r={hadBackgroundRemoved:!1,removalMethod:null,suspiciousPatterns:[],isLegitimateOperation:!1,metadata:{transparencyPercentage:0,edgeComplexity:0,colorDistribution:{dominant:[0,0,0],uniformity:0}},riskScore:0,timestamp:Date.now()};try{r.isLegitimateOperation=await this.checkLegitimateOperation(t);const s=await this.checkImageTransparency(t);if(r.hadBackgroundRemoved=s,s){const o=await this.analyzeTransparency(t);r.metadata.transparencyPercentage=o.percentage,r.metadata.edgeComplexity=o.edgeComplexity,r.removalMethod=this.classifyRemovalMethod(o),o.percentage>.6&&r.suspiciousPatterns.push("high_transparency_ratio"),o.edgeComplexity<.1&&r.suspiciousPatterns.push("unnaturally_smooth_edges"),o.edgeComplexity>.9&&r.suspiciousPatterns.push("professional_cutout_quality"),o.uniformity>.95&&r.suspiciousPatterns.push("studio_quality_removal")}e&&(r.metadata.originalSize=e.size,r.metadata.processedSize=t.size,t.size/e.size>2&&r.suspiciousPatterns.push("unusual_size_increase")),r.riskScore=this.calculateRiskScore(r),r.isLegitimateOperation&&(r.riskScore*=.1)}catch(s){console.error("[ImageAnalyzer] Analysis failed:",s)}return r}static async checkLegitimateOperation(e){if(!K5)return!1;try{const t=await e.text();return t.includes('"operation": "background_removal"')&&t.includes('"legitimate": true')}catch{return!1}}static async checkImageTransparency(e){return K5?new Promise(t=>{const i=new Image;i.onload=()=>{const r=document.createElement("canvas");r.width=Math.min(i.width,512),r.height=Math.min(i.height,512);const s=r.getContext("2d");if(s){s.drawImage(i,0,0,r.width,r.height);const o=s.getImageData(0,0,r.width,r.height);let a=!1;for(let l=3;l<o.data.length;l+=4)if(o.data[l]!==void 0&&o.data[l]<255){a=!0;break}t(a)}else t(!1);URL.revokeObjectURL(i.src)},i.onerror=()=>{t(!1)},i.src=URL.createObjectURL(e)}):(console.warn("[ImageAnalyzer] checkImageTransparency called in non-browser context"),!1)}static async analyzeTransparency(e){return K5?new Promise(t=>{const i=new Image;i.onload=()=>{const r=document.createElement("canvas"),o=Math.min(1,512/Math.max(i.width,i.height));r.width=Math.floor(i.width*o),r.height=Math.floor(i.height*o);const a=r.getContext("2d");if(!a){t({percentage:0,edgeComplexity:0,uniformity:0,distribution:"scattered"});return}a.drawImage(i,0,0,r.width,r.height);const l=a.getImageData(0,0,r.width,r.height),{width:c,height:u,data:h}=l;let p=0,m=0,y=0;const b=Math.floor(c*.2),w=Math.floor(u*.2);for(let O=0;O<u;O++)for(let B=0;B<c;B++){const N=(O*c+B)*4,I=h[N+3];I!==void 0&&I<255&&(p++,B>b&&B<c-b&&O>w&&O<u-w&&y++,B>0&&O>0&&B<c-1&&O<u-1&&[h[((O-1)*c+B)*4+3],h[((O+1)*c+B)*4+3],h[(O*c+(B-1))*4+3],h[(O*c+(B+1))*4+3]].some(U=>U===255)&&m++)}const v=c*u,T=p/v,S=Math.sqrt(p)*4,M=Math.min(1,m/(S+1)),P=p>0?1-Math.abs(.5-y/p)*2:0;let R="scattered";if(p>0){const O=y/p;O<.2?R="edges":O>.8&&(R="center")}URL.revokeObjectURL(i.src),t({percentage:T,edgeComplexity:M,uniformity:P,distribution:R})},i.onerror=()=>{t({percentage:0,edgeComplexity:0,uniformity:0,distribution:"scattered"})},i.src=URL.createObjectURL(e)}):{percentage:0,edgeComplexity:0,uniformity:0,distribution:"scattered"}}static classifyRemovalMethod(e){return e.uniformity>.9&&e.edgeComplexity<.3?"color":e.edgeComplexity>.6&&e.distribution==="edges"?"saliency":e.edgeComplexity>.4&&e.edgeComplexity<.7?"manual":"unknown"}static calculateRiskScore(e){let t=0;const i={high_transparency_ratio:.1,unnaturally_smooth_edges:.15,professional_cutout_quality:.2,studio_quality_removal:.25,unusual_size_increase:.1};for(const r of e.suspiciousPatterns)t+=i[r]||.05;return e.metadata.edgeComplexity>.85&&(t+=.15),e.metadata.transparencyPercentage>.8&&(t+=.1),Math.min(1,t)}static async extractImageMetadata(e){return K5?new Promise(t=>{const i=new Image;i.onload=()=>{const r=document.createElement("canvas");r.width=Math.min(i.width,256),r.height=Math.min(i.height,256);const s=r.getContext("2d");let o=!1,a="medium";if(s){s.drawImage(i,0,0,r.width,r.height);const c=s.getImageData(0,0,r.width,r.height);for(let u=3;u<c.data.length;u+=4)if(c.data[u]!==void 0&&c.data[u]<255){o=!0;break}}const l=i.width*i.height;l<5e5?a="low":l<2e6?a="medium":l<8e6?a="high":a="professional",URL.revokeObjectURL(i.src),t({width:i.width,height:i.height,hasAlpha:o,colorDepth:24,estimatedQuality:a})},i.onerror=()=>{t({width:0,height:0,hasAlpha:!1,colorDepth:24,estimatedQuality:"low"})},i.src=URL.createObjectURL(e)}):{width:0,height:0,hasAlpha:!1,colorDepth:24,estimatedQuality:"low"}}static generateAuditLog(e,t){const i=e.riskScore<.3?"low":e.riskScore<.6?"medium":"high";return{id:`img_audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),operatorId:t,action:"background_removal",details:{hadBackgroundRemoved:e.hadBackgroundRemoved,removalMethod:e.removalMethod,suspiciousPatterns:e.suspiciousPatterns,transparencyPercentage:e.metadata.transparencyPercentage,edgeComplexity:e.metadata.edgeComplexity,riskScore:e.riskScore},riskLevel:i}}}const AUe="image/*,video/*",CUe=".md,.js,.ts,.jsx,.tsx,.json,.html,.css,.yaml,.yml,.cpp,.c,.h,.circom,.asm,.py,.rs,.go,.pdf,.txt",q5=50*1024*1024,MUe=({isOpen:n,onClose:e,onUpload:t})=>{const[i,r]=$.useState([]),[s,o]=$.useState(!1),[a,l]=$.useState(!1),[c,u]=$.useState(!1),[h,p]=$.useState("media"),[m,y]=$.useState(null),[b,w]=$.useState(null),v=$.useRef(null),T=()=>`file_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,S=$.useCallback(j=>{const W=Array.from(j.target.files||[]);if(W.length===0)return;y(null);const U=W.filter(J=>J.size>q5);U.length>0&&y(`${U.length} file(s) exceed 50MB limit`);const q=W.filter(J=>J.size<=q5).map(J=>{let G=null;return(J.type.startsWith("image/")||J.type.startsWith("video/"))&&(G=URL.createObjectURL(J)),{file:J,preview:G,id:T()}});r(J=>[...J,...q]),j.target&&(j.target.value="")},[]),M=$.useCallback(j=>{j.preventDefault();const W=Array.from(j.dataTransfer.files||[]);if(W.length===0)return;y(null);const U=W.filter(J=>J.size>q5);U.length>0&&y(`${U.length} file(s) exceed 50MB limit`);const q=W.filter(J=>J.size<=q5).map(J=>{let G=null;return(J.type.startsWith("image/")||J.type.startsWith("video/"))&&(G=URL.createObjectURL(J)),{file:J,preview:G,id:T()}});r(J=>[...J,...q])},[]),P=$.useCallback(j=>{r(W=>{const U=W.find(H=>H.id===j);return U?.preview&&URL.revokeObjectURL(U.preview),W.filter(H=>H.id!==j)})},[]),R=$.useCallback(async()=>{i.length!==0&&(u(!0),await new Promise(j=>setTimeout(j,300)),t(i.map(j=>j.file),s,a),i.forEach(j=>{j.preview&&URL.revokeObjectURL(j.preview)}),r([]),o(!1),l(!1),y(null),u(!1),e())},[i,s,a,t,e]),O=$.useCallback(()=>{i.forEach(j=>{j.preview&&URL.revokeObjectURL(j.preview)}),r([]),o(!1),e()},[i,e]),B=i.some(j=>j.file.type.startsWith("image/")||j.file.type.startsWith("video/")),N=i.some(j=>j.file.type.startsWith("image/")),I=$.useCallback(async({imageBlob:j,maskBlob:W})=>{if(!b)return;try{const q=await TUe.analyzeProcessedImage(b.file,j,W);console.log("[BackgroundRemoval] Image analysis:",{hadBackgroundRemoved:q.hadBackgroundRemoved,removalMethod:q.removalMethod,riskScore:q.riskScore,suspiciousPatterns:q.suspiciousPatterns}),q.riskScore>.7&&console.warn("[BackgroundRemoval] High risk score detected:",q.riskScore)}catch(q){console.error("[BackgroundRemoval] Analysis failed:",q)}const U=new window.File([j],b.file.name.replace(/\.[^.]+$/,"_processed.png"),{type:"image/png"}),H=URL.createObjectURL(U);r(q=>q.map(J=>J.id===b.id?(J.preview&&URL.revokeObjectURL(J.preview),{...J,file:U,preview:H}):J)),w(null)},[b]),F=j=>j.type.startsWith("image/")?f.jsx(J3,{size:14,className:"text-[#00f3ff]"}):j.type.startsWith("video/")?f.jsx(JP,{size:14,className:"text-[#00f3ff]"}):j.name.match(/\.(js|ts|jsx|tsx|cpp|c|py|rs|go|circom|asm)$/i)?f.jsx(bae,{size:14,className:"text-[#4caf50]"}):f.jsx(_K,{size:14,className:"text-[#00f3ff]/60"});return n?f.jsxs("div",{className:"fixed inset-0 z-[200] flex items-center justify-center bg-black/80 backdrop-blur-sm animate-in fade-in duration-200",children:[f.jsxs("div",{className:"w-full max-w-lg bg-[#010401] border border-[#00f3ff]/30 shadow-2xl shadow-[#00f3ff]/10 max-h-[90vh] flex flex-col",children:[f.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[#00f3ff]/20",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(EU,{size:16,className:"text-[#00f3ff]"}),f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-[0.3em] text-[#00f3ff]",children:"UPLOAD_MEDIA"})]}),f.jsx("button",{onClick:O,className:"text-[#00f3ff]/40 hover:text-[#00f3ff] transition-colors",children:f.jsx(Ui,{size:16})})]}),f.jsxs("div",{className:"flex border-b border-[#00f3ff]/20",children:[f.jsx("button",{onClick:()=>p("media"),className:`flex-1 py-2 text-[9px] font-bold uppercase tracking-wider transition-all ${h==="media"?"bg-[#00f3ff]/10 text-[#00f3ff] border-b-2 border-[#00f3ff]":"text-[#00f3ff]/40 hover:text-[#00f3ff]/60"}`,children:"Images / Videos"}),f.jsx("button",{onClick:()=>p("document"),className:`flex-1 py-2 text-[9px] font-bold uppercase tracking-wider transition-all ${h==="document"?"bg-[#4caf50]/10 text-[#4caf50] border-b-2 border-[#4caf50]":"text-[#4caf50]/40 hover:text-[#4caf50]/60"}`,children:"Documents / Code"})]}),f.jsxs("div",{className:"p-6 flex-1 overflow-y-auto",children:[f.jsx("input",{ref:v,type:"file",multiple:!0,onChange:S,accept:h==="media"?AUe:CUe,className:"hidden"}),i.length===0?f.jsxs("div",{onClick:()=>v.current?.click(),onDrop:M,onDragOver:j=>j.preventDefault(),className:"border-2 border-dashed border-[#00f3ff]/30 rounded-lg p-12 flex flex-col items-center justify-center gap-4 cursor-pointer hover:border-[#00f3ff]/60 hover:bg-[#00f3ff]/5 transition-all",children:[f.jsx("div",{className:"w-16 h-16 rounded-full bg-[#00f3ff]/10 flex items-center justify-center",children:f.jsx(EU,{size:24,className:"text-[#00f3ff]"})}),f.jsxs("div",{className:"text-center",children:[f.jsx("div",{className:"text-[11px] font-bold text-[#00f3ff] uppercase tracking-wider",children:"Drop files here or click to browse"}),f.jsx("div",{className:"text-[9px] text-[#00f3ff]/40 mt-2",children:h==="media"?"Multiple images and videos supported":"Code files: .md, .js, .ts, .cpp, .circom, .json, .yaml"})]})]}):f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-3 max-h-48 overflow-y-auto",children:[i.map(j=>f.jsxs("div",{className:"relative group bg-black/50 border border-[#00f3ff]/20 rounded overflow-hidden",children:[j.preview?j.file.type.startsWith("video/")?f.jsx("video",{src:j.preview,className:"w-full h-20 object-cover",muted:!0}):f.jsx("img",{src:j.preview,alt:j.file.name,className:"w-full h-20 object-cover"}):f.jsx("div",{className:"w-full h-20 flex items-center justify-center bg-black/70",children:F(j.file)}),f.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-black/80 px-2 py-1",children:[f.jsxs("div",{className:"text-[8px] text-[#00f3ff] truncate flex items-center gap-1",children:[F(j.file),j.file.name]}),f.jsxs("div",{className:"text-[7px] text-[#00f3ff]/40",children:[(j.file.size/1024).toFixed(1)," KB"]})]}),f.jsx("button",{onClick:()=>P(j.id),className:"absolute top-1 right-1 w-5 h-5 bg-red-500/80 rounded flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:f.jsx(p_,{size:10,className:"text-white"})}),j.file.type.startsWith("image/")&&f.jsx("button",{onClick:()=>w(j),className:"absolute top-1 left-1 w-5 h-5 bg-[#00f3ff]/80 rounded flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",title:"Remove background",children:f.jsx(x6,{size:10,className:"text-black"})})]},j.id)),f.jsx("button",{onClick:()=>v.current?.click(),className:"h-20 border-2 border-dashed border-[#00f3ff]/20 rounded flex items-center justify-center hover:border-[#00f3ff]/40 hover:bg-[#00f3ff]/5 transition-all",children:f.jsx(eb,{size:20,className:"text-[#00f3ff]/40"})})]}),f.jsxs("div",{className:"flex items-center gap-2 p-2 bg-black/30 rounded text-[9px] text-[#00f3ff]/60",children:[f.jsxs("span",{children:[i.length," file",i.length>1?"s":""," selected"]}),f.jsx("span",{className:"text-[#00f3ff]/30",children:"|"}),f.jsxs("span",{children:[(i.reduce((j,W)=>j+W.file.size,0)/1024/1024).toFixed(2)," MB total"]})]}),m&&f.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/30 rounded text-red-400 text-[9px]",role:"alert",children:m}),N&&f.jsx("div",{className:"mb-3",children:f.jsxs("button",{onClick:()=>{const j=i.find(W=>W.file.type.startsWith("image/"));j&&w(j)},className:"w-full flex items-center gap-4 p-3 border rounded transition-all bg-black/30 border-[#00f3ff]/20 text-[#00f3ff]/60 hover:border-[#00f3ff]/40 hover:bg-[#00f3ff]/5",children:[f.jsx("div",{className:"w-8 h-8 rounded flex items-center justify-center bg-black/50",children:f.jsx(x6,{size:16,className:"text-[#00f3ff]/60"})}),f.jsxs("div",{className:"flex-1 text-left",children:[f.jsx("div",{className:"text-[9px] font-bold uppercase tracking-wider",children:"REMOVE BACKGROUND"}),f.jsx("div",{className:"text-[7px] opacity-60",children:"Client-side processing - no AI/ML required"})]})]})}),B&&f.jsxs("div",{className:"space-y-3",children:[f.jsxs("button",{onClick:()=>l(!a),className:`w-full flex items-center gap-4 p-3 border rounded transition-all ${a?"bg-[#4caf50]/10 border-[#4caf50]/60 text-[#4caf50]":"bg-black/30 border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/30"}`,"aria-pressed":a,"aria-label":"Send in HD quality",children:[f.jsx("div",{className:`w-8 h-8 rounded flex items-center justify-center font-bold text-[10px] ${a?"bg-[#4caf50]/20 text-[#4caf50]":"bg-black/50 text-[#4caf50]/40"}`,children:"HD"}),f.jsxs("div",{className:"flex-1 text-left",children:[f.jsx("div",{className:"text-[9px] font-bold uppercase tracking-wider",children:"SEND IN HD QUALITY"}),f.jsx("div",{className:"text-[7px] opacity-60",children:"Preserve original quality (larger file size)"})]}),a&&f.jsx(us,{size:16,className:"text-[#4caf50]"})]}),f.jsxs("button",{onClick:()=>o(!s),className:`w-full flex items-center gap-4 p-3 border rounded transition-all ${s?"bg-[#00f3ff]/10 border-[#00f3ff]/60 text-[#00f3ff]":"bg-black/30 border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#00f3ff]/30"}`,"aria-pressed":s,"aria-label":"Convert to 3D tensor object",children:[f.jsx("div",{className:`w-8 h-8 rounded flex items-center justify-center ${s?"bg-[#00f3ff]/20":"bg-black/50"}`,children:f.jsx(gK,{size:16,className:s?"text-[#00f3ff]":"text-[#4caf50]/40"})}),f.jsxs("div",{className:"flex-1 text-left",children:[f.jsx("div",{className:"text-[9px] font-bold uppercase tracking-wider",children:"CONVERT TO 3D TENSOR OBJECT"}),f.jsx("div",{className:"text-[7px] opacity-60",children:"Render as interactive 3D via Flower of Life PHI"})]}),s&&f.jsx(u7,{size:16,className:"text-[#00f3ff] animate-pulse"})]})]})]})]}),f.jsxs("div",{className:"flex gap-3 px-6 py-4 border-t border-[#00f3ff]/20",children:[f.jsx("button",{onClick:O,className:"flex-1 py-3 bg-black/50 border border-[#4caf50]/20 text-[#4caf50]/60 text-[9px] font-bold uppercase tracking-wider hover:bg-black/70 transition-all",children:"Cancel"}),f.jsx("button",{onClick:R,disabled:i.length===0||c,className:"flex-1 py-3 bg-[#00f3ff]/20 border border-[#00f3ff]/40 text-[#00f3ff] text-[9px] font-bold uppercase tracking-wider hover:bg-[#00f3ff]/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:c?f.jsxs(f.Fragment,{children:[f.jsx(xr,{size:12,className:"animate-spin"}),"PROCESSING..."]}):f.jsxs(f.Fragment,{children:[f.jsx(us,{size:12}),s?"SEND_3D_OBJECT":"SEND_MEDIA"]})})]})]}),b&&f.jsx(EUe,{originalImage:b.file,onComplete:I,onCancel:()=>w(null)})]}):null},RUe=({onSend:n,onCancel:e,isOpen:t})=>{const[i,r]=$.useState(!1),[s,o]=$.useState(!1),[a,l]=$.useState(0),[c,u]=$.useState(null),[h,p]=$.useState(null),[m,y]=$.useState(!1),[b,w]=$.useState([]),[v,T]=$.useState(0),S=$.useRef(null),M=$.useRef(null),P=$.useRef(null),R=$.useRef(null),O=$.useRef([]),B=$.useRef(null),N=$.useRef(null),I=$.useRef(null),F=$.useRef(null),j=Q=>{const ne=Math.floor(Q/60),fe=Math.floor(Q%60);return`${ne}:${fe.toString().padStart(2,"0")}`},W=$.useCallback(()=>{const Q=F.current,ne=P.current;if(!Q||!ne||!i)return;const fe=Q.getContext("2d");if(!fe)return;const Ae=ne.frequencyBinCount,Pe=new Uint8Array(Ae);ne.getByteTimeDomainData(Pe),fe.fillStyle="rgba(0, 0, 0, 0.1)",fe.fillRect(0,0,Q.width,Q.height),fe.lineWidth=2,fe.strokeStyle="#00f3ff",fe.beginPath();const Ce=Q.width/Ae;let de=0;for(let et=0;et<Ae;et++){const nt=Pe[et]/128*Q.height/2;et===0?fe.moveTo(de,nt):fe.lineTo(de,nt),de+=Ce}fe.lineTo(Q.width,Q.height/2),fe.stroke();const Ne=Pe.reduce((et,me)=>et+Math.abs(me-128),0)/Ae;w(et=>[...et.slice(-50),Ne/128]),I.current=requestAnimationFrame(W)},[i]),U=$.useCallback(async()=>{try{const Q=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3}});R.current=Q,M.current=new AudioContext;const ne=M.current.createMediaStreamSource(Q);P.current=M.current.createAnalyser(),P.current.fftSize=256,ne.connect(P.current);const fe=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/mp4")?"audio/mp4":"audio/webm";S.current=new MediaRecorder(Q,{mimeType:fe}),O.current=[],S.current.ondataavailable=Ae=>{Ae.data.size>0&&O.current.push(Ae.data)},S.current.onstop=()=>{const Ae=new Blob(O.current,{type:fe});u(Ae);const Pe=URL.createObjectURL(Ae);p(Pe)},S.current.start(100),r(!0),l(0),B.current=window.setInterval(()=>{l(Ae=>Ae+.1)},100),I.current=requestAnimationFrame(W)}catch(Q){console.error("Failed to start recording:",Q)}},[W]),H=$.useCallback(()=>{S.current&&i&&(S.current.stop(),r(!1),o(!1),B.current&&(clearInterval(B.current),B.current=null),I.current&&(cancelAnimationFrame(I.current),I.current=null),R.current&&R.current.getTracks().forEach(Q=>Q.stop()))},[i]),q=$.useCallback(()=>{!N.current||!h||(m?(N.current.pause(),y(!1)):(N.current.play(),y(!0)))},[m,h]),J=$.useCallback(()=>{c&&(n(c,a,b),G())},[c,a,b,n]),G=$.useCallback(()=>{h&&URL.revokeObjectURL(h),u(null),p(null),l(0),w([]),T(0),y(!1),O.current=[]},[h]),ee=$.useCallback(()=>{i&&H(),G(),e()},[i,H,G,e]);return $.useEffect(()=>(h&&!N.current&&(N.current=new Audio(h),N.current.onended=()=>{y(!1),T(0)},N.current.ontimeupdate=()=>{N.current&&T(N.current.currentTime/N.current.duration*100)}),()=>{N.current&&(N.current.pause(),N.current=null)}),[h]),$.useEffect(()=>(t||(B.current&&(clearInterval(B.current),B.current=null),I.current&&(cancelAnimationFrame(I.current),I.current=null),R.current&&(R.current.getTracks().forEach(Q=>Q.stop()),R.current=null),M.current&&(M.current.close().catch(()=>{}),M.current=null),S.current&&(S.current=null),h&&URL.revokeObjectURL(h),u(null),p(null),l(0),w([]),r(!1),o(!1),y(!1),O.current=[]),()=>{B.current&&clearInterval(B.current),I.current&&cancelAnimationFrame(I.current),R.current&&R.current.getTracks().forEach(Q=>Q.stop()),h&&URL.revokeObjectURL(h)}),[t,h]),t?f.jsx("div",{className:"fixed inset-0 z-[400] flex items-center justify-center bg-black/90 backdrop-blur-md",role:"dialog","aria-label":"Voice message recorder",children:f.jsxs("div",{className:"w-full max-w-md mx-4 bg-gradient-to-b from-[#0a1a0a] to-[#0d0d0d] border border-[#00f3ff]/40 rounded-xl p-6 space-y-5 shadow-2xl shadow-[#00f3ff]/10",children:[f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"text-[11px] uppercase tracking-[0.3em] text-[#00f3ff] font-bold",children:i?"RECORDING_VOICE":h?"REVIEW_MESSAGE":"VOICE_MESSAGE"}),f.jsx("button",{onClick:ee,className:"p-2 text-[#4caf50] hover:text-red-500 transition-colors rounded-full hover:bg-red-500/10","aria-label":"Cancel recording",children:f.jsx(p_,{size:18})})]}),f.jsx("div",{className:"relative h-28 bg-black/60 border border-[#00f3ff]/30 rounded-lg overflow-hidden",children:i?f.jsxs(f.Fragment,{children:[f.jsx("canvas",{ref:F,width:400,height:112,className:"w-full h-full","aria-label":"Audio waveform visualization"}),f.jsxs("div",{className:"absolute bottom-2 left-2 flex items-center gap-2",children:[f.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),f.jsx("span",{className:"text-[10px] text-red-400 uppercase font-bold",children:"LIVE"})]})]}):h?f.jsxs("div",{className:"w-full h-full flex flex-col justify-center p-4",children:[f.jsx("div",{className:"flex items-end justify-center gap-[3px] h-16 mb-2",children:b.length>0?b.slice(0,40).map((Q,ne)=>{const fe=ne/40*100<=v;return f.jsx("div",{className:`w-1.5 rounded-full transition-all duration-75 ${fe?"bg-[#00f3ff]":"bg-[#4caf50]/40"}`,style:{height:`${Math.max(8,Q*56)}px`,boxShadow:fe?"0 0 6px #00f3ff":"none"}},ne)}):Array.from({length:40},(Q,ne)=>f.jsx("div",{className:"w-1.5 bg-[#4caf50]/30 rounded-full",style:{height:`${16+Math.random()*40}px`}},ne))}),f.jsx("div",{className:"h-1.5 bg-[#4caf50]/20 rounded-full overflow-hidden",children:f.jsx("div",{className:"h-full bg-gradient-to-r from-[#00f3ff] to-[#4caf50] transition-all duration-100 rounded-full",style:{width:`${v}%`}})})]}):f.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-[#4caf50]/60",children:[f.jsx(p2,{size:32,className:"mb-2"}),f.jsx("span",{className:"text-[11px] uppercase tracking-widest",children:"Tap microphone to record"})]})}),f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsx("span",{className:"font-mono text-lg text-[#00f3ff]","aria-live":"polite",children:j(a)}),f.jsx("div",{className:"flex items-center gap-4",children:h?f.jsxs(f.Fragment,{children:[f.jsx("button",{onClick:q,className:"p-3 bg-[#4caf50]/10 border-[0.5px] border-[#4caf50] text-[#4caf50] rounded-full","aria-label":m?"Pause playback":"Play recording",children:m?f.jsx(AK,{size:20}):f.jsx(MK,{size:20})}),f.jsx("button",{onClick:J,className:"p-4 bg-[#00f3ff]/10 border-[0.5px] border-[#00f3ff] text-[#00f3ff] rounded-full","aria-label":"Send voice message",children:f.jsx(ek,{size:24})})]}):f.jsx("button",{onClick:i?H:U,className:`p-4 rounded-full transition-all ${i?"bg-red-500/20 border-[0.5px] border-red-500 text-red-500":"bg-[#00f3ff]/10 border-[0.5px] border-[#00f3ff] text-[#00f3ff]"}`,"aria-label":i?"Stop recording":"Start recording",children:i?f.jsx(zae,{size:24}):f.jsx(p2,{size:24})})})]}),f.jsx("p",{className:"text-[8px] text-[#4caf50]/60 text-center uppercase tracking-wider",role:"status",children:i?"Recording... tap square to stop":h?"Tap play to review, send when ready":"Hold or tap microphone to start"})]})}):null},IUe=({audioUrl:n,duration:e,waveformData:t=[],isMe:i,onTranscript:r})=>{const[s,o]=$.useState(!1),[a,l]=$.useState(0),[c,u]=$.useState(0),[h,p]=$.useState(1),[m,y]=$.useState(null),[b,w]=$.useState(!1),v=$.useRef(null),T=$.useRef(null),S=I=>{const F=Math.floor(I/60),j=Math.floor(I%60);return`${F}:${j.toString().padStart(2,"0")}`},M=$.useCallback(()=>{v.current&&(s?v.current.pause():v.current.play(),o(!s))},[s]),P=$.useCallback(I=>{if(!T.current||!v.current)return;const F=T.current.getBoundingClientRect(),W=(I.clientX-F.left)/F.width,U=W*e;v.current.currentTime=U,u(U),l(W*100)},[e]),R=$.useCallback(()=>{const I=[1,1.5,2],F=I.indexOf(h),j=I[(F+1)%I.length];p(j),v.current&&(v.current.playbackRate=j)},[h]),O=$.useCallback(async()=>{if(!(m||b)){w(!0);try{const I=window.webkitSpeechRecognition||window.SpeechRecognition;if(I){const F=new I;F.continuous=!1,F.interimResults=!1,F.lang="en-US",F.onresult=j=>{const W=j.results[0]?.[0]?.transcript||"Unable to transcribe";y(W),r?.(W),w(!1)},F.onerror=()=>{y("Transcript unavailable"),w(!1)},F.onend=()=>{m||y("Transcript unavailable"),w(!1)},F.start(),v.current&&(v.current.currentTime=0,v.current.play().catch(()=>{})),setTimeout(()=>{F.stop()},Math.min(e*1e3+1e3,1e4))}else y("Speech recognition not available in this browser"),w(!1)}catch(I){console.error("Transcription error:",I),y("Transcript unavailable"),w(!1)}}},[n,e,m,b,r]);$.useEffect(()=>{const I=new Audio(n);return v.current=I,I.onended=()=>{o(!1),l(0),u(0)},I.ontimeupdate=()=>{u(I.currentTime),l(I.currentTime/I.duration*100)},I.onloadedmetadata=()=>{I.playbackRate=h},()=>{I.pause(),I.src=""}},[n,h]);const B=30,N=t.length>0?t.slice(0,B).map((I,F)=>({amplitude:I,index:F})):Array.from({length:B},(I,F)=>({amplitude:.3+Math.random()*.4,index:F}));return f.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${i?"bg-[#00f3ff]/5":"bg-[#4caf50]/5"} border-[0.5px] ${i?"border-[#00f3ff]/20":"border-[#4caf50]/20"}`,role:"region","aria-label":`Voice message, ${S(e)} duration`,children:[f.jsx("button",{onClick:M,className:`p-2 rounded-full transition-all ${i?"bg-[#00f3ff]/20 text-[#00f3ff] hover:bg-[#00f3ff]/30":"bg-[#4caf50]/20 text-[#4caf50] hover:bg-[#4caf50]/30"}`,"aria-label":s?"Pause voice message":"Play voice message",children:s?f.jsx(AK,{size:16}):f.jsx(MK,{size:16})}),f.jsxs("div",{className:"flex-1 space-y-1",children:[f.jsx("div",{ref:T,className:"relative h-8 flex items-center gap-[2px] cursor-pointer",onClick:P,role:"slider","aria-label":"Voice message progress","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,tabIndex:0,children:N.map((I,F)=>{const j=F/N.length*100<=a;return f.jsx("div",{className:`flex-1 rounded-full transition-all ${j?i?"bg-[#00f3ff]":"bg-[#4caf50]":i?"bg-[#00f3ff]/30":"bg-[#4caf50]/30"}`,style:{height:`${Math.max(4,I.amplitude*24)}px`,opacity:j?1:.5}},F)})}),f.jsxs("div",{className:"flex items-center justify-between text-[8px] font-mono",children:[f.jsxs("span",{className:i?"text-[#00f3ff]/60":"text-[#4caf50]/60",children:[S(c)," / ",S(e)]}),f.jsxs("button",{onClick:R,className:`px-1.5 py-0.5 rounded ${i?"bg-[#00f3ff]/10 text-[#00f3ff]":"bg-[#4caf50]/10 text-[#4caf50]"}`,"aria-label":`Playback speed ${h}x`,children:[h,"x"]})]})]}),f.jsx("button",{onClick:O,className:`p-1.5 rounded transition-all ${i?"text-[#00f3ff]/60 hover:text-[#00f3ff]":"text-[#4caf50]/60 hover:text-[#4caf50]"}`,"aria-label":"Request transcript",title:"Get transcript",children:f.jsx(m_,{size:14})}),(m||b)&&f.jsx("div",{className:`absolute left-0 right-0 -bottom-6 text-[7px] px-2 py-1 ${i?"text-[#00f3ff]/70":"text-[#4caf50]/70"}`,role:"status","aria-live":"polite",children:b?"Transcribing...":m})]})},NUe=$.lazy(()=>cBe(()=>import("./Media3DRenderer-d1f35923.js"),[])),PUe=({message:n,isMe:e,onViewTensor:t})=>{if(n.type==="3d-object"&&n.tensorData){const i=n.tensorData;return f.jsxs("div",{className:"mt-3 mb-2",children:[f.jsxs("div",{className:"relative cursor-pointer group",onClick:()=>t?.(i),children:[f.jsx($.Suspense,{fallback:f.jsx("div",{className:"w-48 h-36 bg-black/50 border border-[#00f3ff]/20 rounded flex items-center justify-center",children:f.jsx(xr,{className:"w-6 h-6 text-[#00f3ff] animate-spin"})}),children:f.jsx(NUe,{tensorData:i,isVideo:n.mediaType?.startsWith("video/"),size:"medium",showFrame:!0,interactive:!1})}),f.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all rounded",children:f.jsxs("div",{className:"flex items-center gap-2 text-[#00f3ff]",children:[f.jsx(EK,{size:20}),f.jsx("span",{className:"text-[9px] uppercase tracking-wider font-bold",children:"View 3D"})]})})]}),i.flowerOfLife&&f.jsxs("div",{className:"text-[7px] font-mono mt-2 opacity-50 flex items-center gap-2",children:[f.jsx(u7,{size:8,className:"text-[#00f3ff]"}),"FLOWER_OF_LIFE: ",i.flowerOfLife.rayCount," rays | Gen ",i.flowerOfLife.generations]}),i.originalFiles&&i.originalFiles.length>0&&f.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:i.originalFiles.map((r,s)=>f.jsxs("a",{href:r.url,download:r.fileName,target:"_blank",rel:"noopener noreferrer",onClick:o=>o.stopPropagation(),className:"inline-flex items-center gap-1 px-2 py-1 bg-[#4caf50]/10 border border-[#4caf50]/30 rounded text-[7px] text-[#4caf50] hover:bg-[#4caf50]/20 transition-all",children:[f.jsx(Zf,{size:8}),r.fileName.length>12?r.fileName.slice(0,12)+"...":r.fileName]},s))}),n.fileName&&f.jsxs("div",{className:"text-[8px] font-mono mt-2 opacity-60 flex items-center gap-2",children:[f.jsx(gK,{size:10}),n.fileName]})]})}return n.type==="voice"&&n.voiceData?f.jsx("div",{className:"mt-3 mb-2 min-w-[200px]",children:f.jsx(IUe,{audioUrl:n.voiceData.audioUrl,duration:n.voiceData.duration,waveformData:n.voiceData.waveformData,isMe:e})}):n.type==="image"&&n.mediaUrl?f.jsxs("div",{className:"mt-3 mb-2",children:[f.jsx("img",{src:n.mediaUrl,alt:n.altText||n.fileName||"Image attachment",className:"max-w-[240px] max-h-[180px] rounded border border-[#00f3ff]/20 object-contain",role:"img","aria-describedby":`img-desc-${n.id}`}),n.altText&&f.jsx("p",{id:`img-desc-${n.id}`,className:"sr-only",children:n.altText}),f.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.fileName&&f.jsxs("div",{className:"text-[8px] font-mono opacity-60 flex items-center gap-2",children:[f.jsx(J3,{size:10,"aria-hidden":"true"}),f.jsx("span",{children:n.fileName})]}),f.jsx("a",{href:n.mediaUrl,download:n.fileName,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-0.5 bg-[#4caf50]/10 border border-[#4caf50]/20 rounded text-[7px] text-[#4caf50] hover:bg-[#4caf50]/20 transition-all","aria-label":`Download ${n.fileName||"image"}`,children:f.jsx(Zf,{size:8,"aria-hidden":"true"})})]})]}):n.type==="video"&&n.mediaUrl?f.jsxs("div",{className:"mt-3 mb-2",children:[f.jsx("video",{src:n.mediaUrl,controls:!0,className:"max-w-[280px] max-h-[200px] rounded border border-[#00f3ff]/20",preload:"metadata"}),f.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[n.fileName&&f.jsxs("div",{className:"text-[8px] font-mono opacity-60 flex items-center gap-2",children:[f.jsx(JP,{size:10}),n.fileName]}),f.jsx("a",{href:n.mediaUrl,download:n.fileName,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 px-2 py-0.5 bg-[#4caf50]/10 border border-[#4caf50]/20 rounded text-[7px] text-[#4caf50] hover:bg-[#4caf50]/20 transition-all",children:f.jsx(Zf,{size:8})})]})]}):n.type==="file"&&n.fileName?f.jsxs("div",{className:"mt-3 mb-2 p-3 bg-black/30 border border-[#4caf50]/20 rounded flex items-center gap-3",children:[f.jsx(TK,{size:16,className:"opacity-60"}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("div",{className:"text-[10px] font-bold truncate",children:n.fileName}),n.fileSize&&f.jsxs("div",{className:"text-[8px] opacity-40",children:[(n.fileSize/1024).toFixed(1)," KB"]})]}),n.mediaUrl&&f.jsx("a",{href:n.mediaUrl,download:n.fileName,target:"_blank",rel:"noopener noreferrer",className:"p-2 bg-[#4caf50]/10 border border-[#4caf50]/20 rounded text-[#4caf50] hover:bg-[#4caf50]/20 transition-all",children:f.jsx(Zf,{size:12})})]}):null},kUe="",Y$=({size:n=24,color:e="currentColor",rotor:t=!1,pulse:i=!1})=>f.jsxs("svg",{viewBox:"0 0 100 100",width:n,height:n,className:`opacity-100 transition-all duration-700 ${t?"animate-[rotorse-alpha_10s_linear_infinite]":""} ${i?"animate-pulse scale-110":""}`,children:[f.jsx("circle",{cx:"50",cy:"50",r:"16",fill:"none",stroke:e,strokeWidth:"1"}),[0,60,120,180,240,300].map(r=>f.jsx("circle",{cx:50+16*Math.cos(r*Math.PI/180),cy:50+16*Math.sin(r*Math.PI/180),r:"16",fill:"none",stroke:e,strokeWidth:"1"},r))]}),LUe=({users:n})=>{if(n.length===0)return null;const e=n.length===1?`${n[0].displayName} is typing`:n.length===2?`${n[0].displayName} and ${n[1].displayName} are typing`:`${n[0].displayName} and ${n.length-1} others are typing`;return f.jsxs("div",{className:"flex items-center gap-3 text-[9px] md:text-[11px] text-[#4caf50]/60 italic font-bold animate-in fade-in duration-300",children:[f.jsxs("div",{className:"flex gap-1",children:[f.jsx("div",{className:"w-1.5 h-1.5 bg-[#4caf50] rounded-full animate-bounce",style:{animationDelay:"0ms"}}),f.jsx("div",{className:"w-1.5 h-1.5 bg-[#4caf50] rounded-full animate-bounce",style:{animationDelay:"150ms"}}),f.jsx("div",{className:"w-1.5 h-1.5 bg-[#4caf50] rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),f.jsx("span",{className:"tracking-wider uppercase",children:e})]})},DUe=({onSelect:n,onClose:e})=>f.jsx("div",{className:"absolute -top-12 left-0 z-50 animate-in fade-in slide-in-from-bottom-2 duration-200",children:f.jsx("div",{className:"bg-black border-[0.5px] border-[#00f3ff]/30 p-2 flex gap-1 shadow-[0_0_20px_rgba(0,243,255,0.2)]",children:k9e.map(t=>f.jsx("button",{type:"button",onClick:()=>{n(t),e()},className:"w-8 h-8 flex items-center justify-center text-lg hover:bg-[#00f3ff]/10 transition-all rounded active:scale-90",children:t},t))})}),OUe=({reactions:n,onReact:e})=>!n||n.length===0?null:f.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:n.map(t=>f.jsxs("button",{type:"button",onClick:()=>e(t.emoji),className:`flex items-center gap-1 px-2 py-0.5 text-[10px] border-[0.5px] transition-all rounded-full ${t.includesMe?"bg-[#00f3ff]/20 border-[#00f3ff]/40 text-[#00f3ff]":"bg-black/50 border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/40"}`,children:[f.jsx("span",{children:t.emoji}),f.jsx("span",{className:"font-bold",children:t.count})]},t.emoji))}),BUe=({message:n,onReply:e,onReact:t,onEdit:i,onDelete:r,onCopy:s})=>f.jsx("div",{className:"absolute -top-8 right-0 z-40 flex gap-0.5 opacity-0 group-hover:opacity-100 transition-opacity duration-200 animate-in fade-in",children:f.jsxs("div",{className:"flex bg-black border-[0.5px] border-[#00f3ff]/20 shadow-lg",children:[f.jsx("button",{type:"button",onClick:e,className:"p-2 text-[#00f3ff]/60 hover:text-[#00f3ff] hover:bg-[#00f3ff]/10 transition-all",title:"Reply",children:f.jsx(IK,{size:12,strokeWidth:1.5})}),f.jsx("button",{type:"button",onClick:t,className:"p-2 text-[#00f3ff]/60 hover:text-[#00f3ff] hover:bg-[#00f3ff]/10 transition-all",title:"React",children:f.jsx(Fae,{size:12,strokeWidth:1.5})}),f.jsx("button",{type:"button",onClick:s,className:"p-2 text-[#00f3ff]/60 hover:text-[#00f3ff] hover:bg-[#00f3ff]/10 transition-all",title:"Copy",children:f.jsx(XP,{size:12,strokeWidth:1.5})}),n.isMe&&i&&!n.deletedAt&&f.jsx("button",{type:"button",onClick:i,className:"p-2 text-[#00f3ff]/60 hover:text-[#00f3ff] hover:bg-[#00f3ff]/10 transition-all",title:"Edit",children:f.jsx(Lae,{size:12,strokeWidth:1.5})}),n.isMe&&r&&!n.deletedAt&&f.jsx("button",{type:"button",onClick:r,className:"p-2 text-red-500/60 hover:text-red-500 hover:bg-red-500/10 transition-all",title:"Delete",children:f.jsx(p_,{size:12,strokeWidth:1.5})})]})}),UUe=({replyMessage:n,isMe:e})=>n?f.jsxs("div",{className:`flex items-start gap-2 mb-2 pb-2 border-b-[0.5px] ${e?"border-[#00f3ff]/20":"border-[#4caf50]/20"}`,children:[f.jsx(gae,{size:12,className:"opacity-40 mt-0.5 flex-shrink-0",strokeWidth:1.5}),f.jsxs("div",{className:"min-w-0",children:[f.jsx("div",{className:`text-[8px] font-bold uppercase tracking-wider opacity-50 ${e?"text-[#00f3ff]":"text-[#4caf50]"}`,children:n.sender}),f.jsxs("div",{className:`text-[10px] opacity-40 truncate max-w-[200px] ${e?"text-[#00f3ff]":"text-[#4caf50]"}`,children:[n.deletedAt?"[Message deleted]":n.content.substring(0,50),n.content.length>50?"...":""]})]})]}):null,FUe=({messages:n,onSend:e,onFileUpload:t,onOpenSettings:i,onVoiceMessage:r,fileProgress:s=0,isVerifying:o,nodeId:a,onCall:l,typingUsers:c=[],onReact:u,onEdit:h,onDelete:p,onStartTyping:m,onStopTyping:y,getMessageById:b,onViewThread:w,highlightedMessageId:v,onViewTensorObject:T})=>{const[S,M]=$.useState(""),[P,R]=$.useState(!1),[O,B]=$.useState(!1),[N,I]=$.useState(null),[F,j]=$.useState(null),[W,U]=$.useState(null),[H,q]=$.useState(""),[J,G]=$.useState(null),[ee,Q]=$.useState(null),[ne,fe]=$.useState(!1),[Ae,Pe]=$.useState(!1),Ce=$.useRef(null),de=$.useRef(null),Ne=$.useRef(null),et=$.useRef(null),me=$.useCallback((he,Ge,ct)=>{r&&(r(he,Ge,ct),Pe(!1),I("VOICE_MESSAGE_SENT"),setTimeout(()=>I(null),2e3))},[r]);$.useEffect(()=>{Ce.current&&(Ce.current.scrollTop=Ce.current.scrollHeight)},[n,o,c]),$.useEffect(()=>{if(!v||!Ce.current)return;const he=document.getElementById(`msg-${v}`);if(!he)return;he.scrollIntoView({behavior:"smooth",block:"center"}),he.classList.add("ring-2","ring-[#00f3ff]","ring-offset-2","ring-offset-black");const Ge=setTimeout(()=>{he.classList.remove("ring-2","ring-[#00f3ff]","ring-offset-2","ring-offset-black")},3e3);return()=>{clearTimeout(Ge),he.classList.remove("ring-2","ring-[#00f3ff]","ring-offset-2","ring-offset-black")}},[v]);const nt=$.useCallback(he=>{M(he.target.value),Ne.current&&(Ne.current.style.height="auto",Ne.current.style.height=Math.min(Ne.current.scrollHeight,120)+"px"),m&&he.target.value.length>0?(m(),et.current&&clearTimeout(et.current),et.current=setTimeout(()=>{y?.()},3e3)):y&&he.target.value.length===0&&y()},[m,y]),Pt=$.useCallback(he=>{he.key==="Enter"&&!he.shiftKey&&(he.preventDefault(),S.trim()&&!o&&(e(S,F?.id),M(""),j(null),B(!1),y?.(),Ne.current&&(Ne.current.style.height="auto")))},[S,o,e,F,y]);$.useEffect(()=>{if("visualViewport"in window&&window.visualViewport){const he=()=>{Ce.current&&(Ce.current.scrollTop=Ce.current.scrollHeight)};return window.visualViewport.addEventListener("resize",he),()=>window.visualViewport?.removeEventListener("resize",he)}},[]);const zt=he=>{he.preventDefault(),S.trim()&&!o&&(e(S,F?.id),M(""),j(null),B(!1),y?.(),Ne.current&&(Ne.current.style.height="auto"))},Dt=he=>{H.trim()&&h&&(h(he,H),U(null),q(""),I("MESSAGE_UPDATED"),setTimeout(()=>I(null),2e3))},gt=he=>{p&&(p(he),Q(null),I("MESSAGE_DELETED"),setTimeout(()=>I(null),2e3))},vt=(he,Ge)=>{u&&u(he,Ge),G(null)},Oe=async he=>{try{await navigator.clipboard.writeText(he),I("COPIED_TO_CLIPBOARD"),setTimeout(()=>I(null),2e3)}catch{I("COPY_FAILED"),setTimeout(()=>I(null),2e3)}},xt=he=>{const Ge=Array.from(he.target.files||[]);Ge.length>0&&t&&(t(Ge,!1),I(`ISO_FILE_QUEUED: ${Ge.length} FILE${Ge.length>1?"S":""}`),setTimeout(()=>I(null),3e3)),de.current&&(de.current.value="")},pe=$.useCallback((he,Ge)=>{if(t){t(he,Ge);const ct=he.length;I(Ge?`3D_TENSOR_OBJECT_CREATED: ${ct} FILE${ct>1?"S":""} VIA FLOWER_OF_LIFE_PHI`:`ISO_FILE_TRANSMITTED: ${ct} FILE${ct>1?"S":""}`),setTimeout(()=>I(null),3e3)}},[t]),qe=he=>{M(Ge=>Ge+he)},$e=he=>{j(he),Ne.current?.focus()},Xe=he=>{U(he),q(he.content)},Ye=()=>{j(null)},oe=()=>{U(null),q("")},Z=o||n.length>0&&!n[n.length-1].isMe&&n[n.length-1].content==="";return f.jsxs("div",{className:"flex flex-col h-full bg-[#010401] font-mono text-[#00f3ff] relative overflow-hidden",children:[f.jsx("input",{type:"file",ref:de,onChange:xt,className:"hidden",accept:"image/*,video/*,.md,.js,.ts,.jsx,.tsx,.cpp,.c,.h,.circom,.json,.html,.css,.yaml,.yml,.txt,.py,.rs,.go",multiple:!0}),f.jsx(MUe,{isOpen:ne,onClose:()=>fe(!1),onUpload:pe}),f.jsxs("div",{className:"px-4 md:px-12 py-4 md:py-6 border-b-[0.5px] border-[#4caf50]/30 bg-black/90 flex justify-between items-center text-[7px] md:text-[10px] uppercase tracking-[0.2em] md:tracking-[0.4em] relative z-20 font-black shadow-lg",children:[f.jsxs("div",{className:"flex gap-4 md:gap-10 items-center",children:[f.jsxs("div",{className:"flex items-center gap-2 md:gap-3",children:[f.jsx(Y$,{color:"#00f3ff",size:18,rotor:!0}),f.jsx("span",{className:"text-[#00f3ff] drop-shadow-[0_0_8px_#00f3ff66] truncate max-w-[90px] sm:max-w-none opacity-80",children:"CHANNEL_ISO_CORE_0x9"})]}),f.jsxs("div",{className:"hidden sm:flex items-center gap-4 opacity-30",children:[f.jsx(DR,{size:14,strokeWidth:1}),f.jsxs("span",{className:"hidden md:block",children:["TUNNEL: ",a]})]})]}),f.jsxs("div",{className:"flex items-center gap-4 md:gap-10 text-[#00f3ff]",children:[f.jsxs("div",{className:"flex gap-4",children:[f.jsx("button",{onClick:()=>{I("INITIATING_SECURE_VOICE..."),setTimeout(()=>{I(null),l?.("voice")},1e3)},className:"cursor-pointer opacity-60 hover:opacity-100 transition-opacity active:scale-90 p-1",children:f.jsx(CK,{size:18,strokeWidth:1})}),f.jsx("button",{onClick:()=>{I("INITIATING_SECURE_VIDEO..."),setTimeout(()=>{I(null),l?.("video")},1e3)},className:"cursor-pointer opacity-60 hover:opacity-100 transition-opacity active:scale-90 p-1",children:f.jsx(tk,{size:18,strokeWidth:1})})]}),f.jsx("div",{className:"w-[0.5px] h-4 bg-[#4caf50]/30"}),f.jsxs("div",{className:"flex items-center gap-1.5 text-[#4caf50]",children:[f.jsx("div",{className:"w-1.5 h-1.5 bg-[#4caf50] rounded-full animate-pulse opacity-60"}),f.jsx("span",{className:"tracking-widest uppercase italic font-black text-[7px] hidden xs:block opacity-60",children:"SYNC"})]}),f.jsx("button",{onClick:()=>i?.(),className:"p-1 hover:bg-[#4caf50]/10 rounded transition-all",children:f.jsx(Pae,{size:18,className:"cursor-pointer opacity-40 hover:opacity-100",strokeWidth:1})})]})]}),f.jsxs("div",{ref:Ce,className:"flex-1 overflow-y-auto p-4 md:p-12 lg:p-16 space-y-10 md:space-y-14 scrollbar-hide scroll-smooth relative z-10 pb-24 md:pb-16 bg-[#010401]",children:[f.jsxs("div",{className:"text-[7px] md:text-[9px] text-[#4caf50]/30 uppercase mb-8 md:mb-12 pb-6 md:pb-10 border-b-[0.5px] border-[#4caf50]/20 font-black tracking-[0.2em] md:tracking-[0.4em] leading-loose italic",children:[f.jsxs("p",{className:"flex items-center gap-3 md:gap-4 mb-2",children:[f.jsx(Vm,{size:10,strokeWidth:1})," ISO_ESTABLISHED: ",new Date().toLocaleTimeString()]}),f.jsxs("p",{className:"flex items-center gap-3 md:gap-4 mb-2",children:[f.jsx(ao,{size:10,strokeWidth:1})," ENCRYPTION: G3T_DOUBLE_RATCHET"]}),f.jsxs("p",{className:"flex items-center gap-3 md:gap-4 text-[#00f3ff]/40 animate-pulse",children:[f.jsx(u7,{size:10,strokeWidth:1})," GEODESIC_SYNC: 0.9999812_STABLE"]})]}),n.map(he=>{const Ge=he.replyTo&&b?b(he.replyTo):void 0,ct=!!he.deletedAt,tt=W?.id===he.id;return f.jsxs("div",{id:`msg-${he.id}`,className:`flex flex-col ${he.isMe?"items-end":"items-start"} animate-in fade-in slide-in-from-bottom-2 duration-500 relative group transition-all`,children:[f.jsxs("div",{className:`flex items-center gap-3 md:gap-4 mb-2 md:mb-3 text-[7px] md:text-[10px] uppercase tracking-[0.2em] md:tracking-[0.3em] font-black ${he.isMe?"text-[#00f3ff]/50":"text-[#4caf50]/50"}`,children:[!he.isMe&&f.jsx(j0,{size:10,className:"text-[#00f3ff] opacity-60",strokeWidth:1}),he.isZkpVerified&&f.jsx(f_,{size:12,className:"opacity-60",strokeWidth:1}),f.jsx("span",{className:"opacity-60",children:he.sender}),f.jsxs("span",{className:"opacity-30 font-black font-mono",children:["[",new Date(he.timestamp).toLocaleTimeString([],{hour12:!1,hour:"2-digit",minute:"2-digit"}),"]"]}),he.editedAt&&!ct&&f.jsx("span",{className:"text-[6px] opacity-30 italic",children:"(edited)"})]}),f.jsxs("div",{className:`relative max-w-[95%] md:max-w-[85%] p-4 md:p-8 text-[11px] md:text-[15px] border-l-[0.5px] transition-all duration-500 shadow-lg ${ct?"bg-white/[0.02] border-white/10 text-white/30 italic":he.isMe?"bg-[#00f3ff]/[0.03] border-[#00f3ff]/30 text-[#00f3ff] hover:bg-[#00f3ff]/[0.05]":"bg-[#4caf50]/[0.03] border-[#4caf50]/30 text-[#4caf50] hover:bg-[#4caf50]/[0.05]"}`,children:[Ge&&f.jsx(UUe,{replyMessage:Ge,isMe:he.isMe}),ct?f.jsxs("p",{className:"leading-relaxed font-bold tracking-tight opacity-50 flex items-center gap-2",children:[f.jsx(p_,{size:14,strokeWidth:1}),"This message was deleted"]}):tt?f.jsxs("div",{className:"flex flex-col gap-2",children:[f.jsx("input",{type:"text",value:H,onChange:Lt=>q(Lt.target.value),onKeyDown:Lt=>{Lt.key==="Enter"&&Dt(he.id),Lt.key==="Escape"&&oe()},className:"w-full bg-black/50 border-[0.5px] border-[#00f3ff]/30 px-3 py-2 text-[11px] md:text-[13px] outline-none text-[#00f3ff] font-bold",autoFocus:!0}),f.jsxs("div",{className:"flex gap-2 text-[8px]",children:[f.jsx("button",{type:"button",onClick:()=>Dt(he.id),className:"px-3 py-1 bg-[#00f3ff]/20 text-[#00f3ff] font-bold uppercase tracking-wider hover:bg-[#00f3ff]/30",children:"Save"}),f.jsx("button",{type:"button",onClick:oe,className:"px-3 py-1 bg-white/10 text-white/60 font-bold uppercase tracking-wider hover:bg-white/20",children:"Cancel"})]})]}):f.jsxs(f.Fragment,{children:[he.content&&he.type==="text"&&f.jsx("p",{className:"leading-relaxed whitespace-pre-wrap font-bold tracking-tight opacity-90 group-hover:opacity-100 transition-opacity",children:he.content}),!he.content&&he.type==="text"&&f.jsxs("span",{className:"flex items-center gap-6 italic opacity-30",children:[f.jsx(xr,{size:16,className:"animate-spin",strokeWidth:1}),"Calculating..."]}),f.jsx(PUe,{message:he,isMe:he.isMe,onViewTensor:T})]}),!ct&&he.reactions&&he.reactions.length>0&&f.jsx(OUe,{reactions:he.reactions,onReact:Lt=>vt(he.id,Lt)}),he.threadCount&&he.threadCount>0&&w&&f.jsxs("button",{type:"button",onClick:()=>w(he.id),className:"flex items-center gap-2 mt-3 pt-2 border-t-[0.5px] border-current/10 text-[9px] font-bold uppercase tracking-wider opacity-50 hover:opacity-100 transition-opacity",children:[f.jsx(Pd,{size:12,strokeWidth:1.5}),he.threadCount," ",he.threadCount===1?"reply":"replies"]}),!ct&&!tt&&f.jsxs(f.Fragment,{children:[f.jsx(BUe,{message:he,onReply:()=>$e(he),onReact:()=>G(J===he.id?null:he.id),onEdit:he.isMe&&h?()=>Xe(he):void 0,onDelete:he.isMe&&p?()=>Q(he.id):void 0,onCopy:()=>Oe(he.content)}),J===he.id&&f.jsx(DUe,{onSelect:Lt=>vt(he.id,Lt),onClose:()=>G(null)})]}),ee===he.id&&f.jsxs("div",{className:"absolute inset-0 bg-black/90 flex items-center justify-center gap-3 z-50 animate-in fade-in duration-200",children:[f.jsx("span",{className:"text-[10px] font-bold uppercase tracking-wider text-white/60",children:"Delete?"}),f.jsx("button",{type:"button",onClick:()=>gt(he.id),className:"px-3 py-1.5 bg-red-500/30 text-red-400 text-[9px] font-bold uppercase tracking-wider hover:bg-red-500/50",children:"Yes"}),f.jsx("button",{type:"button",onClick:()=>Q(null),className:"px-3 py-1.5 bg-white/10 text-white/60 text-[9px] font-bold uppercase tracking-wider hover:bg-white/20",children:"No"})]}),!ct&&f.jsxs("div",{className:"absolute -top-3 right-4 md:right-8 flex items-center gap-2 px-3 py-0.5 bg-black border-[0.5px] border-[#00f3ff]/20 text-[6px] md:text-[8px] font-black tracking-[0.2em] md:tracking-[0.3em] text-[#00f3ff] uppercase group-hover:opacity-100 opacity-30 transition-opacity cursor-default z-20 shadow-xl",children:[f.jsx(us,{size:8,className:"animate-pulse",strokeWidth:1}),f.jsx("span",{children:"SOUND_VERIFIED"})]}),he.isMe&&!ct&&f.jsxs("div",{className:"absolute -bottom-4 md:-bottom-5 right-0 flex items-center gap-2 md:gap-3 text-[6px] md:text-[9px] font-black italic tracking-widest opacity-20 group-hover:opacity-60 transition-opacity",children:[f.jsxs("span",{className:"uppercase font-mono",children:["PKT_",he.id.substr(0,4).toUpperCase()]}),f.jsxs("div",{className:"flex items-center gap-1.5",children:[he.isZkpVerified&&f.jsx(ao,{size:8,className:"text-[#00f3ff] opacity-40",strokeWidth:1.5}),f.jsxs("div",{className:"flex gap-0.5",children:[f.jsx(us,{size:8,className:he.status==="read"?"text-[#00f3ff]":"text-white/10",strokeWidth:1}),f.jsx(us,{size:8,className:he.status==="delivered"||he.status==="read"?"text-[#00f3ff]":"text-white/10",strokeWidth:1})]})]})]})]})]},he.id)}),c.length>0&&f.jsx("div",{className:"py-4",children:f.jsx(LUe,{users:c})}),Z&&f.jsx("div",{className:"flex flex-col items-start animate-in fade-in duration-700",children:f.jsxs("div",{className:"p-4 md:p-10 border-l-[0.5px] border-[#4caf50]/20 bg-[#4caf50]/[0.02] text-[10px] md:text-[14px] italic opacity-30 flex items-center gap-6 md:gap-12",children:[f.jsx(Y$,{size:28,color:"#00f3ff",pulse:!0,rotor:!0}),f.jsx("span",{className:"font-black tracking-[0.1em] md:tracking-[0.2em] opacity-80 animate-pulse",children:"Synchronizing_Geodesic..."})]})})]}),O&&f.jsx("div",{className:"absolute bottom-24 md:bottom-28 left-4 md:left-12 right-4 md:right-12 z-[150] animate-in slide-in-from-bottom-6 duration-300",children:f.jsxs("div",{className:"bg-black border-[0.5px] border-[#4caf50]/30 p-4 md:p-6 shadow-[0_-15px_60px_rgba(0,0,0,0.95)] backdrop-blur-xl",children:[f.jsxs("div",{className:"flex justify-between items-center mb-4 border-b-[0.5px] border-[#4caf50]/10 pb-3",children:[f.jsxs("span",{className:"text-[7px] md:text-[9px] font-black tracking-[0.3em] uppercase text-[#4caf50]/60 flex items-center gap-2",children:[f.jsx(DR,{size:10})," MULTIVECTOR_ONTOLOGY_OPCODES"]}),f.jsx("button",{onClick:()=>B(!1),className:"text-[#4caf50] opacity-40 hover:opacity-100 p-1",children:f.jsx(Ui,{size:14})})]}),f.jsx("div",{className:"grid grid-cols-6 sm:grid-cols-10 md:grid-cols-16 lg:grid-cols-20 gap-1.5 h-36 md:h-48 overflow-y-auto scrollbar-hide",children:kUe.split("").map((he,Ge)=>f.jsx("button",{type:"button",onClick:()=>qe(he),className:"w-full aspect-square border-[0.5px] border-[#4caf50]/10 flex items-center justify-center text-[12px] md:text-[15px] text-[#00f3ff]/40 hover:text-[#00f3ff] hover:bg-[#00f3ff]/10 hover:border-[#00f3ff]/30 transition-all active:scale-90 font-bold",children:he},Ge))})]})}),F&&f.jsxs("div",{className:"px-4 md:px-12 py-3 border-t-[0.5px] border-[#00f3ff]/20 bg-[#00f3ff]/[0.02] flex items-center gap-4 animate-in slide-in-from-bottom-4 duration-200 z-20",children:[f.jsx(IK,{size:14,className:"text-[#00f3ff]/60",strokeWidth:1.5}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"text-[8px] font-bold uppercase tracking-wider text-[#00f3ff]/60",children:["Replying to ",F.sender]}),f.jsxs("div",{className:"text-[10px] text-[#00f3ff]/40 truncate",children:[F.content.substring(0,60),F.content.length>60?"...":""]})]}),f.jsx("button",{type:"button",onClick:Ye,className:"text-[#00f3ff]/40 hover:text-[#00f3ff] p-1",children:f.jsx(Ui,{size:14})})]}),f.jsx(RUe,{isOpen:Ae,onSend:me,onCancel:()=>Pe(!1)}),f.jsxs("form",{onSubmit:zt,className:"relative z-20 px-4 md:px-12 py-4 md:py-6 border-t-[0.5px] border-[#4caf50]/30 bg-black/90 backdrop-blur-md",role:"form","aria-label":"Message input",children:[N&&f.jsx("div",{className:"absolute bottom-full left-4 md:left-12 mb-2 text-[7px] md:text-[8px] text-[#4caf50] italic opacity-70 font-bold",role:"status","aria-live":"polite",children:N}),f.jsxs("div",{className:"flex gap-3 items-end",children:[f.jsx("textarea",{ref:Ne,value:S,onChange:nt,onKeyDown:Pt,onFocus:()=>R(!0),onBlur:()=>R(!1),placeholder:F?"Type your reply...":"Type a message...",rows:1,className:"flex-1 bg-black/40 border-[0.5px] border-[#4caf50]/40 px-4 py-3 text-[11px] md:text-[13px] outline-none focus:border-[#00f3ff]/50 text-[#00f3ff] font-semibold tracking-wide transition-all placeholder-[#4caf50]/30 resize-none overflow-hidden min-h-[44px] max-h-[120px]","aria-label":"Message input field",style:{height:"auto"}}),f.jsx("button",{type:"button",onClick:()=>fe(!0),className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2.5",title:"Upload Media / 3D Object","aria-label":"Upload media or 3D object",children:f.jsx(TK,{size:14,strokeWidth:1,"aria-hidden":"true"})}),r&&f.jsx("button",{type:"button",onClick:()=>Pe(!0),className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2.5",title:"Record Voice Message","aria-label":"Record voice message",children:f.jsx(p2,{size:14,strokeWidth:1,"aria-hidden":"true"})}),f.jsx("button",{type:"button",onClick:()=>B(!O),className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-2.5","aria-label":"Open symbol palette",children:f.jsx(Tae,{size:14,strokeWidth:1,"aria-hidden":"true"})}),f.jsxs("button",{type:"submit",disabled:o||!S.trim(),className:"px-6 py-3 bg-[#4caf50]/20 border-[0.5px] border-[#4caf50]/40 text-[#4caf50] font-black uppercase text-[9px] tracking-widest hover:bg-[#4caf50]/30 hover:border-[#4caf50]/60 disabled:opacity-40 disabled:cursor-not-allowed transition-all flex items-center gap-2","aria-label":F?"Send reply":"Send message",children:[f.jsx(ek,{size:12,strokeWidth:1.5,"aria-hidden":"true"}),F?"REPLY":"SEND"]})]})]})]})};function X$({messages:n,onSend:e,onFileUpload:t,onVoiceMessage:i,onReact:r,onEdit:s,onDelete:o,onStartTyping:a,onStopTyping:l,onViewThread:c,onViewTensorObject:u,getMessageById:h,typingUsers:p,highlightedMessageId:m,fileProgress:y,isVerifying:b}){const[w,v]=$.useState(""),[T,S]=$.useState(!1),[M,P]=$.useState(!1),[R,O]=$.useState(null),B=$.useRef(null),N=$.useRef(),I=$.useRef(null),F=$.useRef([]);$.useEffect(()=>{B.current&&(B.current.style.height="auto",B.current.style.height=Math.min(B.current.scrollHeight,120)+"px")},[w]),$.useEffect(()=>{if("visualViewport"in window&&window.visualViewport){const W=()=>{const U=document.getElementById("chat-container");U&&(U.scrollTop=U.scrollHeight)};return window.visualViewport.addEventListener("resize",W),()=>window.visualViewport?.removeEventListener("resize",W)}},[]),$.useCallback(W=>{v(W.target.value),N.current&&clearTimeout(N.current),a(),N.current=setTimeout(()=>{l()},2e3)},[a,l]);const j=$.useCallback(()=>{const W=w.trim();W&&(e(W,R),v(""),O(null),N.current&&clearTimeout(N.current),l())},[w,R,e,l]);return $.useCallback(W=>{W.key==="Enter"&&!W.shiftKey&&(W.preventDefault(),j())},[j]),$.useCallback(W=>{const U=W.target.files?.[0];U&&(t(U),S(!1))},[t]),$.useCallback(async()=>{try{const W=await navigator.mediaDevices.getUserMedia({audio:!0}),U=new MediaRecorder(W);I.current=U,F.current=[],U.ondataavailable=H=>{F.current.push(H.data)},U.onstop=()=>{const H=new Blob(F.current,{type:"audio/webm"});i(H),W.getTracks().forEach(q=>q.stop())},U.start(),P(!0)}catch(W){console.error("Failed to start recording:",W)}},[i]),$.useCallback(()=>{I.current&&M&&(I.current.stop(),P(!1))},[M]),R&&h(R),f.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:f.jsx(FUe,{messages:n,onSend:e,onFileUpload:t,onVoiceMessage:i,onOpenSettings:()=>{},fileProgress:y,isVerifying:b,nodeId:"12D3KooWG3ZKPLocal",onCall:()=>{},onReact:r,onEdit:s,onDelete:o,getMessageById:h,typingUsers:p,onStartTyping:a,onStopTyping:l,onViewThread:c,highlightedMessageId:m,onViewTensorObject:u})})}function zUe({meshGroups:n,meshContacts:e,messages:t,selectedGroup:i,typingUsers:r,highlightedMessageId:s,onSelectGroup:o,onSendMessage:a,onFileUpload:l,onVoiceMessage:c,onCreateGroup:u,onJoinGroup:h,onAddContact:p,onCall:m,onReactToMessage:y,onEditMessage:b,onDeleteMessage:w,onStartTyping:v,onStopTyping:T,onViewThread:S,onViewTensorObject:M,getMessageById:P,fileProgress:R,isVerifying:O}){const[B,N]=$.useState("chats"),[I,F]=$.useState(null),[j,W]=$.useState(window.innerWidth<768),[U,H]=$.useState("list");Bte(),$.useEffect(()=>{const fe=()=>{const Ae=window.innerWidth<768;W(Ae),!Ae&&U==="list"&&H("list")};return window.addEventListener("resize",fe),()=>window.removeEventListener("resize",fe)},[U]);const q=$.useCallback((fe,Ae)=>{if(F(fe),Ae==="group"){const Pe=n.find(Ce=>Ce.id===fe);o(Pe||null)}else o(null);j&&H("chat")},[j,n,o]),J=$.useCallback(()=>{H("list"),F(null),o(null)},[o]),G=e.find(fe=>fe.peerId===I),ee=i?.name||G?.displayName||"Chat",Q=G?.isOnline||!1,ne=i?.memberCount;return j&&U==="chat"&&I?f.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden bg-[#010401]",children:[f.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-[#4caf50]/20 bg-black/60 backdrop-blur-md",children:[f.jsx("button",{onClick:J,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-[#4caf50]/10 transition-colors",children:f.jsx(pae,{className:"w-6 h-6 text-[#00f3ff]"})}),f.jsx("div",{className:"w-10 h-10 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center flex-shrink-0",children:i?f.jsx(As,{className:"w-5 h-5 text-[#4caf50]"}):f.jsx("span",{className:"text-[#00f3ff] font-bold text-sm",children:ee.charAt(0).toUpperCase()})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("h3",{className:"text-sm font-bold text-[#00f3ff] truncate",children:ee}),f.jsx("p",{className:"text-xs text-[#4caf50]/60",children:i?`${ne} members`:Q?"Online":"Offline"})]})]}),f.jsx(X$,{messages:t,onSend:a,onFileUpload:l,onVoiceMessage:c,onReact:y,onEdit:b,onDelete:w,onStartTyping:v,onStopTyping:T,onViewThread:S,onViewTensorObject:M,getMessageById:P,typingUsers:r,highlightedMessageId:s,fileProgress:R,isVerifying:O})]}):f.jsxs("div",{className:"flex-1 flex flex-col md:flex-row h-full overflow-hidden bg-[#010401]",children:[f.jsxs("div",{className:`${j?"flex-1":"w-[320px] md:w-[360px]"} flex flex-col border-r border-[#4caf50]/20 bg-black/40`,children:[f.jsxs("div",{className:"px-4 py-3 border-b border-[#4caf50]/20 bg-black/60",children:[f.jsxs("div",{className:"flex items-center justify-between mb-3",children:[f.jsx("h2",{className:"text-sm font-bold text-[#00f3ff] uppercase tracking-wider",children:"MESH"}),f.jsxs("span",{className:"text-xs text-[#4caf50]/60 font-mono",children:[e.filter(fe=>fe.isOnline).length," online"]})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>N("chats"),className:`flex-1 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2 ${B==="chats"?"bg-[#00f3ff]/20 text-[#00f3ff] border border-[#00f3ff]/40":"bg-black/20 text-[#4caf50]/60 border border-[#4caf50]/20 hover:border-[#4caf50]/40"}`,children:[f.jsx(Pd,{className:"w-4 h-4"}),"CHATS"]}),f.jsxs("button",{onClick:()=>N("groups"),className:`flex-1 py-2.5 rounded-lg text-xs font-bold uppercase tracking-wide transition-all flex items-center justify-center gap-2 ${B==="groups"?"bg-[#00f3ff]/20 text-[#00f3ff] border border-[#00f3ff]/40":"bg-black/20 text-[#4caf50]/60 border border-[#4caf50]/20 hover:border-[#4caf50]/40"}`,children:[f.jsx(As,{className:"w-4 h-4"}),"GROUPS"]})]})]}),f.jsx("div",{className:"px-4 py-2 border-b border-[#4caf50]/10",children:f.jsxs("div",{className:"relative",children:[f.jsx(ja,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-[#4caf50]/40"}),f.jsx("input",{type:"text",placeholder:"Search...",className:"w-full bg-black/40 border border-[#4caf50]/20 rounded-lg pl-10 pr-4 py-2.5 text-sm text-[#00f3ff] placeholder-[#4caf50]/40 focus:outline-none focus:border-[#00f3ff]/40"})]})}),f.jsx(SUe,{activeTab:B,groups:n,contacts:e,selectedChatId:I,onSelectChat:q,onCreateGroup:u,onJoinGroup:h,onAddContact:p})]}),!j&&f.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:I?f.jsxs(f.Fragment,{children:[f.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 border-b border-[#4caf50]/20 bg-black/60",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center",children:i?f.jsx(As,{className:"w-5 h-5 text-[#4caf50]"}):f.jsx("span",{className:"text-[#00f3ff] font-bold text-sm",children:ee.charAt(0).toUpperCase()})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("h3",{className:"text-sm font-bold text-[#00f3ff] truncate",children:ee}),f.jsx("p",{className:"text-xs text-[#4caf50]/60",children:i?`${ne} members`:Q?"Online":"Last seen recently"})]})]}),f.jsx(X$,{messages:t,onSend:a,onFileUpload:l,onVoiceMessage:c,onReact:y,onEdit:b,onDelete:w,onStartTyping:v,onStopTyping:T,onViewThread:S,onViewTensorObject:M,getMessageById:P,typingUsers:r,highlightedMessageId:s,fileProgress:R,isVerifying:O})]}):f.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center bg-[#010401]/50",children:[f.jsx("div",{className:"w-24 h-24 rounded-full bg-[#4caf50]/10 border border-[#4caf50]/20 flex items-center justify-center mb-6",children:f.jsx(Pd,{className:"w-12 h-12 text-[#4caf50]/40"})}),f.jsx("h3",{className:"text-lg font-bold text-[#00f3ff] mb-2",children:"G3ZKP Messenger"}),f.jsx("p",{className:"text-sm text-[#4caf50]/60 text-center max-w-md",children:"Select a chat to start messaging with end-to-end encryption"})]})})]})}class jUe{constructor(){E(this,"inviteLinks",new Map);E(this,"eventHandlers",{});E(this,"localPeerId",null);this.loadInviteLinks()}setLocalPeerId(e){this.localPeerId=e}on(e,t){this.eventHandlers[e]=t}loadInviteLinks(){try{const e=localStorage.getItem("g3zkp_invite_links");e&&JSON.parse(e).forEach(i=>{this.isLinkValid(i)&&this.inviteLinks.set(i.code,i)})}catch(e){console.error("[GroupManagement] Failed to load invite links:",e)}}saveInviteLinks(){try{const e=Array.from(this.inviteLinks.values());localStorage.setItem("g3zkp_invite_links",JSON.stringify(e))}catch(e){console.error("[GroupManagement] Failed to save invite links:",e)}}isLinkValid(e){return!(!e.isActive||e.expiresAt&&Date.now()>e.expiresAt||e.maxUses&&e.uses>=e.maxUses)}generateInviteCode(){const e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let t="";for(let i=0;i<8;i++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}createInviteLink(e,t){const i=this.generateInviteCode(),r={code:i,groupId:e,createdBy:this.localPeerId||"unknown",createdAt:Date.now(),expiresAt:t?.expiresInHours?Date.now()+t.expiresInHours*60*60*1e3:null,maxUses:t?.maxUses||null,uses:0,isActive:!0};return this.inviteLinks.set(i,r),this.saveInviteLinks(),console.log("[GroupManagement] Created invite link:",i,"for group:",e),this.eventHandlers.onInviteLinkCreated?.(e,r),r}getInviteLink(e){const t=this.inviteLinks.get(e);return!t||!this.isLinkValid(t)?null:t}getGroupInviteLinks(e){return Array.from(this.inviteLinks.values()).filter(t=>t.groupId===e&&this.isLinkValid(t))}revokeInviteLink(e){const t=this.inviteLinks.get(e);return t?(t.isActive=!1,this.saveInviteLinks(),console.log("[GroupManagement] Revoked invite link:",e),!0):!1}useInviteLink(e){const t=this.inviteLinks.get(e);return t?this.isLinkValid(t)?(t.uses++,this.saveInviteLinks(),console.log("[GroupManagement] Used invite link:",e,"Uses:",t.uses),{success:!0,groupId:t.groupId}):{success:!1,error:"Invite link has expired or reached max uses"}:{success:!1,error:"Invalid invite code"}}async addMember(e,t){return e.members.some(i=>i.peerId===t.peerId)?{success:!1,error:"Member already in group"}:(e.members.push(t),e.memberCount=e.members.length,console.log("[GroupManagement] Added member:",t.peerId,"to group:",e.id),this.eventHandlers.onMemberJoined?.(e.id,t),{success:!0})}async removeMember(e,t,i="Left group"){const r=e.members.findIndex(o=>o.peerId===t);return r===-1?{success:!1,error:"Member not found in group"}:e.members[r].role===Jt.OWNER?{success:!1,error:"Cannot remove group owner"}:(e.members.splice(r,1),e.memberCount=e.members.length,console.log("[GroupManagement] Removed member:",t,"from group:",e.id),this.eventHandlers.onMemberLeft?.(e.id,t),{success:!0})}async kickMember(e,t,i,r){const s=e.members.find(l=>l.peerId===i);if(!s)return{success:!1,error:"Kicker not found in group"};const o=e.members.find(l=>l.peerId===t);if(!o)return{success:!1,error:"Target member not found"};if(!this.canKick(s.role,o.role))return{success:!1,error:"Insufficient permissions to kick this member"};const a=await this.removeMember(e,t,r);return a.success&&this.eventHandlers.onMemberKicked?.(e.id,t,r),a}async changeMemberRole(e,t,i,r){const s=e.members.find(a=>a.peerId===r);if(!s)return{success:!1,error:"Changer not found in group"};const o=e.members.find(a=>a.peerId===t);return o?this.canChangeRole(s.role,o.role,i)?(o.role=i,o.permissions=vd[i],console.log("[GroupManagement] Changed role of:",t,"to:",i,"in group:",e.id),this.eventHandlers.onMemberRoleChanged?.(e.id,t,i),{success:!0}):{success:!1,error:"Insufficient permissions to change role"}:{success:!1,error:"Target member not found"}}async updateGroupSettings(e,t,i){const r=e.members.find(s=>s.peerId===i);return r?r.role!==Jt.OWNER&&r.role!==Jt.ADMIN?{success:!1,error:"Only admins and owners can change settings"}:(e.settings={...e.settings,...t},console.log("[GroupManagement] Updated settings for group:",e.id),this.eventHandlers.onSettingsChanged?.(e.id,e.settings),{success:!0}):{success:!1,error:"User not found in group"}}async handleJoinRequest(e,t,i,r){const s=e.members.find(l=>l.peerId===r);if(!s)return{success:!1,error:"Handler not found in group"};if(s.role!==Jt.OWNER&&s.role!==Jt.ADMIN&&s.role!==Jt.MODERATOR)return{success:!1,error:"Only admins, moderators, and owners can handle join requests"};const o=e.pendingRequests?.findIndex(l=>l.id===t);if(o===void 0||o===-1)return{success:!1,error:"Join request not found"};const a=e.pendingRequests[o];if(a.status=i?Pm.APPROVED:Pm.REJECTED,a.reviewedBy=r,a.reviewedAt=Date.now(),i){const l={id:crypto.randomUUID(),peerId:a.requesterId,displayName:a.requesterName||`NODE_${a.requesterId.substring(0,8)}`,role:Jt.MEMBER,joinedAt:Date.now(),lastSeenAt:Date.now(),permissions:vd[Jt.MEMBER],isMuted:!1,publicKey:a.requesterPublicKey,isOnline:!0};await this.addMember(e,l)}return console.log("[GroupManagement] Handled join request:",t,"Approved:",i),{success:!0}}canKick(e,t){const i={[Jt.OWNER]:5,[Jt.ADMIN]:4,[Jt.MODERATOR]:3,[Jt.MEMBER]:2,[Jt.PENDING]:1,[Jt.BANNED]:0};return i[e]>i[t]}canChangeRole(e,t,i){const r={[Jt.OWNER]:5,[Jt.ADMIN]:4,[Jt.MODERATOR]:3,[Jt.MEMBER]:2,[Jt.PENDING]:1,[Jt.BANNED]:0};return e===Jt.OWNER?!0:e===Jt.ADMIN?r[t]<4&&r[i]<4:!1}getDefaultSettings(){return{...tte}}getDefaultPermissions(e){return{...vd[e]}}formatInviteUrl(e){return`${typeof window<"u"?window.location.origin:"https://g3zkp.app"}/join/${e}`}}const fd=new jUe,VUe={[Jt.OWNER]:f.jsx(bK,{className:"w-4 h-4 text-yellow-500"}),[Jt.ADMIN]:f.jsx(ao,{className:"w-4 h-4 text-[#00f3ff]"}),[Jt.MODERATOR]:f.jsx(ao,{className:"w-4 h-4 text-[#4caf50]"}),[Jt.MEMBER]:f.jsx(As,{className:"w-4 h-4 text-gray-500"}),[Jt.PENDING]:f.jsx(z0,{className:"w-4 h-4 text-yellow-400"}),[Jt.BANNED]:f.jsx(Ui,{className:"w-4 h-4 text-red-500"})},HUe={[Jt.OWNER]:"Owner",[Jt.ADMIN]:"Admin",[Jt.MODERATOR]:"Mod",[Jt.MEMBER]:"Member",[Jt.PENDING]:"Pending",[Jt.BANNED]:"Banned"};function $Ue({group:n,currentUserId:e,onClose:t,onUpdateGroup:i,onKickMember:r,onChangeMemberRole:s,onUpdateSettings:o,onHandleJoinRequest:a}){const[l,c]=$.useState("members"),[u,h]=$.useState(null),[p,m]=$.useState(""),[y,b]=$.useState(!1),[w,v]=$.useState(null),[T,S]=$.useState({expiresInHours:24,maxUses:0}),[M,P]=$.useState(fd.getGroupInviteLinks(n.id)),[R,O]=$.useState(["general"]),B=$.useMemo(()=>n.members.find(ee=>ee.peerId===e)?.role||Jt.MEMBER,[n.members,e]),N=B===Jt.OWNER||B===Jt.ADMIN,I=B===Jt.OWNER,F=n.pendingRequests?.filter(G=>G.status==="pending")||[],j=$.useCallback(()=>{const G=fd.createInviteLink(n.id,{expiresInHours:T.expiresInHours>0?T.expiresInHours:void 0,maxUses:T.maxUses>0?T.maxUses:void 0});P(ee=>[...ee,G])},[n.id,T]),W=$.useCallback(G=>{const ee=fd.formatInviteUrl(G);navigator.clipboard.writeText(ee),v(G),setTimeout(()=>v(null),2e3)},[]),U=$.useCallback(G=>{fd.revokeInviteLink(G),P(ee=>ee.filter(Q=>Q.code!==G))},[]),H=$.useCallback(()=>{u&&(r(u,p||"Removed by admin"),b(!1),h(null),m(""))},[u,p,r]),q=$.useCallback(G=>{O(ee=>ee.includes(G)?ee.filter(Q=>Q!==G):[...ee,G])},[]),J=$.useCallback(G=>B===Jt.OWNER?G!==Jt.OWNER:B===Jt.ADMIN?G===Jt.MEMBER||G===Jt.MODERATOR:!1,[B]);return f.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4",children:f.jsxs("div",{className:"bg-[#010401] border border-[#4caf50]/40 w-full max-w-2xl max-h-[90vh] flex flex-col overflow-hidden",children:[f.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-[#4caf50]/20 bg-black/60",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center",children:f.jsx("span",{className:"text-[#4caf50] font-bold",children:n.name.substring(0,2).toUpperCase()})}),f.jsxs("div",{children:[f.jsx("h2",{className:"text-sm font-bold text-[#00f3ff]",children:n.name}),f.jsxs("p",{className:"text-xs text-[#4caf50]/60",children:[n.memberCount," members"]})]})]}),f.jsx("button",{onClick:t,className:"text-[#4caf50] hover:text-[#00f3ff] transition-colors",children:f.jsx(Ui,{className:"w-5 h-5"})})]}),f.jsx("div",{className:"flex border-b border-[#4caf50]/20 bg-black/40",children:["members","requests","settings","invites"].map(G=>f.jsxs("button",{onClick:()=>c(G),className:`flex-1 py-3 text-xs font-bold uppercase tracking-wide transition-colors relative ${l===G?"text-[#00f3ff] bg-[#00f3ff]/10":"text-[#4caf50]/60 hover:text-[#4caf50]"}`,children:[G,G==="requests"&&F.length>0&&f.jsx("span",{className:"absolute top-2 right-2 w-5 h-5 bg-[#00f3ff] text-black text-[10px] font-bold rounded-full flex items-center justify-center",children:F.length}),l===G&&f.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-[#00f3ff]"})]},G))}),f.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[l==="members"&&f.jsx("div",{className:"space-y-2",children:n.members.map(G=>f.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-colors ${u===G.peerId?"border-[#00f3ff]/40 bg-[#00f3ff]/10":"border-[#4caf50]/20 bg-black/40 hover:border-[#4caf50]/40"}`,onClick:()=>J(G.role)&&h(u===G.peerId?null:G.peerId),children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center",children:G.avatar?f.jsx("img",{src:G.avatar,alt:"",className:"w-full h-full rounded-full object-cover"}):f.jsx("span",{className:"text-[#00f3ff] font-bold text-sm",children:(G.displayName||"U").charAt(0).toUpperCase()})}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx("span",{className:"text-sm font-semibold text-[#00f3ff] truncate",children:G.displayName||`Peer ${G.peerId.substring(0,8)}`}),VUe[G.role]]}),f.jsxs("div",{className:"flex items-center gap-2 text-xs text-[#4caf50]/60",children:[f.jsx("span",{children:HUe[G.role]}),f.jsx("span",{className:`w-2 h-2 rounded-full ${G.isOnline?"bg-green-500":"bg-gray-500"}`})]})]}),J(G.role)&&u===G.peerId&&f.jsxs("div",{className:"flex gap-2",children:[N&&f.jsxs("select",{value:G.role,onChange:ee=>s(G.peerId,ee.target.value),onClick:ee=>ee.stopPropagation(),className:"bg-black border border-[#4caf50]/30 text-[#00f3ff] text-xs px-2 py-1 rounded",children:[f.jsx("option",{value:Jt.MEMBER,children:"Member"}),f.jsx("option",{value:Jt.MODERATOR,children:"Moderator"}),I&&f.jsx("option",{value:Jt.ADMIN,children:"Admin"})]}),f.jsx("button",{onClick:ee=>{ee.stopPropagation(),b(!0)},className:"p-2 text-red-500 hover:bg-red-500/20 rounded transition-colors",children:f.jsx(NK,{className:"w-4 h-4"})})]})]},G.peerId))}),l==="requests"&&f.jsx("div",{className:"space-y-3",children:F.length===0?f.jsxs("div",{className:"text-center py-12 text-[#4caf50]/60",children:[f.jsx(sh,{className:"w-12 h-12 mx-auto mb-4 opacity-40"}),f.jsx("p",{className:"text-sm",children:"No pending join requests"})]}):F.map(G=>f.jsxs("div",{className:"p-4 border border-[#4caf50]/20 bg-black/40 rounded-lg",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[f.jsx("div",{className:"w-10 h-10 rounded-full bg-[#4caf50]/20 border border-[#4caf50]/40 flex items-center justify-center",children:f.jsx("span",{className:"text-[#00f3ff] font-bold text-sm",children:(G.requesterName||"U").charAt(0).toUpperCase()})}),f.jsxs("div",{className:"flex-1",children:[f.jsx("p",{className:"text-sm font-semibold text-[#00f3ff]",children:G.requesterName||`Peer ${G.requesterId.substring(0,8)}`}),f.jsxs("p",{className:"text-xs text-[#4caf50]/60 flex items-center gap-1",children:[f.jsx(z0,{className:"w-3 h-3"}),new Date(G.createdAt).toLocaleString()]})]})]}),G.requestMessage&&f.jsxs("p",{className:"text-xs text-[#4caf50]/80 mb-3 p-2 bg-black/40 rounded border border-[#4caf50]/10",children:['"',G.requestMessage,'"']}),f.jsxs("div",{className:"flex gap-2",children:[f.jsx("button",{onClick:()=>a(G.id,!0),className:"flex-1 py-2 bg-[#4caf50]/20 border border-[#4caf50]/40 text-[#4caf50] text-xs font-bold uppercase tracking-wide hover:bg-[#4caf50]/30 transition-colors rounded",children:"Approve"}),f.jsx("button",{onClick:()=>a(G.id,!1),className:"flex-1 py-2 bg-red-500/20 border border-red-500/40 text-red-400 text-xs font-bold uppercase tracking-wide hover:bg-red-500/30 transition-colors rounded",children:"Reject"})]})]},G.id))}),l==="settings"&&f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"border border-[#4caf50]/20 rounded-lg overflow-hidden",children:[f.jsxs("button",{onClick:()=>q("general"),className:"w-full flex items-center justify-between p-4 bg-black/40 hover:bg-black/60 transition-colors",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(c7,{className:"w-5 h-5 text-[#00f3ff]"}),f.jsx("span",{className:"text-sm font-bold text-[#00f3ff]",children:"General"})]}),R.includes("general")?f.jsx(Hm,{className:"w-4 h-4 text-[#4caf50]"}):f.jsx(wy,{className:"w-4 h-4 text-[#4caf50]"})]}),R.includes("general")&&f.jsx("div",{className:"p-4 space-y-4 border-t border-[#4caf50]/10",children:f.jsxs("div",{className:"flex items-center justify-between",children:[f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-[#00f3ff]",children:"Private Group"}),f.jsx("p",{className:"text-xs text-[#4caf50]/60",children:"Require approval to join"})]}),f.jsx("button",{onClick:()=>o({requireApproval:!n.settings?.requireApproval}),className:`w-12 h-6 rounded-full transition-colors relative ${n.settings?.requireApproval?"bg-[#00f3ff]":"bg-[#4caf50]/30"}`,children:f.jsx("div",{className:`absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${n.settings?.requireApproval?"left-7":"left-1"}`})})]})})]}),f.jsxs("div",{className:"border border-[#4caf50]/20 rounded-lg overflow-hidden",children:[f.jsxs("button",{onClick:()=>q("permissions"),className:"w-full flex items-center justify-between p-4 bg-black/40 hover:bg-black/60 transition-colors",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(j0,{className:"w-5 h-5 text-[#00f3ff]"}),f.jsx("span",{className:"text-sm font-bold text-[#00f3ff]",children:"Permissions"})]}),R.includes("permissions")?f.jsx(Hm,{className:"w-4 h-4 text-[#4caf50]"}):f.jsx(wy,{className:"w-4 h-4 text-[#4caf50]"})]}),R.includes("permissions")&&f.jsx("div",{className:"p-4 space-y-3 border-t border-[#4caf50]/10",children:[{key:"allowFileSharing",label:"Share Media",desc:"Members can share files/images",icon:J3},{key:"allowVoiceCalls",label:"Voice Calls",desc:"Members can start voice calls",icon:p2},{key:"allowVideoCalls",label:"Video Calls",desc:"Members can start video calls",icon:wK}].map(G=>f.jsxs("div",{className:"flex items-center justify-between py-2",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx(G.icon,{className:"w-4 h-4 text-[#4caf50]/60"}),f.jsxs("div",{children:[f.jsx("p",{className:"text-sm text-[#00f3ff]",children:G.label}),f.jsx("p",{className:"text-xs text-[#4caf50]/60",children:G.desc})]})]}),f.jsx("button",{onClick:()=>o({[G.key]:!n.settings?.[G.key]}),className:`w-10 h-5 rounded-full transition-colors relative ${n.settings?.[G.key]!==!1?"bg-[#4caf50]":"bg-[#4caf50]/30"}`,children:f.jsx("div",{className:`absolute top-0.5 w-4 h-4 bg-white rounded-full transition-all ${n.settings?.[G.key]!==!1?"left-5":"left-0.5"}`})})]},G.key))})]})]}),l==="invites"&&f.jsxs("div",{className:"space-y-4",children:[f.jsxs("div",{className:"p-4 border border-[#4caf50]/20 bg-black/40 rounded-lg",children:[f.jsx("h3",{className:"text-sm font-bold text-[#00f3ff] mb-4",children:"Create Invite Link"}),f.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-[#4caf50]/60 block mb-1",children:"Expires After"}),f.jsxs("select",{value:T.expiresInHours,onChange:G=>S(ee=>({...ee,expiresInHours:Number(G.target.value)})),className:"w-full bg-black border border-[#4caf50]/30 text-[#00f3ff] text-sm px-3 py-2 rounded",children:[f.jsx("option",{value:"0",children:"Never"}),f.jsx("option",{value:"1",children:"1 hour"}),f.jsx("option",{value:"24",children:"24 hours"}),f.jsx("option",{value:"168",children:"7 days"}),f.jsx("option",{value:"720",children:"30 days"})]})]}),f.jsxs("div",{children:[f.jsx("label",{className:"text-xs text-[#4caf50]/60 block mb-1",children:"Max Uses"}),f.jsxs("select",{value:T.maxUses,onChange:G=>S(ee=>({...ee,maxUses:Number(G.target.value)})),className:"w-full bg-black border border-[#4caf50]/30 text-[#00f3ff] text-sm px-3 py-2 rounded",children:[f.jsx("option",{value:"0",children:"No limit"}),f.jsx("option",{value:"1",children:"1 use"}),f.jsx("option",{value:"5",children:"5 uses"}),f.jsx("option",{value:"10",children:"10 uses"}),f.jsx("option",{value:"25",children:"25 uses"}),f.jsx("option",{value:"100",children:"100 uses"})]})]})]}),f.jsxs("button",{onClick:j,className:"w-full py-2.5 bg-[#00f3ff]/20 border border-[#00f3ff]/40 text-[#00f3ff] text-sm font-bold uppercase tracking-wide hover:bg-[#00f3ff]/30 transition-colors rounded flex items-center justify-center gap-2",children:[f.jsx(Rae,{className:"w-4 h-4"}),"Generate Link"]})]}),f.jsxs("div",{className:"space-y-2",children:[f.jsx("h3",{className:"text-xs font-bold text-[#4caf50]/60 uppercase tracking-wide",children:"Active Links"}),M.length===0?f.jsx("p",{className:"text-center py-8 text-[#4caf50]/60 text-sm",children:"No active invite links"}):M.map(G=>f.jsxs("div",{className:"flex items-center gap-3 p-3 border border-[#4caf50]/20 bg-black/40 rounded-lg",children:[f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsx("p",{className:"text-sm font-mono text-[#00f3ff] truncate",children:fd.formatInviteUrl(G.code)}),f.jsxs("p",{className:"text-xs text-[#4caf50]/60",children:[G.uses," uses",G.maxUses&&` / ${G.maxUses} max`,G.expiresAt&&`  Expires ${new Date(G.expiresAt).toLocaleDateString()}`]})]}),f.jsx("button",{onClick:()=>W(G.code),className:"p-2 text-[#4caf50] hover:text-[#00f3ff] transition-colors",children:w===G.code?f.jsx(f2,{className:"w-4 h-4"}):f.jsx(XP,{className:"w-4 h-4"})}),f.jsx("button",{onClick:()=>U(G.code),className:"p-2 text-red-500 hover:bg-red-500/20 rounded transition-colors",children:f.jsx(Ui,{className:"w-4 h-4"})})]},G.code))]})]})]}),y&&u&&f.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80 backdrop-blur-sm",children:f.jsxs("div",{className:"bg-[#010401] border border-red-500/40 p-6 rounded-lg max-w-sm w-full mx-4",children:[f.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[f.jsx(T0,{className:"w-6 h-6 text-red-500"}),f.jsx("h3",{className:"text-lg font-bold text-red-400",children:"Remove Member"})]}),f.jsx("p",{className:"text-sm text-[#4caf50]/80 mb-4",children:"Are you sure you want to remove this member from the group?"}),f.jsx("input",{type:"text",placeholder:"Reason (optional)",value:p,onChange:G=>m(G.target.value),className:"w-full bg-black border border-[#4caf50]/30 text-[#00f3ff] text-sm px-3 py-2 rounded mb-4"}),f.jsxs("div",{className:"flex gap-3",children:[f.jsx("button",{onClick:()=>{b(!1),h(null),m("")},className:"flex-1 py-2 border border-[#4caf50]/30 text-[#4caf50] text-sm font-bold uppercase tracking-wide hover:bg-[#4caf50]/10 transition-colors rounded",children:"Cancel"}),f.jsx("button",{onClick:H,className:"flex-1 py-2 bg-red-500/20 border border-red-500/40 text-red-400 text-sm font-bold uppercase tracking-wide hover:bg-red-500/30 transition-colors rounded",children:"Remove"})]})]})})]})})}const NM=({size:n=200,color:e="currentColor",rotorSpeed:t="40s"})=>{const i=n/6,r=n/2,s=n/2,o=[0,60,120,180,240,300];return f.jsxs("div",{className:"rotorse-container relative flex items-center justify-center",style:{width:n,height:n},children:[f.jsx("div",{className:"absolute inset-0 animate-[rotorse-alpha_var(--speed)_linear_infinite]",style:{"--speed":t},children:f.jsxs("svg",{viewBox:`0 0 ${n} ${n}`,className:"w-full h-full opacity-80",children:[f.jsx("circle",{cx:r,cy:s,r:i,fill:"none",stroke:e,strokeWidth:"0.5"}),o.map(a=>{const l=r+i*Math.cos(a*Math.PI/180),c=s+i*Math.sin(a*Math.PI/180);return f.jsxs(Fa.Fragment,{children:[f.jsx("circle",{cx:l,cy:c,r:i,fill:"none",stroke:e,strokeWidth:"0.5"}),o.map(u=>{const h=l+i*Math.cos(u*Math.PI/180),p=c+i*Math.sin(u*Math.PI/180);return f.jsx("circle",{cx:h,cy:p,r:i,fill:"none",stroke:e,strokeWidth:"0.2",opacity:"0.6"},`${a}-${u}`)})]},a)}),f.jsx("circle",{cx:r,cy:s,r:i*3,fill:"none",stroke:e,strokeWidth:"0.5",strokeDasharray:"10 5",opacity:"0.2"})]})}),f.jsx("div",{className:"absolute inset-0 animate-[rotorse-beta_60s_linear_infinite] scale-75 opacity-50",children:f.jsx("svg",{viewBox:`0 0 ${n} ${n}`,className:"w-full h-full",children:f.jsx("circle",{cx:r,cy:s,r:i*2,fill:"none",stroke:e,strokeWidth:"0.2",strokeDasharray:"4 8"})})}),f.jsx("div",{className:"absolute w-4 h-4 bg-white/40 rounded-full blur-sm animate-pulse"})]})},GUe=()=>{const[n,e]=$.useState(zg.INITIALIZING),[t,i]=$.useState("geodesic"),[r,s]=$.useState("none"),[o,a]=$.useState(!1),[l,c]=$.useState([]),[u,h]=$.useState([]),[p,m]=$.useState(null),[y,b]=$.useState(!1),[w,v]=$.useState(!1),[T,S]=$.useState(!1),[M,P]=$.useState([]),[R,O]=$.useState(null),{profile:B,updateProfile:N,updateSettings:I,initializeProfile:F,isInitialized:j}=Bte(),W=B||{id:"local_user",peerId:"12D3KooW"+Array(12).fill(0).map(()=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(Math.random()*62)]).join(""),displayName:"LOCAL_OPERATOR",publicKey:"0x"+Array(64).fill(0).map(()=>Math.floor(Math.random()*16).toString(16)).join(""),status:ud.ONLINE,statusMessage:"Synchronizing geodesic paths...",createdAt:Date.now()-30*24*60*60*1e3,lastSeenAt:Date.now(),isVerified:!0,bio:"G3ZKP mesh network operator. Specializing in tautological verification protocols.",settings:nte};$.useEffect(()=>{if(!j&&!B){const ae="12D3KooW"+Array(12).fill(0).map(()=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(Math.random()*62)]).join(""),be="0x"+Array(64).fill(0).map(()=>Math.floor(Math.random()*16).toString(16)).join("");F(ae,be)}},[j,B,F]);const[U,H]=$.useState({valid:!0,expiresAt:Date.now()+1e3*60*60*24*30,expiresInDays:30,accumulatedValue:13.5}),[q,J]=$.useState(0),[G,ee]=$.useState([]),[Q,ne]=$.useState(!1),[fe,Ae]=$.useState(!1),[Pe,Ce]=$.useState(null),[de,Ne]=$.useState(null),[et,me]=$.useState([{id:"welcome-1",type:WS.INFO,title:"Welcome to G3ZKP Messenger",message:"Your connection is secured with zero-knowledge proofs and end-to-end encryption.",timestamp:Date.now()-6e4,read:!1},{id:"security-1",type:WS.SECURITY,title:"Encryption Active",message:"All messages are encrypted with X3DH key exchange and Double Ratchet protocol.",timestamp:Date.now()-12e4,read:!1}]),[nt,Pt]=$.useState(xUe),[zt,Dt]=$.useState(!1),[gt,vt]=$.useState([]),{playSound:Oe,showDesktopNotification:xt,shouldNotify:pe}=wUe(nt),qe=et.filter(ae=>!ae.read).length,{isInitialized:$e,initializationProgress:Xe,statusMessage:Ye,messages:oe,sendMessage:Z,sendMediaMessage:he,connectedPeers:Ge,localPeerId:ct}=g9e();$.useEffect(()=>{fD.getState().applyTheme()},[]),$.useEffect(()=>(()=>{if(!navigator.geolocation){console.warn("[Location] Geolocation not supported");return}console.log("[Location] Requesting high-accuracy geolocation..."),navigator.geolocation.getCurrentPosition(We=>{const st=[We.coords.longitude,We.coords.latitude];console.log("[Location] Got position:",st,"Accuracy:",We.coords.accuracy,"m"),ge(st)},We=>{console.error("[Location] Geolocation error:",We.message)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:0});const Ue=navigator.geolocation.watchPosition(We=>{const st=[We.coords.longitude,We.coords.latitude];ge(st),We.coords.heading!==null&&on(We.coords.heading)},We=>{console.warn("[Location] Watch position error:",We.message)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:5e3});return()=>{navigator.geolocation.clearWatch(Ue)}})(),[]),$.useEffect(()=>{$e&&e(zg.NETWORK_MAP)},[$e]),$.useEffect(()=>{if(!Q)return;const ae=setTimeout(()=>{ne(!1),ee(be=>be.filter(Ue=>Ue.peerId!==W.peerId))},3e3);return()=>clearTimeout(ae)},[Q,W.peerId]),$.useEffect(()=>{const ae=be=>{(be.metaKey||be.ctrlKey)&&be.key==="k"&&(be.preventDefault(),Ae(Ue=>!Ue)),be.key==="Escape"&&fe&&Ae(!1)};return window.addEventListener("keydown",ae),()=>window.removeEventListener("keydown",ae)},[fe]);const tt=$.useCallback(ae=>{const be={id:`group_${Date.now()}`,name:ae,description:"New mesh group for secure communications",createdAt:Date.now(),createdBy:W.id,updatedAt:Date.now(),memberCount:1,members:[{id:W.id,peerId:W.peerId,displayName:W.displayName,role:Jt.OWNER,joinedAt:Date.now(),lastSeenAt:Date.now(),permissions:vd[Jt.OWNER],isMuted:!1,publicKey:W.publicKey,isOnline:!0}],pendingRequests:[],settings:tte,pinnedMessages:[],isPrivate:!0,requiresApproval:!0,lastActivity:Date.now(),unreadCount:0,zkpVerified:!0,encryptionEnabled:!0};h(Ue=>[be,...Ue]),s("none"),e(zg.CRYPTO_VERIFICATION),setTimeout(()=>e(zg.NETWORK_MAP),3e3)},[W]),Lt=$.useCallback(ae=>{h(be=>be.map(Ue=>{const We=Ue.pendingRequests.find(_t=>_t.id===ae);if(!We)return Ue;const st={id:We.requesterId,peerId:`12D3KooW${Math.random().toString(36).substring(2,8).toUpperCase()}`,displayName:We.requesterName,role:Jt.MEMBER,joinedAt:Date.now(),lastSeenAt:Date.now(),permissions:vd[Jt.MEMBER],isMuted:!1,publicKey:We.requesterPublicKey,isOnline:!0};return{...Ue,members:[...Ue.members,st],memberCount:Ue.memberCount+1,pendingRequests:Ue.pendingRequests.map(_t=>_t.id===ae?{..._t,status:Pm.APPROVED,reviewedAt:Date.now(),reviewedBy:W.id}:_t)}}))},[W.id]),Ct=$.useCallback((ae,be)=>{h(Ue=>Ue.map(We=>({...We,pendingRequests:We.pendingRequests.map(st=>st.id===ae?{...st,status:Pm.REJECTED,reviewedAt:Date.now(),reviewedBy:W.id,rejectionReason:be}:st)})))},[W.id]),Ot=$.useCallback(ae=>{p&&h(be=>be.map(Ue=>Ue.id===p.id?{...Ue,members:Ue.members.filter(We=>We.id!==ae),memberCount:Ue.memberCount-1}:Ue))},[p]),nn=$.useCallback(ae=>{p&&h(be=>be.map(Ue=>Ue.id===p.id?{...Ue,members:Ue.members.map(We=>We.id===ae?{...We,role:Jt.BANNED,permissions:vd[Jt.BANNED]}:We)}:Ue))},[p]),Tt=$.useCallback((ae,be)=>{p&&h(Ue=>Ue.map(We=>We.id===p.id?{...We,members:We.members.map(st=>st.id===ae?{...st,role:be,permissions:vd[be]}:st)}:We))},[p]),Ve=$.useCallback((ae,be)=>{p&&h(Ue=>Ue.map(We=>We.id===p.id?{...We,members:We.members.map(st=>st.id===ae?{...st,isMuted:!st.isMuted,mutedUntil:be?Date.now()+be:void 0}:st)}:We))},[p]),ut=$.useCallback(ae=>{p&&h(be=>be.map(Ue=>Ue.id===p.id?{...Ue,settings:{...Ue.settings,...ae}}:Ue))},[p]),ue=$.useCallback(()=>{p&&(h(ae=>ae.map(be=>be.id===p.id?{...be,members:be.members.filter(Ue=>Ue.id!==W.id),memberCount:be.memberCount-1}:be)),b(!1),m(null))},[p,W.id]),Ie=$.useCallback(async(ae,be)=>{await new Promise(We=>setTimeout(We,1500));const Ue={id:`notif_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:WS.GROUP_INVITE,title:"Join Request Sent",message:"Your request has been sent to the group admins",groupId:ae,timestamp:Date.now(),read:!1};me(We=>[Ue,...We]),vt(We=>[...We,Ue])},[]),[ft,xe]=$.useState(null),[pt,ge]=$.useState(null),[Qe,ht]=$.useState(null),[at,yt]=$.useState(!1),[Gt,on]=$.useState(0),[mn,Cn]=$.useState(!1),[gi,$r]=$.useState(!1);$.useState("car");const[Il,X]=$.useState(!1),se=$.useCallback(async(ae,be=!1)=>{J(10);try{const Ue=await Bg.uploadMultipleFiles(ae,"LOCAL_OPERATOR");if(J(50),be){if(ae.filter(st=>st.type.startsWith("image/")||st.type.startsWith("video/")).length>0){const st=[];for(const _t of Ue)if(Bg.isImage(_t.metadata.mimeType)||Bg.isVideo(_t.metadata.mimeType)){const ce=Bg.isVideo(_t.metadata.mimeType),Bt=ce?document.createElement("video"):new Image;Bt.crossOrigin="anonymous",Bt.src=_t.url,await new Promise(Nt=>{ce?(Bt.onloadeddata=()=>Nt(),Bt.load()):Bt.onload=()=>Nt(),setTimeout(Nt,3e3)}),st.push({element:Bt,url:_t.url,name:_t.metadata.originalName,type:ce?"video":"image"})}if(J(70),st.length>0){const _t=await gUe.convertToTensor3DObject(st,{generations:3,sacredGeometryScale:1,tensorResolution:64});J(90);const ce={objectUrl:st[0].url,dimensions:_t.dimensions,vertices:_t.vertices,tensorField:{pixelCount:_t.tensorField.pixels.length,resolution:_t.metadata.tensorResolution,phiValue:_t.metadata.phiValue,piValue:_t.metadata.piValue},flowerOfLife:{generations:_t.metadata.generations,rayCount:_t.metadata.rayCount,sacredGeometryScale:_t.metadata.sacredGeometryScale},originalFiles:Ue.map(Nt=>({fileId:Nt.fileId,fileName:Nt.metadata.originalName,url:Nt.url,mimeType:Nt.metadata.mimeType,size:Nt.metadata.size})),thumbnailDataUrl:_t.thumbnailDataUrl,createdAt:Date.now()},Bt={id:Math.random().toString(36).substr(2,9),sender:"LOCAL_OPERATOR",content:`3D_TENSOR_OBJECT_CREATED: ${ae.length} file${ae.length>1?"s":""} via FLOWER_OF_LIFE_PHI`,timestamp:Date.now(),status:"sent",type:"3d-object",isZkpVerified:!0,isMe:!0,tensorData:ce,fileName:ae.map(Nt=>Nt.name).join(", "),mediaType:ae[0].type};c(Nt=>[...Nt,Bt])}}}else for(const We of Ue){const st=ae.find(Nt=>Nt.name===We.metadata.originalName)||ae[0],_t=Bg.isImage(We.metadata.mimeType),ce=Bg.isVideo(We.metadata.mimeType),Bt={id:Math.random().toString(36).substr(2,9),sender:"LOCAL_OPERATOR",content:`ISO_FILE_TRANSMITTED: ${We.metadata.originalName} [AES-GCM-256]`,timestamp:Date.now(),status:"sent",type:_t?"image":ce?"video":"file",isZkpVerified:!0,isMe:!0,fileName:We.metadata.originalName,fileSize:We.metadata.size,mediaUrl:We.url,mediaType:We.metadata.mimeType};c(Nt=>[...Nt,Bt])}J(100),setTimeout(()=>J(0),500)}catch(Ue){console.error("File upload error:",Ue),J(0)}},[]),te=$.useCallback(ae=>{xe(ae)},[]),z=$.useCallback(ae=>{ge(ae)},[]),le=$.useCallback(async ae=>{if(pt)try{const be=await rc.calculateRoute([pt,ae],"car",3);be.length>0&&ht(be[0])}catch(be){console.error("Failed to calculate route:",be)}},[pt]),je=$.useCallback(ae=>{ht(ae)},[]),Ke=$.useCallback(()=>{Qe&&yt(!0)},[Qe]),St=$.useCallback(async()=>{if(pt&&Qe){const ae=Qe.geometry.coordinates[Qe.geometry.coordinates.length-1];try{const be=await rc.calculateRoute([pt,ae],"car",1);be.length>0&&ht(be[0])}catch(be){console.error("Failed to reroute:",be)}}},[pt,Qe]),It=$.useCallback(async(ae,be)=>{a(!0);const Ue={id:Math.random().toString(36).substr(2,9),sender:"LOCAL_OPERATOR",content:ae,timestamp:Date.now(),status:"sent",type:"text",isZkpVerified:!0,isMe:!0,replyTo:be,reactions:[]};be&&c(We=>We.map(st=>st.id===be?{...st,threadCount:(st.threadCount||0)+1}:st)),await new Promise(We=>setTimeout(We,2200)),c(We=>[...We,Ue]),H(We=>({...We,accumulatedValue:Math.min(30,We.accumulatedValue+.5)})),a(!1)},[]),Yt=$.useCallback(async(ae,be,Ue)=>{try{const We=new FileReader,_t=await new Promise(hn=>{We.onloadend=()=>hn(We.result),We.readAsDataURL(ae)}),ce=await fetch("/api/voice/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:_t,duration:be,waveformData:Ue,senderId:"LOCAL_OPERATOR",mimeType:ae.type})});if(!ce.ok)throw new Error("Voice upload failed");const Bt=await ce.json(),Nt={id:Math.random().toString(36).substr(2,9),sender:"LOCAL_OPERATOR",content:`Voice message (${Math.round(be)}s)`,timestamp:Date.now(),status:"sent",type:"voice",isZkpVerified:!0,isMe:!0,voiceData:{url:Bt.url,duration:be,waveform:Ue}};c(hn=>[...hn,Nt])}catch(We){console.error("Voice message error:",We)}},[]),Ht=$.useCallback((ae,be)=>{c(Ue=>Ue.map(We=>{if(We.id!==ae)return We;const st=We.reactions||[],_t=st.find(ce=>ce.emoji===be);return _t?_t.includesMe?_t.count===1?{...We,reactions:st.filter(ce=>ce.emoji!==be)}:{...We,reactions:st.map(ce=>ce.emoji===be?{...ce,count:ce.count-1,includesMe:!1,users:ce.users.filter(Bt=>Bt!=="LOCAL_OPERATOR")}:ce)}:{...We,reactions:st.map(ce=>ce.emoji===be?{...ce,count:ce.count+1,includesMe:!0,users:[...ce.users,"LOCAL_OPERATOR"]}:ce)}:{...We,reactions:[...st,{emoji:be,count:1,users:["LOCAL_OPERATOR"],includesMe:!0}]}}))},[]),$n=$.useCallback((ae,be)=>{c(Ue=>Ue.map(We=>We.id===ae?{...We,content:be,editedAt:Date.now()}:We))},[]),Kt=$.useCallback(ae=>{c(be=>be.map(Ue=>Ue.id===ae?{...Ue,deletedAt:Date.now()}:Ue))},[]),Sn=$.useCallback(ae=>l.find(be=>be.id===ae),[l]),Mn=$.useCallback(()=>{ne(!0);const ae={peerId:W.peerId,displayName:W.displayName,startedAt:Date.now()};ee(be=>[...be.filter(We=>We.peerId!==W.peerId),ae])},[W.peerId,W.displayName]),kn=$.useCallback(()=>{ne(!1),ee(ae=>ae.filter(be=>be.peerId!==W.peerId))},[W.peerId]),Ln=$.useCallback(ae=>{console.log("View thread for message:",ae)},[]);$.useCallback(ae=>{const be={...ae,id:`notif-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,timestamp:Date.now(),read:!1};me(Ue=>[be,...Ue]),pe()&&(vt(Ue=>[...Ue,be]),Oe(),nt.showPreview?xt(ae.title,ae.message):xt(ae.title,"New notification"))},[pe,Oe,xt,nt.showPreview]);const vn=$.useCallback(ae=>{vt(be=>be.filter(Ue=>Ue.id!==ae))},[]),bn=$.useCallback(ae=>{me(be=>be.map(Ue=>Ue.id===ae?{...Ue,read:!0}:Ue)),vt(be=>be.filter(Ue=>Ue.id!==ae))},[]),ie=$.useCallback(()=>{me(ae=>ae.map(be=>({...be,read:!0}))),vt([])},[]),_e=$.useCallback(ae=>{me(be=>be.filter(Ue=>Ue.id!==ae)),vt(be=>be.filter(Ue=>Ue.id!==ae))},[]),ke=$.useCallback(()=>{me([]),vt([])},[]),Re=$.useCallback(ae=>{if(bn(ae.id),Dt(!1),ae.groupId){const be=u.find(Ue=>Ue.id===ae.groupId);be&&(setActiveGroup(be),i("mesh"))}},[bn,u]),Te=$.useCallback(ae=>{console.log("[OperatorStore] Profile update:",ae),N(ae)},[N]),it=$.useCallback(ae=>{console.log("[OperatorStore] Settings update:",ae),I(ae)},[I]),rt=$.useCallback(ae=>{if(Ae(!1),ae.type==="message"&&ae.messageId)i("mesh"),Ce(ae.messageId),setTimeout(()=>Ce(null),3e3);else if(ae.type==="group"&&ae.groupId){const be=u.find(Ue=>Ue.id===ae.groupId);be&&(setActiveGroup(be),i("mesh"),b(!0))}else if(ae.type==="operator"&&ae.senderId){const Ue=u.flatMap(We=>We.members).find(We=>We.peerId===ae.senderId||We.displayName===ae.senderId);Ue?Ne(Ue):S(!0)}else ae.type==="file"&&ae.messageId&&(i("mesh"),Ce(ae.messageId),setTimeout(()=>Ce(null),3e3))},[u]),we=u.flatMap(ae=>ae.members),Ee=u.reduce((ae,be)=>ae+be.unreadCount,0),De=u.reduce((ae,be)=>ae+be.pendingRequests.filter(Ue=>Ue.status===Pm.PENDING).length,0);if(n===zg.INITIALIZING)return f.jsxs("div",{className:"flex flex-col items-center justify-center h-screen bg-[#010401] text-[#00f3ff] overflow-hidden p-6",children:[f.jsx(Hj,{color:"#4caf50",className:"opacity-30"}),f.jsxs("div",{className:"z-10 flex flex-col items-center animate-in fade-in zoom-in duration-1000",children:[f.jsxs("div",{className:"mb-12 relative",children:[f.jsx("div",{className:"absolute inset-0 bg-[#00f3ff]/30 blur-3xl animate-pulse"}),f.jsx(NM,{size:140,color:"#00f3ff"})]}),f.jsxs("div",{className:"text-center",children:[f.jsx("h1",{className:"orbitron text-3xl md:text-5xl font-black tracking-[1.2em] mb-4 text-[#00f3ff] pl-[1.2em]",children:"G3ZKP"}),f.jsx("p",{className:"orbitron text-[8px] md:text-[10px] uppercase tracking-[0.6em] text-[#4caf50] mb-10 opacity-80",children:"Meta-Geodesic Cryptographic Engine"})]}),f.jsx("div",{className:"h-[0.5px] w-56 bg-[#4caf50]/40 relative overflow-hidden mb-10",children:f.jsx("div",{className:"absolute top-0 left-0 h-full bg-[#00f3ff] animate-[load_3s_linear_infinite]"})}),f.jsx("div",{className:"font-mono text-[9px] uppercase tracking-[1em] opacity-60 text-center animate-pulse",children:" Establishing_Tautology_Grade_3 "})]})]});const Le=[{id:"geodesic",icon:y6,label:"GEODESIC"},{id:"mesh",icon:As,label:"MESH"},{id:"business",icon:OR,label:"UPLINK"},{id:"system",icon:Vm,label:"SYSTEM"}];return f.jsxs("div",{className:"h-screen w-screen flex flex-col overflow-hidden relative bg-[#010401] touch-manipulation",children:[f.jsx(Hj,{color:"#4caf50",className:"opacity-15",speed:.15}),f.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden pb-[env(safe-area-inset-bottom,60px)] lg:pb-0 min-h-0",children:[f.jsxs("aside",{className:`hidden lg:block w-64 xl:w-72 border-r-[0.5px] border-[#4caf50]/30 overflow-y-auto bg-black/60 backdrop-blur-md flex-shrink-0 ${at||t==="geodesic"?"lg:hidden":""}`,children:[f.jsx("div",{className:"p-8 border-b-[0.5px] border-[#4caf50]/40",children:f.jsxs("div",{className:"flex items-center gap-4",children:[f.jsx(NM,{size:36,color:"#00f3ff",rotorSpeed:"25s"}),f.jsxs("div",{children:[f.jsx("h2",{className:"orbitron text-sm font-black text-[#00f3ff] tracking-widest leading-none opacity-100",children:"G3ZKP"}),f.jsx("span",{className:"text-[7px] uppercase tracking-widest opacity-70 mt-1.5 block font-mono",children:"GENESIS_V1.ISO"})]})]})}),f.jsxs("div",{className:"p-6 border-b-[0.5px] border-[#4caf50]/40",children:[f.jsxs("div",{className:"relative mb-6",children:[f.jsx(ja,{size:12,className:"absolute left-3 top-1/2 -translate-y-1/2 opacity-50"}),f.jsx("input",{type:"text",placeholder:"Scan Nodes...",className:"w-full bg-black/40 border-[0.5px] border-[#4caf50]/40 pl-10 pr-4 py-2.5 text-[10px] outline-none focus:border-[#00f3ff]/50 text-[#00f3ff] transition-all"})]}),f.jsxs("div",{className:"flex gap-2",children:[f.jsxs("button",{onClick:()=>{i("mesh"),O(null)},className:"flex-1 py-2 border-[0.5px] border-[#00f3ff]/40 text-[8px] font-black tracking-widest uppercase hover:bg-[#00f3ff]/15 text-[#00f3ff] flex items-center justify-center gap-1",children:[f.jsx(As,{size:10})," Groups"]}),f.jsxs("button",{onClick:()=>{i("mesh"),O("chats")},className:"flex-1 py-2 border-[0.5px] border-[#4caf50]/30 text-[8px] font-black tracking-widest uppercase opacity-50 hover:opacity-100 transition-opacity flex items-center justify-center gap-1",children:[f.jsx(Pd,{size:10})," Chats"]})]})]}),f.jsx("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 scrollbar-hide",children:u.map(ae=>f.jsxs("div",{onClick:()=>{m(ae),i("mesh")},className:`p-4 border-[0.5px] bg-white/[0.05] transition-all cursor-pointer group flex items-center gap-5 ${p?.id===ae.id?"border-[#00f3ff]/60 opacity-100":"border-[#4caf50]/30 opacity-70 hover:opacity-100"}`,children:[f.jsxs("div",{className:"relative",children:[f.jsx("div",{className:"w-10 h-10 border-[0.5px] border-[#4caf50]/40 flex items-center justify-center font-black text-[9px] text-[#4caf50]",children:ae.name.substring(0,3)}),ae.unreadCount>0&&f.jsx("span",{className:"absolute -top-1 -right-1 min-w-[14px] h-[14px] flex items-center justify-center px-1 bg-[#00f3ff] text-black text-[7px] font-black",children:ae.unreadCount})]}),f.jsxs("div",{className:"flex-1 min-w-0",children:[f.jsxs("div",{className:"flex justify-between items-center mb-1.5",children:[f.jsx("span",{className:"text-[9px] font-black text-[#00f3ff] truncate uppercase tracking-wider",children:ae.name}),ae.isPrivate&&f.jsx(j0,{size:10,className:"text-[#4caf50]/40 shrink-0"})]}),f.jsxs("div",{className:"flex items-center gap-2",children:[f.jsx(As,{size:10,className:"text-[#4caf50]/40"}),f.jsx("span",{className:"text-[7px] font-mono text-[#4caf50]/40",children:ae.memberCount}),ae.zkpVerified&&f.jsx(f_,{size:10,className:"text-[#00f3ff]/40"})]})]})]},ae.id))}),f.jsxs("div",{className:"p-6 border-t-[0.5px] border-[#4caf50]/40 space-y-3",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsxs("button",{onClick:()=>Ae(!0),className:"py-3 border-[0.5px] border-[#00f3ff]/30 text-[8px] font-black uppercase tracking-widest hover:bg-[#00f3ff]/10 flex items-center justify-center gap-2 text-[#00f3ff]/70 hover:text-[#00f3ff] transition-all",children:[f.jsx(ja,{size:12,strokeWidth:1})," SEARCH"]}),f.jsxs("button",{onClick:()=>Dt(!0),className:"py-3 border-[0.5px] border-yellow-500/30 text-[8px] font-black uppercase tracking-widest hover:bg-yellow-500/10 flex items-center justify-center gap-2 text-yellow-500/70 hover:text-yellow-500 transition-all relative",children:[f.jsx(A0,{size:12,strokeWidth:1})," ALERTS",qe>0&&f.jsx("span",{className:"absolute -top-1 -right-1 bg-[#00f3ff] text-black text-[7px] font-black min-w-[14px] h-[14px] flex items-center justify-center rounded-full px-1 animate-pulse",children:qe>99?"99+":qe})]})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[f.jsxs("button",{onClick:()=>v(!0),className:"py-3 border-[0.5px] border-[#00f3ff]/40 text-[8px] font-black uppercase tracking-widest hover:bg-[#00f3ff]/15 flex items-center justify-center gap-2 text-[#00f3ff]",children:[f.jsx(sh,{size:12,strokeWidth:1})," JOIN"]}),f.jsxs("button",{onClick:()=>s("group"),className:"py-3 border-[0.5px] border-[#4caf50]/40 text-[8px] font-black uppercase tracking-widest hover:bg-[#4caf50]/15 flex items-center justify-center gap-2 text-[#4caf50]",children:[f.jsx(Oae,{size:12,strokeWidth:1})," CREATE"]})]}),f.jsxs("button",{onClick:()=>S(!0),className:"w-full py-3 border-[0.5px] border-[#4caf50]/20 text-[8px] font-black uppercase tracking-widest hover:bg-[#4caf50]/10 flex items-center justify-center gap-2 text-[#4caf50]/60 hover:text-[#4caf50]",children:[f.jsx(sh,{size:12,strokeWidth:1})," OPERATOR PROFILE"]})]})]}),f.jsxs("main",{className:"flex-1 flex flex-col relative z-10 overflow-hidden bg-[#010401]/95 min-h-0",children:[f.jsxs("header",{className:"h-16 sm:h-18 flex items-center justify-between px-4 sm:px-6 md:px-8 border-b-[0.5px] border-[#4caf50]/30 bg-black/40 backdrop-blur-md",children:[f.jsxs("div",{className:"flex items-center gap-3 md:gap-5",children:[f.jsx(NM,{size:28,color:"#00f3ff"}),f.jsxs("div",{className:"block",children:[f.jsx("h1",{className:"orbitron text-[10px] sm:text-xs font-black text-[#00f3ff] tracking-widest uppercase opacity-100",children:"G3ZKP MESSENGER"}),f.jsx("p",{className:"hidden sm:block text-[6px] text-[#4caf50] uppercase tracking-[0.5em] font-bold mt-1 opacity-70",children:"Tautological Soundness V1.0"})]})]}),f.jsxs("div",{className:"flex items-center gap-2 md:gap-6",children:[f.jsx("div",{className:"hidden md:flex gap-1.5 lg:gap-2 border-l-[0.5px] border-[#4caf50]/30 pl-3 lg:pl-4",children:Le.map(ae=>f.jsxs("button",{onClick:()=>i(ae.id),className:`flex items-center gap-1 lg:gap-1.5 px-2 lg:px-3 py-1.5 lg:py-2 text-[7px] lg:text-[8px] font-black uppercase tracking-widest transition-all border-[0.5px] ${t===ae.id?"border-[#00f3ff]/60 text-[#00f3ff] bg-[#00f3ff]/10":"border-[#4caf50]/20 text-[#4caf50]/60 hover:border-[#4caf50]/40"}`,children:[f.jsx(ae.icon,{size:12,strokeWidth:1}),f.jsx("span",{className:"hidden lg:inline",children:ae.label})]},ae.id))}),f.jsxs("div",{className:"flex gap-2 sm:gap-3 border-l-[0.5px] border-[#4caf50]/30 pl-3 md:pl-4",children:[f.jsxs("button",{onClick:()=>Dt(!0),className:"relative text-[#4caf50] hover:text-[#00f3ff] transition-all p-1.5",children:[f.jsx(A0,{size:14,strokeWidth:1}),qe>0&&f.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-[#00f3ff] animate-pulse"})]}),f.jsx("button",{onClick:()=>s("license"),className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-1.5",children:f.jsx(pK,{size:14,strokeWidth:1})}),f.jsx("button",{onClick:()=>s("settings"),className:"text-[#4caf50] hover:text-[#00f3ff] transition-all p-1.5",children:f.jsx(c7,{size:14,strokeWidth:1})})]})]})]}),f.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[t==="mesh"&&f.jsx(zUe,{meshGroups:u,meshContacts:M,messages:l,selectedGroup:p,typingUsers:G,highlightedMessageId:Pe,onSelectGroup:m,onSendMessage:It,onFileUpload:ae=>se([ae]),onVoiceMessage:ae=>Yt(ae,0,[]),onCreateGroup:()=>s("group"),onJoinGroup:()=>v(!0),onAddContact:ae=>{P(be=>[...be,{peerId:ae.peerId,displayName:`NODE_${ae.peerId.substring(0,8)}`,isOnline:!0,unreadCount:0}])},onCall:ae=>s(ae==="voice"?"call_voice":"call_video"),onReactToMessage:Ht,onEditMessage:$n,onDeleteMessage:Kt,onStartTyping:Mn,onStopTyping:kn,onViewThread:Ln,onViewTensorObject:te,getMessageById:Sn,fileProgress:q,isVerifying:o}),y&&p&&f.jsx($Ue,{group:p,currentUserId:B.peerId,onClose:()=>b(!1),onUpdateGroup:ae=>{h(be=>be.map(Ue=>Ue.id===ae.id?ae:Ue))},onKickMember:(ae,be)=>{fd.kickMember(p,ae,B.peerId,be),m({...p,members:p.members.filter(Ue=>Ue.peerId!==ae),memberCount:p.memberCount-1})},onChangeMemberRole:(ae,be)=>{fd.changeMemberRole(p,ae,be,B.peerId),m({...p,members:p.members.map(Ue=>Ue.peerId===ae?{...Ue,role:be}:Ue)})},onUpdateSettings:ae=>{fd.updateGroupSettings(p,ae,B.peerId),m({...p,settings:{...p.settings,...ae}})},onHandleJoinRequest:(ae,be)=>{fd.handleJoinRequest(p,ae,be,B.peerId)}}),t==="geodesic"&&f.jsx(pCe,{currentLocation:pt,currentRoute:Qe,navigationActive:at,navigationHeading:Gt,showRoutePlanner:mn,showTransitPlanner:gi,showOfflineManager:Il,onMapClick:le,onLocationFound:z,onRouteCalculated:je,onStartNavigation:Ke,onEndNavigation:()=>yt(!1),onReroute:St,onToggleRoutePlanner:()=>Cn(!mn),onToggleTransitPlanner:()=>$r(!gi),onToggleOfflineManager:()=>X(!Il),onCloseRoutePlanner:()=>Cn(!1),onCloseTransitPlanner:()=>$r(!1),onCloseOfflineManager:()=>X(!1)}),t==="business"&&f.jsx(P9e,{}),t==="system"&&f.jsx("div",{className:"flex-1 overflow-y-auto p-4 md:p-6",children:f.jsxs("div",{className:"max-w-6xl mx-auto",children:[f.jsxs("header",{className:"mb-6",children:[f.jsxs("h1",{className:"text-2xl text-[var(--color-primary,#00f3ff)] font-mono mb-2 flex items-center gap-2",children:[f.jsx(Vm,{size:24}),"SYSTEM MONITOR"]}),f.jsxs("p",{className:"text-gray-400 text-sm",children:["Real-time cryptographic protocol status and network monitoring.",f.jsx("span",{className:"text-green-500 ml-2 font-mono",children:"NO SIMULATED DATA"})]})]}),f.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[f.jsx("div",{className:"lg:col-span-2",children:f.jsx(bCe,{refreshInterval:3e3})}),f.jsxs("div",{className:"space-y-6",children:[f.jsx(_Ce,{}),f.jsx(wCe,{})]})]}),f.jsxs("div",{className:"mt-6 bg-gray-900 border border-cyan-800 rounded-lg p-4",children:[f.jsxs("h3",{className:"text-cyan-400 mb-3 font-mono flex items-center gap-2",children:[f.jsx(nk,{size:16}),"SYSTEM METRICS"]}),f.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[f.jsxs("div",{className:"bg-black p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-xs font-mono mb-1",children:"Mesh Groups"}),f.jsx("div",{className:"text-green-400 text-xl font-mono",children:u.length})]}),f.jsxs("div",{className:"bg-black p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-xs font-mono mb-1",children:"Total Members"}),f.jsx("div",{className:"text-green-400 text-xl font-mono",children:u.reduce((ae,be)=>ae+be.memberCount,0)})]}),f.jsxs("div",{className:"bg-black p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-xs font-mono mb-1",children:"Messages"}),f.jsx("div",{className:"text-green-400 text-xl font-mono",children:l.length})]}),f.jsxs("div",{className:"bg-black p-3 rounded border border-gray-800",children:[f.jsx("div",{className:"text-gray-400 text-xs font-mono mb-1",children:"Status"}),f.jsx("div",{className:"text-green-400 text-sm font-mono",children:"OPERATIONAL"})]})]})]})]})})]})]})]}),f.jsx(v9e,{activePage:t,onPageChange:i,onNewAction:()=>s("group"),onProfileClick:()=>S(!0),unreadCount:Ee,pendingRequests:De}),r==="call_voice"&&f.jsx(Xj,{type:"voice",onClose:()=>s("none"),contactName:"MESH_NODE"}),r==="call_video"&&f.jsx(Xj,{type:"video",onClose:()=>s("none"),contactName:"MESH_NODE"}),r==="group"&&f.jsx(F9e,{onClose:()=>s("none"),onCreate:tt}),r==="license"&&f.jsx(z9e,{status:U,onClose:()=>s("none")}),r==="settings"&&f.jsx(j9e,{onClose:()=>s("none")}),y&&p&&f.jsx(D9e,{group:u.find(ae=>ae.id===p.id)||p,currentUserId:W.id,onApproveRequest:Lt,onRejectRequest:Ct,onKickMember:Ot,onBanMember:nn,onChangeRole:Tt,onMuteMember:Ve,onUpdateSettings:ut,onLeaveGroup:ue,onClose:()=>b(!1)}),w&&f.jsx(O9e,{groups:u.filter(ae=>ae.settings.allowJoinRequests),onJoinRequest:Ie,onClose:()=>v(!1)}),T&&f.jsx(B9e,{profile:W,isOwnProfile:!0,onUpdateProfile:Te,onUpdateSettings:it,onClose:()=>S(!1)}),de&&f.jsx("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4 animate-in fade-in duration-300",children:f.jsxs("div",{className:"bg-[#010401] border border-[#00f3ff]/20 w-full max-w-md shadow-[0_0_40px_rgba(0,243,255,0.1)]",children:[f.jsxs("div",{className:"p-6 border-b border-[#00f3ff]/10 flex items-center justify-between",children:[f.jsxs("div",{className:"flex items-center gap-3",children:[f.jsx("div",{className:`w-3 h-3 rounded-full ${de.isOnline?"bg-[#4caf50] animate-pulse":"bg-white/20"}`}),f.jsx("h2",{className:"text-[#00f3ff] font-black text-sm uppercase tracking-[0.2em]",children:de.displayName})]}),f.jsx("button",{onClick:()=>Ne(null),className:"text-white/40 hover:text-white p-2",children:f.jsx(Ui,{size:18,strokeWidth:1})})]}),f.jsxs("div",{className:"p-6 space-y-4",children:[f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"p-3 border border-[#00f3ff]/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-[#00f3ff]/50 uppercase mb-1",children:"Role"}),f.jsx("div",{className:"text-[#00f3ff] text-sm font-bold uppercase",children:de.role})]}),f.jsxs("div",{className:"p-3 border border-[#4caf50]/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-[#4caf50]/50 uppercase mb-1",children:"Status"}),f.jsx("div",{className:"text-[#4caf50] text-sm font-bold uppercase",children:de.isOnline?"ONLINE":"OFFLINE"})]})]}),f.jsxs("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-white/50 uppercase mb-1",children:"Peer ID"}),f.jsx("div",{className:"text-white/70 text-[10px] font-mono break-all",children:de.peerId})]}),f.jsxs("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-white/50 uppercase mb-1",children:"Public Key"}),f.jsx("div",{className:"text-white/70 text-[10px] font-mono break-all",children:de.publicKey})]}),f.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[f.jsxs("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-white/50 uppercase mb-1",children:"Joined"}),f.jsx("div",{className:"text-white/70 text-xs",children:new Date(de.joinedAt).toLocaleDateString()})]}),f.jsxs("div",{className:"p-3 border border-white/10 bg-white/[0.02]",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-white/50 uppercase mb-1",children:"Last Seen"}),f.jsx("div",{className:"text-white/70 text-xs",children:new Date(de.lastSeenAt).toLocaleDateString()})]})]}),f.jsxs("div",{className:"pt-4 border-t border-white/10",children:[f.jsx("div",{className:"text-[7px] font-black tracking-[0.3em] text-white/50 uppercase mb-2",children:"Permissions"}),f.jsxs("div",{className:"flex flex-wrap gap-2",children:[de.permissions.canPost&&f.jsx("span",{className:"text-[8px] px-2 py-1 bg-[#4caf50]/10 text-[#4caf50] uppercase tracking-wider",children:"POST"}),de.permissions.canReply&&f.jsx("span",{className:"text-[8px] px-2 py-1 bg-[#4caf50]/10 text-[#4caf50] uppercase tracking-wider",children:"REPLY"}),de.permissions.canInvite&&f.jsx("span",{className:"text-[8px] px-2 py-1 bg-[#00f3ff]/10 text-[#00f3ff] uppercase tracking-wider",children:"INVITE"}),de.permissions.canKick&&f.jsx("span",{className:"text-[8px] px-2 py-1 bg-yellow-500/10 text-yellow-400 uppercase tracking-wider",children:"KICK"}),de.permissions.canBan&&f.jsx("span",{className:"text-[8px] px-2 py-1 bg-red-500/10 text-red-400 uppercase tracking-wider",children:"BAN"}),de.permissions.canManageRoles&&f.jsx("span",{className:"text-[8px] px-2 py-1 bg-purple-500/10 text-purple-400 uppercase tracking-wider",children:"MANAGE_ROLES"})]})]})]}),f.jsx("div",{className:"p-4 border-t border-white/10 flex justify-center",children:f.jsx("button",{onClick:()=>Ne(null),className:"px-6 py-2 border border-[#00f3ff]/30 text-[#00f3ff] text-[9px] font-black uppercase tracking-widest hover:bg-[#00f3ff]/10 transition-all",children:"Close"})})]})}),fe&&f.jsx(yUe,{messages:l,groups:u,members:we,onResultClick:rt,onClose:()=>Ae(!1)}),f.jsx(bUe,{notifications:gt,onDismiss:vn,onClick:Re}),zt&&f.jsx(_Ue,{notifications:et,settings:nt,onUpdateSettings:Pt,onMarkRead:bn,onMarkAllRead:ie,onDelete:_e,onClearAll:ke,onClick:Re,onClose:()=>Dt(!1)}),ft&&f.jsx(pUe,{tensorData:ft,onClose:()=>xe(null)})]})};const cre=document.getElementById("root");if(!cre)throw new Error("Root element not found");VM.createRoot(cre).render(f.jsx(Fa.StrictMode,{children:f.jsx(m9e,{children:f.jsx(GUe,{})})}));export{kje as B,qOe as C,uBe as D,gm as L,oBe as O,sBe as P,JBe as T,ZBe as V,f as j,$ as r,ew as u};
//# sourceMappingURL=index-29faac0c.js.map
