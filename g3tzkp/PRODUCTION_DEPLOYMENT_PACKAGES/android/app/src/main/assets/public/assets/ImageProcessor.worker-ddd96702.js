(function(){"use strict";const x={detectSaliency(i,e=.4){const{width:a,height:s,data:n}=i,r=new Float32Array(a*s),l=this.computeMeanLAB(n,a,s);for(let t=0;t<s;t++)for(let o=0;o<a;o++){const h=(t*a+o)*4,u=this.rgbToLAB(n[h],n[h+1],n[h+2]),g=Math.sqrt(Math.pow(u.L-l.L,2)+Math.pow(u.a-l.a,2)+Math.pow(u.b-l.b,2))/100;r[t*a+o]=Math.min(1,g*2)}const c=this.gaussianBlur(r,a,s,3),f=new Uint8Array(a*s);for(let t=0;t<c.length;t++)f[t]=c[t]>e?255:0;return f},rgbToLAB(i,e,a){let s=i/255,n=e/255,r=a/255;s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92,n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92,r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;const l=s*.4124+n*.3576+r*.1805,c=s*.2126+n*.7152+r*.0722,f=s*.0193+n*.1192+r*.9505,t=.95047,o=1,h=1.08883,u=l/t>.008856?Math.pow(l/t,1/3):7.787*(l/t)+16/116,g=c/o>.008856?Math.pow(c/o,1/3):7.787*(c/o)+16/116,p=f/h>.008856?Math.pow(f/h,1/3):7.787*(f/h)+16/116;return{L:116*g-16,a:500*(u-g),b:200*(g-p)}},computeMeanLAB(i,e,a){let s=0,n=0,r=0;const l=e*a;for(let c=0;c<i.length;c+=4){const f=this.rgbToLAB(i[c],i[c+1],i[c+2]);s+=f.L,n+=f.a,r+=f.b}return{L:s/l,a:n/l,b:r/l}},gaussianBlur(i,e,a,s){const n=new Float32Array(i.length),r=this.createGaussianKernel(s),l=Math.floor(r.length/2),c=new Float32Array(i.length);for(let f=0;f<a;f++)for(let t=0;t<e;t++){let o=0,h=0;for(let u=-l;u<=l;u++){const g=Math.max(0,Math.min(e-1,t+u)),p=r[u+l];o+=i[f*e+g]*p,h+=p}c[f*e+t]=o/h}for(let f=0;f<a;f++)for(let t=0;t<e;t++){let o=0,h=0;for(let u=-l;u<=l;u++){const g=Math.max(0,Math.min(a-1,f+u)),p=r[u+l];o+=c[g*e+t]*p,h+=p}n[f*e+t]=o/h}return n},createGaussianKernel(i){const e=i/2,a=i*2+1,s=new Array(a);let n=0;for(let r=0;r<a;r++){const l=r-i;s[r]=Math.exp(-(l*l)/(2*e*e))/(Math.sqrt(2*Math.PI)*e),n+=s[r]}for(let r=0;r<a;r++)s[r]/=n;return s}},w={removeByColor(i,e,a=.3,s=.1){const{width:n,height:r,data:l}=i,c=new Uint8ClampedArray(n*r),[f,t,o]=e,h=this.rgbToYCbCr(f,t,o);for(let u=0;u<l.length;u+=4){const g=l[u],p=l[u+1],M=l[u+2],m=this.rgbToYCbCr(g,p,M),k=Math.abs(m.y-h.y)/255,C=Math.abs(m.cb-h.cb)/255,B=Math.abs(m.cr-h.cr)/255,y=Math.sqrt(Math.pow(k*.3,2)+Math.pow(C*1,2)+Math.pow(B*1,2));let b=255;if(y<a)b=0;else if(y<a+s){const d=(y-a)/s;b=Math.floor(255*d)}c[u/4]=b}return c},rgbToYCbCr(i,e,a){const s=.299*i+.587*e+.114*a,n=128-.168736*i-.331264*e+.5*a,r=128+.5*i-.418688*e-.081312*a;return{y:s,cb:n,cr:r}},detectBackgroundColor(i){const{width:e,height:a,data:s}=i,n=[],r=Math.max(1,Math.floor(e/50));for(let t=0;t<e;t+=r){const o=t*4;n.push([s[o],s[o+1],s[o+2]])}for(let t=0;t<e;t+=r){const o=((a-1)*e+t)*4;n.push([s[o],s[o+1],s[o+2]])}if(n.length===0)return[255,255,255];let l=0,c=0,f=0;for(const[t,o,h]of n)l+=t,c+=o,f+=h;return[Math.round(l/n.length),Math.round(c/n.length),Math.round(f/n.length)]}},A={featherEdges(i,e,a,s){const n=new Uint8Array(i.length),r=new Float32Array(i.length);for(let t=0;t<i.length;t++)r[t]=i[t]/255;const l=x.createGaussianKernel(s),c=Math.floor(l.length/2),f=new Float32Array(i.length);for(let t=0;t<a;t++)for(let o=0;o<e;o++){let h=0,u=0;for(let g=-c;g<=c;g++){const p=Math.max(0,Math.min(e-1,o+g)),M=l[g+c];h+=r[t*e+p]*M,u+=M}f[t*e+o]=h/u}for(let t=0;t<a;t++)for(let o=0;o<e;o++){let h=0,u=0;for(let g=-c;g<=c;g++){const p=Math.max(0,Math.min(a-1,t+g)),M=l[g+c];h+=f[p*e+o]*M,u+=M}n[t*e+o]=Math.floor(h/u*255)}return n},fillHoles(i,e,a){const s=new Uint8Array(i),n=new Uint8Array(e*a),r=(l,c)=>{const f=[],t=[[l,c]];for(;t.length>0;){const[o,h]=t.pop(),u=h*e+o;o<0||o>=e||h<0||h>=a||n[u]===1||i[u]>0||(n[u]=1,f.push(u),t.push([o+1,h]),t.push([o-1,h]),t.push([o,h+1]),t.push([o,h-1]))}return f};for(let l=1;l<a-1;l++)for(let c=1;c<e-1;c++){const f=l*e+c;if(i[f]===0&&n[f]===0){const t=r(c,l);let o=!1;for(const h of t){const u=h%e,g=Math.floor(h/e);if(u===0||u===e-1||g===0||g===a-1){o=!0;break}}if(!o&&t.length<e*a/4)for(const h of t)s[h]=255}}return s}};self.onmessage=async i=>{const{type:e,imageData:a,params:s}=i.data;try{const n=performance.now();let r;switch(e){case"saliency":{const c=s?.threshold??.4;r=x.detectSaliency(a,c);break}case"color":{const{targetColor:c,tolerance:f=.3,softness:t=.1}=s;r=w.removeByColor(a,c,f,t);break}case"detectBackground":{const c=w.detectBackgroundColor(a);self.postMessage({success:!0,result:c,processingTime:performance.now()-n});return}case"feather":{const{mask:c,width:f,height:t,radius:o=2}=s;r=A.featherEdges(c,f,t,o);break}case"fillHoles":{const{mask:c,width:f,height:t}=s;r=A.fillHoles(c,f,t);break}default:throw new Error(`Unknown processing type: ${e}`)}const l=performance.now()-n;self.postMessage({success:!0,result:r,processingTime:l})}catch(n){self.postMessage({success:!1,error:n.message})}}})();
//# sourceMappingURL=ImageProcessor.worker-ddd96702.js.map
